
> pagyra-js@0.0.1 test
> vitest run caveat-font-embedding.spec.ts


[7m[1m[36m RUN [39m[22m[27m [36mv1.6.1[39m [90mC:/Users/celso/pagyra-js[39m

[90mstdout[2m | tests/e2e/caveat-font-embedding.spec.ts[2m > [22m[2mrenders PDF with custom Caveat font embedding[22m[39m
Builtin font baseDir: C:\Users\celso\pagyra-js\assets\fonts
Loading font file: C:\Users\celso\pagyra-js\assets\fonts\ttf\roboto\Roboto-Regular.ttf

[90mstdout[2m | tests/e2e/caveat-font-embedding.spec.ts[2m > [22m[2mrenders PDF with custom Caveat font embedding[22m[39m
Loading font file: C:\Users\celso\pagyra-js\assets\fonts\ttf\roboto\Roboto-Bold.ttf

[90mstdout[2m | tests/e2e/caveat-font-embedding.spec.ts[2m > [22m[2mrenders PDF with custom Caveat font embedding[22m[39m
Loading font file: C:\Users\celso\pagyra-js\assets\fonts\ttf\roboto\Roboto-Italic.ttf

[90mstdout[2m | tests/e2e/caveat-font-embedding.spec.ts[2m > [22m[2mrenders PDF with custom Caveat font embedding[22m[39m
Loading font file: C:\Users\celso\pagyra-js\assets\fonts\ttf\roboto\Roboto-BoldItalic.ttf

[90mstdout[2m | tests/e2e/caveat-font-embedding.spec.ts[2m > [22m[2mrenders PDF with custom Caveat font embedding[22m[39m
Loading font file: C:\Users\celso\pagyra-js\assets\fonts\ttf\notosans\NotoSans-Regular.ttf

[90mstdout[2m | tests/e2e/caveat-font-embedding.spec.ts[2m > [22m[2mrenders PDF with custom Caveat font embedding[22m[39m
Loading font file: C:\Users\celso\pagyra-js\assets\fonts\ttf\dejavu\DejaVuSans.ttf

[90mstdout[2m | tests/e2e/caveat-font-embedding.spec.ts[2m > [22m[2mrenders PDF with custom Caveat font embedding[22m[39m
prepareHtmlRender - input html: <!DOCTYPE html>
<html>
<head>
  <title>Caveat Font Test</title>
  <style>
    @font-face {
      font-family: 'Caveat';
      /* Use file:// protocol or Base64 for reliable rendering in headless environments */
      src: url('file://C:\Users\celso\pagyra-js\assets\fonts\woff2\caveat\Caveat-Regular.woff2') format('woff2');
      font-weight: 400;
      font-style: normal;
    }
    body {
      font-family: 'Caveat', serif;
      padding: 50px;
    }
    h1 { font-size: 32px; }
    p { font-size: 18px; }
  </style>
</head>
<body>
  <h1>Caveat Font Test</h1>
  <p>The quick brown fox jumps over the lazy dog.</p>
</body>
</html>
prepareHtmlRender - parsed document body: 
  <h1>Caveat Font Test</h1>
  <p>The quick brown fox jumps over the lazy dog.</p>

prepareHtmlRender - document.documentElement tagName: HTML
prepareHtmlRender - document.documentElement innerHTML: 
<head>
  <title>Caveat Font Test</title>
  <style>
    @font-face {
      font-family: 'Caveat';
      /* Use file:// protocol or Base64 for reliable rendering in headless environments */
      src: url('file://C:\Users\celso\pagyra-js\assets\fonts\woff2\caveat\Caveat-Regular.woff2') format('woff2');
      font-weight: 400;
      font-style: normal;
    }
    body {
      font-family: 'Caveat', serif;
      padding: 50px;
    }
    h1 { font-size: 32px; }
    p { font-size: 18px; }
  </style>
</head>
<body>
  <h1>Caveat Font Test</h1>
  <p>The quick brown fox jumps over the lazy dog.</p>
</body>

prepareHtmlRender - document children count: [33m3[39m
prepareHtmlRender - document child 0: [33m10[39m text node
prepareHtmlRender - document child 1: [33m3[39m text node
prepareHtmlRender - document child 2: [33m1[39m HTML
computeStyleForElement - processing element: HTML style attribute: [1mnull[22m
parseInlineStyle - input: 
parseInlineStyle - result: {}
computeStyleForElement - processing element: BODY style attribute: [1mnull[22m
parseInlineStyle - input: 
parseInlineStyle - result: {}
prepareHtmlRender - processing children of: BODY count: [33m5[39m
prepareHtmlRender - processing child: text node type: [33m3[39m
convertDomNode - entering function for node type: [33m3[39m tagName: text node
prepareHtmlRender - processing child: H1 type: [33m1[39m
convertDomNode - entering function for node type: [33m1[39m tagName: H1
convertDomNode - processing element: h1 with style attr: [1mnull[22m
computeStyleForElement - processing element: H1 style attribute: [1mnull[22m
parseInlineStyle - input: 
parseInlineStyle - result: {}
convertDomNode - computed style backgroundLayers: []
prepareHtmlRender - processing child: text node type: [33m3[39m
convertDomNode - entering function for node type: [33m3[39m tagName: text node
convertDomNode - processing text node: (single space)
prepareHtmlRender - processing child: P type: [33m1[39m
convertDomNode - entering function for node type: [33m1[39m tagName: P
convertDomNode - processing element: p with style attr: [1mnull[22m
computeStyleForElement - processing element: P style attribute: [1mnull[22m
parseInlineStyle - input: 
parseInlineStyle - result: {}
convertDomNode - computed style backgroundLayers: []
prepareHtmlRender - processing child: text node type: [33m3[39m
convertDomNode - entering function for node type: [33m3[39m tagName: text node
WOFF2 Engine: Starting parse, file size: 94020 bytes
WOFF2 Parser: Starting parse, file size: 94020 bytes
WOFF2 Parser: Header parsed - flavor: 0x10000, numTables: 18, compressedSize: 93912
WOFF2 Parser: Decompressing 18 tables

[90mstdout[2m | tests/e2e/caveat-font-embedding.spec.ts[2m > [22m[2mrenders PDF with custom Caveat font embedding[22m[39m
WOFF2-BROTLI: Extracting 18 tables from 208138 bytes
WOFF2-BROTLI: Processing table FFTM - origLength: 28, transformLength: undefined, transformVersion: 0
WOFF2-BROTLI: Added table FFTM (28 bytes)
WOFF2-BROTLI: Processing table GDEF - origLength: 112, transformLength: undefined, transformVersion: 0
WOFF2-BROTLI: Added table GDEF (112 bytes)
WOFF2-BROTLI: Processing table GPOS - origLength: 29062, transformLength: undefined, transformVersion: 0
WOFF2-BROTLI: Added table GPOS (29062 bytes)
WOFF2-BROTLI: Processing table GSUB - origLength: 20854, transformLength: undefined, transformVersion: 0
WOFF2-BROTLI: Added table GSUB (20854 bytes)
WOFF2-BROTLI: Processing table OS/2 - origLength: 96, transformLength: undefined, transformVersion: 0
WOFF2-BROTLI: Added table OS/2 (96 bytes)
WOFF2-BROTLI: Processing table cmap - origLength: 1158, transformLength: undefined, transformVersion: 0
WOFF2-BROTLI: Added table cmap (1158 bytes)
WOFF2-BROTLI: Processing table cvt  - origLength: 184, transformLength: undefined, transformVersion: 0
WOFF2-BROTLI: Added table cvt  (184 bytes)
WOFF2-BROTLI: Processing table fpgm - origLength: 3437, transformLength: undefined, transformVersion: 0
WOFF2-BROTLI: Added table fpgm (3437 bytes)
WOFF2-BROTLI: Processing table gasp - origLength: 8, transformLength: undefined, transformVersion: 0
WOFF2-BROTLI: Added table gasp (8 bytes)
WOFF2-BROTLI: Processing table glyf - origLength: 176988, transformLength: 143491, transformVersion: 0
WOFF2-BROTLI: Added table glyf (143491 bytes)
WOFF2-BROTLI: Processing table loca - origLength: 2948, transformLength: 0, transformVersion: 0
WOFF2-BROTLI: Added table loca (0 bytes)
WOFF2-BROTLI: Processing table head - origLength: 54, transformLength: undefined, transformVersion: 0
WOFF2-BROTLI: Added table head (54 bytes)
WOFF2-BROTLI: Processing table hhea - origLength: 36, transformLength: undefined, transformVersion: 0
WOFF2-BROTLI: Added table hhea (36 bytes)
WOFF2-BROTLI: Processing table hmtx - origLength: 2944, transformLength: undefined, transformVersion: 0
WOFF2-BROTLI: Added table hmtx (2944 bytes)
WOFF2-BROTLI: Processing table maxp - origLength: 32, transformLength: undefined, transformVersion: 0
WOFF2-BROTLI: Added table maxp (32 bytes)
WOFF2-BROTLI: Processing table name - origLength: 840, transformLength: undefined, transformVersion: 0
WOFF2-BROTLI: Added table name (840 bytes)
WOFF2-BROTLI: Processing table post - origLength: 5614, transformLength: undefined, transformVersion: 0
WOFF2-BROTLI: Added table post (5614 bytes)
WOFF2-BROTLI: Processing table prep - origLength: 188, transformLength: undefined, transformVersion: 0
WOFF2-BROTLI: Added table prep (188 bytes)
WOFF2-BROTLI: Extracted tables: FFTM, GDEF, GPOS, GSUB, OS/2, cmap, cvt , fpgm, gasp, glyf, loca, head, hhea, hmtx, maxp, name, post, prep
WOFF2: Found transformed glyf/loca data, reconstructing...
WOFF2: Using transformed glyf table
WOFF2: Transform data size: 143491 bytes
WOFF2: maxp table present: true, head table present: true
WOFF2: Reconstructing glyf/loca with numGlyphs=736, indexFormat=1
Glyph 0: nContours=5, BBox=[0, 0, 0, 0]
Glyph 5: nContours=2, BBox=[0, 0, 0, 0]
Glyph 6: nContours=2, BBox=[8127, -4145, -24641, -4145]
Glyph 7: nContours=2, BBox=[-16385, -4097, -577, -2065]
Glyph 8: nContours=3, BBox=[-3079, -1537, -65, -1]
Glyph 9: nContours=5, BBox=[-12289, -1, -1, -1024]
WOFF2: Reconstructed glyf size: 127937, loca size: 2948
WOFF2: Successfully reconstructed glyf/loca tables
WOFF2: Available tables: FFTM, GDEF, GPOS, GSUB, OS/2, cmap, cvt , fpgm, gasp, glyf, loca, head, hhea, hmtx, maxp, name, post, prep
WOFF2 Parser: Decompressed tables: FFTM, GDEF, GPOS, GSUB, OS/2, cmap, cvt , fpgm, gasp, glyf, loca, head, hhea, hmtx, maxp, name, post, prep
WOFF2 Parser: Adding table FFTM (28 bytes)
WOFF2 Parser: Adding table GDEF (112 bytes)
WOFF2 Parser: Adding table GPOS (29062 bytes)
WOFF2 Parser: Adding table GSUB (20854 bytes)
WOFF2 Parser: Adding table OS/2 (96 bytes)
WOFF2 Parser: Adding table cmap (1158 bytes)
WOFF2 Parser: Adding table cvt  (184 bytes)
WOFF2 Parser: Adding table fpgm (3437 bytes)
WOFF2 Parser: Adding table gasp (8 bytes)
WOFF2 Parser: Adding table glyf (127937 bytes)
WOFF2 Parser: Adding table loca (2948 bytes)
WOFF2 Parser: Adding table head (54 bytes)
WOFF2 Parser: Adding table hhea (36 bytes)
WOFF2 Parser: Adding table hmtx (2944 bytes)
WOFF2 Parser: Adding table maxp (32 bytes)
WOFF2 Parser: Adding table name (840 bytes)
WOFF2 Parser: Adding table post (5614 bytes)
WOFF2 Parser: Adding table prep (188 bytes)
WOFF2 Parser: Final table count: 18
WOFF2 Engine: Successfully parsed WOFF2 tables
[ENCODING] INFO encoding-path { scheme: [32m'Identity-H'[39m, font: [32m'Caveat'[39m }
[ENCODING] INFO encoding-path { scheme: [32m'Identity-H'[39m, font: [32m'Caveat'[39m }
[ENCODING] INFO encoding-path { scheme: [32m'Identity-H'[39m, font: [32m'Caveat'[39m }
Embedded Fonts in PDF: [ [32m'Caveat'[39m ]

 [33mÔØ»[39m tests/e2e/caveat-font-embedding.spec.ts [2m ([22m[2m1 test[22m [2m|[22m [31m1 failed[39m[2m)[22m[90m 227[2mms[22m[39m
[31m   [33mÔØ»[31m tests/e2e/caveat-font-embedding.spec.ts[2m > [22mrenders PDF with custom Caveat font embedding[39m
[31m     ÔåÆ expected '\n\n-- 1 of 1 --\n\n' to contain 'Caveat Font Test'[39m
