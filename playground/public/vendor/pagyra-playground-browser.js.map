{
  "version": 3,
  "sources": ["../../../node_modules/linkedom/commonjs/perf_hooks.cjs", "../../../node_modules/boolbase/index.js", "../../../node_modules/cssom/lib/StyleSheet.js", "../../../node_modules/cssom/lib/CSSRule.js", "../../../node_modules/cssom/lib/CSSStyleRule.js", "../../../node_modules/cssom/lib/CSSStyleSheet.js", "../../../node_modules/cssom/lib/MediaList.js", "../../../node_modules/cssom/lib/CSSImportRule.js", "../../../node_modules/cssom/lib/CSSGroupingRule.js", "../../../node_modules/cssom/lib/CSSConditionRule.js", "../../../node_modules/cssom/lib/CSSMediaRule.js", "../../../node_modules/cssom/lib/CSSSupportsRule.js", "../../../node_modules/cssom/lib/CSSFontFaceRule.js", "../../../node_modules/cssom/lib/CSSHostRule.js", "../../../node_modules/cssom/lib/CSSKeyframeRule.js", "../../../node_modules/cssom/lib/CSSKeyframesRule.js", "../../../node_modules/cssom/lib/CSSValue.js", "../../../node_modules/cssom/lib/CSSValueExpression.js", "../../../node_modules/cssom/lib/MatcherList.js", "../../../node_modules/cssom/lib/CSSDocumentRule.js", "../../../node_modules/cssom/lib/parse.js", "../../../node_modules/cssom/lib/CSSStyleDeclaration.js", "../../../node_modules/cssom/lib/clone.js", "../../../node_modules/cssom/lib/index.js", "../../../node_modules/linkedom/commonjs/canvas-shim.cjs", "../../../node_modules/linkedom/commonjs/canvas.cjs", "../../../src/shim/empty.ts", "../../../src/shim/url-empty.ts", "../../../node_modules/css/lib/parse/index.js", "../../../node_modules/css/lib/stringify/compiler.js", "../../../node_modules/inherits/inherits_browser.js", "../../../node_modules/css/lib/stringify/compress.js", "../../../node_modules/css/lib/stringify/identity.js", "../../../node_modules/source-map/lib/base64.js", "../../../node_modules/source-map/lib/base64-vlq.js", "../../../node_modules/source-map/lib/util.js", "../../../node_modules/source-map/lib/array-set.js", "../../../node_modules/source-map/lib/mapping-list.js", "../../../node_modules/source-map/lib/source-map-generator.js", "../../../node_modules/source-map/lib/binary-search.js", "../../../node_modules/source-map/lib/quick-sort.js", "../../../node_modules/source-map/lib/source-map-consumer.js", "../../../node_modules/source-map/lib/source-node.js", "../../../node_modules/source-map/source-map.js", "../../../node_modules/atob/browser-atob.js", "../../../node_modules/decode-uri-component/index.js", "../../../node_modules/source-map-resolve/index.js", "../../../src/shim/fs-empty.ts", "../../../node_modules/css/lib/stringify/source-map-support.js", "../../../node_modules/css/lib/stringify/index.js", "../../../node_modules/css/index.js", "../../../src/shim/zlib-empty.ts", "../../../src/fonts/woff/decoder.ts", "../../../src/fonts/woff2/buffer.ts", "../../../src/fonts/woff2/decoder.ts", "../../../src/pdf/font/glyph-atlas.ts", "../../../src/environment/browser-environment.ts", "../../../src/environment/global.ts", "../../../node_modules/linkedom/esm/shared/symbols.js", "../../../node_modules/htmlparser2/lib/esm/index.ts", "../../../node_modules/entities/lib/esm/generated/generated/decode-data-html.ts", "../../../node_modules/entities/lib/esm/generated/generated/decode-data-xml.ts", "../../../node_modules/entities/lib/esm/decode_codepoint.ts", "../../../node_modules/entities/lib/esm/decode.ts", "../../../node_modules/htmlparser2/lib/esm/Tokenizer.ts", "../../../node_modules/htmlparser2/lib/esm/Parser.ts", "../../../node_modules/domelementtype/lib/esm/index.js", "../../../node_modules/domhandler/lib/esm/node.js", "../../../node_modules/domhandler/lib/esm/index.js", "../../../node_modules/domutils/lib/esm/index.ts", "../../../node_modules/entities/lib/esm/generated/generated/encode-html.ts", "../../../node_modules/entities/lib/esm/escape.ts", "../../../node_modules/entities/lib/esm/index.ts", "../../../node_modules/dom-serializer/lib/esm/foreignNames.js", "../../../node_modules/dom-serializer/lib/esm/index.js", "../../../node_modules/domutils/lib/esm/stringify.ts", "../../../node_modules/domutils/lib/esm/traversal.ts", "../../../node_modules/domutils/lib/esm/manipulation.ts", "../../../node_modules/domutils/lib/esm/querying.ts", "../../../node_modules/domutils/lib/esm/legacy.ts", "../../../node_modules/domutils/lib/esm/helpers.ts", "../../../node_modules/domutils/lib/esm/feeds.ts", "../../../node_modules/linkedom/esm/shared/constants.js", "../../../node_modules/linkedom/esm/shared/object.js", "../../../node_modules/linkedom/esm/shared/utils.js", "../../../node_modules/linkedom/esm/shared/shadow-roots.js", "../../../node_modules/linkedom/esm/interface/custom-element-registry.js", "../../../node_modules/linkedom/esm/shared/parse-from-string.js", "../../../node_modules/linkedom/esm/shared/register-html-class.js", "../../../node_modules/linkedom/esm/interface/document.js", "../../../node_modules/linkedom/esm/shared/jsdon.js", "../../../node_modules/linkedom/esm/interface/mutation-observer.js", "../../../node_modules/linkedom/esm/shared/attributes.js", "../../../node_modules/linkedom/esm/interface/event-target.js", "../../../node_modules/linkedom/esm/interface/node-list.js", "../../../node_modules/linkedom/esm/interface/node.js", "../../../node_modules/linkedom/esm/shared/text-escaper.js", "../../../node_modules/linkedom/esm/interface/attr.js", "../../../node_modules/linkedom/esm/shared/node.js", "../../../node_modules/linkedom/esm/mixin/non-document-type-child-node.js", "../../../node_modules/linkedom/esm/mixin/child-node.js", "../../../node_modules/linkedom/esm/interface/character-data.js", "../../../node_modules/linkedom/esm/interface/cdata-section.js", "../../../node_modules/linkedom/esm/interface/comment.js", "../../../node_modules/css-select/lib/esm/index.ts", "../../../node_modules/css-what/lib/es/types.js", "../../../node_modules/css-what/lib/es/parse.js", "../../../node_modules/css-select/lib/esm/compile.ts", "../../../node_modules/css-select/lib/esm/sort.ts", "../../../node_modules/css-select/lib/esm/attributes.ts", "../../../node_modules/nth-check/lib/esm/parse.ts", "../../../node_modules/nth-check/lib/esm/compile.ts", "../../../node_modules/nth-check/lib/esm/index.ts", "../../../node_modules/css-select/lib/esm/pseudo-selectors/pseudo-selectors/filters.ts", "../../../node_modules/css-select/lib/esm/pseudo-selectors/pseudo-selectors/pseudos.ts", "../../../node_modules/css-select/lib/esm/pseudo-selectors/pseudo-selectors/aliases.ts", "../../../node_modules/css-select/lib/esm/pseudo-selectors/pseudo-selectors/subselects.ts", "../../../node_modules/css-select/lib/esm/pseudo-selectors/pseudo-selectors/index.ts", "../../../node_modules/css-select/lib/esm/general.ts", "../../../node_modules/linkedom/esm/shared/matches.js", "../../../node_modules/linkedom/esm/interface/text.js", "../../../node_modules/linkedom/esm/mixin/parent-node.js", "../../../node_modules/linkedom/esm/mixin/non-element-parent-node.js", "../../../node_modules/linkedom/esm/interface/document-fragment.js", "../../../node_modules/linkedom/esm/interface/document-type.js", "../../../node_modules/linkedom/esm/mixin/inner-html.js", "../../../node_modules/uhyphen/esm/index.js", "../../../node_modules/linkedom/esm/dom/string-map.js", "../../../node_modules/linkedom/esm/dom/token-list.js", "../../../node_modules/linkedom/esm/interface/css-style-declaration.js", "../../../node_modules/linkedom/esm/interface/event.js", "../../../node_modules/linkedom/esm/interface/named-node-map.js", "../../../node_modules/linkedom/esm/interface/shadow-root.js", "../../../node_modules/linkedom/esm/interface/element.js", "../../../node_modules/linkedom/esm/svg/element.js", "../../../node_modules/linkedom/esm/shared/facades.js", "../../../node_modules/linkedom/esm/html/element.js", "../../../node_modules/linkedom/esm/html/template-element.js", "../../../node_modules/linkedom/esm/html/html-element.js", "../../../node_modules/linkedom/esm/html/text-element.js", "../../../node_modules/linkedom/esm/html/script-element.js", "../../../node_modules/linkedom/esm/html/frame-element.js", "../../../node_modules/linkedom/esm/html/i-frame-element.js", "../../../node_modules/linkedom/esm/html/object-element.js", "../../../node_modules/linkedom/esm/html/head-element.js", "../../../node_modules/linkedom/esm/html/body-element.js", "../../../node_modules/linkedom/esm/html/style-element.js", "../../../node_modules/linkedom/esm/html/time-element.js", "../../../node_modules/linkedom/esm/html/field-set-element.js", "../../../node_modules/linkedom/esm/html/embed-element.js", "../../../node_modules/linkedom/esm/html/hr-element.js", "../../../node_modules/linkedom/esm/html/progress-element.js", "../../../node_modules/linkedom/esm/html/paragraph-element.js", "../../../node_modules/linkedom/esm/html/table-element.js", "../../../node_modules/linkedom/esm/html/frame-set-element.js", "../../../node_modules/linkedom/esm/html/li-element.js", "../../../node_modules/linkedom/esm/html/base-element.js", "../../../node_modules/linkedom/esm/html/data-list-element.js", "../../../node_modules/linkedom/esm/html/input-element.js", "../../../node_modules/linkedom/esm/html/param-element.js", "../../../node_modules/linkedom/esm/html/media-element.js", "../../../node_modules/linkedom/esm/html/audio-element.js", "../../../node_modules/linkedom/esm/html/heading-element.js", "../../../node_modules/linkedom/esm/html/directory-element.js", "../../../node_modules/linkedom/esm/html/quote-element.js", "../../../node_modules/linkedom/esm/html/canvas-element.js", "../../../node_modules/linkedom/esm/html/legend-element.js", "../../../node_modules/linkedom/esm/html/option-element.js", "../../../node_modules/linkedom/esm/html/span-element.js", "../../../node_modules/linkedom/esm/html/meter-element.js", "../../../node_modules/linkedom/esm/html/video-element.js", "../../../node_modules/linkedom/esm/html/table-cell-element.js", "../../../node_modules/linkedom/esm/html/title-element.js", "../../../node_modules/linkedom/esm/html/output-element.js", "../../../node_modules/linkedom/esm/html/table-row-element.js", "../../../node_modules/linkedom/esm/html/data-element.js", "../../../node_modules/linkedom/esm/html/menu-element.js", "../../../node_modules/linkedom/esm/html/select-element.js", "../../../node_modules/linkedom/esm/html/br-element.js", "../../../node_modules/linkedom/esm/html/button-element.js", "../../../node_modules/linkedom/esm/html/map-element.js", "../../../node_modules/linkedom/esm/html/opt-group-element.js", "../../../node_modules/linkedom/esm/html/d-list-element.js", "../../../node_modules/linkedom/esm/html/text-area-element.js", "../../../node_modules/linkedom/esm/html/font-element.js", "../../../node_modules/linkedom/esm/html/div-element.js", "../../../node_modules/linkedom/esm/html/link-element.js", "../../../node_modules/linkedom/esm/html/slot-element.js", "../../../node_modules/linkedom/esm/html/form-element.js", "../../../node_modules/linkedom/esm/html/image-element.js", "../../../node_modules/linkedom/esm/html/pre-element.js", "../../../node_modules/linkedom/esm/html/u-list-element.js", "../../../node_modules/linkedom/esm/html/meta-element.js", "../../../node_modules/linkedom/esm/html/picture-element.js", "../../../node_modules/linkedom/esm/html/area-element.js", "../../../node_modules/linkedom/esm/html/o-list-element.js", "../../../node_modules/linkedom/esm/html/table-caption-element.js", "../../../node_modules/linkedom/esm/html/anchor-element.js", "../../../node_modules/linkedom/esm/html/label-element.js", "../../../node_modules/linkedom/esm/html/unknown-element.js", "../../../node_modules/linkedom/esm/html/mod-element.js", "../../../node_modules/linkedom/esm/html/details-element.js", "../../../node_modules/linkedom/esm/html/source-element.js", "../../../node_modules/linkedom/esm/html/track-element.js", "../../../node_modules/linkedom/esm/html/marquee-element.js", "../../../node_modules/linkedom/esm/shared/html-classes.js", "../../../node_modules/linkedom/esm/shared/mime.js", "../../../node_modules/linkedom/esm/interface/custom-event.js", "../../../node_modules/linkedom/esm/interface/input-event.js", "../../../node_modules/linkedom/esm/interface/image.js", "../../../node_modules/linkedom/esm/interface/range.js", "../../../node_modules/linkedom/esm/interface/tree-walker.js", "../../../node_modules/linkedom/esm/html/document.js", "../../../node_modules/linkedom/esm/svg/document.js", "../../../node_modules/linkedom/esm/xml/document.js", "../../../node_modules/linkedom/esm/dom/parser.js", "../../../node_modules/linkedom/esm/shared/parse-json.js", "../../../node_modules/linkedom/esm/index.js", "../../../src/html-to-pdf.ts", "../../../src/types/fonts.ts", "../../../src/logging/debug.ts", "../../../src/html/css/parse-css.ts", "../../../src/css/selectors/parser.ts", "../../../src/css/selectors/simple-key.ts", "../../../src/css/selectors/matcher.ts", "../../../src/css/viewport.ts", "../../../src/css/length.ts", "../../../src/css/parsers/length-parser.ts", "../../../src/units/units.ts", "../../../src/css/line-height.ts", "../../../src/css/unit-conversion.ts", "../../../src/css/ua-defaults/base-defaults.ts", "../../../src/css/ua-defaults/element-defaults.ts", "../../../src/css/ua-defaults/browser-defaults.ts", "../../../src/css/custom-properties.ts", "../../../src/css/style.ts", "../../../src/geometry/box.ts", "../../../src/dom/node.ts", "../../../src/layout/context/layout-environment.ts", "../../../src/layout/pipeline/context-factory.ts", "../../../src/css/font-weight.ts", "../../../src/pdf/font/base14/widths-times-roman.ts", "../../../src/pdf/font/base14/widths-times-bold.ts", "../../../src/pdf/font/base14/widths-helvetica.ts", "../../../src/pdf/font/base14/widths-helvetica-bold.ts", "../../../src/pdf/font/base14/widths-courier.ts", "../../../src/pdf/font/base14/widths-courier-bold.ts", "../../../src/pdf/font/base14-widths.ts", "../../../src/text/text-transform.ts", "../../../src/layout/utils/text-metrics.ts", "../../../src/layout/pipeline/text-metrics-initializer.ts", "../../../src/layout/utils/node-math.ts", "../../../src/layout/pipeline/out-of-flow-manager.ts", "../../../src/layout/pipeline/engine.ts", "../../../src/layout/strategies/display-none.ts", "../../../src/layout/utils/margin.ts", "../../../src/layout/utils/overflow.ts", "../../../src/layout/context/float-context.ts", "../../../src/layout/utils/floats.ts", "../../../src/layout/inline/types.ts", "../../../src/pdf/font/ttf-lite.ts", "../../../src/pdf/font/ttf-table-parser.ts", "../../../src/pdf/font/ttf-global-metrics.ts", "../../../src/pdf/font/ttf-glyph-metrics.ts", "../../../src/pdf/font/ttf-cmap.ts", "../../../src/pdf/font/loca-reader.ts", "../../../src/pdf/font/simple-glyph-parser.ts", "../../../src/pdf/font/transformation-matrix.ts", "../../../src/pdf/font/composite-glyph-parser.ts", "../../../src/pdf/font/ttf-glyf.ts", "../../../src/fonts/detector.ts", "../../../src/fonts/utils/ttf-reconstructor.ts", "../../../src/pdf/font/widths.ts", "../../../src/pdf/font/to-unicode.ts", "../../../src/pdf/font/font-config.ts", "../../../src/pdf/font/embedder.ts", "../../../src/layout/inline/measurement.ts", "../../../src/layout/inline/tokenizer.ts", "../../../src/layout/inline/inline-utils.ts", "../../../src/layout/inline/text-alignment.ts", "../../../src/layout/inline/bounding-box-calculator.ts", "../../../src/layout/inline/font-baseline-calculator.ts", "../../../src/layout/inline/run-placer.ts", "../../../src/layout/debug.ts", "../../../src/layout/inline/layout.ts", "../../../src/layout/utils/inline-formatter.ts", "../../../src/layout/utils/display-utils.ts", "../../../src/layout/utils/content-measurer.ts", "../../../src/layout/strategies/block.ts", "../../../src/layout/utils/gap-calculator.ts", "../../../src/layout/strategies/flex.ts", "../../../src/layout/strategies/grid.ts", "../../../src/text/line-breaker.ts", "../../../src/layout/table/cell_layout.ts", "../../../src/layout/table/diagnostics.ts", "../../../src/layout/strategies/table.ts", "../../../src/layout/strategies/fallback.ts", "../../../src/layout/strategies/inline.ts", "../../../src/layout/strategies/image.ts", "../../../src/layout/pipeline/default-engine.ts", "../../../src/layout/pipeline/layout-tree.ts", "../../../src/css/named-colors.ts", "../../../src/pdf/utils/color-utils.ts", "../../../src/pdf/utils/text-alignment-resolver.ts", "../../../src/pdf/utils/border-radius-utils.ts", "../../../src/pdf/utils/shadow-utils.ts", "../../../src/pdf/utils/image-utils.ts", "../../../src/pdf/utils/box-dimensions-utils.ts", "../../../src/pdf/utils/text-decoration-utils.ts", "../../../src/pdf/utils/background-layer-resolver.ts", "../../../src/pdf/utils/clip-path-resolver.ts", "../../../src/geometry/matrix.ts", "../../../src/transform/css-parser.ts", "../../../src/pdf/utils/text-utils.ts", "../../../src/pdf/utils/list-utils.ts", "../../../src/pdf/transform-adapter.ts", "../../../src/pdf/utils/node-text-run-factory.ts", "../../../src/pdf/layout-tree-builder.ts", "../../../src/pdf/primitives/pdf-reference-manager.ts", "../../../src/pdf/primitives/pdf-resource-registries.ts", "../../../src/pdf/utils/encoding.ts", "../../../src/pdf/primitives/pdf-bytes.ts", "../../../src/pdf/primitives/pdf-serializers.ts", "../../../src/pdf/primitives/pdf-builder.ts", "../../../src/pdf/primitives/pdf-document.ts", "../../../src/pdf/header-footer-layout.ts", "../../../src/pdf/header-footer-tokens.ts", "../../../src/css/parsers/registry.ts", "../../../src/css/parsers/flex-parser.ts", "../../../src/css/parsers/display-flex-parser.ts", "../../../src/css/parsers/color-parser.ts", "../../../src/css/utils.ts", "../../../src/css/parsers/border-parser.ts", "../../../src/css/parsers/box-shadow-parser.ts", "../../../src/css/shorthands/border-shorthand.ts", "../../../src/css/shorthands/box-shorthand.ts", "../../../src/css/parsers/border-parser-extended.ts", "../../../src/css/parsers/border-block-parser.ts", "../../../src/css/parsers/border-inline-parser.ts", "../../../src/css/parsers/margin-parser.ts", "../../../src/css/parsers/margin-block-parser.ts", "../../../src/css/parsers/margin-inline-parser.ts", "../../../src/css/parsers/padding-parser.ts", "../../../src/css/parsers/padding-block-parser.ts", "../../../src/css/parsers/padding-inline-parser.ts", "../../../src/css/parsers/dimension-parser.ts", "../../../src/css/parsers/font-parser.ts", "../../../src/css/parsers/position-parser.ts", "../../../src/css/parsers/text-parser.ts", "../../../src/css/parsers/text-parser-extended.ts", "../../../src/css/parsers/overflow-wrap-parser.ts", "../../../src/css/parsers/text-shadow-parser.ts", "../../../src/css/parsers/list-style-parser.ts", "../../../src/css/parsers/gradient-parser.ts", "../../../src/css/parsers/background-parser.ts", "../../../src/css/parsers/background-parser-extended.ts", "../../../src/css/parsers/clip-path-parser.ts", "../../../src/css/parsers/grid-parser.ts", "../../../src/css/parsers/grid-parser-extended.ts", "../../../src/css/parsers/opacity-parser.ts", "../../../src/css/parsers/register-parsers.ts", "../../../src/css/apply-declarations.ts", "../../../src/css/inline-style-parser.ts", "../../../src/css/style-inheritance.ts", "../../../src/css/css-unit-resolver.ts", "../../../src/css/layout-property-resolver.ts", "../../../src/css/compute-style.ts", "../../../src/html/image-converter.ts", "../../../src/image/base-decoder.ts", "../../../src/image/jpeg-decoder.ts", "../../../src/image/png-decoder.ts", "../../../src/image/webp-riff-parser.ts", "../../../src/image/webp-huffman.ts", "../../../src/image/webp-vp8l-decoder.ts", "../../../src/image/webp-decoder.ts", "../../../src/environment/node-environment.browser.ts", "../../../src/image/image-service.ts", "../../../src/utils/base64.ts", "../../../src/svg/parser-registry.ts", "../../../src/svg/parser.ts", "../../../src/html/dom-converter.ts", "../../../src/render/offset.ts", "../../../src/fonts/font-registry-resolver.ts", "../../../src/pdf/utils/drop-shadow-raster.ts", "../../../src/pdf/renderer/radius.ts", "../../../src/pdf/renderer/paint-box-shadows.ts", "../../../src/svg/path-data.ts", "../../../src/pdf/svg/geometry-builder.ts", "../../../src/pdf/svg/coordinate-mapper.ts", "../../../src/pdf/svg/style-computer.ts", "../../../src/pdf/svg/shape-renderer.ts", "../../../src/pdf/svg/aspect-ratio.ts", "../../../src/pdf/svg/render-svg.ts", "../../../src/pdf/utils/background-tiles.ts", "../../../src/pdf/utils/border-dashes.ts", "../../../src/pdf/renderer/box-painter.ts", "../../../src/pdf/header-footer-renderer.ts", "../../../src/pdf/header-footer-painter.ts", "../../../src/pdf/stacking/build-stacking-contexts.ts", "../../../src/pdf/stacking/resolve-paint-order.ts", "../../../src/pdf/pagination.ts", "../../../src/text/text.ts", "../../../src/pdf/font/font-subset.ts", "../../../src/pdf/font-subset/font-registry.ts", "../../../src/css/font-face-parser.ts", "../../../src/pdf/font/resolvers/weight-style-applicator.ts", "../../../src/pdf/font/resolvers/family-resolver.ts", "../../../src/pdf/font/resolvers/base-font-mapper.ts", "../../../src/pdf/font/managers/font-resource-manager.ts", "../../../src/pdf/font/managers/subset-resource-manager.ts", "../../../src/pdf/font/font-registry.ts", "../../../src/pdf/utils/coordinate-transformer.ts", "../../../src/pdf/renderers/text-renderer-utils.ts", "../../../src/pdf/font/rasterizer.ts", "../../../src/pdf/font/glyph-cache.ts", "../../../src/pdf/font/blur.ts", "../../../src/pdf/renderers/text-shadow-renderer.ts", "../../../src/pdf/renderers/text-decoration-renderer.ts", "../../../src/pdf/renderers/text-font-resolver.ts", "../../../src/pdf/renderers/text-encoder.ts", "../../../src/pdf/utils/glyph-run-renderer.ts", "../../../src/pdf/shading/gradient-service.ts", "../../../src/pdf/renderers/shape-utils.ts", "../../../src/pdf/renderers/text-renderer.ts", "../../../src/pdf/renderers/image-renderer.ts", "../../../src/pdf/renderers/radius-utils.ts", "../../../src/pdf/renderers/rounded-rect-path.ts", "../../../src/pdf/renderers/shape-renderer.ts", "../../../src/pdf/renderers/graphics-state-manager.ts", "../../../src/pdf/utils/clipping-path-builder.ts", "../../../src/pdf/utils/image-matrix-builder.ts", "../../../src/pdf/utils/transform-scope-manager.ts", "../../../src/pdf/utils/glyph-atlas-registrar.ts", "../../../src/pdf/utils/image-command-partitioner.ts", "../../../src/pdf/utils/result-combiner.ts", "../../../src/pdf/page-painter.ts", "../../../src/pdf/renderer/page-paint.ts", "../../../src/pdf/font/builtin-fonts.browser.ts", "../../../src/pdf/utils/page-resource-registrar.ts", "../../../src/pdf/render.ts", "../../../src/pdf/utils/text-layout-adjuster.ts", "../../../src/units/page-utils.ts", "../../../src/browser-entry.ts"],
  "sourcesContent": ["/* c8 ignore start */\ntry {\n  const {performance} = require('perf_hooks');\n  exports.performance = performance;\n}\ncatch (fallback) {\n  exports.performance = {now() { return +new Date; }};\n}\n/* c8 ignore stop */\n", "module.exports = {\n\ttrueFunc: function trueFunc(){\n\t\treturn true;\n\t},\n\tfalseFunc: function falseFunc(){\n\t\treturn false;\n\t}\n};", "//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#the-stylesheet-interface\n */\nCSSOM.StyleSheet = function StyleSheet() {\n\tthis.parentStyleSheet = null;\n};\n\n\n//.CommonJS\nexports.StyleSheet = CSSOM.StyleSheet;\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#the-cssrule-interface\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSRule\n */\nCSSOM.CSSRule = function CSSRule() {\n\tthis.parentRule = null;\n\tthis.parentStyleSheet = null;\n};\n\nCSSOM.CSSRule.UNKNOWN_RULE = 0;                 // obsolete\nCSSOM.CSSRule.STYLE_RULE = 1;\nCSSOM.CSSRule.CHARSET_RULE = 2;                 // obsolete\nCSSOM.CSSRule.IMPORT_RULE = 3;\nCSSOM.CSSRule.MEDIA_RULE = 4;\nCSSOM.CSSRule.FONT_FACE_RULE = 5;\nCSSOM.CSSRule.PAGE_RULE = 6;\nCSSOM.CSSRule.KEYFRAMES_RULE = 7;\nCSSOM.CSSRule.KEYFRAME_RULE = 8;\nCSSOM.CSSRule.MARGIN_RULE = 9;\nCSSOM.CSSRule.NAMESPACE_RULE = 10;\nCSSOM.CSSRule.COUNTER_STYLE_RULE = 11;\nCSSOM.CSSRule.SUPPORTS_RULE = 12;\nCSSOM.CSSRule.DOCUMENT_RULE = 13;\nCSSOM.CSSRule.FONT_FEATURE_VALUES_RULE = 14;\nCSSOM.CSSRule.VIEWPORT_RULE = 15;\nCSSOM.CSSRule.REGION_STYLE_RULE = 16;\n\n\nCSSOM.CSSRule.prototype = {\n\tconstructor: CSSOM.CSSRule\n\t//FIXME\n};\n\n\n//.CommonJS\nexports.CSSRule = CSSOM.CSSRule;\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {\n\tCSSStyleDeclaration: require(\"./CSSStyleDeclaration\").CSSStyleDeclaration,\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#cssstylerule\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleRule\n */\nCSSOM.CSSStyleRule = function CSSStyleRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.selectorText = \"\";\n\tthis.style = new CSSOM.CSSStyleDeclaration();\n\tthis.style.parentRule = this;\n};\n\nCSSOM.CSSStyleRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSStyleRule.prototype.constructor = CSSOM.CSSStyleRule;\nCSSOM.CSSStyleRule.prototype.type = 1;\n\nObject.defineProperty(CSSOM.CSSStyleRule.prototype, \"cssText\", {\n\tget: function() {\n\t\tvar text;\n\t\tif (this.selectorText) {\n\t\t\ttext = this.selectorText + \" {\" + this.style.cssText + \"}\";\n\t\t} else {\n\t\t\ttext = \"\";\n\t\t}\n\t\treturn text;\n\t},\n\tset: function(cssText) {\n\t\tvar rule = CSSOM.CSSStyleRule.parse(cssText);\n\t\tthis.style = rule.style;\n\t\tthis.selectorText = rule.selectorText;\n\t}\n});\n\n\n/**\n * NON-STANDARD\n * lightweight version of parse.js.\n * @param {string} ruleText\n * @return CSSStyleRule\n */\nCSSOM.CSSStyleRule.parse = function(ruleText) {\n\tvar i = 0;\n\tvar state = \"selector\";\n\tvar index;\n\tvar j = i;\n\tvar buffer = \"\";\n\n\tvar SIGNIFICANT_WHITESPACE = {\n\t\t\"selector\": true,\n\t\t\"value\": true\n\t};\n\n\tvar styleRule = new CSSOM.CSSStyleRule();\n\tvar name, priority=\"\";\n\n\tfor (var character; (character = ruleText.charAt(i)); i++) {\n\n\t\tswitch (character) {\n\n\t\tcase \" \":\n\t\tcase \"\\t\":\n\t\tcase \"\\r\":\n\t\tcase \"\\n\":\n\t\tcase \"\\f\":\n\t\t\tif (SIGNIFICANT_WHITESPACE[state]) {\n\t\t\t\t// Squash 2 or more white-spaces in the row into 1\n\t\t\t\tswitch (ruleText.charAt(i - 1)) {\n\t\t\t\t\tcase \" \":\n\t\t\t\t\tcase \"\\t\":\n\t\t\t\t\tcase \"\\r\":\n\t\t\t\t\tcase \"\\n\":\n\t\t\t\t\tcase \"\\f\":\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbuffer += \" \";\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// String\n\t\tcase '\"':\n\t\t\tj = i + 1;\n\t\t\tindex = ruleText.indexOf('\"', j) + 1;\n\t\t\tif (!index) {\n\t\t\t\tthrow '\" is missing';\n\t\t\t}\n\t\t\tbuffer += ruleText.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tbreak;\n\n\t\tcase \"'\":\n\t\t\tj = i + 1;\n\t\t\tindex = ruleText.indexOf(\"'\", j) + 1;\n\t\t\tif (!index) {\n\t\t\t\tthrow \"' is missing\";\n\t\t\t}\n\t\t\tbuffer += ruleText.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tbreak;\n\n\t\t// Comment\n\t\tcase \"/\":\n\t\t\tif (ruleText.charAt(i + 1) === \"*\") {\n\t\t\t\ti += 2;\n\t\t\t\tindex = ruleText.indexOf(\"*/\", i);\n\t\t\t\tif (index === -1) {\n\t\t\t\t\tthrow new SyntaxError(\"Missing */\");\n\t\t\t\t} else {\n\t\t\t\t\ti = index + 1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"{\":\n\t\t\tif (state === \"selector\") {\n\t\t\t\tstyleRule.selectorText = buffer.trim();\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"name\";\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \":\":\n\t\t\tif (state === \"name\") {\n\t\t\t\tname = buffer.trim();\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"value\";\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"!\":\n\t\t\tif (state === \"value\" && ruleText.indexOf(\"!important\", i) === i) {\n\t\t\t\tpriority = \"important\";\n\t\t\t\ti += \"important\".length;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \";\":\n\t\t\tif (state === \"value\") {\n\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\tpriority = \"\";\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"name\";\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"}\":\n\t\t\tif (state === \"value\") {\n\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\tpriority = \"\";\n\t\t\t\tbuffer = \"\";\n\t\t\t} else if (state === \"name\") {\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tstate = \"selector\";\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\n\t\t}\n\t}\n\n\treturn styleRule;\n\n};\n\n\n//.CommonJS\nexports.CSSStyleRule = CSSOM.CSSStyleRule;\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {\n\tStyleSheet: require(\"./StyleSheet\").StyleSheet,\n\tCSSStyleRule: require(\"./CSSStyleRule\").CSSStyleRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleSheet\n */\nCSSOM.CSSStyleSheet = function CSSStyleSheet() {\n\tCSSOM.StyleSheet.call(this);\n\tthis.cssRules = [];\n};\n\n\nCSSOM.CSSStyleSheet.prototype = new CSSOM.StyleSheet();\nCSSOM.CSSStyleSheet.prototype.constructor = CSSOM.CSSStyleSheet;\n\n\n/**\n * Used to insert a new rule into the style sheet. The new rule now becomes part of the cascade.\n *\n *   sheet = new Sheet(\"body {margin: 0}\")\n *   sheet.toString()\n *   -> \"body{margin:0;}\"\n *   sheet.insertRule(\"img {border: none}\", 0)\n *   -> 0\n *   sheet.toString()\n *   -> \"img{border:none;}body{margin:0;}\"\n *\n * @param {string} rule\n * @param {number} index\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleSheet-insertRule\n * @return {number} The index within the style sheet's rule collection of the newly inserted rule.\n */\nCSSOM.CSSStyleSheet.prototype.insertRule = function(rule, index) {\n\tif (index < 0 || index > this.cssRules.length) {\n\t\tthrow new RangeError(\"INDEX_SIZE_ERR\");\n\t}\n\tvar cssRule = CSSOM.parse(rule).cssRules[0];\n\tcssRule.parentStyleSheet = this;\n\tthis.cssRules.splice(index, 0, cssRule);\n\treturn index;\n};\n\n\n/**\n * Used to delete a rule from the style sheet.\n *\n *   sheet = new Sheet(\"img{border:none} body{margin:0}\")\n *   sheet.toString()\n *   -> \"img{border:none;}body{margin:0;}\"\n *   sheet.deleteRule(0)\n *   sheet.toString()\n *   -> \"body{margin:0;}\"\n *\n * @param {number} index within the style sheet's rule list of the rule to remove.\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleSheet-deleteRule\n */\nCSSOM.CSSStyleSheet.prototype.deleteRule = function(index) {\n\tif (index < 0 || index >= this.cssRules.length) {\n\t\tthrow new RangeError(\"INDEX_SIZE_ERR\");\n\t}\n\tthis.cssRules.splice(index, 1);\n};\n\n\n/**\n * NON-STANDARD\n * @return {string} serialize stylesheet\n */\nCSSOM.CSSStyleSheet.prototype.toString = function() {\n\tvar result = \"\";\n\tvar rules = this.cssRules;\n\tfor (var i=0; i<rules.length; i++) {\n\t\tresult += rules[i].cssText + \"\\n\";\n\t}\n\treturn result;\n};\n\n\n//.CommonJS\nexports.CSSStyleSheet = CSSOM.CSSStyleSheet;\nCSSOM.parse = require('./parse').parse; // Cannot be included sooner due to the mutual dependency between parse.js and CSSStyleSheet.js\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#the-medialist-interface\n */\nCSSOM.MediaList = function MediaList(){\n\tthis.length = 0;\n};\n\nCSSOM.MediaList.prototype = {\n\n\tconstructor: CSSOM.MediaList,\n\n\t/**\n\t * @return {string}\n\t */\n\tget mediaText() {\n\t\treturn Array.prototype.join.call(this, \", \");\n\t},\n\n\t/**\n\t * @param {string} value\n\t */\n\tset mediaText(value) {\n\t\tvar values = value.split(\",\");\n\t\tvar length = this.length = values.length;\n\t\tfor (var i=0; i<length; i++) {\n\t\t\tthis[i] = values[i].trim();\n\t\t}\n\t},\n\n\t/**\n\t * @param {string} medium\n\t */\n\tappendMedium: function(medium) {\n\t\tif (Array.prototype.indexOf.call(this, medium) === -1) {\n\t\t\tthis[this.length] = medium;\n\t\t\tthis.length++;\n\t\t}\n\t},\n\n\t/**\n\t * @param {string} medium\n\t */\n\tdeleteMedium: function(medium) {\n\t\tvar index = Array.prototype.indexOf.call(this, medium);\n\t\tif (index !== -1) {\n\t\t\tArray.prototype.splice.call(this, index, 1);\n\t\t}\n\t}\n\n};\n\n\n//.CommonJS\nexports.MediaList = CSSOM.MediaList;\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tCSSStyleSheet: require(\"./CSSStyleSheet\").CSSStyleSheet,\n\tMediaList: require(\"./MediaList\").MediaList\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#cssimportrule\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSImportRule\n */\nCSSOM.CSSImportRule = function CSSImportRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.href = \"\";\n\tthis.media = new CSSOM.MediaList();\n\tthis.styleSheet = new CSSOM.CSSStyleSheet();\n};\n\nCSSOM.CSSImportRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSImportRule.prototype.constructor = CSSOM.CSSImportRule;\nCSSOM.CSSImportRule.prototype.type = 3;\n\nObject.defineProperty(CSSOM.CSSImportRule.prototype, \"cssText\", {\n  get: function() {\n    var mediaText = this.media.mediaText;\n    return \"@import url(\" + this.href + \")\" + (mediaText ? \" \" + mediaText : \"\") + \";\";\n  },\n  set: function(cssText) {\n    var i = 0;\n\n    /**\n     * @import url(partial.css) screen, handheld;\n     *        ||               |\n     *        after-import     media\n     *         |\n     *         url\n     */\n    var state = '';\n\n    var buffer = '';\n    var index;\n    for (var character; (character = cssText.charAt(i)); i++) {\n\n      switch (character) {\n        case ' ':\n        case '\\t':\n        case '\\r':\n        case '\\n':\n        case '\\f':\n          if (state === 'after-import') {\n            state = 'url';\n          } else {\n            buffer += character;\n          }\n          break;\n\n        case '@':\n          if (!state && cssText.indexOf('@import', i) === i) {\n            state = 'after-import';\n            i += 'import'.length;\n            buffer = '';\n          }\n          break;\n\n        case 'u':\n          if (state === 'url' && cssText.indexOf('url(', i) === i) {\n            index = cssText.indexOf(')', i + 1);\n            if (index === -1) {\n              throw i + ': \")\" not found';\n            }\n            i += 'url('.length;\n            var url = cssText.slice(i, index);\n            if (url[0] === url[url.length - 1]) {\n              if (url[0] === '\"' || url[0] === \"'\") {\n                url = url.slice(1, -1);\n              }\n            }\n            this.href = url;\n            i = index;\n            state = 'media';\n          }\n          break;\n\n        case '\"':\n          if (state === 'url') {\n            index = cssText.indexOf('\"', i + 1);\n            if (!index) {\n              throw i + \": '\\\"' not found\";\n            }\n            this.href = cssText.slice(i + 1, index);\n            i = index;\n            state = 'media';\n          }\n          break;\n\n        case \"'\":\n          if (state === 'url') {\n            index = cssText.indexOf(\"'\", i + 1);\n            if (!index) {\n              throw i + ': \"\\'\" not found';\n            }\n            this.href = cssText.slice(i + 1, index);\n            i = index;\n            state = 'media';\n          }\n          break;\n\n        case ';':\n          if (state === 'media') {\n            if (buffer) {\n              this.media.mediaText = buffer.trim();\n            }\n          }\n          break;\n\n        default:\n          if (state === 'media') {\n            buffer += character;\n          }\n          break;\n      }\n    }\n  }\n});\n\n\n//.CommonJS\nexports.CSSImportRule = CSSOM.CSSImportRule;\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see https://drafts.csswg.org/cssom/#the-cssgroupingrule-interface\n */\nCSSOM.CSSGroupingRule = function CSSGroupingRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.cssRules = [];\n};\n\nCSSOM.CSSGroupingRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSGroupingRule.prototype.constructor = CSSOM.CSSGroupingRule;\n\n\n/**\n * Used to insert a new CSS rule to a list of CSS rules.\n *\n * @example\n *   cssGroupingRule.cssText\n *   -> \"body{margin:0;}\"\n *   cssGroupingRule.insertRule(\"img{border:none;}\", 1)\n *   -> 1\n *   cssGroupingRule.cssText\n *   -> \"body{margin:0;}img{border:none;}\"\n *\n * @param {string} rule\n * @param {number} [index]\n * @see https://www.w3.org/TR/cssom-1/#dom-cssgroupingrule-insertrule\n * @return {number} The index within the grouping rule's collection of the newly inserted rule.\n */\n CSSOM.CSSGroupingRule.prototype.insertRule = function insertRule(rule, index) {\n\tif (index < 0 || index > this.cssRules.length) {\n\t\tthrow new RangeError(\"INDEX_SIZE_ERR\");\n\t}\n\tvar cssRule = CSSOM.parse(rule).cssRules[0];\n\tcssRule.parentRule = this;\n\tthis.cssRules.splice(index, 0, cssRule);\n\treturn index;\n};\n\n/**\n * Used to delete a rule from the grouping rule.\n *\n *   cssGroupingRule.cssText\n *   -> \"img{border:none;}body{margin:0;}\"\n *   cssGroupingRule.deleteRule(0)\n *   cssGroupingRule.cssText\n *   -> \"body{margin:0;}\"\n *\n * @param {number} index within the grouping rule's rule list of the rule to remove.\n * @see https://www.w3.org/TR/cssom-1/#dom-cssgroupingrule-deleterule\n */\n CSSOM.CSSGroupingRule.prototype.deleteRule = function deleteRule(index) {\n\tif (index < 0 || index >= this.cssRules.length) {\n\t\tthrow new RangeError(\"INDEX_SIZE_ERR\");\n\t}\n\tthis.cssRules.splice(index, 1)[0].parentRule = null;\n};\n\n//.CommonJS\nexports.CSSGroupingRule = CSSOM.CSSGroupingRule;\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {\n  CSSRule: require(\"./CSSRule\").CSSRule,\n  CSSGroupingRule: require(\"./CSSGroupingRule\").CSSGroupingRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see https://www.w3.org/TR/css-conditional-3/#the-cssconditionrule-interface\n */\nCSSOM.CSSConditionRule = function CSSConditionRule() {\n  CSSOM.CSSGroupingRule.call(this);\n  this.cssRules = [];\n};\n\nCSSOM.CSSConditionRule.prototype = new CSSOM.CSSGroupingRule();\nCSSOM.CSSConditionRule.prototype.constructor = CSSOM.CSSConditionRule;\nCSSOM.CSSConditionRule.prototype.conditionText = ''\nCSSOM.CSSConditionRule.prototype.cssText = ''\n\n//.CommonJS\nexports.CSSConditionRule = CSSOM.CSSConditionRule;\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tCSSGroupingRule: require(\"./CSSGroupingRule\").CSSGroupingRule,\n\tCSSConditionRule: require(\"./CSSConditionRule\").CSSConditionRule,\n\tMediaList: require(\"./MediaList\").MediaList\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#cssmediarule\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSMediaRule\n */\nCSSOM.CSSMediaRule = function CSSMediaRule() {\n\tCSSOM.CSSConditionRule.call(this);\n\tthis.media = new CSSOM.MediaList();\n};\n\nCSSOM.CSSMediaRule.prototype = new CSSOM.CSSConditionRule();\nCSSOM.CSSMediaRule.prototype.constructor = CSSOM.CSSMediaRule;\nCSSOM.CSSMediaRule.prototype.type = 4;\n\n// https://opensource.apple.com/source/WebCore/WebCore-7611.1.21.161.3/css/CSSMediaRule.cpp\nObject.defineProperties(CSSOM.CSSMediaRule.prototype, {\n  \"conditionText\": {\n    get: function() {\n      return this.media.mediaText;\n    },\n    set: function(value) {\n      this.media.mediaText = value;\n    },\n    configurable: true,\n    enumerable: true\n  },\n  \"cssText\": {\n    get: function() {\n      var cssTexts = [];\n      for (var i=0, length=this.cssRules.length; i < length; i++) {\n        cssTexts.push(this.cssRules[i].cssText);\n      }\n      return \"@media \" + this.media.mediaText + \" {\" + cssTexts.join(\"\") + \"}\";\n    },\n    configurable: true,\n    enumerable: true\n  }\n});\n\n\n//.CommonJS\nexports.CSSMediaRule = CSSOM.CSSMediaRule;\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {\n  CSSRule: require(\"./CSSRule\").CSSRule,\n  CSSGroupingRule: require(\"./CSSGroupingRule\").CSSGroupingRule,\n  CSSConditionRule: require(\"./CSSConditionRule\").CSSConditionRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see https://drafts.csswg.org/css-conditional-3/#the-csssupportsrule-interface\n */\nCSSOM.CSSSupportsRule = function CSSSupportsRule() {\n  CSSOM.CSSConditionRule.call(this);\n};\n\nCSSOM.CSSSupportsRule.prototype = new CSSOM.CSSConditionRule();\nCSSOM.CSSSupportsRule.prototype.constructor = CSSOM.CSSSupportsRule;\nCSSOM.CSSSupportsRule.prototype.type = 12;\n\nObject.defineProperty(CSSOM.CSSSupportsRule.prototype, \"cssText\", {\n  get: function() {\n    var cssTexts = [];\n\n    for (var i = 0, length = this.cssRules.length; i < length; i++) {\n      cssTexts.push(this.cssRules[i].cssText);\n    }\n\n    return \"@supports \" + this.conditionText + \" {\" + cssTexts.join(\"\") + \"}\";\n  }\n});\n\n//.CommonJS\nexports.CSSSupportsRule = CSSOM.CSSSupportsRule;\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {\n\tCSSStyleDeclaration: require(\"./CSSStyleDeclaration\").CSSStyleDeclaration,\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#css-font-face-rule\n */\nCSSOM.CSSFontFaceRule = function CSSFontFaceRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.style = new CSSOM.CSSStyleDeclaration();\n\tthis.style.parentRule = this;\n};\n\nCSSOM.CSSFontFaceRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSFontFaceRule.prototype.constructor = CSSOM.CSSFontFaceRule;\nCSSOM.CSSFontFaceRule.prototype.type = 5;\n//FIXME\n//CSSOM.CSSFontFaceRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSFontFaceRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://www.opensource.apple.com/source/WebCore/WebCore-955.66.1/css/WebKitCSSFontFaceRule.cpp\nObject.defineProperty(CSSOM.CSSFontFaceRule.prototype, \"cssText\", {\n  get: function() {\n    return \"@font-face {\" + this.style.cssText + \"}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSFontFaceRule = CSSOM.CSSFontFaceRule;\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/shadow-dom/#host-at-rule\n */\nCSSOM.CSSHostRule = function CSSHostRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.cssRules = [];\n};\n\nCSSOM.CSSHostRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSHostRule.prototype.constructor = CSSOM.CSSHostRule;\nCSSOM.CSSHostRule.prototype.type = 1001;\n//FIXME\n//CSSOM.CSSHostRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSHostRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\nObject.defineProperty(CSSOM.CSSHostRule.prototype, \"cssText\", {\n\tget: function() {\n\t\tvar cssTexts = [];\n\t\tfor (var i=0, length=this.cssRules.length; i < length; i++) {\n\t\t\tcssTexts.push(this.cssRules[i].cssText);\n\t\t}\n\t\treturn \"@host {\" + cssTexts.join(\"\") + \"}\";\n\t}\n});\n\n\n//.CommonJS\nexports.CSSHostRule = CSSOM.CSSHostRule;\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tCSSStyleDeclaration: require('./CSSStyleDeclaration').CSSStyleDeclaration\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/css3-animations/#DOM-CSSKeyframeRule\n */\nCSSOM.CSSKeyframeRule = function CSSKeyframeRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.keyText = '';\n\tthis.style = new CSSOM.CSSStyleDeclaration();\n\tthis.style.parentRule = this;\n};\n\nCSSOM.CSSKeyframeRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSKeyframeRule.prototype.constructor = CSSOM.CSSKeyframeRule;\nCSSOM.CSSKeyframeRule.prototype.type = 8;\n//FIXME\n//CSSOM.CSSKeyframeRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSKeyframeRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://www.opensource.apple.com/source/WebCore/WebCore-955.66.1/css/WebKitCSSKeyframeRule.cpp\nObject.defineProperty(CSSOM.CSSKeyframeRule.prototype, \"cssText\", {\n  get: function() {\n    return this.keyText + \" {\" + this.style.cssText + \"} \";\n  }\n});\n\n\n//.CommonJS\nexports.CSSKeyframeRule = CSSOM.CSSKeyframeRule;\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/css3-animations/#DOM-CSSKeyframesRule\n */\nCSSOM.CSSKeyframesRule = function CSSKeyframesRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.name = '';\n\tthis.cssRules = [];\n};\n\nCSSOM.CSSKeyframesRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSKeyframesRule.prototype.constructor = CSSOM.CSSKeyframesRule;\nCSSOM.CSSKeyframesRule.prototype.type = 7;\n//FIXME\n//CSSOM.CSSKeyframesRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSKeyframesRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://www.opensource.apple.com/source/WebCore/WebCore-955.66.1/css/WebKitCSSKeyframesRule.cpp\nObject.defineProperty(CSSOM.CSSKeyframesRule.prototype, \"cssText\", {\n  get: function() {\n    var cssTexts = [];\n    for (var i=0, length=this.cssRules.length; i < length; i++) {\n      cssTexts.push(\"  \" + this.cssRules[i].cssText);\n    }\n    return \"@\" + (this._vendorPrefix || '') + \"keyframes \" + this.name + \" { \\n\" + cssTexts.join(\"\\n\") + \"\\n}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSKeyframesRule = CSSOM.CSSKeyframesRule;\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSValue\n *\n * TODO: add if needed\n */\nCSSOM.CSSValue = function CSSValue() {\n};\n\nCSSOM.CSSValue.prototype = {\n\tconstructor: CSSOM.CSSValue,\n\n\t// @see: http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSValue\n\tset cssText(text) {\n\t\tvar name = this._getConstructorName();\n\n\t\tthrow new Error('DOMException: property \"cssText\" of \"' + name + '\" is readonly and can not be replaced with \"' + text + '\"!');\n\t},\n\n\tget cssText() {\n\t\tvar name = this._getConstructorName();\n\n\t\tthrow new Error('getter \"cssText\" of \"' + name + '\" is not implemented!');\n\t},\n\n\t_getConstructorName: function() {\n\t\tvar s = this.constructor.toString(),\n\t\t\t\tc = s.match(/function\\s([^\\(]+)/),\n\t\t\t\tname = c[1];\n\n\t\treturn name;\n\t}\n};\n\n\n//.CommonJS\nexports.CSSValue = CSSOM.CSSValue;\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {\n\tCSSValue: require('./CSSValue').CSSValue\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://msdn.microsoft.com/en-us/library/ms537634(v=vs.85).aspx\n *\n */\nCSSOM.CSSValueExpression = function CSSValueExpression(token, idx) {\n\tthis._token = token;\n\tthis._idx = idx;\n};\n\nCSSOM.CSSValueExpression.prototype = new CSSOM.CSSValue();\nCSSOM.CSSValueExpression.prototype.constructor = CSSOM.CSSValueExpression;\n\n/**\n * parse css expression() value\n *\n * @return {Object}\n *         - error:\n *         or\n *         - idx:\n *         - expression:\n *\n * Example:\n *\n * .selector {\n *\t\tzoom: expression(documentElement.clientWidth > 1000 ? '1000px' : 'auto');\n * }\n */\nCSSOM.CSSValueExpression.prototype.parse = function() {\n\tvar token = this._token,\n\t\t\tidx = this._idx;\n\n\tvar character = '',\n\t\t\texpression = '',\n\t\t\terror = '',\n\t\t\tinfo,\n\t\t\tparen = [];\n\n\n\tfor (; ; ++idx) {\n\t\tcharacter = token.charAt(idx);\n\n\t\t// end of token\n\t\tif (character === '') {\n\t\t\terror = 'css expression error: unfinished expression!';\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch(character) {\n\t\t\tcase '(':\n\t\t\t\tparen.push(character);\n\t\t\t\texpression += character;\n\t\t\t\tbreak;\n\n\t\t\tcase ')':\n\t\t\t\tparen.pop(character);\n\t\t\t\texpression += character;\n\t\t\t\tbreak;\n\n\t\t\tcase '/':\n\t\t\t\tif ((info = this._parseJSComment(token, idx))) { // comment?\n\t\t\t\t\tif (info.error) {\n\t\t\t\t\t\terror = 'css expression error: unfinished comment in expression!';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tidx = info.idx;\n\t\t\t\t\t\t// ignore the comment\n\t\t\t\t\t}\n\t\t\t\t} else if ((info = this._parseJSRexExp(token, idx))) { // regexp\n\t\t\t\t\tidx = info.idx;\n\t\t\t\t\texpression += info.text;\n\t\t\t\t} else { // other\n\t\t\t\t\texpression += character;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase \"'\":\n\t\t\tcase '\"':\n\t\t\t\tinfo = this._parseJSString(token, idx, character);\n\t\t\t\tif (info) { // string\n\t\t\t\t\tidx = info.idx;\n\t\t\t\t\texpression += info.text;\n\t\t\t\t} else {\n\t\t\t\t\texpression += character;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\texpression += character;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (error) {\n\t\t\tbreak;\n\t\t}\n\n\t\t// end of expression\n\t\tif (paren.length === 0) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tvar ret;\n\tif (error) {\n\t\tret = {\n\t\t\terror: error\n\t\t};\n\t} else {\n\t\tret = {\n\t\t\tidx: idx,\n\t\t\texpression: expression\n\t\t};\n\t}\n\n\treturn ret;\n};\n\n\n/**\n *\n * @return {Object|false}\n *          - idx:\n *          - text:\n *          or\n *          - error:\n *          or\n *          false\n *\n */\nCSSOM.CSSValueExpression.prototype._parseJSComment = function(token, idx) {\n\tvar nextChar = token.charAt(idx + 1),\n\t\t\ttext;\n\n\tif (nextChar === '/' || nextChar === '*') {\n\t\tvar startIdx = idx,\n\t\t\t\tendIdx,\n\t\t\t\tcommentEndChar;\n\n\t\tif (nextChar === '/') { // line comment\n\t\t\tcommentEndChar = '\\n';\n\t\t} else if (nextChar === '*') { // block comment\n\t\t\tcommentEndChar = '*/';\n\t\t}\n\n\t\tendIdx = token.indexOf(commentEndChar, startIdx + 1 + 1);\n\t\tif (endIdx !== -1) {\n\t\t\tendIdx = endIdx + commentEndChar.length - 1;\n\t\t\ttext = token.substring(idx, endIdx + 1);\n\t\t\treturn {\n\t\t\t\tidx: endIdx,\n\t\t\t\ttext: text\n\t\t\t};\n\t\t} else {\n\t\t\tvar error = 'css expression error: unfinished comment in expression!';\n\t\t\treturn {\n\t\t\t\terror: error\n\t\t\t};\n\t\t}\n\t} else {\n\t\treturn false;\n\t}\n};\n\n\n/**\n *\n * @return {Object|false}\n *\t\t\t\t\t- idx:\n *\t\t\t\t\t- text:\n *\t\t\t\t\tor \n *\t\t\t\t\tfalse\n *\n */\nCSSOM.CSSValueExpression.prototype._parseJSString = function(token, idx, sep) {\n\tvar endIdx = this._findMatchedIdx(token, idx, sep),\n\t\t\ttext;\n\n\tif (endIdx === -1) {\n\t\treturn false;\n\t} else {\n\t\ttext = token.substring(idx, endIdx + sep.length);\n\n\t\treturn {\n\t\t\tidx: endIdx,\n\t\t\ttext: text\n\t\t};\n\t}\n};\n\n\n/**\n * parse regexp in css expression\n *\n * @return {Object|false}\n *\t\t\t\t- idx:\n *\t\t\t\t- regExp:\n *\t\t\t\tor \n *\t\t\t\tfalse\n */\n\n/*\n\nall legal RegExp\n \n/a/\n(/a/)\n[/a/]\n[12, /a/]\n\n!/a/\n\n+/a/\n-/a/\n* /a/\n/ /a/\n%/a/\n\n===/a/\n!==/a/\n==/a/\n!=/a/\n>/a/\n>=/a/\n</a/\n<=/a/\n\n&/a/\n|/a/\n^/a/\n~/a/\n<</a/\n>>/a/\n>>>/a/\n\n&&/a/\n||/a/\n?/a/\n=/a/\n,/a/\n\n\t\tdelete /a/\n\t\t\t\tin /a/\ninstanceof /a/\n\t\t\t\tnew /a/\n\t\ttypeof /a/\n\t\t\tvoid /a/\n\n*/\nCSSOM.CSSValueExpression.prototype._parseJSRexExp = function(token, idx) {\n\tvar before = token.substring(0, idx).replace(/\\s+$/, \"\"),\n\t\t\tlegalRegx = [\n\t\t\t\t/^$/,\n\t\t\t\t/\\($/,\n\t\t\t\t/\\[$/,\n\t\t\t\t/\\!$/,\n\t\t\t\t/\\+$/,\n\t\t\t\t/\\-$/,\n\t\t\t\t/\\*$/,\n\t\t\t\t/\\/\\s+/,\n\t\t\t\t/\\%$/,\n\t\t\t\t/\\=$/,\n\t\t\t\t/\\>$/,\n\t\t\t\t/<$/,\n\t\t\t\t/\\&$/,\n\t\t\t\t/\\|$/,\n\t\t\t\t/\\^$/,\n\t\t\t\t/\\~$/,\n\t\t\t\t/\\?$/,\n\t\t\t\t/\\,$/,\n\t\t\t\t/delete$/,\n\t\t\t\t/in$/,\n\t\t\t\t/instanceof$/,\n\t\t\t\t/new$/,\n\t\t\t\t/typeof$/,\n\t\t\t\t/void$/\n\t\t\t];\n\n\tvar isLegal = legalRegx.some(function(reg) {\n\t\treturn reg.test(before);\n\t});\n\n\tif (!isLegal) {\n\t\treturn false;\n\t} else {\n\t\tvar sep = '/';\n\n\t\t// same logic as string\n\t\treturn this._parseJSString(token, idx, sep);\n\t}\n};\n\n\n/**\n *\n * find next sep(same line) index in `token`\n *\n * @return {Number}\n *\n */\nCSSOM.CSSValueExpression.prototype._findMatchedIdx = function(token, idx, sep) {\n\tvar startIdx = idx,\n\t\t\tendIdx;\n\n\tvar NOT_FOUND = -1;\n\n\twhile(true) {\n\t\tendIdx = token.indexOf(sep, startIdx + 1);\n\n\t\tif (endIdx === -1) { // not found\n\t\t\tendIdx = NOT_FOUND;\n\t\t\tbreak;\n\t\t} else {\n\t\t\tvar text = token.substring(idx + 1, endIdx),\n\t\t\t\t\tmatched = text.match(/\\\\+$/);\n\t\t\tif (!matched || matched[0] % 2 === 0) { // not escaped\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tstartIdx = endIdx;\n\t\t\t}\n\t\t}\n\t}\n\n\t// boundary must be in the same line(js sting or regexp)\n\tvar nextNewLineIdx = token.indexOf('\\n', idx + 1);\n\tif (nextNewLineIdx < endIdx) {\n\t\tendIdx = NOT_FOUND;\n\t}\n\n\n\treturn endIdx;\n};\n\n\n\n\n//.CommonJS\nexports.CSSValueExpression = CSSOM.CSSValueExpression;\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see https://developer.mozilla.org/en/CSS/@-moz-document\n */\nCSSOM.MatcherList = function MatcherList(){\n    this.length = 0;\n};\n\nCSSOM.MatcherList.prototype = {\n\n    constructor: CSSOM.MatcherList,\n\n    /**\n     * @return {string}\n     */\n    get matcherText() {\n        return Array.prototype.join.call(this, \", \");\n    },\n\n    /**\n     * @param {string} value\n     */\n    set matcherText(value) {\n        // just a temporary solution, actually it may be wrong by just split the value with ',', because a url can include ','.\n        var values = value.split(\",\");\n        var length = this.length = values.length;\n        for (var i=0; i<length; i++) {\n            this[i] = values[i].trim();\n        }\n    },\n\n    /**\n     * @param {string} matcher\n     */\n    appendMatcher: function(matcher) {\n        if (Array.prototype.indexOf.call(this, matcher) === -1) {\n            this[this.length] = matcher;\n            this.length++;\n        }\n    },\n\n    /**\n     * @param {string} matcher\n     */\n    deleteMatcher: function(matcher) {\n        var index = Array.prototype.indexOf.call(this, matcher);\n        if (index !== -1) {\n            Array.prototype.splice.call(this, index, 1);\n        }\n    }\n\n};\n\n\n//.CommonJS\nexports.MatcherList = CSSOM.MatcherList;\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {\n    CSSRule: require(\"./CSSRule\").CSSRule,\n    MatcherList: require(\"./MatcherList\").MatcherList\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see https://developer.mozilla.org/en/CSS/@-moz-document\n */\nCSSOM.CSSDocumentRule = function CSSDocumentRule() {\n    CSSOM.CSSRule.call(this);\n    this.matcher = new CSSOM.MatcherList();\n    this.cssRules = [];\n};\n\nCSSOM.CSSDocumentRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSDocumentRule.prototype.constructor = CSSOM.CSSDocumentRule;\nCSSOM.CSSDocumentRule.prototype.type = 10;\n//FIXME\n//CSSOM.CSSDocumentRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSDocumentRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\nObject.defineProperty(CSSOM.CSSDocumentRule.prototype, \"cssText\", {\n  get: function() {\n    var cssTexts = [];\n    for (var i=0, length=this.cssRules.length; i < length; i++) {\n        cssTexts.push(this.cssRules[i].cssText);\n    }\n    return \"@-moz-document \" + this.matcher.matcherText + \" {\" + cssTexts.join(\"\") + \"}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSDocumentRule = CSSOM.CSSDocumentRule;\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @param {string} token\n */\nCSSOM.parse = function parse(token) {\n\n\tvar i = 0;\n\n\t/**\n\t\t\"before-selector\" or\n\t\t\"selector\" or\n\t\t\"atRule\" or\n\t\t\"atBlock\" or\n\t\t\"conditionBlock\" or\n\t\t\"before-name\" or\n\t\t\"name\" or\n\t\t\"before-value\" or\n\t\t\"value\"\n\t*/\n\tvar state = \"before-selector\";\n\n\tvar index;\n\tvar buffer = \"\";\n\tvar valueParenthesisDepth = 0;\n\n\tvar SIGNIFICANT_WHITESPACE = {\n\t\t\"selector\": true,\n\t\t\"value\": true,\n\t\t\"value-parenthesis\": true,\n\t\t\"atRule\": true,\n\t\t\"importRule-begin\": true,\n\t\t\"importRule\": true,\n\t\t\"atBlock\": true,\n\t\t\"conditionBlock\": true,\n\t\t'documentRule-begin': true\n\t};\n\n\tvar styleSheet = new CSSOM.CSSStyleSheet();\n\n\t// @type CSSStyleSheet|CSSMediaRule|CSSSupportsRule|CSSFontFaceRule|CSSKeyframesRule|CSSDocumentRule\n\tvar currentScope = styleSheet;\n\n\t// @type CSSMediaRule|CSSSupportsRule|CSSKeyframesRule|CSSDocumentRule\n\tvar parentRule;\n\n\tvar ancestorRules = [];\n\tvar hasAncestors = false;\n\tvar prevScope;\n\n\tvar name, priority=\"\", styleRule, mediaRule, supportsRule, importRule, fontFaceRule, keyframesRule, documentRule, hostRule;\n\n\tvar atKeyframesRegExp = /@(-(?:\\w+-)+)?keyframes/g;\n\n\tvar parseError = function(message) {\n\t\tvar lines = token.substring(0, i).split('\\n');\n\t\tvar lineCount = lines.length;\n\t\tvar charCount = lines.pop().length + 1;\n\t\tvar error = new Error(message + ' (line ' + lineCount + ', char ' + charCount + ')');\n\t\terror.line = lineCount;\n\t\t/* jshint sub : true */\n\t\terror['char'] = charCount;\n\t\terror.styleSheet = styleSheet;\n\t\tthrow error;\n\t};\n\n\tfor (var character; (character = token.charAt(i)); i++) {\n\n\t\tswitch (character) {\n\n\t\tcase \" \":\n\t\tcase \"\\t\":\n\t\tcase \"\\r\":\n\t\tcase \"\\n\":\n\t\tcase \"\\f\":\n\t\t\tif (SIGNIFICANT_WHITESPACE[state]) {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// String\n\t\tcase '\"':\n\t\t\tindex = i + 1;\n\t\t\tdo {\n\t\t\t\tindex = token.indexOf('\"', index) + 1;\n\t\t\t\tif (!index) {\n\t\t\t\t\tparseError('Unmatched \"');\n\t\t\t\t}\n\t\t\t} while (token[index - 2] === '\\\\');\n\t\t\tbuffer += token.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tswitch (state) {\n\t\t\t\tcase 'before-value':\n\t\t\t\t\tstate = 'value';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'importRule-begin':\n\t\t\t\t\tstate = 'importRule';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"'\":\n\t\t\tindex = i + 1;\n\t\t\tdo {\n\t\t\t\tindex = token.indexOf(\"'\", index) + 1;\n\t\t\t\tif (!index) {\n\t\t\t\t\tparseError(\"Unmatched '\");\n\t\t\t\t}\n\t\t\t} while (token[index - 2] === '\\\\');\n\t\t\tbuffer += token.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tswitch (state) {\n\t\t\t\tcase 'before-value':\n\t\t\t\t\tstate = 'value';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'importRule-begin':\n\t\t\t\t\tstate = 'importRule';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// Comment\n\t\tcase \"/\":\n\t\t\tif (token.charAt(i + 1) === \"*\") {\n\t\t\t\ti += 2;\n\t\t\t\tindex = token.indexOf(\"*/\", i);\n\t\t\t\tif (index === -1) {\n\t\t\t\t\tparseError(\"Missing */\");\n\t\t\t\t} else {\n\t\t\t\t\ti = index + 1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tif (state === \"importRule-begin\") {\n\t\t\t\tbuffer += \" \";\n\t\t\t\tstate = \"importRule\";\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// At-rule\n\t\tcase \"@\":\n\t\t\tif (token.indexOf(\"@-moz-document\", i) === i) {\n\t\t\t\tstate = \"documentRule-begin\";\n\t\t\t\tdocumentRule = new CSSOM.CSSDocumentRule();\n\t\t\t\tdocumentRule.__starts = i;\n\t\t\t\ti += \"-moz-document\".length;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@media\", i) === i) {\n\t\t\t\tstate = \"atBlock\";\n\t\t\t\tmediaRule = new CSSOM.CSSMediaRule();\n\t\t\t\tmediaRule.__starts = i;\n\t\t\t\ti += \"media\".length;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@supports\", i) === i) {\n\t\t\t\tstate = \"conditionBlock\";\n\t\t\t\tsupportsRule = new CSSOM.CSSSupportsRule();\n\t\t\t\tsupportsRule.__starts = i;\n\t\t\t\ti += \"supports\".length;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@host\", i) === i) {\n\t\t\t\tstate = \"hostRule-begin\";\n\t\t\t\ti += \"host\".length;\n\t\t\t\thostRule = new CSSOM.CSSHostRule();\n\t\t\t\thostRule.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@import\", i) === i) {\n\t\t\t\tstate = \"importRule-begin\";\n\t\t\t\ti += \"import\".length;\n\t\t\t\tbuffer += \"@import\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@font-face\", i) === i) {\n\t\t\t\tstate = \"fontFaceRule-begin\";\n\t\t\t\ti += \"font-face\".length;\n\t\t\t\tfontFaceRule = new CSSOM.CSSFontFaceRule();\n\t\t\t\tfontFaceRule.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tatKeyframesRegExp.lastIndex = i;\n\t\t\t\tvar matchKeyframes = atKeyframesRegExp.exec(token);\n\t\t\t\tif (matchKeyframes && matchKeyframes.index === i) {\n\t\t\t\t\tstate = \"keyframesRule-begin\";\n\t\t\t\t\tkeyframesRule = new CSSOM.CSSKeyframesRule();\n\t\t\t\t\tkeyframesRule.__starts = i;\n\t\t\t\t\tkeyframesRule._vendorPrefix = matchKeyframes[1]; // Will come out as undefined if no prefix was found\n\t\t\t\t\ti += matchKeyframes[0].length - 1;\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (state === \"selector\") {\n\t\t\t\t\tstate = \"atRule\";\n\t\t\t\t}\n\t\t\t}\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\n\t\tcase \"{\":\n\t\t\tif (state === \"selector\" || state === \"atRule\") {\n\t\t\t\tstyleRule.selectorText = buffer.trim();\n\t\t\t\tstyleRule.style.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-name\";\n\t\t\t} else if (state === \"atBlock\") {\n\t\t\t\tmediaRule.media.mediaText = buffer.trim();\n\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tancestorRules.push(parentRule);\n\t\t\t\t}\n\n\t\t\t\tcurrentScope = parentRule = mediaRule;\n\t\t\t\tmediaRule.parentStyleSheet = styleSheet;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-selector\";\n\t\t\t} else if (state === \"conditionBlock\") {\n\t\t\t\tsupportsRule.conditionText = buffer.trim();\n\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tancestorRules.push(parentRule);\n\t\t\t\t}\n\n\t\t\t\tcurrentScope = parentRule = supportsRule;\n\t\t\t\tsupportsRule.parentStyleSheet = styleSheet;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-selector\";\n\t\t\t} else if (state === \"hostRule-begin\") {\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tancestorRules.push(parentRule);\n\t\t\t\t}\n\n\t\t\t\tcurrentScope = parentRule = hostRule;\n\t\t\t\thostRule.parentStyleSheet = styleSheet;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-selector\";\n\t\t\t} else if (state === \"fontFaceRule-begin\") {\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tfontFaceRule.parentRule = parentRule;\n\t\t\t\t}\n\t\t\t\tfontFaceRule.parentStyleSheet = styleSheet;\n\t\t\t\tstyleRule = fontFaceRule;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-name\";\n\t\t\t} else if (state === \"keyframesRule-begin\") {\n\t\t\t\tkeyframesRule.name = buffer.trim();\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tancestorRules.push(parentRule);\n\t\t\t\t\tkeyframesRule.parentRule = parentRule;\n\t\t\t\t}\n\t\t\t\tkeyframesRule.parentStyleSheet = styleSheet;\n\t\t\t\tcurrentScope = parentRule = keyframesRule;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"keyframeRule-begin\";\n\t\t\t} else if (state === \"keyframeRule-begin\") {\n\t\t\t\tstyleRule = new CSSOM.CSSKeyframeRule();\n\t\t\t\tstyleRule.keyText = buffer.trim();\n\t\t\t\tstyleRule.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-name\";\n\t\t\t} else if (state === \"documentRule-begin\") {\n\t\t\t\t// FIXME: what if this '{' is in the url text of the match function?\n\t\t\t\tdocumentRule.matcher.matcherText = buffer.trim();\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tancestorRules.push(parentRule);\n\t\t\t\t\tdocumentRule.parentRule = parentRule;\n\t\t\t\t}\n\t\t\t\tcurrentScope = parentRule = documentRule;\n\t\t\t\tdocumentRule.parentStyleSheet = styleSheet;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-selector\";\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \":\":\n\t\t\tif (state === \"name\") {\n\t\t\t\tname = buffer.trim();\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-value\";\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"(\":\n\t\t\tif (state === 'value') {\n\t\t\t\t// ie css expression mode\n\t\t\t\tif (buffer.trim() === 'expression') {\n\t\t\t\t\tvar info = (new CSSOM.CSSValueExpression(token, i)).parse();\n\n\t\t\t\t\tif (info.error) {\n\t\t\t\t\t\tparseError(info.error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbuffer += info.expression;\n\t\t\t\t\t\ti = info.idx;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tstate = 'value-parenthesis';\n\t\t\t\t\t//always ensure this is reset to 1 on transition\n\t\t\t\t\t//from value to value-parenthesis\n\t\t\t\t\tvalueParenthesisDepth = 1;\n\t\t\t\t\tbuffer += character;\n\t\t\t\t}\n\t\t\t} else if (state === 'value-parenthesis') {\n\t\t\t\tvalueParenthesisDepth++;\n\t\t\t\tbuffer += character;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \")\":\n\t\t\tif (state === 'value-parenthesis') {\n\t\t\t\tvalueParenthesisDepth--;\n\t\t\t\tif (valueParenthesisDepth === 0) state = 'value';\n\t\t\t}\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\n\t\tcase \"!\":\n\t\t\tif (state === \"value\" && token.indexOf(\"!important\", i) === i) {\n\t\t\t\tpriority = \"important\";\n\t\t\t\ti += \"important\".length;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \";\":\n\t\t\tswitch (state) {\n\t\t\t\tcase \"value\":\n\t\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\t\tpriority = \"\";\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-name\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"atRule\":\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"importRule\":\n\t\t\t\t\timportRule = new CSSOM.CSSImportRule();\n\t\t\t\t\timportRule.parentStyleSheet = importRule.styleSheet.parentStyleSheet = styleSheet;\n\t\t\t\t\timportRule.cssText = buffer + character;\n\t\t\t\t\tstyleSheet.cssRules.push(importRule);\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbuffer += character;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"}\":\n\t\t\tswitch (state) {\n\t\t\t\tcase \"value\":\n\t\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\t\tpriority = \"\";\n\t\t\t\t\t/* falls through */\n\t\t\t\tcase \"before-name\":\n\t\t\t\tcase \"name\":\n\t\t\t\t\tstyleRule.__ends = i + 1;\n\t\t\t\t\tif (parentRule) {\n\t\t\t\t\t\tstyleRule.parentRule = parentRule;\n\t\t\t\t\t}\n\t\t\t\t\tstyleRule.parentStyleSheet = styleSheet;\n\t\t\t\t\tcurrentScope.cssRules.push(styleRule);\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tif (currentScope.constructor === CSSOM.CSSKeyframesRule) {\n\t\t\t\t\t\tstate = \"keyframeRule-begin\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"keyframeRule-begin\":\n\t\t\t\tcase \"before-selector\":\n\t\t\t\tcase \"selector\":\n\t\t\t\t\t// End of media/supports/document rule.\n\t\t\t\t\tif (!parentRule) {\n\t\t\t\t\t\tparseError(\"Unexpected }\");\n\t\t\t\t\t}\n\n\t\t\t\t\t// Handle rules nested in @media or @supports\n\t\t\t\t\thasAncestors = ancestorRules.length > 0;\n\n\t\t\t\t\twhile (ancestorRules.length > 0) {\n\t\t\t\t\t\tparentRule = ancestorRules.pop();\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tparentRule.constructor.name === \"CSSMediaRule\"\n\t\t\t\t\t\t\t|| parentRule.constructor.name === \"CSSSupportsRule\"\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tprevScope = currentScope;\n\t\t\t\t\t\t\tcurrentScope = parentRule;\n\t\t\t\t\t\t\tcurrentScope.cssRules.push(prevScope);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (ancestorRules.length === 0) {\n\t\t\t\t\t\t\thasAncestors = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (!hasAncestors) {\n\t\t\t\t\t\tcurrentScope.__ends = i + 1;\n\t\t\t\t\t\tstyleSheet.cssRules.push(currentScope);\n\t\t\t\t\t\tcurrentScope = styleSheet;\n\t\t\t\t\t\tparentRule = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tswitch (state) {\n\t\t\t\tcase \"before-selector\":\n\t\t\t\t\tstate = \"selector\";\n\t\t\t\t\tstyleRule = new CSSOM.CSSStyleRule();\n\t\t\t\t\tstyleRule.__starts = i;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"before-name\":\n\t\t\t\t\tstate = \"name\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"before-value\":\n\t\t\t\t\tstate = \"value\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"importRule-begin\":\n\t\t\t\t\tstate = \"importRule\";\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn styleSheet;\n};\n\n\n//.CommonJS\nexports.parse = CSSOM.parse;\n// The following modules cannot be included sooner due to the mutual dependency with parse.js\nCSSOM.CSSStyleSheet = require(\"./CSSStyleSheet\").CSSStyleSheet;\nCSSOM.CSSStyleRule = require(\"./CSSStyleRule\").CSSStyleRule;\nCSSOM.CSSImportRule = require(\"./CSSImportRule\").CSSImportRule;\nCSSOM.CSSGroupingRule = require(\"./CSSGroupingRule\").CSSGroupingRule;\nCSSOM.CSSMediaRule = require(\"./CSSMediaRule\").CSSMediaRule;\nCSSOM.CSSConditionRule = require(\"./CSSConditionRule\").CSSConditionRule;\nCSSOM.CSSSupportsRule = require(\"./CSSSupportsRule\").CSSSupportsRule;\nCSSOM.CSSFontFaceRule = require(\"./CSSFontFaceRule\").CSSFontFaceRule;\nCSSOM.CSSHostRule = require(\"./CSSHostRule\").CSSHostRule;\nCSSOM.CSSStyleDeclaration = require('./CSSStyleDeclaration').CSSStyleDeclaration;\nCSSOM.CSSKeyframeRule = require('./CSSKeyframeRule').CSSKeyframeRule;\nCSSOM.CSSKeyframesRule = require('./CSSKeyframesRule').CSSKeyframesRule;\nCSSOM.CSSValueExpression = require('./CSSValueExpression').CSSValueExpression;\nCSSOM.CSSDocumentRule = require('./CSSDocumentRule').CSSDocumentRule;\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration\n */\nCSSOM.CSSStyleDeclaration = function CSSStyleDeclaration(){\n\tthis.length = 0;\n\tthis.parentRule = null;\n\n\t// NON-STANDARD\n\tthis._importants = {};\n};\n\n\nCSSOM.CSSStyleDeclaration.prototype = {\n\n\tconstructor: CSSOM.CSSStyleDeclaration,\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-getPropertyValue\n\t * @return {string} the value of the property if it has been explicitly set for this declaration block.\n\t * Returns the empty string if the property has not been set.\n\t */\n\tgetPropertyValue: function(name) {\n\t\treturn this[name] || \"\";\n\t},\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @param {string} value\n\t * @param {string} [priority=null] \"important\" or null\n\t * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-setProperty\n\t */\n\tsetProperty: function(name, value, priority) {\n\t\tif (this[name]) {\n\t\t\t// Property already exist. Overwrite it.\n\t\t\tvar index = Array.prototype.indexOf.call(this, name);\n\t\t\tif (index < 0) {\n\t\t\t\tthis[this.length] = name;\n\t\t\t\tthis.length++;\n\t\t\t}\n\t\t} else {\n\t\t\t// New property.\n\t\t\tthis[this.length] = name;\n\t\t\tthis.length++;\n\t\t}\n\t\tthis[name] = value + \"\";\n\t\tthis._importants[name] = priority;\n\t},\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-removeProperty\n\t * @return {string} the value of the property if it has been explicitly set for this declaration block.\n\t * Returns the empty string if the property has not been set or the property name does not correspond to a known CSS property.\n\t */\n\tremoveProperty: function(name) {\n\t\tif (!(name in this)) {\n\t\t\treturn \"\";\n\t\t}\n\t\tvar index = Array.prototype.indexOf.call(this, name);\n\t\tif (index < 0) {\n\t\t\treturn \"\";\n\t\t}\n\t\tvar prevValue = this[name];\n\t\tthis[name] = \"\";\n\n\t\t// That's what WebKit and Opera do\n\t\tArray.prototype.splice.call(this, index, 1);\n\n\t\t// That's what Firefox does\n\t\t//this[index] = \"\"\n\n\t\treturn prevValue;\n\t},\n\n\tgetPropertyCSSValue: function() {\n\t\t//FIXME\n\t},\n\n\t/**\n\t *\n\t * @param {String} name\n\t */\n\tgetPropertyPriority: function(name) {\n\t\treturn this._importants[name] || \"\";\n\t},\n\n\n\t/**\n\t *   element.style.overflow = \"auto\"\n\t *   element.style.getPropertyShorthand(\"overflow-x\")\n\t *   -> \"overflow\"\n\t */\n\tgetPropertyShorthand: function() {\n\t\t//FIXME\n\t},\n\n\tisPropertyImplicit: function() {\n\t\t//FIXME\n\t},\n\n\t// Doesn't work in IE < 9\n\tget cssText(){\n\t\tvar properties = [];\n\t\tfor (var i=0, length=this.length; i < length; ++i) {\n\t\t\tvar name = this[i];\n\t\t\tvar value = this.getPropertyValue(name);\n\t\t\tvar priority = this.getPropertyPriority(name);\n\t\t\tif (priority) {\n\t\t\t\tpriority = \" !\" + priority;\n\t\t\t}\n\t\t\tproperties[i] = name + \": \" + value + priority + \";\";\n\t\t}\n\t\treturn properties.join(\" \");\n\t},\n\n\tset cssText(text){\n\t\tvar i, name;\n\t\tfor (i = this.length; i--;) {\n\t\t\tname = this[i];\n\t\t\tthis[name] = \"\";\n\t\t}\n\t\tArray.prototype.splice.call(this, 0, this.length);\n\t\tthis._importants = {};\n\n\t\tvar dummyRule = CSSOM.parse('#bogus{' + text + '}').cssRules[0].style;\n\t\tvar length = dummyRule.length;\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\tname = dummyRule[i];\n\t\t\tthis.setProperty(dummyRule[i], dummyRule.getPropertyValue(name), dummyRule.getPropertyPriority(name));\n\t\t}\n\t}\n};\n\n\n//.CommonJS\nexports.CSSStyleDeclaration = CSSOM.CSSStyleDeclaration;\nCSSOM.parse = require('./parse').parse; // Cannot be included sooner due to the mutual dependency between parse.js and CSSStyleDeclaration.js\n///CommonJS\n", "//.CommonJS\nvar CSSOM = {\n\tCSSStyleSheet: require(\"./CSSStyleSheet\").CSSStyleSheet,\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tCSSStyleRule: require(\"./CSSStyleRule\").CSSStyleRule,\n\tCSSGroupingRule: require(\"./CSSGroupingRule\").CSSGroupingRule,\n\tCSSConditionRule: require(\"./CSSConditionRule\").CSSConditionRule,\n\tCSSMediaRule: require(\"./CSSMediaRule\").CSSMediaRule,\n\tCSSSupportsRule: require(\"./CSSSupportsRule\").CSSSupportsRule,\n\tCSSStyleDeclaration: require(\"./CSSStyleDeclaration\").CSSStyleDeclaration,\n\tCSSKeyframeRule: require('./CSSKeyframeRule').CSSKeyframeRule,\n\tCSSKeyframesRule: require('./CSSKeyframesRule').CSSKeyframesRule\n};\n///CommonJS\n\n\n/**\n * Produces a deep copy of stylesheet \u2014 the instance variables of stylesheet are copied recursively.\n * @param {CSSStyleSheet|CSSOM.CSSStyleSheet} stylesheet\n * @nosideeffects\n * @return {CSSOM.CSSStyleSheet}\n */\nCSSOM.clone = function clone(stylesheet) {\n\n\tvar cloned = new CSSOM.CSSStyleSheet();\n\n\tvar rules = stylesheet.cssRules;\n\tif (!rules) {\n\t\treturn cloned;\n\t}\n\n\tfor (var i = 0, rulesLength = rules.length; i < rulesLength; i++) {\n\t\tvar rule = rules[i];\n\t\tvar ruleClone = cloned.cssRules[i] = new rule.constructor();\n\n\t\tvar style = rule.style;\n\t\tif (style) {\n\t\t\tvar styleClone = ruleClone.style = new CSSOM.CSSStyleDeclaration();\n\t\t\tfor (var j = 0, styleLength = style.length; j < styleLength; j++) {\n\t\t\t\tvar name = styleClone[j] = style[j];\n\t\t\t\tstyleClone[name] = style[name];\n\t\t\t\tstyleClone._importants[name] = style.getPropertyPriority(name);\n\t\t\t}\n\t\t\tstyleClone.length = style.length;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('keyText')) {\n\t\t\truleClone.keyText = rule.keyText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('selectorText')) {\n\t\t\truleClone.selectorText = rule.selectorText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('mediaText')) {\n\t\t\truleClone.mediaText = rule.mediaText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('conditionText')) {\n\t\t\truleClone.conditionText = rule.conditionText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('cssRules')) {\n\t\t\truleClone.cssRules = clone(rule).cssRules;\n\t\t}\n\t}\n\n\treturn cloned;\n\n};\n\n//.CommonJS\nexports.clone = CSSOM.clone;\n///CommonJS\n", "'use strict';\n\nexports.CSSStyleDeclaration = require('./CSSStyleDeclaration').CSSStyleDeclaration;\nexports.CSSRule = require('./CSSRule').CSSRule;\nexports.CSSGroupingRule = require('./CSSGroupingRule').CSSGroupingRule;\nexports.CSSConditionRule = require('./CSSConditionRule').CSSConditionRule;\nexports.CSSStyleRule = require('./CSSStyleRule').CSSStyleRule;\nexports.MediaList = require('./MediaList').MediaList;\nexports.CSSMediaRule = require('./CSSMediaRule').CSSMediaRule;\nexports.CSSSupportsRule = require('./CSSSupportsRule').CSSSupportsRule;\nexports.CSSImportRule = require('./CSSImportRule').CSSImportRule;\nexports.CSSFontFaceRule = require('./CSSFontFaceRule').CSSFontFaceRule;\nexports.CSSHostRule = require('./CSSHostRule').CSSHostRule;\nexports.StyleSheet = require('./StyleSheet').StyleSheet;\nexports.CSSStyleSheet = require('./CSSStyleSheet').CSSStyleSheet;\nexports.CSSKeyframesRule = require('./CSSKeyframesRule').CSSKeyframesRule;\nexports.CSSKeyframeRule = require('./CSSKeyframeRule').CSSKeyframeRule;\nexports.MatcherList = require('./MatcherList').MatcherList;\nexports.CSSDocumentRule = require('./CSSDocumentRule').CSSDocumentRule;\nexports.CSSValue = require('./CSSValue').CSSValue;\nexports.CSSValueExpression = require('./CSSValueExpression').CSSValueExpression;\nexports.parse = require('./parse').parse;\nexports.clone = require('./clone').clone;\n", "class Canvas {\n  constructor(width, height) {\n    this.width = width;\n    this.height = height;\n  }\n  getContext() {\n    return null;\n  }\n  toDataURL() {\n    return '';\n  }\n}\n\nmodule.exports = {\n  createCanvas: (width, height) => new Canvas(width, height),\n};\n", "/* c8 ignore start */\ntry {\n  module.exports = require('canvas');\n} catch (fallback) {\n  module.exports = require('./canvas-shim.cjs');\n}\n/* c8 ignore stop */\n", "// Empty stub for modules not available in browser bundles.\nexport default {};\n", "export function fileURLToPath(_url: string): string {\n  throw new Error(\"fileURLToPath is not available in browser bundle\");\n}\n\nexport function pathToFileURL(_path: string): string {\n  throw new Error(\"pathToFileURL is not available in browser bundle\");\n}\n", "// http://www.w3.org/TR/CSS21/grammar.html\n// https://github.com/visionmedia/css-parse/pull/49#issuecomment-30088027\nvar commentre = /\\/\\*[^*]*\\*+([^/*][^*]*\\*+)*\\//g\n\nmodule.exports = function(css, options){\n  options = options || {};\n\n  /**\n   * Positional.\n   */\n\n  var lineno = 1;\n  var column = 1;\n\n  /**\n   * Update lineno and column based on `str`.\n   */\n\n  function updatePosition(str) {\n    var lines = str.match(/\\n/g);\n    if (lines) lineno += lines.length;\n    var i = str.lastIndexOf('\\n');\n    column = ~i ? str.length - i : column + str.length;\n  }\n\n  /**\n   * Mark position and patch `node.position`.\n   */\n\n  function position() {\n    var start = { line: lineno, column: column };\n    return function(node){\n      node.position = new Position(start);\n      whitespace();\n      return node;\n    };\n  }\n\n  /**\n   * Store position information for a node\n   */\n\n  function Position(start) {\n    this.start = start;\n    this.end = { line: lineno, column: column };\n    this.source = options.source;\n  }\n\n  /**\n   * Non-enumerable source string\n   */\n\n  Position.prototype.content = css;\n\n  /**\n   * Error `msg`.\n   */\n\n  var errorsList = [];\n\n  function error(msg) {\n    var err = new Error(options.source + ':' + lineno + ':' + column + ': ' + msg);\n    err.reason = msg;\n    err.filename = options.source;\n    err.line = lineno;\n    err.column = column;\n    err.source = css;\n\n    if (options.silent) {\n      errorsList.push(err);\n    } else {\n      throw err;\n    }\n  }\n\n  /**\n   * Parse stylesheet.\n   */\n\n  function stylesheet() {\n    var rulesList = rules();\n\n    return {\n      type: 'stylesheet',\n      stylesheet: {\n        source: options.source,\n        rules: rulesList,\n        parsingErrors: errorsList\n      }\n    };\n  }\n\n  /**\n   * Opening brace.\n   */\n\n  function open() {\n    return match(/^{\\s*/);\n  }\n\n  /**\n   * Closing brace.\n   */\n\n  function close() {\n    return match(/^}/);\n  }\n\n  /**\n   * Parse ruleset.\n   */\n\n  function rules() {\n    var node;\n    var rules = [];\n    whitespace();\n    comments(rules);\n    while (css.length && css.charAt(0) != '}' && (node = atrule() || rule())) {\n      if (node !== false) {\n        rules.push(node);\n        comments(rules);\n      }\n    }\n    return rules;\n  }\n\n  /**\n   * Match `re` and return captures.\n   */\n\n  function match(re) {\n    var m = re.exec(css);\n    if (!m) return;\n    var str = m[0];\n    updatePosition(str);\n    css = css.slice(str.length);\n    return m;\n  }\n\n  /**\n   * Parse whitespace.\n   */\n\n  function whitespace() {\n    match(/^\\s*/);\n  }\n\n  /**\n   * Parse comments;\n   */\n\n  function comments(rules) {\n    var c;\n    rules = rules || [];\n    while (c = comment()) {\n      if (c !== false) {\n        rules.push(c);\n      }\n    }\n    return rules;\n  }\n\n  /**\n   * Parse comment.\n   */\n\n  function comment() {\n    var pos = position();\n    if ('/' != css.charAt(0) || '*' != css.charAt(1)) return;\n\n    var i = 2;\n    while (\"\" != css.charAt(i) && ('*' != css.charAt(i) || '/' != css.charAt(i + 1))) ++i;\n    i += 2;\n\n    if (\"\" === css.charAt(i-1)) {\n      return error('End of comment missing');\n    }\n\n    var str = css.slice(2, i - 2);\n    column += 2;\n    updatePosition(str);\n    css = css.slice(i);\n    column += 2;\n\n    return pos({\n      type: 'comment',\n      comment: str\n    });\n  }\n\n  /**\n   * Parse selector.\n   */\n\n  function selector() {\n    var m = match(/^([^{]+)/);\n    if (!m) return;\n    /* @fix Remove all comments from selectors\n     * http://ostermiller.org/findcomment.html */\n    return trim(m[0])\n      .replace(/\\/\\*([^*]|[\\r\\n]|(\\*+([^*/]|[\\r\\n])))*\\*\\/+/g, '')\n      .replace(/\"(?:\\\\\"|[^\"])*\"|'(?:\\\\'|[^'])*'/g, function(m) {\n        return m.replace(/,/g, '\\u200C');\n      })\n      .split(/\\s*(?![^(]*\\)),\\s*/)\n      .map(function(s) {\n        return s.replace(/\\u200C/g, ',');\n      });\n  }\n\n  /**\n   * Parse declaration.\n   */\n\n  function declaration() {\n    var pos = position();\n\n    // prop\n    var prop = match(/^(\\*?[-#\\/\\*\\\\\\w]+(\\[[0-9a-z_-]+\\])?)\\s*/);\n    if (!prop) return;\n    prop = trim(prop[0]);\n\n    // :\n    if (!match(/^:\\s*/)) return error(\"property missing ':'\");\n\n    // val\n    var val = match(/^((?:'(?:\\\\'|.)*?'|\"(?:\\\\\"|.)*?\"|\\([^\\)]*?\\)|[^};])+)/);\n\n    var ret = pos({\n      type: 'declaration',\n      property: prop.replace(commentre, ''),\n      value: val ? trim(val[0]).replace(commentre, '') : ''\n    });\n\n    // ;\n    match(/^[;\\s]*/);\n\n    return ret;\n  }\n\n  /**\n   * Parse declarations.\n   */\n\n  function declarations() {\n    var decls = [];\n\n    if (!open()) return error(\"missing '{'\");\n    comments(decls);\n\n    // declarations\n    var decl;\n    while (decl = declaration()) {\n      if (decl !== false) {\n        decls.push(decl);\n        comments(decls);\n      }\n    }\n\n    if (!close()) return error(\"missing '}'\");\n    return decls;\n  }\n\n  /**\n   * Parse keyframe.\n   */\n\n  function keyframe() {\n    var m;\n    var vals = [];\n    var pos = position();\n\n    while (m = match(/^((\\d+\\.\\d+|\\.\\d+|\\d+)%?|[a-z]+)\\s*/)) {\n      vals.push(m[1]);\n      match(/^,\\s*/);\n    }\n\n    if (!vals.length) return;\n\n    return pos({\n      type: 'keyframe',\n      values: vals,\n      declarations: declarations()\n    });\n  }\n\n  /**\n   * Parse keyframes.\n   */\n\n  function atkeyframes() {\n    var pos = position();\n    var m = match(/^@([-\\w]+)?keyframes\\s*/);\n\n    if (!m) return;\n    var vendor = m[1];\n\n    // identifier\n    var m = match(/^([-\\w]+)\\s*/);\n    if (!m) return error(\"@keyframes missing name\");\n    var name = m[1];\n\n    if (!open()) return error(\"@keyframes missing '{'\");\n\n    var frame;\n    var frames = comments();\n    while (frame = keyframe()) {\n      frames.push(frame);\n      frames = frames.concat(comments());\n    }\n\n    if (!close()) return error(\"@keyframes missing '}'\");\n\n    return pos({\n      type: 'keyframes',\n      name: name,\n      vendor: vendor,\n      keyframes: frames\n    });\n  }\n\n  /**\n   * Parse supports.\n   */\n\n  function atsupports() {\n    var pos = position();\n    var m = match(/^@supports *([^{]+)/);\n\n    if (!m) return;\n    var supports = trim(m[1]);\n\n    if (!open()) return error(\"@supports missing '{'\");\n\n    var style = comments().concat(rules());\n\n    if (!close()) return error(\"@supports missing '}'\");\n\n    return pos({\n      type: 'supports',\n      supports: supports,\n      rules: style\n    });\n  }\n\n  /**\n   * Parse host.\n   */\n\n  function athost() {\n    var pos = position();\n    var m = match(/^@host\\s*/);\n\n    if (!m) return;\n\n    if (!open()) return error(\"@host missing '{'\");\n\n    var style = comments().concat(rules());\n\n    if (!close()) return error(\"@host missing '}'\");\n\n    return pos({\n      type: 'host',\n      rules: style\n    });\n  }\n\n  /**\n   * Parse media.\n   */\n\n  function atmedia() {\n    var pos = position();\n    var m = match(/^@media *([^{]+)/);\n\n    if (!m) return;\n    var media = trim(m[1]);\n\n    if (!open()) return error(\"@media missing '{'\");\n\n    var style = comments().concat(rules());\n\n    if (!close()) return error(\"@media missing '}'\");\n\n    return pos({\n      type: 'media',\n      media: media,\n      rules: style\n    });\n  }\n\n\n  /**\n   * Parse custom-media.\n   */\n\n  function atcustommedia() {\n    var pos = position();\n    var m = match(/^@custom-media\\s+(--[^\\s]+)\\s*([^{;]+);/);\n    if (!m) return;\n\n    return pos({\n      type: 'custom-media',\n      name: trim(m[1]),\n      media: trim(m[2])\n    });\n  }\n\n  /**\n   * Parse paged media.\n   */\n\n  function atpage() {\n    var pos = position();\n    var m = match(/^@page */);\n    if (!m) return;\n\n    var sel = selector() || [];\n\n    if (!open()) return error(\"@page missing '{'\");\n    var decls = comments();\n\n    // declarations\n    var decl;\n    while (decl = declaration()) {\n      decls.push(decl);\n      decls = decls.concat(comments());\n    }\n\n    if (!close()) return error(\"@page missing '}'\");\n\n    return pos({\n      type: 'page',\n      selectors: sel,\n      declarations: decls\n    });\n  }\n\n  /**\n   * Parse document.\n   */\n\n  function atdocument() {\n    var pos = position();\n    var m = match(/^@([-\\w]+)?document *([^{]+)/);\n    if (!m) return;\n\n    var vendor = trim(m[1]);\n    var doc = trim(m[2]);\n\n    if (!open()) return error(\"@document missing '{'\");\n\n    var style = comments().concat(rules());\n\n    if (!close()) return error(\"@document missing '}'\");\n\n    return pos({\n      type: 'document',\n      document: doc,\n      vendor: vendor,\n      rules: style\n    });\n  }\n\n  /**\n   * Parse font-face.\n   */\n\n  function atfontface() {\n    var pos = position();\n    var m = match(/^@font-face\\s*/);\n    if (!m) return;\n\n    if (!open()) return error(\"@font-face missing '{'\");\n    var decls = comments();\n\n    // declarations\n    var decl;\n    while (decl = declaration()) {\n      decls.push(decl);\n      decls = decls.concat(comments());\n    }\n\n    if (!close()) return error(\"@font-face missing '}'\");\n\n    return pos({\n      type: 'font-face',\n      declarations: decls\n    });\n  }\n\n  /**\n   * Parse import\n   */\n\n  var atimport = _compileAtrule('import');\n\n  /**\n   * Parse charset\n   */\n\n  var atcharset = _compileAtrule('charset');\n\n  /**\n   * Parse namespace\n   */\n\n  var atnamespace = _compileAtrule('namespace');\n\n  /**\n   * Parse non-block at-rules\n   */\n\n\n  function _compileAtrule(name) {\n    var re = new RegExp('^@' + name + '\\\\s*([^;]+);');\n    return function() {\n      var pos = position();\n      var m = match(re);\n      if (!m) return;\n      var ret = { type: name };\n      ret[name] = m[1].trim();\n      return pos(ret);\n    }\n  }\n\n  /**\n   * Parse at rule.\n   */\n\n  function atrule() {\n    if (css[0] != '@') return;\n\n    return atkeyframes()\n      || atmedia()\n      || atcustommedia()\n      || atsupports()\n      || atimport()\n      || atcharset()\n      || atnamespace()\n      || atdocument()\n      || atpage()\n      || athost()\n      || atfontface();\n  }\n\n  /**\n   * Parse rule.\n   */\n\n  function rule() {\n    var pos = position();\n    var sel = selector();\n\n    if (!sel) return error('selector missing');\n    comments();\n\n    return pos({\n      type: 'rule',\n      selectors: sel,\n      declarations: declarations()\n    });\n  }\n\n  return addParent(stylesheet());\n};\n\n/**\n * Trim `str`.\n */\n\nfunction trim(str) {\n  return str ? str.replace(/^\\s+|\\s+$/g, '') : '';\n}\n\n/**\n * Adds non-enumerable parent node reference to each node.\n */\n\nfunction addParent(obj, parent) {\n  var isNode = obj && typeof obj.type === 'string';\n  var childParent = isNode ? obj : parent;\n\n  for (var k in obj) {\n    var value = obj[k];\n    if (Array.isArray(value)) {\n      value.forEach(function(v) { addParent(v, childParent); });\n    } else if (value && typeof value === 'object') {\n      addParent(value, childParent);\n    }\n  }\n\n  if (isNode) {\n    Object.defineProperty(obj, 'parent', {\n      configurable: true,\n      writable: true,\n      enumerable: false,\n      value: parent || null\n    });\n  }\n\n  return obj;\n}\n", "\n/**\n * Expose `Compiler`.\n */\n\nmodule.exports = Compiler;\n\n/**\n * Initialize a compiler.\n *\n * @param {Type} name\n * @return {Type}\n * @api public\n */\n\nfunction Compiler(opts) {\n  this.options = opts || {};\n}\n\n/**\n * Emit `str`\n */\n\nCompiler.prototype.emit = function(str) {\n  return str;\n};\n\n/**\n * Visit `node`.\n */\n\nCompiler.prototype.visit = function(node){\n  return this[node.type](node);\n};\n\n/**\n * Map visit over array of `nodes`, optionally using a `delim`\n */\n\nCompiler.prototype.mapVisit = function(nodes, delim){\n  var buf = '';\n  delim = delim || '';\n\n  for (var i = 0, length = nodes.length; i < length; i++) {\n    buf += this.visit(nodes[i]);\n    if (delim && i < length - 1) buf += this.emit(delim);\n  }\n\n  return buf;\n};\n", "if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n", "\n/**\n * Module dependencies.\n */\n\nvar Base = require('./compiler');\nvar inherits = require('inherits');\n\n/**\n * Expose compiler.\n */\n\nmodule.exports = Compiler;\n\n/**\n * Initialize a new `Compiler`.\n */\n\nfunction Compiler(options) {\n  Base.call(this, options);\n}\n\n/**\n * Inherit from `Base.prototype`.\n */\n\ninherits(Compiler, Base);\n\n/**\n * Compile `node`.\n */\n\nCompiler.prototype.compile = function(node){\n  return node.stylesheet\n    .rules.map(this.visit, this)\n    .join('');\n};\n\n/**\n * Visit comment node.\n */\n\nCompiler.prototype.comment = function(node){\n  return this.emit('', node.position);\n};\n\n/**\n * Visit import node.\n */\n\nCompiler.prototype.import = function(node){\n  return this.emit('@import ' + node.import + ';', node.position);\n};\n\n/**\n * Visit media node.\n */\n\nCompiler.prototype.media = function(node){\n  return this.emit('@media ' + node.media, node.position)\n    + this.emit('{')\n    + this.mapVisit(node.rules)\n    + this.emit('}');\n};\n\n/**\n * Visit document node.\n */\n\nCompiler.prototype.document = function(node){\n  var doc = '@' + (node.vendor || '') + 'document ' + node.document;\n\n  return this.emit(doc, node.position)\n    + this.emit('{')\n    + this.mapVisit(node.rules)\n    + this.emit('}');\n};\n\n/**\n * Visit charset node.\n */\n\nCompiler.prototype.charset = function(node){\n  return this.emit('@charset ' + node.charset + ';', node.position);\n};\n\n/**\n * Visit namespace node.\n */\n\nCompiler.prototype.namespace = function(node){\n  return this.emit('@namespace ' + node.namespace + ';', node.position);\n};\n\n/**\n * Visit supports node.\n */\n\nCompiler.prototype.supports = function(node){\n  return this.emit('@supports ' + node.supports, node.position)\n    + this.emit('{')\n    + this.mapVisit(node.rules)\n    + this.emit('}');\n};\n\n/**\n * Visit keyframes node.\n */\n\nCompiler.prototype.keyframes = function(node){\n  return this.emit('@'\n    + (node.vendor || '')\n    + 'keyframes '\n    + node.name, node.position)\n    + this.emit('{')\n    + this.mapVisit(node.keyframes)\n    + this.emit('}');\n};\n\n/**\n * Visit keyframe node.\n */\n\nCompiler.prototype.keyframe = function(node){\n  var decls = node.declarations;\n\n  return this.emit(node.values.join(','), node.position)\n    + this.emit('{')\n    + this.mapVisit(decls)\n    + this.emit('}');\n};\n\n/**\n * Visit page node.\n */\n\nCompiler.prototype.page = function(node){\n  var sel = node.selectors.length\n    ? node.selectors.join(', ')\n    : '';\n\n  return this.emit('@page ' + sel, node.position)\n    + this.emit('{')\n    + this.mapVisit(node.declarations)\n    + this.emit('}');\n};\n\n/**\n * Visit font-face node.\n */\n\nCompiler.prototype['font-face'] = function(node){\n  return this.emit('@font-face', node.position)\n    + this.emit('{')\n    + this.mapVisit(node.declarations)\n    + this.emit('}');\n};\n\n/**\n * Visit host node.\n */\n\nCompiler.prototype.host = function(node){\n  return this.emit('@host', node.position)\n    + this.emit('{')\n    + this.mapVisit(node.rules)\n    + this.emit('}');\n};\n\n/**\n * Visit custom-media node.\n */\n\nCompiler.prototype['custom-media'] = function(node){\n  return this.emit('@custom-media ' + node.name + ' ' + node.media + ';', node.position);\n};\n\n/**\n * Visit rule node.\n */\n\nCompiler.prototype.rule = function(node){\n  var decls = node.declarations;\n  if (!decls.length) return '';\n\n  return this.emit(node.selectors.join(','), node.position)\n    + this.emit('{')\n    + this.mapVisit(decls)\n    + this.emit('}');\n};\n\n/**\n * Visit declaration node.\n */\n\nCompiler.prototype.declaration = function(node){\n  return this.emit(node.property + ':' + node.value, node.position) + this.emit(';');\n};\n\n", "\n/**\n * Module dependencies.\n */\n\nvar Base = require('./compiler');\nvar inherits = require('inherits');\n\n/**\n * Expose compiler.\n */\n\nmodule.exports = Compiler;\n\n/**\n * Initialize a new `Compiler`.\n */\n\nfunction Compiler(options) {\n  options = options || {};\n  Base.call(this, options);\n  this.indentation = options.indent;\n}\n\n/**\n * Inherit from `Base.prototype`.\n */\n\ninherits(Compiler, Base);\n\n/**\n * Compile `node`.\n */\n\nCompiler.prototype.compile = function(node){\n  return this.stylesheet(node);\n};\n\n/**\n * Visit stylesheet node.\n */\n\nCompiler.prototype.stylesheet = function(node){\n  return this.mapVisit(node.stylesheet.rules, '\\n\\n');\n};\n\n/**\n * Visit comment node.\n */\n\nCompiler.prototype.comment = function(node){\n  return this.emit(this.indent() + '/*' + node.comment + '*/', node.position);\n};\n\n/**\n * Visit import node.\n */\n\nCompiler.prototype.import = function(node){\n  return this.emit('@import ' + node.import + ';', node.position);\n};\n\n/**\n * Visit media node.\n */\n\nCompiler.prototype.media = function(node){\n  return this.emit('@media ' + node.media, node.position)\n    + this.emit(\n        ' {\\n'\n        + this.indent(1))\n    + this.mapVisit(node.rules, '\\n\\n')\n    + this.emit(\n        this.indent(-1)\n        + '\\n}');\n};\n\n/**\n * Visit document node.\n */\n\nCompiler.prototype.document = function(node){\n  var doc = '@' + (node.vendor || '') + 'document ' + node.document;\n\n  return this.emit(doc, node.position)\n    + this.emit(\n        ' '\n      + ' {\\n'\n      + this.indent(1))\n    + this.mapVisit(node.rules, '\\n\\n')\n    + this.emit(\n        this.indent(-1)\n        + '\\n}');\n};\n\n/**\n * Visit charset node.\n */\n\nCompiler.prototype.charset = function(node){\n  return this.emit('@charset ' + node.charset + ';', node.position);\n};\n\n/**\n * Visit namespace node.\n */\n\nCompiler.prototype.namespace = function(node){\n  return this.emit('@namespace ' + node.namespace + ';', node.position);\n};\n\n/**\n * Visit supports node.\n */\n\nCompiler.prototype.supports = function(node){\n  return this.emit('@supports ' + node.supports, node.position)\n    + this.emit(\n      ' {\\n'\n      + this.indent(1))\n    + this.mapVisit(node.rules, '\\n\\n')\n    + this.emit(\n        this.indent(-1)\n        + '\\n}');\n};\n\n/**\n * Visit keyframes node.\n */\n\nCompiler.prototype.keyframes = function(node){\n  return this.emit('@' + (node.vendor || '') + 'keyframes ' + node.name, node.position)\n    + this.emit(\n      ' {\\n'\n      + this.indent(1))\n    + this.mapVisit(node.keyframes, '\\n')\n    + this.emit(\n        this.indent(-1)\n        + '}');\n};\n\n/**\n * Visit keyframe node.\n */\n\nCompiler.prototype.keyframe = function(node){\n  var decls = node.declarations;\n\n  return this.emit(this.indent())\n    + this.emit(node.values.join(', '), node.position)\n    + this.emit(\n      ' {\\n'\n      + this.indent(1))\n    + this.mapVisit(decls, '\\n')\n    + this.emit(\n      this.indent(-1)\n      + '\\n'\n      + this.indent() + '}\\n');\n};\n\n/**\n * Visit page node.\n */\n\nCompiler.prototype.page = function(node){\n  var sel = node.selectors.length\n    ? node.selectors.join(', ') + ' '\n    : '';\n\n  return this.emit('@page ' + sel, node.position)\n    + this.emit('{\\n')\n    + this.emit(this.indent(1))\n    + this.mapVisit(node.declarations, '\\n')\n    + this.emit(this.indent(-1))\n    + this.emit('\\n}');\n};\n\n/**\n * Visit font-face node.\n */\n\nCompiler.prototype['font-face'] = function(node){\n  return this.emit('@font-face ', node.position)\n    + this.emit('{\\n')\n    + this.emit(this.indent(1))\n    + this.mapVisit(node.declarations, '\\n')\n    + this.emit(this.indent(-1))\n    + this.emit('\\n}');\n};\n\n/**\n * Visit host node.\n */\n\nCompiler.prototype.host = function(node){\n  return this.emit('@host', node.position)\n    + this.emit(\n        ' {\\n'\n        + this.indent(1))\n    + this.mapVisit(node.rules, '\\n\\n')\n    + this.emit(\n        this.indent(-1)\n        + '\\n}');\n};\n\n/**\n * Visit custom-media node.\n */\n\nCompiler.prototype['custom-media'] = function(node){\n  return this.emit('@custom-media ' + node.name + ' ' + node.media + ';', node.position);\n};\n\n/**\n * Visit rule node.\n */\n\nCompiler.prototype.rule = function(node){\n  var indent = this.indent();\n  var decls = node.declarations;\n  if (!decls.length) return '';\n\n  return this.emit(node.selectors.map(function(s){ return indent + s }).join(',\\n'), node.position)\n    + this.emit(' {\\n')\n    + this.emit(this.indent(1))\n    + this.mapVisit(decls, '\\n')\n    + this.emit(this.indent(-1))\n    + this.emit('\\n' + this.indent() + '}');\n};\n\n/**\n * Visit declaration node.\n */\n\nCompiler.prototype.declaration = function(node){\n  return this.emit(this.indent())\n    + this.emit(node.property + ': ' + node.value, node.position)\n    + this.emit(';');\n};\n\n/**\n * Increase, decrease or return current indentation.\n */\n\nCompiler.prototype.indent = function(level) {\n  this.level = this.level || 1;\n\n  if (null != level) {\n    this.level += level;\n    return '';\n  }\n\n  return Array(this.level).join(this.indentation || '  ');\n};\n", "/* -*- Mode: js; js-indent-level: 2; -*- */\n/*\n * Copyright 2011 Mozilla Foundation and contributors\n * Licensed under the New BSD license. See LICENSE or:\n * http://opensource.org/licenses/BSD-3-Clause\n */\n\nvar intToCharMap = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'.split('');\n\n/**\n * Encode an integer in the range of 0 to 63 to a single base 64 digit.\n */\nexports.encode = function (number) {\n  if (0 <= number && number < intToCharMap.length) {\n    return intToCharMap[number];\n  }\n  throw new TypeError(\"Must be between 0 and 63: \" + number);\n};\n\n/**\n * Decode a single base 64 character code digit to an integer. Returns -1 on\n * failure.\n */\nexports.decode = function (charCode) {\n  var bigA = 65;     // 'A'\n  var bigZ = 90;     // 'Z'\n\n  var littleA = 97;  // 'a'\n  var littleZ = 122; // 'z'\n\n  var zero = 48;     // '0'\n  var nine = 57;     // '9'\n\n  var plus = 43;     // '+'\n  var slash = 47;    // '/'\n\n  var littleOffset = 26;\n  var numberOffset = 52;\n\n  // 0 - 25: ABCDEFGHIJKLMNOPQRSTUVWXYZ\n  if (bigA <= charCode && charCode <= bigZ) {\n    return (charCode - bigA);\n  }\n\n  // 26 - 51: abcdefghijklmnopqrstuvwxyz\n  if (littleA <= charCode && charCode <= littleZ) {\n    return (charCode - littleA + littleOffset);\n  }\n\n  // 52 - 61: 0123456789\n  if (zero <= charCode && charCode <= nine) {\n    return (charCode - zero + numberOffset);\n  }\n\n  // 62: +\n  if (charCode == plus) {\n    return 62;\n  }\n\n  // 63: /\n  if (charCode == slash) {\n    return 63;\n  }\n\n  // Invalid base64 digit.\n  return -1;\n};\n", "/* -*- Mode: js; js-indent-level: 2; -*- */\n/*\n * Copyright 2011 Mozilla Foundation and contributors\n * Licensed under the New BSD license. See LICENSE or:\n * http://opensource.org/licenses/BSD-3-Clause\n *\n * Based on the Base 64 VLQ implementation in Closure Compiler:\n * https://code.google.com/p/closure-compiler/source/browse/trunk/src/com/google/debugging/sourcemap/Base64VLQ.java\n *\n * Copyright 2011 The Closure Compiler Authors. All rights reserved.\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *  * Redistributions of source code must retain the above copyright\n *    notice, this list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above\n *    copyright notice, this list of conditions and the following\n *    disclaimer in the documentation and/or other materials provided\n *    with the distribution.\n *  * Neither the name of Google Inc. nor the names of its\n *    contributors may be used to endorse or promote products derived\n *    from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nvar base64 = require('./base64');\n\n// A single base 64 digit can contain 6 bits of data. For the base 64 variable\n// length quantities we use in the source map spec, the first bit is the sign,\n// the next four bits are the actual value, and the 6th bit is the\n// continuation bit. The continuation bit tells us whether there are more\n// digits in this value following this digit.\n//\n//   Continuation\n//   |    Sign\n//   |    |\n//   V    V\n//   101011\n\nvar VLQ_BASE_SHIFT = 5;\n\n// binary: 100000\nvar VLQ_BASE = 1 << VLQ_BASE_SHIFT;\n\n// binary: 011111\nvar VLQ_BASE_MASK = VLQ_BASE - 1;\n\n// binary: 100000\nvar VLQ_CONTINUATION_BIT = VLQ_BASE;\n\n/**\n * Converts from a two-complement value to a value where the sign bit is\n * placed in the least significant bit.  For example, as decimals:\n *   1 becomes 2 (10 binary), -1 becomes 3 (11 binary)\n *   2 becomes 4 (100 binary), -2 becomes 5 (101 binary)\n */\nfunction toVLQSigned(aValue) {\n  return aValue < 0\n    ? ((-aValue) << 1) + 1\n    : (aValue << 1) + 0;\n}\n\n/**\n * Converts to a two-complement value from a value where the sign bit is\n * placed in the least significant bit.  For example, as decimals:\n *   2 (10 binary) becomes 1, 3 (11 binary) becomes -1\n *   4 (100 binary) becomes 2, 5 (101 binary) becomes -2\n */\nfunction fromVLQSigned(aValue) {\n  var isNegative = (aValue & 1) === 1;\n  var shifted = aValue >> 1;\n  return isNegative\n    ? -shifted\n    : shifted;\n}\n\n/**\n * Returns the base 64 VLQ encoded value.\n */\nexports.encode = function base64VLQ_encode(aValue) {\n  var encoded = \"\";\n  var digit;\n\n  var vlq = toVLQSigned(aValue);\n\n  do {\n    digit = vlq & VLQ_BASE_MASK;\n    vlq >>>= VLQ_BASE_SHIFT;\n    if (vlq > 0) {\n      // There are still more digits in this value, so we must make sure the\n      // continuation bit is marked.\n      digit |= VLQ_CONTINUATION_BIT;\n    }\n    encoded += base64.encode(digit);\n  } while (vlq > 0);\n\n  return encoded;\n};\n\n/**\n * Decodes the next base 64 VLQ value from the given string and returns the\n * value and the rest of the string via the out parameter.\n */\nexports.decode = function base64VLQ_decode(aStr, aIndex, aOutParam) {\n  var strLen = aStr.length;\n  var result = 0;\n  var shift = 0;\n  var continuation, digit;\n\n  do {\n    if (aIndex >= strLen) {\n      throw new Error(\"Expected more digits in base 64 VLQ value.\");\n    }\n\n    digit = base64.decode(aStr.charCodeAt(aIndex++));\n    if (digit === -1) {\n      throw new Error(\"Invalid base64 digit: \" + aStr.charAt(aIndex - 1));\n    }\n\n    continuation = !!(digit & VLQ_CONTINUATION_BIT);\n    digit &= VLQ_BASE_MASK;\n    result = result + (digit << shift);\n    shift += VLQ_BASE_SHIFT;\n  } while (continuation);\n\n  aOutParam.value = fromVLQSigned(result);\n  aOutParam.rest = aIndex;\n};\n", "/* -*- Mode: js; js-indent-level: 2; -*- */\n/*\n * Copyright 2011 Mozilla Foundation and contributors\n * Licensed under the New BSD license. See LICENSE or:\n * http://opensource.org/licenses/BSD-3-Clause\n */\n\n/**\n * This is a helper function for getting values from parameter/options\n * objects.\n *\n * @param args The object we are extracting values from\n * @param name The name of the property we are getting.\n * @param defaultValue An optional value to return if the property is missing\n * from the object. If this is not specified and the property is missing, an\n * error will be thrown.\n */\nfunction getArg(aArgs, aName, aDefaultValue) {\n  if (aName in aArgs) {\n    return aArgs[aName];\n  } else if (arguments.length === 3) {\n    return aDefaultValue;\n  } else {\n    throw new Error('\"' + aName + '\" is a required argument.');\n  }\n}\nexports.getArg = getArg;\n\nvar urlRegexp = /^(?:([\\w+\\-.]+):)?\\/\\/(?:(\\w+:\\w+)@)?([\\w.-]*)(?::(\\d+))?(.*)$/;\nvar dataUrlRegexp = /^data:.+\\,.+$/;\n\nfunction urlParse(aUrl) {\n  var match = aUrl.match(urlRegexp);\n  if (!match) {\n    return null;\n  }\n  return {\n    scheme: match[1],\n    auth: match[2],\n    host: match[3],\n    port: match[4],\n    path: match[5]\n  };\n}\nexports.urlParse = urlParse;\n\nfunction urlGenerate(aParsedUrl) {\n  var url = '';\n  if (aParsedUrl.scheme) {\n    url += aParsedUrl.scheme + ':';\n  }\n  url += '//';\n  if (aParsedUrl.auth) {\n    url += aParsedUrl.auth + '@';\n  }\n  if (aParsedUrl.host) {\n    url += aParsedUrl.host;\n  }\n  if (aParsedUrl.port) {\n    url += \":\" + aParsedUrl.port\n  }\n  if (aParsedUrl.path) {\n    url += aParsedUrl.path;\n  }\n  return url;\n}\nexports.urlGenerate = urlGenerate;\n\n/**\n * Normalizes a path, or the path portion of a URL:\n *\n * - Replaces consecutive slashes with one slash.\n * - Removes unnecessary '.' parts.\n * - Removes unnecessary '<dir>/..' parts.\n *\n * Based on code in the Node.js 'path' core module.\n *\n * @param aPath The path or url to normalize.\n */\nfunction normalize(aPath) {\n  var path = aPath;\n  var url = urlParse(aPath);\n  if (url) {\n    if (!url.path) {\n      return aPath;\n    }\n    path = url.path;\n  }\n  var isAbsolute = exports.isAbsolute(path);\n\n  var parts = path.split(/\\/+/);\n  for (var part, up = 0, i = parts.length - 1; i >= 0; i--) {\n    part = parts[i];\n    if (part === '.') {\n      parts.splice(i, 1);\n    } else if (part === '..') {\n      up++;\n    } else if (up > 0) {\n      if (part === '') {\n        // The first part is blank if the path is absolute. Trying to go\n        // above the root is a no-op. Therefore we can remove all '..' parts\n        // directly after the root.\n        parts.splice(i + 1, up);\n        up = 0;\n      } else {\n        parts.splice(i, 2);\n        up--;\n      }\n    }\n  }\n  path = parts.join('/');\n\n  if (path === '') {\n    path = isAbsolute ? '/' : '.';\n  }\n\n  if (url) {\n    url.path = path;\n    return urlGenerate(url);\n  }\n  return path;\n}\nexports.normalize = normalize;\n\n/**\n * Joins two paths/URLs.\n *\n * @param aRoot The root path or URL.\n * @param aPath The path or URL to be joined with the root.\n *\n * - If aPath is a URL or a data URI, aPath is returned, unless aPath is a\n *   scheme-relative URL: Then the scheme of aRoot, if any, is prepended\n *   first.\n * - Otherwise aPath is a path. If aRoot is a URL, then its path portion\n *   is updated with the result and aRoot is returned. Otherwise the result\n *   is returned.\n *   - If aPath is absolute, the result is aPath.\n *   - Otherwise the two paths are joined with a slash.\n * - Joining for example 'http://' and 'www.example.com' is also supported.\n */\nfunction join(aRoot, aPath) {\n  if (aRoot === \"\") {\n    aRoot = \".\";\n  }\n  if (aPath === \"\") {\n    aPath = \".\";\n  }\n  var aPathUrl = urlParse(aPath);\n  var aRootUrl = urlParse(aRoot);\n  if (aRootUrl) {\n    aRoot = aRootUrl.path || '/';\n  }\n\n  // `join(foo, '//www.example.org')`\n  if (aPathUrl && !aPathUrl.scheme) {\n    if (aRootUrl) {\n      aPathUrl.scheme = aRootUrl.scheme;\n    }\n    return urlGenerate(aPathUrl);\n  }\n\n  if (aPathUrl || aPath.match(dataUrlRegexp)) {\n    return aPath;\n  }\n\n  // `join('http://', 'www.example.com')`\n  if (aRootUrl && !aRootUrl.host && !aRootUrl.path) {\n    aRootUrl.host = aPath;\n    return urlGenerate(aRootUrl);\n  }\n\n  var joined = aPath.charAt(0) === '/'\n    ? aPath\n    : normalize(aRoot.replace(/\\/+$/, '') + '/' + aPath);\n\n  if (aRootUrl) {\n    aRootUrl.path = joined;\n    return urlGenerate(aRootUrl);\n  }\n  return joined;\n}\nexports.join = join;\n\nexports.isAbsolute = function (aPath) {\n  return aPath.charAt(0) === '/' || urlRegexp.test(aPath);\n};\n\n/**\n * Make a path relative to a URL or another path.\n *\n * @param aRoot The root path or URL.\n * @param aPath The path or URL to be made relative to aRoot.\n */\nfunction relative(aRoot, aPath) {\n  if (aRoot === \"\") {\n    aRoot = \".\";\n  }\n\n  aRoot = aRoot.replace(/\\/$/, '');\n\n  // It is possible for the path to be above the root. In this case, simply\n  // checking whether the root is a prefix of the path won't work. Instead, we\n  // need to remove components from the root one by one, until either we find\n  // a prefix that fits, or we run out of components to remove.\n  var level = 0;\n  while (aPath.indexOf(aRoot + '/') !== 0) {\n    var index = aRoot.lastIndexOf(\"/\");\n    if (index < 0) {\n      return aPath;\n    }\n\n    // If the only part of the root that is left is the scheme (i.e. http://,\n    // file:///, etc.), one or more slashes (/), or simply nothing at all, we\n    // have exhausted all components, so the path is not relative to the root.\n    aRoot = aRoot.slice(0, index);\n    if (aRoot.match(/^([^\\/]+:\\/)?\\/*$/)) {\n      return aPath;\n    }\n\n    ++level;\n  }\n\n  // Make sure we add a \"../\" for each component we removed from the root.\n  return Array(level + 1).join(\"../\") + aPath.substr(aRoot.length + 1);\n}\nexports.relative = relative;\n\nvar supportsNullProto = (function () {\n  var obj = Object.create(null);\n  return !('__proto__' in obj);\n}());\n\nfunction identity (s) {\n  return s;\n}\n\n/**\n * Because behavior goes wacky when you set `__proto__` on objects, we\n * have to prefix all the strings in our set with an arbitrary character.\n *\n * See https://github.com/mozilla/source-map/pull/31 and\n * https://github.com/mozilla/source-map/issues/30\n *\n * @param String aStr\n */\nfunction toSetString(aStr) {\n  if (isProtoString(aStr)) {\n    return '$' + aStr;\n  }\n\n  return aStr;\n}\nexports.toSetString = supportsNullProto ? identity : toSetString;\n\nfunction fromSetString(aStr) {\n  if (isProtoString(aStr)) {\n    return aStr.slice(1);\n  }\n\n  return aStr;\n}\nexports.fromSetString = supportsNullProto ? identity : fromSetString;\n\nfunction isProtoString(s) {\n  if (!s) {\n    return false;\n  }\n\n  var length = s.length;\n\n  if (length < 9 /* \"__proto__\".length */) {\n    return false;\n  }\n\n  if (s.charCodeAt(length - 1) !== 95  /* '_' */ ||\n      s.charCodeAt(length - 2) !== 95  /* '_' */ ||\n      s.charCodeAt(length - 3) !== 111 /* 'o' */ ||\n      s.charCodeAt(length - 4) !== 116 /* 't' */ ||\n      s.charCodeAt(length - 5) !== 111 /* 'o' */ ||\n      s.charCodeAt(length - 6) !== 114 /* 'r' */ ||\n      s.charCodeAt(length - 7) !== 112 /* 'p' */ ||\n      s.charCodeAt(length - 8) !== 95  /* '_' */ ||\n      s.charCodeAt(length - 9) !== 95  /* '_' */) {\n    return false;\n  }\n\n  for (var i = length - 10; i >= 0; i--) {\n    if (s.charCodeAt(i) !== 36 /* '$' */) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n * Comparator between two mappings where the original positions are compared.\n *\n * Optionally pass in `true` as `onlyCompareGenerated` to consider two\n * mappings with the same original source/line/column, but different generated\n * line and column the same. Useful when searching for a mapping with a\n * stubbed out mapping.\n */\nfunction compareByOriginalPositions(mappingA, mappingB, onlyCompareOriginal) {\n  var cmp = strcmp(mappingA.source, mappingB.source);\n  if (cmp !== 0) {\n    return cmp;\n  }\n\n  cmp = mappingA.originalLine - mappingB.originalLine;\n  if (cmp !== 0) {\n    return cmp;\n  }\n\n  cmp = mappingA.originalColumn - mappingB.originalColumn;\n  if (cmp !== 0 || onlyCompareOriginal) {\n    return cmp;\n  }\n\n  cmp = mappingA.generatedColumn - mappingB.generatedColumn;\n  if (cmp !== 0) {\n    return cmp;\n  }\n\n  cmp = mappingA.generatedLine - mappingB.generatedLine;\n  if (cmp !== 0) {\n    return cmp;\n  }\n\n  return strcmp(mappingA.name, mappingB.name);\n}\nexports.compareByOriginalPositions = compareByOriginalPositions;\n\n/**\n * Comparator between two mappings with deflated source and name indices where\n * the generated positions are compared.\n *\n * Optionally pass in `true` as `onlyCompareGenerated` to consider two\n * mappings with the same generated line and column, but different\n * source/name/original line and column the same. Useful when searching for a\n * mapping with a stubbed out mapping.\n */\nfunction compareByGeneratedPositionsDeflated(mappingA, mappingB, onlyCompareGenerated) {\n  var cmp = mappingA.generatedLine - mappingB.generatedLine;\n  if (cmp !== 0) {\n    return cmp;\n  }\n\n  cmp = mappingA.generatedColumn - mappingB.generatedColumn;\n  if (cmp !== 0 || onlyCompareGenerated) {\n    return cmp;\n  }\n\n  cmp = strcmp(mappingA.source, mappingB.source);\n  if (cmp !== 0) {\n    return cmp;\n  }\n\n  cmp = mappingA.originalLine - mappingB.originalLine;\n  if (cmp !== 0) {\n    return cmp;\n  }\n\n  cmp = mappingA.originalColumn - mappingB.originalColumn;\n  if (cmp !== 0) {\n    return cmp;\n  }\n\n  return strcmp(mappingA.name, mappingB.name);\n}\nexports.compareByGeneratedPositionsDeflated = compareByGeneratedPositionsDeflated;\n\nfunction strcmp(aStr1, aStr2) {\n  if (aStr1 === aStr2) {\n    return 0;\n  }\n\n  if (aStr1 === null) {\n    return 1; // aStr2 !== null\n  }\n\n  if (aStr2 === null) {\n    return -1; // aStr1 !== null\n  }\n\n  if (aStr1 > aStr2) {\n    return 1;\n  }\n\n  return -1;\n}\n\n/**\n * Comparator between two mappings with inflated source and name strings where\n * the generated positions are compared.\n */\nfunction compareByGeneratedPositionsInflated(mappingA, mappingB) {\n  var cmp = mappingA.generatedLine - mappingB.generatedLine;\n  if (cmp !== 0) {\n    return cmp;\n  }\n\n  cmp = mappingA.generatedColumn - mappingB.generatedColumn;\n  if (cmp !== 0) {\n    return cmp;\n  }\n\n  cmp = strcmp(mappingA.source, mappingB.source);\n  if (cmp !== 0) {\n    return cmp;\n  }\n\n  cmp = mappingA.originalLine - mappingB.originalLine;\n  if (cmp !== 0) {\n    return cmp;\n  }\n\n  cmp = mappingA.originalColumn - mappingB.originalColumn;\n  if (cmp !== 0) {\n    return cmp;\n  }\n\n  return strcmp(mappingA.name, mappingB.name);\n}\nexports.compareByGeneratedPositionsInflated = compareByGeneratedPositionsInflated;\n\n/**\n * Strip any JSON XSSI avoidance prefix from the string (as documented\n * in the source maps specification), and then parse the string as\n * JSON.\n */\nfunction parseSourceMapInput(str) {\n  return JSON.parse(str.replace(/^\\)]}'[^\\n]*\\n/, ''));\n}\nexports.parseSourceMapInput = parseSourceMapInput;\n\n/**\n * Compute the URL of a source given the the source root, the source's\n * URL, and the source map's URL.\n */\nfunction computeSourceURL(sourceRoot, sourceURL, sourceMapURL) {\n  sourceURL = sourceURL || '';\n\n  if (sourceRoot) {\n    // This follows what Chrome does.\n    if (sourceRoot[sourceRoot.length - 1] !== '/' && sourceURL[0] !== '/') {\n      sourceRoot += '/';\n    }\n    // The spec says:\n    //   Line 4: An optional source root, useful for relocating source\n    //   files on a server or removing repeated values in the\n    //   \u201Csources\u201D entry.  This value is prepended to the individual\n    //   entries in the \u201Csource\u201D field.\n    sourceURL = sourceRoot + sourceURL;\n  }\n\n  // Historically, SourceMapConsumer did not take the sourceMapURL as\n  // a parameter.  This mode is still somewhat supported, which is why\n  // this code block is conditional.  However, it's preferable to pass\n  // the source map URL to SourceMapConsumer, so that this function\n  // can implement the source URL resolution algorithm as outlined in\n  // the spec.  This block is basically the equivalent of:\n  //    new URL(sourceURL, sourceMapURL).toString()\n  // ... except it avoids using URL, which wasn't available in the\n  // older releases of node still supported by this library.\n  //\n  // The spec says:\n  //   If the sources are not absolute URLs after prepending of the\n  //   \u201CsourceRoot\u201D, the sources are resolved relative to the\n  //   SourceMap (like resolving script src in a html document).\n  if (sourceMapURL) {\n    var parsed = urlParse(sourceMapURL);\n    if (!parsed) {\n      throw new Error(\"sourceMapURL could not be parsed\");\n    }\n    if (parsed.path) {\n      // Strip the last path component, but keep the \"/\".\n      var index = parsed.path.lastIndexOf('/');\n      if (index >= 0) {\n        parsed.path = parsed.path.substring(0, index + 1);\n      }\n    }\n    sourceURL = join(urlGenerate(parsed), sourceURL);\n  }\n\n  return normalize(sourceURL);\n}\nexports.computeSourceURL = computeSourceURL;\n", "/* -*- Mode: js; js-indent-level: 2; -*- */\n/*\n * Copyright 2011 Mozilla Foundation and contributors\n * Licensed under the New BSD license. See LICENSE or:\n * http://opensource.org/licenses/BSD-3-Clause\n */\n\nvar util = require('./util');\nvar has = Object.prototype.hasOwnProperty;\nvar hasNativeMap = typeof Map !== \"undefined\";\n\n/**\n * A data structure which is a combination of an array and a set. Adding a new\n * member is O(1), testing for membership is O(1), and finding the index of an\n * element is O(1). Removing elements from the set is not supported. Only\n * strings are supported for membership.\n */\nfunction ArraySet() {\n  this._array = [];\n  this._set = hasNativeMap ? new Map() : Object.create(null);\n}\n\n/**\n * Static method for creating ArraySet instances from an existing array.\n */\nArraySet.fromArray = function ArraySet_fromArray(aArray, aAllowDuplicates) {\n  var set = new ArraySet();\n  for (var i = 0, len = aArray.length; i < len; i++) {\n    set.add(aArray[i], aAllowDuplicates);\n  }\n  return set;\n};\n\n/**\n * Return how many unique items are in this ArraySet. If duplicates have been\n * added, than those do not count towards the size.\n *\n * @returns Number\n */\nArraySet.prototype.size = function ArraySet_size() {\n  return hasNativeMap ? this._set.size : Object.getOwnPropertyNames(this._set).length;\n};\n\n/**\n * Add the given string to this set.\n *\n * @param String aStr\n */\nArraySet.prototype.add = function ArraySet_add(aStr, aAllowDuplicates) {\n  var sStr = hasNativeMap ? aStr : util.toSetString(aStr);\n  var isDuplicate = hasNativeMap ? this.has(aStr) : has.call(this._set, sStr);\n  var idx = this._array.length;\n  if (!isDuplicate || aAllowDuplicates) {\n    this._array.push(aStr);\n  }\n  if (!isDuplicate) {\n    if (hasNativeMap) {\n      this._set.set(aStr, idx);\n    } else {\n      this._set[sStr] = idx;\n    }\n  }\n};\n\n/**\n * Is the given string a member of this set?\n *\n * @param String aStr\n */\nArraySet.prototype.has = function ArraySet_has(aStr) {\n  if (hasNativeMap) {\n    return this._set.has(aStr);\n  } else {\n    var sStr = util.toSetString(aStr);\n    return has.call(this._set, sStr);\n  }\n};\n\n/**\n * What is the index of the given string in the array?\n *\n * @param String aStr\n */\nArraySet.prototype.indexOf = function ArraySet_indexOf(aStr) {\n  if (hasNativeMap) {\n    var idx = this._set.get(aStr);\n    if (idx >= 0) {\n        return idx;\n    }\n  } else {\n    var sStr = util.toSetString(aStr);\n    if (has.call(this._set, sStr)) {\n      return this._set[sStr];\n    }\n  }\n\n  throw new Error('\"' + aStr + '\" is not in the set.');\n};\n\n/**\n * What is the element at the given index?\n *\n * @param Number aIdx\n */\nArraySet.prototype.at = function ArraySet_at(aIdx) {\n  if (aIdx >= 0 && aIdx < this._array.length) {\n    return this._array[aIdx];\n  }\n  throw new Error('No element indexed by ' + aIdx);\n};\n\n/**\n * Returns the array representation of this set (which has the proper indices\n * indicated by indexOf). Note that this is a copy of the internal array used\n * for storing the members so that no one can mess with internal state.\n */\nArraySet.prototype.toArray = function ArraySet_toArray() {\n  return this._array.slice();\n};\n\nexports.ArraySet = ArraySet;\n", "/* -*- Mode: js; js-indent-level: 2; -*- */\n/*\n * Copyright 2014 Mozilla Foundation and contributors\n * Licensed under the New BSD license. See LICENSE or:\n * http://opensource.org/licenses/BSD-3-Clause\n */\n\nvar util = require('./util');\n\n/**\n * Determine whether mappingB is after mappingA with respect to generated\n * position.\n */\nfunction generatedPositionAfter(mappingA, mappingB) {\n  // Optimized for most common case\n  var lineA = mappingA.generatedLine;\n  var lineB = mappingB.generatedLine;\n  var columnA = mappingA.generatedColumn;\n  var columnB = mappingB.generatedColumn;\n  return lineB > lineA || lineB == lineA && columnB >= columnA ||\n         util.compareByGeneratedPositionsInflated(mappingA, mappingB) <= 0;\n}\n\n/**\n * A data structure to provide a sorted view of accumulated mappings in a\n * performance conscious manner. It trades a neglibable overhead in general\n * case for a large speedup in case of mappings being added in order.\n */\nfunction MappingList() {\n  this._array = [];\n  this._sorted = true;\n  // Serves as infimum\n  this._last = {generatedLine: -1, generatedColumn: 0};\n}\n\n/**\n * Iterate through internal items. This method takes the same arguments that\n * `Array.prototype.forEach` takes.\n *\n * NOTE: The order of the mappings is NOT guaranteed.\n */\nMappingList.prototype.unsortedForEach =\n  function MappingList_forEach(aCallback, aThisArg) {\n    this._array.forEach(aCallback, aThisArg);\n  };\n\n/**\n * Add the given source mapping.\n *\n * @param Object aMapping\n */\nMappingList.prototype.add = function MappingList_add(aMapping) {\n  if (generatedPositionAfter(this._last, aMapping)) {\n    this._last = aMapping;\n    this._array.push(aMapping);\n  } else {\n    this._sorted = false;\n    this._array.push(aMapping);\n  }\n};\n\n/**\n * Returns the flat, sorted array of mappings. The mappings are sorted by\n * generated position.\n *\n * WARNING: This method returns internal data without copying, for\n * performance. The return value must NOT be mutated, and should be treated as\n * an immutable borrow. If you want to take ownership, you must make your own\n * copy.\n */\nMappingList.prototype.toArray = function MappingList_toArray() {\n  if (!this._sorted) {\n    this._array.sort(util.compareByGeneratedPositionsInflated);\n    this._sorted = true;\n  }\n  return this._array;\n};\n\nexports.MappingList = MappingList;\n", "/* -*- Mode: js; js-indent-level: 2; -*- */\n/*\n * Copyright 2011 Mozilla Foundation and contributors\n * Licensed under the New BSD license. See LICENSE or:\n * http://opensource.org/licenses/BSD-3-Clause\n */\n\nvar base64VLQ = require('./base64-vlq');\nvar util = require('./util');\nvar ArraySet = require('./array-set').ArraySet;\nvar MappingList = require('./mapping-list').MappingList;\n\n/**\n * An instance of the SourceMapGenerator represents a source map which is\n * being built incrementally. You may pass an object with the following\n * properties:\n *\n *   - file: The filename of the generated source.\n *   - sourceRoot: A root for all relative URLs in this source map.\n */\nfunction SourceMapGenerator(aArgs) {\n  if (!aArgs) {\n    aArgs = {};\n  }\n  this._file = util.getArg(aArgs, 'file', null);\n  this._sourceRoot = util.getArg(aArgs, 'sourceRoot', null);\n  this._skipValidation = util.getArg(aArgs, 'skipValidation', false);\n  this._sources = new ArraySet();\n  this._names = new ArraySet();\n  this._mappings = new MappingList();\n  this._sourcesContents = null;\n}\n\nSourceMapGenerator.prototype._version = 3;\n\n/**\n * Creates a new SourceMapGenerator based on a SourceMapConsumer\n *\n * @param aSourceMapConsumer The SourceMap.\n */\nSourceMapGenerator.fromSourceMap =\n  function SourceMapGenerator_fromSourceMap(aSourceMapConsumer) {\n    var sourceRoot = aSourceMapConsumer.sourceRoot;\n    var generator = new SourceMapGenerator({\n      file: aSourceMapConsumer.file,\n      sourceRoot: sourceRoot\n    });\n    aSourceMapConsumer.eachMapping(function (mapping) {\n      var newMapping = {\n        generated: {\n          line: mapping.generatedLine,\n          column: mapping.generatedColumn\n        }\n      };\n\n      if (mapping.source != null) {\n        newMapping.source = mapping.source;\n        if (sourceRoot != null) {\n          newMapping.source = util.relative(sourceRoot, newMapping.source);\n        }\n\n        newMapping.original = {\n          line: mapping.originalLine,\n          column: mapping.originalColumn\n        };\n\n        if (mapping.name != null) {\n          newMapping.name = mapping.name;\n        }\n      }\n\n      generator.addMapping(newMapping);\n    });\n    aSourceMapConsumer.sources.forEach(function (sourceFile) {\n      var sourceRelative = sourceFile;\n      if (sourceRoot !== null) {\n        sourceRelative = util.relative(sourceRoot, sourceFile);\n      }\n\n      if (!generator._sources.has(sourceRelative)) {\n        generator._sources.add(sourceRelative);\n      }\n\n      var content = aSourceMapConsumer.sourceContentFor(sourceFile);\n      if (content != null) {\n        generator.setSourceContent(sourceFile, content);\n      }\n    });\n    return generator;\n  };\n\n/**\n * Add a single mapping from original source line and column to the generated\n * source's line and column for this source map being created. The mapping\n * object should have the following properties:\n *\n *   - generated: An object with the generated line and column positions.\n *   - original: An object with the original line and column positions.\n *   - source: The original source file (relative to the sourceRoot).\n *   - name: An optional original token name for this mapping.\n */\nSourceMapGenerator.prototype.addMapping =\n  function SourceMapGenerator_addMapping(aArgs) {\n    var generated = util.getArg(aArgs, 'generated');\n    var original = util.getArg(aArgs, 'original', null);\n    var source = util.getArg(aArgs, 'source', null);\n    var name = util.getArg(aArgs, 'name', null);\n\n    if (!this._skipValidation) {\n      this._validateMapping(generated, original, source, name);\n    }\n\n    if (source != null) {\n      source = String(source);\n      if (!this._sources.has(source)) {\n        this._sources.add(source);\n      }\n    }\n\n    if (name != null) {\n      name = String(name);\n      if (!this._names.has(name)) {\n        this._names.add(name);\n      }\n    }\n\n    this._mappings.add({\n      generatedLine: generated.line,\n      generatedColumn: generated.column,\n      originalLine: original != null && original.line,\n      originalColumn: original != null && original.column,\n      source: source,\n      name: name\n    });\n  };\n\n/**\n * Set the source content for a source file.\n */\nSourceMapGenerator.prototype.setSourceContent =\n  function SourceMapGenerator_setSourceContent(aSourceFile, aSourceContent) {\n    var source = aSourceFile;\n    if (this._sourceRoot != null) {\n      source = util.relative(this._sourceRoot, source);\n    }\n\n    if (aSourceContent != null) {\n      // Add the source content to the _sourcesContents map.\n      // Create a new _sourcesContents map if the property is null.\n      if (!this._sourcesContents) {\n        this._sourcesContents = Object.create(null);\n      }\n      this._sourcesContents[util.toSetString(source)] = aSourceContent;\n    } else if (this._sourcesContents) {\n      // Remove the source file from the _sourcesContents map.\n      // If the _sourcesContents map is empty, set the property to null.\n      delete this._sourcesContents[util.toSetString(source)];\n      if (Object.keys(this._sourcesContents).length === 0) {\n        this._sourcesContents = null;\n      }\n    }\n  };\n\n/**\n * Applies the mappings of a sub-source-map for a specific source file to the\n * source map being generated. Each mapping to the supplied source file is\n * rewritten using the supplied source map. Note: The resolution for the\n * resulting mappings is the minimium of this map and the supplied map.\n *\n * @param aSourceMapConsumer The source map to be applied.\n * @param aSourceFile Optional. The filename of the source file.\n *        If omitted, SourceMapConsumer's file property will be used.\n * @param aSourceMapPath Optional. The dirname of the path to the source map\n *        to be applied. If relative, it is relative to the SourceMapConsumer.\n *        This parameter is needed when the two source maps aren't in the same\n *        directory, and the source map to be applied contains relative source\n *        paths. If so, those relative source paths need to be rewritten\n *        relative to the SourceMapGenerator.\n */\nSourceMapGenerator.prototype.applySourceMap =\n  function SourceMapGenerator_applySourceMap(aSourceMapConsumer, aSourceFile, aSourceMapPath) {\n    var sourceFile = aSourceFile;\n    // If aSourceFile is omitted, we will use the file property of the SourceMap\n    if (aSourceFile == null) {\n      if (aSourceMapConsumer.file == null) {\n        throw new Error(\n          'SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, ' +\n          'or the source map\\'s \"file\" property. Both were omitted.'\n        );\n      }\n      sourceFile = aSourceMapConsumer.file;\n    }\n    var sourceRoot = this._sourceRoot;\n    // Make \"sourceFile\" relative if an absolute Url is passed.\n    if (sourceRoot != null) {\n      sourceFile = util.relative(sourceRoot, sourceFile);\n    }\n    // Applying the SourceMap can add and remove items from the sources and\n    // the names array.\n    var newSources = new ArraySet();\n    var newNames = new ArraySet();\n\n    // Find mappings for the \"sourceFile\"\n    this._mappings.unsortedForEach(function (mapping) {\n      if (mapping.source === sourceFile && mapping.originalLine != null) {\n        // Check if it can be mapped by the source map, then update the mapping.\n        var original = aSourceMapConsumer.originalPositionFor({\n          line: mapping.originalLine,\n          column: mapping.originalColumn\n        });\n        if (original.source != null) {\n          // Copy mapping\n          mapping.source = original.source;\n          if (aSourceMapPath != null) {\n            mapping.source = util.join(aSourceMapPath, mapping.source)\n          }\n          if (sourceRoot != null) {\n            mapping.source = util.relative(sourceRoot, mapping.source);\n          }\n          mapping.originalLine = original.line;\n          mapping.originalColumn = original.column;\n          if (original.name != null) {\n            mapping.name = original.name;\n          }\n        }\n      }\n\n      var source = mapping.source;\n      if (source != null && !newSources.has(source)) {\n        newSources.add(source);\n      }\n\n      var name = mapping.name;\n      if (name != null && !newNames.has(name)) {\n        newNames.add(name);\n      }\n\n    }, this);\n    this._sources = newSources;\n    this._names = newNames;\n\n    // Copy sourcesContents of applied map.\n    aSourceMapConsumer.sources.forEach(function (sourceFile) {\n      var content = aSourceMapConsumer.sourceContentFor(sourceFile);\n      if (content != null) {\n        if (aSourceMapPath != null) {\n          sourceFile = util.join(aSourceMapPath, sourceFile);\n        }\n        if (sourceRoot != null) {\n          sourceFile = util.relative(sourceRoot, sourceFile);\n        }\n        this.setSourceContent(sourceFile, content);\n      }\n    }, this);\n  };\n\n/**\n * A mapping can have one of the three levels of data:\n *\n *   1. Just the generated position.\n *   2. The Generated position, original position, and original source.\n *   3. Generated and original position, original source, as well as a name\n *      token.\n *\n * To maintain consistency, we validate that any new mapping being added falls\n * in to one of these categories.\n */\nSourceMapGenerator.prototype._validateMapping =\n  function SourceMapGenerator_validateMapping(aGenerated, aOriginal, aSource,\n                                              aName) {\n    // When aOriginal is truthy but has empty values for .line and .column,\n    // it is most likely a programmer error. In this case we throw a very\n    // specific error message to try to guide them the right way.\n    // For example: https://github.com/Polymer/polymer-bundler/pull/519\n    if (aOriginal && typeof aOriginal.line !== 'number' && typeof aOriginal.column !== 'number') {\n        throw new Error(\n            'original.line and original.column are not numbers -- you probably meant to omit ' +\n            'the original mapping entirely and only map the generated position. If so, pass ' +\n            'null for the original mapping instead of an object with empty or null values.'\n        );\n    }\n\n    if (aGenerated && 'line' in aGenerated && 'column' in aGenerated\n        && aGenerated.line > 0 && aGenerated.column >= 0\n        && !aOriginal && !aSource && !aName) {\n      // Case 1.\n      return;\n    }\n    else if (aGenerated && 'line' in aGenerated && 'column' in aGenerated\n             && aOriginal && 'line' in aOriginal && 'column' in aOriginal\n             && aGenerated.line > 0 && aGenerated.column >= 0\n             && aOriginal.line > 0 && aOriginal.column >= 0\n             && aSource) {\n      // Cases 2 and 3.\n      return;\n    }\n    else {\n      throw new Error('Invalid mapping: ' + JSON.stringify({\n        generated: aGenerated,\n        source: aSource,\n        original: aOriginal,\n        name: aName\n      }));\n    }\n  };\n\n/**\n * Serialize the accumulated mappings in to the stream of base 64 VLQs\n * specified by the source map format.\n */\nSourceMapGenerator.prototype._serializeMappings =\n  function SourceMapGenerator_serializeMappings() {\n    var previousGeneratedColumn = 0;\n    var previousGeneratedLine = 1;\n    var previousOriginalColumn = 0;\n    var previousOriginalLine = 0;\n    var previousName = 0;\n    var previousSource = 0;\n    var result = '';\n    var next;\n    var mapping;\n    var nameIdx;\n    var sourceIdx;\n\n    var mappings = this._mappings.toArray();\n    for (var i = 0, len = mappings.length; i < len; i++) {\n      mapping = mappings[i];\n      next = ''\n\n      if (mapping.generatedLine !== previousGeneratedLine) {\n        previousGeneratedColumn = 0;\n        while (mapping.generatedLine !== previousGeneratedLine) {\n          next += ';';\n          previousGeneratedLine++;\n        }\n      }\n      else {\n        if (i > 0) {\n          if (!util.compareByGeneratedPositionsInflated(mapping, mappings[i - 1])) {\n            continue;\n          }\n          next += ',';\n        }\n      }\n\n      next += base64VLQ.encode(mapping.generatedColumn\n                                 - previousGeneratedColumn);\n      previousGeneratedColumn = mapping.generatedColumn;\n\n      if (mapping.source != null) {\n        sourceIdx = this._sources.indexOf(mapping.source);\n        next += base64VLQ.encode(sourceIdx - previousSource);\n        previousSource = sourceIdx;\n\n        // lines are stored 0-based in SourceMap spec version 3\n        next += base64VLQ.encode(mapping.originalLine - 1\n                                   - previousOriginalLine);\n        previousOriginalLine = mapping.originalLine - 1;\n\n        next += base64VLQ.encode(mapping.originalColumn\n                                   - previousOriginalColumn);\n        previousOriginalColumn = mapping.originalColumn;\n\n        if (mapping.name != null) {\n          nameIdx = this._names.indexOf(mapping.name);\n          next += base64VLQ.encode(nameIdx - previousName);\n          previousName = nameIdx;\n        }\n      }\n\n      result += next;\n    }\n\n    return result;\n  };\n\nSourceMapGenerator.prototype._generateSourcesContent =\n  function SourceMapGenerator_generateSourcesContent(aSources, aSourceRoot) {\n    return aSources.map(function (source) {\n      if (!this._sourcesContents) {\n        return null;\n      }\n      if (aSourceRoot != null) {\n        source = util.relative(aSourceRoot, source);\n      }\n      var key = util.toSetString(source);\n      return Object.prototype.hasOwnProperty.call(this._sourcesContents, key)\n        ? this._sourcesContents[key]\n        : null;\n    }, this);\n  };\n\n/**\n * Externalize the source map.\n */\nSourceMapGenerator.prototype.toJSON =\n  function SourceMapGenerator_toJSON() {\n    var map = {\n      version: this._version,\n      sources: this._sources.toArray(),\n      names: this._names.toArray(),\n      mappings: this._serializeMappings()\n    };\n    if (this._file != null) {\n      map.file = this._file;\n    }\n    if (this._sourceRoot != null) {\n      map.sourceRoot = this._sourceRoot;\n    }\n    if (this._sourcesContents) {\n      map.sourcesContent = this._generateSourcesContent(map.sources, map.sourceRoot);\n    }\n\n    return map;\n  };\n\n/**\n * Render the source map being generated to a string.\n */\nSourceMapGenerator.prototype.toString =\n  function SourceMapGenerator_toString() {\n    return JSON.stringify(this.toJSON());\n  };\n\nexports.SourceMapGenerator = SourceMapGenerator;\n", "/* -*- Mode: js; js-indent-level: 2; -*- */\n/*\n * Copyright 2011 Mozilla Foundation and contributors\n * Licensed under the New BSD license. See LICENSE or:\n * http://opensource.org/licenses/BSD-3-Clause\n */\n\nexports.GREATEST_LOWER_BOUND = 1;\nexports.LEAST_UPPER_BOUND = 2;\n\n/**\n * Recursive implementation of binary search.\n *\n * @param aLow Indices here and lower do not contain the needle.\n * @param aHigh Indices here and higher do not contain the needle.\n * @param aNeedle The element being searched for.\n * @param aHaystack The non-empty array being searched.\n * @param aCompare Function which takes two elements and returns -1, 0, or 1.\n * @param aBias Either 'binarySearch.GREATEST_LOWER_BOUND' or\n *     'binarySearch.LEAST_UPPER_BOUND'. Specifies whether to return the\n *     closest element that is smaller than or greater than the one we are\n *     searching for, respectively, if the exact element cannot be found.\n */\nfunction recursiveSearch(aLow, aHigh, aNeedle, aHaystack, aCompare, aBias) {\n  // This function terminates when one of the following is true:\n  //\n  //   1. We find the exact element we are looking for.\n  //\n  //   2. We did not find the exact element, but we can return the index of\n  //      the next-closest element.\n  //\n  //   3. We did not find the exact element, and there is no next-closest\n  //      element than the one we are searching for, so we return -1.\n  var mid = Math.floor((aHigh - aLow) / 2) + aLow;\n  var cmp = aCompare(aNeedle, aHaystack[mid], true);\n  if (cmp === 0) {\n    // Found the element we are looking for.\n    return mid;\n  }\n  else if (cmp > 0) {\n    // Our needle is greater than aHaystack[mid].\n    if (aHigh - mid > 1) {\n      // The element is in the upper half.\n      return recursiveSearch(mid, aHigh, aNeedle, aHaystack, aCompare, aBias);\n    }\n\n    // The exact needle element was not found in this haystack. Determine if\n    // we are in termination case (3) or (2) and return the appropriate thing.\n    if (aBias == exports.LEAST_UPPER_BOUND) {\n      return aHigh < aHaystack.length ? aHigh : -1;\n    } else {\n      return mid;\n    }\n  }\n  else {\n    // Our needle is less than aHaystack[mid].\n    if (mid - aLow > 1) {\n      // The element is in the lower half.\n      return recursiveSearch(aLow, mid, aNeedle, aHaystack, aCompare, aBias);\n    }\n\n    // we are in termination case (3) or (2) and return the appropriate thing.\n    if (aBias == exports.LEAST_UPPER_BOUND) {\n      return mid;\n    } else {\n      return aLow < 0 ? -1 : aLow;\n    }\n  }\n}\n\n/**\n * This is an implementation of binary search which will always try and return\n * the index of the closest element if there is no exact hit. This is because\n * mappings between original and generated line/col pairs are single points,\n * and there is an implicit region between each of them, so a miss just means\n * that you aren't on the very start of a region.\n *\n * @param aNeedle The element you are looking for.\n * @param aHaystack The array that is being searched.\n * @param aCompare A function which takes the needle and an element in the\n *     array and returns -1, 0, or 1 depending on whether the needle is less\n *     than, equal to, or greater than the element, respectively.\n * @param aBias Either 'binarySearch.GREATEST_LOWER_BOUND' or\n *     'binarySearch.LEAST_UPPER_BOUND'. Specifies whether to return the\n *     closest element that is smaller than or greater than the one we are\n *     searching for, respectively, if the exact element cannot be found.\n *     Defaults to 'binarySearch.GREATEST_LOWER_BOUND'.\n */\nexports.search = function search(aNeedle, aHaystack, aCompare, aBias) {\n  if (aHaystack.length === 0) {\n    return -1;\n  }\n\n  var index = recursiveSearch(-1, aHaystack.length, aNeedle, aHaystack,\n                              aCompare, aBias || exports.GREATEST_LOWER_BOUND);\n  if (index < 0) {\n    return -1;\n  }\n\n  // We have found either the exact element, or the next-closest element than\n  // the one we are searching for. However, there may be more than one such\n  // element. Make sure we always return the smallest of these.\n  while (index - 1 >= 0) {\n    if (aCompare(aHaystack[index], aHaystack[index - 1], true) !== 0) {\n      break;\n    }\n    --index;\n  }\n\n  return index;\n};\n", "/* -*- Mode: js; js-indent-level: 2; -*- */\n/*\n * Copyright 2011 Mozilla Foundation and contributors\n * Licensed under the New BSD license. See LICENSE or:\n * http://opensource.org/licenses/BSD-3-Clause\n */\n\n// It turns out that some (most?) JavaScript engines don't self-host\n// `Array.prototype.sort`. This makes sense because C++ will likely remain\n// faster than JS when doing raw CPU-intensive sorting. However, when using a\n// custom comparator function, calling back and forth between the VM's C++ and\n// JIT'd JS is rather slow *and* loses JIT type information, resulting in\n// worse generated code for the comparator function than would be optimal. In\n// fact, when sorting with a comparator, these costs outweigh the benefits of\n// sorting in C++. By using our own JS-implemented Quick Sort (below), we get\n// a ~3500ms mean speed-up in `bench/bench.html`.\n\n/**\n * Swap the elements indexed by `x` and `y` in the array `ary`.\n *\n * @param {Array} ary\n *        The array.\n * @param {Number} x\n *        The index of the first item.\n * @param {Number} y\n *        The index of the second item.\n */\nfunction swap(ary, x, y) {\n  var temp = ary[x];\n  ary[x] = ary[y];\n  ary[y] = temp;\n}\n\n/**\n * Returns a random integer within the range `low .. high` inclusive.\n *\n * @param {Number} low\n *        The lower bound on the range.\n * @param {Number} high\n *        The upper bound on the range.\n */\nfunction randomIntInRange(low, high) {\n  return Math.round(low + (Math.random() * (high - low)));\n}\n\n/**\n * The Quick Sort algorithm.\n *\n * @param {Array} ary\n *        An array to sort.\n * @param {function} comparator\n *        Function to use to compare two items.\n * @param {Number} p\n *        Start index of the array\n * @param {Number} r\n *        End index of the array\n */\nfunction doQuickSort(ary, comparator, p, r) {\n  // If our lower bound is less than our upper bound, we (1) partition the\n  // array into two pieces and (2) recurse on each half. If it is not, this is\n  // the empty array and our base case.\n\n  if (p < r) {\n    // (1) Partitioning.\n    //\n    // The partitioning chooses a pivot between `p` and `r` and moves all\n    // elements that are less than or equal to the pivot to the before it, and\n    // all the elements that are greater than it after it. The effect is that\n    // once partition is done, the pivot is in the exact place it will be when\n    // the array is put in sorted order, and it will not need to be moved\n    // again. This runs in O(n) time.\n\n    // Always choose a random pivot so that an input array which is reverse\n    // sorted does not cause O(n^2) running time.\n    var pivotIndex = randomIntInRange(p, r);\n    var i = p - 1;\n\n    swap(ary, pivotIndex, r);\n    var pivot = ary[r];\n\n    // Immediately after `j` is incremented in this loop, the following hold\n    // true:\n    //\n    //   * Every element in `ary[p .. i]` is less than or equal to the pivot.\n    //\n    //   * Every element in `ary[i+1 .. j-1]` is greater than the pivot.\n    for (var j = p; j < r; j++) {\n      if (comparator(ary[j], pivot) <= 0) {\n        i += 1;\n        swap(ary, i, j);\n      }\n    }\n\n    swap(ary, i + 1, j);\n    var q = i + 1;\n\n    // (2) Recurse on each half.\n\n    doQuickSort(ary, comparator, p, q - 1);\n    doQuickSort(ary, comparator, q + 1, r);\n  }\n}\n\n/**\n * Sort the given array in-place with the given comparator function.\n *\n * @param {Array} ary\n *        An array to sort.\n * @param {function} comparator\n *        Function to use to compare two items.\n */\nexports.quickSort = function (ary, comparator) {\n  doQuickSort(ary, comparator, 0, ary.length - 1);\n};\n", "/* -*- Mode: js; js-indent-level: 2; -*- */\n/*\n * Copyright 2011 Mozilla Foundation and contributors\n * Licensed under the New BSD license. See LICENSE or:\n * http://opensource.org/licenses/BSD-3-Clause\n */\n\nvar util = require('./util');\nvar binarySearch = require('./binary-search');\nvar ArraySet = require('./array-set').ArraySet;\nvar base64VLQ = require('./base64-vlq');\nvar quickSort = require('./quick-sort').quickSort;\n\nfunction SourceMapConsumer(aSourceMap, aSourceMapURL) {\n  var sourceMap = aSourceMap;\n  if (typeof aSourceMap === 'string') {\n    sourceMap = util.parseSourceMapInput(aSourceMap);\n  }\n\n  return sourceMap.sections != null\n    ? new IndexedSourceMapConsumer(sourceMap, aSourceMapURL)\n    : new BasicSourceMapConsumer(sourceMap, aSourceMapURL);\n}\n\nSourceMapConsumer.fromSourceMap = function(aSourceMap, aSourceMapURL) {\n  return BasicSourceMapConsumer.fromSourceMap(aSourceMap, aSourceMapURL);\n}\n\n/**\n * The version of the source mapping spec that we are consuming.\n */\nSourceMapConsumer.prototype._version = 3;\n\n// `__generatedMappings` and `__originalMappings` are arrays that hold the\n// parsed mapping coordinates from the source map's \"mappings\" attribute. They\n// are lazily instantiated, accessed via the `_generatedMappings` and\n// `_originalMappings` getters respectively, and we only parse the mappings\n// and create these arrays once queried for a source location. We jump through\n// these hoops because there can be many thousands of mappings, and parsing\n// them is expensive, so we only want to do it if we must.\n//\n// Each object in the arrays is of the form:\n//\n//     {\n//       generatedLine: The line number in the generated code,\n//       generatedColumn: The column number in the generated code,\n//       source: The path to the original source file that generated this\n//               chunk of code,\n//       originalLine: The line number in the original source that\n//                     corresponds to this chunk of generated code,\n//       originalColumn: The column number in the original source that\n//                       corresponds to this chunk of generated code,\n//       name: The name of the original symbol which generated this chunk of\n//             code.\n//     }\n//\n// All properties except for `generatedLine` and `generatedColumn` can be\n// `null`.\n//\n// `_generatedMappings` is ordered by the generated positions.\n//\n// `_originalMappings` is ordered by the original positions.\n\nSourceMapConsumer.prototype.__generatedMappings = null;\nObject.defineProperty(SourceMapConsumer.prototype, '_generatedMappings', {\n  configurable: true,\n  enumerable: true,\n  get: function () {\n    if (!this.__generatedMappings) {\n      this._parseMappings(this._mappings, this.sourceRoot);\n    }\n\n    return this.__generatedMappings;\n  }\n});\n\nSourceMapConsumer.prototype.__originalMappings = null;\nObject.defineProperty(SourceMapConsumer.prototype, '_originalMappings', {\n  configurable: true,\n  enumerable: true,\n  get: function () {\n    if (!this.__originalMappings) {\n      this._parseMappings(this._mappings, this.sourceRoot);\n    }\n\n    return this.__originalMappings;\n  }\n});\n\nSourceMapConsumer.prototype._charIsMappingSeparator =\n  function SourceMapConsumer_charIsMappingSeparator(aStr, index) {\n    var c = aStr.charAt(index);\n    return c === \";\" || c === \",\";\n  };\n\n/**\n * Parse the mappings in a string in to a data structure which we can easily\n * query (the ordered arrays in the `this.__generatedMappings` and\n * `this.__originalMappings` properties).\n */\nSourceMapConsumer.prototype._parseMappings =\n  function SourceMapConsumer_parseMappings(aStr, aSourceRoot) {\n    throw new Error(\"Subclasses must implement _parseMappings\");\n  };\n\nSourceMapConsumer.GENERATED_ORDER = 1;\nSourceMapConsumer.ORIGINAL_ORDER = 2;\n\nSourceMapConsumer.GREATEST_LOWER_BOUND = 1;\nSourceMapConsumer.LEAST_UPPER_BOUND = 2;\n\n/**\n * Iterate over each mapping between an original source/line/column and a\n * generated line/column in this source map.\n *\n * @param Function aCallback\n *        The function that is called with each mapping.\n * @param Object aContext\n *        Optional. If specified, this object will be the value of `this` every\n *        time that `aCallback` is called.\n * @param aOrder\n *        Either `SourceMapConsumer.GENERATED_ORDER` or\n *        `SourceMapConsumer.ORIGINAL_ORDER`. Specifies whether you want to\n *        iterate over the mappings sorted by the generated file's line/column\n *        order or the original's source/line/column order, respectively. Defaults to\n *        `SourceMapConsumer.GENERATED_ORDER`.\n */\nSourceMapConsumer.prototype.eachMapping =\n  function SourceMapConsumer_eachMapping(aCallback, aContext, aOrder) {\n    var context = aContext || null;\n    var order = aOrder || SourceMapConsumer.GENERATED_ORDER;\n\n    var mappings;\n    switch (order) {\n    case SourceMapConsumer.GENERATED_ORDER:\n      mappings = this._generatedMappings;\n      break;\n    case SourceMapConsumer.ORIGINAL_ORDER:\n      mappings = this._originalMappings;\n      break;\n    default:\n      throw new Error(\"Unknown order of iteration.\");\n    }\n\n    var sourceRoot = this.sourceRoot;\n    mappings.map(function (mapping) {\n      var source = mapping.source === null ? null : this._sources.at(mapping.source);\n      source = util.computeSourceURL(sourceRoot, source, this._sourceMapURL);\n      return {\n        source: source,\n        generatedLine: mapping.generatedLine,\n        generatedColumn: mapping.generatedColumn,\n        originalLine: mapping.originalLine,\n        originalColumn: mapping.originalColumn,\n        name: mapping.name === null ? null : this._names.at(mapping.name)\n      };\n    }, this).forEach(aCallback, context);\n  };\n\n/**\n * Returns all generated line and column information for the original source,\n * line, and column provided. If no column is provided, returns all mappings\n * corresponding to a either the line we are searching for or the next\n * closest line that has any mappings. Otherwise, returns all mappings\n * corresponding to the given line and either the column we are searching for\n * or the next closest column that has any offsets.\n *\n * The only argument is an object with the following properties:\n *\n *   - source: The filename of the original source.\n *   - line: The line number in the original source.  The line number is 1-based.\n *   - column: Optional. the column number in the original source.\n *    The column number is 0-based.\n *\n * and an array of objects is returned, each with the following properties:\n *\n *   - line: The line number in the generated source, or null.  The\n *    line number is 1-based.\n *   - column: The column number in the generated source, or null.\n *    The column number is 0-based.\n */\nSourceMapConsumer.prototype.allGeneratedPositionsFor =\n  function SourceMapConsumer_allGeneratedPositionsFor(aArgs) {\n    var line = util.getArg(aArgs, 'line');\n\n    // When there is no exact match, BasicSourceMapConsumer.prototype._findMapping\n    // returns the index of the closest mapping less than the needle. By\n    // setting needle.originalColumn to 0, we thus find the last mapping for\n    // the given line, provided such a mapping exists.\n    var needle = {\n      source: util.getArg(aArgs, 'source'),\n      originalLine: line,\n      originalColumn: util.getArg(aArgs, 'column', 0)\n    };\n\n    needle.source = this._findSourceIndex(needle.source);\n    if (needle.source < 0) {\n      return [];\n    }\n\n    var mappings = [];\n\n    var index = this._findMapping(needle,\n                                  this._originalMappings,\n                                  \"originalLine\",\n                                  \"originalColumn\",\n                                  util.compareByOriginalPositions,\n                                  binarySearch.LEAST_UPPER_BOUND);\n    if (index >= 0) {\n      var mapping = this._originalMappings[index];\n\n      if (aArgs.column === undefined) {\n        var originalLine = mapping.originalLine;\n\n        // Iterate until either we run out of mappings, or we run into\n        // a mapping for a different line than the one we found. Since\n        // mappings are sorted, this is guaranteed to find all mappings for\n        // the line we found.\n        while (mapping && mapping.originalLine === originalLine) {\n          mappings.push({\n            line: util.getArg(mapping, 'generatedLine', null),\n            column: util.getArg(mapping, 'generatedColumn', null),\n            lastColumn: util.getArg(mapping, 'lastGeneratedColumn', null)\n          });\n\n          mapping = this._originalMappings[++index];\n        }\n      } else {\n        var originalColumn = mapping.originalColumn;\n\n        // Iterate until either we run out of mappings, or we run into\n        // a mapping for a different line than the one we were searching for.\n        // Since mappings are sorted, this is guaranteed to find all mappings for\n        // the line we are searching for.\n        while (mapping &&\n               mapping.originalLine === line &&\n               mapping.originalColumn == originalColumn) {\n          mappings.push({\n            line: util.getArg(mapping, 'generatedLine', null),\n            column: util.getArg(mapping, 'generatedColumn', null),\n            lastColumn: util.getArg(mapping, 'lastGeneratedColumn', null)\n          });\n\n          mapping = this._originalMappings[++index];\n        }\n      }\n    }\n\n    return mappings;\n  };\n\nexports.SourceMapConsumer = SourceMapConsumer;\n\n/**\n * A BasicSourceMapConsumer instance represents a parsed source map which we can\n * query for information about the original file positions by giving it a file\n * position in the generated source.\n *\n * The first parameter is the raw source map (either as a JSON string, or\n * already parsed to an object). According to the spec, source maps have the\n * following attributes:\n *\n *   - version: Which version of the source map spec this map is following.\n *   - sources: An array of URLs to the original source files.\n *   - names: An array of identifiers which can be referrenced by individual mappings.\n *   - sourceRoot: Optional. The URL root from which all sources are relative.\n *   - sourcesContent: Optional. An array of contents of the original source files.\n *   - mappings: A string of base64 VLQs which contain the actual mappings.\n *   - file: Optional. The generated file this source map is associated with.\n *\n * Here is an example source map, taken from the source map spec[0]:\n *\n *     {\n *       version : 3,\n *       file: \"out.js\",\n *       sourceRoot : \"\",\n *       sources: [\"foo.js\", \"bar.js\"],\n *       names: [\"src\", \"maps\", \"are\", \"fun\"],\n *       mappings: \"AA,AB;;ABCDE;\"\n *     }\n *\n * The second parameter, if given, is a string whose value is the URL\n * at which the source map was found.  This URL is used to compute the\n * sources array.\n *\n * [0]: https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit?pli=1#\n */\nfunction BasicSourceMapConsumer(aSourceMap, aSourceMapURL) {\n  var sourceMap = aSourceMap;\n  if (typeof aSourceMap === 'string') {\n    sourceMap = util.parseSourceMapInput(aSourceMap);\n  }\n\n  var version = util.getArg(sourceMap, 'version');\n  var sources = util.getArg(sourceMap, 'sources');\n  // Sass 3.3 leaves out the 'names' array, so we deviate from the spec (which\n  // requires the array) to play nice here.\n  var names = util.getArg(sourceMap, 'names', []);\n  var sourceRoot = util.getArg(sourceMap, 'sourceRoot', null);\n  var sourcesContent = util.getArg(sourceMap, 'sourcesContent', null);\n  var mappings = util.getArg(sourceMap, 'mappings');\n  var file = util.getArg(sourceMap, 'file', null);\n\n  // Once again, Sass deviates from the spec and supplies the version as a\n  // string rather than a number, so we use loose equality checking here.\n  if (version != this._version) {\n    throw new Error('Unsupported version: ' + version);\n  }\n\n  if (sourceRoot) {\n    sourceRoot = util.normalize(sourceRoot);\n  }\n\n  sources = sources\n    .map(String)\n    // Some source maps produce relative source paths like \"./foo.js\" instead of\n    // \"foo.js\".  Normalize these first so that future comparisons will succeed.\n    // See bugzil.la/1090768.\n    .map(util.normalize)\n    // Always ensure that absolute sources are internally stored relative to\n    // the source root, if the source root is absolute. Not doing this would\n    // be particularly problematic when the source root is a prefix of the\n    // source (valid, but why??). See github issue #199 and bugzil.la/1188982.\n    .map(function (source) {\n      return sourceRoot && util.isAbsolute(sourceRoot) && util.isAbsolute(source)\n        ? util.relative(sourceRoot, source)\n        : source;\n    });\n\n  // Pass `true` below to allow duplicate names and sources. While source maps\n  // are intended to be compressed and deduplicated, the TypeScript compiler\n  // sometimes generates source maps with duplicates in them. See Github issue\n  // #72 and bugzil.la/889492.\n  this._names = ArraySet.fromArray(names.map(String), true);\n  this._sources = ArraySet.fromArray(sources, true);\n\n  this._absoluteSources = this._sources.toArray().map(function (s) {\n    return util.computeSourceURL(sourceRoot, s, aSourceMapURL);\n  });\n\n  this.sourceRoot = sourceRoot;\n  this.sourcesContent = sourcesContent;\n  this._mappings = mappings;\n  this._sourceMapURL = aSourceMapURL;\n  this.file = file;\n}\n\nBasicSourceMapConsumer.prototype = Object.create(SourceMapConsumer.prototype);\nBasicSourceMapConsumer.prototype.consumer = SourceMapConsumer;\n\n/**\n * Utility function to find the index of a source.  Returns -1 if not\n * found.\n */\nBasicSourceMapConsumer.prototype._findSourceIndex = function(aSource) {\n  var relativeSource = aSource;\n  if (this.sourceRoot != null) {\n    relativeSource = util.relative(this.sourceRoot, relativeSource);\n  }\n\n  if (this._sources.has(relativeSource)) {\n    return this._sources.indexOf(relativeSource);\n  }\n\n  // Maybe aSource is an absolute URL as returned by |sources|.  In\n  // this case we can't simply undo the transform.\n  var i;\n  for (i = 0; i < this._absoluteSources.length; ++i) {\n    if (this._absoluteSources[i] == aSource) {\n      return i;\n    }\n  }\n\n  return -1;\n};\n\n/**\n * Create a BasicSourceMapConsumer from a SourceMapGenerator.\n *\n * @param SourceMapGenerator aSourceMap\n *        The source map that will be consumed.\n * @param String aSourceMapURL\n *        The URL at which the source map can be found (optional)\n * @returns BasicSourceMapConsumer\n */\nBasicSourceMapConsumer.fromSourceMap =\n  function SourceMapConsumer_fromSourceMap(aSourceMap, aSourceMapURL) {\n    var smc = Object.create(BasicSourceMapConsumer.prototype);\n\n    var names = smc._names = ArraySet.fromArray(aSourceMap._names.toArray(), true);\n    var sources = smc._sources = ArraySet.fromArray(aSourceMap._sources.toArray(), true);\n    smc.sourceRoot = aSourceMap._sourceRoot;\n    smc.sourcesContent = aSourceMap._generateSourcesContent(smc._sources.toArray(),\n                                                            smc.sourceRoot);\n    smc.file = aSourceMap._file;\n    smc._sourceMapURL = aSourceMapURL;\n    smc._absoluteSources = smc._sources.toArray().map(function (s) {\n      return util.computeSourceURL(smc.sourceRoot, s, aSourceMapURL);\n    });\n\n    // Because we are modifying the entries (by converting string sources and\n    // names to indices into the sources and names ArraySets), we have to make\n    // a copy of the entry or else bad things happen. Shared mutable state\n    // strikes again! See github issue #191.\n\n    var generatedMappings = aSourceMap._mappings.toArray().slice();\n    var destGeneratedMappings = smc.__generatedMappings = [];\n    var destOriginalMappings = smc.__originalMappings = [];\n\n    for (var i = 0, length = generatedMappings.length; i < length; i++) {\n      var srcMapping = generatedMappings[i];\n      var destMapping = new Mapping;\n      destMapping.generatedLine = srcMapping.generatedLine;\n      destMapping.generatedColumn = srcMapping.generatedColumn;\n\n      if (srcMapping.source) {\n        destMapping.source = sources.indexOf(srcMapping.source);\n        destMapping.originalLine = srcMapping.originalLine;\n        destMapping.originalColumn = srcMapping.originalColumn;\n\n        if (srcMapping.name) {\n          destMapping.name = names.indexOf(srcMapping.name);\n        }\n\n        destOriginalMappings.push(destMapping);\n      }\n\n      destGeneratedMappings.push(destMapping);\n    }\n\n    quickSort(smc.__originalMappings, util.compareByOriginalPositions);\n\n    return smc;\n  };\n\n/**\n * The version of the source mapping spec that we are consuming.\n */\nBasicSourceMapConsumer.prototype._version = 3;\n\n/**\n * The list of original sources.\n */\nObject.defineProperty(BasicSourceMapConsumer.prototype, 'sources', {\n  get: function () {\n    return this._absoluteSources.slice();\n  }\n});\n\n/**\n * Provide the JIT with a nice shape / hidden class.\n */\nfunction Mapping() {\n  this.generatedLine = 0;\n  this.generatedColumn = 0;\n  this.source = null;\n  this.originalLine = null;\n  this.originalColumn = null;\n  this.name = null;\n}\n\n/**\n * Parse the mappings in a string in to a data structure which we can easily\n * query (the ordered arrays in the `this.__generatedMappings` and\n * `this.__originalMappings` properties).\n */\nBasicSourceMapConsumer.prototype._parseMappings =\n  function SourceMapConsumer_parseMappings(aStr, aSourceRoot) {\n    var generatedLine = 1;\n    var previousGeneratedColumn = 0;\n    var previousOriginalLine = 0;\n    var previousOriginalColumn = 0;\n    var previousSource = 0;\n    var previousName = 0;\n    var length = aStr.length;\n    var index = 0;\n    var cachedSegments = {};\n    var temp = {};\n    var originalMappings = [];\n    var generatedMappings = [];\n    var mapping, str, segment, end, value;\n\n    while (index < length) {\n      if (aStr.charAt(index) === ';') {\n        generatedLine++;\n        index++;\n        previousGeneratedColumn = 0;\n      }\n      else if (aStr.charAt(index) === ',') {\n        index++;\n      }\n      else {\n        mapping = new Mapping();\n        mapping.generatedLine = generatedLine;\n\n        // Because each offset is encoded relative to the previous one,\n        // many segments often have the same encoding. We can exploit this\n        // fact by caching the parsed variable length fields of each segment,\n        // allowing us to avoid a second parse if we encounter the same\n        // segment again.\n        for (end = index; end < length; end++) {\n          if (this._charIsMappingSeparator(aStr, end)) {\n            break;\n          }\n        }\n        str = aStr.slice(index, end);\n\n        segment = cachedSegments[str];\n        if (segment) {\n          index += str.length;\n        } else {\n          segment = [];\n          while (index < end) {\n            base64VLQ.decode(aStr, index, temp);\n            value = temp.value;\n            index = temp.rest;\n            segment.push(value);\n          }\n\n          if (segment.length === 2) {\n            throw new Error('Found a source, but no line and column');\n          }\n\n          if (segment.length === 3) {\n            throw new Error('Found a source and line, but no column');\n          }\n\n          cachedSegments[str] = segment;\n        }\n\n        // Generated column.\n        mapping.generatedColumn = previousGeneratedColumn + segment[0];\n        previousGeneratedColumn = mapping.generatedColumn;\n\n        if (segment.length > 1) {\n          // Original source.\n          mapping.source = previousSource + segment[1];\n          previousSource += segment[1];\n\n          // Original line.\n          mapping.originalLine = previousOriginalLine + segment[2];\n          previousOriginalLine = mapping.originalLine;\n          // Lines are stored 0-based\n          mapping.originalLine += 1;\n\n          // Original column.\n          mapping.originalColumn = previousOriginalColumn + segment[3];\n          previousOriginalColumn = mapping.originalColumn;\n\n          if (segment.length > 4) {\n            // Original name.\n            mapping.name = previousName + segment[4];\n            previousName += segment[4];\n          }\n        }\n\n        generatedMappings.push(mapping);\n        if (typeof mapping.originalLine === 'number') {\n          originalMappings.push(mapping);\n        }\n      }\n    }\n\n    quickSort(generatedMappings, util.compareByGeneratedPositionsDeflated);\n    this.__generatedMappings = generatedMappings;\n\n    quickSort(originalMappings, util.compareByOriginalPositions);\n    this.__originalMappings = originalMappings;\n  };\n\n/**\n * Find the mapping that best matches the hypothetical \"needle\" mapping that\n * we are searching for in the given \"haystack\" of mappings.\n */\nBasicSourceMapConsumer.prototype._findMapping =\n  function SourceMapConsumer_findMapping(aNeedle, aMappings, aLineName,\n                                         aColumnName, aComparator, aBias) {\n    // To return the position we are searching for, we must first find the\n    // mapping for the given position and then return the opposite position it\n    // points to. Because the mappings are sorted, we can use binary search to\n    // find the best mapping.\n\n    if (aNeedle[aLineName] <= 0) {\n      throw new TypeError('Line must be greater than or equal to 1, got '\n                          + aNeedle[aLineName]);\n    }\n    if (aNeedle[aColumnName] < 0) {\n      throw new TypeError('Column must be greater than or equal to 0, got '\n                          + aNeedle[aColumnName]);\n    }\n\n    return binarySearch.search(aNeedle, aMappings, aComparator, aBias);\n  };\n\n/**\n * Compute the last column for each generated mapping. The last column is\n * inclusive.\n */\nBasicSourceMapConsumer.prototype.computeColumnSpans =\n  function SourceMapConsumer_computeColumnSpans() {\n    for (var index = 0; index < this._generatedMappings.length; ++index) {\n      var mapping = this._generatedMappings[index];\n\n      // Mappings do not contain a field for the last generated columnt. We\n      // can come up with an optimistic estimate, however, by assuming that\n      // mappings are contiguous (i.e. given two consecutive mappings, the\n      // first mapping ends where the second one starts).\n      if (index + 1 < this._generatedMappings.length) {\n        var nextMapping = this._generatedMappings[index + 1];\n\n        if (mapping.generatedLine === nextMapping.generatedLine) {\n          mapping.lastGeneratedColumn = nextMapping.generatedColumn - 1;\n          continue;\n        }\n      }\n\n      // The last mapping for each line spans the entire line.\n      mapping.lastGeneratedColumn = Infinity;\n    }\n  };\n\n/**\n * Returns the original source, line, and column information for the generated\n * source's line and column positions provided. The only argument is an object\n * with the following properties:\n *\n *   - line: The line number in the generated source.  The line number\n *     is 1-based.\n *   - column: The column number in the generated source.  The column\n *     number is 0-based.\n *   - bias: Either 'SourceMapConsumer.GREATEST_LOWER_BOUND' or\n *     'SourceMapConsumer.LEAST_UPPER_BOUND'. Specifies whether to return the\n *     closest element that is smaller than or greater than the one we are\n *     searching for, respectively, if the exact element cannot be found.\n *     Defaults to 'SourceMapConsumer.GREATEST_LOWER_BOUND'.\n *\n * and an object is returned with the following properties:\n *\n *   - source: The original source file, or null.\n *   - line: The line number in the original source, or null.  The\n *     line number is 1-based.\n *   - column: The column number in the original source, or null.  The\n *     column number is 0-based.\n *   - name: The original identifier, or null.\n */\nBasicSourceMapConsumer.prototype.originalPositionFor =\n  function SourceMapConsumer_originalPositionFor(aArgs) {\n    var needle = {\n      generatedLine: util.getArg(aArgs, 'line'),\n      generatedColumn: util.getArg(aArgs, 'column')\n    };\n\n    var index = this._findMapping(\n      needle,\n      this._generatedMappings,\n      \"generatedLine\",\n      \"generatedColumn\",\n      util.compareByGeneratedPositionsDeflated,\n      util.getArg(aArgs, 'bias', SourceMapConsumer.GREATEST_LOWER_BOUND)\n    );\n\n    if (index >= 0) {\n      var mapping = this._generatedMappings[index];\n\n      if (mapping.generatedLine === needle.generatedLine) {\n        var source = util.getArg(mapping, 'source', null);\n        if (source !== null) {\n          source = this._sources.at(source);\n          source = util.computeSourceURL(this.sourceRoot, source, this._sourceMapURL);\n        }\n        var name = util.getArg(mapping, 'name', null);\n        if (name !== null) {\n          name = this._names.at(name);\n        }\n        return {\n          source: source,\n          line: util.getArg(mapping, 'originalLine', null),\n          column: util.getArg(mapping, 'originalColumn', null),\n          name: name\n        };\n      }\n    }\n\n    return {\n      source: null,\n      line: null,\n      column: null,\n      name: null\n    };\n  };\n\n/**\n * Return true if we have the source content for every source in the source\n * map, false otherwise.\n */\nBasicSourceMapConsumer.prototype.hasContentsOfAllSources =\n  function BasicSourceMapConsumer_hasContentsOfAllSources() {\n    if (!this.sourcesContent) {\n      return false;\n    }\n    return this.sourcesContent.length >= this._sources.size() &&\n      !this.sourcesContent.some(function (sc) { return sc == null; });\n  };\n\n/**\n * Returns the original source content. The only argument is the url of the\n * original source file. Returns null if no original source content is\n * available.\n */\nBasicSourceMapConsumer.prototype.sourceContentFor =\n  function SourceMapConsumer_sourceContentFor(aSource, nullOnMissing) {\n    if (!this.sourcesContent) {\n      return null;\n    }\n\n    var index = this._findSourceIndex(aSource);\n    if (index >= 0) {\n      return this.sourcesContent[index];\n    }\n\n    var relativeSource = aSource;\n    if (this.sourceRoot != null) {\n      relativeSource = util.relative(this.sourceRoot, relativeSource);\n    }\n\n    var url;\n    if (this.sourceRoot != null\n        && (url = util.urlParse(this.sourceRoot))) {\n      // XXX: file:// URIs and absolute paths lead to unexpected behavior for\n      // many users. We can help them out when they expect file:// URIs to\n      // behave like it would if they were running a local HTTP server. See\n      // https://bugzilla.mozilla.org/show_bug.cgi?id=885597.\n      var fileUriAbsPath = relativeSource.replace(/^file:\\/\\//, \"\");\n      if (url.scheme == \"file\"\n          && this._sources.has(fileUriAbsPath)) {\n        return this.sourcesContent[this._sources.indexOf(fileUriAbsPath)]\n      }\n\n      if ((!url.path || url.path == \"/\")\n          && this._sources.has(\"/\" + relativeSource)) {\n        return this.sourcesContent[this._sources.indexOf(\"/\" + relativeSource)];\n      }\n    }\n\n    // This function is used recursively from\n    // IndexedSourceMapConsumer.prototype.sourceContentFor. In that case, we\n    // don't want to throw if we can't find the source - we just want to\n    // return null, so we provide a flag to exit gracefully.\n    if (nullOnMissing) {\n      return null;\n    }\n    else {\n      throw new Error('\"' + relativeSource + '\" is not in the SourceMap.');\n    }\n  };\n\n/**\n * Returns the generated line and column information for the original source,\n * line, and column positions provided. The only argument is an object with\n * the following properties:\n *\n *   - source: The filename of the original source.\n *   - line: The line number in the original source.  The line number\n *     is 1-based.\n *   - column: The column number in the original source.  The column\n *     number is 0-based.\n *   - bias: Either 'SourceMapConsumer.GREATEST_LOWER_BOUND' or\n *     'SourceMapConsumer.LEAST_UPPER_BOUND'. Specifies whether to return the\n *     closest element that is smaller than or greater than the one we are\n *     searching for, respectively, if the exact element cannot be found.\n *     Defaults to 'SourceMapConsumer.GREATEST_LOWER_BOUND'.\n *\n * and an object is returned with the following properties:\n *\n *   - line: The line number in the generated source, or null.  The\n *     line number is 1-based.\n *   - column: The column number in the generated source, or null.\n *     The column number is 0-based.\n */\nBasicSourceMapConsumer.prototype.generatedPositionFor =\n  function SourceMapConsumer_generatedPositionFor(aArgs) {\n    var source = util.getArg(aArgs, 'source');\n    source = this._findSourceIndex(source);\n    if (source < 0) {\n      return {\n        line: null,\n        column: null,\n        lastColumn: null\n      };\n    }\n\n    var needle = {\n      source: source,\n      originalLine: util.getArg(aArgs, 'line'),\n      originalColumn: util.getArg(aArgs, 'column')\n    };\n\n    var index = this._findMapping(\n      needle,\n      this._originalMappings,\n      \"originalLine\",\n      \"originalColumn\",\n      util.compareByOriginalPositions,\n      util.getArg(aArgs, 'bias', SourceMapConsumer.GREATEST_LOWER_BOUND)\n    );\n\n    if (index >= 0) {\n      var mapping = this._originalMappings[index];\n\n      if (mapping.source === needle.source) {\n        return {\n          line: util.getArg(mapping, 'generatedLine', null),\n          column: util.getArg(mapping, 'generatedColumn', null),\n          lastColumn: util.getArg(mapping, 'lastGeneratedColumn', null)\n        };\n      }\n    }\n\n    return {\n      line: null,\n      column: null,\n      lastColumn: null\n    };\n  };\n\nexports.BasicSourceMapConsumer = BasicSourceMapConsumer;\n\n/**\n * An IndexedSourceMapConsumer instance represents a parsed source map which\n * we can query for information. It differs from BasicSourceMapConsumer in\n * that it takes \"indexed\" source maps (i.e. ones with a \"sections\" field) as\n * input.\n *\n * The first parameter is a raw source map (either as a JSON string, or already\n * parsed to an object). According to the spec for indexed source maps, they\n * have the following attributes:\n *\n *   - version: Which version of the source map spec this map is following.\n *   - file: Optional. The generated file this source map is associated with.\n *   - sections: A list of section definitions.\n *\n * Each value under the \"sections\" field has two fields:\n *   - offset: The offset into the original specified at which this section\n *       begins to apply, defined as an object with a \"line\" and \"column\"\n *       field.\n *   - map: A source map definition. This source map could also be indexed,\n *       but doesn't have to be.\n *\n * Instead of the \"map\" field, it's also possible to have a \"url\" field\n * specifying a URL to retrieve a source map from, but that's currently\n * unsupported.\n *\n * Here's an example source map, taken from the source map spec[0], but\n * modified to omit a section which uses the \"url\" field.\n *\n *  {\n *    version : 3,\n *    file: \"app.js\",\n *    sections: [{\n *      offset: {line:100, column:10},\n *      map: {\n *        version : 3,\n *        file: \"section.js\",\n *        sources: [\"foo.js\", \"bar.js\"],\n *        names: [\"src\", \"maps\", \"are\", \"fun\"],\n *        mappings: \"AAAA,E;;ABCDE;\"\n *      }\n *    }],\n *  }\n *\n * The second parameter, if given, is a string whose value is the URL\n * at which the source map was found.  This URL is used to compute the\n * sources array.\n *\n * [0]: https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit#heading=h.535es3xeprgt\n */\nfunction IndexedSourceMapConsumer(aSourceMap, aSourceMapURL) {\n  var sourceMap = aSourceMap;\n  if (typeof aSourceMap === 'string') {\n    sourceMap = util.parseSourceMapInput(aSourceMap);\n  }\n\n  var version = util.getArg(sourceMap, 'version');\n  var sections = util.getArg(sourceMap, 'sections');\n\n  if (version != this._version) {\n    throw new Error('Unsupported version: ' + version);\n  }\n\n  this._sources = new ArraySet();\n  this._names = new ArraySet();\n\n  var lastOffset = {\n    line: -1,\n    column: 0\n  };\n  this._sections = sections.map(function (s) {\n    if (s.url) {\n      // The url field will require support for asynchronicity.\n      // See https://github.com/mozilla/source-map/issues/16\n      throw new Error('Support for url field in sections not implemented.');\n    }\n    var offset = util.getArg(s, 'offset');\n    var offsetLine = util.getArg(offset, 'line');\n    var offsetColumn = util.getArg(offset, 'column');\n\n    if (offsetLine < lastOffset.line ||\n        (offsetLine === lastOffset.line && offsetColumn < lastOffset.column)) {\n      throw new Error('Section offsets must be ordered and non-overlapping.');\n    }\n    lastOffset = offset;\n\n    return {\n      generatedOffset: {\n        // The offset fields are 0-based, but we use 1-based indices when\n        // encoding/decoding from VLQ.\n        generatedLine: offsetLine + 1,\n        generatedColumn: offsetColumn + 1\n      },\n      consumer: new SourceMapConsumer(util.getArg(s, 'map'), aSourceMapURL)\n    }\n  });\n}\n\nIndexedSourceMapConsumer.prototype = Object.create(SourceMapConsumer.prototype);\nIndexedSourceMapConsumer.prototype.constructor = SourceMapConsumer;\n\n/**\n * The version of the source mapping spec that we are consuming.\n */\nIndexedSourceMapConsumer.prototype._version = 3;\n\n/**\n * The list of original sources.\n */\nObject.defineProperty(IndexedSourceMapConsumer.prototype, 'sources', {\n  get: function () {\n    var sources = [];\n    for (var i = 0; i < this._sections.length; i++) {\n      for (var j = 0; j < this._sections[i].consumer.sources.length; j++) {\n        sources.push(this._sections[i].consumer.sources[j]);\n      }\n    }\n    return sources;\n  }\n});\n\n/**\n * Returns the original source, line, and column information for the generated\n * source's line and column positions provided. The only argument is an object\n * with the following properties:\n *\n *   - line: The line number in the generated source.  The line number\n *     is 1-based.\n *   - column: The column number in the generated source.  The column\n *     number is 0-based.\n *\n * and an object is returned with the following properties:\n *\n *   - source: The original source file, or null.\n *   - line: The line number in the original source, or null.  The\n *     line number is 1-based.\n *   - column: The column number in the original source, or null.  The\n *     column number is 0-based.\n *   - name: The original identifier, or null.\n */\nIndexedSourceMapConsumer.prototype.originalPositionFor =\n  function IndexedSourceMapConsumer_originalPositionFor(aArgs) {\n    var needle = {\n      generatedLine: util.getArg(aArgs, 'line'),\n      generatedColumn: util.getArg(aArgs, 'column')\n    };\n\n    // Find the section containing the generated position we're trying to map\n    // to an original position.\n    var sectionIndex = binarySearch.search(needle, this._sections,\n      function(needle, section) {\n        var cmp = needle.generatedLine - section.generatedOffset.generatedLine;\n        if (cmp) {\n          return cmp;\n        }\n\n        return (needle.generatedColumn -\n                section.generatedOffset.generatedColumn);\n      });\n    var section = this._sections[sectionIndex];\n\n    if (!section) {\n      return {\n        source: null,\n        line: null,\n        column: null,\n        name: null\n      };\n    }\n\n    return section.consumer.originalPositionFor({\n      line: needle.generatedLine -\n        (section.generatedOffset.generatedLine - 1),\n      column: needle.generatedColumn -\n        (section.generatedOffset.generatedLine === needle.generatedLine\n         ? section.generatedOffset.generatedColumn - 1\n         : 0),\n      bias: aArgs.bias\n    });\n  };\n\n/**\n * Return true if we have the source content for every source in the source\n * map, false otherwise.\n */\nIndexedSourceMapConsumer.prototype.hasContentsOfAllSources =\n  function IndexedSourceMapConsumer_hasContentsOfAllSources() {\n    return this._sections.every(function (s) {\n      return s.consumer.hasContentsOfAllSources();\n    });\n  };\n\n/**\n * Returns the original source content. The only argument is the url of the\n * original source file. Returns null if no original source content is\n * available.\n */\nIndexedSourceMapConsumer.prototype.sourceContentFor =\n  function IndexedSourceMapConsumer_sourceContentFor(aSource, nullOnMissing) {\n    for (var i = 0; i < this._sections.length; i++) {\n      var section = this._sections[i];\n\n      var content = section.consumer.sourceContentFor(aSource, true);\n      if (content) {\n        return content;\n      }\n    }\n    if (nullOnMissing) {\n      return null;\n    }\n    else {\n      throw new Error('\"' + aSource + '\" is not in the SourceMap.');\n    }\n  };\n\n/**\n * Returns the generated line and column information for the original source,\n * line, and column positions provided. The only argument is an object with\n * the following properties:\n *\n *   - source: The filename of the original source.\n *   - line: The line number in the original source.  The line number\n *     is 1-based.\n *   - column: The column number in the original source.  The column\n *     number is 0-based.\n *\n * and an object is returned with the following properties:\n *\n *   - line: The line number in the generated source, or null.  The\n *     line number is 1-based. \n *   - column: The column number in the generated source, or null.\n *     The column number is 0-based.\n */\nIndexedSourceMapConsumer.prototype.generatedPositionFor =\n  function IndexedSourceMapConsumer_generatedPositionFor(aArgs) {\n    for (var i = 0; i < this._sections.length; i++) {\n      var section = this._sections[i];\n\n      // Only consider this section if the requested source is in the list of\n      // sources of the consumer.\n      if (section.consumer._findSourceIndex(util.getArg(aArgs, 'source')) === -1) {\n        continue;\n      }\n      var generatedPosition = section.consumer.generatedPositionFor(aArgs);\n      if (generatedPosition) {\n        var ret = {\n          line: generatedPosition.line +\n            (section.generatedOffset.generatedLine - 1),\n          column: generatedPosition.column +\n            (section.generatedOffset.generatedLine === generatedPosition.line\n             ? section.generatedOffset.generatedColumn - 1\n             : 0)\n        };\n        return ret;\n      }\n    }\n\n    return {\n      line: null,\n      column: null\n    };\n  };\n\n/**\n * Parse the mappings in a string in to a data structure which we can easily\n * query (the ordered arrays in the `this.__generatedMappings` and\n * `this.__originalMappings` properties).\n */\nIndexedSourceMapConsumer.prototype._parseMappings =\n  function IndexedSourceMapConsumer_parseMappings(aStr, aSourceRoot) {\n    this.__generatedMappings = [];\n    this.__originalMappings = [];\n    for (var i = 0; i < this._sections.length; i++) {\n      var section = this._sections[i];\n      var sectionMappings = section.consumer._generatedMappings;\n      for (var j = 0; j < sectionMappings.length; j++) {\n        var mapping = sectionMappings[j];\n\n        var source = section.consumer._sources.at(mapping.source);\n        source = util.computeSourceURL(section.consumer.sourceRoot, source, this._sourceMapURL);\n        this._sources.add(source);\n        source = this._sources.indexOf(source);\n\n        var name = null;\n        if (mapping.name) {\n          name = section.consumer._names.at(mapping.name);\n          this._names.add(name);\n          name = this._names.indexOf(name);\n        }\n\n        // The mappings coming from the consumer for the section have\n        // generated positions relative to the start of the section, so we\n        // need to offset them to be relative to the start of the concatenated\n        // generated file.\n        var adjustedMapping = {\n          source: source,\n          generatedLine: mapping.generatedLine +\n            (section.generatedOffset.generatedLine - 1),\n          generatedColumn: mapping.generatedColumn +\n            (section.generatedOffset.generatedLine === mapping.generatedLine\n            ? section.generatedOffset.generatedColumn - 1\n            : 0),\n          originalLine: mapping.originalLine,\n          originalColumn: mapping.originalColumn,\n          name: name\n        };\n\n        this.__generatedMappings.push(adjustedMapping);\n        if (typeof adjustedMapping.originalLine === 'number') {\n          this.__originalMappings.push(adjustedMapping);\n        }\n      }\n    }\n\n    quickSort(this.__generatedMappings, util.compareByGeneratedPositionsDeflated);\n    quickSort(this.__originalMappings, util.compareByOriginalPositions);\n  };\n\nexports.IndexedSourceMapConsumer = IndexedSourceMapConsumer;\n", "/* -*- Mode: js; js-indent-level: 2; -*- */\n/*\n * Copyright 2011 Mozilla Foundation and contributors\n * Licensed under the New BSD license. See LICENSE or:\n * http://opensource.org/licenses/BSD-3-Clause\n */\n\nvar SourceMapGenerator = require('./source-map-generator').SourceMapGenerator;\nvar util = require('./util');\n\n// Matches a Windows-style `\\r\\n` newline or a `\\n` newline used by all other\n// operating systems these days (capturing the result).\nvar REGEX_NEWLINE = /(\\r?\\n)/;\n\n// Newline character code for charCodeAt() comparisons\nvar NEWLINE_CODE = 10;\n\n// Private symbol for identifying `SourceNode`s when multiple versions of\n// the source-map library are loaded. This MUST NOT CHANGE across\n// versions!\nvar isSourceNode = \"$$$isSourceNode$$$\";\n\n/**\n * SourceNodes provide a way to abstract over interpolating/concatenating\n * snippets of generated JavaScript source code while maintaining the line and\n * column information associated with the original source code.\n *\n * @param aLine The original line number.\n * @param aColumn The original column number.\n * @param aSource The original source's filename.\n * @param aChunks Optional. An array of strings which are snippets of\n *        generated JS, or other SourceNodes.\n * @param aName The original identifier.\n */\nfunction SourceNode(aLine, aColumn, aSource, aChunks, aName) {\n  this.children = [];\n  this.sourceContents = {};\n  this.line = aLine == null ? null : aLine;\n  this.column = aColumn == null ? null : aColumn;\n  this.source = aSource == null ? null : aSource;\n  this.name = aName == null ? null : aName;\n  this[isSourceNode] = true;\n  if (aChunks != null) this.add(aChunks);\n}\n\n/**\n * Creates a SourceNode from generated code and a SourceMapConsumer.\n *\n * @param aGeneratedCode The generated code\n * @param aSourceMapConsumer The SourceMap for the generated code\n * @param aRelativePath Optional. The path that relative sources in the\n *        SourceMapConsumer should be relative to.\n */\nSourceNode.fromStringWithSourceMap =\n  function SourceNode_fromStringWithSourceMap(aGeneratedCode, aSourceMapConsumer, aRelativePath) {\n    // The SourceNode we want to fill with the generated code\n    // and the SourceMap\n    var node = new SourceNode();\n\n    // All even indices of this array are one line of the generated code,\n    // while all odd indices are the newlines between two adjacent lines\n    // (since `REGEX_NEWLINE` captures its match).\n    // Processed fragments are accessed by calling `shiftNextLine`.\n    var remainingLines = aGeneratedCode.split(REGEX_NEWLINE);\n    var remainingLinesIndex = 0;\n    var shiftNextLine = function() {\n      var lineContents = getNextLine();\n      // The last line of a file might not have a newline.\n      var newLine = getNextLine() || \"\";\n      return lineContents + newLine;\n\n      function getNextLine() {\n        return remainingLinesIndex < remainingLines.length ?\n            remainingLines[remainingLinesIndex++] : undefined;\n      }\n    };\n\n    // We need to remember the position of \"remainingLines\"\n    var lastGeneratedLine = 1, lastGeneratedColumn = 0;\n\n    // The generate SourceNodes we need a code range.\n    // To extract it current and last mapping is used.\n    // Here we store the last mapping.\n    var lastMapping = null;\n\n    aSourceMapConsumer.eachMapping(function (mapping) {\n      if (lastMapping !== null) {\n        // We add the code from \"lastMapping\" to \"mapping\":\n        // First check if there is a new line in between.\n        if (lastGeneratedLine < mapping.generatedLine) {\n          // Associate first line with \"lastMapping\"\n          addMappingWithCode(lastMapping, shiftNextLine());\n          lastGeneratedLine++;\n          lastGeneratedColumn = 0;\n          // The remaining code is added without mapping\n        } else {\n          // There is no new line in between.\n          // Associate the code between \"lastGeneratedColumn\" and\n          // \"mapping.generatedColumn\" with \"lastMapping\"\n          var nextLine = remainingLines[remainingLinesIndex] || '';\n          var code = nextLine.substr(0, mapping.generatedColumn -\n                                        lastGeneratedColumn);\n          remainingLines[remainingLinesIndex] = nextLine.substr(mapping.generatedColumn -\n                                              lastGeneratedColumn);\n          lastGeneratedColumn = mapping.generatedColumn;\n          addMappingWithCode(lastMapping, code);\n          // No more remaining code, continue\n          lastMapping = mapping;\n          return;\n        }\n      }\n      // We add the generated code until the first mapping\n      // to the SourceNode without any mapping.\n      // Each line is added as separate string.\n      while (lastGeneratedLine < mapping.generatedLine) {\n        node.add(shiftNextLine());\n        lastGeneratedLine++;\n      }\n      if (lastGeneratedColumn < mapping.generatedColumn) {\n        var nextLine = remainingLines[remainingLinesIndex] || '';\n        node.add(nextLine.substr(0, mapping.generatedColumn));\n        remainingLines[remainingLinesIndex] = nextLine.substr(mapping.generatedColumn);\n        lastGeneratedColumn = mapping.generatedColumn;\n      }\n      lastMapping = mapping;\n    }, this);\n    // We have processed all mappings.\n    if (remainingLinesIndex < remainingLines.length) {\n      if (lastMapping) {\n        // Associate the remaining code in the current line with \"lastMapping\"\n        addMappingWithCode(lastMapping, shiftNextLine());\n      }\n      // and add the remaining lines without any mapping\n      node.add(remainingLines.splice(remainingLinesIndex).join(\"\"));\n    }\n\n    // Copy sourcesContent into SourceNode\n    aSourceMapConsumer.sources.forEach(function (sourceFile) {\n      var content = aSourceMapConsumer.sourceContentFor(sourceFile);\n      if (content != null) {\n        if (aRelativePath != null) {\n          sourceFile = util.join(aRelativePath, sourceFile);\n        }\n        node.setSourceContent(sourceFile, content);\n      }\n    });\n\n    return node;\n\n    function addMappingWithCode(mapping, code) {\n      if (mapping === null || mapping.source === undefined) {\n        node.add(code);\n      } else {\n        var source = aRelativePath\n          ? util.join(aRelativePath, mapping.source)\n          : mapping.source;\n        node.add(new SourceNode(mapping.originalLine,\n                                mapping.originalColumn,\n                                source,\n                                code,\n                                mapping.name));\n      }\n    }\n  };\n\n/**\n * Add a chunk of generated JS to this source node.\n *\n * @param aChunk A string snippet of generated JS code, another instance of\n *        SourceNode, or an array where each member is one of those things.\n */\nSourceNode.prototype.add = function SourceNode_add(aChunk) {\n  if (Array.isArray(aChunk)) {\n    aChunk.forEach(function (chunk) {\n      this.add(chunk);\n    }, this);\n  }\n  else if (aChunk[isSourceNode] || typeof aChunk === \"string\") {\n    if (aChunk) {\n      this.children.push(aChunk);\n    }\n  }\n  else {\n    throw new TypeError(\n      \"Expected a SourceNode, string, or an array of SourceNodes and strings. Got \" + aChunk\n    );\n  }\n  return this;\n};\n\n/**\n * Add a chunk of generated JS to the beginning of this source node.\n *\n * @param aChunk A string snippet of generated JS code, another instance of\n *        SourceNode, or an array where each member is one of those things.\n */\nSourceNode.prototype.prepend = function SourceNode_prepend(aChunk) {\n  if (Array.isArray(aChunk)) {\n    for (var i = aChunk.length-1; i >= 0; i--) {\n      this.prepend(aChunk[i]);\n    }\n  }\n  else if (aChunk[isSourceNode] || typeof aChunk === \"string\") {\n    this.children.unshift(aChunk);\n  }\n  else {\n    throw new TypeError(\n      \"Expected a SourceNode, string, or an array of SourceNodes and strings. Got \" + aChunk\n    );\n  }\n  return this;\n};\n\n/**\n * Walk over the tree of JS snippets in this node and its children. The\n * walking function is called once for each snippet of JS and is passed that\n * snippet and the its original associated source's line/column location.\n *\n * @param aFn The traversal function.\n */\nSourceNode.prototype.walk = function SourceNode_walk(aFn) {\n  var chunk;\n  for (var i = 0, len = this.children.length; i < len; i++) {\n    chunk = this.children[i];\n    if (chunk[isSourceNode]) {\n      chunk.walk(aFn);\n    }\n    else {\n      if (chunk !== '') {\n        aFn(chunk, { source: this.source,\n                     line: this.line,\n                     column: this.column,\n                     name: this.name });\n      }\n    }\n  }\n};\n\n/**\n * Like `String.prototype.join` except for SourceNodes. Inserts `aStr` between\n * each of `this.children`.\n *\n * @param aSep The separator.\n */\nSourceNode.prototype.join = function SourceNode_join(aSep) {\n  var newChildren;\n  var i;\n  var len = this.children.length;\n  if (len > 0) {\n    newChildren = [];\n    for (i = 0; i < len-1; i++) {\n      newChildren.push(this.children[i]);\n      newChildren.push(aSep);\n    }\n    newChildren.push(this.children[i]);\n    this.children = newChildren;\n  }\n  return this;\n};\n\n/**\n * Call String.prototype.replace on the very right-most source snippet. Useful\n * for trimming whitespace from the end of a source node, etc.\n *\n * @param aPattern The pattern to replace.\n * @param aReplacement The thing to replace the pattern with.\n */\nSourceNode.prototype.replaceRight = function SourceNode_replaceRight(aPattern, aReplacement) {\n  var lastChild = this.children[this.children.length - 1];\n  if (lastChild[isSourceNode]) {\n    lastChild.replaceRight(aPattern, aReplacement);\n  }\n  else if (typeof lastChild === 'string') {\n    this.children[this.children.length - 1] = lastChild.replace(aPattern, aReplacement);\n  }\n  else {\n    this.children.push(''.replace(aPattern, aReplacement));\n  }\n  return this;\n};\n\n/**\n * Set the source content for a source file. This will be added to the SourceMapGenerator\n * in the sourcesContent field.\n *\n * @param aSourceFile The filename of the source file\n * @param aSourceContent The content of the source file\n */\nSourceNode.prototype.setSourceContent =\n  function SourceNode_setSourceContent(aSourceFile, aSourceContent) {\n    this.sourceContents[util.toSetString(aSourceFile)] = aSourceContent;\n  };\n\n/**\n * Walk over the tree of SourceNodes. The walking function is called for each\n * source file content and is passed the filename and source content.\n *\n * @param aFn The traversal function.\n */\nSourceNode.prototype.walkSourceContents =\n  function SourceNode_walkSourceContents(aFn) {\n    for (var i = 0, len = this.children.length; i < len; i++) {\n      if (this.children[i][isSourceNode]) {\n        this.children[i].walkSourceContents(aFn);\n      }\n    }\n\n    var sources = Object.keys(this.sourceContents);\n    for (var i = 0, len = sources.length; i < len; i++) {\n      aFn(util.fromSetString(sources[i]), this.sourceContents[sources[i]]);\n    }\n  };\n\n/**\n * Return the string representation of this source node. Walks over the tree\n * and concatenates all the various snippets together to one string.\n */\nSourceNode.prototype.toString = function SourceNode_toString() {\n  var str = \"\";\n  this.walk(function (chunk) {\n    str += chunk;\n  });\n  return str;\n};\n\n/**\n * Returns the string representation of this source node along with a source\n * map.\n */\nSourceNode.prototype.toStringWithSourceMap = function SourceNode_toStringWithSourceMap(aArgs) {\n  var generated = {\n    code: \"\",\n    line: 1,\n    column: 0\n  };\n  var map = new SourceMapGenerator(aArgs);\n  var sourceMappingActive = false;\n  var lastOriginalSource = null;\n  var lastOriginalLine = null;\n  var lastOriginalColumn = null;\n  var lastOriginalName = null;\n  this.walk(function (chunk, original) {\n    generated.code += chunk;\n    if (original.source !== null\n        && original.line !== null\n        && original.column !== null) {\n      if(lastOriginalSource !== original.source\n         || lastOriginalLine !== original.line\n         || lastOriginalColumn !== original.column\n         || lastOriginalName !== original.name) {\n        map.addMapping({\n          source: original.source,\n          original: {\n            line: original.line,\n            column: original.column\n          },\n          generated: {\n            line: generated.line,\n            column: generated.column\n          },\n          name: original.name\n        });\n      }\n      lastOriginalSource = original.source;\n      lastOriginalLine = original.line;\n      lastOriginalColumn = original.column;\n      lastOriginalName = original.name;\n      sourceMappingActive = true;\n    } else if (sourceMappingActive) {\n      map.addMapping({\n        generated: {\n          line: generated.line,\n          column: generated.column\n        }\n      });\n      lastOriginalSource = null;\n      sourceMappingActive = false;\n    }\n    for (var idx = 0, length = chunk.length; idx < length; idx++) {\n      if (chunk.charCodeAt(idx) === NEWLINE_CODE) {\n        generated.line++;\n        generated.column = 0;\n        // Mappings end at eol\n        if (idx + 1 === length) {\n          lastOriginalSource = null;\n          sourceMappingActive = false;\n        } else if (sourceMappingActive) {\n          map.addMapping({\n            source: original.source,\n            original: {\n              line: original.line,\n              column: original.column\n            },\n            generated: {\n              line: generated.line,\n              column: generated.column\n            },\n            name: original.name\n          });\n        }\n      } else {\n        generated.column++;\n      }\n    }\n  });\n  this.walkSourceContents(function (sourceFile, sourceContent) {\n    map.setSourceContent(sourceFile, sourceContent);\n  });\n\n  return { code: generated.code, map: map };\n};\n\nexports.SourceNode = SourceNode;\n", "/*\n * Copyright 2009-2011 Mozilla Foundation and contributors\n * Licensed under the New BSD license. See LICENSE.txt or:\n * http://opensource.org/licenses/BSD-3-Clause\n */\nexports.SourceMapGenerator = require('./lib/source-map-generator').SourceMapGenerator;\nexports.SourceMapConsumer = require('./lib/source-map-consumer').SourceMapConsumer;\nexports.SourceNode = require('./lib/source-node').SourceNode;\n", "(function (w) {\n  \"use strict\";\n\n  function findBest(atobNative) {\n    // normal window\n    if ('function' === typeof atobNative) { return atobNative; }\n\n\n    // browserify (web worker)\n    if ('function' === typeof Buffer) {\n      return function atobBrowserify(a) {\n        //!! Deliberately using an API that's deprecated in node.js because\n        //!! this file is for browsers and we expect them to cope with it.\n        //!! Discussion: github.com/node-browser-compat/atob/pull/9\n        return new Buffer(a, 'base64').toString('binary');\n      };\n    }\n\n    // ios web worker with base64js\n    if ('object' === typeof w.base64js) {\n      // bufferToBinaryString\n      // https://git.coolaj86.com/coolaj86/unibabel.js/blob/master/index.js#L50\n      return function atobWebWorker_iOS(a) {\n        var buf = w.base64js.b64ToByteArray(a);\n        return Array.prototype.map.call(buf, function (ch) {\n          return String.fromCharCode(ch);\n        }).join('');\n      };\n    }\n\n\t\treturn function () {\n\t\t\t// ios web worker without base64js\n\t\t\tthrow new Error(\"You're probably in an old browser or an iOS webworker.\" +\n\t\t\t\t\" It might help to include beatgammit's base64-js.\");\n    };\n  }\n\n  var atobBest = findBest(w.atob);\n  w.atob = atobBest;\n\n  if ((typeof module === 'object') && module && module.exports) {\n    module.exports = atobBest;\n  }\n}(window));\n", "'use strict';\nvar token = '%[a-f0-9]{2}';\nvar singleMatcher = new RegExp('(' + token + ')|([^%]+?)', 'gi');\nvar multiMatcher = new RegExp('(' + token + ')+', 'gi');\n\nfunction decodeComponents(components, split) {\n\ttry {\n\t\t// Try to decode the entire string first\n\t\treturn [decodeURIComponent(components.join(''))];\n\t} catch (err) {\n\t\t// Do nothing\n\t}\n\n\tif (components.length === 1) {\n\t\treturn components;\n\t}\n\n\tsplit = split || 1;\n\n\t// Split the array in 2 parts\n\tvar left = components.slice(0, split);\n\tvar right = components.slice(split);\n\n\treturn Array.prototype.concat.call([], decodeComponents(left), decodeComponents(right));\n}\n\nfunction decode(input) {\n\ttry {\n\t\treturn decodeURIComponent(input);\n\t} catch (err) {\n\t\tvar tokens = input.match(singleMatcher) || [];\n\n\t\tfor (var i = 1; i < tokens.length; i++) {\n\t\t\tinput = decodeComponents(tokens, i).join('');\n\n\t\t\ttokens = input.match(singleMatcher) || [];\n\t\t}\n\n\t\treturn input;\n\t}\n}\n\nfunction customDecodeURIComponent(input) {\n\t// Keep track of all the replacements and prefill the map with the `BOM`\n\tvar replaceMap = {\n\t\t'%FE%FF': '\\uFFFD\\uFFFD',\n\t\t'%FF%FE': '\\uFFFD\\uFFFD'\n\t};\n\n\tvar match = multiMatcher.exec(input);\n\twhile (match) {\n\t\ttry {\n\t\t\t// Decode as big chunks as possible\n\t\t\treplaceMap[match[0]] = decodeURIComponent(match[0]);\n\t\t} catch (err) {\n\t\t\tvar result = decode(match[0]);\n\n\t\t\tif (result !== match[0]) {\n\t\t\t\treplaceMap[match[0]] = result;\n\t\t\t}\n\t\t}\n\n\t\tmatch = multiMatcher.exec(input);\n\t}\n\n\t// Add `%C2` at the end of the map to make sure it does not replace the combinator before everything else\n\treplaceMap['%C2'] = '\\uFFFD';\n\n\tvar entries = Object.keys(replaceMap);\n\n\tfor (var i = 0; i < entries.length; i++) {\n\t\t// Replace all decoded components\n\t\tvar key = entries[i];\n\t\tinput = input.replace(new RegExp(key, 'g'), replaceMap[key]);\n\t}\n\n\treturn input;\n}\n\nmodule.exports = function (encodedURI) {\n\tif (typeof encodedURI !== 'string') {\n\t\tthrow new TypeError('Expected `encodedURI` to be of type `string`, got `' + typeof encodedURI + '`');\n\t}\n\n\ttry {\n\t\tencodedURI = encodedURI.replace(/\\+/g, ' ');\n\n\t\t// Try the built in decoder first\n\t\treturn decodeURIComponent(encodedURI);\n\t} catch (err) {\n\t\t// Fallback to a more advanced decoder\n\t\treturn customDecodeURIComponent(encodedURI);\n\t}\n};\n", "var atob = require(\"atob\")\nvar urlLib = require(\"url\")\nvar pathLib = require(\"path\")\nvar decodeUriComponentLib = require(\"decode-uri-component\")\n\n\n\nfunction resolveUrl(/* ...urls */) {\n  return Array.prototype.reduce.call(arguments, function(resolved, nextUrl) {\n    return urlLib.resolve(resolved, nextUrl)\n  })\n}\n\nfunction convertWindowsPath(aPath) {\n  return pathLib.sep === \"\\\\\" ? aPath.replace(/\\\\/g, \"/\").replace(/^[a-z]:\\/?/i, \"/\") : aPath\n}\n\nfunction customDecodeUriComponent(string) {\n  // `decodeUriComponentLib` turns `+` into ` `, but that's not wanted.\n  return decodeUriComponentLib(string.replace(/\\+/g, \"%2B\"))\n}\n\nfunction callbackAsync(callback, error, result) {\n  setImmediate(function() { callback(error, result) })\n}\n\nfunction parseMapToJSON(string, data) {\n  try {\n    return JSON.parse(string.replace(/^\\)\\]\\}'/, \"\"))\n  } catch (error) {\n    error.sourceMapData = data\n    throw error\n  }\n}\n\nfunction readSync(read, url, data) {\n  var readUrl = customDecodeUriComponent(url)\n  try {\n    return String(read(readUrl))\n  } catch (error) {\n    error.sourceMapData = data\n    throw error\n  }\n}\n\n\n\nvar innerRegex = /[#@] sourceMappingURL=([^\\s'\"]*)/\n\nvar sourceMappingURLRegex = RegExp(\n  \"(?:\" +\n    \"/\\\\*\" +\n    \"(?:\\\\s*\\r?\\n(?://)?)?\" +\n    \"(?:\" + innerRegex.source + \")\" +\n    \"\\\\s*\" +\n    \"\\\\*/\" +\n    \"|\" +\n    \"//(?:\" + innerRegex.source + \")\" +\n  \")\" +\n  \"\\\\s*\"\n)\n\nfunction getSourceMappingUrl(code) {\n  var match = code.match(sourceMappingURLRegex)\n  return match ? match[1] || match[2] || \"\" : null\n}\n\n\n\nfunction resolveSourceMap(code, codeUrl, read, callback) {\n  var mapData\n  try {\n    mapData = resolveSourceMapHelper(code, codeUrl)\n  } catch (error) {\n    return callbackAsync(callback, error)\n  }\n  if (!mapData || mapData.map) {\n    return callbackAsync(callback, null, mapData)\n  }\n  var readUrl = customDecodeUriComponent(mapData.url)\n  read(readUrl, function(error, result) {\n    if (error) {\n      error.sourceMapData = mapData\n      return callback(error)\n    }\n    mapData.map = String(result)\n    try {\n      mapData.map = parseMapToJSON(mapData.map, mapData)\n    } catch (error) {\n      return callback(error)\n    }\n    callback(null, mapData)\n  })\n}\n\nfunction resolveSourceMapSync(code, codeUrl, read) {\n  var mapData = resolveSourceMapHelper(code, codeUrl)\n  if (!mapData || mapData.map) {\n    return mapData\n  }\n  mapData.map = readSync(read, mapData.url, mapData)\n  mapData.map = parseMapToJSON(mapData.map, mapData)\n  return mapData\n}\n\nvar dataUriRegex = /^data:([^,;]*)(;[^,;]*)*(?:,(.*))?$/\n\n/**\n * The media type for JSON text is application/json.\n *\n * {@link https://tools.ietf.org/html/rfc8259#section-11 | IANA Considerations }\n *\n * `text/json` is non-standard media type\n */\nvar jsonMimeTypeRegex = /^(?:application|text)\\/json$/\n\n/**\n * JSON text exchanged between systems that are not part of a closed ecosystem\n * MUST be encoded using UTF-8.\n *\n * {@link https://tools.ietf.org/html/rfc8259#section-8.1 | Character Encoding}\n */\nvar jsonCharacterEncoding = \"utf-8\"\n\nfunction base64ToBuf(b64) {\n  var binStr = atob(b64)\n  var len = binStr.length\n  var arr = new Uint8Array(len)\n  for (var i = 0; i < len; i++) {\n    arr[i] = binStr.charCodeAt(i)\n  }\n  return arr\n}\n\nfunction decodeBase64String(b64) {\n  if (typeof TextDecoder === \"undefined\" || typeof Uint8Array === \"undefined\") {\n    return atob(b64)\n  }\n  var buf = base64ToBuf(b64);\n  // Note: `decoder.decode` method will throw a `DOMException` with the\n  // `\"EncodingError\"` value when an coding error is found.\n  var decoder = new TextDecoder(jsonCharacterEncoding, {fatal: true})\n  return decoder.decode(buf);\n}\n\nfunction resolveSourceMapHelper(code, codeUrl) {\n  codeUrl = convertWindowsPath(codeUrl)\n\n  var url = getSourceMappingUrl(code)\n  if (!url) {\n    return null\n  }\n\n  var dataUri = url.match(dataUriRegex)\n  if (dataUri) {\n    var mimeType = dataUri[1] || \"text/plain\"\n    var lastParameter = dataUri[2] || \"\"\n    var encoded = dataUri[3] || \"\"\n    var data = {\n      sourceMappingURL: url,\n      url: null,\n      sourcesRelativeTo: codeUrl,\n      map: encoded\n    }\n    if (!jsonMimeTypeRegex.test(mimeType)) {\n      var error = new Error(\"Unuseful data uri mime type: \" + mimeType)\n      error.sourceMapData = data\n      throw error\n    }\n    try {\n      data.map = parseMapToJSON(\n        lastParameter === \";base64\" ? decodeBase64String(encoded) : decodeURIComponent(encoded),\n        data\n      )\n    } catch (error) {\n      error.sourceMapData = data\n      throw error\n    }\n    return data\n  }\n\n  var mapUrl = resolveUrl(codeUrl, url)\n  return {\n    sourceMappingURL: url,\n    url: mapUrl,\n    sourcesRelativeTo: mapUrl,\n    map: null\n  }\n}\n\n\n\nfunction resolveSources(map, mapUrl, read, options, callback) {\n  if (typeof options === \"function\") {\n    callback = options\n    options = {}\n  }\n  var pending = map.sources ? map.sources.length : 0\n  var result = {\n    sourcesResolved: [],\n    sourcesContent:  []\n  }\n\n  if (pending === 0) {\n    callbackAsync(callback, null, result)\n    return\n  }\n\n  var done = function() {\n    pending--\n    if (pending === 0) {\n      callback(null, result)\n    }\n  }\n\n  resolveSourcesHelper(map, mapUrl, options, function(fullUrl, sourceContent, index) {\n    result.sourcesResolved[index] = fullUrl\n    if (typeof sourceContent === \"string\") {\n      result.sourcesContent[index] = sourceContent\n      callbackAsync(done, null)\n    } else {\n      var readUrl = customDecodeUriComponent(fullUrl)\n      read(readUrl, function(error, source) {\n        result.sourcesContent[index] = error ? error : String(source)\n        done()\n      })\n    }\n  })\n}\n\nfunction resolveSourcesSync(map, mapUrl, read, options) {\n  var result = {\n    sourcesResolved: [],\n    sourcesContent:  []\n  }\n\n  if (!map.sources || map.sources.length === 0) {\n    return result\n  }\n\n  resolveSourcesHelper(map, mapUrl, options, function(fullUrl, sourceContent, index) {\n    result.sourcesResolved[index] = fullUrl\n    if (read !== null) {\n      if (typeof sourceContent === \"string\") {\n        result.sourcesContent[index] = sourceContent\n      } else {\n        var readUrl = customDecodeUriComponent(fullUrl)\n        try {\n          result.sourcesContent[index] = String(read(readUrl))\n        } catch (error) {\n          result.sourcesContent[index] = error\n        }\n      }\n    }\n  })\n\n  return result\n}\n\nvar endingSlash = /\\/?$/\n\nfunction resolveSourcesHelper(map, mapUrl, options, fn) {\n  options = options || {}\n  mapUrl = convertWindowsPath(mapUrl)\n  var fullUrl\n  var sourceContent\n  var sourceRoot\n  for (var index = 0, len = map.sources.length; index < len; index++) {\n    sourceRoot = null\n    if (typeof options.sourceRoot === \"string\") {\n      sourceRoot = options.sourceRoot\n    } else if (typeof map.sourceRoot === \"string\" && options.sourceRoot !== false) {\n      sourceRoot = map.sourceRoot\n    }\n    // If the sourceRoot is the empty string, it is equivalent to not setting\n    // the property at all.\n    if (sourceRoot === null || sourceRoot === '') {\n      fullUrl = resolveUrl(mapUrl, map.sources[index])\n    } else {\n      // Make sure that the sourceRoot ends with a slash, so that `/scripts/subdir` becomes\n      // `/scripts/subdir/<source>`, not `/scripts/<source>`. Pointing to a file as source root\n      // does not make sense.\n      fullUrl = resolveUrl(mapUrl, sourceRoot.replace(endingSlash, \"/\"), map.sources[index])\n    }\n    sourceContent = (map.sourcesContent || [])[index]\n    fn(fullUrl, sourceContent, index)\n  }\n}\n\n\n\nfunction resolve(code, codeUrl, read, options, callback) {\n  if (typeof options === \"function\") {\n    callback = options\n    options = {}\n  }\n  if (code === null) {\n    var mapUrl = codeUrl\n    var data = {\n      sourceMappingURL: null,\n      url: mapUrl,\n      sourcesRelativeTo: mapUrl,\n      map: null\n    }\n    var readUrl = customDecodeUriComponent(mapUrl)\n    read(readUrl, function(error, result) {\n      if (error) {\n        error.sourceMapData = data\n        return callback(error)\n      }\n      data.map = String(result)\n      try {\n        data.map = parseMapToJSON(data.map, data)\n      } catch (error) {\n        return callback(error)\n      }\n      _resolveSources(data)\n    })\n  } else {\n    resolveSourceMap(code, codeUrl, read, function(error, mapData) {\n      if (error) {\n        return callback(error)\n      }\n      if (!mapData) {\n        return callback(null, null)\n      }\n      _resolveSources(mapData)\n    })\n  }\n\n  function _resolveSources(mapData) {\n    resolveSources(mapData.map, mapData.sourcesRelativeTo, read, options, function(error, result) {\n      if (error) {\n        return callback(error)\n      }\n      mapData.sourcesResolved = result.sourcesResolved\n      mapData.sourcesContent  = result.sourcesContent\n      callback(null, mapData)\n    })\n  }\n}\n\nfunction resolveSync(code, codeUrl, read, options) {\n  var mapData\n  if (code === null) {\n    var mapUrl = codeUrl\n    mapData = {\n      sourceMappingURL: null,\n      url: mapUrl,\n      sourcesRelativeTo: mapUrl,\n      map: null\n    }\n    mapData.map = readSync(read, mapUrl, mapData)\n    mapData.map = parseMapToJSON(mapData.map, mapData)\n  } else {\n    mapData = resolveSourceMapSync(code, codeUrl, read)\n    if (!mapData) {\n      return null\n    }\n  }\n  var result = resolveSourcesSync(mapData.map, mapData.sourcesRelativeTo, read, options)\n  mapData.sourcesResolved = result.sourcesResolved\n  mapData.sourcesContent  = result.sourcesContent\n  return mapData\n}\n\n\n\nmodule.exports = {\n  resolveSourceMap:     resolveSourceMap,\n  resolveSourceMapSync: resolveSourceMapSync,\n  resolveSources:       resolveSources,\n  resolveSourcesSync:   resolveSourcesSync,\n  resolve:              resolve,\n  resolveSync:          resolveSync,\n  parseMapToJSON:       parseMapToJSON\n}\n", "export function readFileSync(_path: string): never {\n  throw new Error(\"readFileSync is not available in browser bundle\");\n}\n\nexport default {};\n", "\n/**\n * Module dependencies.\n */\n\nvar SourceMap = require('source-map').SourceMapGenerator;\nvar SourceMapConsumer = require('source-map').SourceMapConsumer;\nvar sourceMapResolve = require('source-map-resolve');\nvar fs = require('fs');\nvar path = require('path');\n\n/**\n * Expose `mixin()`.\n */\n\nmodule.exports = mixin;\n\n/**\n * Ensure Windows-style paths are formatted properly\n */\n\nconst makeFriendlyPath = function(aPath) {\n  return path.sep === \"\\\\\" ? aPath.replace(/\\\\/g, \"/\").replace(/^[a-z]:\\/?/i, \"/\") : aPath;\n}\n\n/**\n * Mixin source map support into `compiler`.\n *\n * @param {Compiler} compiler\n * @api public\n */\n\nfunction mixin(compiler) {\n  compiler._comment = compiler.comment;\n  compiler.map = new SourceMap();\n  compiler.position = { line: 1, column: 1 };\n  compiler.files = {};\n  for (var k in exports) compiler[k] = exports[k];\n}\n\n/**\n * Update position.\n *\n * @param {String} str\n * @api private\n */\n\nexports.updatePosition = function(str) {\n  var lines = str.match(/\\n/g);\n  if (lines) this.position.line += lines.length;\n  var i = str.lastIndexOf('\\n');\n  this.position.column = ~i ? str.length - i : this.position.column + str.length;\n};\n\n/**\n * Emit `str`.\n *\n * @param {String} str\n * @param {Object} [pos]\n * @return {String}\n * @api private\n */\n\nexports.emit = function(str, pos) {\n  if (pos) {\n    var sourceFile = makeFriendlyPath(pos.source || 'source.css');\n\n    this.map.addMapping({\n      source: sourceFile,\n      generated: {\n        line: this.position.line,\n        column: Math.max(this.position.column - 1, 0)\n      },\n      original: {\n        line: pos.start.line,\n        column: pos.start.column - 1\n      }\n    });\n\n    this.addFile(sourceFile, pos);\n  }\n\n  this.updatePosition(str);\n\n  return str;\n};\n\n/**\n * Adds a file to the source map output if it has not already been added\n * @param {String} file\n * @param {Object} pos\n */\n\nexports.addFile = function(file, pos) {\n  if (typeof pos.content !== 'string') return;\n  if (Object.prototype.hasOwnProperty.call(this.files, file)) return;\n\n  this.files[file] = pos.content;\n};\n\n/**\n * Applies any original source maps to the output and embeds the source file\n * contents in the source map.\n */\n\nexports.applySourceMaps = function() {\n  Object.keys(this.files).forEach(function(file) {\n    var content = this.files[file];\n    this.map.setSourceContent(file, content);\n\n    if (this.options.inputSourcemaps !== false) {\n      var originalMap = sourceMapResolve.resolveSync(\n        content, file, fs.readFileSync);\n      if (originalMap) {\n        var map = new SourceMapConsumer(originalMap.map);\n        var relativeTo = originalMap.sourcesRelativeTo;\n        this.map.applySourceMap(map, file, makeFriendlyPath(path.dirname(relativeTo)));\n      }\n    }\n  }, this);\n};\n\n/**\n * Process comments, drops sourceMap comments.\n * @param {Object} node\n */\n\nexports.comment = function(node) {\n  if (/^# sourceMappingURL=/.test(node.comment))\n    return this.emit('', node.position);\n  else\n    return this._comment(node);\n};\n", "\n/**\n * Module dependencies.\n */\n\nvar Compressed = require('./compress');\nvar Identity = require('./identity');\n\n/**\n * Stringfy the given AST `node`.\n *\n * Options:\n *\n *  - `compress` space-optimized output\n *  - `sourcemap` return an object with `.code` and `.map`\n *\n * @param {Object} node\n * @param {Object} [options]\n * @return {String}\n * @api public\n */\n\nmodule.exports = function(node, options){\n  options = options || {};\n\n  var compiler = options.compress\n    ? new Compressed(options)\n    : new Identity(options);\n\n  // source maps\n  if (options.sourcemap) {\n    var sourcemaps = require('./source-map-support');\n    sourcemaps(compiler);\n\n    var code = compiler.compile(node);\n    compiler.applySourceMaps();\n\n    var map = options.sourcemap === 'generator'\n      ? compiler.map\n      : compiler.map.toJSON();\n\n    return { code: code, map: map };\n  }\n\n  var code = compiler.compile(node);\n  return code;\n};\n", "exports.parse = require('./lib/parse');\nexports.stringify = require('./lib/stringify');\n", "export function inflateSync(_data: Uint8Array): never {\n  throw new Error(\"inflateSync is not available in browser bundle\");\n}\n\nexport function brotliDecompressSync(_data: Uint8Array): never {\n  throw new Error(\"brotliDecompressSync is not available in browser bundle\");\n}\n\nexport default {};\n", "import { inflateSync } from \"zlib\";\nimport type { ParsedFont } from \"../types.js\";\n\nconst WOFF_SIGNATURE = 0x774f4646; // \"wOFF\"\nconst WOFF_HEADER_SIZE = 44;\nconst TABLE_DIR_ENTRY_SIZE = 20;\n\nfunction readUInt32(view: DataView, offset: number): number {\n  return view.getUint32(offset, false);\n}\n\nfunction readUInt16(view: DataView, offset: number): number {\n  return view.getUint16(offset, false);\n}\n\nfunction tagToString(tag: number): string {\n  return String.fromCharCode(\n    (tag >> 24) & 0xff,\n    (tag >> 16) & 0xff,\n    (tag >> 8) & 0xff,\n    tag & 0xff\n  );\n}\n\n/**\n * Decode a WOFF 1.0 font into raw sfnt table data.\n * SRP: only responsible for WOFF container parsing + per-table decompression.\n */\nexport function decodeWoff(fontData: Uint8Array): ParsedFont {\n  if (fontData.byteLength < WOFF_HEADER_SIZE) {\n    throw new Error(\"Invalid WOFF: file too short\");\n  }\n\n  const view = new DataView(\n    fontData.buffer,\n    fontData.byteOffset,\n    fontData.byteLength\n  );\n\n  const signature = readUInt32(view, 0);\n  if (signature !== WOFF_SIGNATURE) {\n    throw new Error(\"Invalid WOFF signature\");\n  }\n\n  const flavor = readUInt32(view, 4) >>> 0;\n  const reportedLength = readUInt32(view, 8);\n  if (reportedLength !== fontData.byteLength) {\n    throw new Error(\"Invalid WOFF: length mismatch\");\n  }\n\n  const numTables = readUInt16(view, 12);\n  const totalSfntSize = readUInt32(view, 16);\n  if (numTables === 0 || totalSfntSize === 0) {\n    throw new Error(\"Invalid WOFF: missing tables\");\n  }\n\n  const directoryOffset = WOFF_HEADER_SIZE;\n  const directoryLength = numTables * TABLE_DIR_ENTRY_SIZE;\n  if (directoryOffset + directoryLength > fontData.byteLength) {\n    throw new Error(\"Invalid WOFF: truncated directory\");\n  }\n\n  const tables: Record<string, Uint8Array> = {};\n\n  for (let i = 0; i < numTables; i++) {\n    const entryOffset = directoryOffset + i * TABLE_DIR_ENTRY_SIZE;\n    const tag = readUInt32(view, entryOffset);\n    const offset = readUInt32(view, entryOffset + 4);\n    const compLength = readUInt32(view, entryOffset + 8);\n    const origLength = readUInt32(view, entryOffset + 12);\n\n    if (offset + compLength > fontData.byteLength) {\n      throw new Error(\"Invalid WOFF: table outside bounds\");\n    }\n\n    const compressedSlice = fontData.subarray(offset, offset + compLength);\n    let tableData: Uint8Array;\n    if (compLength !== origLength) {\n      const inflated = inflateSync(compressedSlice);\n      if (inflated.byteLength !== origLength) {\n        throw new Error(\"Invalid WOFF: decompressed size mismatch\");\n      }\n      tableData = new Uint8Array(inflated);\n    } else {\n      // Copy to avoid sharing the original buffer\n      tableData = new Uint8Array(origLength);\n      tableData.set(compressedSlice.subarray(0, origLength));\n    }\n\n    const tagString = tagToString(tag);\n    tables[tagString] = tableData;\n  }\n\n  return {\n    flavor,\n    numTables,\n    tables,\n  };\n}\n", "/**\n * Lightweight byte reader with bounds checks used by the WOFF2 decoder.\n */\nexport class Buf {\n  constructor(private readonly data: Uint8Array, public offset = 0) {}\n\n  get length(): number {\n    return this.data.length;\n  }\n\n  peekRemaining(): Uint8Array {\n    return this.data.subarray(this.offset);\n  }\n\n  readU8(): number {\n    if (this.offset + 1 > this.data.length) {\n      throw new Error(\"Unexpected EOF\");\n    }\n    return this.data[this.offset++];\n  }\n\n  readU16(): number {\n    if (this.offset + 2 > this.data.length) {\n      throw new Error(\"Unexpected EOF\");\n    }\n    const v = (this.data[this.offset] << 8) | (this.data[this.offset + 1] & 0xff);\n    this.offset += 2;\n    return v;\n  }\n\n  readS16(): number {\n    const v = this.readU16();\n    return v & 0x8000 ? v - 0x10000 : v;\n  }\n\n  readU32(): number {\n    if (this.offset + 4 > this.data.length) {\n      throw new Error(\"Unexpected EOF\");\n    }\n    const v =\n      (this.data[this.offset] << 24) |\n      (this.data[this.offset + 1] << 16) |\n      (this.data[this.offset + 2] << 8) |\n      this.data[this.offset + 3];\n    this.offset += 4;\n    return v >>> 0;\n  }\n\n  readBytes(n: number): Uint8Array {\n    if (this.offset + n > this.data.length) {\n      throw new Error(\"Unexpected EOF\");\n    }\n    const slice = this.data.subarray(this.offset, this.offset + n);\n    this.offset += n;\n    return slice;\n  }\n\n  skip(n: number): void {\n    if (this.offset + n > this.data.length) {\n      throw new Error(\"Unexpected EOF\");\n    }\n    this.offset += n;\n  }\n}\n\n/**\n * Read a Base128 variable-length integer.\n */\nexport function readBase128(buf: Buf): number {\n  let result = 0;\n  for (let i = 0; i < 5; i++) {\n    const code = buf.readU8();\n    if (i === 0 && code === 0x80) {\n      throw new Error(\"Invalid Base128: leading zero\");\n    }\n    if (result & 0xfe000000) {\n      throw new Error(\"Base128 overflow\");\n    }\n    result = (result << 7) | (code & 0x7f);\n    if ((code & 0x80) === 0) {\n      return result >>> 0;\n    }\n  }\n  throw new Error(\"Base128 exceeds 5 bytes\");\n}\n\n/**\n * Read a 255UInt16 as defined in the WOFF2 spec.\n */\nexport function read255UShort(buf: Buf): number {\n  const code = buf.readU8();\n  const LOWEST_UCODE = 253;\n  if (code === 253) {\n    // Next 2 bytes are the full value\n    return buf.readU16();\n  }\n  if (code === 255) {\n    // One extra byte, offset by 253\n    return LOWEST_UCODE + buf.readU8();\n  }\n  if (code === 254) {\n    // One extra byte, offset by 2 * 253 = 506\n    return LOWEST_UCODE * 2 + buf.readU8();\n  }\n  return code;\n}\n", "import { brotliDecompressSync } from \"zlib\";\r\nimport type { ParsedFont } from \"../types.js\";\r\nimport { Buf, readBase128, read255UShort } from \"./buffer.js\";\r\n\r\ntype BrotliDecompress = (data: Uint8Array) => Uint8Array;\r\n\r\nexport interface Woff2Dependencies {\r\n  decompress: BrotliDecompress;\r\n  transformers?: Map<number, Woff2Transform>;\r\n}\r\n\r\ninterface ResolvedWoff2Dependencies {\r\n  decompress: BrotliDecompress;\r\n  transformers: Map<number, Woff2Transform>;\r\n}\r\n\r\n// --- Constants & helpers ----------------------------------------------------\r\n\r\nconst WOFF2_SIGNATURE = 0x774f4632; // \"wOF2\"\r\nconst WOFF2_HEADER_SIZE = 48;\r\nconst WOFF2_FLAG_TRANSFORM = 1 << 8;\r\nconst SFNT_HEADER_SIZE = 12;\r\nconst SFNT_ENTRY_SIZE = 16;\r\nconst CHECKSUM_ADJUSTMENT_OFFSET = 8;\r\nconst MAX_PLAUSIBLE_COMPRESSION_RATIO = 100;\r\n\r\nconst TAG = (text: string) =>\r\n  (text.charCodeAt(0) << 24) |\r\n  (text.charCodeAt(1) << 16) |\r\n  (text.charCodeAt(2) << 8) |\r\n  text.charCodeAt(3);\r\n\r\nconst TAG_GLYF = TAG(\"glyf\");\r\nconst TAG_LOCA = TAG(\"loca\");\r\nconst TAG_HMTX = TAG(\"hmtx\");\r\nconst TAG_HHEA = TAG(\"hhea\");\r\nconst TAG_HEAD = TAG(\"head\");\r\n\r\n// Known tag lookup as defined in table_tags.cc\r\nconst KNOWN_TAGS: number[] = [\r\n  TAG(\"cmap\"),\r\n  TAG(\"head\"),\r\n  TAG(\"hhea\"),\r\n  TAG(\"hmtx\"),\r\n  TAG(\"maxp\"),\r\n  TAG(\"name\"),\r\n  TAG(\"OS/2\"),\r\n  TAG(\"post\"),\r\n  TAG(\"cvt \"),\r\n  TAG(\"fpgm\"),\r\n  TAG_GLYF,\r\n  TAG_LOCA,\r\n  TAG(\"prep\"),\r\n  TAG(\"CFF \"),\r\n  TAG(\"VORG\"),\r\n  TAG(\"EBDT\"),\r\n  TAG(\"EBLC\"),\r\n  TAG(\"gasp\"),\r\n  TAG(\"hdmx\"),\r\n  TAG(\"kern\"),\r\n  TAG(\"LTSH\"),\r\n  TAG(\"PCLT\"),\r\n  TAG(\"VDMX\"),\r\n  TAG(\"vhea\"),\r\n  TAG(\"vmtx\"),\r\n  TAG(\"BASE\"),\r\n  TAG(\"GDEF\"),\r\n  TAG(\"GPOS\"),\r\n  TAG(\"GSUB\"),\r\n  TAG(\"EBSC\"),\r\n  TAG(\"JSTF\"),\r\n  TAG(\"MATH\"),\r\n  TAG(\"CBDT\"),\r\n  TAG(\"CBLC\"),\r\n  TAG(\"COLR\"),\r\n  TAG(\"CPAL\"),\r\n  TAG(\"SVG \"),\r\n  TAG(\"sbix\"),\r\n  TAG(\"acnt\"),\r\n  TAG(\"avar\"),\r\n  TAG(\"bdat\"),\r\n  TAG(\"bloc\"),\r\n  TAG(\"bsln\"),\r\n  TAG(\"cvar\"),\r\n  TAG(\"fdsc\"),\r\n  TAG(\"feat\"),\r\n  TAG(\"fmtx\"),\r\n  TAG(\"fvar\"),\r\n  TAG(\"gvar\"),\r\n  TAG(\"hsty\"),\r\n  TAG(\"just\"),\r\n  TAG(\"lcar\"),\r\n  TAG(\"mort\"),\r\n  TAG(\"morx\"),\r\n  TAG(\"opbd\"),\r\n  TAG(\"prop\"),\r\n  TAG(\"trak\"),\r\n  TAG(\"Zapf\"),\r\n  TAG(\"Silf\"),\r\n  TAG(\"Glat\"),\r\n  TAG(\"Gloc\"),\r\n  TAG(\"Feat\"),\r\n  TAG(\"Sill\")\r\n];\r\n\r\nfunction tagToString(tag: number): string {\r\n  return String.fromCharCode(\r\n    (tag >> 24) & 0xff,\r\n    (tag >> 16) & 0xff,\r\n    (tag >> 8) & 0xff,\r\n    tag & 0xff\r\n  );\r\n}\r\n\r\nconst round4 = (v: number) => (v + 3) & ~3;\r\n\r\nfunction resolveDependencies(deps?: Partial<Woff2Dependencies>): ResolvedWoff2Dependencies {\r\n  return {\r\n    decompress: deps?.decompress ?? ((data: Uint8Array) => brotliDecompressSync(data)),\r\n    transformers: deps?.transformers ?? createDefaultTransformers(),\r\n  };\r\n}\r\n\r\nfunction computeULongSum(data: Uint8Array): number {\r\n  let checksum = 0 >>> 0;\r\n  const aligned = data.length & ~3;\r\n  for (let i = 0; i < aligned; i += 4) {\r\n    const value =\r\n      (data[i] << 24) |\r\n      (data[i + 1] << 16) |\r\n      (data[i + 2] << 8) |\r\n      data[i + 3];\r\n    checksum = (checksum + value) >>> 0;\r\n  }\r\n\r\n  if (aligned !== data.length) {\r\n    let v = 0;\r\n    for (let i = aligned; i < data.length; i++) {\r\n      v |= data[i] << (24 - 8 * (i & 3));\r\n    }\r\n    checksum = (checksum + v) >>> 0;\r\n  }\r\n  return checksum >>> 0;\r\n}\r\n\r\n// --- Data writers -----------------------------------------------------------\r\n\r\nfunction store16(value: number, out: Uint8Array, offset: number): number {\r\n  const v = value & 0xffff;\r\n  out[offset] = (v >> 8) & 0xff;\r\n  out[offset + 1] = v & 0xff;\r\n  return offset + 2;\r\n}\r\n\r\nfunction store32(value: number, out: Uint8Array, offset: number): number {\r\n  out[offset] = (value >>> 24) & 0xff;\r\n  out[offset + 1] = (value >>> 16) & 0xff;\r\n  out[offset + 2] = (value >>> 8) & 0xff;\r\n  out[offset + 3] = value & 0xff;\r\n  return offset + 4;\r\n}\r\n\r\n// --- Types used internally --------------------------------------------------\r\n\r\ninterface Woff2Table {\r\n  tag: number;\r\n  flags: number;\r\n  srcOffset: number;\r\n  srcLength: number;\r\n  transformLength: number;\r\n  dstLength: number;\r\n}\r\n\r\ninterface Woff2Header {\r\n  flavor: number;\r\n  numTables: number;\r\n  compressedOffset: number;\r\n  compressedLength: number;\r\n  uncompressedSize: number;\r\n  tables: Woff2Table[];\r\n}\r\n\r\ninterface GlyfReconstruction {\r\n  glyfData: Uint8Array;\r\n  locaData: Uint8Array;\r\n  glyfChecksum: number;\r\n  locaChecksum: number;\r\n  numGlyphs: number;\r\n  indexFormat: number;\r\n  xMins: Int16Array;\r\n}\r\n\r\ninterface TransformState {\r\n  glyfInfo: GlyfReconstruction | null;\r\n  numHMetrics: number;\r\n}\r\n\r\ninterface TransformContext {\r\n  header: Woff2Header;\r\n  tableMap: Map<number, Uint8Array>;\r\n  tablesByTag: Map<number, Woff2Table>;\r\n  state: TransformState;\r\n}\r\n\r\ntype Woff2Transform = (table: Woff2Table, srcData: Uint8Array, context: TransformContext) => void;\r\n\r\n// --- Table directory parsing ------------------------------------------------\r\n\r\nfunction readTableDirectory(buf: Buf, numTables: number): Woff2Table[] {\r\n  const tables: Woff2Table[] = [];\r\n  let srcOffset = 0;\r\n\r\n  for (let i = 0; i < numTables; i++) {\r\n    const flagByte = buf.readU8();\r\n    let tag: number;\r\n    if ((flagByte & 0x3f) === 0x3f) {\r\n      tag = buf.readU32();\r\n    } else {\r\n      tag = KNOWN_TAGS[flagByte & 0x3f] ?? 0;\r\n    }\r\n    const xformVersion = (flagByte >> 6) & 0x03;\r\n    let flags = 0;\r\n    if (tag === TAG_GLYF || tag === TAG_LOCA) {\r\n      if (xformVersion === 0) {\r\n        flags |= WOFF2_FLAG_TRANSFORM;\r\n      }\r\n    } else if (xformVersion !== 0) {\r\n      flags |= WOFF2_FLAG_TRANSFORM;\r\n    }\r\n    flags |= xformVersion;\r\n\r\n    const dstLength = readBase128(buf);\r\n    let transformLength = dstLength;\r\n    if (flags & WOFF2_FLAG_TRANSFORM) {\r\n      transformLength = readBase128(buf);\r\n      if (tag === TAG_LOCA && transformLength !== 0) {\r\n        throw new Error(\"Invalid WOFF2: transformed loca must have zero length\");\r\n      }\r\n    }\r\n\r\n    tables.push({\r\n      tag,\r\n      flags,\r\n      srcOffset,\r\n      srcLength: transformLength,\r\n      transformLength,\r\n      dstLength\r\n    });\r\n\r\n    srcOffset += transformLength;\r\n  }\r\n\r\n  return tables;\r\n}\r\n\r\nfunction parseHeader(fontData: Uint8Array): Woff2Header {\r\n  if (fontData.byteLength < WOFF2_HEADER_SIZE) {\r\n    throw new Error(\"Invalid WOFF2: file too short\");\r\n  }\r\n\r\n  const buf = new Buf(fontData);\r\n\r\n  const signature = buf.readU32();\r\n  if (signature !== WOFF2_SIGNATURE) {\r\n    throw new Error(\"Invalid WOFF2 signature\");\r\n  }\r\n\r\n  const flavor = buf.readU32() >>> 0;\r\n  const reportedLength = buf.readU32();\r\n  if (reportedLength !== fontData.byteLength) {\r\n    throw new Error(\"Invalid WOFF2: length mismatch\");\r\n  }\r\n\r\n  const numTables = buf.readU16();\r\n  if (numTables === 0) {\r\n    throw new Error(\"Invalid WOFF2: no tables\");\r\n  }\r\n\r\n  buf.skip(2 + 4); // reserved + totalSfntSize (unused)\r\n  const compressedLength = buf.readU32();\r\n  buf.skip(4); // major/minorVersion\r\n\r\n  // metadata and private blocks (validate bounds if present)\r\n  const metaOffset = buf.readU32();\r\n  const metaLength = buf.readU32();\r\n  const metaOrigLen = buf.readU32();\r\n  if (metaOffset !== 0) {\r\n    if (metaOffset + metaLength > fontData.byteLength || metaOrigLen === 0) {\r\n      throw new Error(\"Invalid WOFF2 metadata block\");\r\n    }\r\n  }\r\n\r\n  const privOffset = buf.readU32();\r\n  const privLength = buf.readU32();\r\n  if (privOffset !== 0 && privOffset + privLength > fontData.byteLength) {\r\n    throw new Error(\"Invalid WOFF2 private block\");\r\n  }\r\n\r\n  const tables = readTableDirectory(buf, numTables);\r\n\r\n  const lastTable = tables[tables.length - 1];\r\n  const uncompressedSize = lastTable.srcOffset + lastTable.srcLength;\r\n\r\n  const compressedOffset = buf.offset;\r\n  if (compressedOffset + compressedLength > fontData.byteLength) {\r\n    throw new Error(\"Invalid WOFF2: compressed stream truncated\");\r\n  }\r\n\r\n  // Basic ratio sanity check (similar to upstream impl)\r\n  const compressionRatio = uncompressedSize / Math.max(1, fontData.byteLength);\r\n  if (compressionRatio > MAX_PLAUSIBLE_COMPRESSION_RATIO) {\r\n    throw new Error(\"Invalid WOFF2: implausible compression ratio\");\r\n  }\r\n\r\n  return {\r\n    flavor,\r\n    numTables,\r\n    compressedOffset,\r\n    compressedLength,\r\n    uncompressedSize,\r\n    tables\r\n  };\r\n}\r\n\r\n// --- Glyf reconstruction helpers -------------------------------------------\r\n\r\nconst GLYF_FLAGS = {\r\n  ON_CURVE: 1 << 0,\r\n  X_SHORT: 1 << 1,\r\n  Y_SHORT: 1 << 2,\r\n  REPEAT: 1 << 3,\r\n  X_SAME: 1 << 4,\r\n  Y_SAME: 1 << 5,\r\n  OVERLAP_SIMPLE: 1 << 6\r\n};\r\n\r\nconst COMPOSITE_FLAGS = {\r\n  ARG_WORDS: 1 << 0,\r\n  WE_HAVE_A_SCALE: 1 << 3,\r\n  MORE_COMPONENTS: 1 << 5,\r\n  WE_HAVE_AN_XY_SCALE: 1 << 6,\r\n  WE_HAVE_A_TWO_BY_TWO: 1 << 7,\r\n  WE_HAVE_INSTRUCTIONS: 1 << 8\r\n};\r\n\r\nfunction withSign(flag: number, base: number): number {\r\n  return (flag & 1) ? base : -base;\r\n}\r\n\r\nfunction tripletDecode(\r\n  flagsIn: Uint8Array,\r\n  data: Uint8Array,\r\n  nPoints: number\r\n): { points: { x: number; y: number; onCurve: boolean }[]; consumed: number } {\r\n  let x = 0;\r\n  let y = 0;\r\n  let tripletIndex = 0;\r\n  const points: { x: number; y: number; onCurve: boolean }[] = new Array(\r\n    nPoints\r\n  );\r\n\r\n  for (let i = 0; i < nPoints; i++) {\r\n    let flag = flagsIn[i];\r\n    const onCurve = (flag >> 7) === 0;\r\n    flag &= 0x7f;\r\n    let nDataBytes = 1;\r\n    if (flag >= 84 && flag < 120) nDataBytes = 2;\r\n    else if (flag < 84) nDataBytes = 1;\r\n    else if (flag < 124) nDataBytes = 3;\r\n    else nDataBytes = 4;\r\n\r\n    if (tripletIndex + nDataBytes > data.length) {\r\n      throw new Error(\"Invalid WOFF2 glyf triplet\");\r\n    }\r\n    let dx: number;\r\n    let dy: number;\r\n    if (flag < 10) {\r\n      dx = 0;\r\n      dy = withSign(flag, ((flag & 14) << 7) + data[tripletIndex]);\r\n    } else if (flag < 20) {\r\n      dx = withSign(flag, (((flag - 10) & 14) << 7) + data[tripletIndex]);\r\n      dy = 0;\r\n    } else if (flag < 84) {\r\n      const b0 = flag - 20;\r\n      const b1 = data[tripletIndex];\r\n      dx = withSign(flag, 1 + (b0 & 0x30) + (b1 >> 4));\r\n      dy = withSign(flag >> 1, 1 + ((b0 & 0x0c) << 2) + (b1 & 0x0f));\r\n    } else if (flag < 120) {\r\n      const b0 = flag - 84;\r\n      dx = withSign(flag, 1 + ((b0 / 12) << 8) + data[tripletIndex]);\r\n      dy = withSign(\r\n        flag >> 1,\r\n        1 + (((b0 % 12) >> 2) << 8) + data[tripletIndex + 1]\r\n      );\r\n    } else if (flag < 124) {\r\n      const b2 = data[tripletIndex + 1];\r\n      dx = withSign(flag, (data[tripletIndex] << 4) + (b2 >> 4));\r\n      dy = withSign(flag >> 1, ((b2 & 0x0f) << 8) + data[tripletIndex + 2]);\r\n    } else {\r\n      dx = withSign(flag, (data[tripletIndex] << 8) + data[tripletIndex + 1]);\r\n      dy = withSign(\r\n        flag >> 1,\r\n        (data[tripletIndex + 2] << 8) + data[tripletIndex + 3]\r\n      );\r\n    }\r\n    tripletIndex += nDataBytes;\r\n    x += dx;\r\n    y += dy;\r\n    points[i] = { x, y, onCurve };\r\n  }\r\n\r\n  return { points, consumed: tripletIndex };\r\n}\r\n\r\nfunction storePoints(\r\n  points: { x: number; y: number; onCurve: boolean }[],\r\n  nContours: number,\r\n  instructionLength: number,\r\n  hasOverlap: boolean\r\n): Uint8Array {\r\n  const nPoints = points.length;\r\n  const xBytes: number[] = [];\r\n  const yBytes: number[] = [];\r\n\r\n  let lastX = 0;\r\n  let lastY = 0;\r\n  let lastFlag = -1;\r\n  let repeatCount = 0;\r\n\r\n  const flagOffset = 10 + 2 * nContours + 2 + instructionLength;\r\n\r\n  const flagsOut: number[] = [];\r\n\r\n  for (let i = 0; i < nPoints; i++) {\r\n    const point = points[i];\r\n    let flag = point.onCurve ? GLYF_FLAGS.ON_CURVE : 0;\r\n    if (hasOverlap && i === 0) {\r\n      flag |= GLYF_FLAGS.OVERLAP_SIMPLE;\r\n    }\r\n    const dx = point.x - lastX;\r\n    const dy = point.y - lastY;\r\n\r\n    if (dx === 0) flag |= GLYF_FLAGS.X_SAME;\r\n    else if (dx > -256 && dx < 256) {\r\n      flag |= GLYF_FLAGS.X_SHORT | (dx > 0 ? GLYF_FLAGS.X_SAME : 0);\r\n      xBytes.push(Math.abs(dx));\r\n    } else {\r\n      xBytes.push((dx >> 8) & 0xff, dx & 0xff);\r\n    }\r\n\r\n    if (dy === 0) flag |= GLYF_FLAGS.Y_SAME;\r\n    else if (dy > -256 && dy < 256) {\r\n      flag |= GLYF_FLAGS.Y_SHORT | (dy > 0 ? GLYF_FLAGS.Y_SAME : 0);\r\n      yBytes.push(Math.abs(dy));\r\n    } else {\r\n      yBytes.push((dy >> 8) & 0xff, dy & 0xff);\r\n    }\r\n\r\n    if (flag === lastFlag && repeatCount !== 255) {\r\n      flagsOut[flagsOut.length - 1] |= GLYF_FLAGS.REPEAT;\r\n      repeatCount++;\r\n    } else {\r\n      if (repeatCount !== 0) {\r\n        flagsOut.push(repeatCount);\r\n      }\r\n      flagsOut.push(flag);\r\n      repeatCount = 0;\r\n      lastFlag = flag;\r\n    }\r\n\r\n    lastX = point.x;\r\n    lastY = point.y;\r\n  }\r\n\r\n  if (repeatCount !== 0) {\r\n    flagsOut.push(repeatCount);\r\n  }\r\n\r\n  const totalSize = flagOffset + flagsOut.length + xBytes.length + yBytes.length;\r\n  const out = new Uint8Array(totalSize);\r\n  let offset = flagOffset;\r\n  for (const f of flagsOut) out[offset++] = f;\r\n  for (const b of xBytes) out[offset++] = b;\r\n  for (const b of yBytes) out[offset++] = b;\r\n  return out;\r\n}\r\n\r\nfunction computeBBox(points: { x: number; y: number }[]): [number, number, number, number] {\r\n  if (points.length === 0) {\r\n    return [0, 0, 0, 0];\r\n  }\r\n  let xMin = points[0].x;\r\n  let xMax = points[0].x;\r\n  let yMin = points[0].y;\r\n  let yMax = points[0].y;\r\n  for (let i = 1; i < points.length; i++) {\r\n    const p = points[i];\r\n    if (p.x < xMin) xMin = p.x;\r\n    if (p.x > xMax) xMax = p.x;\r\n    if (p.y < yMin) yMin = p.y;\r\n    if (p.y > yMax) yMax = p.y;\r\n  }\r\n  return [xMin, yMin, xMax, yMax];\r\n}\r\n\r\nfunction sizeOfComposite(stream: Buf): { size: number; haveInstructions: boolean } {\r\n  const start = stream.offset;\r\n  let flags = COMPOSITE_FLAGS.MORE_COMPONENTS;\r\n  let haveInstructions = false;\r\n\r\n  while (flags & COMPOSITE_FLAGS.MORE_COMPONENTS) {\r\n    flags = stream.readU16();\r\n    haveInstructions ||= (flags & COMPOSITE_FLAGS.WE_HAVE_INSTRUCTIONS) !== 0;\r\n    let argSize = 2; // glyph index\r\n    if (flags & COMPOSITE_FLAGS.ARG_WORDS) argSize += 4;\r\n    else argSize += 2;\r\n\r\n    if (flags & COMPOSITE_FLAGS.WE_HAVE_A_SCALE) argSize += 2;\r\n    else if (flags & COMPOSITE_FLAGS.WE_HAVE_AN_XY_SCALE) argSize += 4;\r\n    else if (flags & COMPOSITE_FLAGS.WE_HAVE_A_TWO_BY_TWO) argSize += 8;\r\n\r\n    stream.skip(argSize);\r\n  }\r\n\r\n  return { size: stream.offset - start, haveInstructions };\r\n}\r\n\r\nfunction storeLoca(\r\n  locaValues: number[],\r\n  indexFormat: number\r\n): { data: Uint8Array; checksum: number } {\r\n  const offsetSize = indexFormat ? 4 : 2;\r\n  const buffer = new Uint8Array(locaValues.length * offsetSize);\r\n  let off = 0;\r\n  for (const value of locaValues) {\r\n    if (indexFormat) {\r\n      off = store32(value, buffer, off);\r\n    } else {\r\n      off = store16(value >> 1, buffer, off);\r\n    }\r\n  }\r\n  return { data: buffer, checksum: computeULongSum(buffer) };\r\n}\r\n\r\nfunction reconstructGlyfTable(\r\n  transformed: Uint8Array,\r\n  locaDstLength: number\r\n): GlyfReconstruction {\r\n  const stream = new Buf(transformed);\r\n  /* const version = */ stream.readU16();\r\n  const flags = stream.readU16();\r\n  const hasOverlapBitmap = (flags & 1) !== 0;\r\n  const numGlyphs = stream.readU16();\r\n  const indexFormat = stream.readU16();\r\n\r\n  const substreamSizes: number[] = [];\r\n  for (let i = 0; i < 7; i++) {\r\n    substreamSizes.push(stream.readU32());\r\n  }\r\n\r\n  let dataOffset = (2 + 7) * 4; // header (version/flags/numGlyphs/indexFormat + sizes)\r\n  const substreams: Uint8Array[] = [];\r\n  for (const sz of substreamSizes) {\r\n    if (dataOffset + sz > transformed.length) {\r\n      throw new Error(\"Invalid WOFF2 glyf stream\");\r\n    }\r\n    substreams.push(transformed.subarray(dataOffset, dataOffset + sz));\r\n    dataOffset += sz;\r\n  }\r\n\r\n  let overlapBitmap: Uint8Array | null = null;\r\n  if (hasOverlapBitmap) {\r\n    const len = (numGlyphs + 7) >> 3;\r\n    if (dataOffset + len > transformed.length) {\r\n      throw new Error(\"Invalid WOFF2 overlap bitmap\");\r\n    }\r\n    overlapBitmap = transformed.subarray(dataOffset, dataOffset + len);\r\n  }\r\n\r\n  const nContourStream = new Buf(substreams[0]);\r\n  const nPointsStream = new Buf(substreams[1]);\r\n  const flagStream = new Buf(substreams[2]);\r\n  const glyphStream = new Buf(substreams[3]);\r\n  const compositeStream = new Buf(substreams[4]);\r\n  const bboxStream = new Buf(substreams[5]);\r\n  const instructionStream = new Buf(substreams[6]);\r\n\r\n  const bboxBitmapLen = ((numGlyphs + 31) >> 5) << 2;\r\n  const bboxBitmap = bboxStream.readBytes(bboxBitmapLen);\r\n\r\n  const locaValues = new Array<number>(numGlyphs + 1).fill(0);\r\n  const xMins = new Int16Array(numGlyphs);\r\n  const glyfChunks: Uint8Array[] = [];\r\n  let glyfChecksum = 0 >>> 0;\r\n  let currentGlyfOffset = 0;\r\n\r\n  for (let i = 0; i < numGlyphs; i++) {\r\n    const nContours = nContourStream.readU16();\r\n    const haveBbox = (bboxBitmap[i >> 3] & (0x80 >> (i & 7))) !== 0;\r\n    let glyphBytes: Uint8Array | null = null;\r\n\r\n    if (nContours === 0xffff) {\r\n      // Composite\r\n      const { size: compositeSize, haveInstructions } = sizeOfComposite(\r\n        new Buf(compositeStream.peekRemaining())\r\n      );\r\n      let instructionSize = 0;\r\n      if (haveInstructions) {\r\n        instructionSize = read255UShort(glyphStream);\r\n      }\r\n      const total =\r\n        12 + compositeSize + instructionSize; // nContours + bbox + composite + instructions\r\n      const out = new Uint8Array(total);\r\n      let off = 0;\r\n      off = store16(nContours, out, off);\r\n      if (!haveBbox) {\r\n        throw new Error(\"Invalid WOFF2 glyf: composite without bbox\");\r\n      }\r\n      const bboxData = bboxStream.readBytes(8);\r\n      const xMinRaw = (bboxData[0] << 8) | bboxData[1];\r\n      xMins[i] = xMinRaw & 0x8000 ? xMinRaw - 0x10000 : xMinRaw;\r\n      out.set(bboxData, off);\r\n      off += 8;\r\n      out.set(compositeStream.readBytes(compositeSize), off);\r\n      off += compositeSize;\r\n      if (haveInstructions) {\r\n        off = store16(instructionSize, out, off);\r\n        out.set(instructionStream.readBytes(instructionSize), off);\r\n      }\r\n      glyphBytes = out;\r\n    } else if (nContours > 0) {\r\n      const nPoints: number[] = [];\r\n      let totalPoints = 0;\r\n      for (let c = 0; c < nContours; c++) {\r\n        const pts = read255UShort(nPointsStream);\r\n        totalPoints += pts;\r\n        nPoints.push(pts);\r\n      }\r\n      const flagData = flagStream.readBytes(totalPoints);\r\n      const tripletsView = glyphStream.peekRemaining();\r\n      const { points, consumed } = tripletDecode(\r\n        flagData,\r\n        tripletsView,\r\n        totalPoints\r\n      );\r\n      glyphStream.offset += consumed;\r\n      const instructionSize = read255UShort(glyphStream);\r\n      const bbox = haveBbox ? bboxStream.readBytes(8) : null;\r\n\r\n      const baseSize = 12 + 2 * nContours + instructionSize;\r\n      const ptsBuf = storePoints(\r\n        points,\r\n        nContours,\r\n        instructionSize,\r\n        !!(overlapBitmap && (overlapBitmap[i >> 3] & (0x80 >> (i & 7))))\r\n      );\r\n      const glyphBuf = new Uint8Array(ptsBuf.length);\r\n      glyphBuf.set(ptsBuf);\r\n\r\n      let off = 0;\r\n      off = store16(nContours, glyphBuf, off);\r\n      if (bbox) {\r\n        glyphBuf.set(bbox, off);\r\n        off += 8;\r\n      } else {\r\n        const [xMin, yMin, xMax, yMax] = computeBBox(points);\r\n        off = store16(xMin, glyphBuf, off);\r\n        off = store16(yMin, glyphBuf, off);\r\n        off = store16(xMax, glyphBuf, off);\r\n        off = store16(yMax, glyphBuf, off);\r\n      }\r\n      let endPoint = -1;\r\n      for (const count of nPoints) {\r\n        endPoint += count;\r\n        off = store16(endPoint, glyphBuf, off);\r\n      }\r\n      off = store16(instructionSize, glyphBuf, off);\r\n      const remaining = instructionStream.peekRemaining().length;\r\n      const safeSize = Math.min(instructionSize, remaining);\r\n      const instructions = instructionStream.readBytes(safeSize);\r\n      glyphBuf.set(instructions, off);\r\n\r\n      glyphBytes = glyphBuf;\r\n\r\n      const xMinRaw = (glyphBuf[2] << 8) | glyphBuf[3];\r\n      xMins[i] = xMinRaw & 0x8000 ? xMinRaw - 0x10000 : xMinRaw;\r\n    } else {\r\n      // Empty glyph\r\n      if (haveBbox) {\r\n        throw new Error(\"Invalid WOFF2 glyf: empty glyph with bbox\");\r\n      }\r\n      glyphBytes = new Uint8Array(0);\r\n    }\r\n\r\n    locaValues[i] = currentGlyfOffset;\r\n    glyfChunks.push(glyphBytes);\r\n    currentGlyfOffset += round4(glyphBytes.length);\r\n    glyfChecksum = (glyfChecksum + computeULongSum(glyphBytes)) >>> 0;\r\n  }\r\n\r\n  locaValues[numGlyphs] = currentGlyfOffset;\r\n\r\n  if (locaDstLength !== (indexFormat ? 4 : 2) * (numGlyphs + 1)) {\r\n    throw new Error(\"Invalid WOFF2 loca length\");\r\n  }\r\n\r\n  // Build glyf table with per-glyph padding\r\n  const glyfSize = locaValues[numGlyphs];\r\n  const glyfData = new Uint8Array(glyfSize);\r\n  let glyfOffset = 0;\r\n  for (const chunk of glyfChunks) {\r\n    glyfData.set(chunk, glyfOffset);\r\n    glyfOffset += chunk.length;\r\n    const padded = round4(glyfOffset) - glyfOffset;\r\n    glyfOffset += padded;\r\n  }\r\n\r\n  const loca = storeLoca(locaValues, indexFormat);\r\n\r\n  return {\r\n    glyfData,\r\n    locaData: loca.data,\r\n    glyfChecksum,\r\n    locaChecksum: loca.checksum,\r\n    numGlyphs,\r\n    indexFormat,\r\n    xMins\r\n  };\r\n}\r\n\r\n// --- HMTX reconstruction ----------------------------------------------------\r\n\r\nfunction readNumHMetrics(hheaTable: Uint8Array): number {\r\n  const buf = new Buf(hheaTable);\r\n  buf.skip(34);\r\n  return buf.readU16();\r\n}\r\n\r\nfunction reconstructTransformedHmtx(\r\n  transformed: Uint8Array,\r\n  numGlyphs: number,\r\n  numHMetrics: number,\r\n  xMins: Int16Array\r\n): { data: Uint8Array; checksum: number } {\r\n  const buf = new Buf(transformed);\r\n  const flags = buf.readU8();\r\n  const hasPropLSB = (flags & 1) === 0;\r\n  const hasMonoLSB = (flags & 2) === 0;\r\n  if ((flags & 0xfc) !== 0) {\r\n    throw new Error(\"Invalid hmtx flags\");\r\n  }\r\n  if (hasPropLSB && hasMonoLSB) {\r\n    throw new Error(\"Invalid hmtx transform state\");\r\n  }\r\n  if (numHMetrics < 1 || numHMetrics > numGlyphs) {\r\n    throw new Error(\"Invalid hmtx metrics count\");\r\n  }\r\n\r\n  const advanceWidths: number[] = [];\r\n  const lsbs: number[] = [];\r\n\r\n  for (let i = 0; i < numHMetrics; i++) {\r\n    advanceWidths.push(buf.readU16());\r\n  }\r\n\r\n  for (let i = 0; i < numHMetrics; i++) {\r\n    lsbs.push(hasPropLSB ? buf.readS16() : xMins[i]);\r\n  }\r\n\r\n  for (let i = numHMetrics; i < numGlyphs; i++) {\r\n    lsbs.push(hasMonoLSB ? buf.readS16() : xMins[i]);\r\n  }\r\n\r\n  const out = new Uint8Array(2 * numGlyphs + 2 * numHMetrics);\r\n  let off = 0;\r\n  for (let i = 0; i < numGlyphs; i++) {\r\n    if (i < numHMetrics) {\r\n      off = store16(advanceWidths[i], out, off);\r\n    }\r\n    off = store16(lsbs[i], out, off);\r\n  }\r\n\r\n  return { data: out, checksum: computeULongSum(out) };\r\n}\r\n\r\n// --- Transform registry ----------------------------------------------------\r\n\r\nfunction transformGlyfTable(\r\n  _table: Woff2Table,\r\n  srcData: Uint8Array,\r\n  context: TransformContext,\r\n): void {\r\n  const locaTable = context.tablesByTag.get(TAG_LOCA);\r\n  if (!locaTable) {\r\n    throw new Error(\"Invalid WOFF2: missing loca for glyf\");\r\n  }\r\n  const glyfInfo = reconstructGlyfTable(srcData, locaTable.dstLength);\r\n  context.state.glyfInfo = glyfInfo;\r\n  context.tableMap.set(TAG_GLYF, glyfInfo.glyfData);\r\n  context.tableMap.set(TAG_LOCA, glyfInfo.locaData);\r\n}\r\n\r\nfunction transformLocaTable(\r\n  _table: Woff2Table,\r\n  _srcData: Uint8Array,\r\n  context: TransformContext,\r\n): void {\r\n  if (!context.tableMap.has(TAG_LOCA)) {\r\n    throw new Error(\"Invalid WOFF2: loca transformed without glyf\");\r\n  }\r\n}\r\n\r\nfunction transformHmtxTable(\r\n  _table: Woff2Table,\r\n  srcData: Uint8Array,\r\n  context: TransformContext,\r\n): void {\r\n  const glyfInfo = context.state.glyfInfo;\r\n  if (!glyfInfo) {\r\n    throw new Error(\"Invalid WOFF2: hmtx transform before glyf\");\r\n  }\r\n  const hmtx = reconstructTransformedHmtx(\r\n    srcData,\r\n    glyfInfo.numGlyphs,\r\n    context.state.numHMetrics,\r\n    glyfInfo.xMins\r\n  );\r\n  context.tableMap.set(TAG_HMTX, hmtx.data);\r\n}\r\n\r\nfunction createDefaultTransformers(): Map<number, Woff2Transform> {\r\n  return new Map<number, Woff2Transform>([\r\n    [TAG_GLYF, transformGlyfTable],\r\n    [TAG_LOCA, transformLocaTable],\r\n    [TAG_HMTX, transformHmtxTable],\r\n  ]);\r\n}\r\n\r\n// --- Font rebuild -----------------------------------------------------------\r\n\r\nfunction buildSfnt(\r\n  flavor: number,\r\n  tableData: Map<number, Uint8Array>\r\n): { ttf: Uint8Array; tables: Record<string, Uint8Array> } {\r\n  const entries = Array.from(tableData.entries()).sort((a, b) => a[0] - b[0]);\r\n  const numTables = entries.length;\r\n  let offset = SFNT_HEADER_SIZE + SFNT_ENTRY_SIZE * numTables;\r\n\r\n  const records: {\r\n    tag: number;\r\n    checksum: number;\r\n    offset: number;\r\n    length: number;\r\n    data: Uint8Array;\r\n  }[] = [];\r\n\r\n  for (const [tag, data] of entries) {\r\n    const paddedLen = round4(data.length);\r\n    records.push({\r\n      tag,\r\n      checksum: computeULongSum(data),\r\n      offset,\r\n      length: data.length,\r\n      data\r\n    });\r\n    offset += paddedLen;\r\n  }\r\n\r\n  const ttf = new Uint8Array(offset);\r\n  let off = 0;\r\n  off = store32(flavor >>> 0, ttf, off);\r\n  off = store16(numTables, ttf, off);\r\n  let maxPow2 = 0;\r\n  while ((1 << (maxPow2 + 1)) <= numTables) maxPow2++;\r\n  const searchRange = (1 << maxPow2) * 16;\r\n  off = store16(searchRange, ttf, off);\r\n  off = store16(maxPow2, ttf, off);\r\n  off = store16(numTables * 16 - searchRange, ttf, off);\r\n\r\n  // table records\r\n  for (const rec of records) {\r\n    off = store32(rec.tag, ttf, off);\r\n    off = store32(rec.checksum, ttf, off);\r\n    off = store32(rec.offset, ttf, off);\r\n    off = store32(rec.length, ttf, off);\r\n  }\r\n\r\n  for (const rec of records) {\r\n    ttf.set(rec.data, rec.offset);\r\n    // zero padding already present\r\n  }\r\n\r\n  // checkSumAdjustment for 'head'\r\n  const headRecord = records.find((r) => r.tag === TAG_HEAD);\r\n  if (headRecord) {\r\n    const checksum = computeULongSum(ttf);\r\n    const adjustment = (0xb1b0afba - checksum) >>> 0;\r\n    store32(adjustment, ttf, headRecord.offset + CHECKSUM_ADJUSTMENT_OFFSET);\r\n  }\r\n\r\n  const tables: Record<string, Uint8Array> = {};\r\n  for (const [tag, data] of entries) {\r\n    tables[tagToString(tag)] = data;\r\n  }\r\n\r\n  return { ttf, tables };\r\n}\r\n\r\nfunction rebuildFont(\r\n  header: Woff2Header,\r\n  transformed: Uint8Array,\r\n  deps: ResolvedWoff2Dependencies\r\n): { ttf: Uint8Array; tables: Record<string, Uint8Array> } {\r\n  const tableMap = new Map<number, Uint8Array>();\r\n  const tablesByTag = new Map(header.tables.map((t) => [t.tag, t]));\r\n  const state: TransformState = { glyfInfo: null, numHMetrics: 0 };\r\n  const context: TransformContext = { header, tableMap, tablesByTag, state };\r\n  const transformers = deps.transformers;\r\n\r\n  const sortedTables = header.tables.slice().sort((a, b) => a.tag - b.tag);\r\n\r\n  for (const table of sortedTables) {\r\n    const srcStart = table.srcOffset;\r\n    const srcEnd = srcStart + table.srcLength;\r\n    if (srcEnd > transformed.length) {\r\n      throw new Error(\"Invalid WOFF2: table outside brotli buffer\");\r\n    }\r\n    const srcData = transformed.subarray(srcStart, srcEnd);\r\n\r\n    if ((table.flags & WOFF2_FLAG_TRANSFORM) === 0) {\r\n      const data = new Uint8Array(srcData); // copy\r\n      if (table.tag === TAG_HEAD && data.length >= 12) {\r\n        // Zero checkSumAdjustment before checksums\r\n        data[CHECKSUM_ADJUSTMENT_OFFSET] = 0;\r\n        data[CHECKSUM_ADJUSTMENT_OFFSET + 1] = 0;\r\n        data[CHECKSUM_ADJUSTMENT_OFFSET + 2] = 0;\r\n        data[CHECKSUM_ADJUSTMENT_OFFSET + 3] = 0;\r\n      }\r\n      tableMap.set(table.tag, data);\r\n      if (table.tag === TAG_HHEA) {\r\n        state.numHMetrics = readNumHMetrics(data);\r\n      }\r\n      continue;\r\n    }\r\n\r\n    const transformer = transformers.get(table.tag);\r\n    if (!transformer) {\r\n      throw new Error(`Unsupported WOFF2 transform for ${tagToString(table.tag)}`);\r\n    }\r\n    transformer(table, srcData, context);\r\n  }\r\n\r\n  return buildSfnt(header.flavor, tableMap);\r\n}\r\n\r\n// --- Public API -------------------------------------------------------------\r\n\r\nexport function decodeWoff2(\r\n  fontData: Uint8Array,\r\n  deps?: Partial<Woff2Dependencies>\r\n): { parsed: ParsedFont; ttfBuffer: Uint8Array } {\r\n  const resolvedDeps = resolveDependencies(deps);\r\n  const header = parseHeader(fontData);\r\n  const compressed = fontData.subarray(\r\n    header.compressedOffset,\r\n    header.compressedOffset + header.compressedLength\r\n  );\r\n\r\n  const decompressed = resolvedDeps.decompress(compressed);\r\n  if (decompressed.byteLength !== header.uncompressedSize) {\r\n    throw new Error(\"Invalid WOFF2: brotli size mismatch\");\r\n  }\r\n\r\n  const rebuilt = rebuildFont(header, decompressed, resolvedDeps);\r\n\r\n  const parsed: ParsedFont = {\r\n    flavor: header.flavor,\r\n    numTables: header.numTables,\r\n    tables: rebuilt.tables\r\n  };\r\n\r\n  return { parsed, ttfBuffer: rebuilt.ttf };\r\n}\r\n", "/**\r\n * Simple shelf-based glyph atlas packer.\r\n *\r\n * Purpose:\r\n * - Pack many small glyph alpha masks into one or more RGBA atlas pages.\r\n * - Provide placement metadata so caller can later extract or reference the region.\r\n *\r\n * Notes:\r\n * - This implementation focuses on correctness and simplicity (shelf packer).\r\n * - Atlas pages are stored as RGBA Uint8Array buffers where R=G=B=0 and A=mask.\r\n * - Does NOT yet integrate automatically with PDF image registration;\r\n *   that will be done in the rendering path in a follow-up step.\r\n */\r\n\r\nexport interface AtlasPlacement {\r\n  readonly pageIndex: number;\r\n  readonly x: number;\r\n  readonly y: number;\r\n  readonly width: number;\r\n  readonly height: number;\r\n}\r\n\r\nexport interface AtlasPage {\r\n  readonly width: number;\r\n  readonly height: number;\r\n  readonly data: Uint8Array; // RGBA\r\n}\r\n\r\ntype Key = string;\r\n\r\nconst DEFAULT_PAGE_SIZE = 2048; // square atlas page default\r\n// Increase base padding to reduce risk of blur bleeding between packed glyphs.\r\n// We still add extraPadding from the caller (e.g. glyph-cache) for blur radius.\r\nconst PADDING = 2; // padding around glyphs to avoid bleeding\r\n\r\nclass Shelf {\r\n  y: number;\r\n  height: number;\r\n  xCursor: number;\r\n  remaining: number;\r\n  constructor(y: number, height: number, pageWidth: number) {\r\n    this.y = y;\r\n    this.height = height;\r\n    this.xCursor = 0;\r\n    this.remaining = pageWidth;\r\n  }\r\n}\r\n\r\n/**\r\n * AtlasManager\r\n */\r\nexport class GlyphAtlas {\r\n  private pageSize = DEFAULT_PAGE_SIZE;\r\n  private pages: { width: number; height: number; data: Uint8Array; shelves: Shelf[]; used: number; lastUsed: number }[] = [];\r\n  private placements = new Map<Key, AtlasPlacement>();\r\n  // LRU eviction control for shelf atlas\r\n  private maxPages = 8;\r\n  setMaxPages(n: number) {\r\n    if (!Number.isFinite(n) || n < 1) return;\r\n    this.maxPages = Math.max(1, Math.floor(n));\r\n    this.evictIfNeeded();\r\n  }\r\n\r\n  constructor(pageSize = DEFAULT_PAGE_SIZE) {\r\n    this.pageSize = pageSize;\r\n  }\r\n\r\n  clear() {\r\n    this.pages = [];\r\n    this.placements.clear();\r\n  }\r\n\r\n  getPages(): AtlasPage[] {\r\n    return this.pages.map((p) => ({ width: p.width, height: p.height, data: p.data.slice() }));\r\n  }\r\n\r\n  has(key: Key): boolean {\r\n    return this.placements.has(key);\r\n  }\r\n\r\n  getPlacement(key: Key): AtlasPlacement | null {\r\n    return this.placements.get(key) ?? null;\r\n  }\r\n\r\n  /**\r\n   * Pack an alpha mask into the atlas.\r\n   * - key: unique identifier for the glyph (e.g., fontUid|gid|size|ss)\r\n   * - mask: Uint8ClampedArray length = w*h\r\n   * - w,h: dimensions\r\n   * Returns placement or null on failure.\r\n   */\r\n  pack(key: Key, mask: Uint8ClampedArray, w: number, h: number, extraPadding = 0): AtlasPlacement | null {\r\n    if (this.placements.has(key)) {\r\n      return this.placements.get(key)!;\r\n    }\r\n    const pw = this.pageSize;\r\n    const ph = this.pageSize;\r\n    const pad = PADDING + Math.max(0, Math.floor(extraPadding));\r\n    const rw = w + pad * 2;\r\n    const rh = h + pad * 2;\r\n\r\n    // Try existing pages\r\n    for (let pi = 0; pi < this.pages.length; pi++) {\r\n      const page = this.pages[pi];\r\n      // try to fit in existing shelves\r\n      for (const shelf of page.shelves) {\r\n        if (rh <= shelf.height && rw <= shelf.remaining) {\r\n          // place it\r\n          const x = shelf.xCursor + pad;\r\n          const y = shelf.y + pad;\r\n          this.blitToPage(page.data, page.width, page.height, x, y, mask, w, h);\r\n          shelf.xCursor += rw;\r\n          shelf.remaining -= rw;\r\n          page.used += rw * rh;\r\n          page.lastUsed = Date.now();\r\n          const placement: AtlasPlacement = { pageIndex: pi, x, y, width: w, height: h };\r\n          this.placements.set(key, placement);\r\n          return placement;\r\n        }\r\n      }\r\n\r\n      // If no shelf fits, try to create a new shelf at bottom if space allows\r\n      const usedHeight = page.shelves.reduce((s, sh) => s + sh.height, 0);\r\n      if (usedHeight + rh <= page.height) {\r\n        const shelfY = usedHeight;\r\n        const shelf = new Shelf(shelfY, rh, page.width);\r\n        page.shelves.push(shelf);\r\n        // place at start\r\n        const x = shelf.xCursor + pad;\r\n        const y = shelf.y + pad;\r\n        this.blitToPage(page.data, page.width, page.height, x, y, mask, w, h);\r\n        shelf.xCursor += rw;\r\n        shelf.remaining -= rw;\r\n        page.used += rw * rh;\r\n        page.lastUsed = Date.now();\r\n        const placement: AtlasPlacement = { pageIndex: pi, x, y, width: w, height: h };\r\n        this.placements.set(key, placement);\r\n        return placement;\r\n      }\r\n    }\r\n\r\n    // No existing page fits: create a new page\r\n    const pageW = pw;\r\n    const pageH = ph;\r\n    const pageData = new Uint8Array(pageW * pageH * 4); // RGBA\r\n    // default rgba zeros\r\n    const newPage = { width: pageW, height: pageH, data: pageData, shelves: [] as Shelf[], used: 0, lastUsed: Date.now() };\r\n    // create first shelf\r\n    if (rh > pageH || rw > pageW) {\r\n      // too large for page\r\n      return null;\r\n    }\r\n    const shelf = new Shelf(0, rh, pageW);\r\n    newPage.shelves.push(shelf);\r\n    this.pages.push(newPage);\r\n    // enforce max pages after adding page\r\n    this.evictIfNeeded();\r\n    const x = shelf.xCursor + pad;\r\n    const y = shelf.y + pad;\r\n    this.blitToPage(newPage.data, newPage.width, newPage.height, x, y, mask, w, h);\r\n    shelf.xCursor += rw;\r\n    shelf.remaining -= rw;\r\n    newPage.used += rw * rh;\r\n    newPage.lastUsed = Date.now();\r\n    const placement: AtlasPlacement = { pageIndex: this.pages.length - 1, x, y, width: w, height: h };\r\n    this.placements.set(key, placement);\r\n    return placement;\r\n  }\r\n\r\n  private evictIfNeeded() {\r\n    while (this.pages.length > this.maxPages) {\r\n      this.evictLeastRecentlyUsedPage();\r\n    }\r\n  }\r\n\r\n  private evictLeastRecentlyUsedPage() {\r\n    if (this.pages.length === 0) return;\r\n    let oldest = 0;\r\n    let oldestTime = Infinity;\r\n    for (let i = 0; i < this.pages.length; i++) {\r\n      const p = this.pages[i];\r\n      if (p.lastUsed < oldestTime) {\r\n        oldestTime = p.lastUsed;\r\n        oldest = i;\r\n      }\r\n    }\r\n    this.evictPage(oldest);\r\n  }\r\n\r\n  private evictPage(idx: number) {\r\n    if (idx < 0 || idx >= this.pages.length) return;\r\n    // Remove page data\r\n    this.pages.splice(idx, 1);\r\n    // Remove placements that pointed to this page and adjust pageIndex for later pages\r\n    for (const [k, placement] of Array.from(this.placements.entries())) {\r\n      if (placement.pageIndex === idx) {\r\n        this.placements.delete(k);\r\n      } else if (placement.pageIndex > idx) {\r\n        this.placements.set(k, { ...placement, pageIndex: placement.pageIndex - 1 });\r\n      }\r\n    }\r\n    // NOTE: shelf atlas does not maintain a hashIndex for dedupe.\r\n    // Eviction only updates placements above; nothing more to adjust here.\r\n  }\r\n\r\n  private blitToPage(pageData: Uint8Array, pageW: number, _pageH: number, dstX: number, dstY: number, mask: Uint8ClampedArray, w: number, h: number) {\r\n    // pageData is RGBA; we write R=G=B=0, A = mask\r\n    for (let row = 0; row < h; row++) {\r\n      const srcOff = row * w;\r\n      const dstRow = (dstY + row) * pageW;\r\n      let dstCol = dstX;\r\n      for (let col = 0; col < w; col++) {\r\n        const a = mask[srcOff + col];\r\n        const di = (dstRow + dstCol) * 4;\r\n        pageData[di] = 0;\r\n        pageData[di + 1] = 0;\r\n        pageData[di + 2] = 0;\r\n        pageData[di + 3] = a;\r\n        dstCol++;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/** Singleton atlas for now (can be replaced with per-font/per-size atlases later) */\r\nexport const globalGlyphAtlas = new GlyphAtlas(DEFAULT_PAGE_SIZE);\r\n", "/**\n * Browser implementation of the Environment interfaces.\n * Uses fetch for loading and DecompressionStream for inflateRaw (with a guard).\n */\nimport type { Compression, Environment, ResourceLoader } from \"./environment.js\";\n\nclass BrowserLoader implements ResourceLoader {\n  async load(source: string): Promise<ArrayBuffer> {\n    const response = await fetch(source);\n    if (!response.ok) {\n      throw new Error(`Failed to fetch resource: ${source} (${response.status})`);\n    }\n    return await response.arrayBuffer();\n  }\n}\n\nconst DecompressionStreamCtor: typeof DecompressionStream | undefined = (globalThis as any).DecompressionStream;\n\nclass BrowserCompression implements Compression {\n  async inflateRaw(data: Uint8Array): Promise<Uint8Array> {\n    if (!DecompressionStreamCtor) {\n      throw new Error(\"DecompressionStream not available; provide a polyfill (e.g., pako) for inflateRaw.\");\n    }\n    const stream = new DecompressionStreamCtor(\"deflate-raw\");\n    const writer = stream.writable.getWriter();\n    await writer.write(new Uint8Array(data) as BufferSource);\n    await writer.close();\n    const reader = stream.readable.getReader();\n    const chunks: Uint8Array[] = [];\n    let total = 0;\n    for (;;) {\n      const { done, value } = await reader.read();\n      if (done) break;\n      chunks.push(value);\n      total += value.byteLength;\n    }\n    const out = new Uint8Array(total);\n    let offset = 0;\n    for (const chunk of chunks) {\n      out.set(chunk, offset);\n      offset += chunk.byteLength;\n    }\n    return out;\n  }\n}\n\nexport class BrowserEnvironment implements Environment {\n  readonly loader: ResourceLoader;\n  readonly compression: Compression;\n\n  constructor() {\n    this.loader = new BrowserLoader();\n    this.compression = new BrowserCompression();\n  }\n\n  resolveLocal(source: string, base?: string): string {\n    if (/^data:/i.test(source)) return source;\n    if (/^[a-z][a-z0-9+\\-.]*:\\/\\//i.test(source) || source.startsWith(\"//\")) {\n      return source;\n    }\n    if (base) {\n      try {\n        return new URL(source, base).toString();\n      } catch {\n        // ignore and fall through\n      }\n    }\n    throw new Error(`Local path resolution is not supported in browser environment: ${source}`);\n  }\n\n  now(): number {\n    return typeof performance !== \"undefined\" ? performance.now() : Date.now();\n  }\n\n  getEnv(_name: string): string | undefined {\n    return undefined;\n  }\n}\n", "/**\n * Helper to set the global environment for browser builds.\n * Use this to avoid threading Environment through every call when bootstrapping.\n */\nimport type { Environment } from \"./environment.js\";\n\nexport function setGlobalEnvironment(env: Environment): void {\n  (globalThis as any).__PAGYRA_ENV__ = env;\n}\n\nexport function getGlobalEnvironment(): Environment | undefined {\n  return (globalThis as any).__PAGYRA_ENV__ as Environment | undefined;\n}\n", "// used in Attr to signal changes\nexport const CHANGED = Symbol('changed');\n\n// used in Element to setup once classList\nexport const CLASS_LIST = Symbol('classList');\n\n// used in Document to attach once customElements\nexport const CUSTOM_ELEMENTS = Symbol('CustomElements');\n\n// used in HTMLTemplateElement\nexport const CONTENT = Symbol('content');\n\n// used in Element for data attributes\nexport const DATASET = Symbol('dataset');\n\n// used in Document to attach the DocType\nexport const DOCTYPE = Symbol('doctype');\n\n// used in parser and Document to attach once a DOMParser\nexport const DOM_PARSER = Symbol('DOMParser');\n\n// used to reference an end node\nexport const END = Symbol('end');\n\n// used in Document to make the globalThis an event target\nexport const EVENT_TARGET = Symbol('EventTarget');\n\n// used to augment a created document defaultView\nexport const GLOBALS = Symbol('globals');\n\n// used in both Canvas and Document to provide images\nexport const IMAGE = Symbol('image');\n\n// used to define Document mime type\nexport const MIME = Symbol('mime');\n\n// used in Document to attach once MutationObserver\nexport const MUTATION_OBSERVER = Symbol('MutationObserver');\n\n// used to define next node reference\nexport const NEXT = Symbol('next');\n\n// used to define Attr owner elements\nexport const OWNER_ELEMENT = Symbol('ownerElement');\n\n// used to define previous node reference\nexport const PREV = Symbol('prev');\n\n// used to define various \"private\" properties\nexport const PRIVATE = Symbol('private');\n\n// used to define the CSSStyleSheet.sheet\nexport const SHEET = Symbol('sheet');\n\n// used to define start node reference\nexport const START = Symbol('start');\n\n// used to define special CSS style attribute\nexport const STYLE = Symbol('style');\n\n// used to upgrade Custom Elements\nexport const UPGRADE = Symbol('upgrade');\n\n// used to define generic values\nexport const VALUE = Symbol('value');\n", null, null, null, null, null, null, null, "/** Types of elements found in htmlparser2's DOM */\nexport var ElementType;\n(function (ElementType) {\n    /** Type for the root element of a document */\n    ElementType[\"Root\"] = \"root\";\n    /** Type for Text */\n    ElementType[\"Text\"] = \"text\";\n    /** Type for <? ... ?> */\n    ElementType[\"Directive\"] = \"directive\";\n    /** Type for <!-- ... --> */\n    ElementType[\"Comment\"] = \"comment\";\n    /** Type for <script> tags */\n    ElementType[\"Script\"] = \"script\";\n    /** Type for <style> tags */\n    ElementType[\"Style\"] = \"style\";\n    /** Type for Any tag */\n    ElementType[\"Tag\"] = \"tag\";\n    /** Type for <![CDATA[ ... ]]> */\n    ElementType[\"CDATA\"] = \"cdata\";\n    /** Type for <!doctype ...> */\n    ElementType[\"Doctype\"] = \"doctype\";\n})(ElementType || (ElementType = {}));\n/**\n * Tests whether an element is a tag or not.\n *\n * @param elem Element to test\n */\nexport function isTag(elem) {\n    return (elem.type === ElementType.Tag ||\n        elem.type === ElementType.Script ||\n        elem.type === ElementType.Style);\n}\n// Exports for backwards compatibility\n/** Type for the root element of a document */\nexport const Root = ElementType.Root;\n/** Type for Text */\nexport const Text = ElementType.Text;\n/** Type for <? ... ?> */\nexport const Directive = ElementType.Directive;\n/** Type for <!-- ... --> */\nexport const Comment = ElementType.Comment;\n/** Type for <script> tags */\nexport const Script = ElementType.Script;\n/** Type for <style> tags */\nexport const Style = ElementType.Style;\n/** Type for Any tag */\nexport const Tag = ElementType.Tag;\n/** Type for <![CDATA[ ... ]]> */\nexport const CDATA = ElementType.CDATA;\n/** Type for <!doctype ...> */\nexport const Doctype = ElementType.Doctype;\n", "import { ElementType, isTag as isTagRaw } from \"domelementtype\";\n/**\n * This object will be used as the prototype for Nodes when creating a\n * DOM-Level-1-compliant structure.\n */\nexport class Node {\n    constructor() {\n        /** Parent of the node */\n        this.parent = null;\n        /** Previous sibling */\n        this.prev = null;\n        /** Next sibling */\n        this.next = null;\n        /** The start index of the node. Requires `withStartIndices` on the handler to be `true. */\n        this.startIndex = null;\n        /** The end index of the node. Requires `withEndIndices` on the handler to be `true. */\n        this.endIndex = null;\n    }\n    // Read-write aliases for properties\n    /**\n     * Same as {@link parent}.\n     * [DOM spec](https://dom.spec.whatwg.org)-compatible alias.\n     */\n    get parentNode() {\n        return this.parent;\n    }\n    set parentNode(parent) {\n        this.parent = parent;\n    }\n    /**\n     * Same as {@link prev}.\n     * [DOM spec](https://dom.spec.whatwg.org)-compatible alias.\n     */\n    get previousSibling() {\n        return this.prev;\n    }\n    set previousSibling(prev) {\n        this.prev = prev;\n    }\n    /**\n     * Same as {@link next}.\n     * [DOM spec](https://dom.spec.whatwg.org)-compatible alias.\n     */\n    get nextSibling() {\n        return this.next;\n    }\n    set nextSibling(next) {\n        this.next = next;\n    }\n    /**\n     * Clone this node, and optionally its children.\n     *\n     * @param recursive Clone child nodes as well.\n     * @returns A clone of the node.\n     */\n    cloneNode(recursive = false) {\n        return cloneNode(this, recursive);\n    }\n}\n/**\n * A node that contains some data.\n */\nexport class DataNode extends Node {\n    /**\n     * @param data The content of the data node\n     */\n    constructor(data) {\n        super();\n        this.data = data;\n    }\n    /**\n     * Same as {@link data}.\n     * [DOM spec](https://dom.spec.whatwg.org)-compatible alias.\n     */\n    get nodeValue() {\n        return this.data;\n    }\n    set nodeValue(data) {\n        this.data = data;\n    }\n}\n/**\n * Text within the document.\n */\nexport class Text extends DataNode {\n    constructor() {\n        super(...arguments);\n        this.type = ElementType.Text;\n    }\n    get nodeType() {\n        return 3;\n    }\n}\n/**\n * Comments within the document.\n */\nexport class Comment extends DataNode {\n    constructor() {\n        super(...arguments);\n        this.type = ElementType.Comment;\n    }\n    get nodeType() {\n        return 8;\n    }\n}\n/**\n * Processing instructions, including doc types.\n */\nexport class ProcessingInstruction extends DataNode {\n    constructor(name, data) {\n        super(data);\n        this.name = name;\n        this.type = ElementType.Directive;\n    }\n    get nodeType() {\n        return 1;\n    }\n}\n/**\n * A `Node` that can have children.\n */\nexport class NodeWithChildren extends Node {\n    /**\n     * @param children Children of the node. Only certain node types can have children.\n     */\n    constructor(children) {\n        super();\n        this.children = children;\n    }\n    // Aliases\n    /** First child of the node. */\n    get firstChild() {\n        var _a;\n        return (_a = this.children[0]) !== null && _a !== void 0 ? _a : null;\n    }\n    /** Last child of the node. */\n    get lastChild() {\n        return this.children.length > 0\n            ? this.children[this.children.length - 1]\n            : null;\n    }\n    /**\n     * Same as {@link children}.\n     * [DOM spec](https://dom.spec.whatwg.org)-compatible alias.\n     */\n    get childNodes() {\n        return this.children;\n    }\n    set childNodes(children) {\n        this.children = children;\n    }\n}\nexport class CDATA extends NodeWithChildren {\n    constructor() {\n        super(...arguments);\n        this.type = ElementType.CDATA;\n    }\n    get nodeType() {\n        return 4;\n    }\n}\n/**\n * The root node of the document.\n */\nexport class Document extends NodeWithChildren {\n    constructor() {\n        super(...arguments);\n        this.type = ElementType.Root;\n    }\n    get nodeType() {\n        return 9;\n    }\n}\n/**\n * An element within the DOM.\n */\nexport class Element extends NodeWithChildren {\n    /**\n     * @param name Name of the tag, eg. `div`, `span`.\n     * @param attribs Object mapping attribute names to attribute values.\n     * @param children Children of the node.\n     */\n    constructor(name, attribs, children = [], type = name === \"script\"\n        ? ElementType.Script\n        : name === \"style\"\n            ? ElementType.Style\n            : ElementType.Tag) {\n        super(children);\n        this.name = name;\n        this.attribs = attribs;\n        this.type = type;\n    }\n    get nodeType() {\n        return 1;\n    }\n    // DOM Level 1 aliases\n    /**\n     * Same as {@link name}.\n     * [DOM spec](https://dom.spec.whatwg.org)-compatible alias.\n     */\n    get tagName() {\n        return this.name;\n    }\n    set tagName(name) {\n        this.name = name;\n    }\n    get attributes() {\n        return Object.keys(this.attribs).map((name) => {\n            var _a, _b;\n            return ({\n                name,\n                value: this.attribs[name],\n                namespace: (_a = this[\"x-attribsNamespace\"]) === null || _a === void 0 ? void 0 : _a[name],\n                prefix: (_b = this[\"x-attribsPrefix\"]) === null || _b === void 0 ? void 0 : _b[name],\n            });\n        });\n    }\n}\n/**\n * @param node Node to check.\n * @returns `true` if the node is a `Element`, `false` otherwise.\n */\nexport function isTag(node) {\n    return isTagRaw(node);\n}\n/**\n * @param node Node to check.\n * @returns `true` if the node has the type `CDATA`, `false` otherwise.\n */\nexport function isCDATA(node) {\n    return node.type === ElementType.CDATA;\n}\n/**\n * @param node Node to check.\n * @returns `true` if the node has the type `Text`, `false` otherwise.\n */\nexport function isText(node) {\n    return node.type === ElementType.Text;\n}\n/**\n * @param node Node to check.\n * @returns `true` if the node has the type `Comment`, `false` otherwise.\n */\nexport function isComment(node) {\n    return node.type === ElementType.Comment;\n}\n/**\n * @param node Node to check.\n * @returns `true` if the node has the type `ProcessingInstruction`, `false` otherwise.\n */\nexport function isDirective(node) {\n    return node.type === ElementType.Directive;\n}\n/**\n * @param node Node to check.\n * @returns `true` if the node has the type `ProcessingInstruction`, `false` otherwise.\n */\nexport function isDocument(node) {\n    return node.type === ElementType.Root;\n}\n/**\n * @param node Node to check.\n * @returns `true` if the node has children, `false` otherwise.\n */\nexport function hasChildren(node) {\n    return Object.prototype.hasOwnProperty.call(node, \"children\");\n}\n/**\n * Clone a node, and optionally its children.\n *\n * @param recursive Clone child nodes as well.\n * @returns A clone of the node.\n */\nexport function cloneNode(node, recursive = false) {\n    let result;\n    if (isText(node)) {\n        result = new Text(node.data);\n    }\n    else if (isComment(node)) {\n        result = new Comment(node.data);\n    }\n    else if (isTag(node)) {\n        const children = recursive ? cloneChildren(node.children) : [];\n        const clone = new Element(node.name, { ...node.attribs }, children);\n        children.forEach((child) => (child.parent = clone));\n        if (node.namespace != null) {\n            clone.namespace = node.namespace;\n        }\n        if (node[\"x-attribsNamespace\"]) {\n            clone[\"x-attribsNamespace\"] = { ...node[\"x-attribsNamespace\"] };\n        }\n        if (node[\"x-attribsPrefix\"]) {\n            clone[\"x-attribsPrefix\"] = { ...node[\"x-attribsPrefix\"] };\n        }\n        result = clone;\n    }\n    else if (isCDATA(node)) {\n        const children = recursive ? cloneChildren(node.children) : [];\n        const clone = new CDATA(children);\n        children.forEach((child) => (child.parent = clone));\n        result = clone;\n    }\n    else if (isDocument(node)) {\n        const children = recursive ? cloneChildren(node.children) : [];\n        const clone = new Document(children);\n        children.forEach((child) => (child.parent = clone));\n        if (node[\"x-mode\"]) {\n            clone[\"x-mode\"] = node[\"x-mode\"];\n        }\n        result = clone;\n    }\n    else if (isDirective(node)) {\n        const instruction = new ProcessingInstruction(node.name, node.data);\n        if (node[\"x-name\"] != null) {\n            instruction[\"x-name\"] = node[\"x-name\"];\n            instruction[\"x-publicId\"] = node[\"x-publicId\"];\n            instruction[\"x-systemId\"] = node[\"x-systemId\"];\n        }\n        result = instruction;\n    }\n    else {\n        throw new Error(`Not implemented yet: ${node.type}`);\n    }\n    result.startIndex = node.startIndex;\n    result.endIndex = node.endIndex;\n    if (node.sourceCodeLocation != null) {\n        result.sourceCodeLocation = node.sourceCodeLocation;\n    }\n    return result;\n}\nfunction cloneChildren(childs) {\n    const children = childs.map((child) => cloneNode(child, true));\n    for (let i = 1; i < children.length; i++) {\n        children[i].prev = children[i - 1];\n        children[i - 1].next = children[i];\n    }\n    return children;\n}\n", "import { ElementType } from \"domelementtype\";\nimport { Element, Text, Comment, CDATA, Document, ProcessingInstruction, } from \"./node.js\";\nexport * from \"./node.js\";\n// Default options\nconst defaultOpts = {\n    withStartIndices: false,\n    withEndIndices: false,\n    xmlMode: false,\n};\nexport class DomHandler {\n    /**\n     * @param callback Called once parsing has completed.\n     * @param options Settings for the handler.\n     * @param elementCB Callback whenever a tag is closed.\n     */\n    constructor(callback, options, elementCB) {\n        /** The elements of the DOM */\n        this.dom = [];\n        /** The root element for the DOM */\n        this.root = new Document(this.dom);\n        /** Indicated whether parsing has been completed. */\n        this.done = false;\n        /** Stack of open tags. */\n        this.tagStack = [this.root];\n        /** A data node that is still being written to. */\n        this.lastNode = null;\n        /** Reference to the parser instance. Used for location information. */\n        this.parser = null;\n        // Make it possible to skip arguments, for backwards-compatibility\n        if (typeof options === \"function\") {\n            elementCB = options;\n            options = defaultOpts;\n        }\n        if (typeof callback === \"object\") {\n            options = callback;\n            callback = undefined;\n        }\n        this.callback = callback !== null && callback !== void 0 ? callback : null;\n        this.options = options !== null && options !== void 0 ? options : defaultOpts;\n        this.elementCB = elementCB !== null && elementCB !== void 0 ? elementCB : null;\n    }\n    onparserinit(parser) {\n        this.parser = parser;\n    }\n    // Resets the handler back to starting state\n    onreset() {\n        this.dom = [];\n        this.root = new Document(this.dom);\n        this.done = false;\n        this.tagStack = [this.root];\n        this.lastNode = null;\n        this.parser = null;\n    }\n    // Signals the handler that parsing is done\n    onend() {\n        if (this.done)\n            return;\n        this.done = true;\n        this.parser = null;\n        this.handleCallback(null);\n    }\n    onerror(error) {\n        this.handleCallback(error);\n    }\n    onclosetag() {\n        this.lastNode = null;\n        const elem = this.tagStack.pop();\n        if (this.options.withEndIndices) {\n            elem.endIndex = this.parser.endIndex;\n        }\n        if (this.elementCB)\n            this.elementCB(elem);\n    }\n    onopentag(name, attribs) {\n        const type = this.options.xmlMode ? ElementType.Tag : undefined;\n        const element = new Element(name, attribs, undefined, type);\n        this.addNode(element);\n        this.tagStack.push(element);\n    }\n    ontext(data) {\n        const { lastNode } = this;\n        if (lastNode && lastNode.type === ElementType.Text) {\n            lastNode.data += data;\n            if (this.options.withEndIndices) {\n                lastNode.endIndex = this.parser.endIndex;\n            }\n        }\n        else {\n            const node = new Text(data);\n            this.addNode(node);\n            this.lastNode = node;\n        }\n    }\n    oncomment(data) {\n        if (this.lastNode && this.lastNode.type === ElementType.Comment) {\n            this.lastNode.data += data;\n            return;\n        }\n        const node = new Comment(data);\n        this.addNode(node);\n        this.lastNode = node;\n    }\n    oncommentend() {\n        this.lastNode = null;\n    }\n    oncdatastart() {\n        const text = new Text(\"\");\n        const node = new CDATA([text]);\n        this.addNode(node);\n        text.parent = node;\n        this.lastNode = text;\n    }\n    oncdataend() {\n        this.lastNode = null;\n    }\n    onprocessinginstruction(name, data) {\n        const node = new ProcessingInstruction(name, data);\n        this.addNode(node);\n    }\n    handleCallback(error) {\n        if (typeof this.callback === \"function\") {\n            this.callback(error, this.dom);\n        }\n        else if (error) {\n            throw error;\n        }\n    }\n    addNode(node) {\n        const parent = this.tagStack[this.tagStack.length - 1];\n        const previousSibling = parent.children[parent.children.length - 1];\n        if (this.options.withStartIndices) {\n            node.startIndex = this.parser.startIndex;\n        }\n        if (this.options.withEndIndices) {\n            node.endIndex = this.parser.endIndex;\n        }\n        parent.children.push(node);\n        if (previousSibling) {\n            node.prev = previousSibling;\n            previousSibling.next = node;\n        }\n        node.parent = parent;\n        this.lastNode = null;\n    }\n}\nexport default DomHandler;\n", null, null, null, null, "export const elementNames = new Map([\n    \"altGlyph\",\n    \"altGlyphDef\",\n    \"altGlyphItem\",\n    \"animateColor\",\n    \"animateMotion\",\n    \"animateTransform\",\n    \"clipPath\",\n    \"feBlend\",\n    \"feColorMatrix\",\n    \"feComponentTransfer\",\n    \"feComposite\",\n    \"feConvolveMatrix\",\n    \"feDiffuseLighting\",\n    \"feDisplacementMap\",\n    \"feDistantLight\",\n    \"feDropShadow\",\n    \"feFlood\",\n    \"feFuncA\",\n    \"feFuncB\",\n    \"feFuncG\",\n    \"feFuncR\",\n    \"feGaussianBlur\",\n    \"feImage\",\n    \"feMerge\",\n    \"feMergeNode\",\n    \"feMorphology\",\n    \"feOffset\",\n    \"fePointLight\",\n    \"feSpecularLighting\",\n    \"feSpotLight\",\n    \"feTile\",\n    \"feTurbulence\",\n    \"foreignObject\",\n    \"glyphRef\",\n    \"linearGradient\",\n    \"radialGradient\",\n    \"textPath\",\n].map((val) => [val.toLowerCase(), val]));\nexport const attributeNames = new Map([\n    \"definitionURL\",\n    \"attributeName\",\n    \"attributeType\",\n    \"baseFrequency\",\n    \"baseProfile\",\n    \"calcMode\",\n    \"clipPathUnits\",\n    \"diffuseConstant\",\n    \"edgeMode\",\n    \"filterUnits\",\n    \"glyphRef\",\n    \"gradientTransform\",\n    \"gradientUnits\",\n    \"kernelMatrix\",\n    \"kernelUnitLength\",\n    \"keyPoints\",\n    \"keySplines\",\n    \"keyTimes\",\n    \"lengthAdjust\",\n    \"limitingConeAngle\",\n    \"markerHeight\",\n    \"markerUnits\",\n    \"markerWidth\",\n    \"maskContentUnits\",\n    \"maskUnits\",\n    \"numOctaves\",\n    \"pathLength\",\n    \"patternContentUnits\",\n    \"patternTransform\",\n    \"patternUnits\",\n    \"pointsAtX\",\n    \"pointsAtY\",\n    \"pointsAtZ\",\n    \"preserveAlpha\",\n    \"preserveAspectRatio\",\n    \"primitiveUnits\",\n    \"refX\",\n    \"refY\",\n    \"repeatCount\",\n    \"repeatDur\",\n    \"requiredExtensions\",\n    \"requiredFeatures\",\n    \"specularConstant\",\n    \"specularExponent\",\n    \"spreadMethod\",\n    \"startOffset\",\n    \"stdDeviation\",\n    \"stitchTiles\",\n    \"surfaceScale\",\n    \"systemLanguage\",\n    \"tableValues\",\n    \"targetX\",\n    \"targetY\",\n    \"textLength\",\n    \"viewBox\",\n    \"viewTarget\",\n    \"xChannelSelector\",\n    \"yChannelSelector\",\n    \"zoomAndPan\",\n].map((val) => [val.toLowerCase(), val]));\n", "/*\n * Module dependencies\n */\nimport * as ElementType from \"domelementtype\";\nimport { encodeXML, escapeAttribute, escapeText } from \"entities\";\n/**\n * Mixed-case SVG and MathML tags & attributes\n * recognized by the HTML parser.\n *\n * @see https://html.spec.whatwg.org/multipage/parsing.html#parsing-main-inforeign\n */\nimport { elementNames, attributeNames } from \"./foreignNames.js\";\nconst unencodedElements = new Set([\n    \"style\",\n    \"script\",\n    \"xmp\",\n    \"iframe\",\n    \"noembed\",\n    \"noframes\",\n    \"plaintext\",\n    \"noscript\",\n]);\nfunction replaceQuotes(value) {\n    return value.replace(/\"/g, \"&quot;\");\n}\n/**\n * Format attributes\n */\nfunction formatAttributes(attributes, opts) {\n    var _a;\n    if (!attributes)\n        return;\n    const encode = ((_a = opts.encodeEntities) !== null && _a !== void 0 ? _a : opts.decodeEntities) === false\n        ? replaceQuotes\n        : opts.xmlMode || opts.encodeEntities !== \"utf8\"\n            ? encodeXML\n            : escapeAttribute;\n    return Object.keys(attributes)\n        .map((key) => {\n        var _a, _b;\n        const value = (_a = attributes[key]) !== null && _a !== void 0 ? _a : \"\";\n        if (opts.xmlMode === \"foreign\") {\n            /* Fix up mixed-case attribute names */\n            key = (_b = attributeNames.get(key)) !== null && _b !== void 0 ? _b : key;\n        }\n        if (!opts.emptyAttrs && !opts.xmlMode && value === \"\") {\n            return key;\n        }\n        return `${key}=\"${encode(value)}\"`;\n    })\n        .join(\" \");\n}\n/**\n * Self-enclosing tags\n */\nconst singleTag = new Set([\n    \"area\",\n    \"base\",\n    \"basefont\",\n    \"br\",\n    \"col\",\n    \"command\",\n    \"embed\",\n    \"frame\",\n    \"hr\",\n    \"img\",\n    \"input\",\n    \"isindex\",\n    \"keygen\",\n    \"link\",\n    \"meta\",\n    \"param\",\n    \"source\",\n    \"track\",\n    \"wbr\",\n]);\n/**\n * Renders a DOM node or an array of DOM nodes to a string.\n *\n * Can be thought of as the equivalent of the `outerHTML` of the passed node(s).\n *\n * @param node Node to be rendered.\n * @param options Changes serialization behavior\n */\nexport function render(node, options = {}) {\n    const nodes = \"length\" in node ? node : [node];\n    let output = \"\";\n    for (let i = 0; i < nodes.length; i++) {\n        output += renderNode(nodes[i], options);\n    }\n    return output;\n}\nexport default render;\nfunction renderNode(node, options) {\n    switch (node.type) {\n        case ElementType.Root:\n            return render(node.children, options);\n        // @ts-expect-error We don't use `Doctype` yet\n        case ElementType.Doctype:\n        case ElementType.Directive:\n            return renderDirective(node);\n        case ElementType.Comment:\n            return renderComment(node);\n        case ElementType.CDATA:\n            return renderCdata(node);\n        case ElementType.Script:\n        case ElementType.Style:\n        case ElementType.Tag:\n            return renderTag(node, options);\n        case ElementType.Text:\n            return renderText(node, options);\n    }\n}\nconst foreignModeIntegrationPoints = new Set([\n    \"mi\",\n    \"mo\",\n    \"mn\",\n    \"ms\",\n    \"mtext\",\n    \"annotation-xml\",\n    \"foreignObject\",\n    \"desc\",\n    \"title\",\n]);\nconst foreignElements = new Set([\"svg\", \"math\"]);\nfunction renderTag(elem, opts) {\n    var _a;\n    // Handle SVG / MathML in HTML\n    if (opts.xmlMode === \"foreign\") {\n        /* Fix up mixed-case element names */\n        elem.name = (_a = elementNames.get(elem.name)) !== null && _a !== void 0 ? _a : elem.name;\n        /* Exit foreign mode at integration points */\n        if (elem.parent &&\n            foreignModeIntegrationPoints.has(elem.parent.name)) {\n            opts = { ...opts, xmlMode: false };\n        }\n    }\n    if (!opts.xmlMode && foreignElements.has(elem.name)) {\n        opts = { ...opts, xmlMode: \"foreign\" };\n    }\n    let tag = `<${elem.name}`;\n    const attribs = formatAttributes(elem.attribs, opts);\n    if (attribs) {\n        tag += ` ${attribs}`;\n    }\n    if (elem.children.length === 0 &&\n        (opts.xmlMode\n            ? // In XML mode or foreign mode, and user hasn't explicitly turned off self-closing tags\n                opts.selfClosingTags !== false\n            : // User explicitly asked for self-closing tags, even in HTML mode\n                opts.selfClosingTags && singleTag.has(elem.name))) {\n        if (!opts.xmlMode)\n            tag += \" \";\n        tag += \"/>\";\n    }\n    else {\n        tag += \">\";\n        if (elem.children.length > 0) {\n            tag += render(elem.children, opts);\n        }\n        if (opts.xmlMode || !singleTag.has(elem.name)) {\n            tag += `</${elem.name}>`;\n        }\n    }\n    return tag;\n}\nfunction renderDirective(elem) {\n    return `<${elem.data}>`;\n}\nfunction renderText(elem, opts) {\n    var _a;\n    let data = elem.data || \"\";\n    // If entities weren't decoded, no need to encode them back\n    if (((_a = opts.encodeEntities) !== null && _a !== void 0 ? _a : opts.decodeEntities) !== false &&\n        !(!opts.xmlMode &&\n            elem.parent &&\n            unencodedElements.has(elem.parent.name))) {\n        data =\n            opts.xmlMode || opts.encodeEntities !== \"utf8\"\n                ? encodeXML(data)\n                : escapeText(data);\n    }\n    return data;\n}\nfunction renderCdata(elem) {\n    return `<![CDATA[${elem.children[0].data}]]>`;\n}\nfunction renderComment(elem) {\n    return `<!--${elem.data}-->`;\n}\n", null, null, null, null, null, null, null, "// Internal\nexport const NODE_END = -1;\n\n// Node\nexport const ELEMENT_NODE = 1;\nexport const ATTRIBUTE_NODE = 2;\nexport const TEXT_NODE = 3;\nexport const CDATA_SECTION_NODE = 4;\nexport const COMMENT_NODE = 8;\nexport const DOCUMENT_NODE = 9;\nexport const DOCUMENT_TYPE_NODE = 10;\nexport const DOCUMENT_FRAGMENT_NODE = 11;\n\n// Elements\nexport const BLOCK_ELEMENTS = new Set(['ARTICLE', 'ASIDE', 'BLOCKQUOTE', 'BODY', 'BR', 'BUTTON', 'CANVAS', 'CAPTION', 'COL', 'COLGROUP', 'DD', 'DIV', 'DL', 'DT', 'EMBED', 'FIELDSET', 'FIGCAPTION', 'FIGURE', 'FOOTER', 'FORM', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'LI', 'UL', 'OL', 'P']);\n\n// TreeWalker\nexport const SHOW_ALL = -1;\nexport const SHOW_ELEMENT = 1;\nexport const SHOW_TEXT = 4;\nexport const SHOW_CDATA_SECTION = 8;\nexport const SHOW_COMMENT = 128;\n\n// Document position\nexport const DOCUMENT_POSITION_DISCONNECTED = 0x01;\nexport const DOCUMENT_POSITION_PRECEDING = 0x02;\nexport const DOCUMENT_POSITION_FOLLOWING = 0x04;\nexport const DOCUMENT_POSITION_CONTAINS = 0x08;\nexport const DOCUMENT_POSITION_CONTAINED_BY = 0x10;\nexport const DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC = 0x20;\n\n// SVG\nexport const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\n", "const {\n  assign,\n  create,\n  defineProperties,\n  entries,\n  getOwnPropertyDescriptors,\n  keys,\n  setPrototypeOf\n} = Object;\n\nexport {\n  assign,\n  create,\n  defineProperties,\n  entries,\n  getOwnPropertyDescriptors,\n  keys,\n  setPrototypeOf\n};\n", "import {ELEMENT_NODE} from './constants.js';\nimport {END, MIME, NEXT, PREV} from './symbols.js';\n\nconst $String = String;\nexport {$String as String};\n\nexport const getEnd = node => node.nodeType === ELEMENT_NODE ? node[END] : node;\n\nexport const ignoreCase = ({ownerDocument}) => ownerDocument[MIME].ignoreCase;\n\nexport const knownAdjacent = (prev, next) => {\n  prev[NEXT] = next;\n  next[PREV] = prev;\n};\n\nexport const knownBoundaries = (prev, current, next) => {\n  knownAdjacent(prev, current);\n  knownAdjacent(getEnd(current), next);\n};\n\nexport const knownSegment = (prev, start, end, next) => {\n  knownAdjacent(prev, start);\n  knownAdjacent(getEnd(end), next);\n};\n\nexport const knownSiblings = (prev, current, next) => {\n  knownAdjacent(prev, current);\n  knownAdjacent(current, next);\n};\n\nexport const localCase = ({localName, ownerDocument}) => {\n  return ownerDocument[MIME].ignoreCase ? localName.toUpperCase() : localName;\n};\n\nexport const setAdjacent = (prev, next) => {\n  if (prev)\n    prev[NEXT] = next;\n  if (next)\n    next[PREV] = prev;\n};\n", "export const shadowRoots = new WeakMap;\n", "import {ELEMENT_NODE} from '../shared/constants.js';\nimport {END, NEXT, UPGRADE} from '../shared/symbols.js';\nimport {entries, setPrototypeOf} from '../shared/object.js';\nimport {shadowRoots} from '../shared/shadow-roots.js';\n\nlet reactive = false;\n\nexport const Classes = new WeakMap;\n\nexport const customElements = new WeakMap;\n\nexport const attributeChangedCallback = (element, attributeName, oldValue, newValue) => {\n  if (\n    reactive &&\n    customElements.has(element) &&\n    element.attributeChangedCallback &&\n    element.constructor.observedAttributes.includes(attributeName)\n  ) {\n    element.attributeChangedCallback(attributeName, oldValue, newValue);\n  }\n};\n\nconst createTrigger = (method, isConnected) => element => {\n  if (customElements.has(element)) {\n    const info = customElements.get(element);\n    if (info.connected !== isConnected && element.isConnected === isConnected) {\n      info.connected = isConnected;\n      if (method in element)\n        element[method]();\n    }\n  }\n};\n\nconst triggerConnected = createTrigger('connectedCallback', true);\nexport const connectedCallback = element => {\n  if (reactive) {\n    triggerConnected(element);\n    if (shadowRoots.has(element))\n      element = shadowRoots.get(element).shadowRoot;\n    let {[NEXT]: next, [END]: end} = element;\n    while (next !== end) {\n      if (next.nodeType === ELEMENT_NODE)\n        triggerConnected(next);\n      next = next[NEXT];\n    }\n  }\n};\n\nconst triggerDisconnected = createTrigger('disconnectedCallback', false);\nexport const disconnectedCallback = element => {\n  if (reactive) {\n    triggerDisconnected(element);\n    if (shadowRoots.has(element))\n      element = shadowRoots.get(element).shadowRoot;\n    let {[NEXT]: next, [END]: end} = element;\n    while (next !== end) {\n      if (next.nodeType === ELEMENT_NODE)\n        triggerDisconnected(next);\n      next = next[NEXT];\n    }\n  }\n};\n\n/**\n * @implements globalThis.CustomElementRegistry\n */\nexport class CustomElementRegistry {\n\n  /**\n   * @param {Document} ownerDocument\n   */\n  constructor(ownerDocument) {\n    /**\n     * @private\n     */\n    this.ownerDocument = ownerDocument;\n\n    /**\n     * @private\n     */\n    this.registry = new Map;\n\n    /**\n     * @private\n     */\n    this.waiting = new Map;\n\n    /**\n     * @private\n     */\n    this.active = false;\n  }\n\n  /**\n   * @param {string} localName the custom element definition name\n   * @param {Function} Class the custom element **Class** definition\n   * @param {object?} options the optional object with an `extends` property\n   */\n  define(localName, Class, options = {}) {\n    const {ownerDocument, registry, waiting} = this;\n\n    if (registry.has(localName))\n      throw new Error('unable to redefine ' + localName);\n\n    if (Classes.has(Class))\n      throw new Error('unable to redefine the same class: ' + Class);\n\n    this.active = (reactive = true);\n\n    const {extends: extend} = options;\n\n    Classes.set(Class, {\n      ownerDocument,\n      options: {is: extend ? localName : ''},\n      localName: extend || localName\n    });\n\n    const check = extend ?\n      element => {\n        return element.localName === extend &&\n               element.getAttribute('is') === localName;\n      } :\n      element => element.localName === localName;\n    registry.set(localName, {Class, check});\n    if (waiting.has(localName)) {\n      for (const resolve of waiting.get(localName))\n        resolve(Class);\n      waiting.delete(localName);\n    }\n    ownerDocument.querySelectorAll(\n      extend ? `${extend}[is=\"${localName}\"]` : localName\n    ).forEach(this.upgrade, this);\n  }\n\n  /**\n   * @param {Element} element\n   */\n  upgrade(element) {\n    if (customElements.has(element))\n      return;\n    const {ownerDocument, registry} = this;\n    const ce = element.getAttribute('is') || element.localName;\n    if (registry.has(ce)) {\n      const {Class, check} = registry.get(ce);\n      if (check(element)) {\n        const {attributes, isConnected} = element;\n        for (const attr of attributes)\n          element.removeAttributeNode(attr);\n\n        const values = entries(element);\n        for (const [key] of values)\n          delete element[key];\n\n        setPrototypeOf(element, Class.prototype);\n        ownerDocument[UPGRADE] = {element, values};\n        new Class(ownerDocument, ce);\n\n        customElements.set(element, {connected: isConnected});\n\n        for (const attr of attributes)\n          element.setAttributeNode(attr);\n\n        if (isConnected && element.connectedCallback)\n          element.connectedCallback();\n      }\n    }\n  }\n\n  /**\n   * @param {string} localName the custom element definition name\n   */\n  whenDefined(localName) {\n    const {registry, waiting} = this;\n    return new Promise(resolve => {\n      if (registry.has(localName))\n        resolve(registry.get(localName).Class);\n      else {\n        if (!waiting.has(localName))\n          waiting.set(localName, []);\n        waiting.get(localName).push(resolve);\n      }\n    });\n  }\n\n  /**\n   * @param {string} localName the custom element definition name\n   * @returns {Function?} the custom element **Class**, if any\n   */\n  get(localName) {\n    const info = this.registry.get(localName);\n    return info && info.Class;\n  }\n\n  /**\n   * @param {Function} Class **Class** of custom element\n   * @returns {string?} found tag name or null\n   */\n  getName(Class) {\n    if (Classes.has(Class)) {\n      const { localName } = Classes.get(Class);\n      return localName;\n    }\n    return null;\n  }\n}\n", "import * as HTMLParser2 from 'htmlparser2';\n\nimport {ELEMENT_NODE, SVG_NAMESPACE} from './constants.js';\nimport {CUSTOM_ELEMENTS, PREV, END, VALUE} from './symbols.js';\nimport {keys} from './object.js';\n\nimport {knownBoundaries, knownSiblings} from './utils.js';\nimport {attributeChangedCallback, connectedCallback} from '../interface/custom-element-registry.js';\n\nconst {Parser} = HTMLParser2;\n\n// import {Mime} from './mime.js';\n// const VOID_SOURCE = Mime['text/html'].voidElements.source.slice(4, -2);\n// const VOID_ELEMENTS = new RegExp(`<(${VOID_SOURCE})([^>]*?)>`, 'gi');\n// const VOID_SANITIZER = (_, $1, $2) => `<${$1}${$2}${/\\/$/.test($2) ? '' : ' /'}>`;\n// const voidSanitizer = html => html.replace(VOID_ELEMENTS, VOID_SANITIZER);\n\nlet notParsing = true;\n\nconst append = (self, node, active) => {\n  const end = self[END];\n  node.parentNode = self;\n  knownBoundaries(end[PREV], node, end);\n  if (active && node.nodeType === ELEMENT_NODE)\n    connectedCallback(node);\n  return node;\n};\n\nconst attribute = (element, end, attribute, value, active) => {\n  attribute[VALUE] = value;\n  attribute.ownerElement = element;\n  knownSiblings(end[PREV], attribute, end);\n  if (attribute.name === 'class')\n    element.className = value;\n  if (active)\n    attributeChangedCallback(element, attribute.name, null, value);\n};\n\nexport const isNotParsing = () => notParsing;\n\nexport const parseFromString = (document, isHTML, markupLanguage) => {\n  const {active, registry} = document[CUSTOM_ELEMENTS];\n\n  let node = document;\n  let ownerSVGElement = null;\n  let parsingCData = false;\n\n  notParsing = false;\n\n  const content = new Parser({\n    // <!DOCTYPE ...>\n    onprocessinginstruction(name, data) {\n      if (name.toLowerCase() === '!doctype')\n        document.doctype = data.slice(name.length).trim();\n    },\n\n    // <tagName>\n    onopentag(name, attributes) {\n      let create = true;\n      if (isHTML) {\n        if (ownerSVGElement) {\n          node = append(node, document.createElementNS(SVG_NAMESPACE, name), active);\n          node.ownerSVGElement = ownerSVGElement;\n          create = false;\n        }\n        else if (name === 'svg' || name === 'SVG') {\n          ownerSVGElement = document.createElementNS(SVG_NAMESPACE, name);\n          node = append(node, ownerSVGElement, active);\n          create = false;\n        }\n        else if (active) {\n          const ce = name.includes('-') ? name : (attributes.is || '');\n          if (ce && registry.has(ce)) {\n            const {Class} = registry.get(ce);\n            node = append(node, new Class, active);\n            delete attributes.is;\n            create = false;\n          }\n        }\n      }\n\n      if (create)\n        node = append(node, document.createElement(name), false);\n\n      let end = node[END];\n      for (const name of keys(attributes))\n        attribute(node, end, document.createAttribute(name), attributes[name], active);\n    },\n\n    // #text, #comment\n    oncomment(data) { append(node, document.createComment(data), active); },\n    ontext(text) {\n      if (parsingCData) {\n        append(node, document.createCDATASection(text), active);\n      } else {\n        append(node, document.createTextNode(text), active);\n      }\n    },\n\n    // #cdata\n    oncdatastart() { parsingCData = true; },\n    oncdataend() { parsingCData = false; },\n\n    // </tagName>\n    onclosetag() {\n      if (isHTML && node === ownerSVGElement)\n        ownerSVGElement = null;\n      node = node.parentNode;\n    }\n  }, {\n    lowerCaseAttributeNames: false,\n    decodeEntities: true,\n    xmlMode: !isHTML\n  });\n\n  content.write(markupLanguage);\n  content.end();\n\n  notParsing = true;\n\n  return document;\n};\n", "export const htmlClasses = new Map;\n\nexport const registerHTMLClass = (names, Class) => {\n  for (const name of [].concat(names)) {\n    htmlClasses.set(name, Class);\n    htmlClasses.set(name.toUpperCase(), Class);\n  }\n};\n", "import {performance} from '../../commonjs/perf_hooks.cjs';\n\nimport {DOCUMENT_NODE, DOCUMENT_FRAGMENT_NODE, DOCUMENT_TYPE_NODE, ELEMENT_NODE, SVG_NAMESPACE} from '../shared/constants.js';\n\nimport {\n  CUSTOM_ELEMENTS, DOM_PARSER, GLOBALS, IMAGE, MUTATION_OBSERVER,\n  DOCTYPE, END, NEXT, MIME, EVENT_TARGET, UPGRADE\n} from '../shared/symbols.js';\n\nimport {Facades, illegalConstructor} from '../shared/facades.js';\nimport {HTMLClasses} from '../shared/html-classes.js';\nimport {Mime} from '../shared/mime.js';\nimport {knownSiblings} from '../shared/utils.js';\nimport {assign, create, defineProperties, setPrototypeOf} from '../shared/object.js';\n\nimport {NonElementParentNode} from '../mixin/non-element-parent-node.js';\n\nimport {SVGElement} from '../svg/element.js';\n\nimport {Attr} from './attr.js';\nimport {CDATASection} from './cdata-section.js'\nimport {Comment} from './comment.js';\nimport {CustomElementRegistry} from './custom-element-registry.js';\nimport {CustomEvent} from './custom-event.js';\nimport {DocumentFragment} from './document-fragment.js';\nimport {DocumentType} from './document-type.js';\nimport {Element} from './element.js';\nimport {Event} from './event.js';\nimport {EventTarget} from './event-target.js';\nimport {InputEvent} from './input-event.js';\nimport {ImageClass} from './image.js';\nimport {MutationObserverClass} from './mutation-observer.js';\nimport {NamedNodeMap} from './named-node-map.js';\nimport {NodeList} from './node-list.js';\nimport {Range} from './range.js';\nimport {Text} from './text.js';\nimport {TreeWalker} from './tree-walker.js';\n\nconst query = (method, ownerDocument, selectors) => {\n  let {[NEXT]: next, [END]: end} = ownerDocument;\n  return method.call({ownerDocument, [NEXT]: next, [END]: end}, selectors);\n};\n\nconst globalExports = assign(\n  {},\n  Facades,\n  HTMLClasses,\n  {\n    CustomEvent,\n    Event,\n    EventTarget,\n    InputEvent,\n    NamedNodeMap,\n    NodeList\n  }\n);\n\nconst window = new WeakMap;\n\n/**\n * @implements globalThis.Document\n */\nexport class Document extends NonElementParentNode {\n  constructor(type) {\n    super(null, '#document', DOCUMENT_NODE);\n    this[CUSTOM_ELEMENTS] = {active: false, registry: null};\n    this[MUTATION_OBSERVER] = {active: false, class: null};\n    this[MIME] = Mime[type];\n    /** @type {DocumentType} */\n    this[DOCTYPE] = null;\n    this[DOM_PARSER] = null;\n    this[GLOBALS] = null;\n    this[IMAGE] = null;\n    this[UPGRADE] = null;\n  }\n\n  /**\n   * @type {globalThis.Document['defaultView']}\n   */\n  get defaultView() {\n    if (!window.has(this))\n      window.set(this, new Proxy(globalThis, {\n        set: (target, name, value) => {\n          switch (name) {\n            case 'addEventListener':\n            case 'removeEventListener':\n            case 'dispatchEvent':\n              this[EVENT_TARGET][name] = value;\n              break;\n            default:\n              target[name] = value;\n              break;\n          }\n          return true;\n        },\n        get: (globalThis, name) => {\n          switch (name) {\n            case 'addEventListener':\n            case 'removeEventListener':\n            case 'dispatchEvent':\n              if (!this[EVENT_TARGET]) {\n                const et = this[EVENT_TARGET] = new EventTarget;\n                et.dispatchEvent = et.dispatchEvent.bind(et);\n                et.addEventListener = et.addEventListener.bind(et);\n                et.removeEventListener = et.removeEventListener.bind(et);\n              }\n              return this[EVENT_TARGET][name];\n            case 'document':\n              return this;\n            /* c8 ignore start */\n            case 'navigator':\n              return {\n                userAgent: 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36'\n              };\n            /* c8 ignore stop */\n            case 'window':\n              return window.get(this);\n            case 'customElements':\n              if (!this[CUSTOM_ELEMENTS].registry)\n                this[CUSTOM_ELEMENTS] = new CustomElementRegistry(this);\n              return this[CUSTOM_ELEMENTS];\n            case 'performance':\n              return performance;\n            case 'DOMParser':\n              return this[DOM_PARSER];\n            case 'Image':\n              if (!this[IMAGE])\n                this[IMAGE] = ImageClass(this);\n              return this[IMAGE];\n            case 'MutationObserver':\n              if (!this[MUTATION_OBSERVER].class)\n                this[MUTATION_OBSERVER] = new MutationObserverClass(this);\n              return this[MUTATION_OBSERVER].class;\n          }\n          return (this[GLOBALS] && this[GLOBALS][name]) ||\n                  globalExports[name] ||\n                  globalThis[name];\n        }\n      }));\n    return window.get(this);\n  }\n\n  get doctype() {\n    const docType = this[DOCTYPE];\n    if (docType)\n      return docType;\n    const {firstChild} = this;\n    if (firstChild && firstChild.nodeType === DOCUMENT_TYPE_NODE)\n      return (this[DOCTYPE] = firstChild);\n    return null;\n  }\n\n  set doctype(value) {\n    if (/^([a-z:]+)(\\s+system|\\s+public(\\s+\"([^\"]+)\")?)?(\\s+\"([^\"]+)\")?/i.test(value)) {\n      const {$1: name, $4: publicId, $6: systemId} = RegExp;\n      this[DOCTYPE] = new DocumentType(this, name, publicId, systemId);\n      knownSiblings(this, this[DOCTYPE], this[NEXT]);\n    }\n  }\n\n  get documentElement() {\n    return this.firstElementChild;\n  }\n\n  get isConnected() { return true; }\n\n  /**\n   * @protected\n   */\n   _getParent() {\n    return this[EVENT_TARGET];\n  }\n\n  createAttribute(name) { return new Attr(this, name); }\n  createCDATASection(data) { return new CDATASection(this, data); }\n  createComment(textContent) { return new Comment(this, textContent); }\n  createDocumentFragment() { return new DocumentFragment(this); }\n  createDocumentType(name, publicId, systemId) { return new DocumentType(this, name, publicId, systemId); }\n  createElement(localName) { return new Element(this, localName); }\n  createRange() {\n    const range = new Range;\n    range.commonAncestorContainer = this;\n    return range;\n  }\n  createTextNode(textContent) { return new Text(this, textContent); }\n  createTreeWalker(root, whatToShow = -1) { return new TreeWalker(root, whatToShow); }\n  createNodeIterator(root, whatToShow = -1) { return this.createTreeWalker(root, whatToShow); }\n\n  createEvent(name) {\n    const event = create(name === 'Event' ? new Event('') : new CustomEvent(''));\n    event.initEvent = event.initCustomEvent = (\n      type,\n      canBubble = false,\n      cancelable = false,\n      detail\n    ) => {\n      event.bubbles = !!canBubble;\n\n      defineProperties(event, {\n        type: {value: type},\n        canBubble: {value: canBubble},\n        cancelable: {value: cancelable},\n        detail: {value: detail}\n      });\n    };\n    return event;\n  }\n\n  cloneNode(deep = false) {\n    const {\n      constructor,\n      [CUSTOM_ELEMENTS]: customElements,\n      [DOCTYPE]: doctype\n    } = this;\n    const document = new constructor();\n    document[CUSTOM_ELEMENTS] = customElements;\n    if (deep) {\n      const end = document[END];\n      const {childNodes} = this;\n      for (let {length} = childNodes, i = 0; i < length; i++)\n        document.insertBefore(childNodes[i].cloneNode(true), end);\n      if (doctype)\n        document[DOCTYPE] = childNodes[0];\n    }\n    return document;\n  }\n\n  importNode(externalNode) {\n    // important: keep the signature length as *one*\n    // or it would behave like old IE or Edge with polyfills\n    const deep = 1 < arguments.length && !!arguments[1];\n    const node = externalNode.cloneNode(deep);\n    const {[CUSTOM_ELEMENTS]: customElements} = this;\n    const {active} = customElements;\n    const upgrade = element => {\n      const {ownerDocument, nodeType} = element;\n      element.ownerDocument = this;\n      if (active && ownerDocument !== this && nodeType === ELEMENT_NODE)\n        customElements.upgrade(element);\n    };\n    upgrade(node);\n    if (deep) {\n      switch (node.nodeType) {\n        case ELEMENT_NODE:\n        case DOCUMENT_FRAGMENT_NODE: {\n          let {[NEXT]: next, [END]: end} = node;\n          while (next !== end) {\n            if (next.nodeType === ELEMENT_NODE)\n              upgrade(next);\n            next = next[NEXT];\n          }\n          break;\n        }\n      }\n    }\n    return node;\n  }\n\n  toString() { return this.childNodes.join(''); }\n\n  querySelector(selectors) {\n    return query(super.querySelector, this, selectors);\n  }\n\n  querySelectorAll(selectors) {\n    return query(super.querySelectorAll, this, selectors);\n  }\n\n  /* c8 ignore start */\n  getElementsByTagNameNS(_, name) {\n    return this.getElementsByTagName(name);\n  }\n  createAttributeNS(_, name) {\n    return this.createAttribute(name);\n  }\n  createElementNS(nsp, localName, options) {\n    return nsp === SVG_NAMESPACE ?\n            new SVGElement(this, localName, null) :\n            this.createElement(localName, options);\n  }\n  /* c8 ignore stop */\n}\n\nsetPrototypeOf(\n  globalExports.Document = function Document() {\n    illegalConstructor();\n  },\n  Document\n).prototype = Document.prototype;\n", "import {\n  NODE_END,\n  ATTRIBUTE_NODE,\n  CDATA_SECTION_NODE,\n  COMMENT_NODE,\n  DOCUMENT_TYPE_NODE,\n  ELEMENT_NODE,\n  TEXT_NODE\n} from './constants.js';\n\nimport {END, NEXT, VALUE} from './symbols.js';\n\nimport {getEnd} from './utils.js';\n\nconst loopSegment = ({[NEXT]: next, [END]: end}, json) => {\n  while (next !== end) {\n    switch (next.nodeType) {\n      case ATTRIBUTE_NODE:\n        attrAsJSON(next, json);\n        break;\n      case TEXT_NODE:\n      case COMMENT_NODE:\n      case CDATA_SECTION_NODE:\n        characterDataAsJSON(next, json);\n        break;\n      case ELEMENT_NODE:\n        elementAsJSON(next, json);\n        next = getEnd(next);\n        break;\n      case DOCUMENT_TYPE_NODE:\n        documentTypeAsJSON(next, json);\n        break;\n    }\n    next = next[NEXT];\n  }\n  const last = json.length - 1;\n  const value = json[last];\n  if (typeof value === 'number' && value < 0)\n    json[last] += NODE_END;\n  else\n    json.push(NODE_END);\n};\n\nexport const attrAsJSON = (attr, json) => {\n  json.push(ATTRIBUTE_NODE, attr.name);\n  const value = attr[VALUE].trim();\n  if (value)\n    json.push(value);\n};\n\nexport const characterDataAsJSON = (node, json) => {\n  const value = node[VALUE];\n  if (value.trim())\n    json.push(node.nodeType, value);\n};\n\nexport const nonElementAsJSON = (node, json) => {\n  json.push(node.nodeType);\n  loopSegment(node, json);\n};\n\nexport const documentTypeAsJSON = ({name, publicId, systemId}, json) => {\n  json.push(DOCUMENT_TYPE_NODE, name);\n  if (publicId)\n    json.push(publicId);\n  if (systemId)\n    json.push(systemId);\n};\n\nexport const elementAsJSON = (element, json) => {\n  json.push(ELEMENT_NODE, element.localName);\n  loopSegment(element, json);\n};\n", "import {MUTATION_OBSERVER} from '../shared/symbols.js';\n\nconst createRecord =\n  (type, target, addedNodes, removedNodes, attributeName, oldValue) =>\n ({type, target, addedNodes, removedNodes, attributeName, oldValue});\n\nconst queueAttribute = (\n  observer, target, attributeName, attributeFilter, attributeOldValue, oldValue\n) => {\n  if ((!attributeFilter || attributeFilter.includes(attributeName))) {\n    const {callback, records, scheduled} = observer;\n    records.push(createRecord(\n      'attributes', target,\n      [], [],\n      attributeName, attributeOldValue ? oldValue : void 0\n    ));\n    if (!scheduled) {\n      observer.scheduled = true;\n      Promise.resolve().then(() => {\n        observer.scheduled = false;\n        callback(records.splice(0), observer);\n      });\n    }\n  }\n};\n\nexport const attributeChangedCallback = (element, attributeName, oldValue) => {\n  const {ownerDocument} = element;\n  const {active, observers} = ownerDocument[MUTATION_OBSERVER];\n  if (active) {\n    for (const observer of observers) {\n      for (const [\n        target,\n        {\n          childList,\n          subtree,\n          attributes,\n          attributeFilter,\n          attributeOldValue\n        }\n      ] of observer.nodes) {\n        if (childList) {\n          if (\n            (subtree && (target === ownerDocument || target.contains(element))) ||\n            (!subtree && target.children.includes(element))\n          ) {\n            queueAttribute(\n              observer, element,\n              attributeName, attributeFilter, attributeOldValue, oldValue\n            );\n            break;\n          }\n        }\n        else if (\n          attributes &&\n          target === element\n        ) {\n          queueAttribute(\n            observer, element,\n            attributeName, attributeFilter, attributeOldValue, oldValue\n          );\n          break;\n        }\n      }\n    }\n  }\n};\n\nexport const moCallback = (element, parentNode) => {\n  const {ownerDocument} = element;\n  const {active, observers} = ownerDocument[MUTATION_OBSERVER];\n  if (active) {\n    for (const observer of observers) {\n      for (const [target, {subtree, childList, characterData}] of observer.nodes) {\n        if (childList) {\n          if (\n            (parentNode && (target === parentNode || /* c8 ignore next */(subtree && target.contains(parentNode)))) ||\n            (!parentNode && ((subtree && (target === ownerDocument || /* c8 ignore next */target.contains(element))) ||\n                            (!subtree && target[characterData ? 'childNodes' : 'children'].includes(element))))\n          ) {\n            const {callback, records, scheduled} = observer;\n            records.push(createRecord(\n              'childList', target,\n              parentNode ? [] : [element], parentNode ? [element] : []\n            ));\n            if (!scheduled) {\n              observer.scheduled = true;\n              Promise.resolve().then(() => {\n                observer.scheduled = false;\n                callback(records.splice(0), observer);\n              });\n            }\n            break;\n          }\n        }\n      }\n    }\n  }\n};\n\nexport class MutationObserverClass {\n  constructor(ownerDocument) {\n    const observers = new Set;\n    this.observers = observers;\n    this.active = false;\n\n    /**\n     * @implements globalThis.MutationObserver\n     */\n    this.class = class MutationObserver {\n\n      constructor(callback) {\n        /**\n         * @private\n         */\n        this.callback = callback;\n\n        /**\n         * @private\n         */\n        this.nodes = new Map;\n\n        /**\n         * @private\n         */\n        this.records = [];\n\n        /**\n         * @private\n         */\n        this.scheduled = false;\n      }\n\n      disconnect() {\n        this.records.splice(0);\n        this.nodes.clear();\n        observers.delete(this);\n        ownerDocument[MUTATION_OBSERVER].active = !!observers.size;\n      }\n\n      /**\n       * @param {Element} target\n       * @param {MutationObserverInit} options\n       */\n      observe(target, options = {\n        subtree: false,\n        childList: false,\n        attributes: false,\n        attributeFilter: null,\n        attributeOldValue: false,\n        characterData: false,\n        // TODO: not implemented yet\n        // characterDataOldValue: false\n      }) {\n        if (('attributeOldValue' in options) || ('attributeFilter' in options))\n          options.attributes = true;\n        // if ('characterDataOldValue' in options)\n        //   options.characterData = true;\n        options.childList = !!options.childList;\n        options.subtree = !!options.subtree;\n        this.nodes.set(target, options);\n        observers.add(this);\n        ownerDocument[MUTATION_OBSERVER].active = true;\n      }\n\n      /**\n       * @returns {MutationRecord[]}\n       */\n      takeRecords() { return this.records.splice(0); }\n    }\n  }\n}\n", "import {CLASS_LIST, NEXT, PREV, VALUE} from './symbols.js';\n\nimport {knownAdjacent, knownSiblings} from './utils.js';\n\nimport {attributeChangedCallback as ceAttributes} from '../interface/custom-element-registry.js';\nimport {attributeChangedCallback as moAttributes} from '../interface/mutation-observer.js';\n\nexport const emptyAttributes = new Set([\n  'allowfullscreen',\n  'allowpaymentrequest',\n  'async',\n  'autofocus',\n  'autoplay',\n  'checked',\n  'class',\n  'contenteditable',\n  'controls',\n  'default',\n  'defer',\n  'disabled',\n  'draggable',\n  'formnovalidate',\n  'hidden',\n  'id',\n  'ismap',\n  'itemscope',\n  'loop',\n  'multiple',\n  'muted',\n  'nomodule',\n  'novalidate',\n  'open',\n  'playsinline',\n  'readonly',\n  'required',\n  'reversed',\n  'selected',\n  'style',\n  'truespeed'\n]);\n\nexport const setAttribute = (element, attribute) => {\n  const {[VALUE]: value, name} = attribute;\n  attribute.ownerElement = element;\n  knownSiblings(element, attribute, element[NEXT]);\n  if (name === 'class')\n    element.className = value;\n  moAttributes(element, name, null);\n  ceAttributes(element, name, null, value);\n};\n\nexport const removeAttribute = (element, attribute) => {\n  const {[VALUE]: value, name} = attribute;\n  knownAdjacent(attribute[PREV], attribute[NEXT]);\n  attribute.ownerElement = attribute[PREV] = attribute[NEXT] = null;\n  if (name === 'class')\n    element[CLASS_LIST] = null;\n  moAttributes(element, name, value);\n  ceAttributes(element, name, value, null);\n};\n\nexport const booleanAttribute = {\n  get(element, name) {\n    return element.hasAttribute(name);\n  },\n  set(element, name, value) {\n    if (value)\n      element.setAttribute(name, '');\n    else\n      element.removeAttribute(name);\n  }\n};\n\nexport const numericAttribute = {\n  get(element, name) {\n    return parseFloat(element.getAttribute(name) || 0);\n  },\n  set(element, name, value) {\n    element.setAttribute(name, value);\n  }\n};\n\nexport const stringAttribute = {\n  get(element, name) {\n    return element.getAttribute(name) || '';\n  },\n  set(element, name, value) {\n    element.setAttribute(name, value);\n  }\n};\n\n/* oddly enough, this apparently is not a thing\nexport const nullableAttribute = {\n  get(element, name) {\n    return element.getAttribute(name);\n  },\n  set(element, name, value) {\n    if (value === null)\n      element.removeAttribute(name);\n    else\n      element.setAttribute(name, value);\n  }\n};\n*/\n", "// https://dom.spec.whatwg.org/#interface-eventtarget\n\nconst wm = new WeakMap();\n\nfunction dispatch(event, listener) {\n  if (typeof listener === 'function')\n    listener.call(event.target, event);\n  else\n    listener.handleEvent(event);\n  return event._stopImmediatePropagationFlag;\n}\n\nfunction invokeListeners({currentTarget, target}) {\n  const map = wm.get(currentTarget);\n  if (map && map.has(this.type)) {\n    const listeners = map.get(this.type);\n    if (currentTarget === target) {\n      this.eventPhase = this.AT_TARGET;\n    } else {\n      this.eventPhase = this.BUBBLING_PHASE;\n    }\n\n    this.currentTarget = currentTarget;\n    this.target = target;\n    for (const [listener, options] of listeners) {\n      if (options && options.once)\n        listeners.delete(listener);\n      if (dispatch(this, listener))\n        break;\n    }\n    delete this.currentTarget;\n    delete this.target;\n    return this.cancelBubble;\n  }\n}\n\n\n/**\n * @implements globalThis.EventTarget\n */\nclass DOMEventTarget {\n\n  constructor() {\n    wm.set(this, new Map);\n  }\n\n  /**\n   * @protected\n   */\n  _getParent() {\n    return null;\n  }\n\n  addEventListener(type, listener, options) {\n    const map = wm.get(this);\n    if (!map.has(type)) \n      map.set(type, new Map);\n    map.get(type).set(listener, options);\n  }\n\n  removeEventListener(type, listener) {\n    const map = wm.get(this);\n    if (map.has(type)) {\n      const listeners = map.get(type);\n      if (listeners.delete(listener) && !listeners.size)\n        map.delete(type);\n    }\n  }\n\n  dispatchEvent(event) {\n    let node = this;\n    event.eventPhase = event.CAPTURING_PHASE;\n\n    // intentionally simplified, specs imply way more code: https://dom.spec.whatwg.org/#event-path\n    while (node) {\n      if (node.dispatchEvent)\n        event._path.push({currentTarget: node, target: this});\n      node = event.bubbles && node._getParent && node._getParent();\n    }\n    event._path.some(invokeListeners, event);\n    event._path = [];\n    event.eventPhase = event.NONE;\n    return !event.defaultPrevented;\n  }\n\n}\n\nexport {DOMEventTarget as EventTarget};\n", "// https://dom.spec.whatwg.org/#interface-nodelist\n\n/**\n * @implements globalThis.NodeList\n */\nexport class NodeList extends Array {\n  item(i) { return i < this.length ? this[i] : null; }\n}\n", "// https://dom.spec.whatwg.org/#node\n\nimport {\n  ELEMENT_NODE,\n  ATTRIBUTE_NODE,\n  TEXT_NODE,\n  CDATA_SECTION_NODE,\n  COMMENT_NODE,\n  DOCUMENT_NODE,\n  DOCUMENT_FRAGMENT_NODE,\n  DOCUMENT_TYPE_NODE,\n  DOCUMENT_POSITION_DISCONNECTED,\n  DOCUMENT_POSITION_PRECEDING,\n  DOCUMENT_POSITION_FOLLOWING,\n  DOCUMENT_POSITION_CONTAINS,\n  DOCUMENT_POSITION_CONTAINED_BY,\n  DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC\n} from '../shared/constants.js';\n\nimport {NEXT, PREV} from '../shared/symbols.js';\n\nimport {EventTarget} from './event-target.js';\n\nimport {NodeList} from './node-list.js';\n\nconst getParentNodeCount = ({parentNode}) => {\n  let count = 0;\n  while (parentNode) {\n    count++;\n    parentNode = parentNode.parentNode;\n  }\n  return count;\n};\n\n/**\n * @implements globalThis.Node\n */\nexport class Node extends EventTarget {\n\n  static get ELEMENT_NODE() { return ELEMENT_NODE; }\n  static get ATTRIBUTE_NODE() { return ATTRIBUTE_NODE; }\n  static get TEXT_NODE() { return TEXT_NODE; }\n  static get CDATA_SECTION_NODE() { return CDATA_SECTION_NODE; }\n  static get COMMENT_NODE() { return COMMENT_NODE; }\n  static get DOCUMENT_NODE() { return DOCUMENT_NODE; }\n  static get DOCUMENT_FRAGMENT_NODE() { return DOCUMENT_FRAGMENT_NODE; }\n  static get DOCUMENT_TYPE_NODE() { return DOCUMENT_TYPE_NODE; }\n\n  constructor(ownerDocument, localName, nodeType) {\n    super();\n    this.ownerDocument = ownerDocument;\n    this.localName = localName;\n    this.nodeType = nodeType;\n    this.parentNode = null;\n    this[NEXT] = null;\n    this[PREV] = null;\n  }\n\n  get ELEMENT_NODE() { return ELEMENT_NODE; }\n  get ATTRIBUTE_NODE() { return ATTRIBUTE_NODE; }\n  get TEXT_NODE() { return TEXT_NODE; }\n  get CDATA_SECTION_NODE() { return CDATA_SECTION_NODE; }\n  get COMMENT_NODE() { return COMMENT_NODE; }\n  get DOCUMENT_NODE() { return DOCUMENT_NODE; }\n  get DOCUMENT_FRAGMENT_NODE() { return DOCUMENT_FRAGMENT_NODE; }\n  get DOCUMENT_TYPE_NODE() { return DOCUMENT_TYPE_NODE; }\n\n  get baseURI() {\n    const ownerDocument = this.nodeType === DOCUMENT_NODE ?\n                            this : this.ownerDocument;\n    if (ownerDocument) {\n      const base = ownerDocument.querySelector('base');\n      if (base)\n        return base.getAttribute('href');\n\n      const {location} = ownerDocument.defaultView;\n      if (location)\n        return location.href;\n    }\n\n    return null;\n  }\n\n  /* c8 ignore start */\n  // mixin: node\n  get isConnected() { return false; }\n  get nodeName() { return this.localName; }\n  get parentElement() { return null; }\n  get previousSibling() { return null; }\n  get previousElementSibling() { return null; }\n  get nextSibling() { return null; }\n  get nextElementSibling() { return null; }\n  get childNodes() { return new NodeList; }\n  get firstChild() { return null; }\n  get lastChild() { return null; }\n\n  // default values\n  get nodeValue() { return null; }\n  set nodeValue(value) {}\n  get textContent() { return null; }\n  set textContent(value) {}\n  normalize() {}\n  cloneNode() { return null; }\n  contains() { return false; }\n  /**\n   * Inserts a node before a reference node as a child of this parent node.\n   * @param {Node} newNode The node to be inserted.\n   * @param {Node} referenceNode The node before which newNode is inserted. If this is null, then newNode is inserted at the end of node's child nodes.\n   * @returns The added child\n   */\n  // eslint-disable-next-line no-unused-vars\n  insertBefore(newNode, referenceNode) { return newNode }\n  /**\n   * Adds a node to the end of the list of children of this node.\n   * @param {Node} child The node to append to the given parent node.\n   * @returns The appended child.\n   */\n  appendChild(child) { return child }\n  /**\n   * Replaces a child node within this node\n   * @param {Node} newChild The new node to replace oldChild.\n   * @param {Node} oldChild The child to be replaced.\n   * @returns The replaced Node. This is the same node as oldChild.\n   */\n  replaceChild(newChild, oldChild) { return oldChild }\n  /**\n   * Removes a child node from the DOM.\n   * @param {Node} child A Node that is the child node to be removed from the DOM.\n   * @returns The removed node.\n   */\n  removeChild(child) { return child }\n  toString() { return ''; }\n  /* c8 ignore stop */\n\n  hasChildNodes() { return !!this.lastChild; }\n  isSameNode(node) { return this === node; }\n\n  // TODO: attributes?\n  compareDocumentPosition(target) {\n    let result = 0;\n    if (this !== target) {\n      let self = getParentNodeCount(this);\n      let other = getParentNodeCount(target);\n      if (self < other) {\n        result += DOCUMENT_POSITION_FOLLOWING;\n        if (this.contains(target))\n          result += DOCUMENT_POSITION_CONTAINED_BY;\n      }\n      else if (other < self) {\n        result += DOCUMENT_POSITION_PRECEDING;\n        if (target.contains(this))\n          result += DOCUMENT_POSITION_CONTAINS;\n      }\n      else if (self && other) {\n        const {childNodes} = this.parentNode;\n        if (childNodes.indexOf(this) < childNodes.indexOf(target))\n          result += DOCUMENT_POSITION_FOLLOWING;\n        else\n          result += DOCUMENT_POSITION_PRECEDING;\n      }\n      if (!self || !other) {\n        result += DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC;\n        result += DOCUMENT_POSITION_DISCONNECTED;\n      }\n    }\n    return result;\n  }\n\n  isEqualNode(node) {\n    if (this === node)\n      return true;\n    if (this.nodeType === node.nodeType) {\n      switch (this.nodeType) {\n        case DOCUMENT_NODE:\n        case DOCUMENT_FRAGMENT_NODE: {\n          const aNodes = this.childNodes;\n          const bNodes = node.childNodes;\n          return aNodes.length === bNodes.length && aNodes.every((node, i) => node.isEqualNode(bNodes[i]));\n        }\n      }\n      return this.toString() === node.toString();\n    }\n    return false;\n  }\n\n  /**\n   * @protected\n   */\n  _getParent() {\n    return this.parentNode;\n  }\n\n  /**\n   * Calling it on an element inside a standard web page will return an HTMLDocument object representing the entire page (or <iframe>).\n   * Calling it on an element inside a shadow DOM will return the associated ShadowRoot.\n   * @return {ShadowRoot | HTMLDocument}\n   */\n  getRootNode() {\n    let root = this;\n    while (root.parentNode)\n      root = root.parentNode;\n    return root;\n  }\n}\n", "const {replace} = '';\n\n// escape\nconst ca = /[<>&\\xA0]/g;\n\nconst esca = {\n  '\\xA0': '&#160;',\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;'\n};\n\nconst pe = m => esca[m];\n\n/**\n * Safely escape HTML entities such as `&`, `<`, `>` only.\n * @param {string} es the input to safely escape\n * @returns {string} the escaped input, and it **throws** an error if\n *  the input type is unexpected, except for boolean and numbers,\n *  converted as string.\n */\nexport const escape = es => replace.call(es, ca, pe);\n", "import {ATTRIBUTE_NODE} from '../shared/constants.js';\nimport {CHANGED, VALUE} from '../shared/symbols.js';\nimport {String, ignoreCase} from '../shared/utils.js';\nimport {attrAsJSON} from '../shared/jsdon.js';\nimport {emptyAttributes} from '../shared/attributes.js';\n\nimport {attributeChangedCallback as moAttributes} from './mutation-observer.js';\nimport {attributeChangedCallback as ceAttributes} from './custom-element-registry.js';\n\nimport {Node} from './node.js';\nimport {escape} from '../shared/text-escaper.js';\n\nconst QUOTE = /\"/g;\n\n/**\n * @implements globalThis.Attr\n */\nexport class Attr extends Node {\n  constructor(ownerDocument, name, value = '') {\n    super(ownerDocument, name, ATTRIBUTE_NODE);\n    this.ownerElement = null;\n    this.name = String(name);\n    this[VALUE] = String(value);\n    this[CHANGED] = false;\n  }\n\n  get value() { return this[VALUE]; }\n  set value(newValue) {\n    const {[VALUE]: oldValue, name, ownerElement} = this;\n    this[VALUE] = String(newValue);\n    this[CHANGED] = true;\n    if (ownerElement) {\n      moAttributes(ownerElement, name, oldValue);\n      ceAttributes(ownerElement, name, oldValue, this[VALUE]);\n    }\n  }\n\n  cloneNode() {\n    const {ownerDocument, name, [VALUE]: value} = this;\n    return new Attr(ownerDocument, name, value);\n  }\n\n  toString() {\n    const {name, [VALUE]: value} = this;\n    if (emptyAttributes.has(name) && !value) {\n      return ignoreCase(this) ? name : `${name}=\"\"`;\n    }\n    const escapedValue = ignoreCase(this) ? value.replace(QUOTE, '&quot;') : escape(value);\n    return `${name}=\"${escapedValue}\"`;\n  }\n\n  toJSON() {\n    const json = [];\n    attrAsJSON(this, json);\n    return json;\n  }\n}\n", "import {\n  CDATA_SECTION_NODE,\n  COMMENT_NODE,\n  DOCUMENT_NODE,\n  DOCUMENT_FRAGMENT_NODE,\n  TEXT_NODE,\n  NODE_END\n} from './constants.js';\n\nimport {START, NEXT, PREV} from './symbols.js';\nimport {getEnd} from './utils.js';\n\nexport const isConnected = ({ownerDocument, parentNode}) => {\n  while (parentNode) {\n    if (parentNode === ownerDocument)\n      return true;\n    parentNode = parentNode.parentNode || parentNode.host;\n  }\n  return false;\n};\n\nexport const parentElement = ({parentNode}) => {\n  if (parentNode) {\n    switch (parentNode.nodeType) {\n      case DOCUMENT_NODE:\n      case DOCUMENT_FRAGMENT_NODE:\n        return null;\n    }\n  }\n  return parentNode;\n};\n\nexport const previousSibling = ({[PREV]: prev}) => {\n  switch (prev ? prev.nodeType : 0) {\n    case NODE_END:\n      return prev[START];\n    case TEXT_NODE:\n    case COMMENT_NODE:\n    case CDATA_SECTION_NODE:\n      return prev;\n  }\n  return null;\n};\n\nexport const nextSibling = node => {\n  const next = getEnd(node)[NEXT];\n  return next && (next.nodeType === NODE_END ? null : next);\n};\n", "// https://dom.spec.whatwg.org/#nondocumenttypechildnode\n// CharacterData, Element\n\nimport {ELEMENT_NODE} from '../shared/constants.js';\n\nimport {nextSibling, previousSibling} from '../shared/node.js';\n\nexport const nextElementSibling = node => {\n  let next = nextSibling(node);\n  while (next && next.nodeType !== ELEMENT_NODE)\n    next = nextSibling(next);\n  return next;\n};\n\nexport const previousElementSibling = node => {\n  let prev = previousSibling(node);\n  while (prev && prev.nodeType !== ELEMENT_NODE)\n    prev = previousSibling(prev);\n  return prev;\n};\n", "// https://dom.spec.whatwg.org/#childnode\n// CharacterData, DocumentType, Element\n\nimport {ELEMENT_NODE} from '../shared/constants.js';\nimport {NEXT, PREV} from '../shared/symbols.js';\n\nimport {getEnd, setAdjacent} from '../shared/utils.js';\n\nimport {moCallback} from '../interface/mutation-observer.js';\nimport {disconnectedCallback} from '../interface/custom-element-registry.js';\n\nconst asFragment = (ownerDocument, nodes) => {\n  const fragment = ownerDocument.createDocumentFragment();\n  fragment.append(...nodes);\n  return fragment;\n};\n\nexport const before = (node, nodes) => {\n  const {ownerDocument, parentNode} = node;\n  if (parentNode)\n    parentNode.insertBefore(\n      asFragment(ownerDocument, nodes),\n      node\n    );\n};\n\nexport const after = (node, nodes) => {\n  const {ownerDocument, parentNode} = node;\n  if (parentNode)\n    parentNode.insertBefore(\n      asFragment(ownerDocument, nodes),\n      getEnd(node)[NEXT]\n    );\n};\n\nexport const replaceWith = (node, nodes) => {\n  const {ownerDocument, parentNode} = node;\n  if (parentNode) {\n    if (nodes.includes(node))\n      replaceWith(node, [node = node.cloneNode()]);\n    parentNode.insertBefore(\n      asFragment(ownerDocument, nodes),\n      node\n    );\n    node.remove();\n  }\n};\n\nexport const remove = (prev, current, next) => {\n  const {parentNode, nodeType} = current;\n  if (prev || next) {\n    setAdjacent(prev, next);\n    current[PREV] = null;\n    getEnd(current)[NEXT] = null;\n  }\n  if (parentNode) {\n    current.parentNode = null;\n    moCallback(current, parentNode);\n    if (nodeType === ELEMENT_NODE)\n      disconnectedCallback(current);\n  }\n};\n", "// https://dom.spec.whatwg.org/#interface-characterdata\n\nimport {NEXT, PREV, VALUE} from '../shared/symbols.js';\nimport {String} from '../shared/utils.js';\nimport {isConnected, parentElement, previousSibling, nextSibling} from '../shared/node.js';\nimport {characterDataAsJSON} from '../shared/jsdon.js';\n\nimport {previousElementSibling, nextElementSibling} from '../mixin/non-document-type-child-node.js';\nimport {before, after, replaceWith, remove} from '../mixin/child-node.js';\n\nimport {Node} from './node.js';\nimport {moCallback} from './mutation-observer.js';\n\n/**\n * @implements globalThis.CharacterData\n */\nexport class CharacterData extends Node {\n\n  constructor(ownerDocument, localName, nodeType, data) {\n    super(ownerDocument, localName, nodeType);\n    this[VALUE] = String(data);\n  }\n\n  // <Mixins>\n  get isConnected() { return isConnected(this); }\n  get parentElement() { return parentElement(this); }\n  get previousSibling() { return previousSibling(this); }\n  get nextSibling() { return nextSibling(this); }\n\n  get previousElementSibling() { return previousElementSibling(this); }\n  get nextElementSibling() { return nextElementSibling(this); }\n\n  before(...nodes) { before(this, nodes); }\n  after(...nodes) { after(this, nodes); }\n  replaceWith(...nodes) { replaceWith(this, nodes); }\n  remove() { remove(this[PREV], this, this[NEXT]); }\n  // </Mixins>\n\n  // CharacterData only\n  /* c8 ignore start */\n  get data() { return this[VALUE]; }\n  set data(value) {\n    this[VALUE] = String(value);\n    moCallback(this, this.parentNode);\n  }\n\n  get nodeValue() { return this.data; }\n  set nodeValue(value) { this.data = value; }\n\n  get textContent() { return this.data; }\n  set textContent(value) { this.data = value; }\n\n  get length() { return this.data.length; }\n\n  substringData(offset, count) {\n    return this.data.substr(offset, count);\n  }\n\n  appendData(data) {\n    this.data += data;\n  }\n\n  insertData(offset, data) {\n    const {data: t} = this;\n    this.data = t.slice(0, offset) + data + t.slice(offset);\n  }\n\n  deleteData(offset, count) {\n    const {data: t} = this;\n    this.data = t.slice(0, offset) + t.slice(offset + count);\n  }\n\n  replaceData(offset, count, data) {\n    const {data: t} = this;\n    this.data = t.slice(0, offset) + data + t.slice(offset + count);\n  }\n  /* c8 ignore stop */\n\n  toJSON() {\n    const json = [];\n    characterDataAsJSON(this, json);\n    return json;\n  }\n}\n", "import {CDATA_SECTION_NODE} from '../shared/constants.js';\nimport {VALUE} from '../shared/symbols.js';\n\nimport {CharacterData} from './character-data.js';\n\n/**\n * @implements globalThis.CDATASection\n */\nexport class CDATASection extends CharacterData {\n  constructor(ownerDocument, data = '') {\n    super(ownerDocument, '#cdatasection', CDATA_SECTION_NODE, data);\n  }\n\n  cloneNode() {\n    const {ownerDocument, [VALUE]: data} = this;\n    return new CDATASection(ownerDocument, data);\n  }\n\n  toString() { return `<![CDATA[${this[VALUE]}]]>`; }\n}\n", "import {COMMENT_NODE} from '../shared/constants.js';\nimport {VALUE} from '../shared/symbols.js';\n\nimport {CharacterData} from './character-data.js';\n\n/**\n * @implements globalThis.Comment\n */\nexport class Comment extends CharacterData {\n  constructor(ownerDocument, data = '') {\n    super(ownerDocument, '#comment', COMMENT_NODE, data);\n  }\n\n  cloneNode() {\n    const {ownerDocument, [VALUE]: data} = this;\n    return new Comment(ownerDocument, data);\n  }\n\n  toString() { return `<!--${this[VALUE]}-->`; }\n}\n", null, "export var SelectorType;\n(function (SelectorType) {\n    SelectorType[\"Attribute\"] = \"attribute\";\n    SelectorType[\"Pseudo\"] = \"pseudo\";\n    SelectorType[\"PseudoElement\"] = \"pseudo-element\";\n    SelectorType[\"Tag\"] = \"tag\";\n    SelectorType[\"Universal\"] = \"universal\";\n    // Traversals\n    SelectorType[\"Adjacent\"] = \"adjacent\";\n    SelectorType[\"Child\"] = \"child\";\n    SelectorType[\"Descendant\"] = \"descendant\";\n    SelectorType[\"Parent\"] = \"parent\";\n    SelectorType[\"Sibling\"] = \"sibling\";\n    SelectorType[\"ColumnCombinator\"] = \"column-combinator\";\n})(SelectorType || (SelectorType = {}));\n/**\n * Modes for ignore case.\n *\n * This could be updated to an enum, and the object is\n * the current stand-in that will allow code to be updated\n * without big changes.\n */\nexport const IgnoreCaseMode = {\n    Unknown: null,\n    QuirksMode: \"quirks\",\n    IgnoreCase: true,\n    CaseSensitive: false,\n};\nexport var AttributeAction;\n(function (AttributeAction) {\n    AttributeAction[\"Any\"] = \"any\";\n    AttributeAction[\"Element\"] = \"element\";\n    AttributeAction[\"End\"] = \"end\";\n    AttributeAction[\"Equals\"] = \"equals\";\n    AttributeAction[\"Exists\"] = \"exists\";\n    AttributeAction[\"Hyphen\"] = \"hyphen\";\n    AttributeAction[\"Not\"] = \"not\";\n    AttributeAction[\"Start\"] = \"start\";\n})(AttributeAction || (AttributeAction = {}));\n", "import { SelectorType, AttributeAction, } from \"./types\";\nconst reName = /^[^\\\\#]?(?:\\\\(?:[\\da-f]{1,6}\\s?|.)|[\\w\\-\\u00b0-\\uFFFF])+/;\nconst reEscape = /\\\\([\\da-f]{1,6}\\s?|(\\s)|.)/gi;\nconst actionTypes = new Map([\n    [126 /* Tilde */, AttributeAction.Element],\n    [94 /* Circumflex */, AttributeAction.Start],\n    [36 /* Dollar */, AttributeAction.End],\n    [42 /* Asterisk */, AttributeAction.Any],\n    [33 /* ExclamationMark */, AttributeAction.Not],\n    [124 /* Pipe */, AttributeAction.Hyphen],\n]);\n// Pseudos, whose data property is parsed as well.\nconst unpackPseudos = new Set([\n    \"has\",\n    \"not\",\n    \"matches\",\n    \"is\",\n    \"where\",\n    \"host\",\n    \"host-context\",\n]);\n/**\n * Checks whether a specific selector is a traversal.\n * This is useful eg. in swapping the order of elements that\n * are not traversals.\n *\n * @param selector Selector to check.\n */\nexport function isTraversal(selector) {\n    switch (selector.type) {\n        case SelectorType.Adjacent:\n        case SelectorType.Child:\n        case SelectorType.Descendant:\n        case SelectorType.Parent:\n        case SelectorType.Sibling:\n        case SelectorType.ColumnCombinator:\n            return true;\n        default:\n            return false;\n    }\n}\nconst stripQuotesFromPseudos = new Set([\"contains\", \"icontains\"]);\n// Unescape function taken from https://github.com/jquery/sizzle/blob/master/src/sizzle.js#L152\nfunction funescape(_, escaped, escapedWhitespace) {\n    const high = parseInt(escaped, 16) - 0x10000;\n    // NaN means non-codepoint\n    return high !== high || escapedWhitespace\n        ? escaped\n        : high < 0\n            ? // BMP codepoint\n                String.fromCharCode(high + 0x10000)\n            : // Supplemental Plane codepoint (surrogate pair)\n                String.fromCharCode((high >> 10) | 0xd800, (high & 0x3ff) | 0xdc00);\n}\nfunction unescapeCSS(str) {\n    return str.replace(reEscape, funescape);\n}\nfunction isQuote(c) {\n    return c === 39 /* SingleQuote */ || c === 34 /* DoubleQuote */;\n}\nfunction isWhitespace(c) {\n    return (c === 32 /* Space */ ||\n        c === 9 /* Tab */ ||\n        c === 10 /* NewLine */ ||\n        c === 12 /* FormFeed */ ||\n        c === 13 /* CarriageReturn */);\n}\n/**\n * Parses `selector`, optionally with the passed `options`.\n *\n * @param selector Selector to parse.\n * @param options Options for parsing.\n * @returns Returns a two-dimensional array.\n * The first dimension represents selectors separated by commas (eg. `sub1, sub2`),\n * the second contains the relevant tokens for that selector.\n */\nexport function parse(selector) {\n    const subselects = [];\n    const endIndex = parseSelector(subselects, `${selector}`, 0);\n    if (endIndex < selector.length) {\n        throw new Error(`Unmatched selector: ${selector.slice(endIndex)}`);\n    }\n    return subselects;\n}\nfunction parseSelector(subselects, selector, selectorIndex) {\n    let tokens = [];\n    function getName(offset) {\n        const match = selector.slice(selectorIndex + offset).match(reName);\n        if (!match) {\n            throw new Error(`Expected name, found ${selector.slice(selectorIndex)}`);\n        }\n        const [name] = match;\n        selectorIndex += offset + name.length;\n        return unescapeCSS(name);\n    }\n    function stripWhitespace(offset) {\n        selectorIndex += offset;\n        while (selectorIndex < selector.length &&\n            isWhitespace(selector.charCodeAt(selectorIndex))) {\n            selectorIndex++;\n        }\n    }\n    function readValueWithParenthesis() {\n        selectorIndex += 1;\n        const start = selectorIndex;\n        let counter = 1;\n        for (; counter > 0 && selectorIndex < selector.length; selectorIndex++) {\n            if (selector.charCodeAt(selectorIndex) ===\n                40 /* LeftParenthesis */ &&\n                !isEscaped(selectorIndex)) {\n                counter++;\n            }\n            else if (selector.charCodeAt(selectorIndex) ===\n                41 /* RightParenthesis */ &&\n                !isEscaped(selectorIndex)) {\n                counter--;\n            }\n        }\n        if (counter) {\n            throw new Error(\"Parenthesis not matched\");\n        }\n        return unescapeCSS(selector.slice(start, selectorIndex - 1));\n    }\n    function isEscaped(pos) {\n        let slashCount = 0;\n        while (selector.charCodeAt(--pos) === 92 /* BackSlash */)\n            slashCount++;\n        return (slashCount & 1) === 1;\n    }\n    function ensureNotTraversal() {\n        if (tokens.length > 0 && isTraversal(tokens[tokens.length - 1])) {\n            throw new Error(\"Did not expect successive traversals.\");\n        }\n    }\n    function addTraversal(type) {\n        if (tokens.length > 0 &&\n            tokens[tokens.length - 1].type === SelectorType.Descendant) {\n            tokens[tokens.length - 1].type = type;\n            return;\n        }\n        ensureNotTraversal();\n        tokens.push({ type });\n    }\n    function addSpecialAttribute(name, action) {\n        tokens.push({\n            type: SelectorType.Attribute,\n            name,\n            action,\n            value: getName(1),\n            namespace: null,\n            ignoreCase: \"quirks\",\n        });\n    }\n    /**\n     * We have finished parsing the current part of the selector.\n     *\n     * Remove descendant tokens at the end if they exist,\n     * and return the last index, so that parsing can be\n     * picked up from here.\n     */\n    function finalizeSubselector() {\n        if (tokens.length &&\n            tokens[tokens.length - 1].type === SelectorType.Descendant) {\n            tokens.pop();\n        }\n        if (tokens.length === 0) {\n            throw new Error(\"Empty sub-selector\");\n        }\n        subselects.push(tokens);\n    }\n    stripWhitespace(0);\n    if (selector.length === selectorIndex) {\n        return selectorIndex;\n    }\n    loop: while (selectorIndex < selector.length) {\n        const firstChar = selector.charCodeAt(selectorIndex);\n        switch (firstChar) {\n            // Whitespace\n            case 32 /* Space */:\n            case 9 /* Tab */:\n            case 10 /* NewLine */:\n            case 12 /* FormFeed */:\n            case 13 /* CarriageReturn */: {\n                if (tokens.length === 0 ||\n                    tokens[0].type !== SelectorType.Descendant) {\n                    ensureNotTraversal();\n                    tokens.push({ type: SelectorType.Descendant });\n                }\n                stripWhitespace(1);\n                break;\n            }\n            // Traversals\n            case 62 /* GreaterThan */: {\n                addTraversal(SelectorType.Child);\n                stripWhitespace(1);\n                break;\n            }\n            case 60 /* LessThan */: {\n                addTraversal(SelectorType.Parent);\n                stripWhitespace(1);\n                break;\n            }\n            case 126 /* Tilde */: {\n                addTraversal(SelectorType.Sibling);\n                stripWhitespace(1);\n                break;\n            }\n            case 43 /* Plus */: {\n                addTraversal(SelectorType.Adjacent);\n                stripWhitespace(1);\n                break;\n            }\n            // Special attribute selectors: .class, #id\n            case 46 /* Period */: {\n                addSpecialAttribute(\"class\", AttributeAction.Element);\n                break;\n            }\n            case 35 /* Hash */: {\n                addSpecialAttribute(\"id\", AttributeAction.Equals);\n                break;\n            }\n            case 91 /* LeftSquareBracket */: {\n                stripWhitespace(1);\n                // Determine attribute name and namespace\n                let name;\n                let namespace = null;\n                if (selector.charCodeAt(selectorIndex) === 124 /* Pipe */) {\n                    // Equivalent to no namespace\n                    name = getName(1);\n                }\n                else if (selector.startsWith(\"*|\", selectorIndex)) {\n                    namespace = \"*\";\n                    name = getName(2);\n                }\n                else {\n                    name = getName(0);\n                    if (selector.charCodeAt(selectorIndex) === 124 /* Pipe */ &&\n                        selector.charCodeAt(selectorIndex + 1) !==\n                            61 /* Equal */) {\n                        namespace = name;\n                        name = getName(1);\n                    }\n                }\n                stripWhitespace(0);\n                // Determine comparison operation\n                let action = AttributeAction.Exists;\n                const possibleAction = actionTypes.get(selector.charCodeAt(selectorIndex));\n                if (possibleAction) {\n                    action = possibleAction;\n                    if (selector.charCodeAt(selectorIndex + 1) !==\n                        61 /* Equal */) {\n                        throw new Error(\"Expected `=`\");\n                    }\n                    stripWhitespace(2);\n                }\n                else if (selector.charCodeAt(selectorIndex) === 61 /* Equal */) {\n                    action = AttributeAction.Equals;\n                    stripWhitespace(1);\n                }\n                // Determine value\n                let value = \"\";\n                let ignoreCase = null;\n                if (action !== \"exists\") {\n                    if (isQuote(selector.charCodeAt(selectorIndex))) {\n                        const quote = selector.charCodeAt(selectorIndex);\n                        let sectionEnd = selectorIndex + 1;\n                        while (sectionEnd < selector.length &&\n                            (selector.charCodeAt(sectionEnd) !== quote ||\n                                isEscaped(sectionEnd))) {\n                            sectionEnd += 1;\n                        }\n                        if (selector.charCodeAt(sectionEnd) !== quote) {\n                            throw new Error(\"Attribute value didn't end\");\n                        }\n                        value = unescapeCSS(selector.slice(selectorIndex + 1, sectionEnd));\n                        selectorIndex = sectionEnd + 1;\n                    }\n                    else {\n                        const valueStart = selectorIndex;\n                        while (selectorIndex < selector.length &&\n                            ((!isWhitespace(selector.charCodeAt(selectorIndex)) &&\n                                selector.charCodeAt(selectorIndex) !==\n                                    93 /* RightSquareBracket */) ||\n                                isEscaped(selectorIndex))) {\n                            selectorIndex += 1;\n                        }\n                        value = unescapeCSS(selector.slice(valueStart, selectorIndex));\n                    }\n                    stripWhitespace(0);\n                    // See if we have a force ignore flag\n                    const forceIgnore = selector.charCodeAt(selectorIndex) | 0x20;\n                    // If the forceIgnore flag is set (either `i` or `s`), use that value\n                    if (forceIgnore === 115 /* LowerS */) {\n                        ignoreCase = false;\n                        stripWhitespace(1);\n                    }\n                    else if (forceIgnore === 105 /* LowerI */) {\n                        ignoreCase = true;\n                        stripWhitespace(1);\n                    }\n                }\n                if (selector.charCodeAt(selectorIndex) !==\n                    93 /* RightSquareBracket */) {\n                    throw new Error(\"Attribute selector didn't terminate\");\n                }\n                selectorIndex += 1;\n                const attributeSelector = {\n                    type: SelectorType.Attribute,\n                    name,\n                    action,\n                    value,\n                    namespace,\n                    ignoreCase,\n                };\n                tokens.push(attributeSelector);\n                break;\n            }\n            case 58 /* Colon */: {\n                if (selector.charCodeAt(selectorIndex + 1) === 58 /* Colon */) {\n                    tokens.push({\n                        type: SelectorType.PseudoElement,\n                        name: getName(2).toLowerCase(),\n                        data: selector.charCodeAt(selectorIndex) ===\n                            40 /* LeftParenthesis */\n                            ? readValueWithParenthesis()\n                            : null,\n                    });\n                    continue;\n                }\n                const name = getName(1).toLowerCase();\n                let data = null;\n                if (selector.charCodeAt(selectorIndex) ===\n                    40 /* LeftParenthesis */) {\n                    if (unpackPseudos.has(name)) {\n                        if (isQuote(selector.charCodeAt(selectorIndex + 1))) {\n                            throw new Error(`Pseudo-selector ${name} cannot be quoted`);\n                        }\n                        data = [];\n                        selectorIndex = parseSelector(data, selector, selectorIndex + 1);\n                        if (selector.charCodeAt(selectorIndex) !==\n                            41 /* RightParenthesis */) {\n                            throw new Error(`Missing closing parenthesis in :${name} (${selector})`);\n                        }\n                        selectorIndex += 1;\n                    }\n                    else {\n                        data = readValueWithParenthesis();\n                        if (stripQuotesFromPseudos.has(name)) {\n                            const quot = data.charCodeAt(0);\n                            if (quot === data.charCodeAt(data.length - 1) &&\n                                isQuote(quot)) {\n                                data = data.slice(1, -1);\n                            }\n                        }\n                        data = unescapeCSS(data);\n                    }\n                }\n                tokens.push({ type: SelectorType.Pseudo, name, data });\n                break;\n            }\n            case 44 /* Comma */: {\n                finalizeSubselector();\n                tokens = [];\n                stripWhitespace(1);\n                break;\n            }\n            default: {\n                if (selector.startsWith(\"/*\", selectorIndex)) {\n                    const endIndex = selector.indexOf(\"*/\", selectorIndex + 2);\n                    if (endIndex < 0) {\n                        throw new Error(\"Comment was not terminated\");\n                    }\n                    selectorIndex = endIndex + 2;\n                    // Remove leading whitespace\n                    if (tokens.length === 0) {\n                        stripWhitespace(0);\n                    }\n                    break;\n                }\n                let namespace = null;\n                let name;\n                if (firstChar === 42 /* Asterisk */) {\n                    selectorIndex += 1;\n                    name = \"*\";\n                }\n                else if (firstChar === 124 /* Pipe */) {\n                    name = \"\";\n                    if (selector.charCodeAt(selectorIndex + 1) === 124 /* Pipe */) {\n                        addTraversal(SelectorType.ColumnCombinator);\n                        stripWhitespace(2);\n                        break;\n                    }\n                }\n                else if (reName.test(selector.slice(selectorIndex))) {\n                    name = getName(0);\n                }\n                else {\n                    break loop;\n                }\n                if (selector.charCodeAt(selectorIndex) === 124 /* Pipe */ &&\n                    selector.charCodeAt(selectorIndex + 1) !== 124 /* Pipe */) {\n                    namespace = name;\n                    if (selector.charCodeAt(selectorIndex + 1) ===\n                        42 /* Asterisk */) {\n                        name = \"*\";\n                        selectorIndex += 2;\n                    }\n                    else {\n                        name = getName(1);\n                    }\n                }\n                tokens.push(name === \"*\"\n                    ? { type: SelectorType.Universal, namespace }\n                    : { type: SelectorType.Tag, name, namespace });\n            }\n        }\n    }\n    finalizeSubselector();\n    return selectorIndex;\n}\n", null, null, null, null, null, null, null, null, null, null, null, null, "import * as CSSselect from 'css-select';\n\nimport {ELEMENT_NODE, TEXT_NODE} from './constants.js';\nimport {ignoreCase} from './utils.js';\n\nconst {isArray} = Array;\n\n/* c8 ignore start */\nconst isTag = ({nodeType}) => nodeType === ELEMENT_NODE;\n\nconst existsOne = (test, elements) => elements.some(\n  element => isTag(element) && (\n    test(element) ||\n    existsOne(test, getChildren(element))\n  )\n);\n\nconst getAttributeValue = (element, name) => name === 'class' ?\n                            element.classList.value : element.getAttribute(name);\n\nconst getChildren = ({childNodes}) => childNodes;\n\nconst getName = (element) => {\n  const {localName} = element;\n  return ignoreCase(element) ? localName.toLowerCase() : localName;\n};\n\nconst getParent = ({parentNode}) => parentNode;\n\nconst getSiblings = element => {\n  const {parentNode} = element;\n  return parentNode ? getChildren(parentNode) : element;\n};\n\nconst getText = node => {\n  if (isArray(node))\n    return node.map(getText).join('');\n  if (isTag(node))\n    return getText(getChildren(node));\n  if (node.nodeType === TEXT_NODE)\n    return node.data;\n  return '';\n};\n\nconst hasAttrib = (element, name) => element.hasAttribute(name);\n\nconst removeSubsets = nodes => {\n  let {length} = nodes;\n  while (length--) {\n    const node = nodes[length];\n    if (length && -1 < nodes.lastIndexOf(node, length - 1)) {\n      nodes.splice(length, 1);\n      continue;\n    }\n    for (let {parentNode} = node; parentNode; parentNode = parentNode.parentNode) {\n      if (nodes.includes(parentNode)) {\n        nodes.splice(length, 1);\n        break;\n      }\n    }\n  }\n  return nodes;\n};\n\nconst findAll = (test, nodes) => {\n  const matches = [];\n  for (const node of nodes) {\n    if (isTag(node)) {\n      if (test(node))\n        matches.push(node);\n      matches.push(...findAll(test, getChildren(node)));\n    }\n  }\n  return matches;\n};\n\nconst findOne = (test, nodes) => {\n  for (let node of nodes)\n    if (test(node) || (node = findOne(test, getChildren(node))))\n      return node;\n  return null;\n};\n/* c8 ignore stop */\n\nconst adapter = {\n  isTag,\n  existsOne,\n  getAttributeValue,\n  getChildren,\n  getName,\n  getParent,\n  getSiblings,\n  getText,\n  hasAttrib,\n  removeSubsets,\n  findAll,\n  findOne\n};\n\nexport const prepareMatch = (element, selectors) => CSSselect.compile(\n  selectors,\n  {\n    context: selectors.includes(':scope') ? element : void 0,\n    xmlMode: !ignoreCase(element),\n    adapter\n  }\n);\n\nexport const matches = (element, selectors) => CSSselect.is(\n  element,\n  selectors,\n  {\n    strict: true,\n    context: selectors.includes(':scope') ? element : void 0,\n    xmlMode: !ignoreCase(element),\n    adapter\n  }\n);\n", "import {TEXT_NODE} from '../shared/constants.js';\nimport {VALUE} from '../shared/symbols.js';\nimport {escape} from '../shared/text-escaper.js';\n\nimport {CharacterData} from './character-data.js';\n\n/**\n * @implements globalThis.Text\n */\nexport class Text extends CharacterData {\n  constructor(ownerDocument, data = '') {\n    super(ownerDocument, '#text', TEXT_NODE, data);\n  }\n\n  get wholeText() {\n    const text = [];\n    let {previousSibling, nextSibling} = this;\n    while (previousSibling) {\n      if (previousSibling.nodeType === TEXT_NODE)\n        text.unshift(previousSibling[VALUE]);\n      else\n        break;\n      previousSibling = previousSibling.previousSibling;\n    }\n    text.push(this[VALUE]);\n    while (nextSibling) {\n      if (nextSibling.nodeType === TEXT_NODE)\n        text.push(nextSibling[VALUE]);\n      else\n        break;\n      nextSibling = nextSibling.nextSibling;\n    }\n    return text.join('');\n  }\n\n  cloneNode() {\n    const {ownerDocument, [VALUE]: data} = this;\n    return new Text(ownerDocument, data);\n  }\n\n  toString() { return escape(this[VALUE]); }\n}\n", "// https://dom.spec.whatwg.org/#interface-parentnode\n// Document, DocumentFragment, Element\n\nimport {\n  ATTRIBUTE_NODE,\n  DOCUMENT_FRAGMENT_NODE,\n  ELEMENT_NODE,\n  TEXT_NODE,\n  NODE_END,\n  CDATA_SECTION_NODE,\n  COMMENT_NODE\n} from '../shared/constants.js';\n\nimport {PRIVATE, END, NEXT, PREV, START, VALUE} from '../shared/symbols.js';\n\nimport {prepareMatch} from '../shared/matches.js';\nimport {previousSibling, nextSibling} from '../shared/node.js';\nimport {getEnd, knownAdjacent, knownBoundaries, knownSegment, knownSiblings, localCase} from '../shared/utils.js';\n\nimport {Node} from '../interface/node.js';\nimport {Text} from '../interface/text.js';\nimport {NodeList} from '../interface/node-list.js';\n\nimport {moCallback} from '../interface/mutation-observer.js';\nimport {connectedCallback} from '../interface/custom-element-registry.js';\n\nimport {nextElementSibling} from './non-document-type-child-node.js';\n\nconst isNode = node => node instanceof Node;\n\nconst insert = (parentNode, child, nodes) => {\n  const {ownerDocument} = parentNode;\n  for (const node of nodes)\n    parentNode.insertBefore(\n      isNode(node) ? node : new Text(ownerDocument, node),\n      child\n    );\n};\n\n/** @typedef { import('../interface/element.js').Element & {\n    [typeof NEXT]: NodeStruct,\n    [typeof PREV]: NodeStruct,\n    [typeof START]: NodeStruct,\n    nodeType: typeof ATTRIBUTE_NODE | typeof DOCUMENT_FRAGMENT_NODE | typeof ELEMENT_NODE | typeof TEXT_NODE | typeof NODE_END | typeof COMMENT_NODE | typeof CDATA_SECTION_NODE,\n    ownerDocument: Document,\n    parentNode: ParentNode,\n}} NodeStruct */\n\nexport class ParentNode extends Node {\n  constructor(ownerDocument, localName, nodeType) {\n    super(ownerDocument, localName, nodeType);\n    this[PRIVATE] = null;\n    /** @type {NodeStruct} */\n    this[NEXT] = this[END] = {\n      [NEXT]: null,\n      [PREV]: this,\n      [START]: this,\n      nodeType: NODE_END,\n      ownerDocument: this.ownerDocument,\n      parentNode: null\n    };\n  }\n\n  get childNodes() {\n    const childNodes = new NodeList;\n    let {firstChild} = this;\n    while (firstChild) {\n      childNodes.push(firstChild);\n      firstChild = nextSibling(firstChild);\n    }\n    return childNodes;\n  }\n\n  get children() {\n    const children = new NodeList;\n    let {firstElementChild} = this;\n    while (firstElementChild) {\n      children.push(firstElementChild);\n      firstElementChild = nextElementSibling(firstElementChild);\n    }\n    return children;\n  }\n\n  /**\n   * @returns {NodeStruct | null}\n   */\n  get firstChild() {\n    let {[NEXT]: next, [END]: end} = this;\n    while (next.nodeType === ATTRIBUTE_NODE)\n      next = next[NEXT];\n    return next === end ? null : next;\n  }\n\n  /**\n   * @returns {NodeStruct | null}\n   */\n  get firstElementChild() {\n    let {firstChild} = this;\n    while (firstChild) {\n      if (firstChild.nodeType === ELEMENT_NODE)\n        return firstChild;\n      firstChild = nextSibling(firstChild);\n    }\n    return null;\n  }\n\n  get lastChild() {\n    const prev = this[END][PREV];\n    switch (prev.nodeType) {\n      case NODE_END:\n        return prev[START];\n      case ATTRIBUTE_NODE:\n        return null;\n    }\n    return prev === this ? null : prev;\n  }\n\n  get lastElementChild() {\n    let {lastChild} = this;\n    while (lastChild) {\n      if (lastChild.nodeType === ELEMENT_NODE)\n        return lastChild;\n      lastChild = previousSibling(lastChild);\n    }\n    return null;\n  }\n\n  get childElementCount() {\n    return this.children.length;\n  }\n\n  prepend(...nodes) {\n    insert(this, this.firstChild, nodes);\n  }\n\n  append(...nodes) {\n    insert(this, this[END], nodes);\n  }\n\n  replaceChildren(...nodes) {\n    let {[NEXT]: next, [END]: end} = this;\n    while (next !== end && next.nodeType === ATTRIBUTE_NODE)\n      next = next[NEXT];\n    while (next !== end) {\n      const after = getEnd(next)[NEXT];\n      next.remove();\n      next = after;\n    }\n    if (nodes.length)\n      insert(this, end, nodes);\n  }\n\n  getElementsByClassName(className) {\n    const elements = new NodeList;\n    let {[NEXT]: next, [END]: end} = this;\n    while (next !== end) {\n      if (\n        next.nodeType === ELEMENT_NODE &&\n        next.hasAttribute('class') &&\n        next.classList.has(className)\n      )\n        elements.push(next);\n      next = next[NEXT];\n    }\n    return elements;\n  }\n\n  getElementsByTagName(tagName) {\n    const elements = new NodeList;\n    let {[NEXT]: next, [END]: end} = this;\n    while (next !== end) {\n      if (next.nodeType === ELEMENT_NODE && (\n        next.localName === tagName ||\n        localCase(next) === tagName\n      ))\n        elements.push(next);\n      next = next[NEXT];\n    }\n    return elements;\n  }\n\n  querySelector(selectors) {\n    const matches = prepareMatch(this, selectors);\n    let {[NEXT]: next, [END]: end} = this;\n    while (next !== end) {\n      if (next.nodeType === ELEMENT_NODE && matches(next))\n        return next;\n      next = next.nodeType === ELEMENT_NODE && next.localName === 'template' ? next[END] : next[NEXT];\n    }\n    return null;\n  }\n\n  querySelectorAll(selectors) {\n    const matches = prepareMatch(this, selectors);\n    const elements = new NodeList;\n    let {[NEXT]: next, [END]: end} = this;\n    while (next !== end) {\n      if (next.nodeType === ELEMENT_NODE && matches(next))\n        elements.push(next);\n      next = next.nodeType === ELEMENT_NODE && next.localName === 'template' ? next[END] : next[NEXT];\n    }\n    return elements;\n  }\n\n  appendChild(node) {\n    return this.insertBefore(node, this[END]);\n  }\n\n  contains(node) {\n    let parentNode = node;\n    while (parentNode && parentNode !== this)\n      parentNode = parentNode.parentNode;\n    return parentNode === this;\n  }\n\n  insertBefore(node, before = null) {\n    if (node === before)\n      return node;\n    if (node === this)\n      throw new Error('unable to append a node to itself');\n    const next = before || this[END];\n    switch (node.nodeType) {\n      case ELEMENT_NODE:\n        node.remove();\n        node.parentNode = this;\n        knownBoundaries(next[PREV], node, next);\n        moCallback(node, null);\n        connectedCallback(node);\n        break;\n      case DOCUMENT_FRAGMENT_NODE: {\n        let {[PRIVATE]: parentNode, firstChild, lastChild} = node;\n        if (firstChild) {\n          knownSegment(next[PREV], firstChild, lastChild, next);\n          knownAdjacent(node, node[END]);\n          if (parentNode)\n            parentNode.replaceChildren();\n          do {\n            firstChild.parentNode = this;\n            moCallback(firstChild, null);\n            if (firstChild.nodeType === ELEMENT_NODE)\n              connectedCallback(firstChild);\n          } while (\n            firstChild !== lastChild &&\n            (firstChild = nextSibling(firstChild))\n          );\n        }\n        break;\n      }\n      case TEXT_NODE:\n      case COMMENT_NODE:\n      case CDATA_SECTION_NODE:\n        node.remove();\n      /* eslint no-fallthrough:0 */\n      // this covers DOCUMENT_TYPE_NODE too\n      default:\n        node.parentNode = this;\n        knownSiblings(next[PREV], node, next);\n        moCallback(node, null);\n        break;\n    }\n    return node;\n  }\n\n  normalize() {\n    let {[NEXT]: next, [END]: end} = this;\n    while (next !== end) {\n      const {[NEXT]: $next, [PREV]: $prev, nodeType} = next;\n      if (nodeType === TEXT_NODE) {\n        if (!next[VALUE])\n          next.remove();\n        else if ($prev && $prev.nodeType === TEXT_NODE) {\n          $prev.textContent += next.textContent;\n          next.remove();\n        }\n      }\n      next = $next;\n    }\n  }\n\n  removeChild(node) {\n    if (node.parentNode !== this)\n      throw new Error('node is not a child');\n    node.remove();\n    return node;\n  }\n\n  replaceChild(node, replaced) {\n    const next = getEnd(replaced)[NEXT];\n    replaced.remove();\n    this.insertBefore(node, next);\n    return replaced;\n  }\n}\n", "// https://dom.spec.whatwg.org/#interface-nonelementparentnode\n// Document, DocumentFragment\n\nimport {ELEMENT_NODE} from '../shared/constants.js';\nimport {END, NEXT} from '../shared/symbols.js';\nimport {nonElementAsJSON} from '../shared/jsdon.js';\n\nimport {ParentNode} from './parent-node.js';\n\nexport class NonElementParentNode extends ParentNode {\n  getElementById(id) {\n    let {[NEXT]: next, [END]: end} = this;\n    while (next !== end) {\n      if (next.nodeType === ELEMENT_NODE && next.id === id)\n        return next;\n      next = next[NEXT];\n    }\n    return null;\n  }\n\n  cloneNode(deep) {\n    const {ownerDocument, constructor} = this;\n    const nonEPN = new constructor(ownerDocument);\n    if (deep) {\n      const {[END]: end} = nonEPN;\n      for (const node of this.childNodes)\n        nonEPN.insertBefore(node.cloneNode(deep), end);\n    }\n    return nonEPN; \n  }\n\n  toString() {\n    const {childNodes, localName} = this;\n    return `<${localName}>${childNodes.join('')}</${localName}>`;\n  }\n\n  toJSON() {\n    const json = [];\n    nonElementAsJSON(this, json);\n    return json;\n  }\n}\n", "import {DOCUMENT_FRAGMENT_NODE} from '../shared/constants.js';\nimport {NonElementParentNode} from '../mixin/non-element-parent-node.js';\n\n/**\n * @implements globalThis.DocumentFragment\n */\nexport class DocumentFragment extends NonElementParentNode {\n  constructor(ownerDocument) {\n    super(ownerDocument, '#document-fragment', DOCUMENT_FRAGMENT_NODE);\n  }\n}\n", "import {DOCUMENT_TYPE_NODE} from '../shared/constants.js';\nimport {documentTypeAsJSON} from '../shared/jsdon.js';\n\nimport {Node} from './node.js';\n\n/**\n * @implements globalThis.DocumentType\n */\nexport class DocumentType extends Node {\n  constructor(ownerDocument, name, publicId = '', systemId = '') {\n    super(ownerDocument, '#document-type', DOCUMENT_TYPE_NODE);\n    this.name = name;\n    this.publicId = publicId;\n    this.systemId = systemId;\n  }\n\n  cloneNode() {\n    const {ownerDocument, name, publicId, systemId} = this;\n    return new DocumentType(ownerDocument, name, publicId, systemId);\n  }\n\n  toString() {\n    const {name, publicId, systemId} = this;\n    const hasPublic = 0 < publicId.length;\n    const str = [name];\n    if (hasPublic)\n      str.push('PUBLIC', `\"${publicId}\"`);\n    if (systemId.length) {\n      if (!hasPublic)\n        str.push('SYSTEM');\n      str.push(`\"${systemId}\"`);\n    }\n    return `<!DOCTYPE ${str.join(' ')}>`;\n  }\n\n  toJSON() {\n    const json = [];\n    documentTypeAsJSON(this, json);\n    return json;\n  }\n}\n", "import {ELEMENT_NODE, DOCUMENT_FRAGMENT_NODE} from '../shared/constants.js';\nimport {CUSTOM_ELEMENTS} from '../shared/symbols.js';\nimport {parseFromString} from '../shared/parse-from-string.js';\nimport {ignoreCase} from '../shared/utils.js';\n\n\n/**\n * @param {Node} node\n * @returns {String}\n */\nexport const getInnerHtml = node => node.childNodes.join('');\n\n/**\n * @param {Node} node\n * @param {String} html\n */\nexport const setInnerHtml = (node, html) => {\n  const {ownerDocument} = node;\n  const {constructor} = ownerDocument;\n  const document = new constructor;\n  document[CUSTOM_ELEMENTS] = ownerDocument[CUSTOM_ELEMENTS];\n  const {childNodes} = parseFromString(document, ignoreCase(node), html);\n\n  node.replaceChildren(...childNodes.map(setOwnerDocument, ownerDocument));\n};\n\nfunction setOwnerDocument(node) {\n  node.ownerDocument = this;\n  switch (node.nodeType) {\n    case ELEMENT_NODE:\n    case DOCUMENT_FRAGMENT_NODE:\n      node.childNodes.forEach(setOwnerDocument, this);\n      break;\n  }\n  return node;\n}\n", "export default camel => camel.replace(/(([A-Z0-9])([A-Z0-9][a-z]))|(([a-z0-9]+)([A-Z]))/g, '$2$5-$3$6')\n                             .toLowerCase();\n", "import uhyphen from 'uhyphen';\nimport {setPrototypeOf} from '../shared/object.js';\n\nconst refs = new WeakMap;\n\nconst key = name => `data-${uhyphen(name)}`;\nconst prop = name => name.slice(5).replace(/-([a-z])/g, (_, $1) => $1.toUpperCase());\n\nconst handler = {\n  get(dataset, name) {\n    if (name in dataset)\n      return refs.get(dataset).getAttribute(key(name));\n  },\n\n  set(dataset, name, value) {\n    dataset[name] = value;\n    refs.get(dataset).setAttribute(key(name), value);\n    return true;\n  },\n\n  deleteProperty(dataset, name) {\n    if (name in dataset)\n      refs.get(dataset).removeAttribute(key(name));\n    return delete dataset[name];\n  }\n};\n\n/**\n * @implements globalThis.DOMStringMap\n */\nexport class DOMStringMap {\n  /**\n   * @param {Element} ref\n   */\n  constructor(ref) {\n    for (const {name, value} of ref.attributes) {\n      if (/^data-/.test(name))\n        this[prop(name)] = value;\n    }\n    refs.set(this, ref);\n    return new Proxy(this, handler);\n  }\n}\n\nsetPrototypeOf(DOMStringMap.prototype, null);\n", "import {OWNER_ELEMENT} from '../shared/symbols.js';\nimport {setAttribute} from '../shared/attributes.js';\n\nimport {Attr} from '../interface/attr.js';\n\nconst {add} = Set.prototype;\nconst addTokens = (self, tokens) => {\n  for (const token of tokens) {\n    if (token)\n      add.call(self, token);\n  }\n};\n\nconst update = ({[OWNER_ELEMENT]: ownerElement, value}) => {\n  const attribute = ownerElement.getAttributeNode('class');\n  if (attribute)\n    attribute.value = value;\n  else\n    setAttribute(\n      ownerElement,\n      new Attr(ownerElement.ownerDocument, 'class', value)\n    );\n};\n\n/**\n * @implements globalThis.DOMTokenList\n */\nexport class DOMTokenList extends Set {\n\n  constructor(ownerElement) {\n    super();\n    this[OWNER_ELEMENT] = ownerElement;\n    const attribute = ownerElement.getAttributeNode('class');\n    if (attribute)\n      addTokens(this, attribute.value.split(/\\s+/));\n  }\n\n  get length() { return this.size; }\n\n  get value() { return [...this].join(' '); }\n\n  /**\n   * @param  {...string} tokens\n   */\n  add(...tokens) {\n    addTokens(this, tokens);\n    update(this);\n  }\n\n  /**\n   * @param {string} token\n   */\n  contains(token) { return this.has(token); }\n\n  /**\n   * @param  {...string} tokens\n   */\n  remove(...tokens) {\n    for (const token of tokens)\n      this.delete(token);\n    update(this);\n  }\n\n  /**\n   * @param {string} token\n   * @param {boolean?} force\n   */\n  toggle(token, force) {\n    if (this.has(token)) {\n      if (force)\n        return true;\n      this.delete(token);\n      update(this);\n    }\n    else if (force || arguments.length === 1) {\n      super.add(token);\n      update(this);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * @param {string} token\n   * @param {string} newToken\n   */\n  replace(token, newToken) {\n    if (this.has(token)) {\n      this.delete(token);\n      super.add(newToken);\n      update(this);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * @param {string} token\n   */\n  supports() { return true; }\n}\n", "import uhyphen from 'uhyphen';\n\nimport {CHANGED, PRIVATE, VALUE} from '../shared/symbols.js';\n\nconst refs = new WeakMap;\n\nconst getKeys = style => [...style.keys()].filter(key => key !== PRIVATE);\n\nconst updateKeys = style => {\n  const attr = refs.get(style).getAttributeNode('style');\n  if (!attr || attr[CHANGED] || style.get(PRIVATE) !== attr) {\n    style.clear();\n    if (attr) {\n      style.set(PRIVATE, attr);\n      for (const rule of attr[VALUE].split(/\\s*;\\s*/)) {\n        let [key, ...rest] = rule.split(':');\n        if (rest.length > 0) {\n          key = key.trim();\n          const value = rest.join(':').trim();\n          if (key && value)\n            style.set(key, value);\n        }\n      }\n    }\n  }\n  return attr;\n};\n\nconst handler = {\n  get(style, name) {\n    if (name in prototype)\n      return style[name];\n    updateKeys(style);\n    if (name === 'length')\n      return getKeys(style).length;\n    if (/^\\d+$/.test(name))\n      return getKeys(style)[name];\n    return style.get(uhyphen(name));\n  },\n\n  set(style, name, value) {\n    if (name === 'cssText')\n      style[name] = value;\n    else {\n      let attr = updateKeys(style);\n      if (value == null)\n        style.delete(uhyphen(name));\n      else\n        style.set(uhyphen(name), value);\n      if (!attr) {\n        const element = refs.get(style);\n        attr = element.ownerDocument.createAttribute('style');\n        element.setAttributeNode(attr);\n        style.set(PRIVATE, attr);\n      }\n      attr[CHANGED] = false;\n      attr[VALUE] = style.toString();\n    }\n    return true;\n  }\n};\n\n/**\n * @implements globalThis.CSSStyleDeclaration\n */\nexport class CSSStyleDeclaration extends Map {\n  constructor(element) {\n    super();\n    refs.set(this, element);\n    /* c8 ignore start */\n    return new Proxy(this, handler);\n    /* c8 ignore stop */\n  }\n\n  get cssText() {\n    return this.toString();\n  }\n\n  set cssText(value) {\n    refs.get(this).setAttribute('style', value);\n  }\n\n  getPropertyValue(name) {\n    const self = this[PRIVATE];\n    return handler.get(self, name);\n  }\n\n  setProperty(name, value) {\n    const self = this[PRIVATE];\n    handler.set(self, name, value);\n  }\n\n  removeProperty(name) {\n    const self = this[PRIVATE];\n    handler.set(self, name, null);\n  }\n\n  [Symbol.iterator]() {\n    const self = this[PRIVATE];\n    updateKeys(self);\n    const keys = getKeys(self);\n    const {length} = keys;\n    let i = 0;\n    return {\n      next() {\n        const done = i === length;\n        return {done, value: done ? null : keys[i++]};\n      }\n    };\n  }\n\n  get[PRIVATE]() { return this; }\n\n  toString() {\n    const self = this[PRIVATE];\n    updateKeys(self);\n    const cssText = [];\n    self.forEach(push, cssText);\n    return cssText.join(';');\n  }\n}\n\nconst {prototype} = CSSStyleDeclaration;\n\nfunction push(value, key) {\n  if (key !== PRIVATE)\n    this.push(`${key}:${value}`);\n}\n", "// https://dom.spec.whatwg.org/#interface-event\n\n/* c8 ignore start */\n\n// Node 15 has Event but 14 and 12 don't\nconst BUBBLING_PHASE = 3;\nconst AT_TARGET = 2;\nconst CAPTURING_PHASE = 1;\nconst NONE = 0;\n\nfunction getCurrentTarget(ev) {\n  return ev.currentTarget;\n}\n\n/**\n * @implements globalThis.Event\n */\nclass GlobalEvent {\n    static get BUBBLING_PHASE() { return BUBBLING_PHASE; }\n    static get AT_TARGET() { return AT_TARGET; }\n    static get CAPTURING_PHASE() { return CAPTURING_PHASE; }\n    static get NONE() { return NONE; }\n\n    constructor(type, eventInitDict = {}) {\n      this.type = type;\n      this.bubbles = !!eventInitDict.bubbles;\n      this.cancelBubble = false;\n      this._stopImmediatePropagationFlag = false;\n      this.cancelable = !!eventInitDict.cancelable;\n      this.eventPhase = this.NONE;\n      this.timeStamp = Date.now();\n      this.defaultPrevented = false;\n      this.originalTarget = null;\n      this.returnValue = null;\n      this.srcElement = null;\n      this.target = null;\n      this._path = [];\n    }\n\n    get BUBBLING_PHASE() { return BUBBLING_PHASE; }\n    get AT_TARGET() { return AT_TARGET; }\n    get CAPTURING_PHASE() { return CAPTURING_PHASE; }\n    get NONE() { return NONE; }\n\n    preventDefault() { this.defaultPrevented = true; }\n\n    // simplified implementation, should be https://dom.spec.whatwg.org/#dom-event-composedpath\n    composedPath() {\n      return this._path.map(getCurrentTarget);\n    }\n\n    stopPropagation() {\n      this.cancelBubble = true;\n    }\n    \n    stopImmediatePropagation() {\n      this.stopPropagation();\n      this._stopImmediatePropagationFlag = true;\n    }\n  }\n\nexport {GlobalEvent as Event};\n\n/* c8 ignore stop */\n", "/**\n * @implements globalThis.NamedNodeMap\n */\nexport class NamedNodeMap extends Array {\n  constructor(ownerElement) {\n    super();\n    this.ownerElement = ownerElement;\n  }\n\n  getNamedItem(name) {\n    return this.ownerElement.getAttributeNode(name);\n  }\n\n  setNamedItem(attr) {\n    this.ownerElement.setAttributeNode(attr);\n    this.unshift(attr);\n  }\n\n  removeNamedItem(name) {\n    const item = this.getNamedItem(name);\n    this.ownerElement.removeAttribute(name);\n    this.splice(this.indexOf(item), 1);\n  }\n\n  item(index) {\n    return index < this.length ? this[index] : null;\n  }\n\n  /* c8 ignore start */\n  getNamedItemNS(_, name) {\n    return this.getNamedItem(name);\n  }\n\n  setNamedItemNS(_, attr) {\n    return this.setNamedItem(attr);\n  }\n\n  removeNamedItemNS(_, name) {\n    return this.removeNamedItem(name);\n  }\n  /* c8 ignore stop */\n}\n", "import {DOCUMENT_FRAGMENT_NODE} from '../shared/constants.js';\nimport {getInnerHtml, setInnerHtml} from '../mixin/inner-html.js';\nimport {NonElementParentNode} from '../mixin/non-element-parent-node.js';\n\n/**\n * @implements globalThis.ShadowRoot\n */\nexport class ShadowRoot extends NonElementParentNode {\n  constructor(host) {\n    super(host.ownerDocument, '#shadow-root', DOCUMENT_FRAGMENT_NODE);\n    this.host = host;\n  }\n\n  get innerHTML() {\n    return getInnerHtml(this);\n  }\n  set innerHTML(html) {\n    setInnerHtml(this, html);\n  }\n}\n", "// https://dom.spec.whatwg.org/#interface-element\n\nimport {\n  ATTRIBUTE_NODE,\n  BLOCK_ELEMENTS,\n  CDATA_SECTION_NODE,\n  COMMENT_NODE,\n  ELEMENT_NODE,\n  NODE_END,\n  TEXT_NODE,\n  SVG_NAMESPACE\n} from '../shared/constants.js';\n\nimport {\n  setAttribute, removeAttribute,\n  numericAttribute, stringAttribute\n} from '../shared/attributes.js';\n\nimport {\n  CLASS_LIST, DATASET, STYLE,\n  END, NEXT, PREV, START,\n  MIME\n} from '../shared/symbols.js';\n\nimport {\n  ignoreCase,\n  knownAdjacent,\n  localCase,\n  String\n} from '../shared/utils.js';\n\nimport {elementAsJSON} from '../shared/jsdon.js';\nimport {matches, prepareMatch} from '../shared/matches.js';\nimport {shadowRoots} from '../shared/shadow-roots.js';\n\nimport {isConnected, parentElement, previousSibling, nextSibling} from '../shared/node.js';\nimport {previousElementSibling, nextElementSibling} from '../mixin/non-document-type-child-node.js';\n\nimport {before, after, replaceWith, remove} from '../mixin/child-node.js';\nimport {getInnerHtml, setInnerHtml} from '../mixin/inner-html.js';\nimport {ParentNode} from '../mixin/parent-node.js';\n\nimport {DOMStringMap} from '../dom/string-map.js';\nimport {DOMTokenList} from '../dom/token-list.js';\n\nimport {CSSStyleDeclaration} from './css-style-declaration.js';\nimport {Event} from './event.js';\nimport {NamedNodeMap} from './named-node-map.js';\nimport {ShadowRoot} from './shadow-root.js';\nimport {NodeList} from './node-list.js';\nimport {Attr} from './attr.js';\nimport {Text} from './text.js';\nimport {escape} from '../shared/text-escaper.js';\n\n// <utils>\nconst attributesHandler = {\n  get(target, key) {\n    return key in target ? target[key] : target.find(({name}) => name === key);\n  }\n};\n\nconst create = (ownerDocument, element, localName)  => {\n  if ('ownerSVGElement' in element) {\n    const svg = ownerDocument.createElementNS(SVG_NAMESPACE, localName);\n    svg.ownerSVGElement = element.ownerSVGElement;\n    return svg;\n  }\n  return ownerDocument.createElement(localName);\n};\n\nconst isVoid = ({localName, ownerDocument}) => {\n  return ownerDocument[MIME].voidElements.test(localName);\n};\n\n// </utils>\n\n/**\n * @implements globalThis.Element\n */\nexport class Element extends ParentNode {\n  constructor(ownerDocument, localName) {\n    super(ownerDocument, localName, ELEMENT_NODE);\n    this[CLASS_LIST] = null;\n    this[DATASET] = null;\n    this[STYLE] = null;\n  }\n\n  // <Mixins>\n  get isConnected() { return isConnected(this); }\n  get parentElement() { return parentElement(this); }\n  get previousSibling() { return previousSibling(this); }\n  get nextSibling() { return nextSibling(this); }\n  get namespaceURI() {\n    return 'http://www.w3.org/1999/xhtml';\n  }\n\n  get previousElementSibling() { return previousElementSibling(this); }\n  get nextElementSibling() { return nextElementSibling(this); }\n\n  before(...nodes) { before(this, nodes); }\n  after(...nodes) { after(this, nodes); }\n  replaceWith(...nodes) { replaceWith(this, nodes); }\n  remove() { remove(this[PREV], this, this[END][NEXT]); }\n  // </Mixins>\n\n  // <specialGetters>\n  get id() { return stringAttribute.get(this, 'id'); }\n  set id(value) { stringAttribute.set(this, 'id', value); }\n\n  get className() { return this.classList.value; }\n  set className(value) {\n    const {classList} = this;\n    classList.clear();\n    classList.add(...(String(value).split(/\\s+/)));\n  }\n\n  get nodeName() { return localCase(this); }\n  get tagName() { return localCase(this); }\n\n  get classList() {\n    return this[CLASS_LIST] || (\n      this[CLASS_LIST] = new DOMTokenList(this)\n    );\n  }\n\n  get dataset() {\n    return this[DATASET] || (\n      this[DATASET] = new DOMStringMap(this)\n    );\n  }\n\n  getBoundingClientRect() {\n    return {\n      x: 0,\n      y: 0,\n      bottom: 0,\n      height: 0,\n      left: 0,\n      right: 0,\n      top: 0,\n      width: 0\n    };\n  }\n\n  get nonce() { return stringAttribute.get(this, 'nonce'); }\n  set nonce(value) { stringAttribute.set(this, 'nonce', value); }\n\n  get style() {\n    return this[STYLE] || (\n      this[STYLE] = new CSSStyleDeclaration(this)\n    );\n  }\n\n  get tabIndex() { return numericAttribute.get(this, 'tabindex') || -1; }\n  set tabIndex(value) { numericAttribute.set(this, 'tabindex', value); }\n\n  get slot() { return stringAttribute.get(this, 'slot'); }\n  set slot(value) { stringAttribute.set(this, 'slot', value); }\n  // </specialGetters>\n\n\n  // <contentRelated>\n  get innerText() {\n    const text = [];\n    let {[NEXT]: next, [END]: end} = this;\n    while (next !== end) {\n      if (next.nodeType === TEXT_NODE) {\n        text.push(next.textContent.replace(/\\s+/g, ' '));\n      } else if(\n        text.length && next[NEXT] != end &&\n        BLOCK_ELEMENTS.has(next.tagName)\n      ) {\n        text.push('\\n');\n      }\n      next = next[NEXT];\n    }\n    return text.join('');\n  }\n\n  /**\n   * @returns {String}\n   */\n  get textContent() {\n    const text = [];\n    let {[NEXT]: next, [END]: end} = this;\n    while (next !== end) {\n      if (next.nodeType === TEXT_NODE)\n        text.push(next.textContent);\n      next = next[NEXT];\n    }\n    return text.join('');\n  }\n\n  set textContent(text) {\n    this.replaceChildren();\n    if (text != null && text !== '')\n      this.appendChild(new Text(this.ownerDocument, text));\n  }\n\n  get innerHTML() {\n    return getInnerHtml(this);\n  }\n  set innerHTML(html) {\n    setInnerHtml(this, html);\n  }\n\n  get outerHTML() { return this.toString(); }\n  set outerHTML(html) {\n    const template = this.ownerDocument.createElement('');\n    template.innerHTML = html;\n    this.replaceWith(...template.childNodes);\n  }\n  // </contentRelated>\n\n  // <attributes>\n  get attributes() {\n    const attributes = new NamedNodeMap(this);\n    let next = this[NEXT];\n    while (next.nodeType === ATTRIBUTE_NODE) {\n      attributes.push(next);\n      next = next[NEXT];\n    }\n    return new Proxy(attributes, attributesHandler);\n  }\n\n  focus() { this.dispatchEvent(new Event('focus')); }\n\n  getAttribute(name) {\n    if (name === 'class')\n      return this.className;\n    const attribute = this.getAttributeNode(name);\n    return attribute && (ignoreCase(this) ? attribute.value : escape(attribute.value));\n  }\n\n  getAttributeNode(name) {\n    let next = this[NEXT];\n    while (next.nodeType === ATTRIBUTE_NODE) {\n      if (next.name === name)\n        return next;\n      next = next[NEXT];\n    }\n    return null;\n  }\n\n  getAttributeNames() {\n    const attributes = new NodeList;\n    let next = this[NEXT];\n    while (next.nodeType === ATTRIBUTE_NODE) {\n      attributes.push(next.name);\n      next = next[NEXT];\n    }\n    return attributes;\n  }\n\n  hasAttribute(name) { return !!this.getAttributeNode(name); }\n  hasAttributes() { return this[NEXT].nodeType === ATTRIBUTE_NODE; }\n\n  removeAttribute(name) {\n    if (name === 'class' && this[CLASS_LIST])\n        this[CLASS_LIST].clear();\n    let next = this[NEXT];\n    while (next.nodeType === ATTRIBUTE_NODE) {\n      if (next.name === name) {\n        removeAttribute(this, next);\n        return;\n      }\n      next = next[NEXT];\n    }\n  }\n\n  removeAttributeNode(attribute) {\n    let next = this[NEXT];\n    while (next.nodeType === ATTRIBUTE_NODE) {\n      if (next === attribute) {\n        removeAttribute(this, next);\n        return;\n      }\n      next = next[NEXT];\n    }\n  }\n\n  setAttribute(name, value) {\n    if (name === 'class')\n      this.className = value;\n    else {\n      const attribute = this.getAttributeNode(name);\n      if (attribute)\n        attribute.value = value;\n      else\n        setAttribute(this, new Attr(this.ownerDocument, name, value));\n    }\n  }\n\n  setAttributeNode(attribute) {\n    const {name} = attribute;\n    const previously = this.getAttributeNode(name);\n    if (previously !== attribute) {\n      if (previously)\n        this.removeAttributeNode(previously);\n      const {ownerElement} = attribute;\n      if (ownerElement)\n        ownerElement.removeAttributeNode(attribute);\n      setAttribute(this, attribute);\n    }\n    return previously;\n  }\n\n  toggleAttribute(name, force) {\n    if (this.hasAttribute(name)) {\n      if (!force) {\n        this.removeAttribute(name);\n        return false;\n      }\n      return true;\n    }\n    else if (force || arguments.length === 1) {\n      this.setAttribute(name, '');\n      return true;\n    }\n    return false;\n  }\n  // </attributes>\n\n  // <ShadowDOM>\n  get shadowRoot() {\n    if (shadowRoots.has(this)) {\n      const {mode, shadowRoot} = shadowRoots.get(this);\n      if (mode === 'open')\n        return shadowRoot;\n    }\n    return null;\n  }\n\n  attachShadow(init) {\n    if (shadowRoots.has(this))\n      throw new Error('operation not supported');\n    // TODO: shadowRoot should be likely a specialized class that extends DocumentFragment\n    //       but until DSD is out, I am not sure I should spend time on this.\n    const shadowRoot = new ShadowRoot(this);\n    shadowRoots.set(this, {\n      mode: init.mode,\n      shadowRoot\n    });\n    return shadowRoot;\n  }\n  // </ShadowDOM>\n\n  // <selectors>\n  matches(selectors) { return matches(this, selectors); }\n  closest(selectors) {\n    let parentElement = this;\n    const matches = prepareMatch(parentElement, selectors);\n    while (parentElement && !matches(parentElement))\n      parentElement = parentElement.parentElement;\n    return parentElement;\n  }\n  // </selectors>\n\n  // <insertAdjacent>\n  insertAdjacentElement(position, element) {\n    const {parentElement} = this;\n    switch (position) {\n      case 'beforebegin':\n        if (parentElement) {\n          parentElement.insertBefore(element, this);\n          break;\n        }\n        return null;\n      case 'afterbegin':\n        this.insertBefore(element, this.firstChild);\n        break;\n      case 'beforeend':\n        this.insertBefore(element, null);\n        break;\n      case 'afterend':\n        if (parentElement) {\n          parentElement.insertBefore(element, this.nextSibling);\n          break;\n        }\n        return null;\n    }\n    return element;\n  }\n\n  insertAdjacentHTML(position, html) {\n    const template = this.ownerDocument.createElement('template');\n    template.innerHTML = html;\n    this.insertAdjacentElement(position, template.content);\n  }\n\n  insertAdjacentText(position, text) {\n    const node = this.ownerDocument.createTextNode(text);\n    this.insertAdjacentElement(position, node);\n  }\n  // </insertAdjacent>\n\n  cloneNode(deep = false) {\n    const {ownerDocument, localName} = this;\n    const addNext = next => {\n      next.parentNode = parentNode;\n      knownAdjacent($next, next);\n      $next = next;\n    };\n    const clone = create(ownerDocument, this, localName);\n    let parentNode = clone, $next = clone;\n    let {[NEXT]: next, [END]: prev} = this;\n    while (next !== prev && (deep || next.nodeType === ATTRIBUTE_NODE)) {\n      switch (next.nodeType) {\n        case NODE_END:\n          knownAdjacent($next, parentNode[END]);\n          $next = parentNode[END];\n          parentNode = parentNode.parentNode;\n          break;\n        case ELEMENT_NODE: {\n          const node = create(ownerDocument, next, next.localName);\n          addNext(node);\n          parentNode = node;\n          break;\n        }\n        case ATTRIBUTE_NODE: {\n          const attr = next.cloneNode(deep);\n          attr.ownerElement = parentNode;\n          addNext(attr);\n          break;\n        }\n        case TEXT_NODE:\n        case COMMENT_NODE:\n        case CDATA_SECTION_NODE:\n          addNext(next.cloneNode(deep));\n          break;\n      }\n      next = next[NEXT];\n    }\n    knownAdjacent($next, clone[END]);\n    return clone;\n  }\n\n  // <custom>\n  toString() {\n    const out = [];\n    const {[END]: end} = this;\n    let next = {[NEXT]: this};\n    let isOpened = false;\n    do {\n      next = next[NEXT];\n      switch (next.nodeType) {\n        case ATTRIBUTE_NODE: {\n          const attr = ' ' + next;\n          switch (attr) {\n            case ' id':\n            case ' class':\n            case ' style':\n              break;\n            default:\n              out.push(attr);\n          }\n          break;\n        }\n        case NODE_END: {\n          const start = next[START];\n          if (isOpened) {\n            if ('ownerSVGElement' in start)\n              out.push(' />');\n            else if (isVoid(start))\n              out.push(ignoreCase(start) ? '>' : ' />');\n            else\n              out.push(`></${start.localName}>`);\n            isOpened = false;\n          }\n          else\n            out.push(`</${start.localName}>`);\n          break;\n        }\n        case ELEMENT_NODE:\n          if (isOpened)\n            out.push('>');\n          if (next.toString !== this.toString) {\n            out.push(next.toString());\n            next = next[END];\n            isOpened = false;\n          }\n          else {\n            out.push(`<${next.localName}`);\n            isOpened = true;\n          }\n          break;\n        case TEXT_NODE:\n        case COMMENT_NODE:\n        case CDATA_SECTION_NODE:\n          out.push((isOpened ? '>' : '') + next);\n          isOpened = false;\n          break;\n      }\n    } while (next !== end);\n    return out.join('');\n  }\n\n  toJSON() {\n    const json = [];\n    elementAsJSON(this, json);\n    return json;\n  }\n  // </custom>\n\n\n  /* c8 ignore start */\n  getAttributeNS(_, name) { return this.getAttribute(name); }\n  getElementsByTagNameNS(_, name) { return this.getElementsByTagName(name); }\n  hasAttributeNS(_, name) { return this.hasAttribute(name); }\n  removeAttributeNS(_, name) { this.removeAttribute(name); }\n  setAttributeNS(_, name, value) { this.setAttribute(name, value); }\n  setAttributeNodeNS(attr) { return this.setAttributeNode(attr); }\n  /* c8 ignore stop */\n}\n", "import {Element} from '../interface/element.js';\nimport {String} from '../shared/utils.js';\n\nconst classNames = new WeakMap;\n\nconst handler = {\n  get(target, name) {\n    return target[name];\n  },\n  set(target, name, value) {\n    target[name] = value;\n    return true;\n  }\n};\n\n/**\n * @implements globalThis.SVGElement\n */\nexport class SVGElement extends Element {\n  constructor(ownerDocument, localName, ownerSVGElement = null) {\n    super(ownerDocument, localName);\n    this.ownerSVGElement = ownerSVGElement;\n  }\n\n  get className() {\n    if (!classNames.has(this))\n      classNames.set(this, new Proxy({baseVal: '', animVal: ''}, handler));\n    return classNames.get(this);\n  }\n\n  /* c8 ignore start */\n  set className(value) {\n    const {classList} = this;\n    classList.clear();\n    classList.add(...(String(value).split(/\\s+/)));\n  }\n  /* c8 ignore stop */\n\n  get namespaceURI() {\n    return 'http://www.w3.org/2000/svg';\n  }\n\n  getAttribute(name) {\n    return name === 'class' ?\n      [...this.classList].join(' ') :\n      super.getAttribute(name);\n  }\n\n  setAttribute(name, value) {\n    if (name === 'class')\n      this.className = value;\n    else if (name === 'style') {\n      const {className} = this;\n      className.baseVal = className.animVal = value;\n    }\n    super.setAttribute(name, value);\n  }\n}\n", "import {Attr as _Attr} from '../interface/attr.js';\nimport {CharacterData as _CharacterData} from '../interface/character-data.js';\nimport {CDATASection as _CDATASection} from '../interface/cdata-section.js';\nimport {Comment as _Comment} from '../interface/comment.js';\nimport {DocumentFragment as _DocumentFragment} from '../interface/document-fragment.js';\nimport {DocumentType as _DocumentType} from '../interface/document-type.js';\nimport {Element as _Element} from '../interface/element.js';\nimport {Node as _Node} from '../interface/node.js';\nimport {ShadowRoot as _ShadowRoot} from '../interface/shadow-root.js';\nimport {Text as _Text} from '../interface/text.js';\nimport {SVGElement as _SVGElement} from '../svg/element.js';\n\nimport {setPrototypeOf} from './object.js';\n\n/* c8 ignore start */\nexport const illegalConstructor = () => {\n  throw new TypeError('Illegal constructor');\n};\n\nexport function Attr() { illegalConstructor(); }\nsetPrototypeOf(Attr, _Attr);\nAttr.prototype = _Attr.prototype;\n\nexport function CDATASection() { illegalConstructor(); }\nsetPrototypeOf(CDATASection, _CDATASection);\nCDATASection.prototype = _CDATASection.prototype;\n\nexport function CharacterData() { illegalConstructor(); }\nsetPrototypeOf(CharacterData, _CharacterData);\nCharacterData.prototype = _CharacterData.prototype;\n\nexport function Comment() { illegalConstructor(); }\nsetPrototypeOf(Comment, _Comment);\nComment.prototype = _Comment.prototype;\n\nexport function DocumentFragment() { illegalConstructor(); }\nsetPrototypeOf(DocumentFragment, _DocumentFragment);\nDocumentFragment.prototype = _DocumentFragment.prototype;\n\nexport function DocumentType() { illegalConstructor(); }\nsetPrototypeOf(DocumentType, _DocumentType);\nDocumentType.prototype = _DocumentType.prototype;\n\nexport function Element() { illegalConstructor(); }\nsetPrototypeOf(Element, _Element);\nElement.prototype = _Element.prototype;\n\nexport function Node() { illegalConstructor(); }\nsetPrototypeOf(Node, _Node);\nNode.prototype = _Node.prototype;\n\nexport function ShadowRoot() { illegalConstructor(); }\nsetPrototypeOf(ShadowRoot, _ShadowRoot);\nShadowRoot.prototype = _ShadowRoot.prototype;\n\nexport function Text() { illegalConstructor(); }\nsetPrototypeOf(Text, _Text);\nText.prototype = _Text.prototype;\n\nexport function SVGElement() { illegalConstructor(); }\nsetPrototypeOf(SVGElement, _SVGElement);\nSVGElement.prototype = _SVGElement.prototype;\n/* c8 ignore stop */\n\nexport const Facades = {\n  Attr,\n  CDATASection,\n  CharacterData,\n  Comment,\n  DocumentFragment,\n  DocumentType,\n  Element,\n  Node,\n  ShadowRoot,\n  Text,\n  SVGElement\n};\n", "import {END, UPGRADE} from '../shared/symbols.js';\nimport {booleanAttribute, stringAttribute} from '../shared/attributes.js';\n\nimport {Event} from '../interface/event.js';\nimport {Element} from '../interface/element.js';\nimport {Classes, customElements} from '../interface/custom-element-registry.js';\n\nconst Level0 = new WeakMap;\nconst level0 = {\n  get(element, name) {\n    return Level0.has(element) && Level0.get(element)[name] || null;\n  },\n  set(element, name, value) {\n    if (!Level0.has(element))\n      Level0.set(element, {});\n    const handlers = Level0.get(element);\n    const type = name.slice(2);\n    if (handlers[name])\n      element.removeEventListener(type, handlers[name], false);\n    if ((handlers[name] = value))\n      element.addEventListener(type, value, false);\n  }\n};\n\n/**\n * @implements globalThis.HTMLElement\n */\nexport class HTMLElement extends Element {\n\n  static get observedAttributes() { return []; }\n\n  constructor(ownerDocument = null, localName = '') {\n    super(ownerDocument, localName);\n\n    const ownerLess = !ownerDocument;\n    let options;\n\n    if (ownerLess) {\n      const {constructor: Class} = this;\n      if (!Classes.has(Class))\n        throw new Error('unable to initialize this Custom Element');\n      ({ownerDocument, localName, options} = Classes.get(Class));\n    }\n\n    if (ownerDocument[UPGRADE]) {\n      const {element, values} = ownerDocument[UPGRADE];\n      ownerDocument[UPGRADE] = null;\n      for (const [key, value] of values)\n        element[key] = value;\n      return element;\n    }\n\n    if (ownerLess) {\n      this.ownerDocument = this[END].ownerDocument = ownerDocument;\n      this.localName = localName;\n      customElements.set(this, {connected: false});\n      if (options.is)\n        this.setAttribute('is', options.is);\n    }\n  }\n\n  /* c8 ignore start */\n\n  /* TODO: what about these?\n  offsetHeight\n  offsetLeft\n  offsetParent\n  offsetTop\n  offsetWidth\n  */\n\n  blur() { this.dispatchEvent(new Event('blur')); }\n  click() {\n    const clickEvent = new Event('click', {bubbles: true, cancelable: true});\n    clickEvent.button = 0;\n\n    this.dispatchEvent(clickEvent);\n  }\n\n  // Boolean getters\n  get accessKeyLabel() {\n    const {accessKey} = this;\n    return accessKey && `Alt+Shift+${accessKey}`;\n  }\n  get isContentEditable() { return this.hasAttribute('contenteditable'); }\n\n  // Boolean Accessors\n  get contentEditable() { return booleanAttribute.get(this, 'contenteditable'); }\n  set contentEditable(value) { booleanAttribute.set(this, 'contenteditable', value); }\n  get draggable() { return booleanAttribute.get(this, 'draggable'); }\n  set draggable(value) { booleanAttribute.set(this, 'draggable', value); }\n  get hidden() { return booleanAttribute.get(this, 'hidden'); }\n  set hidden(value) { booleanAttribute.set(this, 'hidden', value); }\n  get spellcheck() { return booleanAttribute.get(this, 'spellcheck'); }\n  set spellcheck(value) { booleanAttribute.set(this, 'spellcheck', value); }\n\n  // String Accessors\n  get accessKey() { return stringAttribute.get(this, 'accesskey'); }\n  set accessKey(value) { stringAttribute.set(this, 'accesskey', value); }\n  get dir() { return stringAttribute.get(this, 'dir'); }\n  set dir(value) { stringAttribute.set(this, 'dir', value); }\n  get lang() { return stringAttribute.get(this, 'lang'); }\n  set lang(value) { stringAttribute.set(this, 'lang', value); }\n  get title() { return stringAttribute.get(this, 'title'); }\n  set title(value) { stringAttribute.set(this, 'title', value); }\n\n  // DOM Level 0\n  get onabort() { return level0.get(this, 'onabort'); }\n  set onabort(value) { level0.set(this, 'onabort', value); }\n\n  get onblur() { return level0.get(this, 'onblur'); }\n  set onblur(value) { level0.set(this, 'onblur', value); }\n\n  get oncancel() { return level0.get(this, 'oncancel'); }\n  set oncancel(value) { level0.set(this, 'oncancel', value); }\n\n  get oncanplay() { return level0.get(this, 'oncanplay'); }\n  set oncanplay(value) { level0.set(this, 'oncanplay', value); }\n\n  get oncanplaythrough() { return level0.get(this, 'oncanplaythrough'); }\n  set oncanplaythrough(value) { level0.set(this, 'oncanplaythrough', value); }\n\n  get onchange() { return level0.get(this, 'onchange'); }\n  set onchange(value) { level0.set(this, 'onchange', value); }\n\n  get onclick() { return level0.get(this, 'onclick'); }\n  set onclick(value) { level0.set(this, 'onclick', value); }\n\n  get onclose() { return level0.get(this, 'onclose'); }\n  set onclose(value) { level0.set(this, 'onclose', value); }\n\n  get oncontextmenu() { return level0.get(this, 'oncontextmenu'); }\n  set oncontextmenu(value) { level0.set(this, 'oncontextmenu', value); }\n\n  get oncuechange() { return level0.get(this, 'oncuechange'); }\n  set oncuechange(value) { level0.set(this, 'oncuechange', value); }\n\n  get ondblclick() { return level0.get(this, 'ondblclick'); }\n  set ondblclick(value) { level0.set(this, 'ondblclick', value); }\n\n  get ondrag() { return level0.get(this, 'ondrag'); }\n  set ondrag(value) { level0.set(this, 'ondrag', value); }\n\n  get ondragend() { return level0.get(this, 'ondragend'); }\n  set ondragend(value) { level0.set(this, 'ondragend', value); }\n\n  get ondragenter() { return level0.get(this, 'ondragenter'); }\n  set ondragenter(value) { level0.set(this, 'ondragenter', value); }\n\n  get ondragleave() { return level0.get(this, 'ondragleave'); }\n  set ondragleave(value) { level0.set(this, 'ondragleave', value); }\n\n  get ondragover() { return level0.get(this, 'ondragover'); }\n  set ondragover(value) { level0.set(this, 'ondragover', value); }\n\n  get ondragstart() { return level0.get(this, 'ondragstart'); }\n  set ondragstart(value) { level0.set(this, 'ondragstart', value); }\n\n  get ondrop() { return level0.get(this, 'ondrop'); }\n  set ondrop(value) { level0.set(this, 'ondrop', value); }\n\n  get ondurationchange() { return level0.get(this, 'ondurationchange'); }\n  set ondurationchange(value) { level0.set(this, 'ondurationchange', value); }\n\n  get onemptied() { return level0.get(this, 'onemptied'); }\n  set onemptied(value) { level0.set(this, 'onemptied', value); }\n\n  get onended() { return level0.get(this, 'onended'); }\n  set onended(value) { level0.set(this, 'onended', value); }\n\n  get onerror() { return level0.get(this, 'onerror'); }\n  set onerror(value) { level0.set(this, 'onerror', value); }\n\n  get onfocus() { return level0.get(this, 'onfocus'); }\n  set onfocus(value) { level0.set(this, 'onfocus', value); }\n\n  get oninput() { return level0.get(this, 'oninput'); }\n  set oninput(value) { level0.set(this, 'oninput', value); }\n\n  get oninvalid() { return level0.get(this, 'oninvalid'); }\n  set oninvalid(value) { level0.set(this, 'oninvalid', value); }\n\n  get onkeydown() { return level0.get(this, 'onkeydown'); }\n  set onkeydown(value) { level0.set(this, 'onkeydown', value); }\n\n  get onkeypress() { return level0.get(this, 'onkeypress'); }\n  set onkeypress(value) { level0.set(this, 'onkeypress', value); }\n\n  get onkeyup() { return level0.get(this, 'onkeyup'); }\n  set onkeyup(value) { level0.set(this, 'onkeyup', value); }\n\n  get onload() { return level0.get(this, 'onload'); }\n  set onload(value) { level0.set(this, 'onload', value); }\n\n  get onloadeddata() { return level0.get(this, 'onloadeddata'); }\n  set onloadeddata(value) { level0.set(this, 'onloadeddata', value); }\n\n  get onloadedmetadata() { return level0.get(this, 'onloadedmetadata'); }\n  set onloadedmetadata(value) { level0.set(this, 'onloadedmetadata', value); }\n\n  get onloadstart() { return level0.get(this, 'onloadstart'); }\n  set onloadstart(value) { level0.set(this, 'onloadstart', value); }\n\n  get onmousedown() { return level0.get(this, 'onmousedown'); }\n  set onmousedown(value) { level0.set(this, 'onmousedown', value); }\n\n  get onmouseenter() { return level0.get(this, 'onmouseenter'); }\n  set onmouseenter(value) { level0.set(this, 'onmouseenter', value); }\n\n  get onmouseleave() { return level0.get(this, 'onmouseleave'); }\n  set onmouseleave(value) { level0.set(this, 'onmouseleave', value); }\n\n  get onmousemove() { return level0.get(this, 'onmousemove'); }\n  set onmousemove(value) { level0.set(this, 'onmousemove', value); }\n\n  get onmouseout() { return level0.get(this, 'onmouseout'); }\n  set onmouseout(value) { level0.set(this, 'onmouseout', value); }\n\n  get onmouseover() { return level0.get(this, 'onmouseover'); }\n  set onmouseover(value) { level0.set(this, 'onmouseover', value); }\n\n  get onmouseup() { return level0.get(this, 'onmouseup'); }\n  set onmouseup(value) { level0.set(this, 'onmouseup', value); }\n\n  get onmousewheel() { return level0.get(this, 'onmousewheel'); }\n  set onmousewheel(value) { level0.set(this, 'onmousewheel', value); }\n\n  get onpause() { return level0.get(this, 'onpause'); }\n  set onpause(value) { level0.set(this, 'onpause', value); }\n\n  get onplay() { return level0.get(this, 'onplay'); }\n  set onplay(value) { level0.set(this, 'onplay', value); }\n\n  get onplaying() { return level0.get(this, 'onplaying'); }\n  set onplaying(value) { level0.set(this, 'onplaying', value); }\n\n  get onprogress() { return level0.get(this, 'onprogress'); }\n  set onprogress(value) { level0.set(this, 'onprogress', value); }\n\n  get onratechange() { return level0.get(this, 'onratechange'); }\n  set onratechange(value) { level0.set(this, 'onratechange', value); }\n\n  get onreset() { return level0.get(this, 'onreset'); }\n  set onreset(value) { level0.set(this, 'onreset', value); }\n\n  get onresize() { return level0.get(this, 'onresize'); }\n  set onresize(value) { level0.set(this, 'onresize', value); }\n\n  get onscroll() { return level0.get(this, 'onscroll'); }\n  set onscroll(value) { level0.set(this, 'onscroll', value); }\n\n  get onseeked() { return level0.get(this, 'onseeked'); }\n  set onseeked(value) { level0.set(this, 'onseeked', value); }\n\n  get onseeking() { return level0.get(this, 'onseeking'); }\n  set onseeking(value) { level0.set(this, 'onseeking', value); }\n\n  get onselect() { return level0.get(this, 'onselect'); }\n  set onselect(value) { level0.set(this, 'onselect', value); }\n\n  get onshow() { return level0.get(this, 'onshow'); }\n  set onshow(value) { level0.set(this, 'onshow', value); }\n\n  get onstalled() { return level0.get(this, 'onstalled'); }\n  set onstalled(value) { level0.set(this, 'onstalled', value); }\n\n  get onsubmit() { return level0.get(this, 'onsubmit'); }\n  set onsubmit(value) { level0.set(this, 'onsubmit', value); }\n\n  get onsuspend() { return level0.get(this, 'onsuspend'); }\n  set onsuspend(value) { level0.set(this, 'onsuspend', value); }\n\n  get ontimeupdate() { return level0.get(this, 'ontimeupdate'); }\n  set ontimeupdate(value) { level0.set(this, 'ontimeupdate', value); }\n\n  get ontoggle() { return level0.get(this, 'ontoggle'); }\n  set ontoggle(value) { level0.set(this, 'ontoggle', value); }\n\n  get onvolumechange() { return level0.get(this, 'onvolumechange'); }\n  set onvolumechange(value) { level0.set(this, 'onvolumechange', value); }\n\n  get onwaiting() { return level0.get(this, 'onwaiting'); }\n  set onwaiting(value) { level0.set(this, 'onwaiting', value); }\n\n  get onauxclick() { return level0.get(this, 'onauxclick'); }\n  set onauxclick(value) { level0.set(this, 'onauxclick', value); }\n\n  get ongotpointercapture() { return level0.get(this, 'ongotpointercapture'); }\n  set ongotpointercapture(value) { level0.set(this, 'ongotpointercapture', value); }\n\n  get onlostpointercapture() { return level0.get(this, 'onlostpointercapture'); }\n  set onlostpointercapture(value) { level0.set(this, 'onlostpointercapture', value); }\n\n  get onpointercancel() { return level0.get(this, 'onpointercancel'); }\n  set onpointercancel(value) { level0.set(this, 'onpointercancel', value); }\n\n  get onpointerdown() { return level0.get(this, 'onpointerdown'); }\n  set onpointerdown(value) { level0.set(this, 'onpointerdown', value); }\n\n  get onpointerenter() { return level0.get(this, 'onpointerenter'); }\n  set onpointerenter(value) { level0.set(this, 'onpointerenter', value); }\n\n  get onpointerleave() { return level0.get(this, 'onpointerleave'); }\n  set onpointerleave(value) { level0.set(this, 'onpointerleave', value); }\n\n  get onpointermove() { return level0.get(this, 'onpointermove'); }\n  set onpointermove(value) { level0.set(this, 'onpointermove', value); }\n\n  get onpointerout() { return level0.get(this, 'onpointerout'); }\n  set onpointerout(value) { level0.set(this, 'onpointerout', value); }\n\n  get onpointerover() { return level0.get(this, 'onpointerover'); }\n  set onpointerover(value) { level0.set(this, 'onpointerover', value); }\n\n  get onpointerup() { return level0.get(this, 'onpointerup'); }\n  set onpointerup(value) { level0.set(this, 'onpointerup', value); }\n  /* c8 ignore stop */\n\n}\n", "import {CONTENT, PRIVATE} from '../shared/symbols.js';\n\nimport {registerHTMLClass} from '../shared/register-html-class.js';\n\nimport {HTMLElement} from './element.js';\n\nconst tagName = 'template';\n\n/**\n * @implements globalThis.HTMLTemplateElement\n */\nclass HTMLTemplateElement extends HTMLElement {\n  constructor(ownerDocument) {\n    super(ownerDocument, tagName);\n    const content = this.ownerDocument.createDocumentFragment();\n    (this[CONTENT] = content)[PRIVATE] = this;\n  }\n\n  get content() {\n    if (this.hasChildNodes() && !this[CONTENT].hasChildNodes()) {\n      for (const node of this.childNodes)\n        this[CONTENT].appendChild(node.cloneNode(true));\n    }\n    return this[CONTENT];\n  }\n}\n\nregisterHTMLClass(tagName, HTMLTemplateElement);\n\nexport {HTMLTemplateElement};\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLHtmlElement\n */\nexport class HTMLHtmlElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'html') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\nconst {toString} = HTMLElement.prototype;\n\nexport class TextElement extends HTMLElement {\n\n  get innerHTML() { return this.textContent; }\n  set innerHTML(html) { this.textContent = html; }\n\n  toString() {\n    const outerHTML = toString.call(this.cloneNode());\n    return outerHTML.replace(/></, `>${this.textContent}<`);\n  }\n}\n", "import { booleanAttribute, stringAttribute } from '../shared/attributes.js';\nimport { registerHTMLClass } from '../shared/register-html-class.js';\n\nimport { TextElement } from './text-element.js';\n\nconst tagName = 'script';\n\n/**\n * @implements globalThis.HTMLScriptElement\n */\nclass HTMLScriptElement extends TextElement {\n  constructor(ownerDocument, localName = tagName) {\n    super(ownerDocument, localName);\n  }\n\n  get type() {\n    return stringAttribute.get(this, 'type');\n  }\n  set type(value) {\n    stringAttribute.set(this, 'type', value);\n  }\n\n  get src() {\n    return stringAttribute.get(this, 'src');\n  }\n  set src(value) {\n    stringAttribute.set(this, 'src', value);\n  }\n\n  get defer() {\n    return booleanAttribute.get(this, 'defer');\n  }\n\n  set defer(value) {\n    booleanAttribute.set(this, 'defer', value);\n  }\n\n  get crossOrigin() {\n    return stringAttribute.get(this, 'crossorigin');\n  }\n  set crossOrigin(value) {\n    stringAttribute.set(this, 'crossorigin', value);\n  }\n\n  get nomodule() {\n    return booleanAttribute.get(this, 'nomodule');\n  }\n  set nomodule(value) {\n    booleanAttribute.set(this, 'nomodule', value);\n  }\n\n  get referrerPolicy() {\n    return stringAttribute.get(this, 'referrerpolicy');\n  }\n  set referrerPolicy(value) {\n    stringAttribute.set(this, 'referrerpolicy', value);\n  }\n\n  get nonce() {\n    return stringAttribute.get(this, 'nonce');\n  }\n  set nonce(value) {\n    stringAttribute.set(this, 'nonce', value);\n  }\n\n  get async() {\n    return booleanAttribute.get(this, 'async');\n  }\n  set async(value) {\n    booleanAttribute.set(this, 'async', value);\n  }\n\n  get text() { return this.textContent; }\n  set text(content) { this.textContent = content; }\n}\n\nregisterHTMLClass(tagName, HTMLScriptElement);\n\nexport { HTMLScriptElement };\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLFrameElement\n */\nexport class HTMLFrameElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'frame') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {registerHTMLClass} from '../shared/register-html-class.js';\nimport {booleanAttribute, stringAttribute} from '../shared/attributes.js';\n\nimport {HTMLElement} from './element.js';\n\nconst tagName = 'iframe';\n\n/**\n * @implements globalThis.HTMLIFrameElement\n */\nclass HTMLIFrameElement extends HTMLElement {\n  constructor(ownerDocument, localName = tagName) {\n    super(ownerDocument, localName);\n  }\n\n  /* c8 ignore start */\n  get src() { return stringAttribute.get(this, 'src'); }\n  set src(value) { stringAttribute.set(this, 'src', value); }\n\n  get srcdoc() { return stringAttribute.get(this, \"srcdoc\"); }\n  set srcdoc(value) { stringAttribute.set(this, \"srcdoc\", value); }\n\n  get name() { return stringAttribute.get(this, \"name\"); }\n  set name(value) { stringAttribute.set(this, \"name\", value); }\n\n  get allow() { return stringAttribute.get(this, \"allow\"); }\n  set allow(value) { stringAttribute.set(this, \"allow\", value); }\n\n  get allowFullscreen() { return booleanAttribute.get(this, \"allowfullscreen\"); }\n  set allowFullscreen(value) { booleanAttribute.set(this, \"allowfullscreen\", value); }\n  \n  get referrerPolicy() { return stringAttribute.get(this, \"referrerpolicy\"); }\n  set referrerPolicy(value) { stringAttribute.set(this, \"referrerpolicy\", value); }\n  \n  get loading() { return stringAttribute.get(this, \"loading\"); }\n  set loading(value) { stringAttribute.set(this, \"loading\", value); }\n  /* c8 ignore stop */\n}\n\nregisterHTMLClass(tagName, HTMLIFrameElement);\n\nexport {HTMLIFrameElement};\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLObjectElement\n */\nexport class HTMLObjectElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'object') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLHeadElement\n */\nexport class HTMLHeadElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'head') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLBodyElement\n */\nexport class HTMLBodyElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'body') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {parse} from 'cssom';\n\nimport {registerHTMLClass} from '../shared/register-html-class.js';\nimport {SHEET} from '../shared/symbols.js';\n\nimport {TextElement} from './text-element.js';\n\nconst tagName = 'style';\n\n/**\n * @implements globalThis.HTMLStyleElement\n */\nclass HTMLStyleElement extends TextElement {\n  constructor(ownerDocument, localName = tagName) {\n    super(ownerDocument, localName);\n    this[SHEET] = null;\n  }\n\n  get sheet() {\n    const sheet = this[SHEET];\n    if (sheet !== null) {\n      return sheet;\n    }\n    return this[SHEET] = parse(this.textContent);\n  }\n\n  get innerHTML() {\n    return super.innerHTML || '';\n  }\n  set innerHTML(value) {\n    super.textContent = value;\n    this[SHEET] = null;\n  }\n  get innerText() {\n    return super.innerText || '';\n  }\n  set innerText(value) {\n    super.textContent = value;\n    this[SHEET] = null;\n  }\n  get textContent() {\n    return super.textContent || '';\n  }\n  set textContent(value) {\n    super.textContent = value;\n    this[SHEET] = null;\n  }\n}\n\nregisterHTMLClass(tagName, HTMLStyleElement);\n\nexport {HTMLStyleElement};\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLTimeElement\n */\nexport class HTMLTimeElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'time') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLFieldSetElement\n */\nexport class HTMLFieldSetElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'fieldset') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLEmbedElement\n */\nexport class HTMLEmbedElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'embed') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLHRElement\n */\nexport class HTMLHRElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'hr') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLProgressElement\n */\nexport class HTMLProgressElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'progress') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLParagraphElement\n */\nexport class HTMLParagraphElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'p') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLTableElement\n */\nexport class HTMLTableElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'table') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLFrameSetElement\n */\nexport class HTMLFrameSetElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'frameset') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLLIElement\n */\nexport class HTMLLIElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'li') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLBaseElement\n */\nexport class HTMLBaseElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'base') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLDataListElement\n */\nexport class HTMLDataListElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'datalist') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {registerHTMLClass} from '../shared/register-html-class.js';\nimport {booleanAttribute, stringAttribute} from '../shared/attributes.js';\n\nimport {HTMLElement} from './element.js';\n\nconst tagName = 'input';\n\n/**\n * @implements globalThis.HTMLInputElement\n */\nclass HTMLInputElement extends HTMLElement {\n  constructor(ownerDocument, localName = tagName) {\n    super(ownerDocument, localName);\n  }\n\n  /* c8 ignore start */\n  get autofocus() { return booleanAttribute.get(this, 'autofocus') || -1; }\n  set autofocus(value) { booleanAttribute.set(this, 'autofocus', value); }\n\n  get disabled() { return booleanAttribute.get(this, 'disabled'); }\n  set disabled(value) { booleanAttribute.set(this, 'disabled', value); }\n\n  get name() { return this.getAttribute('name'); }\n  set name(value) { this.setAttribute('name', value); }\n\n  get placeholder() { return this.getAttribute('placeholder'); }\n  set placeholder(value) { this.setAttribute('placeholder', value); }\n\n  get type() { return this.getAttribute('type'); }\n  set type(value) { this.setAttribute('type', value); }\n\n  get value() { return stringAttribute.get(this, 'value'); }\n  set value(value) { stringAttribute.set(this, 'value', value); }\n  /* c8 ignore stop */\n}\n\nregisterHTMLClass(tagName, HTMLInputElement);\n\nexport {HTMLInputElement};\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLParamElement\n */\nexport class HTMLParamElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'param') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLMediaElement\n */\nexport class HTMLMediaElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'media') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLAudioElement\n */\nexport class HTMLAudioElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'audio') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {registerHTMLClass} from '../shared/register-html-class.js';\n\nimport {HTMLElement} from './element.js';\n\nconst tagName = 'h1';\n\n/**\n * @implements globalThis.HTMLHeadingElement\n */\nclass HTMLHeadingElement extends HTMLElement {\n  constructor(ownerDocument, localName = tagName) {\n    super(ownerDocument, localName);\n  }\n}\n\nregisterHTMLClass([tagName, 'h2', 'h3', 'h4', 'h5', 'h6'], HTMLHeadingElement);\n\nexport {HTMLHeadingElement};\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLDirectoryElement\n */\nexport class HTMLDirectoryElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'dir') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLQuoteElement\n */\nexport class HTMLQuoteElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'quote') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {IMAGE} from '../shared/symbols.js';\n\nimport {registerHTMLClass} from '../shared/register-html-class.js';\nimport {numericAttribute} from '../shared/attributes.js';\n\nimport Canvas from '../../commonjs/canvas.cjs';\n\nimport {HTMLElement} from './element.js';\n\nconst {createCanvas} = Canvas;\n\nconst tagName = 'canvas';\n\n/**\n * @implements globalThis.HTMLCanvasElement\n */\nclass HTMLCanvasElement extends HTMLElement {\n  constructor(ownerDocument, localName = tagName) {\n    super(ownerDocument, localName);\n    this[IMAGE] = createCanvas(300, 150);\n  }\n\n  get width() {\n    return this[IMAGE].width;\n  }\n\n  set width(value) {\n    numericAttribute.set(this, 'width', value);\n    this[IMAGE].width = value;\n  }\n\n  get height() {\n    return this[IMAGE].height;\n  }\n\n  set height(value) {\n    numericAttribute.set(this, 'height', value);\n    this[IMAGE].height = value;\n  }\n\n  getContext(type) {\n    return this[IMAGE].getContext(type);\n  }\n\n  toDataURL(...args) {\n    return this[IMAGE].toDataURL(...args);\n  }\n}\n\nregisterHTMLClass(tagName, HTMLCanvasElement);\n\nexport {HTMLCanvasElement};\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLLegendElement\n */\nexport class HTMLLegendElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'legend') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\nimport {booleanAttribute, stringAttribute} from '../shared/attributes.js';\nimport {registerHTMLClass} from '../shared/register-html-class.js';\n\nconst tagName = 'option';\n\n/**\n * @implements globalThis.HTMLOptionElement\n */\nclass HTMLOptionElement extends HTMLElement {\n  constructor(ownerDocument, localName = tagName) {\n    super(ownerDocument, localName);\n  }\n\n  /* c8 ignore start */\n  get value() { return stringAttribute.get(this, 'value'); }\n  set value(value) { stringAttribute.set(this, 'value', value); }\n  /* c8 ignore stop */\n\n  get selected() { return booleanAttribute.get(this, 'selected'); }\n  set selected(value) {\n    const option = this.parentElement?.querySelector('option[selected]');\n    if (option && option !== this)\n      option.selected = false;\n    booleanAttribute.set(this, 'selected', value);\n  }\n}\n\nregisterHTMLClass(tagName, HTMLOptionElement);\n\nexport {HTMLOptionElement};\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLSpanElement\n */\nexport class HTMLSpanElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'span') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLMeterElement\n */\nexport class HTMLMeterElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'meter') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLVideoElement\n */\nexport class HTMLVideoElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'video') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLTableCellElement\n */\nexport class HTMLTableCellElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'td') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {registerHTMLClass} from '../shared/register-html-class.js';\n\nimport {TextElement} from './text-element.js';\n\nconst tagName = 'title';\n\n/**\n * @implements globalThis.HTMLTitleElement\n */\nclass HTMLTitleElement extends TextElement {\n  constructor(ownerDocument, localName = tagName) {\n    super(ownerDocument, localName);\n  }\n}\n\nregisterHTMLClass(tagName, HTMLTitleElement);\n\nexport {HTMLTitleElement};\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLOutputElement\n */\nexport class HTMLOutputElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'output') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLTableRowElement\n */\nexport class HTMLTableRowElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'tr') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLDataElement\n */\nexport class HTMLDataElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'data') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLMenuElement\n */\nexport class HTMLMenuElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'menu') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {registerHTMLClass} from '../shared/register-html-class.js';\nimport {booleanAttribute} from '../shared/attributes.js';\n\nimport {HTMLElement} from './element.js';\nimport {NodeList} from '../interface/node-list.js';\n\nconst tagName = 'select';\n\n/**\n * @implements globalThis.HTMLSelectElement\n */\nclass HTMLSelectElement extends HTMLElement {\n  constructor(ownerDocument, localName = tagName) {\n    super(ownerDocument, localName);\n  }\n\n  get options() {\n    let children = new NodeList;\n    let {firstElementChild} = this;\n    while (firstElementChild) {\n      if (firstElementChild.tagName === 'OPTGROUP')\n        children.push(...firstElementChild.children);\n      else\n        children.push(firstElementChild);\n      firstElementChild = firstElementChild.nextElementSibling;\n    }\n    return children;\n  }\n\n  /* c8 ignore start */\n  get disabled() { return booleanAttribute.get(this, 'disabled'); }\n  set disabled(value) { booleanAttribute.set(this, 'disabled', value); }\n\n  get name() { return this.getAttribute('name'); }\n  set name(value) { this.setAttribute('name', value); }\n  /* c8 ignore stop */\n\n  get value() { return this.querySelector('option[selected]')?.value; }\n}\n\nregisterHTMLClass(tagName, HTMLSelectElement);\n\nexport {HTMLSelectElement};\n\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLBRElement\n */\nexport class HTMLBRElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'br') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {registerHTMLClass} from '../shared/register-html-class.js';\nimport {booleanAttribute} from '../shared/attributes.js';\n\nimport {HTMLElement} from './element.js';\n\nconst tagName = 'button';\n\n/**\n * @implements globalThis.HTMLButtonElement\n */\nclass HTMLButtonElement extends HTMLElement {\n  constructor(ownerDocument, localName = tagName) {\n    super(ownerDocument, localName);\n  }\n\n  /* c8 ignore start */\n  get disabled() { return booleanAttribute.get(this, 'disabled'); }\n  set disabled(value) { booleanAttribute.set(this, 'disabled', value); }\n\n  get name() { return this.getAttribute('name'); }\n  set name(value) { this.setAttribute('name', value); }\n\n  get type() { return this.getAttribute('type'); }\n  set type(value) { this.setAttribute('type', value); }\n  /* c8 ignore stop */\n}\n\nregisterHTMLClass(tagName, HTMLButtonElement);\n\nexport {HTMLButtonElement};\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLMapElement\n */\nexport class HTMLMapElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'map') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLOptGroupElement\n */\nexport class HTMLOptGroupElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'optgroup') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLDListElement\n */\nexport class HTMLDListElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'dl') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {registerHTMLClass} from '../shared/register-html-class.js';\nimport {booleanAttribute} from '../shared/attributes.js';\n\nimport {TextElement} from './text-element.js';\n\nconst tagName = 'textarea';\n\n/**\n * @implements globalThis.HTMLTextAreaElement\n */\nclass HTMLTextAreaElement extends TextElement {\n  constructor(ownerDocument, localName = tagName) {\n    super(ownerDocument, localName);\n  }\n\n  /* c8 ignore start */\n  get disabled() { return booleanAttribute.get(this, 'disabled'); }\n  set disabled(value) { booleanAttribute.set(this, 'disabled', value); }\n\n  get name() { return this.getAttribute('name'); }\n  set name(value) { this.setAttribute('name', value); }\n\n  get placeholder() { return this.getAttribute('placeholder'); }\n  set placeholder(value) { this.setAttribute('placeholder', value); }\n\n  get type() { return this.getAttribute('type'); }\n  set type(value) { this.setAttribute('type', value); }\n\n  get value() { return this.textContent; }\n  set value(content) { this.textContent = content; }\n  /* c8 ignore stop */\n}\n\nregisterHTMLClass(tagName, HTMLTextAreaElement);\n\nexport {HTMLTextAreaElement};\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLFontElement\n */\nexport class HTMLFontElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'font') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLDivElement\n */\nexport class HTMLDivElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'div') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {registerHTMLClass} from '../shared/register-html-class.js';\nimport {booleanAttribute, stringAttribute} from '../shared/attributes.js';\n\nimport {HTMLElement} from './element.js';\n\nconst tagName = 'link';\n\n/**\n * @implements globalThis.HTMLLinkElement\n */\nclass HTMLLinkElement extends HTMLElement {\n  constructor(ownerDocument, localName = tagName) {\n    super(ownerDocument, localName);\n  }\n\n  /* c8 ignore start */ // copy paste from img.src, already covered\n  get disabled() { return booleanAttribute.get(this, 'disabled'); }\n  set disabled(value) { booleanAttribute.set(this, 'disabled', value); }\n\n  get href() { return stringAttribute.get(this, 'href'); }\n  set href(value) { stringAttribute.set(this, 'href', value); }\n\n  get hreflang() { return stringAttribute.get(this, 'hreflang'); }\n  set hreflang(value) { stringAttribute.set(this, 'hreflang', value); }\n\n  get media() { return stringAttribute.get(this, 'media'); }\n  set media(value) { stringAttribute.set(this, 'media', value); }\n\n  get rel() { return stringAttribute.get(this, 'rel'); }\n  set rel(value) { stringAttribute.set(this, 'rel', value); }\n\n  get type() { return stringAttribute.get(this, 'type'); }\n  set type(value) { stringAttribute.set(this, 'type', value); }\n  /* c8 ignore stop */\n\n}\n\nregisterHTMLClass(tagName, HTMLLinkElement);\n\nexport {HTMLLinkElement};\n", "import {HTMLElement} from './element.js';\nimport {registerHTMLClass} from '../shared/register-html-class.js';\n\nconst tagName = 'slot';\n\n/**\n * @implements globalThis.HTMLSlotElement\n */\nclass HTMLSlotElement extends HTMLElement {\n  constructor(ownerDocument, localName = tagName) {\n    super(ownerDocument, localName);\n  }\n\n  /* c8 ignore start */\n  get name() { return this.getAttribute('name'); }\n  set name(value) { this.setAttribute('name', value); }\n\n  assign() {}\n\n  assignedNodes(options) {\n    const isNamedSlot = !!this.name;\n    const hostChildNodes = this.getRootNode().host?.childNodes ?? [];\n    let slottables;\n\n    if (isNamedSlot) {\n      slottables = [...hostChildNodes].filter(node => node.slot === this.name);\n    } else {\n      slottables = [...hostChildNodes].filter(node => !node.slot);\n    }\n\n    if (options?.flatten) {\n      const result = [];\n\n      // Element and Text nodes are slottables. A slot can be a slottable.\n      for (let slottable of slottables) {\n        if (slottable.localName === 'slot') {\n          result.push(...slottable.assignedNodes({ flatten: true }));\n        } else {\n          result.push(slottable);\n        }\n      }\n\n      slottables = result;\n    }\n\n    // If no assigned nodes are found, it returns the slot's fallback content.\n    return slottables.length ? slottables : [...this.childNodes];\n  }\n\n  assignedElements(options) {\n    const slottables = this.assignedNodes(options).filter(n => n.nodeType === 1);\n\n    // If no assigned elements are found, it returns the slot's fallback content.\n    return slottables.length ? slottables : [...this.children];\n  }\n  /* c8 ignore stop */\n}\n\nregisterHTMLClass(tagName, HTMLSlotElement);\n\nexport {HTMLSlotElement};\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLFormElement\n */\nexport class HTMLFormElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'form') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {registerHTMLClass} from '../shared/register-html-class.js';\nimport {numericAttribute, stringAttribute} from '../shared/attributes.js';\n\nimport {HTMLElement} from './element.js';\n\nconst tagName = 'img';\n\n/**\n * @implements globalThis.HTMLImageElement\n */\nclass HTMLImageElement extends HTMLElement {\n  constructor(ownerDocument, localName = tagName) {\n    super(ownerDocument, localName);\n  }\n\n  /* c8 ignore start */\n  get alt() { return stringAttribute.get(this, 'alt'); }\n  set alt(value) { stringAttribute.set(this, 'alt', value); }\n\n  get sizes() { return stringAttribute.get(this, 'sizes'); }\n  set sizes(value) { stringAttribute.set(this, 'sizes', value); }\n\n  get src() { return stringAttribute.get(this, 'src'); }\n  set src(value) { stringAttribute.set(this, 'src', value); }\n\n  get srcset() { return stringAttribute.get(this, 'srcset'); }\n  set srcset(value) { stringAttribute.set(this, 'srcset', value); }\n\n  get title() { return stringAttribute.get(this, 'title'); }\n  set title(value) { stringAttribute.set(this, 'title', value); }\n\n  get width() { return numericAttribute.get(this, 'width'); }\n  set width(value) { numericAttribute.set(this, 'width', value); }\n\n  get height() { return numericAttribute.get(this, 'height'); }\n  set height(value) { numericAttribute.set(this, 'height', value); }\n  /* c8 ignore stop */\n}\n\nregisterHTMLClass(tagName, HTMLImageElement);\n\nexport {HTMLImageElement};\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLPreElement\n */\nexport class HTMLPreElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'pre') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLUListElement\n */\nexport class HTMLUListElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'ul') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\nimport {registerHTMLClass} from '../shared/register-html-class.js';\nimport { stringAttribute } from '../shared/attributes.js';\n\nconst tagName = 'meta'\n/**\n * @implements globalThis.HTMLMetaElement\n */\nexport class HTMLMetaElement extends HTMLElement {\n  constructor(ownerDocument, localName =tagName) {\n    super(ownerDocument, localName);\n  }\n\n  /* c8 ignore start */\n  get name() { return stringAttribute.get(this, 'name'); }\n  set name(value) { stringAttribute.set(this, 'name', value); }\n\n  get httpEquiv() { return stringAttribute.get(this, 'http-equiv'); }\n  set httpEquiv(value) { stringAttribute.set(this, 'http-equiv', value); }\n\n  get content() { return stringAttribute.get(this, 'content'); }\n  set content(value) { stringAttribute.set(this, 'content', value); }\n\n  get charset() { return stringAttribute.get(this, 'charset'); }\n  set charset(value) { stringAttribute.set(this, 'charset', value); }\n\n  get media() { return stringAttribute.get(this, 'media'); }\n  set media(value) { stringAttribute.set(this, 'media', value); }\n  /* c8 ignore stop */\n\n}\n\nregisterHTMLClass(tagName, HTMLMetaElement);\n\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLPictureElement\n */\nexport class HTMLPictureElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'picture') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLAreaElement\n */\nexport class HTMLAreaElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'area') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLOListElement\n */\nexport class HTMLOListElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'ol') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLTableCaptionElement\n */\nexport class HTMLTableCaptionElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'caption') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {registerHTMLClass} from '../shared/register-html-class.js';\nimport {stringAttribute} from '../shared/attributes.js';\n\nimport {HTMLElement} from './element.js';\n\nconst tagName = 'a';\n\n/**\n * @implements globalThis.HTMLAnchorElement\n */\nclass HTMLAnchorElement extends HTMLElement {\n  constructor(ownerDocument, localName = tagName) {\n    super(ownerDocument, localName);\n  }\n\n  /* c8 ignore start */ // copy paste from img.src, already covered\n  get href() { return encodeURI(decodeURI(stringAttribute.get(this, 'href'))); }\n  set href(value) { stringAttribute.set(this, 'href', decodeURI(value)); }\n\n  get download() { return encodeURI(decodeURI(stringAttribute.get(this, 'download'))); }\n  set download(value) { stringAttribute.set(this, 'download', decodeURI(value)); }\n\n  get target() { return stringAttribute.get(this, 'target'); }\n  set target(value) { stringAttribute.set(this, 'target', value); }\n\n  get type() { return stringAttribute.get(this, 'type'); }\n  set type(value) { stringAttribute.set(this, 'type', value); }\n  /* c8 ignore stop */\n\n}\n\nregisterHTMLClass(tagName, HTMLAnchorElement);\n\nexport {HTMLAnchorElement};\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLLabelElement\n */\nexport class HTMLLabelElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'label') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLUnknownElement\n */\nexport class HTMLUnknownElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'unknown') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLModElement\n */\nexport class HTMLModElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'mod') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLDetailsElement\n */\nexport class HTMLDetailsElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'details') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {registerHTMLClass} from '../shared/register-html-class.js';\nimport {stringAttribute} from '../shared/attributes.js';\n\nimport {HTMLElement} from './element.js';\n\nconst tagName = 'source';\n\n/**\n * @implements globalThis.HTMLSourceElement\n */\nclass HTMLSourceElement extends HTMLElement {\n  constructor(ownerDocument, localName = tagName) {\n    super(ownerDocument, localName);\n  }\n\n  /* c8 ignore start */\n  get src() { return stringAttribute.get(this, 'src'); }\n  set src(value) { stringAttribute.set(this, 'src', value); }\n\n  get srcset() { return stringAttribute.get(this, 'srcset'); }\n  set srcset(value) { stringAttribute.set(this, 'srcset', value); }\n\n  get sizes() { return stringAttribute.get(this, 'sizes'); }\n  set sizes(value) { stringAttribute.set(this, 'sizes', value); }\n\n  get type() { return stringAttribute.get(this, 'type'); }\n  set type(value) { stringAttribute.set(this, 'type', value); }\n  /* c8 ignore stop */\n}\n\nregisterHTMLClass(tagName, HTMLSourceElement);\n\nexport {HTMLSourceElement};\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLTrackElement\n */\nexport class HTMLTrackElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'track') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from './element.js';\n\n/**\n * @implements globalThis.HTMLMarqueeElement\n */\nexport class HTMLMarqueeElement extends HTMLElement {\n  constructor(ownerDocument, localName = 'marquee') {\n    super(ownerDocument, localName);\n  }\n}\n", "import {HTMLElement} from '../html/element.js';\nimport {HTMLTemplateElement} from '../html/template-element.js';\nimport {HTMLHtmlElement} from '../html/html-element.js';\nimport {HTMLScriptElement} from '../html/script-element.js';\nimport {HTMLFrameElement} from '../html/frame-element.js';\nimport {HTMLIFrameElement} from '../html/i-frame-element.js';\nimport {HTMLObjectElement} from '../html/object-element.js';\nimport {HTMLHeadElement} from '../html/head-element.js';\nimport {HTMLBodyElement} from '../html/body-element.js';\nimport {HTMLStyleElement} from '../html/style-element.js';\nimport {HTMLTimeElement} from '../html/time-element.js';\nimport {HTMLFieldSetElement} from '../html/field-set-element.js';\nimport {HTMLEmbedElement} from '../html/embed-element.js';\nimport {HTMLHRElement} from '../html/hr-element.js';\nimport {HTMLProgressElement} from '../html/progress-element.js';\nimport {HTMLParagraphElement} from '../html/paragraph-element.js';\nimport {HTMLTableElement} from '../html/table-element.js';\nimport {HTMLFrameSetElement} from '../html/frame-set-element.js';\nimport {HTMLLIElement} from '../html/li-element.js';\nimport {HTMLBaseElement} from '../html/base-element.js';\nimport {HTMLDataListElement} from '../html/data-list-element.js';\nimport {HTMLInputElement} from '../html/input-element.js';\nimport {HTMLParamElement} from '../html/param-element.js';\nimport {HTMLMediaElement} from '../html/media-element.js';\nimport {HTMLAudioElement} from '../html/audio-element.js';\nimport {HTMLHeadingElement} from '../html/heading-element.js';\nimport {HTMLDirectoryElement} from '../html/directory-element.js';\nimport {HTMLQuoteElement} from '../html/quote-element.js';\nimport {HTMLCanvasElement} from '../html/canvas-element.js';\nimport {HTMLLegendElement} from '../html/legend-element.js';\nimport {HTMLOptionElement} from '../html/option-element.js';\nimport {HTMLSpanElement} from '../html/span-element.js';\nimport {HTMLMeterElement} from '../html/meter-element.js';\nimport {HTMLVideoElement} from '../html/video-element.js';\nimport {HTMLTableCellElement} from '../html/table-cell-element.js';\nimport {HTMLTitleElement} from '../html/title-element.js';\nimport {HTMLOutputElement} from '../html/output-element.js';\nimport {HTMLTableRowElement} from '../html/table-row-element.js';\nimport {HTMLDataElement} from '../html/data-element.js';\nimport {HTMLMenuElement} from '../html/menu-element.js';\nimport {HTMLSelectElement} from '../html/select-element.js';\nimport {HTMLBRElement} from '../html/br-element.js';\nimport {HTMLButtonElement} from '../html/button-element.js';\nimport {HTMLMapElement} from '../html/map-element.js';\nimport {HTMLOptGroupElement} from '../html/opt-group-element.js';\nimport {HTMLDListElement} from '../html/d-list-element.js';\nimport {HTMLTextAreaElement} from '../html/text-area-element.js';\nimport {HTMLFontElement} from '../html/font-element.js';\nimport {HTMLDivElement} from '../html/div-element.js';\nimport {HTMLLinkElement} from '../html/link-element.js';\nimport {HTMLSlotElement} from '../html/slot-element.js';\nimport {HTMLFormElement} from '../html/form-element.js';\nimport {HTMLImageElement} from '../html/image-element.js';\nimport {HTMLPreElement} from '../html/pre-element.js';\nimport {HTMLUListElement} from '../html/u-list-element.js';\nimport {HTMLMetaElement} from '../html/meta-element.js';\nimport {HTMLPictureElement} from '../html/picture-element.js';\nimport {HTMLAreaElement} from '../html/area-element.js';\nimport {HTMLOListElement} from '../html/o-list-element.js';\nimport {HTMLTableCaptionElement} from '../html/table-caption-element.js';\nimport {HTMLAnchorElement} from '../html/anchor-element.js';\nimport {HTMLLabelElement} from '../html/label-element.js';\nimport {HTMLUnknownElement} from '../html/unknown-element.js';\nimport {HTMLModElement} from '../html/mod-element.js';\nimport {HTMLDetailsElement} from '../html/details-element.js';\nimport {HTMLSourceElement} from '../html/source-element.js';\nimport {HTMLTrackElement} from '../html/track-element.js';\nimport {HTMLMarqueeElement} from '../html/marquee-element.js';\n\nexport {\n  HTMLElement,\n  HTMLTemplateElement,\n  HTMLHtmlElement,\n  HTMLScriptElement,\n  HTMLFrameElement,\n  HTMLIFrameElement,\n  HTMLObjectElement,\n  HTMLHeadElement,\n  HTMLBodyElement,\n  HTMLStyleElement,\n  HTMLTimeElement,\n  HTMLFieldSetElement,\n  HTMLEmbedElement,\n  HTMLHRElement,\n  HTMLProgressElement,\n  HTMLParagraphElement,\n  HTMLTableElement,\n  HTMLFrameSetElement,\n  HTMLLIElement,\n  HTMLBaseElement,\n  HTMLDataListElement,\n  HTMLInputElement,\n  HTMLParamElement,\n  HTMLMediaElement,\n  HTMLAudioElement,\n  HTMLHeadingElement,\n  HTMLDirectoryElement,\n  HTMLQuoteElement,\n  HTMLCanvasElement,\n  HTMLLegendElement,\n  HTMLOptionElement,\n  HTMLSpanElement,\n  HTMLMeterElement,\n  HTMLVideoElement,\n  HTMLTableCellElement,\n  HTMLTitleElement,\n  HTMLOutputElement,\n  HTMLTableRowElement,\n  HTMLDataElement,\n  HTMLMenuElement,\n  HTMLSelectElement,\n  HTMLBRElement,\n  HTMLButtonElement,\n  HTMLMapElement,\n  HTMLOptGroupElement,\n  HTMLDListElement,\n  HTMLTextAreaElement,\n  HTMLFontElement,\n  HTMLDivElement,\n  HTMLLinkElement,\n  HTMLSlotElement,\n  HTMLFormElement,\n  HTMLImageElement,\n  HTMLPreElement,\n  HTMLUListElement,\n  HTMLMetaElement,\n  HTMLPictureElement,\n  HTMLAreaElement,\n  HTMLOListElement,\n  HTMLTableCaptionElement,\n  HTMLAnchorElement,\n  HTMLLabelElement,\n  HTMLUnknownElement,\n  HTMLModElement,\n  HTMLDetailsElement,\n  HTMLSourceElement,\n  HTMLTrackElement,\n  HTMLMarqueeElement\n};\n\nexport const HTMLClasses = {\n  HTMLElement,\n  HTMLTemplateElement,\n  HTMLHtmlElement,\n  HTMLScriptElement,\n  HTMLFrameElement,\n  HTMLIFrameElement,\n  HTMLObjectElement,\n  HTMLHeadElement,\n  HTMLBodyElement,\n  HTMLStyleElement,\n  HTMLTimeElement,\n  HTMLFieldSetElement,\n  HTMLEmbedElement,\n  HTMLHRElement,\n  HTMLProgressElement,\n  HTMLParagraphElement,\n  HTMLTableElement,\n  HTMLFrameSetElement,\n  HTMLLIElement,\n  HTMLBaseElement,\n  HTMLDataListElement,\n  HTMLInputElement,\n  HTMLParamElement,\n  HTMLMediaElement,\n  HTMLAudioElement,\n  HTMLHeadingElement,\n  HTMLDirectoryElement,\n  HTMLQuoteElement,\n  HTMLCanvasElement,\n  HTMLLegendElement,\n  HTMLOptionElement,\n  HTMLSpanElement,\n  HTMLMeterElement,\n  HTMLVideoElement,\n  HTMLTableCellElement,\n  HTMLTitleElement,\n  HTMLOutputElement,\n  HTMLTableRowElement,\n  HTMLDataElement,\n  HTMLMenuElement,\n  HTMLSelectElement,\n  HTMLBRElement,\n  HTMLButtonElement,\n  HTMLMapElement,\n  HTMLOptGroupElement,\n  HTMLDListElement,\n  HTMLTextAreaElement,\n  HTMLFontElement,\n  HTMLDivElement,\n  HTMLLinkElement,\n  HTMLSlotElement,\n  HTMLFormElement,\n  HTMLImageElement,\n  HTMLPreElement,\n  HTMLUListElement,\n  HTMLMetaElement,\n  HTMLPictureElement,\n  HTMLAreaElement,\n  HTMLOListElement,\n  HTMLTableCaptionElement,\n  HTMLAnchorElement,\n  HTMLLabelElement,\n  HTMLUnknownElement,\n  HTMLModElement,\n  HTMLDetailsElement,\n  HTMLSourceElement,\n  HTMLTrackElement,\n  HTMLMarqueeElement\n};\n", "// TODO: ensure all these are text only\n// /^(?:plaintext|script|style|textarea|title|xmp)$/i\n\nconst voidElements = {test: () => true};\nexport const Mime = {\n  'text/html': {\n    docType: '<!DOCTYPE html>',\n    ignoreCase: true,\n    voidElements: /^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i\n  },\n  'image/svg+xml': {\n    docType: '<?xml version=\"1.0\" encoding=\"utf-8\"?>',\n    ignoreCase: false,\n    voidElements\n  },\n  'text/xml': {\n    docType: '<?xml version=\"1.0\" encoding=\"utf-8\"?>',\n    ignoreCase: false,\n    voidElements\n  },\n  'application/xml': {\n    docType: '<?xml version=\"1.0\" encoding=\"utf-8\"?>',\n    ignoreCase: false,\n    voidElements\n  },\n  'application/xhtml+xml': {\n    docType: '<?xml version=\"1.0\" encoding=\"utf-8\"?>',\n    ignoreCase: false,\n    voidElements\n  }\n};\n", "// https://dom.spec.whatwg.org/#interface-customevent\n\n/* c8 ignore start */\n\n// One day Node might have CustomEvent too\n\nimport {Event} from './event.js';\n\n/**\n * @implements globalThis.CustomEvent\n */\nexport class CustomEvent extends Event {\n  constructor(type, eventInitDict = {}) {\n    super(type, eventInitDict);\n    this.detail = eventInitDict.detail;\n  }\n}\n\n/* c8 ignore stop */\n", "// https://dom.spec.whatwg.org/#interface-customevent\n\n/* c8 ignore start */\n\n// One day Node might have CustomEvent too\n\nimport {Event} from './event.js';\n\n/**\n * @implements globalThis.InputEvent\n */\nexport class InputEvent extends Event {\n  constructor(type, inputEventInit = {}) {\n    super(type, inputEventInit);\n    this.inputType = inputEventInit.inputType;\n    this.data = inputEventInit.data;\n    this.dataTransfer = inputEventInit.dataTransfer;\n    this.isComposing = inputEventInit.isComposing || false;\n    this.ranges = inputEventInit.ranges;\n  }\n}\n/* c8 ignore stop */\n", "import {HTMLImageElement} from '../html/image-element.js';\n\nexport const ImageClass = ownerDocument =>\n/**\n * @implements globalThis.Image\n */\nclass Image extends HTMLImageElement {\n  constructor(width, height) {\n    super(ownerDocument);\n    switch (arguments.length) {\n      case 1:\n        this.height = width;\n        this.width = width;\n        break;\n      case 2:\n        this.height = height;\n        this.width = width;\n        break;\n    }\n  }\n};\n", "// https://dom.spec.whatwg.org/#concept-live-range\n\nimport {END, NEXT, PREV, START} from '../shared/symbols.js';\n\nimport {SVGElement} from '../svg/element.js';\n\nimport {getEnd, setAdjacent} from '../shared/utils.js';\n\nconst deleteContents = ({[START]: start, [END]: end}, fragment = null) => {\n  setAdjacent(start[PREV], end[NEXT]);\n  do {\n    const after = getEnd(start);\n    const next = after === end ? after : after[NEXT];\n    if (fragment)\n      fragment.insertBefore(start, fragment[END]);\n    else\n      start.remove();\n    start = next;\n  } while (start !== end);\n};\n\n/**\n * @implements globalThis.Range\n */\nexport class Range {\n  constructor() {\n    this[START] = null;\n    this[END] = null;\n    this.commonAncestorContainer = null;\n  }\n\n  /* TODO: this is more complicated than it looks\n  setStart(node, offset) {\n    this[START] = node.childNodes[offset];\n  }\n\n  setEnd(node, offset) {\n    this[END] = getEnd(node.childNodes[offset]);\n  }\n  //*/\n\n  insertNode(newNode) {\n    this[END].parentNode.insertBefore(newNode, this[START]);\n  }\n\n  selectNode(node) {\n    this[START] = node;\n    this[END] = getEnd(node);\n  }\n\n  // TODO: SVG elements should then create contextual fragments\n  //       that return SVG nodes\n  selectNodeContents(node) {\n    this.selectNode(node);\n    this.commonAncestorContainer = node;\n  }\n\n  surroundContents(parentNode) {\n    parentNode.replaceChildren(this.extractContents());\n  }\n\n  setStartBefore(node) {\n    this[START] = node;\n  }\n\n  setStartAfter(node) {\n    this[START] = node.nextSibling;\n  }\n\n  setEndBefore(node) {\n    this[END] = getEnd(node.previousSibling);\n  }\n\n  setEndAfter(node) {\n    this[END] = getEnd(node);\n  }\n\n  cloneContents() {\n    let {[START]: start, [END]: end} = this;\n    const fragment = start.ownerDocument.createDocumentFragment();\n    while (start !== end) {\n      fragment.insertBefore(start.cloneNode(true), fragment[END]);\n      start = getEnd(start);\n      if (start !== end)\n        start = start[NEXT];\n    }\n    return fragment;\n  }\n\n  deleteContents() {\n    deleteContents(this);\n  }\n\n  extractContents() {\n    const fragment = this[START].ownerDocument.createDocumentFragment();\n    deleteContents(this, fragment);\n    return fragment;\n  }\n\n  createContextualFragment(html) {\n    const { commonAncestorContainer: doc } = this;\n    const isSVG = 'ownerSVGElement' in doc;\n    const document = isSVG ? doc.ownerDocument : doc;\n    const template = document.createElement('template');\n    template.innerHTML = html;\n    let {content} = template;\n    if (isSVG) {\n      const childNodes = [...content.childNodes];\n      content = document.createDocumentFragment();\n      Object.setPrototypeOf(content, SVGElement.prototype);\n      content.ownerSVGElement = document;\n      for (const child of childNodes) {\n        Object.setPrototypeOf(child, SVGElement.prototype);\n        child.ownerSVGElement = document;\n        content.appendChild(child);\n      }\n    }\n    else\n      this.selectNode(content);\n    return content;\n  }\n\n  cloneRange() {\n    const range = new Range;\n    range[START] = this[START];\n    range[END] = this[END];\n    return range;\n  }\n}\n", "import {\n  DOCUMENT_NODE,\n  ELEMENT_NODE,\n  TEXT_NODE,\n  CDATA_SECTION_NODE,\n  COMMENT_NODE,\n  SHOW_ALL,\n  SHOW_ELEMENT,\n  SHOW_CDATA_SECTION,\n  SHOW_COMMENT,\n  SHOW_TEXT\n} from '../shared/constants.js';\n\nimport {PRIVATE, END, NEXT} from '../shared/symbols.js';\n\nconst isOK = ({nodeType}, mask) => {\n  switch (nodeType) {\n    case ELEMENT_NODE:\n      return mask & SHOW_ELEMENT;\n    case TEXT_NODE:\n      return mask & SHOW_TEXT;\n    case COMMENT_NODE:\n      return mask & SHOW_COMMENT;\n    case CDATA_SECTION_NODE:\n      return mask & SHOW_CDATA_SECTION;\n  }\n  return 0;\n};\n\n/**\n * @implements globalThis.TreeWalker\n */\nexport class TreeWalker {\n  constructor(root, whatToShow = SHOW_ALL) {\n    this.root = root;\n    this.currentNode = root;\n    this.whatToShow = whatToShow;\n    let {[NEXT]: next, [END]: end} = root;\n    if (root.nodeType === DOCUMENT_NODE) {\n      const {documentElement} = root;\n      next = documentElement;\n      end = documentElement[END];\n    }\n    const nodes = [];\n    while (next !== end) {\n      if (isOK(next, whatToShow))\n        nodes.push(next);\n      next = next[NEXT];\n    }\n    this[PRIVATE] = {i: 0, nodes};\n  }\n\n  nextNode() {\n    const $ = this[PRIVATE];\n    this.currentNode = $.i < $.nodes.length ? $.nodes[$.i++] : null;\n    return this.currentNode;\n  }\n}\n", "import {ELEMENT_NODE} from '../shared/constants.js';\nimport {CUSTOM_ELEMENTS, END, NEXT} from '../shared/symbols.js';\nimport {htmlClasses} from '../shared/register-html-class.js';\n\nimport {Document} from '../interface/document.js';\nimport {NodeList} from '../interface/node-list.js';\nimport {customElements} from '../interface/custom-element-registry.js';\n\nimport {HTMLElement} from './element.js';\n\nconst createHTMLElement = (ownerDocument, builtin, localName, options) => {\n  if (!builtin && htmlClasses.has(localName)) {\n    const Class = htmlClasses.get(localName);\n    return new Class(ownerDocument, localName);\n  }\n  const {[CUSTOM_ELEMENTS]: {active, registry}} = ownerDocument;\n  if (active) {\n    const ce = builtin ? options.is : localName;\n    if (registry.has(ce)) {\n      const {Class} = registry.get(ce);\n      const element = new Class(ownerDocument, localName);\n      customElements.set(element, {connected: false});\n      return element;\n    }\n  }\n  return new HTMLElement(ownerDocument, localName);\n};\n\n/**\n * @implements globalThis.HTMLDocument\n */\nexport class HTMLDocument extends Document {\n  constructor() { super('text/html'); }\n\n  get all() {\n    const nodeList = new NodeList;\n    let {[NEXT]: next, [END]: end} = this;\n    while (next !== end) {\n      switch (next.nodeType) {\n        case ELEMENT_NODE:\n          nodeList.push(next);\n          break;\n      }\n      next = next[NEXT];\n    }\n    return nodeList;\n  }\n\n  /**\n   * @type HTMLHeadElement\n   */\n  get head() {\n    const {documentElement} = this;\n    let {firstElementChild} = documentElement;\n    if (!firstElementChild || firstElementChild.tagName !== 'HEAD') {\n      firstElementChild = this.createElement('head');\n      documentElement.prepend(firstElementChild);\n    }\n    return firstElementChild;\n  }\n\n  /**\n   * @type HTMLBodyElement\n   */\n  get body() {\n    const {head} = this;\n    let {nextElementSibling} = head;\n    if (!nextElementSibling || nextElementSibling.tagName !== 'BODY') {\n      nextElementSibling = this.createElement('body');\n      head.after(nextElementSibling);\n    }\n    return nextElementSibling;\n  }\n\n  /**\n   * @type HTMLTitleElement\n   */\n  get title() {\n    const {head} = this;\n    return head.getElementsByTagName('title').at(0)?.textContent || '';\n  }\n\n  set title(textContent) {\n    const {head} = this;\n    let title = head.getElementsByTagName('title').at(0);\n    if (title)\n      title.textContent = textContent;\n    else {\n      head.insertBefore(\n        this.createElement('title'),\n        head.firstChild\n      ).textContent = textContent;\n    }\n  }\n\n  createElement(localName, options) {\n    const builtin = !!(options && options.is);\n    const element = createHTMLElement(this, builtin, localName, options);\n    if (builtin)\n      element.setAttribute('is', options.is);\n    return element;\n  }\n}\n", "import {MIME} from '../shared/symbols.js';\nimport {Document} from '../interface/document.js';\n\n/**\n * @implements globalThis.Document\n */\nexport class SVGDocument extends Document {\n  constructor() { super('image/svg+xml'); }\n  toString() {\n    return this[MIME].docType + super.toString();\n  }\n}\n", "import {MIME} from '../shared/symbols.js';\nimport {Document} from '../interface/document.js';\n\n/**\n * @implements globalThis.XMLDocument\n */\nexport class XMLDocument extends Document {\n  constructor() { super('text/xml'); }\n  toString() {\n    return this[MIME].docType + super.toString();\n  }\n}\n", "import {DOM_PARSER, GLOBALS} from '../shared/symbols.js';\nimport {parseFromString} from '../shared/parse-from-string.js';\n\nimport {HTMLDocument} from '../html/document.js';\nimport {SVGDocument} from '../svg/document.js';\nimport {XMLDocument} from '../xml/document.js';\n\n/**\n * @implements globalThis.DOMParser\n */\nexport class DOMParser {\n\n  /** @typedef {{ \"text/html\": HTMLDocument, \"image/svg+xml\": SVGDocument, \"text/xml\": XMLDocument }} MimeToDoc */\n  /**\n   * @template {keyof MimeToDoc} MIME\n   * @param {string} markupLanguage\n   * @param {MIME} mimeType\n   * @returns {MimeToDoc[MIME]}\n   */\n  parseFromString(markupLanguage, mimeType, globals = null) {\n    let isHTML = false, document;\n    if (mimeType === 'text/html') {\n      isHTML = true;\n      document = new HTMLDocument;\n    }\n    else if (mimeType === 'image/svg+xml')\n      document = new SVGDocument;\n    else\n      document = new XMLDocument;\n    document[DOM_PARSER] = DOMParser;\n    if (globals)\n      document[GLOBALS] = globals;\n    if (isHTML && markupLanguage === '...')\n      markupLanguage = '<!doctype html><html><head></head><body></body></html>';\n    return markupLanguage ?\n            parseFromString(document, isHTML, markupLanguage) :\n            document;\n  }\n}\n", "import {\n  NODE_END,\n  ELEMENT_NODE,\n  ATTRIBUTE_NODE,\n  TEXT_NODE,\n  CDATA_SECTION_NODE,\n  COMMENT_NODE,\n  DOCUMENT_NODE,\n  DOCUMENT_TYPE_NODE,\n  DOCUMENT_FRAGMENT_NODE\n} from './constants.js';\n\nimport {END, PREV} from './symbols.js';\n\nimport {htmlClasses} from './register-html-class.js';\nimport {knownBoundaries, knownSiblings} from './utils.js';\n\nimport {Attr} from '../interface/attr.js';\nimport {CDATASection} from '../interface/cdata-section.js';\nimport {Comment} from '../interface/comment.js';\nimport {DocumentType} from '../interface/document-type.js';\nimport {Text} from '../interface/text.js';\n\nimport {HTMLDocument} from '../html/document.js';\nimport {HTMLElement} from '../html/element.js';\nimport {SVGElement} from '../svg/element.js';\n\nconst {parse} = JSON;\n\nconst append = (parentNode, node, end) => {\n  node.parentNode = parentNode;\n  knownSiblings(end[PREV], node, end);\n};\n\nconst createHTMLElement = (ownerDocument, localName) => {\n  if (htmlClasses.has(localName)) {\n    const Class = htmlClasses.get(localName);\n    return new Class(ownerDocument, localName);\n  }\n  return new HTMLElement(ownerDocument, localName);\n};\n\n/**\n * @typedef {number|string} jsdonValue - either a node type or its content\n */\n\n/**\n * Given a stringified, or arrayfied DOM element, returns an HTMLDocument\n * that represent the content of such string, or array.\n * @param {string|jsdonValue[]} value\n * @returns {HTMLDocument}\n */\nexport const parseJSON = value => {\n  const array = typeof value === 'string' ? parse(value) : value;\n  const {length} = array;\n  const document = new HTMLDocument;\n  let parentNode = document, end = parentNode[END], svg = false, i = 0;\n  while (i < length) {\n    let nodeType = array[i++];\n    switch (nodeType) {\n      case ELEMENT_NODE: {\n        const localName = array[i++];\n        const isSVG = svg || localName === 'svg' || localName === 'SVG';\n        const element = isSVG ?\n                          new SVGElement(document, localName, parentNode.ownerSVGElement || null) :\n                          createHTMLElement(document, localName);\n        knownBoundaries(end[PREV], element, end);\n        element.parentNode = parentNode;\n        parentNode = element;\n        end = parentNode[END];\n        svg = isSVG;\n        break;\n      }\n      case ATTRIBUTE_NODE: {\n        const name = array[i++];\n        const value = typeof array[i] === 'string' ? array[i++] : '';\n        const attr = new Attr(document, name, value);\n        attr.ownerElement = parentNode;\n        knownSiblings(end[PREV], attr, end);\n        break;\n      }\n      case TEXT_NODE:\n        append(parentNode, new Text(document, array[i++]), end);\n        break;\n      case COMMENT_NODE:\n        append(parentNode, new Comment(document, array[i++]), end);\n        break;\n      case CDATA_SECTION_NODE:\n        append(parentNode, new CDATASection(document, array[i++]), end);\n        break;\n      case DOCUMENT_TYPE_NODE: {\n        const args = [document];\n        while (typeof array[i] === 'string')\n          args.push(array[i++]);\n        if (args.length === 3 && /\\.dtd$/i.test(args[2]))\n          args.splice(2, 0, '');\n        append(parentNode, new DocumentType(...args), end);\n        break;\n      }\n      case DOCUMENT_FRAGMENT_NODE:\n        parentNode = document.createDocumentFragment();\n        end = parentNode[END];\n      /* eslint no-fallthrough:0 */\n      case DOCUMENT_NODE:\n        break;\n      default:\n        do {\n          nodeType -= NODE_END;\n          if (svg && !parentNode.ownerSVGElement)\n            svg = false;\n          parentNode = parentNode.parentNode || parentNode;\n        } while (nodeType < 0);\n        end = parentNode[END];\n        break;\n    }\n  }\n  switch (i && array[0]) {\n    case ELEMENT_NODE:\n      return document.firstElementChild;\n    case DOCUMENT_FRAGMENT_NODE:\n      return parentNode;\n  }\n  return document;\n};\n\n/**\n * \n * @param {Document|Element} node the Document or Element to serialize\n * @returns {jsdonValue[]} the linear jsdon serialized array\n */\nexport const toJSON = node => node.toJSON();\n", "import {DOMParser} from './dom/parser.js';\nimport {Document as _Document} from './interface/document.js';\n\nimport {illegalConstructor} from './shared/facades.js';\nimport {setPrototypeOf} from './shared/object.js';\nexport {parseJSON, toJSON} from './shared/parse-json.js';\n\nexport * from './shared/facades.js';\nexport * from './shared/html-classes.js';\n\nexport {DOMParser};\n\nexport {CustomEvent} from './interface/custom-event.js';\nexport {Event} from './interface/event.js';\nexport {EventTarget} from './interface/event-target.js';\nexport {InputEvent} from './interface/input-event.js';\nexport {NodeList} from './interface/node-list.js';\nexport {NodeFilter} from './interface/node-filter.js';\n\nexport const parseHTML = (html, globals = null) => (new DOMParser).parseFromString(\n  html, 'text/html', globals\n).defaultView;\n\nexport function Document() {\n  illegalConstructor();\n}\n\nsetPrototypeOf(Document, _Document).prototype = _Document.prototype;\n", "// src/html-to-pdf.ts\r\n\r\nimport { parseHTML } from \"linkedom\";\r\nimport path from \"node:path\";\nimport { fileURLToPath, pathToFileURL } from \"node:url\";\nimport { type FontConfig } from \"./types/fonts.js\";\r\nimport { configureDebug, log, type LogLevel } from \"./logging/debug.js\";\r\nimport { parseCss } from \"./html/css/parse-css.js\";\r\nimport { makeUnitParsers, type UnitCtx, pxToPt } from \"./units/units.js\";\r\nimport { LayoutNode } from \"./dom/node.js\";\r\nimport { ComputedStyle } from \"./css/style.js\";\r\nimport { layoutTree } from \"./layout/pipeline/layout-tree.js\";\r\nimport { buildRenderTree } from \"./pdf/layout-tree-builder.js\";\r\nimport { renderPdf } from \"./pdf/render.js\";\r\nimport { convertDomNode } from \"./html/dom-converter.js\";\r\nimport { applyPageVerticalMarginsWithHf, offsetRenderTree } from \"./render/offset.js\";\r\nimport { applyTextLayoutAdjustments } from \"./pdf/utils/text-layout-adjuster.js\";\r\nimport { setViewportSize } from \"./css/apply-declarations.js\";\r\nimport { type PageMarginsPx } from \"./units/page-utils.js\";\r\nimport { computeStyleForElement } from \"./css/compute-style.js\";\r\nimport type { HeaderFooterHTML } from \"./pdf/types.js\";\r\nimport { FontEmbedder } from \"./pdf/font/embedder.js\";\r\nimport { PdfDocument } from \"./pdf/primitives/pdf-document.js\";\r\nimport { loadBuiltinFontConfig } from \"./pdf/font/builtin-fonts.js\";\r\nimport { Display } from \"./css/enums.js\";\nimport type { Environment } from \"./environment/environment.js\";\nimport { NodeEnvironment } from \"./environment/node-environment.js\";\nimport { decodeBase64ToUint8Array } from \"./utils/base64.js\";\n\r\nexport interface RenderHtmlOptions {\r\n  html: string;\r\n  css: string;\r\n  viewportWidth: number;\r\n  viewportHeight: number;\r\n  pageWidth: number;\n  pageHeight: number;\n  margins: PageMarginsPx;\n  debug?: boolean;\n  debugLevel?: LogLevel;\n  debugCats?: string[];\r\n  fontConfig?: FontConfig;\n  resourceBaseDir?: string;\n  assetRootDir?: string;\n  headerFooter?: Partial<HeaderFooterHTML>;\n  /** Environment abstraction (Node/browser). Defaults to Node implementation. */\n  environment?: Environment;\n}\n\r\nexport interface PreparedRender {\r\n  layoutRoot: LayoutNode;\r\n  renderTree: ReturnType<typeof buildRenderTree>;\r\n  pageSize: { widthPt: number; heightPt: number };\r\n  margins: PageMarginsPx;\r\n}\r\n\r\nexport async function renderHtmlToPdf(options: RenderHtmlOptions): Promise<Uint8Array> {\n  const environment = options.environment ?? new NodeEnvironment(options.assetRootDir ?? options.resourceBaseDir);\n  const resolvedFontConfig = options.fontConfig ?? (await loadBuiltinFontConfig(environment));\n  const preparedOptions = resolvedFontConfig ? { ...options, fontConfig: resolvedFontConfig, environment } : { ...options, environment };\n  const prepared = await prepareHtmlRender(preparedOptions);\n  return renderPdf(prepared.renderTree, {\n    pageSize: prepared.pageSize,\n    fontConfig: resolvedFontConfig ?? undefined,\n    margins: prepared.margins,\n    environment,\n  });\n}\n\r\nexport async function prepareHtmlRender(options: RenderHtmlOptions): Promise<PreparedRender> {\n  const { html, css, viewportWidth, viewportHeight, pageWidth, pageHeight, margins, debug = false, debugLevel, debugCats, headerFooter } =\n    options;\n  const normalizedHtml = normalizeHtmlInput(html);\n\n  setViewportSize(viewportWidth, viewportHeight);\n  const isNode = typeof process !== \"undefined\" && !!process.versions?.node;\n  const resourceBaseDir = options.resourceBaseDir ?? options.assetRootDir ?? \"\";\n  const assetRootDir = options.assetRootDir ?? resourceBaseDir;\n  const environment = options.environment ?? new NodeEnvironment(assetRootDir);\n\r\n  if (debugLevel || debugCats) {\r\n    configureDebug({ level: debugLevel ?? (debug ? \"debug\" : \"info\"), cats: debugCats });\r\n  }\r\n\r\n  const unitCtx: UnitCtx = { viewport: { width: viewportWidth, height: viewportHeight } };\r\n  const units = makeUnitParsers(unitCtx);\r\n\r\n  log('html-to-pdf', 'debug', `prepareHtmlRender - input html: ${html}`);\r\n  let { document } = parseHTML(normalizedHtml);\r\n  if (needsReparse(document)) {\r\n    document = parseHTML(wrapHtml(html)).document;\r\n  }\r\n  log('html-to-pdf', 'debug', `prepareHtmlRender - parsed document body: ${document.body?.innerHTML || 'no body'}`);\r\n  log('html-to-pdf', 'debug', `prepareHtmlRender - document.documentElement tagName: ${document.documentElement?.tagName}`);\r\n  log('html-to-pdf', 'debug', `prepareHtmlRender - document.documentElement innerHTML: ${document.documentElement?.innerHTML}`);\r\n  log('html-to-pdf', 'debug', `prepareHtmlRender - document children count: ${document.childNodes.length}`);\r\n  for (let i = 0; i < document.childNodes.length; i++) {\r\n    const child = document.childNodes[i];\r\n    log('html-to-pdf', 'debug', `prepareHtmlRender - document child ${i}: ${child.nodeType}, ${(child as any).tagName || 'text node'}`);\r\n  }\r\n  log(\"parse\", \"debug\", \"DOM parsed\", { hasBody: !!document.body });\r\n\r\n  let mergedCss = css || \"\";\r\n  const styleTags = Array.from(document.querySelectorAll(\"style\"));\r\n  for (const styleTag of styleTags) {\r\n    if (styleTag.textContent) mergedCss += \"\\n\" + styleTag.textContent;\r\n  }\r\n  const linkTags = Array.from(document.querySelectorAll(\"link\")).filter((link) => (link.getAttribute(\"rel\") || \"\").toLowerCase() === \"stylesheet\");\n  for (const linkTag of linkTags) {\n    const href = linkTag.getAttribute(\"href\");\n    if (!href) continue;\n    const cssText = await loadStylesheetFromHref(href, resourceBaseDir, assetRootDir, environment);\n    if (cssText) mergedCss += \"\\n\" + cssText;\n  }\n  const { styleRules: cssRules, fontFaceRules } = parseCss(mergedCss);\r\n  log(\"parse\", \"debug\", \"CSS rules\", { count: cssRules.length, fontFaces: fontFaceRules.length });\r\n\r\n  // Determine the root element to process - prefer body, but fall back to documentElement if body is empty\r\n  let rootElement = document.body;\r\n  let processChildrenOf = rootElement;\r\n\r\n  // If body is empty but documentElement has children (like when HTML is just a fragment),\r\n  // process the documentElement's children instead\r\n  if (rootElement && rootElement.childNodes.length === 0) {\r\n    // Check if documentElement has meaningful children\r\n    const meaningfulChildren = Array.from(document.documentElement.childNodes).filter(node => {\r\n      return node.nodeType === node.ELEMENT_NODE && (node as HTMLElement).tagName !== 'HEAD';\r\n    });\r\n    if (meaningfulChildren.length > 0) {\r\n      processChildrenOf = document.documentElement;\r\n    }\r\n  } else if (!rootElement) {\r\n    // If there's no body element, process documentElement children directly\r\n    processChildrenOf = document.documentElement;\r\n  }\r\n\r\n  const baseParentStyle = new ComputedStyle();\r\n  const htmlElement = document.documentElement;\r\n  const documentElementStyle = htmlElement\r\n    ? computeStyleForElement(htmlElement, cssRules, baseParentStyle, units, baseParentStyle.fontSize)\r\n    : baseParentStyle;\r\n  const rootFontSize = documentElementStyle.fontSize;\r\n\r\n  let rootStyle: ComputedStyle;\r\n  if (!processChildrenOf || processChildrenOf === htmlElement) {\r\n    rootStyle = documentElementStyle;\r\n  } else {\r\n    rootStyle = computeStyleForElement(processChildrenOf, cssRules, documentElementStyle, units, rootFontSize);\r\n  }\r\n  if (isInlineDisplay(rootStyle.display)) {\r\n    rootStyle.display = Display.Block;\r\n  }\r\n  const rootLayout = new LayoutNode(rootStyle, [], { tagName: processChildrenOf?.tagName?.toLowerCase() });\r\n\r\n  const conversionContext = { resourceBaseDir, assetRootDir, units, rootFontSize, environment };\n\r\n  if (processChildrenOf) {\r\n    log('html-to-pdf', 'debug', `prepareHtmlRender - processing children of: ${processChildrenOf.tagName}, count: ${processChildrenOf.childNodes.length}`);\r\n    for (const child of Array.from(processChildrenOf.childNodes)) {\r\n      log('html-to-pdf', 'debug', `prepareHtmlRender - processing child: ${(child as any).tagName || 'text node'}, type: ${child.nodeType}`);\r\n      // Skip head and other non-content elements\r\n      if (child.nodeType === child.ELEMENT_NODE) {\r\n        const tagName = (child as HTMLElement).tagName.toLowerCase();\r\n        if (tagName === 'head' || tagName === 'meta' || tagName === 'title' || tagName === 'link' || tagName === 'script') {\r\n          continue;\r\n        }\r\n      }\r\n      const layoutChild = await convertDomNode(child, cssRules, rootStyle, conversionContext);\r\n      if (layoutChild) rootLayout.appendChild(layoutChild);\r\n    }\r\n  }\r\n\r\n  const pdfDoc = new PdfDocument();\r\n\r\n  // Process @font-face rules\r\n  for (const fontFace of fontFaceRules) {\r\n    const fontFamily = fontFace.declarations['font-family']?.replace(/['\"]/g, '');\r\n    const src = fontFace.declarations['src'];\r\n    if (fontFamily && src) {\r\n      const targetUrl = pickFontUrlFromSrc(src);\r\n      if (targetUrl && options.fontConfig) {\r\n        const fontData = await loadFontData(targetUrl, resourceBaseDir, assetRootDir, environment);\n        if (fontData) {\n          const weightStr = fontFace.declarations[\"font-weight\"] || \"400\";\n          const styleStr = fontFace.declarations[\"font-style\"] || \"normal\";\n          options.fontConfig.fontFaceDefs.push({\r\n            name: fontFamily,\r\n            family: fontFamily,\r\n            src: targetUrl,\r\n            data: fontData,\r\n            weight: parseFontWeight(weightStr),\r\n            style: normalizeFontStyle(styleStr),\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // In a browser environment, the font data should be pre-loaded and passed in the fontConfig.\r\n  if (options.fontConfig) {\n    for (const face of options.fontConfig.fontFaceDefs) {\n      if (!face.data && face.src) {\n        const loaded = await loadFontData(face.src, resourceBaseDir, assetRootDir, environment);\n        if (loaded) {\n          (face as any).data = loaded;\n        }\n      }\r\n    }\r\n  }\r\n  const fontEmbedder = options.fontConfig ? new FontEmbedder(options.fontConfig, pdfDoc) : null;\r\n  if (fontEmbedder) {\r\n    await fontEmbedder.initialize();\r\n  }\r\n\r\n  layoutTree(rootLayout, { width: viewportWidth, height: viewportHeight }, fontEmbedder);\r\n  log(\"layout\", \"debug\", \"Layout complete\");\r\n\r\n  const renderTree = buildRenderTree(rootLayout, { headerFooter });\r\n\r\n  // Global justification pass: fix inline run positions for text-align: justify\r\n  applyTextLayoutAdjustments(renderTree.root);\r\n\r\n  // Get header/footer heights for proper content positioning\r\n  const headerHeightPx = headerFooter?.maxHeaderHeightPx ?? 0;\r\n  const footerHeightPx = headerFooter?.maxFooterHeightPx ?? 0;\r\n\r\n  // Apply vertical margins with header/footer space reserved\r\n  // This pushes content below the header and reserves space for the footer\r\n  applyPageVerticalMarginsWithHf(renderTree.root, {\r\n    pageHeight,\r\n    margins,\r\n    headerHeightPx,\r\n    footerHeightPx,\r\n  });\r\n  offsetRenderTree(renderTree.root, margins.left, 0, debug);\r\n\r\n  const pageSize = { widthPt: pxToPt(pageWidth), heightPt: pxToPt(pageHeight) };\r\n  return { layoutRoot: rootLayout, renderTree, pageSize, margins };\r\n}\r\n\r\nasync function loadStylesheetFromHref(href: string, resourceBaseDir: string, assetRootDir: string, environment: Environment): Promise<string> {\n  const trimmed = href.trim();\n  if (!trimmed) return \"\";\n\n  try {\n    if (/^https?:\\/\\//i.test(trimmed) || trimmed.startsWith(\"//\")) {\n      const absoluteHref = trimmed.startsWith(\"//\") ? `https:${trimmed}` : trimmed;\r\n      const response = await fetch(absoluteHref);\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}`);\r\n      }\r\n      const cssText = await response.text();\r\n      return rewriteCssUrls(cssText, absoluteHref);\r\n    }\r\n\r\n    const cssPath = environment.resolveLocal ? environment.resolveLocal(trimmed, resourceBaseDir) : resolveLocalPath(trimmed, resourceBaseDir, assetRootDir);\n    const cssBuffer = await environment.loader.load(cssPath);\n    const cssText = new TextDecoder(\"utf-8\").decode(cssBuffer);\n    const baseHref = /^https?:\\/\\//i.test(cssPath) || cssPath.startsWith(\"file:\")\n      ? cssPath\n      : pathToFileURL(cssPath).toString();\n    return rewriteCssUrls(cssText, baseHref);\n  } catch (error) {\n    log(\"parse\", \"warn\", \"Failed to load stylesheet\", { href, error: error instanceof Error ? error.message : String(error) });\n    return \"\";\n  }\n}\n\r\nfunction rewriteCssUrls(cssText: string, baseHref: string): string {\r\n  let base: URL;\r\n  try {\r\n    base = new URL(baseHref);\r\n  } catch {\r\n    return cssText;\r\n  }\r\n\r\n  const urlRegex = /url\\(\\s*(['\"]?)([^'\")]+)\\1\\s*\\)/gi;\r\n  return cssText.replace(urlRegex, (match, quote: string, rawUrl: string) => {\r\n    const candidate = (rawUrl || \"\").trim();\r\n    if (!candidate || /^data:/i.test(candidate)) return match;\r\n    if (/^[a-z][a-z0-9+\\-.]*:/i.test(candidate)) return match;\r\n    try {\r\n      const resolved = new URL(candidate, base).toString();\r\n      const q = quote || \"\";\r\n      return `url(${q}${resolved}${q})`;\r\n    } catch {\r\n      return match;\r\n    }\r\n  });\r\n}\r\n\r\nfunction pickFontUrlFromSrc(src: string): string | null {\n  const urlRegex = /url\\(\\s*(['\"]?)([^'\")]+)\\1\\s*\\)(?:\\s*format\\(\\s*['\"]?([^'\")]+)['\"]?\\s*\\))?/gi;\r\n  let fallback: string | null = null;\r\n  let preferred: string | null = null;\r\n  let match: RegExpExecArray | null;\r\n\r\n  while ((match = urlRegex.exec(src)) !== null) {\r\n    const url = match[2];\r\n    const format = (match[3] || \"\").toLowerCase();\r\n    if (!fallback) fallback = url;\r\n    if (format === \"woff2\") {\r\n      preferred = url;\r\n      break;\r\n    }\r\n  }\r\n\r\n  return preferred ?? fallback;\r\n}\r\n\r\nfunction parseFontWeight(weightStr: string): number {\r\n  const normalized = weightStr.trim().toLowerCase();\r\n  if (normalized === \"bold\") return 700;\r\n  if (normalized === \"normal\") return 400;\r\n  const parsed = Number.parseInt(normalized, 10);\r\n  return Number.isFinite(parsed) ? parsed : 400;\r\n}\r\n\r\nfunction normalizeFontStyle(styleStr: string): \"normal\" | \"italic\" {\n  const normalized = styleStr.trim().toLowerCase();\n  return normalized.includes(\"italic\") || normalized.includes(\"oblique\") ? \"italic\" : \"normal\";\n}\n\nfunction resolveLocalPath(target: string, resourceBaseDir: string, assetRootDir: string): string {\n  let result = target;\n  if (result.startsWith(\"file://\")) {\n    result = fileURLToPath(result);\n  } else if (result.startsWith(\"/\")) {\n    result = path.resolve(assetRootDir, `.${result}`);\n  } else if (!path.isAbsolute(result)) {\n    result = path.resolve(resourceBaseDir, result);\n  }\n  return result;\n}\n\nasync function loadFontData(src: string, resourceBaseDir: string, assetRootDir: string, environment: Environment): Promise<ArrayBuffer | null> {\n  const trimmed = src.trim();\n  if (!trimmed) return null;\n  let target = trimmed;\n\n  try {\n    if (target.startsWith(\"//\")) {\r\n      target = `https:${target}`;\r\n    }\r\n\r\n    if (/^data:/i.test(target)) {\r\n      const commaIdx = target.indexOf(\",\");\r\n      if (commaIdx === -1) {\r\n        throw new Error(\"Invalid data URI\");\r\n      }\r\n      const meta = target.slice(5, commaIdx);\n      if (!/;base64/i.test(meta)) {\n        throw new Error(\"Only base64-encoded data URIs are supported for fonts\");\n      }\n      const data = decodeBase64ToUint8Array(target.slice(commaIdx + 1));\n      const copy = data.slice();\n      return copy.buffer;\n    }\n\n    if (/^https?:\\/\\//i.test(target)) {\n      const response = await fetch(target);\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}`);\n      }\n      return await response.arrayBuffer();\n    }\n\n    const resolved = environment.resolveLocal ? environment.resolveLocal(target, resourceBaseDir) : resolveLocalPath(target, resourceBaseDir, assetRootDir);\n    const fontDataBuffer = await environment.loader.load(resolved);\n    return fontDataBuffer;\n  } catch (error) {\n    log(\"font\", \"warn\", \"Failed to load font data\", { src, error: error instanceof Error ? error.message : String(error) });\n    return null;\n  }\n}\n\r\nfunction isInlineDisplay(display: Display): boolean {\r\n  return (\r\n    display === Display.Inline ||\r\n    display === Display.InlineBlock ||\r\n    display === Display.InlineFlex ||\r\n    display === Display.InlineGrid ||\r\n    display === Display.InlineTable\r\n  );\r\n}\r\n\r\nfunction normalizeHtmlInput(html: string): string {\r\n  const hasHtmlTag = /<\\s*html[\\s>]/i.test(html);\r\n  if (hasHtmlTag) {\r\n    return html;\r\n  }\r\n  return wrapHtml(html);\r\n}\r\n\r\nfunction wrapHtml(html: string): string {\r\n  return `<!doctype html><html><head></head><body>${html}</body></html>`;\r\n}\r\n\r\nfunction needsReparse(document: Document): boolean {\r\n  const docEl = document.documentElement?.tagName;\r\n  const docIsHtml = docEl?.toUpperCase() === \"HTML\";\r\n  if (!docIsHtml) return true;\r\n  if (!document.body) return true;\r\n  return false;\r\n}\r\n", "export interface FontConfig {\r\n  readonly fontFaceDefs: FontFaceDef[];\r\n  readonly defaultStack: string[];\r\n}\r\n\r\nexport interface FontFaceDef {\r\n  readonly name: string;\r\n  readonly family: string;\r\n  readonly weight: number;\r\n  readonly style: 'normal' | 'italic';\r\n  readonly src: string; // path to TTF file\r\n  readonly data?: ArrayBuffer;\r\n}\r\n\r\nexport interface TtfMetrics {\r\n  readonly unitsPerEm: number;\r\n  readonly ascender: number;\r\n  readonly descender: number;\r\n  readonly lineGap: number;\r\n  readonly capHeight: number;\r\n  readonly xHeight: number;\r\n}\r\n\r\nexport interface GlyphMetrics {\n  readonly advanceWidth: number;\n  readonly leftSideBearing: number;\n}\n\nexport type KerningMap = Map<number, Map<number, number>>;\n\nexport interface CmapData {\n  readonly getGlyphId: (codePoint: number) => number;\n  readonly hasCodePoint: (codePoint: number) => boolean;\n  readonly unicodeMap: Map<number, number>; // Internal access for CMap generation\n}\n\r\nexport type GlyphOutlineCmd =\r\n  | { type: \"moveTo\"; x: number; y: number }\r\n  | { type: \"lineTo\"; x: number; y: number }\r\n  | { type: \"quadTo\"; cx: number; cy: number; x: number; y: number } // quadratic B\u00E9zier\r\n  | { type: \"cubicTo\"; cx1: number; cy1: number; cx2: number; cy2: number; x: number; y: number } // cubic B\u00E9zier\r\n  | { type: \"close\" };\r\n\r\nexport class TtfFontMetrics {\r\n  constructor(\n    public readonly metrics: TtfMetrics,\n    public readonly glyphMetrics: Map<number, GlyphMetrics>,\n    public readonly cmap: CmapData,\n    // optional head bbox in font units [xMin, yMin, xMax, yMax]\n    public readonly headBBox?: readonly [number, number, number, number],\n    /**\n     * Optional hook that returns a glyph's outline command sequence.\n     * Present to prepare the API for future glyf / CFF parsing; placeholder\n     * implementations should return null when outlines aren't available.\n     */\n    public readonly getGlyphOutline?: (gid: number) => GlyphOutlineCmd[] | null,\n    /**\n     * Optional kerning map (left GID -> right GID -> adjustment in font units).\n     */\n    public readonly kerning?: KerningMap\n  ) {}\n}\n", "export type LogLevel = 'trace' | 'debug' | 'info' | 'warn' | 'error';\ntype DebugConfig = { level: LogLevel; cats: Set<string> };\n\nconst LEVEL_COLORS: Record<LogLevel, string> = {\n  trace: '\\x1b[90m',\n  debug: '\\x1b[36m',\n  info: '\\x1b[32m',\n  warn: '\\x1b[33m',\n  error: '\\x1b[31m',\n};\n\nconst CATEGORY_COLORS: Record<string, string> = {\n  parse: '\\x1b[95m',\n  style: '\\x1b[94m',\n  layout: '\\x1b[96m',\n  paint: '\\x1b[93m',\n  font: '\\x1b[92m',\n  encoding: '\\x1b[35m',\n  pdf: '\\x1b[91m',\n};\n\nexport const LOG_CATEGORIES = Object.keys(CATEGORY_COLORS);\n\nconst RESET = '\\x1b[0m';\nconst DEFAULT_CAT_COLOR = '\\x1b[37m';\nconst order: LogLevel[] = ['trace', 'debug', 'info', 'warn', 'error'];\n\nlet current: DebugConfig = { level: 'warn', cats: new Set() };\n\n/**\n * Configure runtime logging. Categories are compared case-insensitively.\n */\nexport function configureDebug(opts?: { level?: LogLevel; cats?: string[] }) {\n  if (!opts) return;\n  if (opts.level) current.level = opts.level;\n  if (opts.cats) current.cats = new Set(opts.cats.map((cat) => cat.toLowerCase()));\n}\n\nexport function log(cat: string, level: LogLevel, msg: string, obj?: unknown) {\n  const levelKey = (level as string).toLowerCase() as LogLevel;\n  const normalizedCat = cat.toLowerCase();\n  const configuredLevel = order.includes(current.level) ? current.level : 'warn';\n  if (!order.includes(levelKey)) return;\n  if (order.indexOf(levelKey) < order.indexOf(configuredLevel)) return;\n  if (current.cats.size && !current.cats.has(normalizedCat)) return;\n\n  const levelColor = LEVEL_COLORS[levelKey] ?? '';\n  const catColor = CATEGORY_COLORS[normalizedCat] ?? DEFAULT_CAT_COLOR;\n  const prefix = `${levelColor}[${levelKey.toUpperCase()}]${RESET} ${catColor}${cat}${RESET}`;\n\n  if (obj !== undefined) {\n    console.log(prefix, msg, obj);\n  } else {\n    console.log(prefix, msg);\n  }\n}\n// Note: This is the core logging function for pagyra-js, so it uses console.log directly.\n// All other console.log statements should be replaced with calls to this log function.\n", "import * as cssParser from \"css\";\r\nimport { createSelectorMatcher } from \"../../css/selectors/matcher.js\";\r\n\r\nexport type DomEl = any; // adapt to your DOM type, e.g. HTMLElement or any\r\n\r\nexport interface CssRuleEntry {\r\n  selector: string;\r\n  declarations: Record<string, string>;\r\n  match: (el: DomEl) => boolean;\r\n}\r\n\r\nexport interface FontFaceRule {\r\n  declarations: Record<string, string>;\r\n}\r\n\r\nexport interface ParsedCss {\r\n  styleRules: CssRuleEntry[];\r\n  fontFaceRules: FontFaceRule[];\r\n}\r\n\r\ntype CssDeclaration = cssParser.Declaration;\r\ntype CssRule = cssParser.Rule;\r\ntype CssFontFaceRule = cssParser.FontFace;\r\n\r\nexport function buildCssRules(cssText: string): ParsedCss {\r\n  const result: ParsedCss = { styleRules: [], fontFaceRules: [] };\r\n  if (!cssText.trim()) {\r\n    return result;\r\n  }\r\n  const stylesheet = cssParser.parse(cssText);\r\n  const rules = stylesheet.stylesheet?.rules ?? [];\r\n\r\n  for (const rule of rules) {\r\n    if (rule.type === \"rule\") {\r\n      const typedRule = rule as CssRule;\r\n      const selectors = typedRule.selectors ?? [];\r\n      const decls = typedRule.declarations ?? [];\r\n      const declarations: Record<string, string> = {};\r\n      for (const decl of decls) {\r\n        if (decl.type !== \"declaration\") continue;\r\n        const declaration = decl as CssDeclaration;\r\n        if (!declaration.property || declaration.value === undefined) {\r\n          continue;\r\n        }\r\n        const prop = declaration.property.trim();\r\n        if (prop.startsWith('--')) {\r\n          declarations[prop] = declaration.value.trim();\r\n        } else {\r\n          declarations[prop.toLowerCase()] = declaration.value.trim();\r\n        }\r\n      }\r\n      for (const selector of selectors) {\r\n        const matcher = createSelectorMatcher(selector.trim());\r\n        if (!matcher) {\r\n          console.warn(`Invalid CSS selector: ${selector.trim()}`);\r\n          continue;\r\n        }\r\n        result.styleRules.push({ selector, declarations: { ...declarations }, match: matcher });\r\n      }\r\n    } else if (rule.type === \"font-face\") {\r\n      const typedRule = rule as CssFontFaceRule;\r\n      const decls = typedRule.declarations ?? [];\r\n      const declarations: Record<string, string> = {};\r\n      for (const decl of decls) {\r\n        if (decl.type !== \"declaration\") continue;\r\n        const declaration = decl as CssDeclaration;\r\n        if (!declaration.property || declaration.value === undefined) {\r\n          continue;\r\n        }\r\n        const prop = declaration.property.trim();\r\n        if (prop.startsWith('--')) {\r\n          declarations[prop] = declaration.value.trim();\r\n        } else {\r\n          declarations[prop.toLowerCase()] = declaration.value.trim();\r\n        }\r\n      }\r\n      result.fontFaceRules.push({ declarations });\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function parseCss(cssText: string): ParsedCss {\r\n  return buildCssRules(cssText);\r\n}\r\n", "\uFEFFimport type { Part, Simple, AttrCond, AttrOp, Pseudo } from \"./types.js\";\r\n\r\n/**\r\n * Parser leve de seletor CSS \u2192 cadeia de Parts (compostos) com combinador \u00E0 esquerda.\r\n * Suporta: tag, #id, .classe, [attr ops], :first/last/nth-child, :not(simple)\r\n * Combinadores: ' ' (desc), '>' (filho), '+' (irm\u00E3o adjacente), '~' (irm\u00E3os)\r\n */\r\nexport function parseSelector(selector: string): Part[] | null {\r\n  if (!selector?.trim()) {\r\n    return null;\r\n  }\r\n\r\n  function parseNth(expr: string): { a: number; b: number } | null {\r\n    const s = expr.replace(/\\s+/g, '');\r\n    if (s === 'odd') {\r\n      return { a: 2, b: 1 };\r\n    }\r\n    if (s === 'even') {\r\n      return { a: 2, b: 0 };\r\n    }\r\n    if (/^[+-]?\\d+$/.test(s)) {\r\n      const result = { a: 0, b: parseInt(s, 10) };\r\n      return result;\r\n    }\r\n    const m = /^([+-]?\\d*)n([+-]?\\d+)?$/.exec(s);\r\n    if (!m) {\r\n      return null;\r\n    }\r\n    const a = m[1] === '' || m[1] === '+' ? 1 : (m[1] === '-' ? -1 : parseInt(m[1], 10));\r\n    const b = m[2] ? parseInt(m[2], 10) : 0;\r\n    const result = { a, b };\r\n    return result;\r\n  }\r\n\r\n  function parseSimpleToken(tok: string): Simple | null {\r\n    let rest = tok.trim();\r\n    if (!rest) {\r\n      return null;\r\n    }\r\n\r\n    let tag: string | null = null;\r\n    if (rest[0] === '*') { tag = null; rest = rest.slice(1); }\r\n    else if (!['#', '.', '[', ':'].includes(rest[0])) {\r\n      const m = /^[a-zA-Z][a-zA-Z0-9-]*/.exec(rest);\r\n      if (m) { tag = m[0].toLowerCase(); rest = rest.slice(m[0].length); }\r\n    }\r\n\r\n    let id: string | null = null;\r\n    const classes: string[] = [];\r\n    const attrs: AttrCond[] = [];\r\n    const pseudos: Pseudo[] = [];\r\n\r\n    while (rest.length) {\r\n      const ch = rest[0];\r\n      if (ch === '#') {\r\n        const m = /^#[^.#\\[\\]:\\s>+~]+/.exec(rest);\r\n        if (!m) break;\r\n        id = m[0].slice(1);\r\n        rest = rest.slice(m[0].length);\r\n        continue;\r\n      }\r\n      if (ch === '.') {\r\n        const m = /^\\.[^.#\\[\\]:\\s>+~]+/.exec(rest);\r\n        if (!m) break;\r\n        classes.push(m[0].slice(1));\r\n        rest = rest.slice(m[0].length);\r\n        continue;\r\n      }\r\n      if (ch === '[') {\r\n        const m = /^\\[(\\s*[-\\w:]+\\s*(?:([~|^$*]?=)\\s*(?:\"([^\"]*)\"|'([^']*)'|([^\\]\\s]+))\\s*)?)\\]/.exec(rest);\r\n        if (!m) break;\r\n        const name = m[1].match(/^[-\\w:]+/)![0];\r\n        const op = (m[2] as AttrOp) ?? 'exists';\r\n        const val = m[3] ?? m[4] ?? m[5];\r\n        const attr = op === 'exists' ? { name, op } : { name, op, value: val! };\r\n        attrs.push(attr);\r\n        rest = rest.slice(m[0].length);\r\n        continue;\r\n      }\r\n      if (ch === ':') {\r\n        // pseudos b\u00E1sicas\r\n        let m = /^:first-child/.exec(rest);\r\n        if (m) { pseudos.push({ kind: 'first-child' }); rest = rest.slice(m[0].length); continue; }\r\n        m = /^:last-child/.exec(rest);\r\n        if (m) { pseudos.push({ kind: 'last-child' }); rest = rest.slice(m[0].length); continue; }\r\n        m = /^:root\\b/.exec(rest);\r\n        if (m) { pseudos.push({ kind: 'root' }); rest = rest.slice(m[0].length); continue; }\r\n        m = /^:nth-child\\(\\s*([^)]+)\\s*\\)/.exec(rest);\r\n        if (m) {\r\n          const nb = parseNth(m[1]);\r\n          if (nb) {\r\n            pseudos.push({ kind: 'nth-child', a: nb.a, b: nb.b });\r\n          }\r\n          rest = rest.slice(m[0].length); continue;\r\n        }\r\n        m = /^:not\\(\\s*([^)]+)\\s*\\)/.exec(rest);\r\n        if (m) {\r\n          const innerTok = m[1];\r\n          const inner = parseSimpleToken(innerTok); // um n\u00EDvel simples\r\n          if (inner) pseudos.push({ kind: 'not', inner });\r\n          rest = rest.slice(m[0].length);\r\n          continue;\r\n        }\r\n        // pseudo desconhecida \u2192 aborta para manter comportamento previs\u00EDvel\r\n        return null;\r\n      }\r\n      break; // nada mais reconhecido\r\n    }\r\n\r\n    const result = { tag, id, classes, attrs, pseudos };\r\n    return result;\r\n  }\r\n\r\n  // Tokeniza\u00E7\u00E3o topo-n\u00EDvel preservando combinadores (n\u00E3o entra em []/())\r\n  const s = selector.trim().replace(/\\s+/g, ' ');\r\n  const tokens: (Simple | ' ' | '>' | '+' | '~')[] = [];\r\n  let i = 0;\r\n  while (i < s.length) {\r\n    const c = s[i];\r\n    if (c === ' ' || c === '>' || c === '+' || c === '~') {\r\n      if (c === ' ') { while (s[i] === ' ') i++; tokens.push(' '); }\r\n      else { tokens.push(c as any); i++; if (s[i] === ' ') i++; }\r\n      continue;\r\n    }\r\n    let j = i, depthSq = 0, depthPar = 0;\r\n    while (j < s.length) {\r\n      const ch = s[j];\r\n      if (ch === '[') depthSq++;\r\n      else if (ch === ']') depthSq = Math.max(0, depthSq - 1);\r\n      else if (ch === '(') depthPar++;\r\n      else if (ch === ')') depthPar = Math.max(0, depthPar - 1);\r\n      else if (depthSq === 0 && depthPar === 0 && (ch === ' ' || ch === '>' || ch === '+' || ch === '~')) break;\r\n      j++;\r\n    }\r\n    const raw = s.slice(i, j);\r\n    const simp = parseSimpleToken(raw);\r\n    if (!simp) {\r\n      return null;\r\n    }\r\n    tokens.push(simp);\r\n    i = j;\r\n  }\r\n\r\n  // Constr\u00F3i Parts com o combinador imediatamente \u00E0 esquerda\r\n  const parts: Part[] = [];\r\n  for (let k = 0; k < tokens.length; k++) {\r\n    const t = tokens[k];\r\n    if (typeof t !== 'string') {\r\n      let comb: ' ' | '>' | '+' | '~' | undefined = undefined;\r\n\r\n      // procura combinador direto \u00E0 esquerda (pulando espa\u00E7os redundantes)\r\n      let p = k - 1;\r\n      // se houver espa\u00E7os encadeados, tratamos como um \u00FAnico '\r\n      while (p >= 0 && tokens[p] === ' ') { comb = ' '; p--; break; }\r\n      if (p >= 0 && typeof tokens[p] === 'string' && tokens[p] !== ' ') comb = tokens[p] as any;\r\n\r\n      const part = { simple: t, combinatorToLeft: comb };\r\n      parts.push(part);\r\n    }\r\n  }\r\n  const result = parts.length ? parts : null;\r\n  return result;\r\n}\r\n", "import type { Simple } from \"./types.js\";\r\n\r\n/**\r\n * Gera uma chave can\u00F4nica est\u00E1vel para memoiza\u00E7\u00E3o de matches de \"Simple\".\r\n */\r\nexport function simpleKey(s: Simple): string {\r\n  const cls = s.classes.length ? '.' + s.classes.slice().sort().join('.') : '';\r\n  const attrs = s.attrs.length\r\n    ? '[' + s.attrs\r\n        .map(a => a.op === 'exists' ? a.name : `${a.name}${a.op}\"${a.value}\"`)\r\n        .sort().join('][') + ']'\r\n    : '';\r\n  const pseu = s.pseudos.length\r\n    ? ':' + s.pseudos.map(p => {\r\n        switch (p.kind) {\r\n          case 'first-child': return 'first-child';\r\n          case 'last-child':  return 'last-child';\r\n          case 'nth-child':   return `nth-child(${p.a}n+${p.b})`;\r\n          case 'not': {\r\n            const innerKey = simpleKey(p.inner);\r\n            return `not(${innerKey})`;\r\n          }\r\n          default: return '';\r\n        }\r\n      }).filter(p => p !== '').sort().join(':')\r\n    : '';\r\n  const tag = s.tag ?? '*';\r\n  const id  = s.id ? `#${s.id}` : '';\r\n  const key = `${tag}${id}${cls}${attrs}${pseu}`;\r\n  return key;\r\n}\r\n", "import type { Simple, AttrCond, Pseudo, Combinator } from \"./types.js\";\r\nimport { parseSelector } from \"./parser.js\";\r\nimport { simpleKey } from \"./simple-key.js\";\r\n\r\n/**\r\n * Cria um predicado (el)=>boolean que testa o seletor.\r\n * - Avalia\u00E7\u00E3o right-to-left\r\n * - Suporte a combinadores: ', '>', '+', '~'\r\n * - Suporte a tag/#id/.classe/[attr]/:first/last/nth-child/:not(simple)\r\n * - Memoiza\u00E7\u00E3o por n\u00F3 para matches de \"Simple\"\r\n */\r\nexport function createSelectorMatcher(selector: string): ((el: Element) => boolean) | null {\r\n  const chain = parseSelector(selector);\r\n  if (!chain) return null;\r\n\r\n  // Cache: (el) -> (simpleKey -> boolean)\r\n  type MatchCache = WeakMap<Element, Map<string, boolean>>;\r\n  const cache: MatchCache = new WeakMap();\r\n\r\n  function memo(el: Element, s: Simple, raw: (e: Element, s: Simple) => boolean): boolean {\r\n    let m = cache.get(el);\r\n    if (!m) { m = new Map(); cache.set(el, m); }\r\n    const k = simpleKey(s);\r\n    if (m.has(k)) return m.get(k)!;\r\n    const ok = raw(el, s);\r\n    m.set(k, ok);\r\n    return ok;\r\n  }\r\n\r\n  // Helpers DOM (assumem DOM-like API; adapte se teu DOM for custom)\r\n  function getAttr(el: Element, name: string): string | null {\r\n    const value = (el as any).getAttribute ? (el as any).getAttribute(name) : null;\r\n    return value;\r\n  }\r\n\r\n  function matchAttr(el: Element, cond: AttrCond): boolean {\r\n    const v = getAttr(el, cond.name);\r\n    if (cond.op === 'exists') {\r\n      const result = v !== null;\r\n      return result;\r\n    }\r\n    if (v === null) {\r\n      return false;\r\n    }\r\n    let result: boolean;\r\n    switch (cond.op) {\r\n      case '=':   result = v === cond.value!; break;\r\n      case '~=':  result = v.split(/\\s+/).includes(cond.value!); break;\r\n      case '|=': result = v === cond.value! || v.startsWith(cond.value! + '-'); break;\r\n      case '^=':  result = v.startsWith(cond.value!); break;\r\n      case '$=': result = v.endsWith(cond.value!); break;\r\n      case '*=':  result = v.includes(cond.value!); break;\r\n      default: result = false; break;\r\n    }\r\n    return result;\r\n  }\r\n\r\n  function indexInParent(el: Element): number {\r\n    const p = el.parentElement;\r\n    if (!p) {\r\n      return -1;\r\n    }\r\n    let idx = 0;\r\n    for (let n = p.firstElementChild; n; n = n.nextElementSibling) {\r\n      idx++;\r\n      if (n === el) {\r\n        return idx;\r\n      }\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  function matchesPseudo(el: Element, p: Pseudo): boolean {\r\n    if (p.kind === 'first-child') {\r\n      const result = indexInParent(el) === 1;\r\n      return result;\r\n    }\r\n    if (p.kind === 'last-child') {\r\n      const parent = el.parentElement;\r\n      if (!parent) {\r\n        return false;\r\n      }\r\n      const result = parent.lastElementChild === el;\r\n      return result;\r\n    }\r\n    if (p.kind === 'nth-child') {\r\n      const k = indexInParent(el);\r\n      if (k < 1) {\r\n        return false;\r\n      }\r\n      const { a, b } = p;\r\n      let result: boolean;\r\n      if (a === 0) {\r\n        result = k === b;\r\n      } else {\r\n        result = (k - b) % a === 0 && (k - b) / a >= 0;\r\n      }\r\n      return result;\r\n    }\r\n    if (p.kind === 'not') {\n      const result = !matchesSimple(el, p.inner);\n      return result;\n    }\n    if (p.kind === 'root') {\n      const doc = (el as any).ownerDocument;\n      if (!doc || !doc.documentElement) {\n        return false;\n      }\n      return doc.documentElement === el;\n    }\n    return false;\n  }\n\r\n  function matchesSimple(el: Element, s: Simple): boolean {\r\n    if (s.tag && el.tagName.toLowerCase() !== s.tag) {\r\n      return false;\r\n    }\r\n    if (s.id && (el as any).id !== s.id) {\r\n      return false;\r\n    }\r\n    const cl: DOMTokenList | undefined = (el as any).classList;\r\n    for (const cls of s.classes) {\r\n      if (!cl?.contains?.(cls)) {\r\n        return false;\r\n      }\r\n    }\r\n    for (const a of s.attrs) {\r\n      if (!matchAttr(el, a)) {\r\n        return false;\r\n      }\r\n    }\r\n    for (const z of s.pseudos) {\r\n      if (!matchesPseudo(el, z)) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  // Matcher right-to-left\r\n  return function match(el: Element): boolean {\r\n    let current: Element | null = el;\r\n    let i = chain.length - 1;\r\n\r\n    if (!current) {\r\n      return false;\r\n    }\r\n    if (!memo(current, chain[i].simple, matchesSimple)) {\r\n      return false;\r\n    }\r\n    i--;\r\n\r\n    while (i >= 0) {\r\n      const needed = chain[i];\r\n      const comb = chain[i + 1].combinatorToLeft as Combinator | undefined;\r\n\r\n      if (comb === '>') {\r\n        current = current!.parentElement;\r\n        if (!current) {\r\n          return false;\r\n        }\r\n        if (!memo(current, needed.simple, matchesSimple)) {\r\n          return false;\r\n        }\r\n        i--; continue;\r\n      }\r\n\r\n      if (comb === ' ') {\r\n        let anc: Element | null = current!.parentElement, found = false;\r\n        while (anc) {\r\n          if (memo(anc, needed.simple, matchesSimple)) {\r\n            current = anc;\r\n            found = true;\r\n            break;\r\n          }\r\n          anc = anc.parentElement;\r\n        }\r\n        if (!found) {\r\n          return false;\r\n        }\r\n        i--; continue;\r\n      }\r\n\r\n      if (comb === '+') {\r\n        const sib = current!.previousElementSibling as Element | null;\r\n        if (!sib) {\r\n          return false;\r\n        }\r\n        if (!memo(sib, needed.simple, matchesSimple)) {\r\n          return false;\r\n        }\r\n        current = sib; i--; continue;\r\n      }\r\n\r\n      if (comb === '~') {\r\n        let sib = current!.previousElementSibling as Element | null, found = false;\r\n        while (sib) {\r\n          if (memo(sib, needed.simple, matchesSimple)) {\r\n            current = sib;\r\n            found = true;\r\n            break;\r\n          }\r\n          sib = sib.previousElementSibling as Element | null;\r\n        }\r\n        if (!found) {\r\n          return false;\r\n        }\r\n        i--; continue;\r\n      }\r\n\r\n      // sem combinador \u00E0 esquerda (primeiro item, raro cair aqui)\r\n      if (!memo(current!, needed.simple, matchesSimple)) {\r\n        return false;\r\n      }\r\n      i--;\r\n    }\r\n    return true;\r\n  };\r\n}\r\n", "// src/css/viewport.ts\r\n\r\nlet CURRENT_VIEWPORT_WIDTH_PX = 0;\r\nlet CURRENT_VIEWPORT_HEIGHT_PX = 0;\r\n\r\nexport function setViewportSize(width: number, height: number): void {\r\n  CURRENT_VIEWPORT_WIDTH_PX = Number.isFinite(width) && width > 0 ? width : 0;\r\n  CURRENT_VIEWPORT_HEIGHT_PX = Number.isFinite(height) && height > 0 ? height : 0;\r\n}\r\n\r\nexport function getViewportWidth(): number {\r\n  return CURRENT_VIEWPORT_WIDTH_PX;\r\n}\r\n\r\nexport function getViewportHeight(): number {\r\n  return CURRENT_VIEWPORT_HEIGHT_PX;\r\n}\r\n", "export type LengthUnit = \"px\" | \"percent\";\r\nexport type RelativeLengthUnit = \"em\" | \"rem\";\r\n\r\nexport interface AbsoluteLength {\r\n  readonly kind: \"absolute\";\r\n  readonly unit: LengthUnit;\r\n  readonly value: number;\r\n}\r\n\r\nexport interface AutoLength {\r\n  readonly kind: \"auto\";\r\n}\r\n\r\nexport interface RelativeLength {\r\n  readonly kind: \"relative\";\r\n  readonly unit: RelativeLengthUnit;\r\n  readonly value: number;\r\n}\r\n\r\nexport type CSSLength = AbsoluteLength | AutoLength;\r\n\r\nexport type LengthLike = CSSLength | number | \"auto\";\r\nexport type LengthInput = LengthLike | RelativeLength;\r\nexport type NumericLength = number | RelativeLength;\r\n\r\nexport const AUTO_LENGTH: AutoLength = { kind: \"auto\" };\r\n\r\nexport function px(value: number): AbsoluteLength {\r\n  return { kind: \"absolute\", unit: \"px\", value };\r\n}\r\n\r\nexport function percent(ratio: number): AbsoluteLength {\r\n  return { kind: \"absolute\", unit: \"percent\", value: ratio };\r\n}\r\n\r\nexport function relativeLength(unit: RelativeLengthUnit, value: number): RelativeLength {\r\n  return { kind: \"relative\", unit, value };\r\n}\r\n\r\nexport function isRelativeLength(value: unknown): value is RelativeLength {\r\n  if (!value || typeof value !== \"object\") {\r\n    return false;\r\n  }\r\n  return (value as RelativeLength).kind === \"relative\";\r\n}\r\n\r\nexport function resolveRelativeLength(value: RelativeLength, fontSize: number, rootFontSize: number): number {\r\n  return value.unit === \"em\" ? value.value * fontSize : value.value * rootFontSize;\r\n}\r\n\r\nexport function resolveNumberLike(\r\n  value: number | RelativeLength | undefined,\r\n  fontSize: number,\r\n  rootFontSize: number,\r\n): number | undefined {\r\n  if (value === undefined) {\r\n    return undefined;\r\n  }\r\n  if (typeof value === \"number\") {\r\n    return value;\r\n  }\r\n  return resolveRelativeLength(value, fontSize, rootFontSize);\r\n}\r\n\r\nexport function resolveLengthInput(\r\n  value: LengthInput | undefined,\r\n  fontSize: number,\r\n  rootFontSize: number,\r\n): LengthLike | undefined {\r\n  if (value === undefined) {\r\n    return undefined;\r\n  }\r\n  if (isRelativeLength(value)) {\r\n    return resolveRelativeLength(value, fontSize, rootFontSize);\r\n  }\r\n  return value;\r\n}\r\n\r\nexport function isAutoLength(value: LengthLike): value is AutoLength | \"auto\" {\r\n  if (typeof value === \"string\") {\r\n    return value === \"auto\";\r\n  }\r\n  if (typeof value === \"number\") {\r\n    return false;\r\n  }\r\n  return value.kind === \"auto\";\r\n}\r\n\r\nexport function normalizeLength(value: LengthLike): CSSLength {\r\n  if (typeof value === \"number\") {\r\n    return px(value);\r\n  }\r\n  if (value === \"auto\") {\r\n    return AUTO_LENGTH;\r\n  }\r\n  return value;\r\n}\r\n\r\nexport interface ResolveLengthOptions {\r\n  auto?: \"reference\" | \"zero\" | number;\r\n}\r\n\r\nexport function resolveLength(\r\n  value: LengthLike | undefined,\r\n  reference: number,\r\n  options: ResolveLengthOptions = { auto: \"reference\" },\r\n): number {\r\n  const autoBehavior = options.auto ?? \"reference\";\r\n  if (value === undefined) {\r\n    return 0;\r\n  }\r\n  if (typeof value === \"number\") {\r\n    return value;\r\n  }\r\n  if (value === \"auto\") {\r\n    return resolveAuto(autoBehavior, reference);\r\n  }\r\n  if (value.kind === \"auto\") {\r\n    return resolveAuto(autoBehavior, reference);\r\n  }\r\n  if (value.unit === \"percent\") {\r\n    return value.value * reference;\r\n  }\r\n  return value.value;\r\n}\r\n\r\nexport function clampMinMax(value: number, minValue: number | undefined, maxValue: number | undefined): number {\r\n  const upper = maxValue ?? Number.POSITIVE_INFINITY;\r\n  const lower = minValue ?? Number.NEGATIVE_INFINITY;\r\n  return Math.min(Math.max(value, lower), upper);\r\n}\r\n\r\nfunction resolveAuto(autoBehavior: \"reference\" | \"zero\" | number, reference: number): number {\r\n  if (autoBehavior === \"reference\") {\r\n    return reference;\r\n  }\r\n  if (autoBehavior === \"zero\") {\r\n    return 0;\r\n  }\r\n  return autoBehavior;\r\n}\r\n", "// src/css/parsers/length-parser.ts\n\nimport { cmToPx, inToPx, mmToPx, pcToPx, ptToPx, qToPx } from \"../../units/units.js\";\nimport { getViewportHeight, getViewportWidth } from \"../viewport.js\";\nimport { percent, relativeLength, type RelativeLength } from \"../length.js\";\n\nconst PERCENT_LENGTH_REGEX = /^(-?\\d+(?:\\.\\d+)?)%$/;\n\nexport function parseLength(value: string): number | RelativeLength | undefined {\n  if (!value) {\n    return undefined;\n  }\n  const normalized = value.trim().toLowerCase();\n  if (!normalized || normalized === \"auto\") {\n    return undefined;\n  }\n  const match = normalized.match(/^(-?\\d+(?:\\.\\d+)?)(px|pt|vh|vw|em|rem|cm|mm|q|in|pc)?$/);\n  if (!match) {\n    return undefined;\n  }\n  const numeric = Number.parseFloat(match[1]);\n  if (Number.isNaN(numeric)) {\n    return undefined;\n  }\n  const unit = match[2] ?? \"px\";\n  switch (unit) {\n    case \"px\":\n      return numeric;\n    case \"pt\":\n      return ptToPx(numeric);\n    case \"cm\":\n      return cmToPx(numeric);\n    case \"mm\":\n      return mmToPx(numeric);\n    case \"q\":\n      return qToPx(numeric);\n    case \"in\":\n      return inToPx(numeric);\n    case \"pc\":\n      return pcToPx(numeric);\n    case \"vh\":\n      return (numeric / 100) * getViewportHeight();\n    case \"vw\":\n      return (numeric / 100) * getViewportWidth();\n    case \"em\":\n    case \"rem\":\n      return relativeLength(unit, numeric);\n    default:\n      return undefined;\n  }\n}\n\nexport function parseNumeric(value: string): number | RelativeLength | undefined {\n  const match = value.trim().match(/^(-?\\d+(?:\\.\\d+)?)(px|pt|em|rem)?$/i);\n  if (!match) {\n    return undefined;\n  }\n  let n = Number.parseFloat(match[1]);\n  const unit = (match[2] ?? \"px\").toLowerCase();\n  if (unit === \"pt\") {\n    n = ptToPx(n);\n    return n;\n  }\n  if (unit === \"em\" || unit === \"rem\") {\n    return relativeLength(unit, n);\n  }\n  return n;\n}\n\nexport function parseLengthOrPercent(value: string): number | RelativeLength | ReturnType<typeof percent> | undefined {\n  const parsed = parseLength(value);\n  if (parsed !== undefined) {\n    return parsed;\n  }\n  const match = PERCENT_LENGTH_REGEX.exec(value.trim());\n  if (!match) {\n    return undefined;\n  }\n  const numeric = Number.parseFloat(match[1]);\n  if (Number.isNaN(numeric)) {\n    return undefined;\n  }\n  return percent(numeric / 100);\n}\n\nexport function parseLengthOrAuto(value: string): number | RelativeLength | \"auto\" | undefined {\n  if (!value) {\n    return undefined;\n  }\n  const normalized = value.trim().toLowerCase();\n  if (normalized === \"auto\") {\n    return \"auto\";\n  }\n  return parseLength(normalized);\n}\n", "// src/units/units.ts\r\n\r\nimport { parseLength, parseLengthOrPercent } from \"../css/parsers/length-parser.js\";\r\n\r\nconst DPI = 96;\r\nconst INCHES_PER_CM = 1 / 2.54;\r\n\r\nexport function cmToPx(cm: number): number {\r\n  return cm * INCHES_PER_CM * DPI;\r\n}\r\n\r\nexport function mmToPx(mm: number): number {\r\n  return (mm / 10) * INCHES_PER_CM * DPI;\r\n}\r\n\r\nexport function qToPx(q: number): number {\r\n  return (q / 40) * INCHES_PER_CM * DPI;\r\n}\r\n\r\nexport function inToPx(inches: number): number {\r\n  return inches * DPI;\r\n}\r\n\r\nexport function pcToPx(pc: number): number {\r\n  return pc * (DPI / 6);\r\n}\r\n\r\nexport function ptToPx(pt: number): number {\r\n  return pt * (DPI / 72);\r\n}\r\n\r\nexport function pxToPt(px: number): number {\r\n  return px * (72 / DPI);\r\n}\r\n\r\nexport interface UnitCtx {\r\n  viewport: {\r\n    width: number;\r\n    height: number;\r\n  };\r\n}\r\n\r\nexport function makeUnitParsers(ctx: UnitCtx) {\r\n  return {\r\n    parseLength: (value: string) => parseLength(value),\r\n    parseLengthOrPercent: (value: string) => parseLengthOrPercent(value),\r\n  };\r\n}\r\n\r\nexport type UnitParsers = ReturnType<typeof makeUnitParsers>;\r\n", "import { resolveRelativeLength, type NumericLength } from \"./length.js\";\n\nexport interface NormalLineHeight {\n  kind: \"normal\";\n}\n\nexport interface UnitlessLineHeight {\n  kind: \"unitless\";\n  value: number;\n}\n\nexport interface AbsoluteLineHeight<TValue = number> {\n  kind: \"length\";\n  value: TValue;\n}\n\nexport type LineHeightValue = NormalLineHeight | UnitlessLineHeight | AbsoluteLineHeight<number>;\nexport type LineHeightInput = NormalLineHeight | UnitlessLineHeight | AbsoluteLineHeight<NumericLength>;\n\nexport const DEFAULT_NORMAL_LINE_HEIGHT = 1.2;\n\nexport function createNormalLineHeight(): NormalLineHeight {\n  return { kind: \"normal\" };\n}\n\nexport function createUnitlessLineHeight(value: number): UnitlessLineHeight {\n  return { kind: \"unitless\", value };\n}\n\nexport function createLengthLineHeight(value: number): AbsoluteLineHeight<number> {\n  return { kind: \"length\", value };\n}\n\nexport function cloneLineHeight(value: LineHeightValue): LineHeightValue {\n  switch (value.kind) {\n    case \"normal\":\n      return createNormalLineHeight();\n    case \"unitless\":\n      return createUnitlessLineHeight(value.value);\n    case \"length\":\n      return createLengthLineHeight(value.value);\n    default:\n      return createNormalLineHeight();\n  }\n}\n\nexport function resolveLineHeightInput(\n  input: LineHeightInput,\n  fontSize: number,\n  rootFontSize: number,\n): LineHeightValue {\n  switch (input.kind) {\n    case \"normal\":\n      return createNormalLineHeight();\n    case \"unitless\":\n      return createUnitlessLineHeight(input.value);\n    case \"length\": {\n      const raw = input.value;\n      const pxValue = typeof raw === \"number\" ? raw : resolveRelativeLength(raw, fontSize, rootFontSize);\n      return createLengthLineHeight(pxValue);\n    }\n    default:\n      return createNormalLineHeight();\n  }\n}\n\nexport function lineHeightEquals(a: LineHeightValue, b: LineHeightValue): boolean {\n  if (a.kind !== b.kind) {\n    return false;\n  }\n  if (a.kind === \"unitless\" || a.kind === \"length\") {\n    return a.value === (b as UnitlessLineHeight | AbsoluteLineHeight<number>).value;\n  }\n  return true;\n}\n\nexport function lineHeightToPx(\n  value: LineHeightValue | undefined,\n  fontSize: number | undefined,\n  normalRatio = DEFAULT_NORMAL_LINE_HEIGHT,\n): number {\n  const size = fontSize ?? 16;\n  if (!value) {\n    return size * normalRatio;\n  }\n  switch (value.kind) {\n    case \"normal\":\n      return size * normalRatio;\n    case \"unitless\":\n      return value.value * size;\n    case \"length\":\n      return value.value;\n    default:\n      return size * normalRatio;\n  }\n}\n", "/**\r\n * Utility functions for CSS unit conversions.\r\n * This module centralizes logic for converting between different units like rem, em, and px.\r\n */\r\n\r\n/**\r\n * Converts a value from rem units to pixels.\r\n * @param remValue The value in rem units.\r\n * @param baseFontSize The base font size of the root element in pixels.\r\n * @returns The equivalent value in pixels.\r\n */\r\nexport function remToPx(remValue: number, baseFontSize: number): number {\r\n  return remValue * baseFontSize;\r\n}\r\n\r\n/**\r\n * Converts a value from em units to pixels.\r\n * @param emValue The value in em units.\r\n * @param currentFontSize The font size of the current element in pixels.\r\n * @returns The equivalent value in pixels.\r\n */\r\nexport function emToPx(emValue: number, currentFontSize: number): number {\r\n  return emValue * currentFontSize;\r\n}\r\n", "import {\r\n  AlignContent,\r\n  AlignItems,\r\n  BorderModel,\r\n  ClearMode,\r\n  Display,\r\n  JustifyContent,\r\n  OverflowMode,\r\n  Position,\r\n  TableLayoutMode,\r\n  TextWrap,\r\n  WhiteSpace,\r\n  WritingMode,\r\n} from \"../enums.js\";\r\nimport type { LengthLike } from \"../length.js\";\r\nimport { AUTO_LENGTH } from \"../length.js\";\r\nimport { createNormalLineHeight, DEFAULT_NORMAL_LINE_HEIGHT } from \"../line-height.js\";\r\nimport { remToPx, emToPx } from \"../unit-conversion.js\";\r\n\r\n/**\r\n * Typography defaults - handles all font and text related properties.\r\n */\r\nexport class TypographyDefaults {\r\n  static getFontFamily(): string {\r\n    return \"'Times New Roman', Times, serif\";\r\n  }\r\n\r\n  static getFontSize(): number {\r\n    return 1; // 1rem\r\n  }\r\n\r\n  static getBaseFontSize(): number {\r\n    return 16;\r\n  }\r\n\r\n  static getLineHeight(): number {\r\n    return DEFAULT_NORMAL_LINE_HEIGHT;\r\n  }\r\n\r\n  static getColor(): string {\r\n    return \"#000000\";\r\n  }\r\n\r\n  static getLetterSpacing(): number {\r\n    return 0;\r\n  }\r\n\r\n  static getWordSpacing(): number {\r\n    return 0;\r\n  }\r\n\r\n  static getFontWeight(): number {\r\n    return 400;\r\n  }\r\n}\r\n\r\n/**\r\n * Box model defaults - handles spacing, sizing, and positioning.\r\n */\r\nexport class BoxModelDefaults {\r\n  static getMargin(): number {\r\n    return 0; // 0em\r\n  }\r\n\r\n  static getPadding(): number {\r\n    return 0;\r\n  }\r\n\r\n  static getBorder(): number {\r\n    return 0;\r\n  }\r\n\r\n  static getWidth(): LengthLike {\r\n    return \"auto\";\r\n  }\r\n\r\n  static getHeight(): LengthLike {\r\n    return \"auto\";\r\n  }\r\n\r\n  static getMinWidth(): LengthLike | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  static getMaxWidth(): LengthLike | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  static getMinHeight(): LengthLike | undefined {\r\n    return undefined;\r\n  }\r\n\r\n  static getMaxHeight(): LengthLike | undefined {\r\n    return undefined;\r\n  }\r\n}\r\n\r\n/**\r\n * Layout defaults - handles display and positioning properties.\r\n */\r\nexport class LayoutDefaults {\r\n  static getDisplay(): Display {\r\n    return Display.Block;\r\n  }\r\n\r\n  static getPosition(): Position {\r\n    return Position.Static;\r\n  }\r\n\r\n  static getFloat(): \"none\" {\r\n    // FloatMode is only needed at usage sites; keep this minimal here if possible.\r\n    return \"none\";\r\n  }\r\n\r\n  static getClear(): ClearMode {\r\n    return ClearMode.None;\r\n  }\r\n\r\n  static getOverflowX(): OverflowMode {\r\n    return OverflowMode.Visible;\r\n  }\r\n\r\n  static getOverflowY(): OverflowMode {\r\n    return OverflowMode.Visible;\r\n  }\r\n}\r\n\r\n/**\r\n * Text layout defaults - handles text flow and wrapping.\r\n */\r\nexport class TextLayoutDefaults {\r\n  static getWhiteSpace(): WhiteSpace {\r\n    return WhiteSpace.Normal;\r\n  }\r\n\r\n  static getOverflowWrap(): \"normal\" | \"break-word\" | \"anywhere\" {\r\n    return \"normal\";\r\n  }\r\n\r\n  static getTextWrap(): TextWrap {\r\n    return TextWrap.Wrap;\r\n  }\r\n\r\n  static getWritingMode(): WritingMode {\r\n    return WritingMode.HorizontalTb;\r\n  }\r\n\r\n  static getTextAlign(): string {\r\n    return \"start\";\r\n  }\r\n\r\n  static getVerticalAlign(): string {\r\n    return \"baseline\";\r\n  }\r\n\r\n  static getTextIndent(): number {\r\n    return 0;\r\n  }\r\n\r\n  static getTextTransform(): \"none\" {\r\n    return \"none\";\r\n  }\r\n}\r\n\r\n/**\r\n * Base object used by BrowserDefaults as a starting point for all elements.\r\n * This keeps construction logic separate from element-specific maps.\r\n */\r\nexport function createBaseDefaultsObject(): any {\r\n  const baseFontSize = TypographyDefaults.getBaseFontSize();\r\n  return {\r\n    // Typography\r\n    fontFamily: TypographyDefaults.getFontFamily(),\r\n    fontSize: remToPx(TypographyDefaults.getFontSize(), baseFontSize),\r\n    fontStyle: \"normal\",\r\n    fontWeight: TypographyDefaults.getFontWeight(),\r\n    lineHeight: createNormalLineHeight(),\r\n    color: TypographyDefaults.getColor(),\r\n    borderColor: TypographyDefaults.getColor(),\n    letterSpacing: TypographyDefaults.getLetterSpacing(),\n    wordSpacing: TypographyDefaults.getWordSpacing(),\n    textDecorationLine: \"none\",\n    textDecorationColor: \"currentcolor\",\n    textDecorationStyle: \"solid\",\n    listStyleType: \"disc\",\r\n\r\n    // Box model\r\n    marginTop: emToPx(BoxModelDefaults.getMargin(), remToPx(TypographyDefaults.getFontSize(), baseFontSize)),\r\n    marginRight: emToPx(BoxModelDefaults.getMargin(), remToPx(TypographyDefaults.getFontSize(), baseFontSize)),\r\n    marginBottom: emToPx(BoxModelDefaults.getMargin(), remToPx(TypographyDefaults.getFontSize(), baseFontSize)),\r\n    marginLeft: emToPx(BoxModelDefaults.getMargin(), remToPx(TypographyDefaults.getFontSize(), baseFontSize)),\r\n    paddingTop: BoxModelDefaults.getPadding(),\r\n    paddingRight: BoxModelDefaults.getPadding(),\r\n    paddingBottom: BoxModelDefaults.getPadding(),\r\n    paddingLeft: BoxModelDefaults.getPadding(),\r\n    borderTop: BoxModelDefaults.getBorder(),\r\n    borderRight: BoxModelDefaults.getBorder(),\r\n    borderBottom: BoxModelDefaults.getBorder(),\r\n    borderLeft: BoxModelDefaults.getBorder(),\r\n    borderTopLeftRadiusX: 0,\r\n    borderTopLeftRadiusY: 0,\r\n    borderTopRightRadiusX: 0,\r\n    borderTopRightRadiusY: 0,\r\n    borderBottomRightRadiusX: 0,\r\n    borderBottomRightRadiusY: 0,\r\n    borderBottomLeftRadiusX: 0,\r\n    borderBottomLeftRadiusY: 0,\r\n    boxShadows: [],\r\n    width: BoxModelDefaults.getWidth(),\r\n    height: BoxModelDefaults.getHeight(),\r\n    minWidth: BoxModelDefaults.getMinWidth(),\r\n    maxWidth: BoxModelDefaults.getMaxWidth(),\r\n    minHeight: BoxModelDefaults.getMinHeight(),\r\n    maxHeight: BoxModelDefaults.getMaxHeight(),\r\n\r\n    // Layout\r\n    display: LayoutDefaults.getDisplay(),\r\n    position: LayoutDefaults.getPosition(),\r\n    float: \"none\",\r\n    clear: LayoutDefaults.getClear(),\r\n    overflowX: LayoutDefaults.getOverflowX(),\r\n    overflowY: LayoutDefaults.getOverflowY(),\r\n\r\n    // Text layout\r\n    whiteSpace: TextLayoutDefaults.getWhiteSpace(),\r\n    overflowWrap: TextLayoutDefaults.getOverflowWrap(),\r\n    textWrap: TextLayoutDefaults.getTextWrap(),\r\n    writingMode: TextLayoutDefaults.getWritingMode(),\r\n    textAlign: TextLayoutDefaults.getTextAlign(),\r\n    verticalAlign: TextLayoutDefaults.getVerticalAlign(),\r\n    textIndent: TextLayoutDefaults.getTextIndent(),\r\n    textTransform: TextLayoutDefaults.getTextTransform(),\r\n\r\n    // Flexbox (defaults)\r\n    flexGrow: 0,\r\n    flexShrink: 1,\r\n    flexBasis: AUTO_LENGTH,\r\n    alignItems: AlignItems.Stretch,\r\n    alignSelf: \"auto\",\r\n    justifyContent: JustifyContent.FlexStart,\r\n    alignContent: AlignContent.Stretch,\r\n    flexDirection: \"row\",\r\n    flexWrap: false,\r\n\r\n    // Grid (defaults)\r\n    trackListColumns: [],\r\n    trackListRows: [],\r\n    autoFlow: \"row\",\r\n    rowGap: 0,\r\n    columnGap: 0,\r\n\r\n    // Table (defaults)\r\n    tableLayout: TableLayoutMode.Auto,\r\n    borderModel: BorderModel.Separate,\r\n\r\n    // Fragmentation (defaults)\r\n    breakBefore: \"auto\",\r\n    breakAfter: \"auto\",\r\n    breakInside: \"auto\",\r\n    widows: 2,\r\n    orphans: 2,\r\n\r\n    // Opacity\r\n    opacity: 1,\r\n  };\r\n}\r\n", "import {\r\n  Display,\r\n} from \"../enums.js\";\r\nimport { createNormalLineHeight } from \"../line-height.js\";\r\nimport { TypographyDefaults } from \"./base-defaults.js\";\r\nimport type { ElementDefaults } from \"./types.js\";\r\nimport { relativeLength } from \"../length.js\";\r\n\r\n/**\r\n * Element-specific defaults - browser-like defaults per HTML tag.\r\n * Pure data + simple lookup helpers, no construction/merge logic here.\r\n */\r\nclass ElementSpecificDefaultsImpl {\r\n  private readonly elementDefaults: Record<string, Partial<ElementDefaults>> = {\r\n    // Root element\r\n    html: {\r\n      display: Display.Block,\r\n      fontSize: 16,\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n\r\n    // Body element\r\n    body: {\r\n      display: Display.Block,\r\n      margin: 8,\r\n      fontSize: 16,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n\r\n    // Headings\r\n    h1: {\r\n      display: Display.Block,\r\n      marginTop: relativeLength(\"em\", 0.67),\r\n      marginBottom: relativeLength(\"em\", 0.67),\r\n      marginLeft: 0,\r\n      marginRight: 0,\r\n      fontSize: relativeLength(\"em\", 2),\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      fontWeight: 700,\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    h2: {\r\n      display: Display.Block,\r\n      marginTop: relativeLength(\"em\", 0.83),\r\n      marginBottom: relativeLength(\"em\", 0.83),\r\n      marginLeft: 0,\r\n      marginRight: 0,\r\n      fontSize: relativeLength(\"em\", 1.5),\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      fontWeight: 700,\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    h3: {\r\n      display: Display.Block,\r\n      marginTop: relativeLength(\"em\", 1),\r\n      marginBottom: relativeLength(\"em\", 1),\r\n      marginLeft: 0,\r\n      marginRight: 0,\r\n      fontSize: relativeLength(\"em\", 1.17),\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      fontWeight: 700,\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    h4: {\r\n      display: Display.Block,\r\n      marginTop: relativeLength(\"em\", 1.33),\r\n      marginBottom: relativeLength(\"em\", 1.33),\r\n      marginLeft: 0,\r\n      marginRight: 0,\r\n      fontSize: relativeLength(\"em\", 1),\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      fontWeight: 700,\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    h5: {\r\n      display: Display.Block,\r\n      marginTop: relativeLength(\"em\", 1.67),\r\n      marginBottom: relativeLength(\"em\", 1.67),\r\n      marginLeft: 0,\r\n      marginRight: 0,\r\n      fontSize: relativeLength(\"em\", 0.83),\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      fontWeight: 700,\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    h6: {\r\n      display: Display.Block,\r\n      marginTop: relativeLength(\"em\", 2.33),\r\n      marginBottom: relativeLength(\"em\", 2.33),\r\n      marginLeft: 0,\r\n      marginRight: 0,\r\n      fontSize: relativeLength(\"em\", 0.67),\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      fontWeight: 700,\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n\r\n    // Paragraphs\r\n    p: {\r\n      display: Display.Block,\r\n      marginTop: relativeLength(\"em\", 1),\r\n      marginRight: 0,\r\n      marginBottom: relativeLength(\"em\", 1),\r\n      marginLeft: 0,\r\n      fontSize: relativeLength(\"em\", 1),\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n\r\n    // Lists\r\n    ul: {\r\n      display: Display.Block,\r\n      marginTop: relativeLength(\"em\", 1),\r\n      marginBottom: relativeLength(\"em\", 1),\r\n      paddingLeft: 40, // px\r\n      listStyleType: \"disc\",\r\n      fontSize: relativeLength(\"em\", 1),\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    ol: {\r\n      display: Display.Block,\r\n      marginTop: relativeLength(\"em\", 1),\r\n      marginBottom: relativeLength(\"em\", 1),\r\n      paddingLeft: 40, // px\r\n      listStyleType: \"decimal\",\r\n      fontSize: relativeLength(\"em\", 1),\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    li: {\r\n      display: Display.Block,\r\n      fontSize: relativeLength(\"em\", 1),\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n\r\n    // Links\r\n    a: {\r\n      display: Display.Inline,\r\n      color: \"#0000EE\",\r\n      textAlign: \"start\",\r\n      fontSize: 16,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n    },\r\n\r\n    // Text formatting\r\n    strong: {\r\n      display: Display.Inline,\r\n      fontSize: 16,\r\n      fontWeight: 700,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    em: {\r\n      display: Display.Inline,\r\n      fontSize: 16,\r\n      fontStyle: \"italic\",\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    b: {\r\n      display: Display.Inline,\r\n      fontSize: 16,\r\n      fontWeight: 700,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    i: {\r\n      display: Display.Inline,\r\n      fontSize: 16,\r\n      fontStyle: \"italic\",\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    s: {\r\n      display: Display.Inline,\r\n      fontSize: 16,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n      textDecorationLine: \"line-through\",\r\n    },\r\n    del: {\r\n      display: Display.Inline,\r\n      fontSize: 16,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n      textDecorationLine: \"line-through\",\r\n    },\r\n    u: {\r\n      display: Display.Inline,\r\n      fontSize: 16,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n      textDecorationLine: \"underline\",\r\n    },\r\n    strike: {\r\n      display: Display.Inline,\r\n      fontSize: 16,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n      textDecorationLine: \"line-through\",\r\n    },\r\n    code: {\r\n      display: Display.Inline,\r\n      fontSize: 14,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: \"Monaco, 'Courier New', monospace\",\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n\r\n    // Tables\r\n    table: {\r\n      display: Display.Table,\r\n      borderCollapse: \"separate\",\r\n      borderSpacing: 2,\r\n      fontSize: 16,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    thead: {\r\n      display: Display.TableHeaderGroup,\r\n      fontSize: 16,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    tbody: {\r\n      display: Display.TableRowGroup,\r\n      fontSize: 16,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    tfoot: {\r\n      display: Display.TableFooterGroup,\r\n      fontSize: 16,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    tr: {\r\n      display: Display.TableRow,\r\n      fontSize: 16,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    th: {\r\n      display: Display.TableCell,\r\n      padding: 8,\r\n      fontSize: 16,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n      fontWeight: 700,\r\n      textAlign: \"center\",\r\n      verticalAlign: \"middle\",\r\n    },\r\n    td: {\n      display: Display.TableCell,\n      padding: 8,\n      fontSize: 16,\n      lineHeight: createNormalLineHeight(),\n      fontFamily: TypographyDefaults.getFontFamily(),\n      color: TypographyDefaults.getColor(),\n      verticalAlign: \"middle\",\n    },\n\r\n    // Form elements\r\n    input: {\r\n      display: Display.InlineBlock,\r\n      padding: 2,\r\n      border: 1,\r\n      fontSize: 16,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    button: {\r\n      display: Display.InlineBlock,\r\n      padding: 2,\r\n      border: 1,\r\n      fontSize: 16,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    textarea: {\r\n      display: Display.InlineBlock,\r\n      padding: 2,\r\n      border: 1,\r\n      fontSize: 16,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n\r\n    // Divs and containers\r\n    div: {\r\n      display: Display.Block,\r\n      fontSize: 16,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n    span: {\r\n      display: Display.Inline,\r\n      fontSize: 16,\r\n      lineHeight: createNormalLineHeight(),\r\n      fontFamily: TypographyDefaults.getFontFamily(),\r\n      color: TypographyDefaults.getColor(),\r\n    },\r\n\r\n    // Images\r\n    img: {\r\n      display: Display.InlineBlock,\r\n      border: 0,\r\n    },\r\n\r\n    // Breaks\r\n    br: {\r\n      display: Display.Inline,\r\n    },\r\n  };\r\n\r\n  getDefaultsForElement(tagName: string): Partial<ElementDefaults> {\r\n    const normalizedTag = tagName.toLowerCase();\r\n    return this.elementDefaults[normalizedTag] || {};\r\n  }\r\n\r\n  getAllDefaults(): Record<string, Partial<ElementDefaults>> {\r\n    return { ...this.elementDefaults };\r\n  }\r\n}\r\n\r\nconst instance = new ElementSpecificDefaultsImpl();\r\n\r\n/**\r\n * Public, SRP-focused API:\r\n * - data and simple queries only\r\n */\r\nexport class ElementSpecificDefaults {\r\n  static getDefaultsForElement(tagName: string): Partial<ElementDefaults> {\r\n    return instance.getDefaultsForElement(tagName);\r\n  }\r\n\r\n  static getAllDefaults(): Record<string, Partial<ElementDefaults>> {\r\n    return instance.getAllDefaults();\r\n  }\r\n}\r\n", "import type { ElementDefaults } from \"./types.js\";\r\nimport { createBaseDefaultsObject } from \"./base-defaults.js\";\r\nimport { cloneLineHeight } from \"../line-height.js\";\r\n\r\n/**\r\n * Factory + merge utilities for browser-like UA defaults.\r\n * This module is responsible only for:\r\n * - creating the base defaults object\r\n * - merging element-specific overrides into it\r\n */\r\nexport class BrowserDefaults {\r\n  static createBaseDefaults(): any {\r\n    return createBaseDefaultsObject();\r\n  }\r\n\r\n  static mergeElementDefaults(baseDefaults: any, elementDefaults: Partial<ElementDefaults>): any {\r\n    const merged = { ...baseDefaults };\r\n\r\n    if (elementDefaults.fontSize !== undefined) {\r\n      merged.fontSize = elementDefaults.fontSize;\r\n    }\r\n    if (elementDefaults.fontStyle !== undefined) {\r\n      merged.fontStyle = elementDefaults.fontStyle;\r\n    }\r\n    if (elementDefaults.lineHeight !== undefined) {\r\n      merged.lineHeight = cloneLineHeight(elementDefaults.lineHeight);\r\n    }\r\n    if (elementDefaults.fontFamily !== undefined) {\r\n      merged.fontFamily = elementDefaults.fontFamily;\r\n    }\r\n    if (elementDefaults.fontWeight !== undefined) {\r\n      merged.fontWeight = elementDefaults.fontWeight;\r\n    }\r\n    if (elementDefaults.color !== undefined) {\r\n      merged.color = elementDefaults.color;\r\n    }\r\n    if (elementDefaults.borderColor !== undefined) {\r\n      merged.borderColor = elementDefaults.borderColor;\r\n    }\r\n\r\n    if (elementDefaults.margin !== undefined) {\r\n      merged.marginTop = elementDefaults.margin;\r\n      merged.marginRight = elementDefaults.margin;\r\n      merged.marginBottom = elementDefaults.margin;\r\n      merged.marginLeft = elementDefaults.margin;\r\n    }\r\n    if (elementDefaults.marginTop !== undefined) {\r\n      merged.marginTop = elementDefaults.marginTop;\r\n    }\r\n    if (elementDefaults.marginRight !== undefined) {\r\n      merged.marginRight = elementDefaults.marginRight;\r\n    }\r\n    if (elementDefaults.marginBottom !== undefined) {\r\n      merged.marginBottom = elementDefaults.marginBottom;\r\n    }\r\n    if (elementDefaults.marginLeft !== undefined) {\r\n      merged.marginLeft = elementDefaults.marginLeft;\r\n    }\r\n\r\n    if (elementDefaults.padding !== undefined) {\r\n      merged.paddingTop = elementDefaults.padding;\r\n      merged.paddingRight = elementDefaults.padding;\r\n      merged.paddingBottom = elementDefaults.padding;\r\n      merged.paddingLeft = elementDefaults.padding;\r\n    }\r\n    if (elementDefaults.paddingTop !== undefined) {\r\n      merged.paddingTop = elementDefaults.paddingTop;\r\n    }\r\n    if (elementDefaults.paddingRight !== undefined) {\r\n      merged.paddingRight = elementDefaults.paddingRight;\r\n    }\r\n    if (elementDefaults.paddingBottom !== undefined) {\r\n      merged.paddingBottom = elementDefaults.paddingBottom;\r\n    }\r\n    if (elementDefaults.paddingLeft !== undefined) {\r\n      merged.paddingLeft = elementDefaults.paddingLeft;\r\n    }\r\n\r\n    if (elementDefaults.border !== undefined) {\r\n      merged.borderTop = elementDefaults.border;\r\n      merged.borderRight = elementDefaults.border;\r\n      merged.borderBottom = elementDefaults.border;\r\n      merged.borderLeft = elementDefaults.border;\r\n    }\r\n    if (elementDefaults.borderTop !== undefined) {\r\n      merged.borderTop = elementDefaults.borderTop;\r\n    }\r\n    if (elementDefaults.borderRight !== undefined) {\r\n      merged.borderRight = elementDefaults.borderRight;\r\n    }\r\n    if (elementDefaults.borderBottom !== undefined) {\r\n      merged.borderBottom = elementDefaults.borderBottom;\r\n    }\r\n    if (elementDefaults.borderLeft !== undefined) {\r\n      merged.borderLeft = elementDefaults.borderLeft;\r\n    }\r\n\r\n    if (elementDefaults.display !== undefined) {\r\n      merged.display = elementDefaults.display;\r\n    }\r\n    if (elementDefaults.objectFit !== undefined) {\r\n      (merged as any).objectFit = elementDefaults.objectFit;\r\n    }\r\n    if (elementDefaults.textAlign !== undefined) {\r\n      merged.textAlign = elementDefaults.textAlign;\r\n    }\r\n    if (elementDefaults.textIndent !== undefined) {\r\n      (merged as any).textIndent = elementDefaults.textIndent;\r\n    }\r\n    if (elementDefaults.verticalAlign !== undefined) {\r\n      merged.verticalAlign = elementDefaults.verticalAlign;\r\n    }\r\n    if (elementDefaults.listStyleType !== undefined) {\r\n      merged.listStyleType = elementDefaults.listStyleType;\r\n    }\r\n    if (elementDefaults.textDecorationLine !== undefined) {\r\n      (merged as any).textDecorationLine = elementDefaults.textDecorationLine;\r\n    }\r\n    if (elementDefaults.overflowWrap !== undefined) {\r\n      (merged as any).overflowWrap = elementDefaults.overflowWrap;\r\n    }\r\n    if (elementDefaults.textTransform !== undefined) {\r\n      (merged as any).textTransform = elementDefaults.textTransform;\r\n    }\r\n    if (elementDefaults.borderCollapse !== undefined) {\r\n      merged.borderCollapse = elementDefaults.borderCollapse;\r\n    }\r\n    if (elementDefaults.borderSpacing !== undefined) {\r\n      merged.borderSpacing = elementDefaults.borderSpacing;\r\n    }\r\n\r\n    return merged;\r\n  }\r\n}\r\n", "// src/css/custom-properties.ts\r\n\r\n/**\r\n * CSS Custom Properties (CSS Variables) support\r\n * Implements variable definition and resolution per CSS Custom Properties spec\r\n */\r\n\r\n/**\r\n * Storage for custom properties (CSS variables)\r\n * Maps variable names (e.g., \"--primary-color\") to their raw string values\r\n */\r\nexport class CustomPropertiesMap {\r\n    private properties: Map<string, string> = new Map();\r\n\r\n    /**\r\n     * Set a custom property value\r\n     */\r\n    set(name: string, value: string): void {\r\n        // Ensure the property name starts with --\r\n        if (!name.startsWith('--')) {\r\n            return;\r\n        }\r\n        this.properties.set(name, value.trim());\r\n    }\r\n\r\n    /**\r\n     * Get a custom property value\r\n     */\r\n    get(name: string): string | undefined {\r\n        return this.properties.get(name);\r\n    }\r\n\r\n    /**\r\n     * Check if a custom property exists\r\n     */\r\n    has(name: string): boolean {\r\n        return this.properties.has(name);\r\n    }\r\n\r\n    /**\r\n     * Clone the custom properties map\r\n     */\r\n    clone(): CustomPropertiesMap {\r\n        const cloned = new CustomPropertiesMap();\r\n        this.properties.forEach((value, key) => {\r\n            cloned.set(key, value);\r\n        });\r\n        return cloned;\r\n    }\r\n\r\n    /**\r\n     * Inherit properties from a parent map\r\n     * Child properties override parent properties\r\n     */\r\n    inherit(parent: CustomPropertiesMap | undefined): CustomPropertiesMap {\r\n        if (!parent) {\r\n            return this.clone();\r\n        }\r\n\r\n        const inherited = parent.clone();\r\n        this.properties.forEach((value, key) => {\r\n            inherited.set(key, value);\r\n        });\r\n        return inherited;\r\n    }\r\n\r\n    /**\r\n     * Get all property names\r\n     */\r\n    keys(): string[] {\r\n        return Array.from(this.properties.keys());\r\n    }\r\n\r\n    /**\r\n     * Get the number of properties\r\n     */\r\n    get size(): number {\r\n        return this.properties.size;\r\n    }\r\n}\r\n\r\n/**\r\n * Regular expression to match var() function calls\r\n * Matches: var(--name) or var(--name, fallback)\r\n */\r\nconst VAR_FUNCTION_REGEX = /var\\s*\\(\\s*(--[a-zA-Z0-9_-]+)\\s*(?:,\\s*([^)]+))?\\s*\\)/g;\r\n\r\n/**\r\n * Check if a CSS value contains var() references\r\n */\r\nexport function containsVariableReference(value: string): boolean {\r\n    return value.includes('var(');\r\n}\r\n\r\n/**\r\n * Extract variable name from var() function\r\n * Example: \"var(--primary-color)\" -> \"--primary-color\"\r\n */\r\nexport function extractVariableName(varFunctionCall: string): string | null {\r\n    const match = varFunctionCall.match(/var\\s*\\(\\s*(--[a-zA-Z0-9_-]+)/);\r\n    return match ? match[1] : null;\r\n}\r\n\r\n/**\r\n * Parse var() function to extract variable name and fallback\r\n * Returns: { name: string, fallback?: string }\r\n */\r\nexport function parseVarFunction(varFunctionCall: string): { name: string; fallback?: string } | null {\r\n    const trimmed = varFunctionCall.trim();\r\n\r\n    // Match var(--name) or var(--name, fallback)\r\n    const match = trimmed.match(/^var\\s*\\(\\s*(--[a-zA-Z0-9_-]+)\\s*(?:,\\s*(.+))?\\s*\\)$/);\r\n\r\n    if (!match) {\r\n        return null;\r\n    }\r\n\r\n    return {\r\n        name: match[1],\r\n        fallback: match[2]?.trim(),\r\n    };\r\n}\r\n\r\n/**\r\n * Resolve CSS value by replacing var() references with actual values\r\n * Supports nested var() calls and fallback values\r\n */\r\nexport function resolveVariableReferences(\r\n    value: string,\r\n    customProperties: CustomPropertiesMap,\r\n    maxDepth = 10\r\n): string {\r\n    if (!containsVariableReference(value)) {\r\n        return value;\r\n    }\r\n\r\n    if (maxDepth <= 0) {\r\n        // Prevent infinite recursion\r\n        console.warn('CSS variable resolution depth limit reached');\r\n        return value;\r\n    }\r\n\r\n    let resolved = value;\r\n    const matches = value.matchAll(VAR_FUNCTION_REGEX);\r\n\r\n    for (const match of matches) {\r\n        const fullMatch = match[0];\r\n        const varName = match[1];\r\n        const fallback = match[2]?.trim();\r\n\r\n        // Try to get the variable value\r\n        let replacement = customProperties.get(varName);\r\n\r\n        // If variable not found, use fallback\r\n        if (replacement === undefined) {\r\n            if (fallback !== undefined) {\r\n                replacement = fallback;\r\n            } else {\r\n                // If no fallback, leave the var() call as-is (invalid)\r\n                console.warn(`CSS variable ${varName} not found and no fallback provided`);\r\n                continue;\r\n            }\r\n        }\r\n\r\n        // Replace this var() call\r\n        resolved = resolved.replace(fullMatch, replacement);\r\n    }\r\n\r\n    // Recursively resolve any nested var() calls\r\n    if (containsVariableReference(resolved)) {\r\n        resolved = resolveVariableReferences(resolved, customProperties, maxDepth - 1);\r\n    }\r\n\r\n    return resolved.trim();\r\n}\r\n\r\n/**\r\n * Apply custom properties from declarations to the custom properties map\r\n * Extracts all properties that start with \"--\"\r\n */\r\nexport function extractCustomProperties(\r\n    declarations: Record<string, string>\r\n): CustomPropertiesMap {\r\n    const customProps = new CustomPropertiesMap();\r\n\r\n    for (const [property, value] of Object.entries(declarations)) {\r\n        if (property.startsWith('--')) {\r\n            customProps.set(property, value);\r\n        }\r\n    }\r\n\r\n    return customProps;\r\n}\r\n\r\n/**\r\n * Resolve all property values in declarations by replacing var() references\r\n */\r\nexport function resolveDeclarationsWithVariables(\r\n    declarations: Record<string, string>,\r\n    customProperties: CustomPropertiesMap\r\n): Record<string, string> {\r\n    const resolved: Record<string, string> = {};\r\n\r\n    for (const [property, value] of Object.entries(declarations)) {\r\n        // Don't resolve custom properties themselves (they can contain var())\r\n        if (property.startsWith('--')) {\r\n            resolved[property] = value;\r\n        } else {\r\n            // Resolve var() references in regular properties\r\n            resolved[property] = resolveVariableReferences(value, customProperties);\r\n        }\r\n    }\r\n\r\n    return resolved;\r\n}\r\n", "import {\r\n  AlignContent,\r\n  AlignItems,\r\n  BorderModel,\r\n  ClearMode,\r\n  Display,\r\n  FloatMode,\r\n  JustifyContent,\r\n  OverflowMode,\r\n  Position,\r\n  TableLayoutMode,\r\n  TextWrap,\r\n  WhiteSpace,\r\n  WritingMode,\r\n} from \"./enums.js\";\r\nimport type { LengthInput, LengthLike, RelativeLength, NumericLength } from \"./length.js\";\r\nimport { BrowserDefaults } from \"./browser-defaults.js\";\r\nimport type { BackgroundLayer } from \"./background-types.js\";\r\nimport {\r\n  cloneLineHeight,\r\n  lineHeightToPx,\r\n  type LineHeightInput,\r\n  type LineHeightValue,\r\n} from \"./line-height.js\";\r\nimport { CustomPropertiesMap } from \"./custom-properties.js\";\r\n\r\n// Import domain interfaces\r\nimport type { LayoutProperties } from \"./properties/layout.js\";\r\nimport type { TypographyProperties, TextTransform, OverflowWrap } from \"./properties/typography.js\";\nimport type { BoxModelProperties } from \"./properties/box-model.js\";\nimport type { FlexboxProperties, FlexDirection, AlignSelfValue } from \"./properties/flexbox.js\";\nimport type {\n  GridProperties,\n  GridAutoFlow,\r\n  TrackSize,\r\n  TrackDefinition,\r\n  FixedTrackSize,\r\n  FlexTrackSize,\r\n  AutoTrackSize,\r\n  RepeatTrackDefinition,\r\n  AutoRepeatTrackDefinition,\r\n  TrackSizeInput,\r\n  TrackDefinitionInput,\r\n  FixedTrackSizeInput,\r\n  FlexTrackSizeInput,\r\n  AutoTrackSizeInput,\r\n  RepeatTrackDefinitionInput,\r\n  AutoRepeatTrackDefinitionInput,\r\n} from \"./properties/grid.js\";\r\nimport type {\r\n  VisualProperties,\r\n  BoxShadow,\r\n  BoxShadowInput,\r\n  TextShadow,\n  TextShadowInput,\n} from \"./properties/visual.js\";\nimport type { MiscProperties } from \"./properties/misc.js\";\nimport type { ClipPath } from \"./clip-path-types.js\";\n\r\n// Re-export types for convenience\r\nexport type { NumericLength } from \"./length.js\";\r\nexport type { LineHeightInput, LineHeightValue } from \"./line-height.js\";\r\nexport type { TextTransform, OverflowWrap };\r\nexport type { FlexDirection, AlignSelfValue };\r\nexport type { GridAutoFlow };\r\nexport type {\r\n  TrackSize,\r\n  TrackDefinition,\r\n  FixedTrackSize,\r\n  FlexTrackSize,\r\n  AutoTrackSize,\r\n  RepeatTrackDefinition,\r\n  AutoRepeatTrackDefinition,\r\n  TrackSizeInput,\r\n  TrackDefinitionInput,\r\n  FixedTrackSizeInput,\r\n  FlexTrackSizeInput,\r\n  AutoTrackSizeInput,\r\n  RepeatTrackDefinitionInput,\r\n  AutoRepeatTrackDefinitionInput,\r\n};\r\nexport type { BoxShadow, BoxShadowInput, TextShadow, TextShadowInput };\r\n\r\n\r\n// src/css/apply-declarations.ts\r\nexport interface StyleAccumulator {\r\n  display?: Display;\r\n  position?: Position;\r\n  float?: string;\r\n  color?: string;\r\n  textDecorationColor?: string;\r\n  textDecorationStyle?: string;\r\n  backgroundLayers?: BackgroundLayer[];\r\n  borderColor?: string;\n  boxShadows?: BoxShadowInput[];\n  textShadows?: TextShadowInput[];\n  transform?: string;\n  clipPath?: ClipPath;\n  borderTop?: LengthInput;\n  borderRight?: LengthInput;\n  borderBottom?: LengthInput;\n  borderLeft?: LengthInput;\n  borderTopLeftRadiusX?: NumericLength;\n  borderTopLeftRadiusY?: NumericLength;\r\n  borderTopRightRadiusX?: NumericLength;\r\n  borderTopRightRadiusY?: NumericLength;\r\n  borderBottomRightRadiusX?: NumericLength;\r\n  borderBottomRightRadiusY?: NumericLength;\r\n  borderBottomLeftRadiusX?: NumericLength;\r\n  borderBottomLeftRadiusY?: NumericLength;\r\n  borderStyleTop?: string;\r\n  borderStyleRight?: string;\r\n  borderStyleBottom?: string;\r\n  borderStyleLeft?: string;\r\n  marginTop?: LengthInput;\r\n  marginRight?: LengthInput;\r\n  marginBottom?: LengthInput;\r\n  marginLeft?: LengthInput;\r\n  paddingTop?: LengthInput;\r\n  paddingRight?: LengthInput;\r\n  paddingBottom?: LengthInput;\r\n  paddingLeft?: LengthInput;\r\n  width?: LengthInput;\r\n  minWidth?: LengthInput;\r\n  height?: LengthInput;\r\n  minHeight?: LengthInput;\r\n  maxHeight?: LengthInput;\r\n  fontSize?: number | RelativeLength;\r\n  lineHeight?: LineHeightInput;\r\n  fontFamily?: string;\r\n  fontStyle?: string;\r\n  fontVariant?: string;\r\n  fontWeight?: number;\r\n  letterSpacing?: number | RelativeLength;\r\n  borderModel?: BorderModel;\r\n  maxWidth?: LengthInput;\r\n  textAlign?: string;\r\n  textIndent?: LengthInput;\r\n  textTransform?: TextTransform;\r\n  listStyleType?: string;\r\n  objectFit?: string;\r\n\r\n  textDecorationLine?: string;\r\n  justifyContent?: JustifyContent;\r\n  alignItems?: AlignItems;\r\n  alignContent?: AlignContent;\r\n  alignSelf?: AlignSelfValue;\r\n  flexDirection?: FlexDirection;\r\n  flexWrap?: boolean;\r\n  overflowWrap?: OverflowWrap;\r\n  trackListColumns?: TrackDefinitionInput[];\r\n  trackListRows?: TrackDefinitionInput[];\r\n  autoFlow?: GridAutoFlow;\r\n  rowGap?: NumericLength;\r\n  columnGap?: NumericLength;\r\n  zIndex?: number | \"auto\";\r\n  top?: LengthInput;\r\n  right?: LengthInput;\r\n  bottom?: LengthInput;\r\n  left?: LengthInput;\r\n  opacity?: number;\r\n}\r\n\r\n/**\r\n * Complete CSS style properties.\r\n * Composed from focused domain interfaces for better organization and maintainability.\r\n */\r\nexport type StyleProperties =\r\n  LayoutProperties &\r\n  TypographyProperties &\r\n  BoxModelProperties &\r\n  FlexboxProperties &\r\n  GridProperties &\r\n  VisualProperties &\r\n  MiscProperties;\r\n\r\n\r\nconst defaultStyle = BrowserDefaults.createBaseDefaults() as StyleProperties;\r\n\r\nexport class ComputedStyle implements StyleProperties {\r\n  textAlign?: string;\r\n  verticalAlign?: string;\r\n  textDecorationLine?: string;\r\n  textDecorationColor?: string;\r\n  textDecorationStyle?: string;\r\n  textIndent: LengthLike;\r\n  textTransform: TextTransform;\r\n  transform?: string;\r\n  display: Display;\r\n  position: Position;\r\n  zIndex: number | \"auto\";\r\n  float: FloatMode;\r\n  clear: ClearMode;\r\n  overflowX: OverflowMode;\r\n  overflowY: OverflowMode;\r\n  whiteSpace: WhiteSpace;\r\n  textWrap: TextWrap;\r\n  overflowWrap: OverflowWrap;\r\n  writingMode: WritingMode;\r\n  width: LengthLike;\r\n  height: LengthLike;\r\n  minWidth?: LengthLike;\r\n  maxWidth?: LengthLike;\r\n  minHeight?: LengthLike;\r\n  maxHeight?: LengthLike;\r\n  marginTop: LengthLike;\r\n  marginRight: LengthLike;\r\n  marginBottom: LengthLike;\r\n  marginLeft: LengthLike;\r\n  paddingTop: LengthLike;\r\n  paddingRight: LengthLike;\r\n  paddingBottom: LengthLike;\r\n  paddingLeft: LengthLike;\r\n  borderTop: LengthLike;\r\n  borderRight: LengthLike;\r\n  borderBottom: LengthLike;\r\n  borderLeft: LengthLike;\r\n  borderTopLeftRadiusX: number;\r\n  borderTopLeftRadiusY: number;\r\n  borderTopRightRadiusX: number;\r\n  borderTopRightRadiusY: number;\r\n  borderBottomRightRadiusX: number;\r\n  borderBottomRightRadiusY: number;\r\n  borderBottomLeftRadiusX: number;\r\n  borderBottomLeftRadiusY: number;\r\n  borderStyleTop?: string;\r\n  borderStyleRight?: string;\r\n  borderStyleBottom?: string;\r\n  borderStyleLeft?: string;\r\n  backgroundLayers?: BackgroundLayer[];\r\n  borderColor?: string;\r\n  boxShadows: BoxShadow[];\r\n  textShadows: TextShadow[];\n  color?: string;\n  fontFamily?: string;\n  fontWeight?: number;\n  fontStyle?: string;\n  fontVariant?: string;\n  clipPath?: ClipPath;\n  objectFit?: \"contain\" | \"cover\" | \"fill\" | \"none\" | \"scale-down\";\n  left?: LengthLike;\n  right?: LengthLike;\n  top?: LengthLike;\n  bottom?: LengthLike;\n  insetInlineStart?: LengthLike;\r\n  insetInlineEnd?: LengthLike;\r\n  insetBlockStart?: LengthLike;\r\n  insetBlockEnd?: LengthLike;\r\n  fontSize: number;\r\n  lineHeight: LineHeightValue;\r\n  letterSpacing: number;\r\n  wordSpacing: number;\r\n  flexGrow: number;\r\n  flexShrink: number;\r\n  flexBasis: LengthLike;\r\n  listStyleType: string;\r\n  alignItems: AlignItems;\r\n  alignSelf: AlignSelfValue;\r\n  justifyContent: JustifyContent;\r\n  alignContent: AlignContent;\r\n  flexDirection: FlexDirection;\r\n  flexWrap: boolean;\r\n  trackListColumns: TrackDefinition[];\r\n  trackListRows: TrackDefinition[];\r\n  autoFlow: GridAutoFlow;\r\n  rowGap: number;\r\n  columnGap: number;\r\n  tableLayout: TableLayoutMode;\r\n  borderModel: BorderModel;\r\n  breakBefore: string;\r\n  breakAfter: string;\r\n  breakInside: string;\r\n  widows: number;\r\n  orphans: number;\r\n  opacity: number;\r\n  customProperties: CustomPropertiesMap;\r\n\r\n  constructor(init?: Partial<StyleProperties>) {\r\n    const data: StyleProperties = {\r\n      ...defaultStyle,\r\n      ...init,\r\n      flexBasis: init?.flexBasis ?? defaultStyle.flexBasis,\r\n      trackListColumns: [...(init?.trackListColumns ?? defaultStyle.trackListColumns)],\r\n      trackListRows: [...(init?.trackListRows ?? defaultStyle.trackListRows)],\r\n      backgroundLayers: init?.backgroundLayers ? [...init.backgroundLayers] : [],\r\n      textShadows: init?.textShadows ? [...init.textShadows] : [],\r\n    };\r\n\r\n    this.display = data.display;\r\n    this.position = data.position;\r\n    this.zIndex = data.zIndex;\r\n    this.float = data.float;\r\n    this.clear = data.clear;\r\n    this.overflowX = data.overflowX;\r\n    this.overflowY = data.overflowY;\r\n    this.whiteSpace = data.whiteSpace;\r\n    this.overflowWrap = data.overflowWrap;\r\n    this.textWrap = data.textWrap;\r\n    this.writingMode = data.writingMode;\r\n    this.width = data.width;\r\n    this.height = data.height;\r\n    this.minWidth = data.minWidth;\r\n    this.maxWidth = data.maxWidth;\r\n    this.minHeight = data.minHeight;\r\n    this.maxHeight = data.maxHeight;\r\n    this.marginTop = data.marginTop;\r\n    this.marginRight = data.marginRight;\r\n    this.marginBottom = data.marginBottom;\r\n    this.marginLeft = data.marginLeft;\r\n    this.paddingTop = data.paddingTop;\r\n    this.paddingRight = data.paddingRight;\r\n    this.paddingBottom = data.paddingBottom;\r\n    this.paddingLeft = data.paddingLeft;\r\n    this.borderTop = data.borderTop;\r\n    this.borderRight = data.borderRight;\r\n    this.borderBottom = data.borderBottom;\r\n    this.borderLeft = data.borderLeft;\r\n    this.borderTopLeftRadiusX = data.borderTopLeftRadiusX;\r\n    this.borderTopLeftRadiusY = data.borderTopLeftRadiusY;\r\n    this.borderTopRightRadiusX = data.borderTopRightRadiusX;\r\n    this.borderTopRightRadiusY = data.borderTopRightRadiusY;\r\n    this.borderBottomRightRadiusX = data.borderBottomRightRadiusX;\r\n    this.borderBottomRightRadiusY = data.borderBottomRightRadiusY;\r\n    this.borderBottomLeftRadiusX = data.borderBottomLeftRadiusX;\r\n    this.borderBottomLeftRadiusY = data.borderBottomLeftRadiusY;\r\n    this.borderStyleTop = data.borderStyleTop;\r\n    this.borderStyleRight = data.borderStyleRight;\r\n    this.borderStyleBottom = data.borderStyleBottom;\r\n    this.borderStyleLeft = data.borderStyleLeft;\r\n    this.backgroundLayers = data.backgroundLayers;\r\n    this.borderColor = data.borderColor;\r\n    this.boxShadows = [...data.boxShadows];\r\n    this.textShadows = [...data.textShadows];\n    this.color = data.color;\n    this.fontFamily = data.fontFamily;\n    this.fontWeight = data.fontWeight;\n    this.fontStyle = data.fontStyle;\n    this.fontVariant = data.fontVariant;\n    this.clipPath = data.clipPath;\n    this.objectFit = data.objectFit;\n    this.zIndex = data.zIndex;\n    this.left = data.left;\n    this.right = data.right;\n    this.top = data.top;\n    this.bottom = data.bottom;\r\n    this.insetInlineStart = data.insetInlineStart;\r\n    this.insetInlineEnd = data.insetInlineEnd;\r\n    this.insetBlockStart = data.insetBlockStart;\r\n    this.insetBlockEnd = data.insetBlockEnd;\r\n    this.fontSize = data.fontSize;\r\n    this.lineHeight = cloneLineHeight(data.lineHeight);\r\n    this.letterSpacing = data.letterSpacing;\r\n    this.wordSpacing = data.wordSpacing;\r\n    this.flexGrow = data.flexGrow;\r\n    this.flexShrink = data.flexShrink;\r\n    this.flexBasis = data.flexBasis;\r\n    this.listStyleType = data.listStyleType;\r\n    this.alignItems = data.alignItems;\r\n    this.alignSelf = data.alignSelf;\r\n    this.justifyContent = data.justifyContent;\r\n    this.alignContent = data.alignContent;\r\n    this.flexDirection = data.flexDirection;\r\n    this.flexWrap = data.flexWrap;\r\n    this.trackListColumns = data.trackListColumns;\r\n    this.trackListRows = data.trackListRows;\r\n    this.autoFlow = data.autoFlow;\r\n    this.rowGap = data.rowGap;\r\n    this.columnGap = data.columnGap;\r\n    this.tableLayout = data.tableLayout;\r\n    this.borderModel = data.borderModel;\r\n    this.breakBefore = data.breakBefore;\r\n    this.breakAfter = data.breakAfter;\r\n    this.breakInside = data.breakInside;\r\n    this.widows = data.widows;\r\n    this.orphans = data.orphans;\r\n    this.textIndent = data.textIndent;\r\n    this.textTransform = data.textTransform;\r\n    this.transform = init?.transform ?? undefined;\r\n    this.textAlign = init?.textAlign ?? undefined;\r\n    this.verticalAlign = init?.verticalAlign ?? undefined;\r\n    this.textDecorationLine = init?.textDecorationLine ?? defaultStyle.textDecorationLine;\r\n    this.textDecorationColor = init?.textDecorationColor ?? defaultStyle.textDecorationColor;\r\n    this.textDecorationStyle = init?.textDecorationStyle ?? defaultStyle.textDecorationStyle;\r\n    this.opacity = data.opacity;\r\n    this.customProperties = init?.customProperties ?? new CustomPropertiesMap();\r\n  }\r\n\r\n  get backgroundColor(): string | undefined {\r\n    if (!this.backgroundLayers) return undefined;\r\n    for (let i = this.backgroundLayers.length - 1; i >= 0; i--) {\r\n      const layer = this.backgroundLayers[i];\r\n      if (layer.kind === 'color') {\r\n        return layer.color;\r\n      }\r\n    }\r\n    return undefined;\r\n  }\r\n}\r\n\r\nexport function resolvedLineHeight(style: { lineHeight?: LineHeightValue; fontSize?: number } | null | undefined): number {\r\n  return lineHeightToPx(style?.lineHeight, style?.fontSize);\r\n}\r\n", "export class Box {\r\n  x = 0;\r\n  y = 0;\r\n  contentWidth = 0;\r\n  contentHeight = 0;\r\n  scrollWidth = 0;\r\n  scrollHeight = 0;\r\n  borderBoxWidth = 0;\r\n  borderBoxHeight = 0;\n  marginBoxWidth = 0;\n  marginBoxHeight = 0;\n  baseline = 0;\n  usedMarginLeft?: number;\n  usedMarginRight?: number;\n\r\n  clone(): Box {\r\n    const box = new Box();\r\n    box.x = this.x;\r\n    box.y = this.y;\r\n    box.contentWidth = this.contentWidth;\r\n    box.contentHeight = this.contentHeight;\r\n    box.scrollWidth = this.scrollWidth;\r\n    box.scrollHeight = this.scrollHeight;\r\n    box.borderBoxWidth = this.borderBoxWidth;\r\n    box.borderBoxHeight = this.borderBoxHeight;\r\n    box.marginBoxWidth = this.marginBoxWidth;\r\n    box.marginBoxHeight = this.marginBoxHeight;\n    box.baseline = this.baseline;\n    box.usedMarginLeft = this.usedMarginLeft;\n    box.usedMarginRight = this.usedMarginRight;\n    return box;\n  }\n}\n\r\nimport type { FontEmbedder } from \"../pdf/font/embedder.js\";\r\n\r\nexport interface Viewport {\r\n  readonly width: number;\r\n  readonly height: number;\r\n  readonly fontEmbedder?: FontEmbedder | null;\r\n}\r\n\r\nexport interface ContainingBlock {\r\n  readonly x: number;\r\n  readonly y: number;\r\n  readonly width: number;\r\n  readonly height: number;\r\n}\r\n", "import { ComputedStyle } from \"../css/style.js\";\r\nimport { Box } from \"../geometry/box.js\";\r\nimport type { LineBox } from \"../text/line-breaker.js\";\r\n\r\nexport interface InlineRun {\r\n  lineIndex: number;\r\n  startX: number;\r\n  baseline: number;\r\n  text: string;\r\n  width: number;\r\n  lineWidth: number;\r\n  spaceCount: number;\r\n  targetWidth: number;\r\n  isLastLine: boolean;\r\n}\r\n\r\nexport interface NodeVisitor {\r\n  (node: LayoutNode): void;\r\n}\r\n\r\nexport interface LayoutNodeOptions {\r\n  intrinsicInlineSize?: number;\r\n  intrinsicBlockSize?: number;\r\n  textContent?: string;\r\n  tagName?: string;\r\n  lineBoxes?: LineBox[];\r\n  inlineRuns?: InlineRun[];\r\n  customData?: Record<string, unknown>;\r\n  tableColSpan?: number;\r\n  tableRowSpan?: number;\r\n  tableCellOrigin?: { row: number; col: number };\r\n}\r\n\r\nexport class LayoutNode {\r\n  readonly box = new Box();\r\n  parent: LayoutNode | null = null;\r\n  private readonly childrenInternal: LayoutNode[] = [];\r\n\r\n  establishesBFC = false;\r\n  establishesIFC = false;\r\n  establishesFFC = false;\r\n  establishesGFC = false;\r\n  establishesTFC = false;\r\n\r\n  intrinsicInlineSize?: number;\r\n  intrinsicBlockSize?: number;\r\n  textContent?: string;\r\n  tagName?: string;\r\n  lineBoxes?: LineBox[];\r\n  inlineRuns?: InlineRun[];\r\n  customData?: Record<string, unknown>;\r\n  tableColSpan?: number;\r\n  tableRowSpan?: number;\r\n  tableCellOrigin?: { row: number; col: number };\r\n\r\n  constructor(public readonly style: ComputedStyle, children: Iterable<LayoutNode> = [], options?: LayoutNodeOptions) {\r\n    this.intrinsicInlineSize = options?.intrinsicInlineSize;\r\n    this.intrinsicBlockSize = options?.intrinsicBlockSize;\r\n    this.textContent = options?.textContent;\r\n    this.tagName = options?.tagName;\r\n    this.lineBoxes = options?.lineBoxes;\r\n    this.inlineRuns = options?.inlineRuns;\r\n    this.customData = options?.customData;\r\n    this.tableColSpan = options?.tableColSpan;\r\n    this.tableRowSpan = options?.tableRowSpan;\r\n    this.tableCellOrigin = options?.tableCellOrigin;\r\n    for (const child of children) {\r\n      this.appendChild(child);\r\n    }\r\n  }\r\n\r\n  get children(): readonly LayoutNode[] {\r\n    return this.childrenInternal;\r\n  }\r\n\r\n  appendChild(child: LayoutNode): this {\r\n    child.parent = this;\r\n    this.childrenInternal.push(child);\r\n    return this;\r\n  }\r\n\r\n  removeChild(child: LayoutNode): void {\r\n    const idx = this.childrenInternal.indexOf(child);\r\n    if (idx >= 0) {\r\n      this.childrenInternal.splice(idx, 1);\r\n      child.parent = null;\r\n    }\r\n  }\r\n\r\n  nearestAncestor(predicate: (node: LayoutNode) => boolean): LayoutNode | null {\r\n    let current: LayoutNode | null = this.parent;\r\n    while (current) {\r\n      if (predicate(current)) {\r\n        return current;\r\n      }\r\n      current = current.parent;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  walk(visitor: NodeVisitor, includeSelf = true): void {\r\n    if (includeSelf) {\r\n      visitor(this);\r\n    }\r\n    for (const child of this.childrenInternal) {\r\n      child.walk(visitor, true);\r\n    }\r\n  }\r\n\r\n  postOrder(visitor: NodeVisitor): void {\r\n    for (const child of this.childrenInternal) {\r\n      child.postOrder(visitor);\r\n    }\r\n    visitor(this);\r\n  }\r\n\r\n  shift(dx: number, dy: number): void {\r\n    this.box.x += dx;\r\n    this.box.y += dy;\r\n    this.box.baseline += dy;\r\n\r\n    if (this.inlineRuns) {\r\n      for (const run of this.inlineRuns) {\r\n        run.startX += dx;\r\n        run.baseline += dy;\r\n      }\r\n    }\r\n\r\n    for (const child of this.childrenInternal) {\r\n      child.shift(dx, dy);\r\n    }\r\n  }\r\n}\r\n", "import type { Viewport } from \"../../geometry/box.js\";\r\nimport type { FontEmbedder } from \"../../pdf/font/embedder.js\";\r\nimport type { Environment } from \"../../environment/environment.js\";\r\n\r\nexport interface LayoutEnvironmentOptions {\n  viewport: Viewport;\n  fontEmbedder: FontEmbedder | null;\n  getEnv?: Environment[\"getEnv\"];\n}\n\nexport class LayoutEnvironment {\n  private readonly envAccessor: Environment[\"getEnv\"];\n\n  constructor(private readonly options: LayoutEnvironmentOptions) {\n    this.envAccessor = options.getEnv ?? (() => undefined);\n  }\n\r\n  get viewport(): Viewport {\r\n    return this.options.viewport;\r\n  }\r\n\r\n  get fontEmbedder(): FontEmbedder | null {\n    return this.options.fontEmbedder;\n  }\n\n  getEnv(name: string): string | undefined {\n    return this.envAccessor(name);\n  }\n}\n", "import type { LayoutNode } from \"../../dom/node.js\";\nimport type { LayoutEnvironment } from \"../context/layout-environment.js\";\nimport type { LayoutContext } from \"./strategy.js\";\n\nexport interface LayoutContextFactory {\n  create(env: LayoutEnvironment, dispatcher: (node: LayoutNode) => void): LayoutContext;\n}\n\nexport class DefaultLayoutContextFactory implements LayoutContextFactory {\n  create(env: LayoutEnvironment, dispatcher: (node: LayoutNode) => void): LayoutContext {\n    return {\n      env,\n      layoutChild: dispatcher,\n    };\n  }\n}\n", "const FONT_WEIGHT_STEPS = [100, 200, 300, 400, 500, 600, 700, 800, 900] as const;\n\ntype FontWeightDirection = \"bolder\" | \"lighter\";\n\nexport function normalizeFontWeight(weight: number | undefined): number {\n  if (!Number.isFinite(weight ?? NaN)) {\n    return 400;\n  }\n  const clamped = Math.min(900, Math.max(100, weight as number));\n  let nearest = 400;\n  let smallestDiff = Math.abs(nearest - clamped);\n  for (const step of FONT_WEIGHT_STEPS) {\n    const diff = Math.abs(step - clamped);\n    if (diff < smallestDiff) {\n      smallestDiff = diff;\n      nearest = step;\n    }\n  }\n  return nearest;\n}\n\nexport function stepFontWeight(weight: number | undefined, direction: FontWeightDirection): number {\n  const normalized = normalizeFontWeight(weight);\n  const index = FONT_WEIGHT_STEPS.indexOf(normalized as (typeof FONT_WEIGHT_STEPS)[number]);\n  if (index === -1) {\n    return normalized;\n  }\n  if (direction === \"bolder\") {\n    return FONT_WEIGHT_STEPS[Math.min(FONT_WEIGHT_STEPS.length - 1, index + 1)];\n  }\n  return FONT_WEIGHT_STEPS[Math.max(0, index - 1)];\n}\n\nexport function parseFontWeightValue(value: string, inherited?: number): number | undefined {\n  const token = value.trim().toLowerCase();\n  switch (token) {\n    case \"normal\":\n      return 400;\n    case \"bold\":\n      return 700;\n    case \"bolder\":\n      return stepFontWeight(inherited, \"bolder\");\n    case \"lighter\":\n      return stepFontWeight(inherited, \"lighter\");\n    case \"inherit\":\n      return inherited !== undefined ? normalizeFontWeight(inherited) : undefined;\n    case \"initial\":\n      return 400;\n    default: {\n      const numeric = Number.parseFloat(token);\n      if (Number.isFinite(numeric)) {\n        return normalizeFontWeight(numeric);\n      }\n      return undefined;\n    }\n  }\n}\n\nexport function fontWeightCacheKey(weight: number | undefined): string {\n  return normalizeFontWeight(weight).toString();\n}\n\nexport function isBoldFontWeight(weight: number | undefined): boolean {\n  return normalizeFontWeight(weight) >= 600;\n}\n", "import type { WidthMap } from \"./widths-types.js\";\r\n\r\n/**\r\n * Character width data for Times-Roman font.\r\n * Values represent 1/1000ths of the font size.\r\n */\r\nexport const TIMES_ROMAN_WIDTHS: WidthMap = {\r\n    \"32\": 250,\r\n    \"33\": 333,\r\n    \"34\": 408,\r\n    \"35\": 500,\r\n    \"36\": 500,\r\n    \"37\": 833,\r\n    \"38\": 778,\r\n    \"39\": 333,\r\n    \"40\": 333,\r\n    \"41\": 333,\r\n    \"42\": 500,\r\n    \"43\": 564,\r\n    \"44\": 250,\r\n    \"45\": 333,\r\n    \"46\": 250,\r\n    \"47\": 278,\r\n    \"48\": 500,\r\n    \"49\": 500,\r\n    \"50\": 500,\r\n    \"51\": 500,\r\n    \"52\": 500,\r\n    \"53\": 500,\r\n    \"54\": 500,\r\n    \"55\": 500,\r\n    \"56\": 500,\r\n    \"57\": 500,\r\n    \"58\": 278,\r\n    \"59\": 278,\r\n    \"60\": 564,\r\n    \"61\": 564,\r\n    \"62\": 564,\r\n    \"63\": 444,\r\n    \"64\": 921,\r\n    \"65\": 722,\r\n    \"66\": 667,\r\n    \"67\": 667,\r\n    \"68\": 722,\r\n    \"69\": 611,\r\n    \"70\": 556,\r\n    \"71\": 722,\r\n    \"72\": 722,\r\n    \"73\": 333,\r\n    \"74\": 389,\r\n    \"75\": 722,\r\n    \"76\": 611,\r\n    \"77\": 889,\r\n    \"78\": 722,\r\n    \"79\": 722,\r\n    \"80\": 556,\r\n    \"81\": 722,\r\n    \"82\": 667,\r\n    \"83\": 556,\r\n    \"84\": 611,\r\n    \"85\": 722,\r\n    \"86\": 722,\r\n    \"87\": 944,\r\n    \"88\": 722,\r\n    \"89\": 722,\r\n    \"90\": 611,\r\n    \"91\": 333,\r\n    \"92\": 278,\r\n    \"93\": 333,\r\n    \"94\": 469,\r\n    \"95\": 500,\r\n    \"96\": 333,\r\n    \"97\": 444,\r\n    \"98\": 500,\r\n    \"99\": 444,\r\n    \"100\": 500,\r\n    \"101\": 444,\r\n    \"102\": 333,\r\n    \"103\": 500,\r\n    \"104\": 500,\r\n    \"105\": 278,\r\n    \"106\": 278,\r\n    \"107\": 500,\r\n    \"108\": 278,\r\n    \"109\": 778,\r\n    \"110\": 500,\r\n    \"111\": 500,\r\n    \"112\": 500,\r\n    \"113\": 500,\r\n    \"114\": 333,\r\n    \"115\": 389,\r\n    \"116\": 278,\r\n    \"117\": 500,\r\n    \"118\": 500,\r\n    \"119\": 722,\r\n    \"120\": 500,\r\n    \"121\": 500,\r\n    \"122\": 444,\r\n    \"123\": 480,\r\n    \"124\": 200,\r\n    \"125\": 480,\r\n    \"126\": 541,\r\n    \"161\": 333,\r\n    \"162\": 500,\r\n    \"163\": 500,\r\n    \"164\": 167,\r\n    \"165\": 500,\r\n    \"166\": 500,\r\n    \"167\": 500,\r\n    \"168\": 500,\r\n    \"169\": 180,\r\n    \"170\": 444,\r\n    \"171\": 500,\r\n    \"172\": 333,\r\n    \"173\": 333,\r\n    \"174\": 556,\r\n    \"175\": 556,\r\n    \"177\": 500,\r\n    \"178\": 500,\r\n    \"179\": 500,\r\n    \"180\": 250,\r\n    \"182\": 453,\r\n    \"183\": 350,\r\n    \"184\": 333,\r\n    \"185\": 444,\r\n    \"186\": 444,\r\n    \"187\": 500,\r\n    \"188\": 1000,\r\n    \"189\": 1000,\r\n    \"191\": 444,\r\n    \"193\": 333,\r\n    \"194\": 333,\r\n    \"195\": 333,\r\n    \"196\": 333,\r\n    \"197\": 333,\r\n    \"198\": 333,\r\n    \"199\": 333,\r\n    \"200\": 333,\r\n    \"202\": 333,\r\n    \"203\": 333,\r\n    \"205\": 333,\r\n    \"206\": 333,\r\n    \"207\": 333,\r\n    \"208\": 1000,\r\n    \"225\": 889,\r\n    \"227\": 276,\r\n    \"232\": 611,\r\n    \"233\": 722,\r\n    \"234\": 889,\r\n    \"235\": 310,\r\n    \"241\": 667,\r\n    \"245\": 278,\r\n    \"248\": 278,\r\n    \"249\": 500,\r\n    \"250\": 722,\r\n    \"251\": 500,\r\n    \"-1\": 500\r\n};\r\n", "import type { WidthMap } from \"./widths-types.js\";\r\n\r\n/**\r\n * Character width data for Times-Bold font.\r\n * Values represent 1/1000ths of the font size.\r\n */\r\nexport const TIMES_BOLD_WIDTHS: WidthMap = {\r\n    \"32\": 250,\r\n    \"33\": 333,\r\n    \"34\": 555,\r\n    \"35\": 500,\r\n    \"36\": 500,\r\n    \"37\": 1000,\r\n    \"38\": 833,\r\n    \"39\": 333,\r\n    \"40\": 333,\r\n    \"41\": 333,\r\n    \"42\": 500,\r\n    \"43\": 570,\r\n    \"44\": 250,\r\n    \"45\": 333,\r\n    \"46\": 250,\r\n    \"47\": 278,\r\n    \"48\": 500,\r\n    \"49\": 500,\r\n    \"50\": 500,\r\n    \"51\": 500,\r\n    \"52\": 500,\r\n    \"53\": 500,\r\n    \"54\": 500,\r\n    \"55\": 500,\r\n    \"56\": 500,\r\n    \"57\": 500,\r\n    \"58\": 333,\r\n    \"59\": 333,\r\n    \"60\": 570,\r\n    \"61\": 570,\r\n    \"62\": 570,\r\n    \"63\": 500,\r\n    \"64\": 930,\r\n    \"65\": 722,\r\n    \"66\": 667,\r\n    \"67\": 722,\r\n    \"68\": 722,\r\n    \"69\": 667,\r\n    \"70\": 611,\r\n    \"71\": 778,\r\n    \"72\": 778,\r\n    \"73\": 389,\r\n    \"74\": 500,\r\n    \"75\": 778,\r\n    \"76\": 667,\r\n    \"77\": 944,\r\n    \"78\": 722,\r\n    \"79\": 778,\r\n    \"80\": 611,\r\n    \"81\": 778,\r\n    \"82\": 722,\r\n    \"83\": 556,\r\n    \"84\": 667,\r\n    \"85\": 722,\r\n    \"86\": 722,\r\n    \"87\": 1000,\r\n    \"88\": 722,\r\n    \"89\": 722,\r\n    \"90\": 667,\r\n    \"91\": 333,\r\n    \"92\": 278,\r\n    \"93\": 333,\r\n    \"94\": 581,\r\n    \"95\": 500,\r\n    \"96\": 333,\r\n    \"97\": 500,\r\n    \"98\": 556,\r\n    \"99\": 444,\r\n    \"100\": 556,\r\n    \"101\": 444,\r\n    \"102\": 333,\r\n    \"103\": 500,\r\n    \"104\": 556,\r\n    \"105\": 278,\r\n    \"106\": 333,\r\n    \"107\": 556,\r\n    \"108\": 278,\r\n    \"109\": 833,\r\n    \"110\": 556,\r\n    \"111\": 500,\r\n    \"112\": 556,\r\n    \"113\": 556,\r\n    \"114\": 444,\r\n    \"115\": 389,\r\n    \"116\": 333,\r\n    \"117\": 556,\r\n    \"118\": 500,\r\n    \"119\": 722,\r\n    \"120\": 500,\r\n    \"121\": 500,\r\n    \"122\": 444,\r\n    \"123\": 394,\r\n    \"124\": 220,\r\n    \"125\": 394,\r\n    \"126\": 520,\r\n    \"161\": 333,\r\n    \"162\": 500,\r\n    \"163\": 500,\r\n    \"164\": 167,\r\n    \"165\": 500,\r\n    \"166\": 500,\r\n    \"167\": 500,\r\n    \"168\": 500,\r\n    \"169\": 278,\r\n    \"170\": 500,\r\n    \"171\": 500,\r\n    \"172\": 333,\r\n    \"173\": 333,\r\n    \"174\": 556,\r\n    \"175\": 556,\r\n    \"177\": 500,\r\n    \"178\": 500,\r\n    \"179\": 500,\r\n    \"180\": 250,\r\n    \"182\": 540,\r\n    \"183\": 350,\r\n    \"184\": 333,\r\n    \"185\": 500,\r\n    \"186\": 500,\r\n    \"187\": 500,\r\n    \"188\": 1000,\r\n    \"189\": 1000,\r\n    \"191\": 500,\r\n    \"193\": 333,\r\n    \"194\": 333,\r\n    \"195\": 333,\r\n    \"196\": 333,\r\n    \"197\": 333,\r\n    \"198\": 333,\r\n    \"199\": 333,\r\n    \"200\": 333,\r\n    \"202\": 333,\r\n    \"203\": 333,\r\n    \"205\": 333,\r\n    \"206\": 333,\r\n    \"207\": 333,\r\n    \"208\": 1000,\r\n    \"225\": 1000,\r\n    \"227\": 300,\r\n    \"232\": 667,\r\n    \"233\": 778,\r\n    \"234\": 1000,\r\n    \"235\": 330,\r\n    \"241\": 722,\r\n    \"245\": 278,\r\n    \"248\": 278,\r\n    \"249\": 500,\r\n    \"250\": 722,\r\n    \"251\": 556,\r\n    \"-1\": 500\r\n};\r\n", "import type { WidthMap } from \"./widths-types.js\";\r\n\r\n/**\r\n * Character width data for Helvetica font.\r\n * Values represent 1/1000ths of the font size.\r\n */\r\nexport const HELVETICA_WIDTHS: WidthMap = {\r\n    \"32\": 278,\r\n    \"33\": 278,\r\n    \"34\": 355,\r\n    \"35\": 556,\r\n    \"36\": 556,\r\n    \"37\": 889,\r\n    \"38\": 667,\r\n    \"39\": 222,\r\n    \"40\": 333,\r\n    \"41\": 333,\r\n    \"42\": 389,\r\n    \"43\": 584,\r\n    \"44\": 278,\r\n    \"45\": 333,\r\n    \"46\": 278,\r\n    \"47\": 278,\r\n    \"48\": 556,\r\n    \"49\": 556,\r\n    \"50\": 556,\r\n    \"51\": 556,\r\n    \"52\": 556,\r\n    \"53\": 556,\r\n    \"54\": 556,\r\n    \"55\": 556,\r\n    \"56\": 556,\r\n    \"57\": 556,\r\n    \"58\": 278,\r\n    \"59\": 278,\r\n    \"60\": 584,\r\n    \"61\": 584,\r\n    \"62\": 584,\r\n    \"63\": 556,\r\n    \"64\": 1015,\r\n    \"65\": 667,\r\n    \"66\": 667,\r\n    \"67\": 722,\r\n    \"68\": 722,\r\n    \"69\": 667,\r\n    \"70\": 611,\r\n    \"71\": 778,\r\n    \"72\": 722,\r\n    \"73\": 278,\r\n    \"74\": 500,\r\n    \"75\": 667,\r\n    \"76\": 556,\r\n    \"77\": 833,\r\n    \"78\": 722,\r\n    \"79\": 778,\r\n    \"80\": 667,\r\n    \"81\": 778,\r\n    \"82\": 722,\r\n    \"83\": 667,\r\n    \"84\": 611,\r\n    \"85\": 722,\r\n    \"86\": 667,\r\n    \"87\": 944,\r\n    \"88\": 667,\r\n    \"89\": 667,\r\n    \"90\": 611,\r\n    \"91\": 278,\r\n    \"92\": 278,\r\n    \"93\": 278,\r\n    \"94\": 469,\r\n    \"95\": 556,\r\n    \"96\": 222,\r\n    \"97\": 556,\r\n    \"98\": 556,\r\n    \"99\": 500,\r\n    \"100\": 556,\r\n    \"101\": 556,\r\n    \"102\": 278,\r\n    \"103\": 556,\r\n    \"104\": 556,\r\n    \"105\": 222,\r\n    \"106\": 222,\r\n    \"107\": 500,\r\n    \"108\": 222,\r\n    \"109\": 833,\r\n    \"110\": 556,\r\n    \"111\": 556,\r\n    \"112\": 556,\r\n    \"113\": 556,\r\n    \"114\": 333,\r\n    \"115\": 500,\r\n    \"116\": 278,\r\n    \"117\": 556,\r\n    \"118\": 500,\r\n    \"119\": 722,\r\n    \"120\": 500,\r\n    \"121\": 500,\r\n    \"122\": 500,\r\n    \"123\": 334,\r\n    \"124\": 260,\r\n    \"125\": 334,\r\n    \"126\": 584,\r\n    \"161\": 333,\r\n    \"162\": 556,\r\n    \"163\": 556,\r\n    \"164\": 167,\r\n    \"165\": 556,\r\n    \"166\": 556,\r\n    \"167\": 556,\r\n    \"168\": 556,\r\n    \"169\": 191,\r\n    \"170\": 333,\r\n    \"171\": 556,\r\n    \"172\": 333,\r\n    \"173\": 333,\r\n    \"174\": 500,\r\n    \"175\": 500,\r\n    \"177\": 556,\r\n    \"178\": 556,\r\n    \"179\": 556,\r\n    \"180\": 278,\r\n    \"182\": 537,\r\n    \"183\": 350,\r\n    \"184\": 222,\r\n    \"185\": 333,\r\n    \"186\": 333,\r\n    \"187\": 556,\r\n    \"188\": 1000,\r\n    \"189\": 1000,\r\n    \"191\": 611,\r\n    \"193\": 333,\r\n    \"194\": 333,\r\n    \"195\": 333,\r\n    \"196\": 333,\r\n    \"197\": 333,\r\n    \"198\": 333,\r\n    \"199\": 333,\r\n    \"200\": 333,\r\n    \"202\": 333,\r\n    \"203\": 333,\r\n    \"205\": 333,\r\n    \"206\": 333,\r\n    \"207\": 333,\r\n    \"208\": 1000,\r\n    \"225\": 1000,\r\n    \"227\": 370,\r\n    \"232\": 556,\r\n    \"233\": 778,\r\n    \"234\": 1000,\r\n    \"235\": 365,\r\n    \"241\": 889,\r\n    \"245\": 278,\r\n    \"248\": 222,\r\n    \"249\": 611,\r\n    \"250\": 944,\r\n    \"251\": 611,\r\n    \"-1\": 556\r\n};\r\n", "import type { WidthMap } from \"./widths-types.js\";\r\n\r\n/**\r\n * Character width data for Helvetica-Bold font.\r\n * Values represent 1/1000ths of the font size.\r\n */\r\nexport const HELVETICA_BOLD_WIDTHS: WidthMap = {\r\n    \"32\": 278,\r\n    \"33\": 333,\r\n    \"34\": 474,\r\n    \"35\": 556,\r\n    \"36\": 556,\r\n    \"37\": 889,\r\n    \"38\": 722,\r\n    \"39\": 278,\r\n    \"40\": 333,\r\n    \"41\": 333,\r\n    \"42\": 389,\r\n    \"43\": 584,\r\n    \"44\": 278,\r\n    \"45\": 333,\r\n    \"46\": 278,\r\n    \"47\": 278,\r\n    \"48\": 556,\r\n    \"49\": 556,\r\n    \"50\": 556,\r\n    \"51\": 556,\r\n    \"52\": 556,\r\n    \"53\": 556,\r\n    \"54\": 556,\r\n    \"55\": 556,\r\n    \"56\": 556,\r\n    \"57\": 556,\r\n    \"58\": 333,\r\n    \"59\": 333,\r\n    \"60\": 584,\r\n    \"61\": 584,\r\n    \"62\": 584,\r\n    \"63\": 611,\r\n    \"64\": 975,\r\n    \"65\": 722,\r\n    \"66\": 722,\r\n    \"67\": 722,\r\n    \"68\": 722,\r\n    \"69\": 667,\r\n    \"70\": 611,\r\n    \"71\": 778,\r\n    \"72\": 722,\r\n    \"73\": 278,\r\n    \"74\": 556,\r\n    \"75\": 722,\r\n    \"76\": 611,\r\n    \"77\": 833,\r\n    \"78\": 722,\r\n    \"79\": 778,\r\n    \"80\": 667,\r\n    \"81\": 778,\r\n    \"82\": 722,\r\n    \"83\": 667,\r\n    \"84\": 611,\r\n    \"85\": 722,\r\n    \"86\": 667,\r\n    \"87\": 944,\r\n    \"88\": 667,\r\n    \"89\": 667,\r\n    \"90\": 611,\r\n    \"91\": 333,\r\n    \"92\": 278,\r\n    \"93\": 333,\r\n    \"94\": 584,\r\n    \"95\": 556,\r\n    \"96\": 278,\r\n    \"97\": 556,\r\n    \"98\": 611,\r\n    \"99\": 556,\r\n    \"100\": 611,\r\n    \"101\": 556,\r\n    \"102\": 333,\r\n    \"103\": 611,\r\n    \"104\": 611,\r\n    \"105\": 278,\r\n    \"106\": 278,\r\n    \"107\": 556,\r\n    \"108\": 278,\r\n    \"109\": 889,\r\n    \"110\": 611,\r\n    \"111\": 611,\r\n    \"112\": 611,\r\n    \"113\": 611,\r\n    \"114\": 389,\r\n    \"115\": 556,\r\n    \"116\": 333,\r\n    \"117\": 611,\r\n    \"118\": 556,\r\n    \"119\": 778,\r\n    \"120\": 556,\r\n    \"121\": 556,\r\n    \"122\": 500,\r\n    \"123\": 389,\r\n    \"124\": 280,\r\n    \"125\": 389,\r\n    \"126\": 584,\r\n    \"161\": 333,\r\n    \"162\": 556,\r\n    \"163\": 556,\r\n    \"164\": 167,\r\n    \"165\": 556,\r\n    \"166\": 556,\r\n    \"167\": 556,\r\n    \"168\": 556,\r\n    \"169\": 238,\r\n    \"170\": 500,\r\n    \"171\": 556,\r\n    \"172\": 333,\r\n    \"173\": 333,\r\n    \"174\": 611,\r\n    \"175\": 611,\r\n    \"177\": 556,\r\n    \"178\": 556,\r\n    \"179\": 556,\r\n    \"180\": 278,\r\n    \"182\": 556,\r\n    \"183\": 350,\r\n    \"184\": 278,\r\n    \"185\": 500,\r\n    \"186\": 500,\r\n    \"187\": 556,\r\n    \"188\": 1000,\r\n    \"189\": 1000,\r\n    \"191\": 611,\r\n    \"193\": 333,\r\n    \"194\": 333,\r\n    \"195\": 333,\r\n    \"196\": 333,\r\n    \"197\": 333,\r\n    \"198\": 333,\r\n    \"199\": 333,\r\n    \"200\": 333,\r\n    \"202\": 333,\r\n    \"203\": 333,\r\n    \"205\": 333,\r\n    \"206\": 333,\r\n    \"207\": 333,\r\n    \"208\": 1000,\r\n    \"225\": 1000,\r\n    \"227\": 370,\r\n    \"232\": 611,\r\n    \"233\": 778,\r\n    \"234\": 1000,\r\n    \"235\": 365,\r\n    \"241\": 889,\r\n    \"245\": 278,\r\n    \"248\": 278,\r\n    \"249\": 611,\r\n    \"250\": 944,\r\n    \"251\": 611,\r\n    \"-1\": 556\r\n};\r\n", "import type { WidthMap } from \"./widths-types.js\";\r\n\r\n/**\r\n * Character width data for Courier font.\r\n * Values represent 1/1000ths of the font size.\r\n * Note: Courier is a monospaced font, so all characters have the same width.\r\n */\r\nexport const COURIER_WIDTHS: WidthMap = {\r\n    \"32\": 600,\r\n    \"33\": 600,\r\n    \"34\": 600,\r\n    \"35\": 600,\r\n    \"36\": 600,\r\n    \"37\": 600,\r\n    \"38\": 600,\r\n    \"39\": 600,\r\n    \"40\": 600,\r\n    \"41\": 600,\r\n    \"42\": 600,\r\n    \"43\": 600,\r\n    \"44\": 600,\r\n    \"45\": 600,\r\n    \"46\": 600,\r\n    \"47\": 600,\r\n    \"48\": 600,\r\n    \"49\": 600,\r\n    \"50\": 600,\r\n    \"51\": 600,\r\n    \"52\": 600,\r\n    \"53\": 600,\r\n    \"54\": 600,\r\n    \"55\": 600,\r\n    \"56\": 600,\r\n    \"57\": 600,\r\n    \"58\": 600,\r\n    \"59\": 600,\r\n    \"60\": 600,\r\n    \"61\": 600,\r\n    \"62\": 600,\r\n    \"63\": 600,\r\n    \"64\": 600,\r\n    \"65\": 600,\r\n    \"66\": 600,\r\n    \"67\": 600,\r\n    \"68\": 600,\r\n    \"69\": 600,\r\n    \"70\": 600,\r\n    \"71\": 600,\r\n    \"72\": 600,\r\n    \"73\": 600,\r\n    \"74\": 600,\r\n    \"75\": 600,\r\n    \"76\": 600,\r\n    \"77\": 600,\r\n    \"78\": 600,\r\n    \"79\": 600,\r\n    \"80\": 600,\r\n    \"81\": 600,\r\n    \"82\": 600,\r\n    \"83\": 600,\r\n    \"84\": 600,\r\n    \"85\": 600,\r\n    \"86\": 600,\r\n    \"87\": 600,\r\n    \"88\": 600,\r\n    \"89\": 600,\r\n    \"90\": 600,\r\n    \"91\": 600,\r\n    \"92\": 600,\r\n    \"93\": 600,\r\n    \"94\": 600,\r\n    \"95\": 600,\r\n    \"96\": 600,\r\n    \"97\": 600,\r\n    \"98\": 600,\r\n    \"99\": 600,\r\n    \"100\": 600,\r\n    \"101\": 600,\r\n    \"102\": 600,\r\n    \"103\": 600,\r\n    \"104\": 600,\r\n    \"105\": 600,\r\n    \"106\": 600,\r\n    \"107\": 600,\r\n    \"108\": 600,\r\n    \"109\": 600,\r\n    \"110\": 600,\r\n    \"111\": 600,\r\n    \"112\": 600,\r\n    \"113\": 600,\r\n    \"114\": 600,\r\n    \"115\": 600,\r\n    \"116\": 600,\r\n    \"117\": 600,\r\n    \"118\": 600,\r\n    \"119\": 600,\r\n    \"120\": 600,\r\n    \"121\": 600,\r\n    \"122\": 600,\r\n    \"123\": 600,\r\n    \"124\": 600,\r\n    \"125\": 600,\r\n    \"126\": 600,\r\n    \"161\": 600,\r\n    \"162\": 600,\r\n    \"163\": 600,\r\n    \"164\": 600,\r\n    \"165\": 600,\r\n    \"166\": 600,\r\n    \"167\": 600,\r\n    \"168\": 600,\r\n    \"169\": 600,\r\n    \"170\": 600,\r\n    \"171\": 600,\r\n    \"172\": 600,\r\n    \"173\": 600,\r\n    \"174\": 600,\r\n    \"175\": 600,\r\n    \"177\": 600,\r\n    \"178\": 600,\r\n    \"179\": 600,\r\n    \"180\": 600,\r\n    \"182\": 600,\r\n    \"183\": 600,\r\n    \"184\": 600,\r\n    \"185\": 600,\r\n    \"186\": 600,\r\n    \"187\": 600,\r\n    \"188\": 600,\r\n    \"189\": 600,\r\n    \"191\": 600,\r\n    \"193\": 600,\r\n    \"194\": 600,\r\n    \"195\": 600,\r\n    \"196\": 600,\r\n    \"197\": 600,\r\n    \"198\": 600,\r\n    \"199\": 600,\r\n    \"200\": 600,\r\n    \"202\": 600,\r\n    \"203\": 600,\r\n    \"205\": 600,\r\n    \"206\": 600,\r\n    \"207\": 600,\r\n    \"208\": 600,\r\n    \"225\": 600,\r\n    \"227\": 600,\r\n    \"232\": 600,\r\n    \"233\": 600,\r\n    \"234\": 600,\r\n    \"235\": 600,\r\n    \"241\": 600,\r\n    \"245\": 600,\r\n    \"248\": 600,\r\n    \"249\": 600,\r\n    \"250\": 600,\r\n    \"251\": 600,\r\n    \"-1\": 600\r\n};\r\n", "import type { WidthMap } from \"./widths-types.js\";\r\n\r\n/**\r\n * Character width data for Courier-Bold font.\r\n * Values represent 1/1000ths of the font size.\r\n * Note: Courier-Bold is a monospaced font, so all characters have the same width.\r\n */\r\nexport const COURIER_BOLD_WIDTHS: WidthMap = {\r\n    \"32\": 600,\r\n    \"33\": 600,\r\n    \"34\": 600,\r\n    \"35\": 600,\r\n    \"36\": 600,\r\n    \"37\": 600,\r\n    \"38\": 600,\r\n    \"39\": 600,\r\n    \"40\": 600,\r\n    \"41\": 600,\r\n    \"42\": 600,\r\n    \"43\": 600,\r\n    \"44\": 600,\r\n    \"45\": 600,\r\n    \"46\": 600,\r\n    \"47\": 600,\r\n    \"48\": 600,\r\n    \"49\": 600,\r\n    \"50\": 600,\r\n    \"51\": 600,\r\n    \"52\": 600,\r\n    \"53\": 600,\r\n    \"54\": 600,\r\n    \"55\": 600,\r\n    \"56\": 600,\r\n    \"57\": 600,\r\n    \"58\": 600,\r\n    \"59\": 600,\r\n    \"60\": 600,\r\n    \"61\": 600,\r\n    \"62\": 600,\r\n    \"63\": 600,\r\n    \"64\": 600,\r\n    \"65\": 600,\r\n    \"66\": 600,\r\n    \"67\": 600,\r\n    \"68\": 600,\r\n    \"69\": 600,\r\n    \"70\": 600,\r\n    \"71\": 600,\r\n    \"72\": 600,\r\n    \"73\": 600,\r\n    \"74\": 600,\r\n    \"75\": 600,\r\n    \"76\": 600,\r\n    \"77\": 600,\r\n    \"78\": 600,\r\n    \"79\": 600,\r\n    \"80\": 600,\r\n    \"81\": 600,\r\n    \"82\": 600,\r\n    \"83\": 600,\r\n    \"84\": 600,\r\n    \"85\": 600,\r\n    \"86\": 600,\r\n    \"87\": 600,\r\n    \"88\": 600,\r\n    \"89\": 600,\r\n    \"90\": 600,\r\n    \"91\": 600,\r\n    \"92\": 600,\r\n    \"93\": 600,\r\n    \"94\": 600,\r\n    \"95\": 600,\r\n    \"96\": 600,\r\n    \"97\": 600,\r\n    \"98\": 600,\r\n    \"99\": 600,\r\n    \"100\": 600,\r\n    \"101\": 600,\r\n    \"102\": 600,\r\n    \"103\": 600,\r\n    \"104\": 600,\r\n    \"105\": 600,\r\n    \"106\": 600,\r\n    \"107\": 600,\r\n    \"108\": 600,\r\n    \"109\": 600,\r\n    \"110\": 600,\r\n    \"111\": 600,\r\n    \"112\": 600,\r\n    \"113\": 600,\r\n    \"114\": 600,\r\n    \"115\": 600,\r\n    \"116\": 600,\r\n    \"117\": 600,\r\n    \"118\": 600,\r\n    \"119\": 600,\r\n    \"120\": 600,\r\n    \"121\": 600,\r\n    \"122\": 600,\r\n    \"123\": 600,\r\n    \"124\": 600,\r\n    \"125\": 600,\r\n    \"126\": 600,\r\n    \"161\": 600,\r\n    \"162\": 600,\r\n    \"163\": 600,\r\n    \"164\": 600,\r\n    \"165\": 600,\r\n    \"166\": 600,\r\n    \"167\": 600,\r\n    \"168\": 600,\r\n    \"169\": 600,\r\n    \"170\": 600,\r\n    \"171\": 600,\r\n    \"172\": 600,\r\n    \"173\": 600,\r\n    \"174\": 600,\r\n    \"175\": 600,\r\n    \"177\": 600,\r\n    \"178\": 600,\r\n    \"179\": 600,\r\n    \"180\": 600,\r\n    \"182\": 600,\r\n    \"183\": 600,\r\n    \"184\": 600,\r\n    \"185\": 600,\r\n    \"186\": 600,\r\n    \"187\": 600,\r\n    \"188\": 600,\r\n    \"189\": 600,\r\n    \"191\": 600,\r\n    \"193\": 600,\r\n    \"194\": 600,\r\n    \"195\": 600,\r\n    \"196\": 600,\r\n    \"197\": 600,\r\n    \"198\": 600,\r\n    \"199\": 600,\r\n    \"200\": 600,\r\n    \"202\": 600,\r\n    \"203\": 600,\r\n    \"205\": 600,\r\n    \"206\": 600,\r\n    \"207\": 600,\r\n    \"208\": 600,\r\n    \"225\": 600,\r\n    \"227\": 600,\r\n    \"232\": 600,\r\n    \"233\": 600,\r\n    \"234\": 600,\r\n    \"235\": 600,\r\n    \"241\": 600,\r\n    \"245\": 600,\r\n    \"248\": 600,\r\n    \"249\": 600,\r\n    \"250\": 600,\r\n    \"251\": 600,\r\n    \"-1\": 600\r\n};\r\n", "/**\n * Base14 font widths aggregator.\n * \n * This module imports and aggregates character width data for all Base14 fonts.\n * Each font's data is maintained in a separate module for better SRP and modularity.\n */\n\nimport type { Base14WidthsMap } from \"./base14/widths-types.js\";\nimport { TIMES_ROMAN_WIDTHS } from \"./base14/widths-times-roman.js\";\nimport { TIMES_BOLD_WIDTHS } from \"./base14/widths-times-bold.js\";\nimport { HELVETICA_WIDTHS } from \"./base14/widths-helvetica.js\";\nimport { HELVETICA_BOLD_WIDTHS } from \"./base14/widths-helvetica-bold.js\";\nimport { COURIER_WIDTHS } from \"./base14/widths-courier.js\";\nimport { COURIER_BOLD_WIDTHS } from \"./base14/widths-courier-bold.js\";\n\n/**\n * Complete mapping of Base14 font names to their character width data.\n * Widths are expressed in 1/1000ths of the font size.\n * \n * This maintains backward compatibility with the original base14Widths export.\n */\nexport const base14Widths: Record<string, Record<number, number>> = {\n  \"Times-Roman\": TIMES_ROMAN_WIDTHS,\n  \"Times-Bold\": TIMES_BOLD_WIDTHS,\n  \"Helvetica\": HELVETICA_WIDTHS,\n  \"Helvetica-Bold\": HELVETICA_BOLD_WIDTHS,\n  \"Courier\": COURIER_WIDTHS,\n  \"Courier-Bold\": COURIER_BOLD_WIDTHS\n};\n\n// Re-export types for consumers\nexport type { Base14FontName, Base14WidthsMap, WidthMap } from \"./base14/widths-types.js\";\n", "import type { TextTransform } from \"../css/style.js\";\n\nconst LETTER_OR_NUMBER = /[\\p{L}\\p{N}]/u;\nconst DEFAULT_LOCALE = \"en-US\";\n\nfunction capitalizeText(text: string): string {\n  let result = \"\";\n  let capitalizeNext = true;\n\n  for (const char of text) {\n    if (LETTER_OR_NUMBER.test(char)) {\n      if (capitalizeNext) {\n        result += char.toLocaleUpperCase(DEFAULT_LOCALE);\n        capitalizeNext = false;\n      } else {\n        result += char.toLocaleLowerCase(DEFAULT_LOCALE);\n      }\n      continue;\n    }\n\n    capitalizeNext = true;\n    result += char;\n  }\n\n  return result;\n}\n\nexport function applyTextTransform(text: string, transform?: TextTransform): string {\n  if (!text || !transform || transform === \"none\") {\n    return text;\n  }\n\n  switch (transform) {\n    case \"uppercase\":\n      return text.toLocaleUpperCase(DEFAULT_LOCALE);\n    case \"lowercase\":\n      return text.toLocaleLowerCase(DEFAULT_LOCALE);\n    case \"capitalize\":\n      return capitalizeText(text);\n    default:\n      return text;\n  }\n}\n", "import { LayoutNode } from \"../../dom/node.js\";\r\nimport { resolvedLineHeight } from \"../../css/style.js\";\r\nimport type { ComputedStyle } from \"../../css/style.js\";\r\nimport type { TtfFontMetrics } from \"../../types/fonts.js\";\r\nimport { normalizeFontWeight } from \"../../css/font-weight.js\";\r\nimport { base14Widths } from \"../../pdf/font/base14-widths.js\";\r\nimport { applyTextTransform } from \"../../text/text-transform.js\";\r\n\r\n// Font family pattern for monospace detection\r\nconst MONO_FAMILY_PATTERN = /(mono|code|courier|console)/i;\r\n\r\n// Character width coefficients for heuristic text width calculation\r\nconst CHARACTER_WIDTH_FACTORS = {\r\n  SPACE: 0.32,\r\n  DIGIT: 0.52,\r\n  UPPER: 0.58,\r\n  BASE: 0.5,\r\n  PUNCTUATION: 0.35,\r\n  IDEOGRAPHIC: 1.0\r\n} as const;\r\n\r\n// Heuristic width measurements tend to slightly overestimate glyph widths.\r\n// Apply a calibration factor so line breaking can pack words closer to the real layout.\r\nconst WIDTH_CALIBRATION = 0.9;\r\n\r\n// Font weight threshold above which fonts are considered bold for Base14 selection\r\nconst BASE14_BOLD_THRESHOLD = 600;\r\n\r\nconst BASE14_ALIAS = new Map<string, string>([\r\n  [\"helvetica\", \"Helvetica\"],\r\n  [\"arial\", \"Helvetica\"],\r\n  [\"sans-serif\", \"Helvetica\"],\r\n  [\"times\", \"Times-Roman\"],\r\n  [\"times-roman\", \"Times-Roman\"],\r\n  [\"times new roman\", \"Times-Roman\"],\r\n  [\"georgia\", \"Times-Roman\"],\r\n  [\"serif\", \"Times-Roman\"],\r\n  [\"courier\", \"Courier\"],\r\n  [\"courier new\", \"Courier\"],\r\n  [\"monaco\", \"Courier\"],\r\n  [\"monospace\", \"Courier\"],\r\n]);\r\n\r\nconst BASE14_BOLD_VARIANT = new Map<string, string>([\r\n  [\"Times-Roman\", \"Times-Bold\"],\r\n  [\"Helvetica\", \"Helvetica-Bold\"],\r\n  [\"Courier\", \"Courier-Bold\"],\r\n]);\r\n\r\nimport type { FontEmbedder } from \"../../pdf/font/embedder.js\";\r\n\r\nexport function assignIntrinsicTextMetrics(root: LayoutNode, fontEmbedder: FontEmbedder | null): void {\r\n  root.walk((node) => {\r\n    if (!node.textContent) {\r\n      return;\r\n    }\r\n    const trimmed = node.textContent;\r\n    if (trimmed.length === 0) {\r\n      node.intrinsicInlineSize = 0;\r\n      node.intrinsicBlockSize = resolvedLineHeight(node.style);\r\n      return;\r\n    }\r\n    const { inlineSize, blockSize } = measureText(trimmed, node.style, fontEmbedder);\r\n    node.intrinsicInlineSize = inlineSize;\r\n    node.intrinsicBlockSize = blockSize;\r\n  });\r\n}\r\n\r\nfunction measureText(\r\n  text: string,\r\n  style: ComputedStyle,\r\n  fontEmbedder: FontEmbedder | null\r\n): { inlineSize: number; blockSize: number } {\r\n  const effectiveText = applyTextTransform(text, style.textTransform);\r\n  const lines = effectiveText.split(/\\r?\\n/);\r\n  let maxLineWidth = 0;\r\n\r\n  const fontWeight = typeof style.fontWeight === \"number\" ? style.fontWeight : 400;\r\n  const fontStyle = style.fontStyle ?? \"normal\";\r\n  const fontMetrics = fontEmbedder?.getMetrics(style.fontFamily ?? \"\", fontWeight, fontStyle);\r\n\r\n  for (const line of lines) {\r\n    const glyphWidth = measureTextWithGlyphs(line, style, fontMetrics ?? null);\r\n    if (glyphWidth !== null) {\r\n      maxLineWidth = Math.max(maxLineWidth, glyphWidth);\r\n    } else {\r\n      maxLineWidth = Math.max(maxLineWidth, estimateLineWidth(line, style));\r\n    }\r\n  }\r\n  const lineHeight = resolvedLineHeight(style);\r\n  const blockSize = Math.max(lineHeight, lines.length * lineHeight);\r\n  return { inlineSize: maxLineWidth, blockSize };\r\n}\r\n\r\nexport function estimateLineWidth(line: string, style: ComputedStyle): number {\r\n  if (!line) {\r\n    return 0;\r\n  }\r\n  const fontSize = style.fontSize || 16;\r\n  const isMonospace = style.fontFamily ? MONO_FAMILY_PATTERN.test(style.fontFamily) : false;\r\n  const baseFactor = isMonospace ? 0.6 : CHARACTER_WIDTH_FACTORS.BASE;\r\n  const weightMultiplier = fontWeightWidthMultiplier(normalizeFontWeight(style.fontWeight));\r\n  const letterSpacing = style.letterSpacing ?? 0;\r\n  const wordSpacing = style.wordSpacing ?? 0;\r\n  const spacingContribution = Math.max(line.length - 1, 0) * letterSpacing + countSpaces(line) * wordSpacing;\r\n\r\n  const base14Width = measureUsingBase14(line, style);\r\n  if (base14Width !== null) {\r\n    return base14Width + spacingContribution;\r\n  }\r\n\r\n  let totalFactor = 0;\r\n\r\n  for (const char of line) {\r\n    totalFactor += factorForChar(char, baseFactor);\r\n  }\r\n\r\n  const heuristicWidth = totalFactor * fontSize * weightMultiplier;\r\n\r\n  return heuristicWidth * WIDTH_CALIBRATION + spacingContribution;\r\n}\r\n\r\nfunction measureUsingBase14(text: string, style: ComputedStyle): number | null {\r\n  const baseFont = resolveBase14Font(style);\r\n  if (!baseFont) {\r\n    return null;\r\n  }\r\n  const widths = base14Widths[baseFont];\r\n  if (!widths) {\r\n    return null;\r\n  }\r\n  const fontSize = style.fontSize || 16;\r\n  let total = 0;\r\n  for (const char of text) {\r\n    const code = char.codePointAt(0);\r\n    if (code === undefined) {\r\n      return null;\r\n    }\r\n    // Handle Unicode characters that map to WinAnsi bytes (like bullet U+2022 -> 0x95)\r\n    if (code > 255) {\r\n      if (code === 0x2022) { // bullet\r\n        const w = widths[0x95];\r\n        if (w === undefined) return null;\r\n        total += w;\r\n        continue;\r\n      }\r\n      // Try diacritic fallback via NFD base letter (e.g., \"\u00EA\" -> \"e\")\r\n      const base = char.normalize(\"NFD\").replace(/\\p{M}+/gu, \"\");\r\n      if (base && base.length === 1) {\r\n        const baseCode = base.codePointAt(0)!;\r\n        if (baseCode !== undefined && baseCode <= 255) {\r\n          const w2 = widths[baseCode];\r\n          if (w2 !== undefined) {\r\n            total += w2;\r\n            continue;\r\n          }\r\n        }\r\n      }\r\n      return null;\r\n    }\r\n    let w = widths[code];\r\n    if (w === undefined) {\r\n      // Try diacritic fallback via base letter\r\n      const base = char.normalize(\"NFD\").replace(/\\p{M}+/gu, \"\");\r\n      if (base && base.length === 1) {\r\n        const baseCode = base.codePointAt(0)!;\r\n        if (baseCode !== undefined && baseCode <= 255) {\r\n          w = widths[baseCode];\r\n        }\r\n      }\r\n      if (w === undefined) return null;\r\n    }\r\n    // Some extended entries may be overly large in datasets; clamp using base letter width\r\n    if (w >= 900) {\r\n      const base = char.normalize(\"NFD\").replace(/\\p{M}+/gu, \"\");\r\n      if (base && base.length === 1) {\r\n        const baseCode = base.codePointAt(0)!;\r\n        if (baseCode !== undefined && baseCode <= 255) {\r\n          const fallback = widths[baseCode];\r\n          if (fallback !== undefined) {\r\n            w = fallback;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    total += w;\r\n  }\r\n  return (total / 1000) * fontSize;\r\n}\r\n\r\nfunction resolveBase14Font(style: ComputedStyle): string | null {\r\n  const tokens = parseFontFamily(style.fontFamily);\r\n  if (tokens.length === 0) {\r\n    return null;\r\n  }\r\n  const normalizedWeight = normalizeFontWeight(style.fontWeight);\r\n  for (const token of tokens) {\r\n    const alias = BASE14_ALIAS.get(token);\r\n    if (!alias) {\r\n      continue;\r\n    }\r\n    if (normalizedWeight >= BASE14_BOLD_THRESHOLD) {\r\n      const boldVariant = BASE14_BOLD_VARIANT.get(alias);\r\n      if (boldVariant) {\r\n        return boldVariant;\r\n      }\r\n    }\r\n    return alias;\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction parseFontFamily(value: string | undefined): string[] {\r\n  if (!value) {\r\n    return [];\r\n  }\r\n  return value\r\n    .split(\",\")\r\n    .map((token) => stripQuotes(token.trim()).toLowerCase())\r\n    .filter((token) => token.length > 0);\r\n}\r\n\r\nfunction stripQuotes(value: string): string {\r\n  if ((value.startsWith('\"') && value.endsWith('\"')) || (value.startsWith(\"'\") && value.endsWith(\"'\"))) {\r\n    return value.slice(1, -1);\r\n  }\r\n  return value;\r\n}\r\n\r\nfunction factorForChar(char: string, baseFactor: number): number {\r\n  if (char === \" \") {\r\n    return CHARACTER_WIDTH_FACTORS.SPACE;\r\n  }\r\n  if (char === \"\\t\") {\r\n    return CHARACTER_WIDTH_FACTORS.SPACE * 4; // Tab is 4 spaces\r\n  }\r\n  if (isDigit(char)) {\r\n    return CHARACTER_WIDTH_FACTORS.DIGIT;\r\n  }\r\n  if (isUpperCase(char)) {\r\n    return baseFactor + (CHARACTER_WIDTH_FACTORS.UPPER - CHARACTER_WIDTH_FACTORS.BASE);\r\n  }\r\n  if (isPunctuation(char)) {\r\n    return CHARACTER_WIDTH_FACTORS.PUNCTUATION;\r\n  }\r\n  if (isIdeograph(char)) {\r\n    return CHARACTER_WIDTH_FACTORS.IDEOGRAPHIC;\r\n  }\r\n  return baseFactor;\r\n}\r\n\r\nfunction isUpperCase(char: string): boolean {\r\n  return char >= \"A\" && char <= \"Z\";\r\n}\r\n\r\nfunction isDigit(char: string): boolean {\r\n  return char >= \"0\" && char <= \"9\";\r\n}\r\n\r\nfunction isPunctuation(char: string): boolean {\r\n  return /[.,;:!?'\"`~\\-_/\\\\()[\\]{}<>]/.test(char);\r\n}\r\n\r\nfunction isIdeograph(char: string): boolean {\r\n  const code = char.codePointAt(0);\r\n  if (code === undefined) {\r\n    return false;\r\n  }\r\n  return (\r\n    (code >= 0x4e00 && code <= 0x9fff) || // CJK Unified Ideographs\r\n    (code >= 0x3400 && code <= 0x4dbf) || // CJK Unified Ideographs Extension A\r\n    (code >= 0xf900 && code <= 0xfaff) || // CJK Compatibility Ideographs\r\n    (code >= 0x3040 && code <= 0x309f) || // Hiragana\r\n    (code >= 0x30a0 && code <= 0x30ff) || // Katakana\r\n    (code >= 0xac00 && code <= 0xd7af) // Hangul Syllables\r\n  );\r\n}\r\n\r\nfunction countSpaces(line: string): number {\r\n  let count = 0;\r\n  for (const char of line) {\r\n    if (char === \" \") {\r\n      count += 1;\r\n    }\r\n  }\r\n  return count;\r\n}\r\n\r\nexport function measureTextWithGlyphs(\r\n  text: string,\r\n  style: ComputedStyle,\r\n  fontMetrics: TtfFontMetrics | null\r\n): number | null {\r\n  if (!fontMetrics) {\r\n    return null;\r\n  }\r\n\r\n  let totalWidth = 0;\r\n  for (const char of text) {\r\n    const codePoint = char.codePointAt(0);\r\n    if (codePoint === undefined) {\r\n      continue;\r\n    }\r\n    const glyphId = fontMetrics.cmap.getGlyphId(codePoint);\r\n    const glyphMetrics = fontMetrics.glyphMetrics.get(glyphId);\r\n    if (glyphMetrics) {\r\n      totalWidth += glyphMetrics.advanceWidth;\r\n    }\r\n  }\r\n\r\n  const scale = style.fontSize / fontMetrics.metrics.unitsPerEm;\r\n  const baseWidthPx = totalWidth * scale;\r\n  const letterSpacing = style.letterSpacing ?? 0;\r\n  const wordSpacing = style.wordSpacing ?? 0;\r\n  const spacingContribution =\r\n    Math.max(text.length - 1, 0) * letterSpacing + countSpaces(text) * wordSpacing;\r\n\r\n  return baseWidthPx + spacingContribution;\r\n}\r\n\r\nfunction fontWeightWidthMultiplier(weight: number): number {\r\n  switch (weight) {\r\n    case 100:\r\n      return 0.92;\r\n    case 200:\r\n      return 0.94;\r\n    case 300:\r\n      return 0.96;\r\n    case 400:\r\n      return 1;\r\n    case 500:\r\n      return 1.02;\r\n    case 600:\r\n      return 1.04;\r\n    case 700:\r\n      return 1.08;\r\n    case 800:\r\n      return 1.1;\r\n    case 900:\r\n      return 1.12;\r\n    default:\r\n      return 1;\r\n  }\r\n}\r\n", "import type { LayoutNode } from \"../../dom/node.js\";\nimport type { FontEmbedder } from \"../../pdf/font/embedder.js\";\nimport { assignIntrinsicTextMetrics } from \"../utils/text-metrics.js\";\n\nexport interface TextMetricsInitializer {\n  assign(root: LayoutNode, fontEmbedder: FontEmbedder | null): void;\n}\n\nexport class DefaultTextMetricsInitializer implements TextMetricsInitializer {\n  assign(root: LayoutNode, fontEmbedder: FontEmbedder | null): void {\n    assignIntrinsicTextMetrics(root, fontEmbedder);\n  }\n}\n", "import { LayoutNode } from \"../../dom/node.js\";\r\nimport { Display, FloatMode, OverflowMode, Position } from \"../../css/enums.js\";\r\nimport { clampMinMax, resolveLength, isAutoLength, type LengthLike } from \"../../css/length.js\";\r\nimport type { ContainingBlock, Viewport } from \"../../geometry/box.js\";\r\n\r\nexport interface BoxMetrics {\r\n  paddingLeft: number;\r\n  paddingRight: number;\r\n  paddingTop: number;\r\n  paddingBottom: number;\r\n  borderLeft: number;\r\n  borderRight: number;\r\n  borderTop: number;\r\n  borderBottom: number;\r\n  contentBoxX: number;\r\n  contentBoxY: number;\r\n}\r\n\r\nexport function resolveBoxMetrics(node: LayoutNode, widthRef: number, heightRef: number): BoxMetrics {\r\n  const { style } = node;\r\n  const paddingLeft = resolveLength(style.paddingLeft, widthRef, { auto: \"zero\" });\r\n  const paddingRight = resolveLength(style.paddingRight, widthRef, { auto: \"zero\" });\r\n  const paddingTop = resolveLength(style.paddingTop, heightRef, { auto: \"zero\" });\r\n  const paddingBottom = resolveLength(style.paddingBottom, heightRef, { auto: \"zero\" });\r\n  const borderLeft = resolveLength(style.borderLeft, widthRef, { auto: \"zero\" });\r\n  const borderRight = resolveLength(style.borderRight, widthRef, { auto: \"zero\" });\r\n  const borderTop = resolveLength(style.borderTop, heightRef, { auto: \"zero\" });\r\n  const borderBottom = resolveLength(style.borderBottom, heightRef, { auto: \"zero\" });\r\n\r\n  return {\r\n    paddingLeft,\r\n    paddingRight,\r\n    paddingTop,\r\n    paddingBottom,\r\n    borderLeft,\r\n    borderRight,\r\n    borderTop,\r\n    borderBottom,\r\n    contentBoxX: node.box.x + borderLeft + paddingLeft,\r\n    contentBoxY: node.box.y + borderTop + paddingTop,\r\n  };\r\n}\r\n\r\nexport function horizontalNonContent(node: LayoutNode, reference: number): number {\r\n  const { style } = node;\r\n  return (\r\n    resolveLength(style.paddingLeft, reference, { auto: \"zero\" }) +\r\n    resolveLength(style.paddingRight, reference, { auto: \"zero\" }) +\r\n    resolveLength(style.borderLeft, reference, { auto: \"zero\" }) +\r\n    resolveLength(style.borderRight, reference, { auto: \"zero\" })\r\n  );\r\n}\r\n\r\nexport function verticalNonContent(node: LayoutNode, reference: number): number {\r\n  const { style } = node;\r\n  return (\r\n    resolveLength(style.paddingTop, reference, { auto: \"zero\" }) +\r\n    resolveLength(style.paddingBottom, reference, { auto: \"zero\" }) +\r\n    resolveLength(style.borderTop, reference, { auto: \"zero\" }) +\r\n    resolveLength(style.borderBottom, reference, { auto: \"zero\" })\r\n  );\r\n}\r\n\r\nexport function horizontalMargin(node: LayoutNode, reference: number): number {\r\n  const { style } = node;\r\n  return resolveLength(style.marginLeft, reference, { auto: \"zero\" }) + resolveLength(style.marginRight, reference, { auto: \"zero\" });\r\n}\r\n\r\nexport function verticalMargin(node: LayoutNode, reference: number): number {\r\n  const { style } = node;\r\n  return resolveLength(style.marginTop, reference, { auto: \"zero\" }) + resolveLength(style.marginBottom, reference, { auto: \"zero\" });\r\n}\r\n\r\nexport function inFlow(node: LayoutNode): boolean {\r\n  const { position, float: floatMode } = node.style;\r\n  const isFlowPosition = position === Position.Static || position === Position.Relative || position === Position.Sticky;\r\n  return isFlowPosition && floatMode === FloatMode.None;\r\n}\r\n\r\nexport function establishesBFC(node: LayoutNode): boolean {\r\n  const { style } = node;\r\n  return (\r\n    style.float !== FloatMode.None ||\r\n    style.position === Position.Absolute ||\r\n    style.position === Position.Fixed ||\r\n    overflowCreatesBFC(style.overflowX) ||\r\n    overflowCreatesBFC(style.overflowY) ||\r\n    style.display === Display.InlineBlock ||\r\n    style.display === Display.Table ||\r\n    style.display === Display.InlineTable ||\r\n    style.display === Display.FlowRoot\r\n  );\r\n}\r\n\r\nfunction overflowCreatesBFC(mode: OverflowMode): boolean {\r\n  switch (mode) {\r\n    case OverflowMode.Hidden:\r\n    case OverflowMode.Auto:\r\n    case OverflowMode.Scroll:\r\n    case OverflowMode.Clip:\r\n      return true;\r\n    default:\r\n      return false;\r\n  }\r\n}\r\n\r\nexport function nearestPositionedAncestor(node: LayoutNode): LayoutNode | null {\r\n  return node.nearestAncestor((ancestor) => {\r\n    const position = ancestor.style.position;\r\n    return position === Position.Relative || position === Position.Absolute || position === Position.Fixed || position === Position.Sticky;\r\n  });\r\n}\r\n\r\nexport function containingBlock(node: LayoutNode, viewport: Viewport): ContainingBlock {\r\n  const { style } = node;\r\n  if (style.position === Position.Fixed) {\r\n    return { x: 0, y: 0, width: viewport.width, height: viewport.height };\r\n  }\r\n  if (style.position === Position.Absolute) {\r\n    const ancestor = nearestPositionedAncestor(node);\r\n    if (ancestor) {\r\n      return {\r\n        x: ancestor.box.x,\r\n        y: ancestor.box.y,\r\n        width: ancestor.box.contentWidth,\r\n        height: ancestor.box.contentHeight,\r\n      };\r\n    }\r\n    return { x: 0, y: 0, width: viewport.width, height: viewport.height };\r\n  }\r\n\r\n  const parent = node.parent;\r\n  if (!parent) {\r\n    return { x: 0, y: 0, width: viewport.width, height: viewport.height };\r\n  }\r\n\r\n  const widthRef = Math.max(parent.box.contentWidth, 0);\r\n  let heightRef = Math.max(parent.box.contentHeight, 0);\r\n\r\n  // If the parent has an explicit height but its content height has not\r\n  // been resolved yet (common when laying out flex/grid children before\r\n  // the block container finalizes), fall back to the specified height.\r\n  // This allows percentage heights like `height: 100%` on flex children\r\n  // to resolve against a definite containing block height instead of 0.\r\n  if (heightRef === 0 && parent.style.height !== \"auto\") {\r\n    const explicitHeight = resolveLength(parent.style.height, viewport.height, { auto: \"reference\" });\r\n    if (Number.isFinite(explicitHeight) && explicitHeight > 0) {\r\n      heightRef = explicitHeight;\r\n    }\r\n  }\r\n  const xOffset =\r\n    parent.box.x +\r\n    resolveLength(parent.style.paddingLeft, widthRef, { auto: \"zero\" }) +\r\n    resolveLength(parent.style.borderLeft, widthRef, { auto: \"zero\" });\r\n  const yOffset =\r\n    parent.box.y +\r\n    resolveLength(parent.style.paddingTop, heightRef, { auto: \"zero\" }) +\r\n    resolveLength(parent.style.borderTop, heightRef, { auto: \"zero\" });\r\n\r\n  return {\r\n    x: xOffset,\r\n    y: yOffset,\r\n    width: parent.box.contentWidth,\r\n    height: heightRef,\r\n  };\r\n}\r\n\r\nexport function resolveWidthBlock(node: LayoutNode, containingBlockWidth: number): number {\r\n  const style = node.style;\r\n  const marginLeft = isAutoLength(style.marginLeft)\r\n    ? 0\r\n    : resolveLength(style.marginLeft, containingBlockWidth, { auto: \"zero\" });\r\n  const marginRight = isAutoLength(style.marginRight)\r\n    ? 0\r\n    : resolveLength(style.marginRight, containingBlockWidth, { auto: \"zero\" });\r\n  const available = Math.max(\r\n    0,\r\n    containingBlockWidth - horizontalNonContent(node, containingBlockWidth) - marginLeft - marginRight,\r\n  );\r\n  const width =\r\n    style.width === \"auto\"\r\n      ? available\r\n      : resolveLength(style.width, containingBlockWidth, {\r\n        auto: \"reference\",\r\n      });\r\n  const minWidth = style.minWidth ? resolveLength(style.minWidth, containingBlockWidth, { auto: \"zero\" }) : Number.NEGATIVE_INFINITY;\r\n  const maxWidth = style.maxWidth ? resolveLength(style.maxWidth, containingBlockWidth, { auto: \"reference\" }) : Number.POSITIVE_INFINITY;\r\n  return clampMinMax(width, minWidth, maxWidth);\r\n}\r\n\r\nexport function resolveBlockAutoMargins(\r\n  containingBlockWidth: number,\r\n  borderBoxWidth: number,\r\n  marginLeft: LengthLike,\r\n  marginRight: LengthLike,\r\n): { marginLeft: number; marginRight: number } {\r\n  const marginLeftAuto = isAutoLength(marginLeft);\r\n  const marginRightAuto = isAutoLength(marginRight);\r\n\r\n  const resolvedMarginLeft = marginLeftAuto ? 0 : resolveLength(marginLeft, containingBlockWidth, { auto: \"zero\" });\r\n  const resolvedMarginRight = marginRightAuto ? 0 : resolveLength(marginRight, containingBlockWidth, { auto: \"zero\" });\r\n\r\n  let usedMarginLeft = resolvedMarginLeft;\r\n  let usedMarginRight = resolvedMarginRight;\r\n\r\n  const remainingSpace = containingBlockWidth - (borderBoxWidth + resolvedMarginLeft + resolvedMarginRight);\r\n\r\n  if (!Number.isFinite(remainingSpace)) {\r\n    return { marginLeft: usedMarginLeft, marginRight: usedMarginRight };\r\n  }\r\n\r\n  if (remainingSpace < 0) {\r\n    if (marginLeftAuto && marginRightAuto) {\r\n      usedMarginLeft = 0;\r\n      usedMarginRight = 0;\r\n    } else if (marginLeftAuto) {\r\n      usedMarginLeft = 0;\r\n    } else if (marginRightAuto) {\r\n      usedMarginRight = 0;\r\n    } else {\r\n      usedMarginRight = resolvedMarginRight + remainingSpace;\r\n    }\r\n  } else {\r\n    if (marginLeftAuto && marginRightAuto) {\r\n      usedMarginLeft = remainingSpace / 2;\r\n      usedMarginRight = remainingSpace / 2;\r\n    } else if (marginLeftAuto) {\r\n      usedMarginLeft = remainingSpace;\r\n    } else if (marginRightAuto) {\r\n      usedMarginRight = remainingSpace;\r\n    } else {\r\n      usedMarginRight = resolvedMarginRight + remainingSpace;\r\n    }\r\n  }\r\n\r\n  return { marginLeft: usedMarginLeft, marginRight: usedMarginRight };\r\n}\r\n", "import type { LayoutNode } from \"../../dom/node.js\";\nimport { Position } from \"../../css/enums.js\";\nimport { resolveLength, isAutoLength } from \"../../css/length.js\";\nimport type { LayoutContext } from \"./strategy.js\";\nimport { containingBlock } from \"../utils/node-math.js\";\nimport type { LayoutEnvironment } from \"../context/layout-environment.js\";\n\nexport interface OutOfFlowManager {\n  layoutOutOfFlow(\n    root: LayoutNode,\n    context: LayoutContext,\n    dispatcher: (node: LayoutNode, context: LayoutContext) => void\n  ): void;\n}\n\nexport class DefaultOutOfFlowManager implements OutOfFlowManager {\n  layoutOutOfFlow(\n    root: LayoutNode,\n    context: LayoutContext,\n    dispatcher: (node: LayoutNode, context: LayoutContext) => void\n  ): void {\n    const positionedNodes: LayoutNode[] = [];\n    root.walk((node) => {\n      if (node.style.position === Position.Absolute || node.style.position === Position.Fixed) {\n        positionedNodes.push(node);\n      }\n    });\n    for (const node of positionedNodes) {\n      dispatcher(node, context);\n      this.positionAbsoluteOrFixed(node, context.env);\n    }\n  }\n\n  private positionAbsoluteOrFixed(node: LayoutNode, env: LayoutEnvironment): void {\n    const cb = containingBlock(node, env.viewport);\n    const widthRef = cb.width;\n    const heightRef = cb.height;\n\n    const resolveInset = (value: typeof node.style.left, reference: number): number | undefined => {\n      if (value === undefined || isAutoLength(value)) {\n        return undefined;\n      }\n      return resolveLength(value, reference, { auto: \"zero\" });\n    };\n\n    const left = resolveInset(node.style.left, widthRef);\n    const right = resolveInset(node.style.right, widthRef);\n    const top = resolveInset(node.style.top, heightRef);\n    const bottom = resolveInset(node.style.bottom, heightRef);\n\n    const borderBoxWidth = node.box.borderBoxWidth || node.box.contentWidth;\n    const borderBoxHeight = node.box.borderBoxHeight || node.box.contentHeight;\n    const measuredWidth = node.box.marginBoxWidth || borderBoxWidth;\n    const measuredHeight = node.box.marginBoxHeight || borderBoxHeight;\n\n    let x = cb.x;\n    if (left !== undefined) {\n      x = cb.x + left;\n    } else if (right !== undefined) {\n      x = cb.x + cb.width - measuredWidth - right;\n    }\n\n    let y = cb.y;\n    if (top !== undefined) {\n      y = cb.y + top;\n    } else if (bottom !== undefined) {\n      y = cb.y + cb.height - measuredHeight - bottom;\n    }\n\n    node.box.x = x;\n    node.box.y = y;\n  }\n}\n", "import { LayoutNode } from \"../../dom/node.js\";\r\nimport type { Viewport } from \"../../geometry/box.js\";\r\nimport { LayoutEnvironment } from \"../context/layout-environment.js\";\nimport type { FontEmbedder } from \"../../pdf/font/embedder.js\";\nimport type { LayoutStrategy, LayoutContext } from \"./strategy.js\";\nimport type { LayoutContextFactory } from \"./context-factory.js\";\nimport { DefaultLayoutContextFactory } from \"./context-factory.js\";\nimport type { TextMetricsInitializer } from \"./text-metrics-initializer.js\";\nimport { DefaultTextMetricsInitializer } from \"./text-metrics-initializer.js\";\nimport type { OutOfFlowManager } from \"./out-of-flow-manager.js\";\nimport { DefaultOutOfFlowManager } from \"./out-of-flow-manager.js\";\n\r\nexport interface LayoutEngineOptions {\n  strategies: readonly LayoutStrategy[];\n  contextFactory?: LayoutContextFactory;\n  textMetricsInitializer?: TextMetricsInitializer;\n  outOfFlowManager?: OutOfFlowManager;\n}\n\nexport class LayoutEngine {\n  private readonly strategies: readonly LayoutStrategy[];\n  private readonly contextFactory: LayoutContextFactory;\n  private readonly textMetricsInitializer: TextMetricsInitializer;\n  private readonly outOfFlowManager: OutOfFlowManager;\n\n  constructor(options: LayoutEngineOptions) {\n    this.strategies = options.strategies;\n    this.contextFactory = options.contextFactory ?? new DefaultLayoutContextFactory();\n    this.textMetricsInitializer = options.textMetricsInitializer ?? new DefaultTextMetricsInitializer();\n    this.outOfFlowManager = options.outOfFlowManager ?? new DefaultOutOfFlowManager();\n  }\n\n  layoutTree(root: LayoutNode, viewport: Viewport, fontEmbedder: FontEmbedder | null): LayoutNode {\n    const environment = new LayoutEnvironment({ viewport, fontEmbedder });\n    const context: LayoutContext = this.contextFactory.create(environment, (node: LayoutNode) => {\n      this.layoutNodeInternal(node, context);\n    });\n\n    this.textMetricsInitializer.assign(root, fontEmbedder);\n\r\n    root.box.x = 0;\r\n    root.box.y = 0;\r\n    root.box.contentWidth = viewport.width;\r\n    root.box.contentHeight = viewport.height;\r\n\r\n    this.layoutNodeInternal(root, context);\r\n    this.outOfFlowManager.layoutOutOfFlow(root, context, (node, ctx) => this.layoutNodeInternal(node, ctx));\n    // Fragmentation is not yet implemented - placeholder for future expansion.\n    return root;\n  }\n\r\n  private layoutNodeInternal(node: LayoutNode, context: LayoutContext): void {\n    const strategy = this.strategies.find((s) => s.canLayout(node));\n    if (!strategy) {\n      throw new Error(`No layout strategy available for display: ${node.style.display}`);\n    }\n    strategy.layout(node, context);\n  }\n}\n", "import { LayoutNode } from \"../../dom/node.js\";\nimport { Display } from \"../../css/enums.js\";\nimport type { LayoutContext, LayoutStrategy } from \"../pipeline/strategy.js\";\n\nexport class DisplayNoneStrategy implements LayoutStrategy {\n  canLayout(node: LayoutNode): boolean {\n    return node.style.display === Display.None;\n  }\n\n  layout(node: LayoutNode, _context: LayoutContext): void {\n    node.box.contentWidth = 0;\n    node.box.contentHeight = 0;\n  }\n}\n", "import { LayoutNode } from \"../../dom/node.js\";\r\nimport { Display } from \"../../css/enums.js\";\r\nimport { resolveLength } from \"../../css/length.js\";\r\nimport { establishesBFC, inFlow, resolveWidthBlock } from \"./node-math.js\";\r\n\r\nconst EPSILON = 1e-7;\r\n\r\nfunction isApproximatelyZero(value: number): boolean {\r\n  return Math.abs(value) < EPSILON;\r\n}\r\n\r\nfunction isBlockLevel(node: LayoutNode): boolean {\r\n  switch (node.style.display) {\r\n    case Display.Block:\r\n    case Display.ListItem:\r\n      return true;\r\n    default:\r\n      return false;\r\n  }\r\n}\r\n\r\nfunction isMarginCollapsibleChild(node: LayoutNode): boolean {\r\n  return node.style.display !== Display.None && inFlow(node) && isBlockLevel(node) && !establishesBFC(node);\r\n}\r\n\r\nexport function collapseMarginSet(margins: readonly number[]): number {\r\n  const positives: number[] = [];\r\n  const negatives: number[] = [];\r\n  for (const margin of margins) {\r\n    if (margin > 0) {\r\n      positives.push(margin);\r\n    } else if (margin < 0) {\r\n      negatives.push(margin);\r\n    }\r\n  }\r\n\r\n  if (negatives.length === 0) {\r\n    return positives.length > 0 ? Math.max(...positives) : 0;\r\n  }\r\n  if (positives.length === 0) {\r\n    return Math.min(...negatives);\r\n  }\r\n  return Math.max(...positives) + Math.min(...negatives);\r\n}\r\n\r\nexport function collapsedGapBetween(\r\n  prevBottomMargin: number,\r\n  nextTopMargin: number,\r\n  parentEstablishesBfc: boolean,\r\n): number {\r\n  if (parentEstablishesBfc) {\r\n    return prevBottomMargin + nextTopMargin;\r\n  }\r\n  return collapseMarginSet([prevBottomMargin, nextTopMargin]);\r\n}\r\n\r\nexport function findFirstMarginCollapsibleChild(node: LayoutNode): LayoutNode | undefined {\r\n  for (const child of node.children) {\r\n    if (!inFlow(child) || child.style.display === Display.None) {\r\n      continue;\r\n    }\r\n    if (isMarginCollapsibleChild(child)) {\r\n      return child;\r\n    }\r\n    break;\r\n  }\r\n  return undefined;\r\n}\r\n\r\nexport function findLastMarginCollapsibleChild(node: LayoutNode): LayoutNode | undefined {\r\n  for (let i = node.children.length - 1; i >= 0; i -= 1) {\r\n    const child = node.children[i];\r\n    if (!inFlow(child) || child.style.display === Display.None) {\r\n      continue;\r\n    }\r\n    if (isMarginCollapsibleChild(child)) {\r\n      return child;\r\n    }\r\n    break;\r\n  }\r\n  return undefined;\r\n}\r\n\r\nexport function canCollapseMarginStart(node: LayoutNode, containingBlockWidth: number): boolean {\r\n  if (!isBlockLevel(node) || establishesBFC(node)) {\r\n    return false;\r\n  }\r\n  const paddingTop = resolveLength(node.style.paddingTop, containingBlockWidth, { auto: \"zero\" });\r\n  const borderTop = resolveLength(node.style.borderTop, containingBlockWidth, { auto: \"zero\" });\r\n  if (!isApproximatelyZero(paddingTop) || !isApproximatelyZero(borderTop)) {\r\n    return false;\r\n  }\r\n  return findFirstMarginCollapsibleChild(node) !== undefined;\r\n}\r\n\r\nexport function canCollapseMarginEnd(node: LayoutNode, containingBlockWidth: number): boolean {\r\n  if (!isBlockLevel(node) || establishesBFC(node)) {\r\n    return false;\r\n  }\r\n  const paddingBottom = resolveLength(node.style.paddingBottom, containingBlockWidth, { auto: \"zero\" });\r\n  const borderBottom = resolveLength(node.style.borderBottom, containingBlockWidth, { auto: \"zero\" });\r\n  if (!isApproximatelyZero(paddingBottom) || !isApproximatelyZero(borderBottom)) {\r\n    return false;\r\n  }\r\n  return findLastMarginCollapsibleChild(node) !== undefined;\r\n}\r\n\r\nexport function effectiveMarginTop(node: LayoutNode, containingBlockWidth: number): number {\r\n  const ownMargin = resolveLength(node.style.marginTop, containingBlockWidth, { auto: \"zero\" });\r\n  if (!isBlockLevel(node)) {\r\n    return ownMargin;\r\n  }\r\n  if (!canCollapseMarginStart(node, containingBlockWidth)) {\r\n    return ownMargin;\r\n  }\r\n  const firstChild = findFirstMarginCollapsibleChild(node);\r\n  if (!firstChild) {\r\n    return ownMargin;\r\n  }\r\n  const childContainingWidth = resolveWidthBlock(node, containingBlockWidth);\r\n  const childMargin = effectiveMarginTop(firstChild, childContainingWidth);\r\n  return collapseMarginSet([ownMargin, childMargin]);\r\n}\r\n\r\nexport function effectiveMarginBottom(node: LayoutNode, containingBlockWidth: number): number {\r\n  const ownMargin = resolveLength(node.style.marginBottom, containingBlockWidth, { auto: \"zero\" });\r\n  if (!isBlockLevel(node)) {\r\n    return ownMargin;\r\n  }\r\n  if (!canCollapseMarginEnd(node, containingBlockWidth)) {\r\n    return ownMargin;\r\n  }\r\n  const lastChild = findLastMarginCollapsibleChild(node);\r\n  if (!lastChild) {\r\n    return ownMargin;\r\n  }\r\n  const childContainingWidth = resolveWidthBlock(node, containingBlockWidth);\r\n  const childMargin = effectiveMarginBottom(lastChild, childContainingWidth);\r\n  return collapseMarginSet([ownMargin, childMargin]);\r\n}\r\n", "import { LayoutNode } from \"../../dom/node.js\";\n\nexport function finalizeOverflow(node: LayoutNode): void {\n  const contentWidth = node.box.contentWidth;\n  const contentHeight = node.box.contentHeight;\n  node.box.scrollWidth = Math.max(\n    contentWidth,\n    ...node.children.map((child) => child.box.x + child.box.borderBoxWidth - node.box.x),\n  );\n  node.box.scrollHeight = Math.max(\n    contentHeight,\n    ...node.children.map((child) => child.box.y + child.box.borderBoxHeight - node.box.y),\n  );\n}\n", "export interface FloatRect {\n  readonly top: number;\n  readonly bottom: number;\n  readonly inlineStart: number;\n  readonly inlineEnd: number;\n}\n\ninterface RegisteredFloat {\n  readonly side: \"left\" | \"right\";\n  readonly rect: FloatRect;\n}\n\nexport class FloatContext {\n  private readonly floats: RegisteredFloat[] = [];\n\n  register(side: \"left\" | \"right\", rect: FloatRect): void {\n    this.floats.push({ side, rect });\n  }\n\n  bottom(side: \"left\" | \"right\"): number {\n    let result = 0;\n    for (const entry of this.floats) {\n      if (entry.side === side) {\n        result = Math.max(result, entry.rect.bottom);\n      }\n    }\n    return result;\n  }\n\n  inlineOffsets(top: number, bottom: number, containingBlockWidth: number): { start: number; end: number } {\n    let leftOffset = 0;\n    let rightOffset = 0;\n    for (const { side, rect } of this.floats) {\n      if (!rangesOverlap(rect.top, rect.bottom, top, bottom)) {\n        continue;\n      }\n      if (side === \"left\") {\n        leftOffset = Math.max(leftOffset, rect.inlineEnd);\n      } else {\n        rightOffset = Math.max(rightOffset, containingBlockWidth - rect.inlineStart);\n      }\n    }\n    return {\n      start: leftOffset,\n      end: containingBlockWidth - rightOffset,\n    };\n  }\n\n  nextUnblockedY(top: number, bottom: number): number | null {\n    let candidate: number | null = null;\n    for (const { rect } of this.floats) {\n      if (rangesOverlap(rect.top, rect.bottom, top, bottom)) {\n        candidate = candidate === null ? rect.bottom : Math.min(candidate, rect.bottom);\n      }\n    }\n    return candidate;\n  }\n}\n\nfunction rangesOverlap(aStart: number, aEnd: number, bStart: number, bEnd: number): boolean {\n  return Math.max(aStart, bStart) < Math.min(aEnd, bEnd);\n}\n", "import { LayoutNode } from \"../../dom/node.js\";\nimport { ClearMode, FloatMode } from \"../../css/enums.js\";\nimport { resolveLength } from \"../../css/length.js\";\nimport { FloatContext } from \"../context/float-context.js\";\nimport type { LayoutContext } from \"../pipeline/strategy.js\";\n\ninterface FloatPlacementOptions {\n  node: LayoutNode;\n  floatContext: FloatContext;\n  context: LayoutContext;\n  contentX: number;\n  contentWidth: number;\n  startY: number;\n}\n\nexport function clearForBlock(node: LayoutNode, floatContext: FloatContext, yCursor: number): number {\n  const { clear } = node.style;\n  let y = yCursor;\n  if (clear === ClearMode.Left || clear === ClearMode.Both || clear === ClearMode.InlineStart) {\n    y = Math.max(y, floatContext.bottom(\"left\"));\n  }\n  if (clear === ClearMode.Right || clear === ClearMode.Both || clear === ClearMode.InlineEnd) {\n    y = Math.max(y, floatContext.bottom(\"right\"));\n  }\n  return y;\n}\n\nexport function placeFloat(options: FloatPlacementOptions): number {\n  const { node, floatContext, context, contentX, contentWidth } = options;\n\n  context.layoutChild(node);\n\n  const marginLeft = resolveLength(node.style.marginLeft, contentWidth, { auto: \"zero\" });\n  const marginRight = resolveLength(node.style.marginRight, contentWidth, { auto: \"zero\" });\n  const marginTop = resolveLength(node.style.marginTop, contentWidth, { auto: \"zero\" });\n  const marginBottom = resolveLength(node.style.marginBottom, contentWidth, { auto: \"zero\" });\n\n  const borderLeft = resolveLength(node.style.borderLeft, contentWidth, { auto: \"zero\" });\n  const borderRight = resolveLength(node.style.borderRight, contentWidth, { auto: \"zero\" });\n  const borderTop = resolveLength(node.style.borderTop, contentWidth, { auto: \"zero\" });\n  const borderBottom = resolveLength(node.style.borderBottom, contentWidth, { auto: \"zero\" });\n\n  const paddingLeft = resolveLength(node.style.paddingLeft, contentWidth, { auto: \"zero\" });\n  const paddingRight = resolveLength(node.style.paddingRight, contentWidth, { auto: \"zero\" });\n  const paddingTop = resolveLength(node.style.paddingTop, contentWidth, { auto: \"zero\" });\n  const paddingBottom = resolveLength(node.style.paddingBottom, contentWidth, { auto: \"zero\" });\n\n  const borderBoxWidth = node.box.contentWidth + paddingLeft + paddingRight + borderLeft + borderRight;\n  const borderBoxHeight = node.box.contentHeight + paddingTop + paddingBottom + borderTop + borderBottom;\n\n  node.box.borderBoxWidth = borderBoxWidth;\n  node.box.borderBoxHeight = borderBoxHeight;\n  node.box.marginBoxWidth = borderBoxWidth + marginLeft + marginRight;\n  node.box.marginBoxHeight = borderBoxHeight + marginTop + marginBottom;\n\n  const outerWidth = node.box.marginBoxWidth;\n  const outerHeight = node.box.marginBoxHeight;\n\n  let y = options.startY;\n  let attempts = 0;\n  while (true) {\n    if (attempts > 1000) {\n      break;\n    }\n    const offsets = floatContext.inlineOffsets(y, y + outerHeight, contentWidth);\n    const availableWidth = Math.max(0, offsets.end - offsets.start);\n    if (outerWidth <= availableWidth) {\n      const marginBoxStart =\n        node.style.float === FloatMode.Left\n          ? contentX + offsets.start\n          : contentX + offsets.end - outerWidth;\n\n      const contentXPosition = marginBoxStart + marginLeft + borderLeft + paddingLeft;\n      const contentYPosition = y + marginTop + borderTop + paddingTop;\n\n      node.box.x = contentXPosition;\n      node.box.y = contentYPosition;\n      node.box.scrollWidth = node.box.contentWidth;\n      node.box.scrollHeight = node.box.contentHeight;\n\n      floatContext.register(node.style.float === FloatMode.Left ? \"left\" : \"right\", {\n        top: y,\n        bottom: y + outerHeight,\n        inlineStart: marginBoxStart - contentX,\n        inlineEnd: marginBoxStart - contentX + outerWidth,\n      });\n      return y + outerHeight;\n    }\n    const nextY = floatContext.nextUnblockedY(y, y + outerHeight);\n    if (nextY === null || nextY <= y) {\n      y += 1;\n    } else {\n      y = nextY;\n    }\n    attempts += 1;\n  }\n  return y + outerHeight;\n}\n", "import { LayoutNode } from \"../../dom/node.js\";\r\nimport type { LayoutContext } from \"../pipeline/strategy.js\";\r\nimport { FloatContext } from \"../context/float-context.js\";\r\n\r\nexport interface InlineLayoutOptions {\r\n    container: LayoutNode;\r\n    inlineNodes: LayoutNode[];\r\n    context: LayoutContext;\r\n    floatContext: FloatContext;\r\n    contentX: number;\r\n    contentWidth: number;\r\n    startY: number;\r\n}\r\n\r\nexport interface InlineMetrics {\r\n    node: LayoutNode;\r\n    contentWidth: number;\r\n    contentHeight: number;\r\n    lineOffset: number;\r\n    marginLeft: number;\r\n    marginRight: number;\r\n    marginTop: number;\r\n    marginBottom: number;\r\n    paddingLeft: number;\r\n    paddingRight: number;\r\n    paddingTop: number;\r\n    paddingBottom: number;\r\n    borderLeft: number;\r\n    borderRight: number;\r\n    borderTop: number;\r\n    borderBottom: number;\r\n    outerWidth: number;\r\n    outerHeight: number;\r\n}\r\n\r\nexport type InlineFragment =\r\n    | {\r\n        kind: \"text\";\r\n        node: LayoutNode;\r\n        style: LayoutNode[\"style\"];\r\n        text: string;\r\n        preserveLeading?: boolean;\r\n        preserveTrailing?: boolean;\r\n    }\r\n    | {\r\n        kind: \"box\";\r\n        metrics: InlineMetrics;\r\n    };\r\n\r\nexport type LayoutItemKind = \"word\" | \"space\" | \"box\" | \"newline\";\r\n\r\nexport interface LayoutItemBase {\r\n    kind: LayoutItemKind;\r\n    width: number;\r\n    height: number;\r\n    lineHeight: number;\r\n    node?: LayoutNode;\r\n    style?: LayoutNode[\"style\"];\r\n    text?: string;\r\n    spaceCount?: number;\r\n}\r\n\r\nexport interface BoxLayoutItem extends LayoutItemBase {\r\n    kind: \"box\";\r\n    metrics: InlineMetrics;\r\n}\r\n\r\nexport type LayoutItem = LayoutItemBase | BoxLayoutItem;\r\n\r\nexport interface InlineLayoutResult {\r\n    newCursorY: number;\r\n}\r\n\r\nexport function isBoxItem(item: LayoutItem): item is BoxLayoutItem {\r\n    return item.kind === \"box\";\r\n}\r\n", "import { readFileSync } from \"fs\";\r\nimport { TtfFontMetrics } from \"../../types/fonts.js\";\r\nimport { TtfTableParser } from \"./ttf-table-parser.js\";\r\nimport { parseGlobalMetrics } from \"./ttf-global-metrics.js\";\nimport { parseGlyphMetrics } from \"./ttf-glyph-metrics.js\";\nimport { CmapParser } from \"./ttf-cmap.js\";\nimport { createGlyfOutlineProvider } from \"./ttf-glyf.js\";\nimport type { KerningMap } from \"../../types/fonts.js\";\n\nexport function parseTtfBuffer(buffer: ArrayBuffer): TtfFontMetrics {\n  const parser = new TtfTableParser(buffer);\n\n  // Parse global metrics (head, hhea, OS/2)\n  const { metrics, numberOfHMetricsRaw, headBBox } = parseGlobalMetrics(parser);\n\r\n  // Parse maxp for numGlyphs\r\n  const MAXP = 0x6d617870; // 'maxp'\r\n  const maxpTable = parser.getTable(MAXP);\r\n  if (!maxpTable) throw new Error(\"Missing maxp table\");\r\n\r\n  const numGlyphs = parser.getUint16(maxpTable, 4);\r\n\r\n  // Clamp numberOfHMetrics to glyph count\r\n  const numberOfHMetrics = Math.min(numberOfHMetricsRaw, numGlyphs);\r\n\r\n  // Parse glyph metrics\r\n  const glyphMetrics = parseGlyphMetrics(parser, numberOfHMetrics, numGlyphs);\r\n\r\n  // Parse cmap\r\n  const CMAP = 0x636d6170; // 'cmap'\n  const cmapTable = parser.getTable(CMAP);\n  if (!cmapTable) throw new Error(\"Missing cmap table\");\n\n  const cmap = new CmapParser(parser, cmapTable);\n  const kerning = mergeKerningMaps(parseKerningTable(parser), parseGposKerning(parser));\n\n  const glyfProvider = createGlyfOutlineProvider(parser);\n  return new TtfFontMetrics(metrics, glyphMetrics, cmap, headBBox, glyfProvider, kerning);\n}\n\nexport function parseTtfFont(filePath: string): TtfFontMetrics {\n  const buffer = readFileSync(filePath);\n  const arrayBuffer = buffer.buffer.slice(buffer.byteOffset, buffer.byteOffset + buffer.byteLength);\n  return parseTtfBuffer(arrayBuffer);\n}\n\n/**\n * Parse the 'kern' table (format 0) into a nested map of adjustments in font units.\n * Returns undefined when the table is missing or unsupported.\n */\nfunction parseKerningTable(parser: TtfTableParser): KerningMap | undefined {\n  const KERN = 0x6b65726e; // 'kern'\n  const table = parser.getTable(KERN);\n  if (!table) return undefined;\n\n  // kern header: version (uint16), nTables (uint16)\n  if (table.byteLength < 4) return undefined;\n  const nTables = table.getUint16(2, false);\n  let offset = 4;\n  const result: KerningMap = new Map();\n\n  for (let i = 0; i < nTables; i++) {\n    if (offset + 6 > table.byteLength) break;\n    const subtableVersion = table.getUint16(offset, false);\n    const length = table.getUint16(offset + 2, false);\n    const coverage = table.getUint16(offset + 4, false);\n    const format = coverage >> 8;\n    // Only support format 0 (uni-directional kerning pairs)\n    if (subtableVersion === 0 && format === 0) {\n      if (offset + length > table.byteLength) break;\n      const stOffset = offset + 6;\n      if (stOffset + 8 > table.byteLength) break;\n      const pairCount = table.getUint16(stOffset, false);\n      // skip searchRange, entrySelector, rangeShift (next 6 bytes)\n      let cursor = stOffset + 8;\n      for (let p = 0; p < pairCount; p++) {\n        if (cursor + 6 > table.byteLength) break;\n        const left = table.getUint16(cursor, false);\n        const right = table.getUint16(cursor + 2, false);\n        const value = table.getInt16(cursor + 4, false);\n        if (value !== 0) {\n          const rightMap = result.get(left) ?? new Map<number, number>();\n          rightMap.set(right, value);\n          result.set(left, rightMap);\n        }\n        cursor += 6;\n      }\n    }\n    offset += length;\n  }\n\n  return result.size > 0 ? result : undefined;\n}\n\n/**\n * Parse GPOS PairPos (format 1) kerning into a nested map.\n * Supports value1 xAdvance/xPlacement adjustments; ignores class-based and other lookup types.\n */\nfunction parseGposKerning(parser: TtfTableParser): KerningMap | undefined {\n  const GPOS = 0x47504f53; // 'GPOS'\n  const table = parser.getTable(GPOS);\n  if (!table) return undefined;\n\n  // Header\n  if (table.byteLength < 10) return undefined;\n  const gposStart = 0;\n  const lookupListOffset = table.getUint16(gposStart + 8, false);\n  if (lookupListOffset === 0 || lookupListOffset >= table.byteLength) return undefined;\n\n  const kerning: KerningMap = new Map();\n\n  // Lookup list\n  const lookupCount = table.getUint16(gposStart + lookupListOffset, false);\n  let lookupOffsetsPos = gposStart + lookupListOffset + 2;\n  for (let li = 0; li < lookupCount; li++) {\n    if (lookupOffsetsPos + 2 > table.byteLength) break;\n    const lookupOffset = table.getUint16(lookupOffsetsPos, false);\n    lookupOffsetsPos += 2;\n    if (lookupOffset === 0 || gposStart + lookupOffset >= table.byteLength) continue;\n\n    const lookupStart = gposStart + lookupOffset;\n    if (lookupStart + 6 > table.byteLength) continue;\n    const lookupType = table.getUint16(lookupStart, false);\n    const subTableCount = table.getUint16(lookupStart + 4, false);\n    let subTableOffsetsPos = lookupStart + 6;\n\n    if (lookupType !== 2) {\n      // Only Pair Adjustment lookups\n      continue;\n    }\n\n    for (let si = 0; si < subTableCount; si++) {\n      if (subTableOffsetsPos + 2 > table.byteLength) break;\n      const stOffset = table.getUint16(subTableOffsetsPos, false);\n      subTableOffsetsPos += 2;\n      if (stOffset === 0 || lookupStart + stOffset >= table.byteLength) continue;\n      const stStart = lookupStart + stOffset;\n      if (stStart + 10 > table.byteLength) continue;\n\n      const format = table.getUint16(stStart, false);\n      if (format !== 1) {\n        // Only handle PairPos format 1 (per-glyph pair sets)\n        continue;\n      }\n\n      const coverageOffset = table.getUint16(stStart + 2, false);\n      const valueFormat1 = table.getUint16(stStart + 4, false);\n      const valueFormat2 = table.getUint16(stStart + 6, false);\n      const pairSetCount = table.getUint16(stStart + 8, false);\n\n      const coverage = parseCoverageTable(table, stStart + coverageOffset);\n      const pairSetOffsetsStart = stStart + 10;\n\n      for (let pi = 0; pi < pairSetCount; pi++) {\n        const leftGlyph = coverage[pi];\n        if (leftGlyph === undefined) continue;\n\n        const pairSetOffsetPos = pairSetOffsetsStart + pi * 2;\n        if (pairSetOffsetPos + 2 > table.byteLength) break;\n        const pairSetOffset = table.getUint16(pairSetOffsetPos, false);\n        if (pairSetOffset === 0 || stStart + pairSetOffset >= table.byteLength) continue;\n\n        const pairSetStart = stStart + pairSetOffset;\n        if (pairSetStart + 2 > table.byteLength) continue;\n        const pairValueCount = table.getUint16(pairSetStart, false);\n        let recPos = pairSetStart + 2;\n\n        for (let r = 0; r < pairValueCount; r++) {\n          if (recPos + 2 > table.byteLength) break;\n          const rightGlyph = table.getUint16(recPos, false);\n          recPos += 2;\n\n          const val1 = readValueRecord(table, recPos, valueFormat1);\n          recPos += val1.length;\n\n          const val2 = readValueRecord(table, recPos, valueFormat2);\n          recPos += val2.length;\n\n          const adjust = (val1.xAdvance ?? 0) + (val1.xPlacement ?? 0) + (val2.xPlacement ?? 0);\n          if (adjust !== 0) {\n            const rightMap = kerning.get(leftGlyph) ?? new Map<number, number>();\n            rightMap.set(rightGlyph, adjust);\n            kerning.set(leftGlyph, rightMap);\n          }\n        }\n      }\n    }\n  }\n\n  return kerning.size > 0 ? kerning : undefined;\n}\n\nfunction parseCoverageTable(table: DataView, offset: number): number[] {\n  if (offset + 4 > table.byteLength) return [];\n  const format = table.getUint16(offset, false);\n  if (format === 1) {\n    const count = table.getUint16(offset + 2, false);\n    const glyphs: number[] = [];\n    let pos = offset + 4;\n    for (let i = 0; i < count; i++) {\n      if (pos + 2 > table.byteLength) break;\n      glyphs.push(table.getUint16(pos, false));\n      pos += 2;\n    }\n    return glyphs;\n  }\n  if (format === 2) {\n    const rangeCount = table.getUint16(offset + 2, false);\n    const glyphs: number[] = [];\n    let pos = offset + 4;\n    for (let i = 0; i < rangeCount; i++) {\n      if (pos + 6 > table.byteLength) break;\n      const start = table.getUint16(pos, false);\n      const end = table.getUint16(pos + 2, false);\n      const startCoverage = table.getUint16(pos + 4, false);\n      for (let g = 0; g <= end - start; g++) {\n        glyphs[startCoverage + g] = start + g;\n      }\n      pos += 6;\n    }\n    return glyphs;\n  }\n  return [];\n}\n\nfunction readValueRecord(table: DataView, offset: number, valueFormat: number): { xAdvance?: number; xPlacement?: number; length: number } {\n  let pos = offset;\n  let xPlacement: number | undefined;\n  let xAdvance: number | undefined;\n\n  const consume = (flag: number) => {\n    const v = table.getInt16(pos, false);\n    pos += 2;\n    return v;\n  };\n\n  if (valueFormat & 0x0001) xPlacement = consume(0x0001);\n  if (valueFormat & 0x0002) consume(0x0002); // yPlacement (ignored)\n  if (valueFormat & 0x0004) xAdvance = consume(0x0004);\n  if (valueFormat & 0x0008) consume(0x0008); // yAdvance (ignored)\n\n  // Skip Device/Variation tables if present (we don't apply them; consume offsets)\n  const deviceFlags = [0x0010, 0x0020, 0x0040, 0x0080];\n  for (const flag of deviceFlags) {\n    if (valueFormat & flag) {\n      pos += 2;\n    }\n  }\n\n  return { xAdvance, xPlacement, length: pos - offset };\n}\n\nfunction mergeKerningMaps(a?: KerningMap, b?: KerningMap): KerningMap | undefined {\n  if (!a && !b) return undefined;\n  const result: KerningMap = new Map();\n  const add = (map?: KerningMap) => {\n    if (!map) return;\n    for (const [left, rights] of map.entries()) {\n      const target = result.get(left) ?? new Map<number, number>();\n      for (const [right, val] of rights.entries()) {\n        target.set(right, (target.get(right) ?? 0) + val);\n      }\n      result.set(left, target);\n    }\n  };\n  add(a);\n  add(b);\n  return result;\n}\n", "/**\r\n * TtfTableParser\r\n * Small utility to read table directory and provide safe big-endian reads.\r\n *\r\n * This file was extracted from ttf-lite.ts as part of SRP refactor. Keep the\r\n * implementation minimal and focused on DataView/table-directory logic.\r\n */\r\n\r\nimport { log } from \"../../logging/debug.js\";\r\n\r\nexport interface TableDirectoryEntry {\r\n  tag: number;\r\n  checksum: number;\r\n  offset: number;\r\n  length: number;\r\n}\r\n\r\nexport class TtfTableParser {\r\n  private readonly dataView: DataView;\r\n  private readonly tableDirectory = new Map<number, TableDirectoryEntry>();\r\n\r\n  constructor(buffer: ArrayBuffer) {\r\n    this.dataView = new DataView(buffer);\r\n    this.parseTableDirectory();\r\n  }\r\n\r\n  private parseTableDirectory(): void {\r\n    // Validate minimal header present\r\n    if (this.dataView.byteLength < 12) {\r\n      throw new Error(\"Truncated TTF header\");\r\n    }\r\n\r\n    const numTables = this.dataView.getUint16(4, false); // big-endian\r\n    const tableDirOffset = 12;\r\n    const requiredDirBytes = tableDirOffset + numTables * 16;\r\n    if (requiredDirBytes > this.dataView.byteLength) {\r\n      throw new Error(\"Truncated table directory\");\r\n    }\r\n\r\n    for (let i = 0; i < numTables; i++) {\r\n      const offset = tableDirOffset + i * 16;\r\n      const tag = this.dataView.getUint32(offset, false);\r\n      const checksum = this.dataView.getUint32(offset + 4, false);\r\n      const tableOffset = this.dataView.getUint32(offset + 8, false);\r\n      const length = this.dataView.getUint32(offset + 12, false);\r\n\r\n      // CAVEAT FIX: Interception point for problematic tables\r\n      const tagString = String.fromCharCode(\r\n        (tag >> 24) & 0xFF,\r\n        (tag >> 16) & 0xFF,\r\n        (tag >> 8) & 0xFF,\r\n        tag & 0xFF\r\n      );\r\n\r\n      // CAVEAT SPECIFIC FIX: Force skip ONLY the exact problematic table\r\n      if (tagString === 'gloc') {\r\n        log('font', 'warn', `\uD83D\uDEAB CAVEAT TTF PARSER: FORCE SKIPPING problematic table 'gloc' (0x${tag.toString(16)})`);\r\n        continue;\r\n      }\r\n\r\n      // Essential TTF tables that MUST NOT be filtered out\r\n      const essentialTables = ['cmap', 'head', 'hhea', 'hmtx', 'maxp', 'name', 'OS/2', 'post'];\r\n\r\n      // Bounds validation - allow graceful skip for non-essential tables\r\n      if (tableOffset + length > this.dataView.byteLength) {\r\n        if (essentialTables.includes(tagString)) {\r\n          log('font', 'warn', `WOFF2 TTF: ESSENTIAL table ${tagString} has bounds issues - attempting to proceed with clamped length`);\r\n          // For essential tables, clamp the length to fit within file bounds\r\n          const clampedLength = Math.min(length, this.dataView.byteLength - tableOffset);\r\n          if (clampedLength > 0) {\r\n            this.tableDirectory.set(tag, {\r\n              tag,\r\n              checksum,\r\n              offset: tableOffset,\r\n              length: clampedLength\r\n            });\r\n            log('font', 'debug', `\u2705 CAVEAT TTF PARSER: KEPT essential table ${tagString} with clamped length ${clampedLength}`);\r\n          } else {\r\n            log('font', 'warn', `WOFF2 TTF: Essential table ${tagString} completely out of bounds - skipping`);\r\n          }\r\n        } else {\r\n          log('font', 'warn', `WOFF2 TTF: Skipping optional table ${tagString} due to bounds issues`);\r\n          continue;\r\n        }\r\n      } else {\r\n        this.tableDirectory.set(tag, {\r\n          tag,\r\n          checksum,\r\n          offset: tableOffset,\r\n          length\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  getTable(tag: number): DataView | null {\r\n    const entry = this.tableDirectory.get(tag);\r\n    if (!entry) return null;\r\n\r\n    // Extra guard for safety before creating a DataView\r\n    if (entry.offset + entry.length > this.dataView.byteLength) {\r\n      throw new Error(`Invalid table entry for tag 0x${tag.toString(16)}`);\r\n    }\r\n\r\n    return new DataView(this.dataView.buffer, entry.offset, entry.length);\r\n  }\r\n\r\n  getUint16(table: DataView, offset: number): number {\r\n    if (offset + 2 > table.byteLength) throw new Error(\"Read beyond table bounds (getUint16)\");\r\n    return table.getUint16(offset, false); // big-endian\r\n  }\r\n\r\n  getInt16(table: DataView, offset: number): number {\r\n    if (offset + 2 > table.byteLength) throw new Error(\"Read beyond table bounds (getInt16)\");\r\n    return table.getInt16(offset, false); // big-endian\r\n  }\r\n\r\n  getInt8(table: DataView, offset: number): number {\r\n    if (offset + 1 > table.byteLength) throw new Error(\"Read beyond table bounds (getInt8)\");\r\n    return table.getInt8(offset);\r\n  }\r\n\r\n  getUint8(table: DataView, offset: number): number {\r\n    if (offset + 1 > table.byteLength) throw new Error(\"Read beyond table bounds (getUint8)\");\r\n    return table.getUint8(offset);\r\n  }\r\n\r\n  getUint32(table: DataView, offset: number): number {\r\n    if (offset + 4 > table.byteLength) throw new Error(\"Read beyond table bounds (getUint32)\");\r\n    return table.getUint32(offset, false); // big-endian\r\n  }\r\n}\r\n", "import type { TtfMetrics } from \"../../types/fonts.js\";\r\nimport { TtfTableParser } from \"./ttf-table-parser.js\";\r\n\r\n// Table tags\r\nconst HEAD = 0x68656164; // 'head'\r\nconst HHEA = 0x68686561; // 'hhea'\r\nconst OS_2 = 0x4f532f32; // 'OS/2'\r\n\r\nexport function parseGlobalMetrics(parser: TtfTableParser): { metrics: TtfMetrics; numberOfHMetricsRaw: number; headBBox?: readonly [number, number, number, number] } {\r\n  const headTable = parser.getTable(HEAD);\r\n  if (!headTable) throw new Error(\"Missing head table\");\r\n\r\n  const unitsPerEm = parser.getUint16(headTable, 18);\r\n\r\n  const hheaTable = parser.getTable(HHEA);\r\n  if (!hheaTable) throw new Error(\"Missing hhea table\");\r\n\r\n  const ascender = parser.getInt16(hheaTable, 4);\r\n  const descender = parser.getInt16(hheaTable, 6);\r\n  const lineGap = parser.getInt16(hheaTable, 8);\r\n  const numberOfHMetricsRaw = parser.getUint16(hheaTable, 34);\r\n\r\n  // Parse OS/2 table for optional cap/x heights\r\n  const os2Table = parser.getTable(OS_2);\r\n  let capHeight = ascender;\r\n  let xHeight = Math.round(ascender * 0.5);\r\n\r\n  // Only use OS/2 capHeight/xHeight if the table exists and version >= 2 (fields present)\r\n  if (os2Table && os2Table.byteLength >= 4) {\r\n    const os2Version = parser.getUint16(os2Table, 0);\r\n    if (os2Version >= 2 && os2Table.byteLength >= 96) {\r\n      capHeight = parser.getInt16(os2Table, 88);\r\n      xHeight = parser.getInt16(os2Table, 86);\r\n    }\r\n  }\r\n\r\n  // Read head bbox (xMin, yMin, xMax, yMax) if present\r\n  let headBBox: readonly [number, number, number, number] | undefined = undefined;\r\n  // head table contains bbox at offsets 36..42 (int16)\r\n  if (headTable.byteLength >= 44) {\r\n    const xMin = parser.getInt16(headTable, 36);\r\n    const yMin = parser.getInt16(headTable, 38);\r\n    const xMax = parser.getInt16(headTable, 40);\r\n    const yMax = parser.getInt16(headTable, 42);\r\n    headBBox = [xMin, yMin, xMax, yMax];\r\n  }\r\n\r\n  const metrics: TtfMetrics = {\r\n    unitsPerEm,\r\n    ascender,\r\n    descender,\r\n    lineGap,\r\n    capHeight,\r\n    xHeight\r\n  };\r\n\r\n  return { metrics, numberOfHMetricsRaw, headBBox };\r\n}\r\n", "import type { GlyphMetrics } from \"../../types/fonts.js\";\r\nimport { TtfTableParser } from \"./ttf-table-parser.js\";\r\n\r\n// Table tags\r\nconst HMTX = 0x686d7478; // 'hmtx'\r\n\r\nexport function parseGlyphMetrics(\r\n  parser: TtfTableParser,\r\n  numberOfHMetrics: number,\r\n  numGlyphs: number\r\n): Map<number, GlyphMetrics> {\r\n  const hmtxTable = parser.getTable(HMTX);\r\n  if (!hmtxTable) throw new Error(\"Missing hmtx table\");\r\n\r\n  const glyphMetrics = new Map<number, GlyphMetrics>();\r\n\r\n  // Validate long metrics length\r\n  const longBytes = numberOfHMetrics * 4;\r\n  if (hmtxTable.byteLength < longBytes) {\r\n    throw new Error(\"Truncated hmtx long metrics\");\r\n  }\r\n\r\n  // Read first numberOfHMetrics entries (advanceWidth + lsb)\r\n  let lastAdvanceWidth = 0;\r\n  for (let gid = 0; gid < numGlyphs; gid++) {\r\n    if (gid < numberOfHMetrics) {\r\n      const off = gid * 4;\r\n      if (off + 4 > hmtxTable.byteLength) throw new Error(\"Truncated hmtx entry\");\r\n      const advanceWidth = parser.getUint16(hmtxTable, off);\r\n      const leftSideBearing = parser.getInt16(hmtxTable, off + 2);\r\n      glyphMetrics.set(gid, { advanceWidth, leftSideBearing });\r\n      lastAdvanceWidth = advanceWidth;\r\n    } else {\r\n      // LSBs follow after long metrics\r\n      const lsbOff = longBytes + (gid - numberOfHMetrics) * 2;\r\n      if (lsbOff + 2 > hmtxTable.byteLength) throw new Error(\"Truncated hmtx LSB array\");\r\n      const leftSideBearing = parser.getInt16(hmtxTable, lsbOff);\r\n      glyphMetrics.set(gid, { advanceWidth: lastAdvanceWidth, leftSideBearing });\r\n    }\r\n  }\r\n\r\n  return glyphMetrics;\r\n}\r\n", "import type { CmapData } from \"../../types/fonts.js\";\r\nimport { TtfTableParser } from \"./ttf-table-parser.js\";\r\n\r\n// cmap table tags / helpers could live here if needed\r\n\r\nexport class CmapParser implements CmapData {\r\n  public readonly unicodeMap = new Map<number, number>();\r\n\r\n  constructor(parser: TtfTableParser, cmapTable: DataView) {\r\n    this.parseCmapTable(parser, cmapTable);\r\n  }\r\n\r\n  private parseCmapTable(parser: TtfTableParser, table: DataView): void {\r\n    if (table.byteLength < 4) throw new Error(\"Truncated cmap header\");\r\n\r\n    const version = table.getUint16(0, false);\r\n    if (version !== 0) return; // only support version 0 for now\r\n\r\n    const numSubtables = table.getUint16(2, false);\r\n    const subtables: { platformId: number; encodingId: number; offset: number }[] = [];\r\n\r\n    // collect subtables with bounds checks\r\n    const expectedDirLen = 4 + numSubtables * 8;\r\n    if (expectedDirLen > table.byteLength) throw new Error(\"Truncated cmap subtables directory\");\r\n\r\n    for (let i = 0; i < numSubtables; i++) {\r\n      const subtableOffset = 4 + i * 8;\r\n      const platformId = table.getUint16(subtableOffset, false);\r\n      const encodingId = table.getUint16(subtableOffset + 2, false);\r\n      const offset = table.getUint32(subtableOffset + 4, false);\r\n\r\n      if (offset >= table.byteLength) {\r\n        throw new Error(\"Invalid subtable offset in cmap\");\r\n      }\r\n\r\n      subtables.push({ platformId, encodingId, offset });\r\n    }\r\n\r\n    // Selection strategy: prefer Platform 0 (Unicode) format 12/4, then Platform 3 encIDs 10/1 (format 12/4),\r\n    // otherwise fall back to any format 4 available.\r\n    const pickSubtable = (): { platformId: number; encodingId: number; offset: number } | null => {\r\n      const findPreferred = (platforms: { pid: number; eids: number[] }[]) => {\r\n        for (const p of platforms) {\r\n          for (const st of subtables) {\r\n            if (st.platformId !== p.pid) continue;\r\n            if (p.eids.length > 0 && !p.eids.includes(st.encodingId)) continue;\r\n\r\n            if (st.offset + 2 <= table.byteLength) {\r\n              const fmt = table.getUint16(st.offset, false);\r\n              if (fmt === 12) return st;\r\n            }\r\n          }\r\n        }\r\n        for (const p of platforms) {\r\n          for (const st of subtables) {\r\n            if (st.platformId !== p.pid) continue;\r\n            if (p.eids.length > 0 && !p.eids.includes(st.encodingId)) continue;\r\n            if (st.offset + 2 <= table.byteLength) {\r\n              const fmt = table.getUint16(st.offset, false);\r\n              if (fmt === 4) return st;\r\n            }\r\n          }\r\n        }\r\n        return null;\r\n      };\r\n\r\n      let chosen = findPreferred([{ pid: 0, eids: [] }]);\r\n      if (chosen) return chosen;\r\n\r\n      chosen = findPreferred([{ pid: 3, eids: [10] }, { pid: 3, eids: [1] }]);\r\n      if (chosen) return chosen;\r\n\r\n      for (const st of subtables) {\r\n        if (st.offset + 2 <= table.byteLength && table.getUint16(st.offset, false) === 4) return st;\r\n      }\r\n\r\n      return null;\r\n    };\r\n\r\n    const selected = pickSubtable();\r\n    if (!selected) {\r\n      // No suitable cmap found \u2014 leave unicodeMap empty.\r\n      return;\r\n    }\r\n\r\n    const format = table.getUint16(selected.offset, false);\r\n    if (format === 4) {\r\n      this.parseFormat4Table(parser, table, selected.offset);\r\n    } else if (format === 12) {\r\n      this.parseFormat12Table(parser, table, selected.offset);\r\n    } else {\r\n      // unsupported format for now; leave empty\r\n      return;\r\n    }\r\n  }\r\n\r\n  private parseFormat4Table(_parser: TtfTableParser, table: DataView, offset: number): void {\r\n    if (offset + 8 > table.byteLength) throw new Error(\"Truncated cmap format 4 header\");\r\n    const format = table.getUint16(offset, false);\r\n    if (format !== 4) throw new Error(\"Unexpected cmap format (not 4)\");\r\n\r\n    const length = table.getUint16(offset + 2, false);\r\n    if (offset + length > table.byteLength) throw new Error(\"Truncated cmap format 4 table\");\r\n\r\n    const segCountX2 = table.getUint16(offset + 6, false);\r\n    const segCount = segCountX2 / 2;\r\n\r\n    const endCodeOffset = offset + 14;\r\n    const startCodeOffset = endCodeOffset + segCount * 2 + 2;\r\n    const idDeltaOffset = startCodeOffset + segCount * 2;\r\n    const idRangeOffsetOffset = idDeltaOffset + segCount * 2;\r\n\r\n    if (idRangeOffsetOffset > offset + length) throw new Error(\"Truncated cmap format 4 arrays\");\r\n\r\n    for (let i = 0; i < segCount; i++) {\r\n      const endCode = table.getUint16(endCodeOffset + i * 2, false);\r\n      const startCode = table.getUint16(startCodeOffset + i * 2, false);\r\n      const idDelta = table.getInt16(idDeltaOffset + i * 2, false); // signed\r\n      const idRangeOffset = table.getUint16(idRangeOffsetOffset + i * 2, false);\r\n\r\n      if (startCode === 0xffff) break;\r\n\r\n      if (startCode > endCode) throw new Error(\"Invalid cmap segment (startCode > endCode)\");\r\n\r\n      for (let code = startCode; code <= endCode; code++) {\r\n        let glyphId = 0;\r\n\r\n        if (idRangeOffset === 0) {\r\n          glyphId = (code + idDelta) & 0xffff;\r\n        } else {\r\n          const idRangeWordOffset = idRangeOffsetOffset + i * 2;\r\n          const glyphIndexOffset = idRangeWordOffset + idRangeOffset + (code - startCode) * 2;\r\n\r\n          if (glyphIndexOffset + 2 > offset + length) {\r\n            throw new Error(\"Truncated cmap glyphIndexArray\");\r\n          }\r\n\r\n          glyphId = table.getUint16(glyphIndexOffset, false);\r\n          if (glyphId !== 0) {\r\n            glyphId = (glyphId + idDelta) & 0xffff;\r\n          }\r\n        }\r\n\r\n        this.unicodeMap.set(code, glyphId);\r\n      }\r\n    }\r\n  }\r\n\r\n  private parseFormat12Table(_parser: TtfTableParser, table: DataView, offset: number): void {\r\n    // Format 12 uses 32-bit fields\r\n    if (offset + 16 > table.byteLength) throw new Error(\"Truncated cmap format 12 header\");\r\n    const format = table.getUint16(offset, false);\r\n    if (format !== 12) throw new Error(\"Unexpected cmap format (not 12)\");\r\n    const nGroups = table.getUint32(offset + 12, false);\r\n    const groupsOffset = offset + 16;\r\n    const required = groupsOffset + nGroups * 12;\r\n    if (required > table.byteLength) throw new Error(\"Truncated cmap format 12 groups\");\r\n\r\n    let p = groupsOffset;\r\n    for (let g = 0; g < nGroups; g++, p += 12) {\r\n      const startCode = table.getUint32(p, false);\r\n      const endCode = table.getUint32(p + 4, false);\r\n      const startGID = table.getUint32(p + 8, false);\r\n\r\n      if (startCode > endCode) throw new Error(\"Invalid cmap format 12 group (startCode > endCode)\");\r\n\r\n      for (let cp = startCode; cp <= endCode; cp++) {\r\n        this.unicodeMap.set(cp, startGID + (cp - startCode));\r\n      }\r\n    }\r\n  }\r\n\r\n  getGlyphId(codePoint: number): number {\r\n    return this.unicodeMap.get(codePoint) ?? 0;\r\n  }\r\n\r\n  hasCodePoint(codePoint: number): boolean {\r\n    return this.unicodeMap.has(codePoint);\r\n  }\r\n}\r\n", "import type { DataViewReader } from \"./ttf-table-provider.js\";\r\n\r\n/**\r\n * Glyph offset range in the glyf table.\r\n */\r\nexport interface GlyphOffsetRange {\r\n    start: number;\r\n    end: number;\r\n}\r\n\r\n/**\r\n * Reads and manages glyph offsets from the TrueType 'loca' table.\r\n * \r\n * The loca (location) table maps glyph IDs to byte offsets in the glyf table.\r\n * It supports two formats:\r\n * - Format 0: Short offsets (uint16), actual offset = value * 2\r\n * - Format 1: Long offsets (uint32)\r\n */\r\nexport class LocaTableReader {\r\n    private readonly offsets: number[];\r\n\r\n    /**\r\n     * Creates a new LocaTableReader.\r\n     * @param locaTable - DataView of the loca table\r\n     * @param indexToLocFormat - Format: 0 for short offsets, 1 for long offsets\r\n     * @param reader - Binary data reader\r\n     */\r\n    constructor(\r\n        locaTable: DataView,\r\n        indexToLocFormat: number,\r\n        reader: DataViewReader\r\n    ) {\r\n        this.offsets = [];\r\n\r\n        try {\r\n            if (indexToLocFormat === 0) {\r\n                // Short format: uint16 entries, actual offset = entry * 2\r\n                const entryCount = locaTable.byteLength / 2;\r\n                for (let i = 0; i < entryCount; i++) {\r\n                    const v = reader.getUint16(locaTable, i * 2);\r\n                    this.offsets.push(v * 2);\r\n                }\r\n            } else {\r\n                // Long format: uint32 entries\r\n                const entryCount = locaTable.byteLength / 4;\r\n                for (let i = 0; i < entryCount; i++) {\r\n                    const v = reader.getUint32(locaTable, i * 4);\r\n                    this.offsets.push(v);\r\n                }\r\n            }\r\n        } catch {\r\n            // Malformed loca table - leave offsets empty\r\n            this.offsets = [];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets the byte offset range for a glyph in the glyf table.\r\n     * @param glyphId - The glyph ID\r\n     * @returns Offset range or null if invalid glyph ID\r\n     */\r\n    getGlyphOffset(glyphId: number): GlyphOffsetRange | null {\r\n        if (glyphId < 0 || glyphId >= this.offsets.length - 1) {\r\n            return null;\r\n        }\r\n\r\n        const start = this.offsets[glyphId];\r\n        const end = this.offsets[glyphId + 1];\r\n\r\n        // Validate range\r\n        if (start < 0 || start > end) {\r\n            return null;\r\n        }\r\n\r\n        return { start, end };\r\n    }\r\n\r\n    /**\r\n     * Checks if a glyph is empty (has no outline data).\r\n     * Empty glyphs have start === end in the loca table.\r\n     * @param glyphId - The glyph ID\r\n     * @returns True if the glyph is empty, false otherwise\r\n     */\r\n    isEmptyGlyph(glyphId: number): boolean {\r\n        if (glyphId < 0 || glyphId >= this.offsets.length - 1) {\r\n            return true;\r\n        }\r\n\r\n        return this.offsets[glyphId] === this.offsets[glyphId + 1];\r\n    }\r\n\r\n    /**\r\n     * Gets the total number of glyphs in the font.\r\n     * @returns Number of glyphs\r\n     */\r\n    getGlyphCount(): number {\r\n        return Math.max(0, this.offsets.length - 1);\r\n    }\r\n\r\n    /**\r\n     * Validates that a glyph offset range is within the glyf table bounds.\r\n     * @param range - The offset range to validate\r\n     * @param glyfTableSize - Size of the glyf table in bytes\r\n     * @returns True if valid, false otherwise\r\n     */\r\n    validateRange(range: GlyphOffsetRange, glyfTableSize: number): boolean {\r\n        return range.start >= 0 && range.end <= glyfTableSize && range.start <= range.end;\r\n    }\r\n}\r\n", "import type { GlyphOutlineCmd } from \"../../types/fonts.js\";\r\nimport type { DataViewReader } from \"./ttf-table-provider.js\";\r\n\r\n/**\r\n * Represents a point in a glyph contour.\r\n */\r\ninterface Point {\r\n    x: number;\r\n    y: number;\r\n    onCurve: boolean;\r\n}\r\n\r\n/**\r\n * Parses simple (non-composite) TrueType glyphs.\r\n * \r\n * Simple glyphs consist of one or more contours made up of on-curve and off-curve points.\r\n * Off-curve points are quadratic Bezier control points.\r\n */\r\nexport class SimpleGlyphParser {\r\n    constructor(private readonly reader: DataViewReader) { }\r\n\r\n    /**\r\n     * Parses a simple glyph from a DataView.\r\n     * @param view - DataView containing the glyph data starting at the glyph header\r\n     * @returns Array of glyph outline commands, or null if parsing fails\r\n     */\r\n    parse(view: DataView): GlyphOutlineCmd[] | null {\r\n        const contours = this.parseContours(view);\r\n        if (!contours) return null;\r\n\r\n        return this.buildOutlineCommands(contours);\r\n    }\r\n\r\n    /**\r\n     * Parses glyph contours from the DataView.\r\n     * @param view - DataView containing the glyph data\r\n     * @returns Array of contours (each contour is an array of points), or null if parsing fails\r\n     */\r\n    private parseContours(view: DataView): Point[][] | null {\r\n        if (view.byteLength < 10) return null;\r\n\r\n        // Read glyph header\r\n        const numberOfContours = view.getInt16(0, false);\r\n        if (numberOfContours < 0) return null; // Composite glyph, shouldn't happen here\r\n\r\n        // Read endPtsOfContours array\r\n        const endPtsOffset = 10;\r\n        const endPts: number[] = [];\r\n        for (let i = 0; i < numberOfContours; i++) {\r\n            if (endPtsOffset + i * 2 + 2 > view.byteLength) return null;\r\n            endPts.push(this.reader.getUint16(view, endPtsOffset + i * 2));\r\n        }\r\n\r\n        // Read instruction length and skip instructions\r\n        const instrLenOffset = endPtsOffset + numberOfContours * 2;\r\n        if (instrLenOffset + 2 > view.byteLength) return null;\r\n        const instructionLength = this.reader.getUint16(view, instrLenOffset);\r\n        const flagsOffset = instrLenOffset + 2 + instructionLength;\r\n        if (flagsOffset > view.byteLength) return null;\r\n\r\n        // Calculate number of points\r\n        const nPoints = endPts.length === 0 ? 0 : endPts[endPts.length - 1] + 1;\r\n        if (nPoints <= 0) return [];\r\n\r\n        // Parse flags\r\n        const flagsResult = this.parseFlags(view, nPoints, flagsOffset);\r\n        if (!flagsResult) return null;\r\n        const { flags, nextOffset: xCoordOffset } = flagsResult;\r\n\r\n        // Parse coordinates\r\n        const coordsResult = this.parseCoordinates(view, flags, xCoordOffset);\r\n        if (!coordsResult) return null;\r\n        const { points } = coordsResult;\r\n\r\n        // Split points into contours\r\n        const contours: Point[][] = [];\r\n        let startIndex = 0;\r\n        for (let c = 0; c < numberOfContours; c++) {\r\n            const endIndex = endPts[c];\r\n            if (endIndex < startIndex || endIndex >= points.length) return null;\r\n            contours.push(points.slice(startIndex, endIndex + 1));\r\n            startIndex = endIndex + 1;\r\n        }\r\n\r\n        return contours;\r\n    }\r\n\r\n    /**\r\n     * Parses glyph flags with run-length encoding.\r\n     * @param view - DataView containing the glyph data\r\n     * @param nPoints - Number of points to read\r\n     * @param offset - Starting offset for flags\r\n     * @returns Flags array and next offset, or null if parsing fails\r\n     */\r\n    private parseFlags(\r\n        view: DataView,\r\n        nPoints: number,\r\n        offset: number\r\n    ): { flags: number[]; nextOffset: number } | null {\r\n        const flags: number[] = [];\r\n        let p = offset;\r\n\r\n        try {\r\n            while (flags.length < nPoints) {\r\n                if (p >= view.byteLength) return null;\r\n                const flag = this.reader.getUint8(view, p++);\r\n                flags.push(flag);\r\n\r\n                // Repeat flag (bit 3 set)\r\n                if (flag & 0x08) {\r\n                    if (p >= view.byteLength) return null;\r\n                    const repeatCount = this.reader.getUint8(view, p++);\r\n                    for (let r = 0; r < repeatCount; r++) {\r\n                        flags.push(flag);\r\n                    }\r\n                }\r\n            }\r\n        } catch {\r\n            return null;\r\n        }\r\n\r\n        return { flags, nextOffset: p };\r\n    }\r\n\r\n    /**\r\n     * Parses glyph X and Y coordinates from delta values.\r\n     * @param view - DataView containing the glyph data\r\n     * @param flags - Flag array for each point\r\n     * @param offset - Starting offset for coordinates\r\n     * @returns Points array and next offset, or null if parsing fails\r\n     */\r\n    private parseCoordinates(\r\n        view: DataView,\r\n        flags: number[],\r\n        offset: number\r\n    ): { points: Point[]; nextOffset: number } | null {\r\n        const nPoints = flags.length;\r\n        const xs: number[] = new Array(nPoints);\r\n        const ys: number[] = new Array(nPoints);\r\n\r\n        let p = offset;\r\n\r\n        // Parse X coordinates (deltas)\r\n        try {\r\n            for (let i = 0; i < nPoints; i++) {\r\n                const f = flags[i];\r\n                if (f & 0x02) {\r\n                    // X-Short Vector: 1-byte delta\r\n                    if (p >= view.byteLength) return null;\r\n                    const val = this.reader.getUint8(view, p++);\r\n                    xs[i] = (f & 0x10) ? val : -val; // Bit 4: positive if set\r\n                } else {\r\n                    if (f & 0x10) {\r\n                        // X is same as previous (zero delta)\r\n                        xs[i] = 0;\r\n                    } else {\r\n                        // 2-byte signed delta\r\n                        if (p + 2 > view.byteLength) return null;\r\n                        xs[i] = this.reader.getInt16(view, p);\r\n                        p += 2;\r\n                    }\r\n                }\r\n            }\r\n        } catch {\r\n            return null;\r\n        }\r\n\r\n        // Parse Y coordinates (deltas)\r\n        try {\r\n            for (let i = 0; i < nPoints; i++) {\r\n                const f = flags[i];\r\n                if (f & 0x04) {\r\n                    // Y-Short Vector: 1-byte delta\r\n                    if (p >= view.byteLength) return null;\r\n                    const val = this.reader.getUint8(view, p++);\r\n                    ys[i] = (f & 0x20) ? val : -val; // Bit 5: positive if set\r\n                } else {\r\n                    if (f & 0x20) {\r\n                        // Y is same as previous (zero delta)\r\n                        ys[i] = 0;\r\n                    } else {\r\n                        // 2-byte signed delta\r\n                        if (p + 2 > view.byteLength) return null;\r\n                        ys[i] = this.reader.getInt16(view, p);\r\n                        p += 2;\r\n                    }\r\n                }\r\n            }\r\n        } catch {\r\n            return null;\r\n        }\r\n\r\n        // Convert deltas to absolute coordinates\r\n        const points: Point[] = new Array(nPoints);\r\n        let curX = 0;\r\n        let curY = 0;\r\n        for (let i = 0; i < nPoints; i++) {\r\n            curX += xs[i];\r\n            curY += ys[i];\r\n            points[i] = {\r\n                x: curX,\r\n                y: curY,\r\n                onCurve: !!(flags[i] & 0x01) // Bit 0: on-curve flag\r\n            };\r\n        }\r\n\r\n        return { points, nextOffset: p };\r\n    }\r\n\r\n    /**\r\n     * Converts contour points into glyph outline commands.\r\n     * Handles quadratic Bezier curves with consecutive off-curve points.\r\n     * @param contours - Array of contours\r\n     * @returns Array of glyph outline commands\r\n     */\r\n    private buildOutlineCommands(contours: Point[][]): GlyphOutlineCmd[] {\r\n        const cmds: GlyphOutlineCmd[] = [];\r\n\r\n        for (const contour of contours) {\r\n            if (contour.length === 0) continue;\r\n\r\n            const n = contour.length;\r\n            const getIdx = (i: number) => ((i % n) + n) % n; // Wrap-around index\r\n\r\n            // Find a starting on-curve point, if any\r\n            let startPtIndex = -1;\r\n            for (let i = 0; i < n; i++) {\r\n                if (contour[i].onCurve) {\r\n                    startPtIndex = i;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            let firstPoint: Point;\r\n            let curIndex: number;\r\n\r\n            if (startPtIndex === -1) {\r\n                // No on-curve points: create implied on-curve between last and first off-curve\r\n                const p0 = contour[0];\r\n                const plast = contour[n - 1];\r\n                firstPoint = {\r\n                    x: (plast.x + p0.x) / 2,\r\n                    y: (plast.y + p0.y) / 2,\r\n                    onCurve: true\r\n                };\r\n                curIndex = 0;\r\n            } else {\r\n                firstPoint = contour[startPtIndex];\r\n                curIndex = startPtIndex;\r\n            }\r\n\r\n            cmds.push({ type: \"moveTo\", x: firstPoint.x, y: firstPoint.y });\r\n\r\n            // Walk through contour points\r\n            let i = curIndex + 1;\r\n            let steps = 0;\r\n            while (steps < n) {\r\n                const idx = getIdx(i);\r\n                const pt = contour[idx];\r\n                const next = contour[getIdx(i + 1)];\r\n\r\n                if (pt.onCurve) {\r\n                    // Straight line to on-curve point\r\n                    cmds.push({ type: \"lineTo\", x: pt.x, y: pt.y });\r\n                } else {\r\n                    // Off-curve point (quadratic control point)\r\n                    if (next.onCurve) {\r\n                        // Single control point -> quadratic curve\r\n                        cmds.push({ type: \"quadTo\", cx: pt.x, cy: pt.y, x: next.x, y: next.y });\r\n                        i++; // Consume next point\r\n                        steps++;\r\n                    } else {\r\n                        // Consecutive off-curve points: create implied on-curve midpoint\r\n                        const midx = (pt.x + next.x) / 2;\r\n                        const midy = (pt.y + next.y) / 2;\r\n                        cmds.push({ type: \"quadTo\", cx: pt.x, cy: pt.y, x: midx, y: midy });\r\n                    }\r\n                }\r\n\r\n                i++;\r\n                steps++;\r\n            }\r\n\r\n            cmds.push({ type: \"close\" });\r\n        }\r\n\r\n        return cmds;\r\n    }\r\n}\r\n", "import type { GlyphOutlineCmd } from \"../../types/fonts.js\";\r\n\r\n/**\r\n * Represents a 2D affine transformation matrix with translation.\r\n * Used for transforming composite glyph components in TrueType fonts.\r\n * \r\n * Matrix form:\r\n * | mxx  myx  tx |\r\n * | mxy  myy  ty |\r\n * |  0    0    1 |\r\n */\r\nexport class TransformationMatrix {\r\n    constructor(\r\n        public readonly mxx: number = 1,\r\n        public readonly mxy: number = 0,\r\n        public readonly myx: number = 0,\r\n        public readonly myy: number = 1,\r\n        public readonly tx: number = 0,\r\n        public readonly ty: number = 0\r\n    ) { }\r\n\r\n    /**\r\n     * Creates an identity transformation matrix (no transformation).\r\n     */\r\n    static identity(): TransformationMatrix {\r\n        return new TransformationMatrix();\r\n    }\r\n\r\n    /**\r\n     * Creates a uniform scale transformation matrix.\r\n     * @param s - Scale factor for both X and Y axes\r\n     */\r\n    static scale(s: number): TransformationMatrix {\r\n        return new TransformationMatrix(s, 0, 0, s, 0, 0);\r\n    }\r\n\r\n    /**\r\n     * Creates a non-uniform scale transformation matrix.\r\n     * @param sx - Scale factor for X axis\r\n     * @param sy - Scale factor for Y axis\r\n     */\r\n    static scaleXY(sx: number, sy: number): TransformationMatrix {\r\n        return new TransformationMatrix(sx, 0, 0, sy, 0, 0);\r\n    }\r\n\r\n    /**\r\n     * Creates a translation transformation matrix.\r\n     * @param tx - Translation along X axis\r\n     * @param ty - Translation along Y axis\r\n     */\r\n    static translate(tx: number, ty: number): TransformationMatrix {\r\n        return new TransformationMatrix(1, 0, 0, 1, tx, ty);\r\n    }\r\n\r\n    /**\r\n     * Creates a transformation matrix from TrueType component transform data.\r\n     * @param tx - Translation X\r\n     * @param ty - Translation Y\r\n     * @param mxx - Matrix element (1,1)\r\n     * @param mxy - Matrix element (1,2)\r\n     * @param myx - Matrix element (2,1)\r\n     * @param myy - Matrix element (2,2)\r\n     */\r\n    static fromComponents(\r\n        tx: number,\r\n        ty: number,\r\n        mxx: number = 1,\r\n        mxy: number = 0,\r\n        myx: number = 0,\r\n        myy: number = 1\r\n    ): TransformationMatrix {\r\n        return new TransformationMatrix(mxx, mxy, myx, myy, tx, ty);\r\n    }\r\n\r\n    /**\r\n     * Transforms a single point using this matrix.\r\n     * @param x - X coordinate\r\n     * @param y - Y coordinate\r\n     * @returns Transformed coordinates\r\n     */\r\n    transformPoint(x: number, y: number): { x: number; y: number } {\r\n        return {\r\n            x: x * this.mxx + y * this.myx + this.tx,\r\n            y: x * this.mxy + y * this.myy + this.ty\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Applies this transformation to a list of glyph outline commands.\r\n     * Creates new command objects with transformed coordinates.\r\n     * @param cmds - Original glyph outline commands\r\n     * @returns New array of transformed commands\r\n     */\r\n    applyToCommands(cmds: GlyphOutlineCmd[]): GlyphOutlineCmd[] {\r\n        const out: GlyphOutlineCmd[] = [];\r\n\r\n        for (const c of cmds) {\r\n            switch (c.type) {\r\n                case \"moveTo\": {\r\n                    const { x, y } = this.transformPoint(c.x, c.y);\r\n                    out.push({ type: \"moveTo\", x, y });\r\n                    break;\r\n                }\r\n                case \"lineTo\": {\r\n                    const { x, y } = this.transformPoint(c.x, c.y);\r\n                    out.push({ type: \"lineTo\", x, y });\r\n                    break;\r\n                }\r\n                case \"quadTo\": {\r\n                    const cp = this.transformPoint(c.cx, c.cy);\r\n                    const ep = this.transformPoint(c.x, c.y);\r\n                    out.push({ type: \"quadTo\", cx: cp.x, cy: cp.y, x: ep.x, y: ep.y });\r\n                    break;\r\n                }\r\n                case \"cubicTo\": {\r\n                    const cp1 = this.transformPoint(c.cx1, c.cy1);\r\n                    const cp2 = this.transformPoint(c.cx2, c.cy2);\r\n                    const ep = this.transformPoint(c.x, c.y);\r\n                    out.push({\r\n                        type: \"cubicTo\",\r\n                        cx1: cp1.x, cy1: cp1.y,\r\n                        cx2: cp2.x, cy2: cp2.y,\r\n                        x: ep.x, y: ep.y\r\n                    });\r\n                    break;\r\n                }\r\n                case \"close\": {\r\n                    out.push({ type: \"close\" });\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        return out;\r\n    }\r\n}\r\n", "import type { GlyphOutlineCmd } from \"../../types/fonts.js\";\r\nimport type { DataViewReader } from \"./ttf-table-provider.js\";\r\nimport { TransformationMatrix } from \"./transformation-matrix.js\";\r\n\r\n/**\r\n * Provider interface for retrieving glyph outlines.\r\n * Used to resolve component glyph references in composite glyphs.\r\n */\r\nexport interface GlyphOutlineProvider {\r\n    /**\r\n     * Gets the outline for a glyph.\r\n     * @param glyphId - The glyph ID\r\n     * @param depth - Current recursion depth (for preventing infinite recursion)\r\n     * @returns Glyph outline commands, or null if not available\r\n     */\r\n    getOutline(glyphId: number, depth?: number): GlyphOutlineCmd[] | null;\r\n}\r\n\r\n/**\r\n * Component transformation and reference data.\r\n */\r\ninterface ComponentData {\r\n    glyphIndex: number;\r\n    flags: number;\r\n    transform: TransformationMatrix;\r\n    hasMoreComponents: boolean;\r\n}\r\n\r\n/**\r\n * Parses composite (component-based) TrueType glyphs.\r\n * \r\n * Composite glyphs are built from one or more simple glyphs (components),\r\n * each with its own transformation (translation, scale, rotation).\r\n */\r\nexport class CompositeGlyphParser {\r\n    private readonly recursionLimit = 8;\r\n    private readonly visited: Set<number> = new Set();\r\n\r\n    // Component flags\r\n    private static readonly ARG_1_AND_2_ARE_WORDS = 0x0001;\r\n    private static readonly WE_HAVE_A_SCALE = 0x0008;\r\n    private static readonly MORE_COMPONENTS = 0x0020;\r\n    private static readonly WE_HAVE_AN_X_AND_Y_SCALE = 0x0040;\r\n    private static readonly WE_HAVE_A_TWO_BY_TWO = 0x0080;\r\n\r\n    constructor(private readonly reader: DataViewReader) { }\r\n\r\n    /**\r\n     * Parses a composite glyph.\r\n     * @param view - DataView containing the composite glyph data\r\n     * @param provider - Provider for resolving component glyph references\r\n     * @param depth - Current recursion depth\r\n     * @returns Array of glyph outline commands, or null if parsing fails\r\n     */\r\n    parse(\r\n        view: DataView,\r\n        provider: GlyphOutlineProvider,\r\n        depth: number = 0\r\n    ): GlyphOutlineCmd[] | null {\r\n        if (depth > this.recursionLimit) return null;\r\n\r\n        // Composite glyph component records start at offset 10 (after header)\r\n        const cmds = this.parseComponentRecords(view, 10, provider, depth);\r\n\r\n        // Clear visited set for next parse\r\n        this.visited.clear();\r\n\r\n        return cmds;\r\n    }\r\n\r\n    /**\r\n     * Parses component records from a composite glyph.\r\n     * @param view - DataView containing the glyph data\r\n     * @param startOffset - Starting offset for component records\r\n     * @param provider - Provider for resolving component references\r\n     * @param depth - Current recursion depth\r\n     * @returns Combined outline commands from all components, or null if parsing fails\r\n     */\r\n    private parseComponentRecords(\r\n        view: DataView,\r\n        startOffset: number,\r\n        provider: GlyphOutlineProvider,\r\n        depth: number\r\n    ): GlyphOutlineCmd[] | null {\r\n        if (depth > this.recursionLimit) return null;\r\n\r\n        let offset = startOffset;\r\n        const allCmds: GlyphOutlineCmd[] = [];\r\n\r\n        while (true) {\r\n            const component = this.readComponentData(view, offset);\r\n            if (!component) return null;\r\n\r\n            offset = this.calculateNextOffset(view, offset, component.flags);\r\n\r\n            // Prevent infinite recursion cycles\r\n            if (this.visited.has(component.glyphIndex)) {\r\n                // Skip this component to avoid cycle\r\n            } else {\r\n                this.visited.add(component.glyphIndex);\r\n\r\n                // Get component's outline\r\n                const componentCmds = provider.getOutline(component.glyphIndex, depth + 1);\r\n                if (componentCmds && componentCmds.length > 0) {\r\n                    // Transform the component's outline\r\n                    const transformedCmds = component.transform.applyToCommands(componentCmds);\r\n\r\n                    // Ensure proper moveTo at start if needed\r\n                    if (transformedCmds.length > 0 && transformedCmds[0].type !== \"moveTo\") {\r\n                        const firstCoord = this.findFirstCoordinate(transformedCmds);\r\n                        if (firstCoord) {\r\n                            allCmds.push({ type: \"moveTo\", x: firstCoord.x, y: firstCoord.y });\r\n                        }\r\n                    }\r\n\r\n                    allCmds.push(...transformedCmds);\r\n                }\r\n            }\r\n\r\n            // Check if there are more components\r\n            if (!component.hasMoreComponents) break;\r\n        }\r\n\r\n        return allCmds.length > 0 ? allCmds : null;\r\n    }\r\n\r\n    /**\r\n     * Reads a single component's data from the view.\r\n     * @param view - DataView containing the glyph data\r\n     * @param offset - Starting offset for this component\r\n     * @returns Component data or null if reading fails\r\n     */\r\n    private readComponentData(view: DataView, offset: number): ComponentData | null {\r\n        if (offset + 4 > view.byteLength) return null;\r\n\r\n        const flags = this.reader.getUint16(view, offset);\r\n        const glyphIndex = this.reader.getUint16(view, offset + 2);\r\n        let p = offset + 4;\r\n\r\n        // Read arguments (translation or matching points)\r\n        let arg1 = 0;\r\n        let arg2 = 0;\r\n\r\n        if (flags & CompositeGlyphParser.ARG_1_AND_2_ARE_WORDS) {\r\n            // 16-bit signed arguments\r\n            if (p + 4 > view.byteLength) return null;\r\n            arg1 = this.reader.getInt16(view, p);\r\n            arg2 = this.reader.getInt16(view, p + 2);\r\n            p += 4;\r\n        } else {\r\n            // 8-bit signed arguments\r\n            if (p + 2 > view.byteLength) return null;\r\n            arg1 = this.reader.getInt8(view, p);\r\n            arg2 = this.reader.getInt8(view, p + 1);\r\n            p += 2;\r\n        }\r\n\r\n        // Read transformation matrix\r\n        let mxx = 1, mxy = 0, myx = 0, myy = 1;\r\n\r\n        if (flags & CompositeGlyphParser.WE_HAVE_A_SCALE) {\r\n            // Uniform scale\r\n            if (p + 2 > view.byteLength) return null;\r\n            const scale = this.reader.getInt16(view, p) / (1 << 14);\r\n            mxx = scale;\r\n            myy = scale;\r\n        } else if (flags & CompositeGlyphParser.WE_HAVE_AN_X_AND_Y_SCALE) {\r\n            // Non-uniform scale\r\n            if (p + 4 > view.byteLength) return null;\r\n            const sx = this.reader.getInt16(view, p) / (1 << 14);\r\n            const sy = this.reader.getInt16(view, p + 2) / (1 << 14);\r\n            mxx = sx;\r\n            myy = sy;\r\n        } else if (flags & CompositeGlyphParser.WE_HAVE_A_TWO_BY_TWO) {\r\n            // Full 2x2 matrix\r\n            if (p + 8 > view.byteLength) return null;\r\n            mxx = this.reader.getInt16(view, p) / (1 << 14);\r\n            mxy = this.reader.getInt16(view, p + 2) / (1 << 14);\r\n            myx = this.reader.getInt16(view, p + 4) / (1 << 14);\r\n            myy = this.reader.getInt16(view, p + 6) / (1 << 14);\r\n        }\r\n\r\n        // Treat args as translation (simplified - spec allows matching points too)\r\n        const transform = TransformationMatrix.fromComponents(arg1, arg2, mxx, mxy, myx, myy);\r\n\r\n        return {\r\n            glyphIndex,\r\n            flags,\r\n            transform,\r\n            hasMoreComponents: !!(flags & CompositeGlyphParser.MORE_COMPONENTS)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Calculates the next offset after reading a component record.\r\n     * @param view - DataView containing the glyph data\r\n     * @param offset - Current offset\r\n     * @param flags - Component flags\r\n     * @returns Next offset\r\n     */\r\n    private calculateNextOffset(view: DataView, offset: number, flags: number): number {\r\n        let p = offset + 4; // flags + glyphIndex\r\n\r\n        // Skip arguments\r\n        if (flags & CompositeGlyphParser.ARG_1_AND_2_ARE_WORDS) {\r\n            p += 4;\r\n        } else {\r\n            p += 2;\r\n        }\r\n\r\n        // Skip transformation data\r\n        if (flags & CompositeGlyphParser.WE_HAVE_A_SCALE) {\r\n            p += 2;\r\n        } else if (flags & CompositeGlyphParser.WE_HAVE_AN_X_AND_Y_SCALE) {\r\n            p += 4;\r\n        } else if (flags & CompositeGlyphParser.WE_HAVE_A_TWO_BY_TWO) {\r\n            p += 8;\r\n        }\r\n\r\n        return p;\r\n    }\r\n\r\n    /**\r\n     * Finds the first coordinate in a list of commands.\r\n     * @param cmds - Array of glyph outline commands\r\n     * @returns First coordinate found, or null\r\n     */\r\n    private findFirstCoordinate(cmds: GlyphOutlineCmd[]): { x: number; y: number } | null {\r\n        for (const c of cmds) {\r\n            if (c.type === \"moveTo\" || c.type === \"lineTo\") {\r\n                return { x: c.x, y: c.y };\r\n            }\r\n            if (c.type === \"quadTo\") {\r\n                return { x: c.x, y: c.y };\r\n            }\r\n            if (c.type === \"cubicTo\") {\r\n                return { x: c.x, y: c.y };\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n}\r\n", "import type { GlyphOutlineCmd } from \"../../types/fonts.js\";\r\nimport type { GlyphTableProvider } from \"./ttf-table-provider.js\";\r\nimport type { GlyphOutlineProvider } from \"./composite-glyph-parser.js\";\r\nimport { LocaTableReader } from \"./loca-reader.js\";\r\nimport { SimpleGlyphParser } from \"./simple-glyph-parser.js\";\r\nimport { CompositeGlyphParser } from \"./composite-glyph-parser.js\";\r\n\r\n// Table tags\r\nconst LOCA = 0x6c6f6361; // 'loca'\r\nconst GLYF = 0x676c7966; // 'glyf'\r\nconst HEAD = 0x68656164; // 'head'\r\n\r\n/**\r\n * Minimal TrueType glyf/loca parser.\r\n *\r\n * - Supports simple glyphs (contours with on-curve + off-curve quadratic points).\r\n * - Supports composite glyphs (components with transformations).\r\n * - Provides robust bounds checks and defensive behavior.\r\n *\r\n * Produces a function getGlyphOutline(gid) => GlyphOutlineCmd[] | null\r\n */\r\n\r\n/**\r\n * Creates a glyph outline provider function for a TrueType font.\r\n * @param parser - Provider for accessing font tables and reading binary data\r\n * @returns Function that returns glyph outline commands for a given glyph ID\r\n */\r\nexport function createGlyfOutlineProvider(\r\n  parser: GlyphTableProvider\r\n): (gid: number) => GlyphOutlineCmd[] | null {\r\n\r\n  // Read head table to determine loca format\r\n  const headTable = parser.getTable(HEAD);\r\n  if (!headTable) {\r\n    return () => null; // Cannot determine loca format\r\n  }\r\n\r\n  const indexToLocFormat = readIndexToLocFormat(headTable, parser);\r\n\r\n  // Get required tables\r\n  const locaTable = parser.getTable(LOCA);\r\n  const glyfTable = parser.getTable(GLYF);\r\n\r\n  if (!locaTable || !glyfTable) {\r\n    return () => null;\r\n  }\r\n\r\n  // Initialize parsers and readers\r\n  const locaReader = new LocaTableReader(locaTable, indexToLocFormat, parser);\r\n  const simpleParser = new SimpleGlyphParser(parser);\r\n  const compositeParser = new CompositeGlyphParser(parser);\r\n\r\n  /**\r\n   * Internal recursive function for getting glyph outlines.\r\n   * @param gid - Glyph ID\r\n   * @param depth - Current recursion depth\r\n   * @returns Glyph outline commands or null\r\n   */\r\n  const getOutlineInternal = (gid: number, depth: number = 0): GlyphOutlineCmd[] | null => {\r\n    // Get glyph offset range from loca table\r\n    const range = locaReader.getGlyphOffset(gid);\r\n    if (!range) return null;\r\n\r\n    // Check for empty glyph\r\n    if (range.start === range.end) return null;\r\n\r\n    // Validate range against glyf table size\r\n    if (!locaReader.validateRange(range, glyfTable.byteLength)) return null;\r\n\r\n    // Create DataView for this glyph's data\r\n    const view = createGlyphView(glyfTable, range.start, range.end);\r\n    if (!view || view.byteLength < 10) return null;\r\n\r\n    // Read numberOfContours to determine glyph type\r\n    const numberOfContours = view.getInt16(0, false);\r\n\r\n    if (numberOfContours >= 0) {\r\n      // Simple glyph\r\n      return simpleParser.parse(view);\r\n    } else {\r\n      // Composite glyph\r\n      const provider: GlyphOutlineProvider = {\r\n        getOutline: (componentGid: number, componentDepth?: number) =>\r\n          getOutlineInternal(componentGid, componentDepth ?? 0)\r\n      };\r\n      return compositeParser.parse(view, provider, depth);\r\n    }\r\n  };\r\n\r\n  // Return the public provider function\r\n  return (gid: number) => getOutlineInternal(gid, 0);\r\n}\r\n\r\n/**\r\n * Reads the indexToLocFormat field from the head table.\r\n * @param headTable - DataView of the head table\r\n * @param reader - Binary data reader\r\n * @returns Format value (0 = short, 1 = long)\r\n */\r\nfunction readIndexToLocFormat(headTable: DataView, reader: GlyphTableProvider): number {\r\n  try {\r\n    // indexToLocFormat is at offset 50 in the head table\r\n    return reader.getUint16(headTable, 50);\r\n  } catch {\r\n    return 0; // Default to short format on error\r\n  }\r\n}\r\n\r\n/**\r\n * Creates a DataView for a specific glyph's data within the glyf table.\r\n * @param glyfTable - DataView of the glyf table\r\n * @param start - Start offset\r\n * @param end - End offset\r\n * @returns DataView for the glyph data, or null if invalid\r\n */\r\nfunction createGlyphView(glyfTable: DataView, start: number, end: number): DataView | null {\r\n  try {\r\n    return new DataView(glyfTable.buffer, glyfTable.byteOffset + start, end - start);\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n// Re-export types for convenience\r\nexport type { GlyphTableProvider } from \"./ttf-table-provider.js\";\r\n", "import type { FontFormat } from './types.js';\r\n\r\nexport function detectFontFormat(fontData: Uint8Array): FontFormat | null {\r\n  if (fontData.length < 4) {\r\n    return null;\r\n  }\r\n\r\n  // Read the first 4 bytes as signature\r\n  const signature = String.fromCharCode(...fontData.slice(0, 4));\r\n\r\n  switch (signature) {\r\n    case 'wOFF':\r\n      return 'woff';\r\n    case 'wOF2':\r\n      return 'woff2';\r\n    case '\\x00\\x01\\x00\\x00': // TTF/OTF signature\r\n    case 'OTTO': // OTF signature\r\n      // For simplicity, we'll treat both TTF and OTF as 'ttf' for now\r\n      // Later we can differentiate if needed\r\n      return fontData[0] === 0 && fontData[1] === 1 ? 'ttf' : 'otf';\r\n    default:\r\n      return null;\r\n  }\r\n}\r\n\r\nexport function isSupportedFontFormat(fontData: Uint8Array): boolean {\r\n  return detectFontFormat(fontData) !== null;\r\n}\r\n", "import type { ParsedFont } from '../types.js';\r\n\r\n/**\r\n * Reconstructs a TTF buffer from parsed font tables.\r\n * This is useful when we have extracted tables from WOFF/WOFF2 and need to\r\n * pass them to a consumer that expects a valid TTF binary (like ttf-lite).\r\n * \r\n * @param parsedFont - The parsed font containing tables and flavor\r\n * @returns A reconstructed TTF ArrayBuffer\r\n */\r\nexport function reconstructTtf(parsedFont: ParsedFont): ArrayBuffer {\r\n    const sfntVersion = parsedFont.flavor >>> 0; // TTF/OTF flavor\r\n    const numTables = parsedFont.numTables;\r\n\r\n    // Calculate required space: header(12) + tableDir(16*numTables) + tableData\r\n    const headerSize = 12;\r\n    const tableDirSize = 16 * numTables;\r\n    let totalDataSize = 0;\r\n    const tableEntries: Array<{ tag: string, data: Uint8Array }> = [];\r\n\r\n    // Sort tables by tag for deterministic order (required by TTF spec)\r\n    Object.entries(parsedFont.tables).sort(([a], [b]) => a.localeCompare(b)).forEach(([tag, data]) => {\r\n        let entryData = data;\r\n        if (tag === 'head') {\r\n            const view = new DataView(data.buffer, data.byteOffset, data.length);\r\n            // Check unitsPerEm at offset 18\r\n            if (data.length >= 20) {\r\n                const units = view.getUint16(18, false);\r\n                if (units === 0) {\r\n                    // Patch unitsPerEm to 1000 if 0 (invalid)\r\n                    // We need to copy the data to modify it as it might be a slice of a larger buffer\r\n                    const patchedData = new Uint8Array(data);\r\n                    const patchedView = new DataView(patchedData.buffer);\r\n                    patchedView.setUint16(18, 1000, false);\r\n                    entryData = patchedData;\r\n                }\r\n            }\r\n        }\r\n        tableEntries.push({ tag, data: entryData });\r\n        // 4-byte alignment padding\r\n        const padding = (4 - (entryData.length % 4)) % 4;\r\n        totalDataSize += entryData.length + padding;\r\n    });\r\n\r\n    const buffer = new ArrayBuffer(headerSize + tableDirSize + totalDataSize);\r\n    const view = new Uint8Array(buffer);\r\n    const dataView = new DataView(buffer);\r\n\r\n    // Write TTF header\r\n    dataView.setUint32(0, sfntVersion, false); // Big endian\r\n    dataView.setUint16(4, numTables, false);\r\n\r\n    // Calculate searchRange, entrySelector, rangeShift\r\n    let entrySelector = 0;\r\n    let searchRange = 1;\r\n    while (searchRange * 2 <= numTables) {\r\n        searchRange *= 2;\r\n        entrySelector++;\r\n    }\r\n    searchRange *= 16;\r\n    const rangeShift = numTables * 16 - searchRange;\r\n\r\n    dataView.setUint16(6, searchRange, false);\r\n    dataView.setUint16(8, entrySelector, false);\r\n    dataView.setUint16(10, rangeShift, false);\r\n\r\n    let currentOffset = headerSize + tableDirSize;\r\n    let dirOffset = 12;\r\n\r\n    for (const entry of tableEntries) {\r\n        const { tag, data } = entry;\r\n\r\n        // Write table directory entry\r\n        for (let i = 0; i < 4; i++) {\r\n            view[dirOffset + i] = tag.charCodeAt(i);\r\n        }\r\n\r\n        // Calculate checksum (simplified)\r\n        const checksum = calculateTableChecksum(data);\r\n        dataView.setUint32(dirOffset + 4, checksum, false);\r\n\r\n        dataView.setUint32(dirOffset + 8, currentOffset, false); // offset\r\n        dataView.setUint32(dirOffset + 12, data.length, false); // length\r\n\r\n        // Write table data\r\n        view.set(data, currentOffset);\r\n\r\n        // Add padding\r\n        const padding = (4 - (data.length % 4)) % 4;\r\n        currentOffset += data.length + padding;\r\n\r\n        dirOffset += 16;\r\n    }\r\n\r\n    return buffer;\r\n}\r\n\r\nfunction calculateTableChecksum(data: Uint8Array): number {\r\n    let sum = 0;\r\n    const nlongs = Math.floor((data.length + 3) / 4);\r\n\r\n    for (let i = 0; i < nlongs; i++) {\r\n        // Read as uint32 big endian, handling potential out of bounds for last bytes\r\n        let val = 0;\r\n        const offset = i * 4;\r\n        if (offset + 4 <= data.length) {\r\n            val = (data[offset] << 24) | (data[offset + 1] << 16) | (data[offset + 2] << 8) | data[offset + 3];\r\n        } else {\r\n            // Handle partial last word\r\n            for (let j = 0; j < 4; j++) {\r\n                if (offset + j < data.length) {\r\n                    val |= data[offset + j] << (24 - j * 8);\r\n                }\r\n            }\r\n        }\r\n        sum = (sum + val) >>> 0; // Keep as unsigned 32-bit\r\n    }\r\n\r\n    return sum;\r\n}\r\n", "import type { TtfFontMetrics } from \"../../types/fonts.js\";\r\n\r\n/**\r\n * Compute DW (default width) and compressed W array from glyph metrics.\r\n * Shared utility used by font embedding and tests.\r\n */\r\nexport function computeWidths(metrics: TtfFontMetrics): { DW: number; W: (number | number[])[] } {\r\n  const count = metrics.glyphMetrics.size;\r\n  const widths: number[] = new Array(count).fill(0);\r\n  for (const [gid, gm] of metrics.glyphMetrics) {\r\n    widths[gid] = Math.round((gm.advanceWidth / metrics.metrics.unitsPerEm) * 1000);\r\n  }\r\n\r\n  const computeDW = (arr: number[]) => {\r\n    const freq = new Map<number, number>();\r\n    for (const v of arr) {\r\n      // Skip zero widths; a DW of 0 breaks Identity-H rendering in some viewers.\r\n      if (v === 0) continue;\r\n      freq.set(v, (freq.get(v) ?? 0) + 1);\r\n    }\r\n    // Fallback to 1000 if we only saw zeros.\r\n    if (freq.size === 0) {\r\n      return 1000;\r\n    }\r\n    let best = 1000;\r\n    let bestCount = -1;\r\n    for (const [v, c] of freq.entries()) {\r\n      if (c > bestCount || (c === bestCount && v < best)) {\r\n        best = v;\r\n        bestCount = c;\r\n      }\r\n    }\r\n    return best;\r\n  };\r\n\r\n  const DW = computeDW(widths);\r\n\r\n  // Compress widths into W entries using ranges for repeating values and arrays for heterogenous runs\r\n  // The PDF spec requires a flat array of mixed types:\r\n  // c [w1 w2 ... wn]\r\n  // c_first c_last w\r\n  const result: (number | number[])[] = [];\r\n  let i = 0;\r\n  while (i < count) {\r\n    // skip DW values\r\n    if (widths[i] === DW) {\r\n      i++;\r\n      continue;\r\n    }\r\n\r\n    // try find long run of identical width (use range if length >= 4)\r\n    const start = i;\r\n    const val = widths[i];\r\n    let j = i + 1;\r\n    while (j < count && widths[j] === val) j++;\r\n    const runLen = j - start;\r\n    if (runLen >= 4) {\r\n      // c_first c_last w\r\n      result.push(start);\r\n      result.push(j - 1);\r\n      result.push(val);\r\n      i = j;\r\n      continue;\r\n    }\r\n\r\n    // otherwise build a heterogenous list until we hit DW or reach a reasonable chunk (32)\r\n    const listStart = i;\r\n    const list: number[] = [];\r\n    while (i < count && widths[i] !== DW && list.length < 32) {\r\n      list.push(widths[i]);\r\n      i++;\r\n    }\r\n    // c [w1 ... wn]\r\n    result.push(listStart);\r\n    result.push(list);\r\n  }\r\n\r\n  return { DW, W: result };\r\n}\r\n", "/**\n * Build ToUnicode CMap text from explicit gid->unicode mappings.\n * Entries should be pre-sorted by gid for best compression but ordering is not required.\n */\nexport function createToUnicodeCMapText(entries: { gid: number; unicode: number }[]): string {\n  if (!entries || entries.length === 0) {\n    return `/CIDInit /ProcSet findresource begin\n12 dict begin\nbegincmap\n/CIDSystemInfo <<\n  /Registry (Adobe)\n  /Ordering (UCS)\n  /Supplement 0\n>> def\n/CMapName /Adobe-Identity-UCS def\n/CMapType 2 def\n1 begincodespacerange\n<0000> <FFFF>\nendcodespacerange\nendcmap\nCMapName currentdict /CMap defineresource pop\nend\nend`;\n  }\n\n  const es = entries.slice().sort((a, b) => a.gid - b.gid);\n\n  const uniToUtf16Hex = (cp: number): string => {\n    if (cp <= 0xffff) {\n      return cp.toString(16).padStart(4, \"0\").toUpperCase();\n    }\n    const v = cp - 0x10000;\n    const hi = 0xd800 + (v >> 10);\n    const lo = 0xdc00 + (v & 0x3ff);\n    return hi.toString(16).padStart(4, \"0\").toUpperCase() + lo.toString(16).padStart(4, \"0\").toUpperCase();\n  };\n\n  // Build mapping directives (group consecutive linear runs into ranges)\n  type Mapping = { type: \"range\"; startG: number; endG: number; startU: number } | { type: \"char\"; gid: number; unicode: number };\n  const mappings: Mapping[] = [];\n  let i = 0;\n  while (i < es.length) {\n    const start = es[i];\n    let j = i + 1;\n    while (\n      j < es.length &&\n      es[j].gid === es[j - 1].gid + 1 &&\n      es[j].unicode === es[j - 1].unicode + 1\n    ) {\n      j++;\n    }\n    const runLen = j - i;\n    if (runLen >= 2) {\n      mappings.push({ type: \"range\", startG: start.gid, endG: es[j - 1].gid, startU: start.unicode });\n      i = j;\n    } else {\n      mappings.push({ type: \"char\", gid: start.gid, unicode: start.unicode });\n      i++;\n    }\n  }\n\n  const lines: string[] = [];\n  lines.push(\"/CIDInit /ProcSet findresource begin\");\n  lines.push(\"12 dict begin\");\n  lines.push(\"begincmap\");\n  lines.push(\"/CIDSystemInfo << /Registry (Adobe) /Ordering (UCS) /Supplement 0 >> def\");\n  lines.push(\"/CMapName /Adobe-Identity-UCS def\");\n  lines.push(\"/CMapType 2 def\");\n  lines.push(\"1 begincodespacerange\");\n  lines.push(\"<0000> <FFFF>\");\n  lines.push(\"endcodespacerange\");\n\n  const CHUNK = 100;\n  let p = 0;\n  while (p < mappings.length) {\n    const currentType = mappings[p].type;\n    const group: Mapping[] = [];\n    while (p < mappings.length && mappings[p].type === currentType && group.length < CHUNK) {\n      group.push(mappings[p]);\n      p++;\n    }\n\n    if (currentType === \"char\") {\n      lines.push(`${group.length} beginbfchar`);\n      for (const m of group as { type: \"char\"; gid: number; unicode: number }[]) {\n        const cid = m.gid.toString(16).padStart(4, \"0\").toUpperCase();\n        const uniHex = uniToUtf16Hex(m.unicode);\n        lines.push(`<${cid}> <${uniHex}>`);\n      }\n      lines.push(\"endbfchar\");\n    } else {\n      lines.push(`${group.length} beginbfrange`);\n      for (const m of group as { type: \"range\"; startG: number; endG: number; startU: number }[]) {\n        const startCid = m.startG.toString(16).padStart(4, \"0\").toUpperCase();\n        const endCid = m.endG.toString(16).padStart(4, \"0\").toUpperCase();\n        const startUniHex = uniToUtf16Hex(m.startU);\n        lines.push(`<${startCid}> <${endCid}> <${startUniHex}>`);\n      }\n      lines.push(\"endbfrange\");\n    }\n  }\n\n  lines.push(\"endcmap\");\n  lines.push(\"CMapName currentdict /CMap defineresource pop\");\n  lines.push(\"end\");\n  lines.push(\"end\");\n\n  return lines.join(\"\\n\");\n}\n", "/**\r\n * Font configuration and mapping data for PDF font resolution.\r\n * \r\n * This module centralizes all font alias mappings, generic family mappings,\r\n * and Base14 font variant configurations used throughout the font registry system.\r\n */\r\n\r\n/**\r\n * Base14 variant types supported by PDF standard fonts.\r\n */\r\nexport type Base14Variant = \"normal\" | \"italic\" | \"bold\" | \"boldItalic\";\r\n\r\n/**\r\n * Base14 font family names.\r\n */\r\nexport type Base14Family = \"Helvetica\" | \"Times-Roman\" | \"Courier\";\r\n\r\n/**\r\n * Variant configuration for a Base14 font family.\r\n */\r\nexport interface Base14Variants {\r\n    normal: string;\r\n    italic: string;\r\n    bold: string;\r\n    boldItalic: string;\r\n}\r\n\r\n/**\r\n * Maps common font family names to embedded font aliases.\r\n * \r\n * This enables fallback to built-in fonts when requested fonts aren't available.\n * For example, \"Arial\" \u2192 \"Arimo\", \"Times New Roman\" \u2192 \"Tinos\"\n */\nexport const BASE_FONT_ALIASES: ReadonlyMap<string, string> = new Map([\n    // Sans/UI families\n    [\"helvetica\", \"Lato\"],\n    [\"arial\", \"Arimo\"],\n    [\"arial black\", \"Arimo\"],\n    [\"segoe ui\", \"Roboto\"],\n    [\"open sans\", \"Lato\"],\n    [\"calibri\", \"Roboto\"],\n    [\"roboto\", \"Roboto\"],\n    [\"arimo\", \"Arimo\"],\n    [\"lato\", \"Lato\"],\n    [\"noto sans\", \"Noto Sans\"],\n    [\"notosans-regular\", \"Noto Sans\"],\n    [\"dejavu sans\", \"DejaVu Sans\"],\n\n    // Serif\n    [\"times\", \"Tinos\"],\n    [\"times-roman\", \"Tinos\"],\n    [\"times new roman\", \"Tinos\"],\n    [\"georgia\", \"Tinos\"],\n    [\"garamond\", \"Tinos\"],\n    [\"baskerville\", \"Tinos\"],\n\n    // Mono\n    [\"courier\", \"Fira Code\"],\n    [\"courier new\", \"Fira Code\"],\n    [\"consolas\", \"Fira Code\"],\n    [\"menlo\", \"Fira Code\"],\n    [\"monaco\", \"Fira Code\"],\n    [\"source code pro\", \"Fira Code\"],\n\n    // Decorative / cursive\n    [\"comic sans\", \"Caveat\"],\n    [\"comic sans ms\", \"Caveat\"],\n    [\"fantasy\", \"Cinzel Decorative\"],\n    [\"cursive\", \"Caveat\"],\n\n    // Emoji / math / symbols\n    [\"noto emoji\", \"Noto Emoji\"],\n    [\"noto color emoji\", \"Noto Emoji\"],\n    [\"segoe ui emoji\", \"Noto Emoji\"],\n    [\"apple color emoji\", \"Noto Emoji\"],\n    [\"twemoji\", \"Noto Emoji\"],\n    [\"cambria math\", \"STIX Two Math\"],\n    [\"stix two math\", \"STIX Two Math\"],\n    [\"math\", \"STIX Two Math\"],\n    [\"symbol\", \"Symbol\"],\n    [\"zapfdingbats\", \"ZapfDingbats\"],\n]);\n\n/**\n * Maps CSS generic font families to specific embedded fonts.\n * \n * Used when no specific font family is requested or as a final fallback.\n */\nexport const GENERIC_FAMILIES: ReadonlyMap<string, string> = new Map([\n    [\"serif\", \"Tinos\"],\n    [\"sans-serif\", \"Lato\"],\n    [\"monospace\", \"Fira Code\"],\n    [\"system-ui\", \"Roboto\"],\n    [\"cursive\", \"Caveat\"],\n    [\"fantasy\", \"Cinzel Decorative\"],\n    [\"emoji\", \"Noto Emoji\"],\n    [\"math\", \"STIX Two Math\"],\n]);\n\n/**\n * Maps common font family names to Base14 standard font fallbacks.\n * \n * Used when font embedding is disabled or not available.\n */\nexport const BASE14_FALLBACKS: ReadonlyMap<string, string> = new Map([\n    [\"times\", \"Times-Roman\"],\n    [\"times-roman\", \"Times-Roman\"],\n    [\"times new roman\", \"Times-Roman\"],\n    [\"georgia\", \"Times-Roman\"],\n    [\"garamond\", \"Times-Roman\"],\n    [\"baskerville\", \"Times-Roman\"],\n    [\"serif\", \"Times-Roman\"],\n    [\"helvetica\", \"Helvetica\"],\n    [\"arial\", \"Helvetica\"],\n    [\"segoe ui\", \"Helvetica\"],\n    [\"open sans\", \"Helvetica\"],\n    [\"calibri\", \"Helvetica\"],\n    [\"sans-serif\", \"Helvetica\"],\n    [\"system-ui\", \"Helvetica\"],\n    [\"courier\", \"Courier\"],\n    [\"courier new\", \"Courier\"],\n    [\"monospace\", \"Courier\"],\n]);\r\n\r\n/**\r\n * Base14 font family variants mapping.\r\n * \r\n * Defines the standard variant names for each Base14 font family.\r\n * Used to apply weight/style transformations to Base14 fonts.\r\n */\r\nexport const BASE14_FAMILY_VARIANTS: Record<Base14Family, Base14Variants> = {\r\n    \"Helvetica\": {\r\n        normal: \"Helvetica\",\r\n        italic: \"Helvetica-Oblique\",\r\n        bold: \"Helvetica-Bold\",\r\n        boldItalic: \"Helvetica-BoldOblique\",\r\n    },\r\n    \"Times-Roman\": {\r\n        normal: \"Times-Roman\",\r\n        italic: \"Times-Italic\",\r\n        bold: \"Times-Bold\",\r\n        boldItalic: \"Times-BoldItalic\",\r\n    },\r\n    \"Courier\": {\r\n        normal: \"Courier\",\r\n        italic: \"Courier-Oblique\",\r\n        bold: \"Courier-Bold\",\r\n        boldItalic: \"Courier-BoldOblique\",\r\n    },\r\n} as const;\r\n\r\n/**\r\n * Reverse lookup map: Base14 variant name \u2192 family + variant type.\r\n * \r\n * Built automatically from BASE14_FAMILY_VARIANTS.\r\n * Used to detect which Base14 family a font belongs to.\r\n */\r\nexport const BASE14_VARIANT_LOOKUP: ReadonlyMap<string, { family: Base14Family; variant: Base14Variant }> = (() => {\r\n    const lookup = new Map<string, { family: Base14Family; variant: Base14Variant }>();\r\n\r\n    for (const [family, variants] of Object.entries(BASE14_FAMILY_VARIANTS) as Array<[Base14Family, Record<Base14Variant, string>]>) {\r\n        for (const [variant, name] of Object.entries(variants) as Array<[Base14Variant, string]>) {\r\n            lookup.set(name.toLowerCase(), { family, variant });\r\n        }\r\n    }\r\n\r\n    return lookup;\r\n})();\r\n\r\n/**\r\n * Detect the Base14 family for a given font name.\r\n * \r\n * @param baseFont - Font name to check\r\n * @returns Base14 family name if found, null otherwise\r\n */\r\nexport function detectBase14Family(baseFont: string): Base14Family | null {\r\n    const entry = BASE14_VARIANT_LOOKUP.get(baseFont.toLowerCase());\r\n    return entry ? entry.family : null;\r\n}\r\n\r\n/**\r\n * Classify the variant type of a Base14 font.\r\n * \r\n * @param baseFont - Font name to check\r\n * @returns Variant type (normal, italic, bold, boldItalic)\r\n */\r\nexport function classifyBase14Variant(baseFont: string): Base14Variant {\r\n    const entry = BASE14_VARIANT_LOOKUP.get(baseFont.toLowerCase());\r\n    return entry ? entry.variant : \"normal\";\r\n}\r\n", "import type { PdfObjectRef, PdfDocument } from \"../primitives/pdf-document.js\";\r\nimport { parseTtfBuffer } from \"./ttf-lite.js\";\r\nimport type { FontFaceDef, FontConfig, TtfFontMetrics } from \"../../types/fonts.js\";\r\nimport { log } from \"../../logging/debug.js\";\r\nimport { normalizeFontWeight } from \"../../css/font-weight.js\";\r\nimport { detectFontFormat } from \"../../fonts/detector.js\";\r\nimport { reconstructTtf } from \"../../fonts/utils/ttf-reconstructor.js\";\r\nimport { computeWidths } from \"./widths.js\";\r\nimport { createToUnicodeCMapText } from \"./to-unicode.js\";\r\nimport { BASE_FONT_ALIASES, GENERIC_FAMILIES } from \"./font-config.js\";\r\n\r\nexport { computeWidths } from \"./widths.js\";\r\nexport { createToUnicodeCMapText } from \"./to-unicode.js\";\r\n\r\nconst TYPICAL_STEM_V = 80;\r\n\r\nexport interface EmbeddedFont {\r\n  readonly resourceName: string;\r\n  readonly ref: PdfObjectRef;\r\n  readonly baseFont: string;\r\n  readonly metrics: TtfFontMetrics;\r\n  readonly subset: Uint8Array;\r\n}\r\n\r\ninterface FontDescriptor {\r\n  readonly Type: \"/FontDescriptor\";\r\n  readonly FontName: string;\r\n  readonly Flags: number;\r\n  readonly FontBBox: readonly [number, number, number, number];\r\n  readonly ItalicAngle: number;\r\n  readonly Ascent: number;\r\n  readonly Descent: number;\r\n  readonly CapHeight: number;\r\n  readonly XHeight: number;\r\n  readonly StemV: number;\r\n  readonly FontFile2: PdfObjectRef;\r\n}\r\n\r\ninterface FontDictionary {\r\n  readonly Type: \"/Font\";\r\n  readonly Subtype: \"/Type0\";\r\n  readonly BaseFont: string;\r\n  readonly Encoding: \"/Identity-H\";\r\n  readonly DescendantFonts: readonly [PdfObjectRef];\r\n  readonly ToUnicode: PdfObjectRef;\r\n}\r\n\r\ninterface CIDFontDictionary {\r\n  readonly Type: \"/Font\";\r\n  readonly Subtype: \"/CIDFontType2\";\r\n  readonly BaseFont: string;\r\n  readonly CIDSystemInfo: {\r\n    readonly Registry: string; // emitted as literal strings \"(Adobe)\"\r\n    readonly Ordering: string; // emitted as literal strings \"(Identity)\"\r\n    readonly Supplement: 0;\r\n  };\r\n  readonly FontDescriptor: PdfObjectRef;\r\n  readonly DW?: number;\r\n  readonly W: readonly (number | readonly number[])[];\r\n  readonly CIDToGIDMap: PdfObjectRef | string;\r\n}\r\n\r\nexport class FontEmbedder {\r\n  private embeddedFonts = new Map<string, EmbeddedFont>();\r\n  private faceMetrics = new Map<string, TtfFontMetrics>();\r\n\r\n  constructor(private readonly config: FontConfig, private readonly doc: PdfDocument) { }\r\n\r\n  async initialize(): Promise<void> {\r\n    for (const face of this.config.fontFaceDefs) {\r\n      if (!face.data) {\r\n        log(\"font\", \"error\", `Missing data for font ${face.name}`);\r\n        continue;\r\n      }\r\n      try {\r\n        let fontData = new Uint8Array(face.data);\r\n        const format = detectFontFormat(fontData);\r\n        let ttfBuffer: ArrayBuffer;\r\n        if (format === \"woff\") {\r\n          const parsed = await import(\"../../fonts/woff/decoder.js\");\r\n          const decoded = parsed.decodeWoff(fontData);\r\n          ttfBuffer = reconstructTtf(decoded);\r\n          fontData = new Uint8Array(ttfBuffer);\r\n          (face as any).data = ttfBuffer;\r\n        } else if (format === \"woff2\") {\r\n          const { decodeWoff2 } = await import(\"../../fonts/woff2/decoder.js\");\r\n          const decoded = decodeWoff2(fontData);\r\n          // Copy into a fresh ArrayBuffer to avoid SharedArrayBuffer unions\r\n          const ttfCopy = decoded.ttfBuffer.slice();\r\n          ttfBuffer = ttfCopy.buffer;\r\n          fontData = new Uint8Array(ttfBuffer);\r\n          (face as any).data = ttfBuffer;\r\n        } else {\r\n          ttfBuffer = face.data!;\r\n        }\r\n\r\n        const metrics = parseTtfBuffer(ttfBuffer);\r\n        this.faceMetrics.set(face.name, metrics);\r\n      } catch (error) {\r\n        log(\"font\", \"error\", `Failed to load font ${face.name}`, { error: error instanceof Error ? error.message : String(error) });\r\n      }\r\n    }\r\n  }\r\n\r\n  ensureFont(familyStack: string[], fontWeight?: number, fontStyle?: string): EmbeddedFont | null {\r\n    const targetWeight = normalizeFontWeight(fontWeight);\r\n    const wantsItalic = isItalic(fontStyle);\r\n\r\n    for (const family of familyStack) {\r\n      const normalizedFamily = family.toLowerCase().trim();\r\n      const candidates = this.config.fontFaceDefs.filter((f) => {\r\n        return (f.family || \"\").toLowerCase().trim() === normalizedFamily;\r\n      });\r\n\r\n      if (candidates.length === 0) {\r\n        continue;\r\n      }\r\n\r\n      const face = pickFaceByWeight(candidates, targetWeight, wantsItalic);\r\n      if (!face) {\r\n        continue;\r\n      }\r\n\r\n      // Use normalized face name as key to avoid accidental mismatches due to spacing/case\r\n      const faceKey = (face.name || \"\").toLowerCase().trim();\r\n      const existing = this.embeddedFonts.get(face.name) ?? this.embeddedFonts.get(faceKey);\r\n      if (existing) return existing;\r\n\r\n      const embedded = this.embedFont(face);\r\n      if (embedded) {\r\n        // store with both canonical and normalized keys for resilient lookups\r\n        this.embeddedFonts.set(face.name, embedded);\r\n        this.embeddedFonts.set(faceKey, embedded);\r\n        return embedded;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  private embedFont(face: FontFaceDef): EmbeddedFont | null {\r\n    const metrics = this.faceMetrics.get(face.name);\r\n    if (!metrics) return null;\r\n    const unitsPerEm = metrics.metrics.unitsPerEm;\r\n    const scaleTo1000 = (v: number) => Math.round((v / unitsPerEm) * 1000);\r\n\r\n    let fontBBox: [number, number, number, number];\r\n    if (metrics.headBBox) {\r\n      const hb = metrics.headBBox;\r\n      fontBBox = [scaleTo1000(hb[0]), scaleTo1000(hb[1]), scaleTo1000(hb[2]), scaleTo1000(hb[3])];\r\n    } else {\r\n      // Fallback if headBBox is missing\r\n      fontBBox = [-1000, -1000, 1000, 1000];\r\n    }\r\n\r\n    // Register the font file stream\r\n    // We need the full font data here. In the initialize method we updated face.data\r\n    // but here we need to access it.\r\n    // Since we can't easily change the interface, we'll assume face.data is the source.\r\n    // If it was converted to TTF in initialize, face.data (casted) holds the TTF buffer.\r\n    const fullFontData = new Uint8Array(face.data!);\r\n    // FontFile2 streams require only /Length (PdfDocument adds it); avoid Type1-specific Length1 headers.\r\n    const fontFileRef = this.doc.registerStream(fullFontData, {});\r\n\r\n    const fontDescriptor: FontDescriptor = {\r\n      Type: \"/FontDescriptor\",\r\n      FontName: `/${face.name}`,\r\n      Flags: computePdfFlagsFromFace(face),\r\n      FontBBox: fontBBox,\r\n      ItalicAngle: face.style === \"italic\" ? -12 : 0,\r\n      Ascent: scaleTo1000(metrics.metrics.ascender),\r\n      Descent: scaleTo1000(metrics.metrics.descender),\r\n      CapHeight: scaleTo1000(metrics.metrics.capHeight),\r\n      XHeight: scaleTo1000(metrics.metrics.xHeight),\r\n      StemV: TYPICAL_STEM_V,\r\n      FontFile2: fontFileRef\r\n    };\r\n\r\n    const fontDescriptorRef = this.doc.register(fontDescriptor);\r\n\r\n    // Compute DW and compressed W\r\n    const { DW, W } = computeWidths(metrics);\r\n\r\n    // Create CID font dictionary (include DW)\r\n    // CID fonts must declare string-valued CIDSystemInfo entries per PDF spec.\r\n    const cidFontDict: CIDFontDictionary = {\r\n      Type: \"/Font\",\r\n      Subtype: \"/CIDFontType2\",\r\n      BaseFont: `/${face.name}`,\r\n      CIDSystemInfo: {\r\n        Registry: \"(Adobe)\",\r\n        Ordering: \"(Identity)\",\r\n        Supplement: 0\r\n      },\r\n      FontDescriptor: fontDescriptorRef,\r\n      DW,\r\n      W,\r\n      // Rely on built-in Identity CIDToGID mapping to keep font dictionaries simple/compatible.\r\n      CIDToGIDMap: \"/Identity\"\r\n    };\r\n\r\n    const cidFontRef = this.doc.register(cidFontDict);\r\n\r\n    // Create Unicode mapping (ToUnicode CMap)\r\n    const toUnicodeRef = this.createToUnicodeCMap(metrics);\r\n\r\n    // Create Type0 font dictionary\r\n    // Per PDF spec, Type0 BaseFont should include the CMap suffix (e.g. \"-Identity-H\")\r\n    // to make the composite font name unambiguous for parsers/renderers.\r\n    const type0Font: FontDictionary = {\r\n      Type: \"/Font\",\r\n      Subtype: \"/Type0\",\r\n      BaseFont: `/${face.name}-Identity-H`,\r\n      Encoding: \"/Identity-H\",\r\n      DescendantFonts: [cidFontRef],\r\n      ToUnicode: toUnicodeRef\r\n    };\r\n\r\n    const fontRef = this.doc.register(type0Font);\r\n\r\n    return {\r\n      resourceName: `F${this.embeddedFonts.size + 1}`,\r\n      ref: fontRef,\r\n      baseFont: face.name,\r\n      metrics,\r\n      subset: fullFontData\r\n    };\r\n  }\r\n\r\n\r\n\r\n  private createToUnicodeCMap(metrics: TtfFontMetrics, _uniqueUnicodes: number[] = []): PdfObjectRef {\r\n    // Build inverse mapping gid -> unicode (pick first unicode when multiple map to same gid)\r\n    const unicodeMap = metrics.cmap[\"unicodeMap\"] as Map<number, number>;\r\n    log(\"font\", \"debug\", \"createToUnicodeCMap - unicodeMap size\", { size: unicodeMap.size });\r\n\r\n    // Sample first few entries for debugging\r\n    const samples: Array<{ unicode: number, char: string, gid: number }> = [];\r\n    let count = 0;\r\n    for (const [unicode, gid] of unicodeMap.entries()) {\r\n      if (count < 10) {\r\n        samples.push({ unicode, char: String.fromCodePoint(unicode), gid });\r\n      }\r\n      count++;\r\n    }\r\n    log(\"font\", \"debug\", \"createToUnicodeCMap - sample entries\", { samples });\r\n\r\n    const gidToUni = new Map<number, number>();\r\n    for (const [unicode, gid] of unicodeMap.entries()) {\r\n      if (!gidToUni.has(gid)) gidToUni.set(gid, unicode);\r\n    }\r\n\r\n    // Debug: log sample gid->unicode mappings\r\n    const gidSamples: Array<{ gid: number, unicode: number, char: string }> = [];\r\n    let gidCount = 0;\r\n    for (const [gid, unicode] of gidToUni.entries()) {\r\n      if (gidCount < 20) {\r\n        gidSamples.push({ gid, unicode, char: String.fromCodePoint(unicode) });\r\n      }\r\n      gidCount++;\r\n    }\r\n    log(\"font\", \"debug\", \"createToUnicodeCMap - gid->unicode sample\", { samples: gidSamples });\r\n\r\n    const entries = Array.from(gidToUni.entries())\r\n      .map(([gid, unicode]) => ({ gid, unicode }))\r\n      .sort((a, b) => a.gid - b.gid);\r\n\r\n    const cmapText = createToUnicodeCMapText(entries);\r\n    return this.doc.registerStream(new TextEncoder().encode(cmapText), {});\r\n  }\r\n\r\n\r\n  /**\r\n   * Return parsed TTF metrics for a loaded face by name or family, or null if not available.\r\n   * Exposed to allow rendering code to access outlines/metrics for embedding masks.\r\n   * \r\n   * The lookup tries:\r\n   * 1. Exact match by face name (e.g., \"Tinos-Bold\")\r\n   * 2. Match by family name (e.g., \"Tinos\") with weight/style matching\r\n   * 3. Case-insensitive match by family name\r\n   * 4. If input contains comma-separated font stack (e.g., \"Tinos, serif\"), tries each font\r\n   * 5. Uses BASE_FONT_ALIASES to resolve CSS font names to embedded fonts (e.g., \"Times New Roman\" \u2192 \"Tinos\")\r\n   * \r\n   * @param faceName - Font family name or font stack\r\n   * @param fontWeight - Optional font weight (100-900), defaults to 400\r\n   * @param fontStyle - Optional font style ('normal' | 'italic' | 'oblique'), defaults to 'normal'\r\n   */\r\n  public getMetrics(faceName: string, fontWeight: number = 400, fontStyle: string = \"normal\"): TtfFontMetrics | null {\r\n    // Try exact match first\r\n    const exact = this.faceMetrics.get(faceName);\r\n    if (exact) return exact;\r\n\r\n    const wantsItalic = fontStyle === \"italic\" || fontStyle === \"oblique\";\r\n\r\n    // Handle font-family stacks like \"'Times New Roman', Times, serif\"\r\n    const fontStack = faceName.split(\",\").map(f => f.trim().replace(/^[\"']|[\"']$/g, \"\"));\r\n    \r\n    for (const fontName of fontStack) {\r\n      const normalizedQuery = fontName.toLowerCase().trim();\r\n      \r\n      // Try exact match with this font name\r\n      const exactMatch = this.faceMetrics.get(fontName);\r\n      if (exactMatch) return exactMatch;\r\n      \r\n      // Check if this is an alias that maps to an embedded font\r\n      const aliasedFont = BASE_FONT_ALIASES.get(normalizedQuery) || GENERIC_FAMILIES.get(normalizedQuery);\r\n      const targetFamily = aliasedFont ? aliasedFont.toLowerCase() : normalizedQuery;\r\n      \r\n      // Collect all faces matching the family\r\n      const matchingFaces: FontFaceDef[] = [];\r\n      for (const face of this.config.fontFaceDefs) {\r\n        const faceFamily = (face.family || \"\").toLowerCase().trim();\r\n        if (faceFamily === targetFamily) {\r\n          matchingFaces.push(face);\r\n        }\r\n      }\r\n      \r\n      // Pick the best face by weight and style\r\n      if (matchingFaces.length > 0) {\r\n        const bestFace = pickFaceByWeight(matchingFaces, fontWeight, wantsItalic);\r\n        if (bestFace) {\r\n          const metrics = this.faceMetrics.get(bestFace.name);\r\n          if (metrics) return metrics;\r\n        }\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction pickFaceByWeight(faces: FontFaceDef[], requestedWeight: number, wantsItalic: boolean): FontFaceDef | null {\r\n  if (faces.length === 0) {\r\n    return null;\r\n  }\r\n  // Prefer faces that match the requested style; if none do, fall back to any style.\r\n  const styleFiltered = faces.filter((face) => isItalic(face.style) === wantsItalic);\r\n  const pool = styleFiltered.length > 0 ? styleFiltered : faces;\r\n\r\n  let bestFace = pool[0];\r\n  let bestDiff = Math.abs(normalizeFontWeight(bestFace.weight) - requestedWeight);\r\n  for (const face of pool) {\r\n    const normalized = normalizeFontWeight(face.weight);\r\n    const diff = Math.abs(normalized - requestedWeight);\r\n    if (diff < bestDiff) {\r\n      bestDiff = diff;\r\n      bestFace = face;\r\n    }\r\n  }\r\n  return bestFace;\r\n}\r\n\r\nfunction isItalic(style: string | undefined): boolean {\r\n  if (!style) return false;\r\n  const s = style.toLowerCase();\r\n  return s === \"italic\" || s === \"oblique\";\r\n}\r\n\r\n// Compute PDF Flags based on font family/style heuristics.\r\n// See AGENTS.md notes for bits: Symbolic vs Nonsymbolic, Serif, Italic, etc.\r\nfunction computePdfFlagsFromFace(face: FontFaceDef): number {\r\n  let flags = 0;\r\n  const family = (face.family || \"\").toLowerCase().trim();\r\n  const name = (face.name || \"\").toLowerCase().trim();\r\n  const style = (face.style || \"\").toLowerCase();\r\n\r\n  const isItalic = /italic|oblique/i.test(style);\r\n  const isSerif = /serif/i.test(family) || /serif/i.test(name);\r\n  const isSymbol = /symbol|dingbat|dingbats|zapfdingbats/i.test(family) || /symbol|dingbat|dingbats/i.test(name);\r\n\r\n  if (isSymbol) flags |= 1 << 2; // Symbolic\r\n  else flags |= 1 << 5; // Nonsymbolic\r\n\r\n  if (isSerif) flags |= 1 << 1; // Serif\r\n  if (isItalic) flags |= 1 << 6; // Italic\r\n\r\n  return flags;\r\n}\r\n\r\nexport async function getEmbeddedFont(name: \"NotoSans-Regular\" | \"DejaVuSans\", doc: PdfDocument, config: FontConfig): Promise<EmbeddedFont | null> {\r\n  const embedder = new FontEmbedder(config, doc);\r\n  const face = config.fontFaceDefs.find(f => f.name === name);\r\n  if (!face) return null;\r\n\r\n  const existing = embedder['embeddedFonts'].get(name);\r\n  if (existing) return existing;\r\n\r\n  // @ts-ignore: TypeScript complains about private method, but this is intentional for testing\r\n  const embedded = embedder['embedFont'](face);\r\n  if (embedded) {\r\n    embedder['embeddedFonts'].set(name, embedded);\r\n    return embedded;\r\n  }\r\n  return null;\r\n}\r\n", "import { LayoutNode } from \"../../dom/node.js\";\r\nimport { Display } from \"../../css/enums.js\";\r\nimport { resolvedLineHeight } from \"../../css/style.js\";\r\nimport { clampMinMax, resolveLength } from \"../../css/length.js\";\r\nimport type { LayoutContext } from \"../pipeline/strategy.js\";\r\nimport { estimateLineWidth, measureTextWithGlyphs } from \"../utils/text-metrics.js\";\r\nimport { FontEmbedder } from \"../../pdf/font/embedder.js\";\r\nimport type { InlineMetrics } from \"./types.js\";\r\nimport { FloatContext } from \"../context/float-context.js\";\r\n\r\nexport type LayoutCallback = (node: LayoutNode, containerWidth: number, context: LayoutContext) => { contentWidth: number; contentHeight: number } | null;\r\n\r\nexport function measureSegment(text: string, style: LayoutNode[\"style\"], fontEmbedder: FontEmbedder | null): number {\r\n    const fontWeight = typeof style.fontWeight === \"number\" ? style.fontWeight : 400;\r\n    const fontStyle = style.fontStyle ?? \"normal\";\r\n    const metrics = fontEmbedder?.getMetrics(style.fontFamily ?? \"\", fontWeight, fontStyle);\r\n    const glyphWidth = measureTextWithGlyphs(text, style, metrics ?? null);\r\n    return glyphWidth ?? estimateLineWidth(text, style);\r\n}\r\n\r\nexport function countSpaces(value: string): number {\r\n    let count = 0;\r\n    for (const char of value) {\r\n        if (char === \" \") {\r\n            count += 1;\r\n        }\r\n    }\r\n    return count;\r\n}\r\n\r\nexport function measureInlineNode(node: LayoutNode, containerWidth: number, context: LayoutContext, layoutCallback: LayoutCallback): InlineMetrics {\r\n    if (node.style.display === Display.InlineBlock || node.style.display === Display.InlineFlex || node.style.display === Display.InlineGrid || node.style.display === Display.InlineTable) {\r\n        const savedX = node.box.x;\r\n        const savedY = node.box.y;\r\n        context.layoutChild(node);\r\n        node.box.x = savedX;\r\n        node.box.y = savedY;\r\n    }\r\n\r\n    const marginLeft = resolveLength(node.style.marginLeft, containerWidth, { auto: \"zero\" });\r\n    const marginRight = resolveLength(node.style.marginRight, containerWidth, { auto: \"zero\" });\r\n    const marginTop = resolveLength(node.style.marginTop, containerWidth, { auto: \"zero\" });\r\n    const marginBottom = resolveLength(node.style.marginBottom, containerWidth, { auto: \"zero\" });\r\n\r\n    const inlineChildrenResult = layoutCallback(node, containerWidth, context);\r\n\r\n    let contentWidth = node.box.contentWidth;\r\n    let contentHeight = node.box.contentHeight;\r\n\r\n    if (inlineChildrenResult) {\r\n        contentWidth = Math.max(contentWidth, inlineChildrenResult.contentWidth);\r\n        contentHeight = Math.max(contentHeight, inlineChildrenResult.contentHeight);\r\n    }\r\n\r\n    if (node.style.display === Display.InlineBlock && node.style.width === \"auto\") {\r\n        const intrinsicWidth = node.box.scrollWidth;\r\n        if (Number.isFinite(intrinsicWidth) && intrinsicWidth > 0 && intrinsicWidth < contentWidth) {\r\n            const minWidth = node.style.minWidth !== undefined ? resolveLength(node.style.minWidth, containerWidth, { auto: \"zero\" }) : undefined;\r\n            const maxWidth = node.style.maxWidth !== undefined ? resolveLength(node.style.maxWidth, containerWidth, { auto: \"reference\" }) : undefined;\r\n            const clamped = clampMinMax(intrinsicWidth, minWidth, maxWidth);\r\n            contentWidth = Math.min(clamped, contentWidth);\r\n        }\r\n    }\r\n\r\n    if (contentWidth === 0 && !node.textContent) {\r\n        if (typeof node.style.width === \"number\") {\r\n            contentWidth = node.style.width;\r\n        } else if (node.style.width !== \"auto\") {\r\n            contentWidth = resolveLength(node.style.width, containerWidth, { auto: \"zero\" });\r\n        } else if (node.intrinsicInlineSize !== undefined) {\r\n            contentWidth = node.intrinsicInlineSize;\r\n        } else {\r\n            contentWidth = resolvedLineHeight(node.style);\r\n        }\r\n    }\r\n\r\n    if (contentHeight === 0 && !node.textContent) {\r\n        if (node.style.height !== \"auto\") {\r\n            contentHeight = resolveLength(node.style.height, containerWidth, { auto: \"zero\" });\r\n        } else if (node.intrinsicBlockSize !== undefined) {\r\n            contentHeight = node.intrinsicBlockSize;\r\n        } else {\r\n            contentHeight = resolvedLineHeight(node.style);\r\n        }\r\n    }\r\n\r\n    const paddingLeft = resolveLength(node.style.paddingLeft, containerWidth, { auto: \"zero\" });\r\n    const paddingRight = resolveLength(node.style.paddingRight, containerWidth, { auto: \"zero\" });\r\n    const paddingTop = resolveLength(node.style.paddingTop, containerWidth, { auto: \"zero\" });\r\n    const paddingBottom = resolveLength(node.style.paddingBottom, containerWidth, { auto: \"zero\" });\r\n\r\n    const borderLeft = resolveLength(node.style.borderLeft, containerWidth, { auto: \"zero\" });\r\n    const borderRight = resolveLength(node.style.borderRight, containerWidth, { auto: \"zero\" });\r\n    const borderTop = resolveLength(node.style.borderTop, containerWidth, { auto: \"zero\" });\r\n    const borderBottom = resolveLength(node.style.borderBottom, containerWidth, { auto: \"zero\" });\r\n\r\n    node.box.contentWidth = contentWidth;\r\n    node.box.contentHeight = contentHeight;\r\n    node.box.borderBoxWidth = contentWidth + paddingLeft + paddingRight + borderLeft + borderRight;\r\n    node.box.borderBoxHeight = contentHeight + paddingTop + paddingBottom + borderTop + borderBottom;\r\n    node.box.marginBoxWidth = node.box.borderBoxWidth + marginLeft + marginRight;\r\n    node.box.marginBoxHeight = node.box.borderBoxHeight + marginTop + marginBottom;\r\n    node.box.scrollWidth = Math.max(node.box.scrollWidth, node.box.contentWidth);\r\n    node.box.scrollHeight = Math.max(node.box.scrollHeight, node.box.contentHeight);\r\n\r\n    return {\r\n        node,\r\n        contentWidth,\r\n        contentHeight,\r\n        lineOffset: 0,\r\n        marginLeft,\r\n        marginRight,\r\n        marginTop,\r\n        marginBottom,\r\n        paddingLeft,\r\n        paddingRight,\r\n        paddingTop,\r\n        paddingBottom,\r\n        borderLeft,\r\n        borderRight,\r\n        borderTop,\r\n        borderBottom,\r\n        outerWidth: node.box.marginBoxWidth,\r\n        outerHeight: node.box.marginBoxHeight,\r\n    };\r\n}\r\n\r\nfunction inlineExtentWithinContainer(node: LayoutNode, referenceWidth: number): { start: number; end: number } {\r\n    const marginLeft = resolveLength(node.style.marginLeft, referenceWidth, { auto: \"zero\" });\r\n    const marginRight = resolveLength(node.style.marginRight, referenceWidth, { auto: \"zero\" });\r\n    const paddingLeft = resolveLength(node.style.paddingLeft, referenceWidth, { auto: \"zero\" });\r\n    const paddingRight = resolveLength(node.style.paddingRight, referenceWidth, { auto: \"zero\" });\r\n    const borderLeft = resolveLength(node.style.borderLeft, referenceWidth, { auto: \"zero\" });\r\n    const borderRight = resolveLength(node.style.borderRight, referenceWidth, { auto: \"zero\" });\r\n\r\n    const marginStart = node.box.x - paddingLeft - borderLeft - marginLeft;\r\n    const width =\r\n        node.box.contentWidth + paddingLeft + paddingRight + borderLeft + borderRight + marginLeft + marginRight;\r\n\r\n    return {\r\n        start: marginStart,\r\n        end: marginStart + width,\r\n    };\r\n}\r\n", "import { LayoutNode } from \"../../dom/node.js\";\r\nimport { Display, FloatMode, WhiteSpace } from \"../../css/enums.js\";\r\nimport { resolvedLineHeight } from \"../../css/style.js\";\r\nimport { applyTextTransform } from \"../../text/text-transform.js\";\r\nimport type { LayoutContext } from \"../pipeline/strategy.js\";\r\nimport { FontEmbedder } from \"../../pdf/font/embedder.js\";\r\nimport type { InlineFragment, LayoutItem } from \"./types.js\";\r\nimport { measureInlineNode, measureSegment, countSpaces, type LayoutCallback } from \"./measurement.js\";\r\nimport { estimateLineWidth } from \"../utils/text-metrics.js\";\r\n\r\nexport function collectInlineFragments(\r\n    nodes: LayoutNode[],\r\n    containerWidth: number,\r\n    context: LayoutContext,\r\n    layoutCallback: LayoutCallback,\r\n): InlineFragment[] {\r\n    const fragments: InlineFragment[] = [];\r\n\r\n    const recurse = (node: LayoutNode) => {\r\n        if (node.style.display === Display.None) {\r\n            return;\r\n        }\r\n        if (node.style.float !== FloatMode.None) {\r\n            return;\r\n        }\r\n\r\n        if (isAtomicInline(node.style.display)) {\r\n            const metrics = measureInlineNode(node, containerWidth, context, layoutCallback);\r\n            fragments.push({ kind: \"box\", metrics });\r\n            return;\r\n        }\r\n\r\n        if (node.textContent && node.style.display === Display.Inline) {\r\n            fragments.push({\r\n                kind: \"text\",\r\n                node,\r\n                style: node.style,\r\n                text: node.textContent,\r\n                preserveLeading: !!node.customData?.preserveLeadingSpace,\r\n                preserveTrailing: !!node.customData?.preserveTrailingSpace,\r\n            });\r\n            return;\r\n        }\r\n\r\n        for (const child of node.children) {\r\n            if (!isInlineDisplay(child.style.display)) {\r\n                continue;\r\n            }\r\n            recurse(child);\r\n        }\r\n    };\r\n\r\n    for (const node of nodes) {\r\n        recurse(node);\r\n    }\r\n\r\n    return fragments;\r\n}\r\n\r\nexport function tokenizeFragments(\r\n    fragments: InlineFragment[],\r\n    fontEmbedder: FontEmbedder | null,\r\n): LayoutItem[] {\r\n    const items: LayoutItem[] = [];\r\n    for (const fragment of fragments) {\r\n        if (fragment.kind === \"box\") {\r\n            items.push({\r\n                kind: \"box\",\r\n                width: fragment.metrics.outerWidth,\r\n                height: fragment.metrics.outerHeight,\r\n                lineHeight: fragment.metrics.outerHeight,\r\n                metrics: fragment.metrics,\r\n            });\r\n            continue;\r\n        }\r\n\r\n        const style = fragment.style;\r\n        const raw = fragment.text ?? \"\";\r\n        if (!raw) {\r\n            continue;\r\n        }\r\n        const effectiveText = applyTextTransform(raw, style.textTransform);\r\n        const lineHeight = resolvedLineHeight(style);\r\n        const segments = segmentTextWithWhitespace(effectiveText, style.whiteSpace);\r\n        for (const segment of segments) {\r\n            if (segment.kind === \"newline\") {\r\n                items.push({\r\n                    kind: \"newline\",\r\n                    width: 0,\r\n                    height: lineHeight,\r\n                    lineHeight,\r\n                });\r\n                continue;\r\n            }\r\n            const width = measureSegment(segment.text, style, fontEmbedder);\r\n            items.push({\r\n                kind: segment.kind,\r\n                width,\r\n                height: lineHeight,\r\n                lineHeight,\r\n                node: fragment.node,\r\n                style,\r\n                text: segment.text,\r\n                spaceCount: segment.kind === \"space\" ? countSpaces(segment.text) : 0,\r\n            });\r\n        }\r\n    }\r\n    return items;\r\n}\r\n\r\nexport function segmentTextWithWhitespace(\r\n    text: string,\r\n    mode: WhiteSpace,\r\n): { kind: \"word\" | \"space\" | \"newline\"; text: string }[] {\r\n    const segments: { kind: \"word\" | \"space\" | \"newline\"; text: string }[] = [];\r\n    const regex = /(\\n)|(\\s+)|([^\\s]+)/g;\r\n    let match: RegExpExecArray | null;\r\n    while ((match = regex.exec(text)) !== null) {\r\n        if (match[1]) {\r\n            if (mode === WhiteSpace.Pre || mode === WhiteSpace.PreWrap || mode === WhiteSpace.PreLine) {\r\n                segments.push({ kind: \"newline\", text: \"\\n\" });\r\n            } else {\r\n                segments.push({ kind: \"space\", text: \" \" });\r\n            }\r\n        } else if (match[2]) {\r\n            segments.push({ kind: \"space\", text: match[2] });\r\n        } else if (match[3]) {\r\n            segments.push({ kind: \"word\", text: match[3] });\r\n        }\r\n    }\r\n    return segments;\r\n}\r\n\r\nexport function splitWordItemToken(item: LayoutItem, availableWidth: number): [LayoutItem | null, LayoutItem | null] {\r\n    if (item.kind !== \"word\" || !item.text || !item.style) {\r\n        return [item, null];\r\n    }\r\n\r\n    let buffer = \"\";\r\n    let bufferWidth = 0;\r\n    for (const char of Array.from(item.text)) {\r\n        const candidate = buffer + char;\r\n        const candidateWidth = estimateLineWidth(candidate, item.style);\r\n        if (buffer && candidateWidth > availableWidth) {\r\n            break;\r\n        }\r\n        buffer = candidate;\r\n        bufferWidth = candidateWidth;\r\n    }\r\n\r\n    if (!buffer) {\r\n        return [item, null];\r\n    }\r\n\r\n    const head: LayoutItem = {\r\n        ...item,\r\n        text: buffer,\r\n        width: bufferWidth,\r\n    };\r\n    const tailText = item.text.slice(buffer.length);\r\n    if (!tailText) {\r\n        return [head, null];\r\n    }\r\n    const tail: LayoutItem = {\r\n        ...item,\r\n        text: tailText,\r\n        width: estimateLineWidth(tailText, item.style),\r\n    };\r\n    return [head, tail];\r\n}\r\n\r\nfunction isInlineDisplay(display: Display): boolean {\r\n    switch (display) {\r\n        case Display.Inline:\r\n        case Display.InlineBlock:\r\n        case Display.InlineFlex:\r\n        case Display.InlineGrid:\r\n        case Display.InlineTable:\r\n            return true;\r\n        default:\r\n            return false;\r\n    }\r\n}\r\n\r\nfunction isAtomicInline(display: Display): boolean {\r\n    switch (display) {\r\n        case Display.InlineBlock:\r\n        case Display.InlineFlex:\r\n        case Display.InlineGrid:\r\n        case Display.InlineTable:\r\n            return true;\r\n        default:\r\n            return false;\r\n    }\r\n}\r\n", "import { LayoutNode } from \"../../dom/node.js\";\r\nimport { Display, FloatMode } from \"../../css/enums.js\";\r\nimport { resolveLength } from \"../../css/length.js\";\r\n\r\n/**\r\n * Resolves the text-align property by walking up the tree to find the first valid value.\r\n * Returns undefined if no valid value is found.\r\n */\r\nexport function resolveInlineTextAlign(node: LayoutNode): string | undefined {\r\n    let current: LayoutNode | null = node;\r\n    while (current) {\r\n        const value = current.style.textAlign;\r\n        if (value) {\r\n            const normalized = value.toLowerCase();\r\n            if (normalized !== \"start\" && normalized !== \"auto\") {\r\n                return normalized;\r\n            }\r\n        }\r\n        current = current.parent;\r\n    }\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * Checks if a display mode is an inline-type display.\r\n */\r\nexport function isInlineDisplay(display: Display): boolean {\r\n    switch (display) {\r\n        case Display.Inline:\r\n        case Display.InlineBlock:\r\n        case Display.InlineFlex:\r\n        case Display.InlineGrid:\r\n        case Display.InlineTable:\r\n            return true;\r\n        default:\r\n            return false;\r\n    }\r\n}\r\n\r\n/**\r\n * Determines if a node should layout its inline children.\r\n */\r\nexport function shouldLayoutInlineChildren(node: LayoutNode): boolean {\r\n    if (node.children.length === 0) {\r\n        return false;\r\n    }\r\n    if (node.style.display !== Display.Inline) {\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\n\r\n/**\r\n * Collects child nodes that participate in inline layout.\r\n * Filters out nodes with display:none, floated nodes, and non-inline display modes.\r\n */\r\nexport function collectInlineParticipants(node: LayoutNode): LayoutNode[] {\r\n    const participants: LayoutNode[] = [];\r\n    for (const child of node.children) {\r\n        if (child.style.display === Display.None) {\r\n            continue;\r\n        }\r\n        if (child.style.float !== FloatMode.None) {\r\n            continue;\r\n        }\r\n        if (!isInlineDisplay(child.style.display)) {\r\n            continue;\r\n        }\r\n        participants.push(child);\r\n    }\r\n    return participants;\r\n}\r\n\r\n/**\r\n * Calculates the inline extent (start and end positions) of a node within its container.\r\n * Includes margins, borders, and padding in the calculation.\r\n */\r\nexport function inlineExtentWithinContainer(node: LayoutNode, referenceWidth: number): { start: number; end: number } {\r\n    const marginLeft = resolveLength(node.style.marginLeft, referenceWidth, { auto: \"zero\" });\r\n    const marginRight = resolveLength(node.style.marginRight, referenceWidth, { auto: \"zero\" });\r\n    const paddingLeft = resolveLength(node.style.paddingLeft, referenceWidth, { auto: \"zero\" });\r\n    const paddingRight = resolveLength(node.style.paddingRight, referenceWidth, { auto: \"zero\" });\r\n    const borderLeft = resolveLength(node.style.borderLeft, referenceWidth, { auto: \"zero\" });\r\n    const borderRight = resolveLength(node.style.borderRight, referenceWidth, { auto: \"zero\" });\r\n\r\n    const marginStart = node.box.x - paddingLeft - borderLeft - marginLeft;\r\n    const width =\r\n        node.box.contentWidth + paddingLeft + paddingRight + borderLeft + borderRight + marginLeft + marginRight;\r\n\r\n    return {\r\n        start: marginStart,\r\n        end: marginStart + width,\r\n    };\r\n}\r\n", "/**\r\n * Strategy pattern for text alignment calculations.\r\n * Each strategy determines how to offset content within available space.\r\n */\r\nexport interface TextAlignmentStrategy {\r\n    /**\r\n     * Calculate the horizontal offset for aligning content.\r\n     * @param lineWidth The actual width of content on the line\r\n     * @param availableWidth The total available width for the line\r\n     * @returns The offset (in pixels) to apply to the line start position\r\n     */\r\n    calculateOffset(lineWidth: number, availableWidth: number): number;\r\n}\r\n\r\n/**\r\n * Left alignment strategy - content starts at the beginning\r\n */\r\nexport class LeftAlignment implements TextAlignmentStrategy {\r\n    calculateOffset(): number {\r\n        return 0;\r\n    }\r\n}\r\n\r\n/**\r\n * Center alignment strategy - centers content within available space\r\n */\r\nexport class CenterAlignment implements TextAlignmentStrategy {\r\n    calculateOffset(lineWidth: number, availableWidth: number): number {\r\n        const slack = Math.max(availableWidth - lineWidth, 0);\r\n        return slack / 2;\r\n    }\r\n}\r\n\r\n/**\r\n * Right/End alignment strategy - content ends at the end of available space\r\n */\r\nexport class RightAlignment implements TextAlignmentStrategy {\r\n    calculateOffset(lineWidth: number, availableWidth: number): number {\r\n        const slack = Math.max(availableWidth - lineWidth, 0);\r\n        return slack;\r\n    }\r\n}\r\n\r\n/**\r\n * Justify alignment strategy - same as left for now (full justification handled separately via space adjustment)\r\n */\r\nexport class JustifyAlignment implements TextAlignmentStrategy {\r\n    calculateOffset(): number {\r\n        return 0;\r\n    }\r\n}\r\n\r\n/**\r\n * Factory function to get the appropriate alignment strategy based on text-align value.\r\n * @param textAlign The CSS text-align value (normalized)\r\n * @returns The corresponding alignment strategy\r\n */\r\nexport function getAlignmentStrategy(textAlign?: string): TextAlignmentStrategy {\r\n    switch (textAlign) {\r\n        case \"center\":\r\n            return new CenterAlignment();\r\n        case \"right\":\r\n        case \"end\":\r\n            return new RightAlignment();\r\n        case \"justify\":\r\n            return new JustifyAlignment();\r\n        default:\r\n            return new LeftAlignment();\r\n    }\r\n}\r\n", "import { LayoutNode, type InlineRun } from \"../../dom/node.js\";\r\nimport { resolvedLineHeight } from \"../../css/style.js\";\r\nimport { isInlineDisplay } from \"./inline-utils.js\";\r\n\r\n/**\r\n * Represents a bounding rectangle with min/max coordinates\r\n */\r\ninterface BoundingRect {\r\n    minX: number;\r\n    minY: number;\r\n    maxX: number;\r\n    maxY: number;\r\n}\r\n\r\n/**\r\n * Responsible for computing and propagating bounding boxes for inline nodes.\r\n * Handles both the initial box calculation from runs and the propagation to ancestors.\r\n */\r\nexport class BoundingBoxCalculator {\r\n    private boundingBoxes = new Map<LayoutNode, BoundingRect>();\r\n\r\n    /**\r\n     * Compute per-node box sizes from their inline runs.\r\n     * Assigns box dimensions based on the runs' position and sizes.\r\n     */\r\n    computeNodeBoxes(nodeRuns: Map<LayoutNode, InlineRun[]>): void {\r\n        for (const [node, runs] of nodeRuns.entries()) {\r\n            node.inlineRuns = runs;\r\n            node.lineBoxes = undefined;\r\n\r\n            const lineCount = runs.reduce((max, run) => Math.max(max, run.lineIndex + 1), 0);\r\n            const lh = resolvedLineHeight(node.style);\r\n            node.box.contentHeight = lineCount * lh;\r\n\r\n            // Calculate actual content width by finding the extent of all runs\r\n            // relative to the node's box.x position\r\n            if (runs.length > 0) {\r\n                // Find the actual extent of all runs from their positions and widths\r\n                // Initialize with the first run's values to avoid Infinity edge cases\r\n                const firstRun = runs[0];\r\n                let minX = firstRun.startX;\r\n                let maxX = firstRun.startX + firstRun.width;\r\n                for (let i = 1; i < runs.length; i++) {\r\n                    const run = runs[i];\r\n                    minX = Math.min(minX, run.startX);\r\n                    maxX = Math.max(maxX, run.startX + run.width);\r\n                }\r\n                // The content width is the span from minX to maxX\r\n                // Since node.box.x is set to minX in run-placer, the content width is maxX - minX\r\n                const actualWidth = maxX - minX;\r\n                node.box.contentWidth = actualWidth;\r\n            } else {\r\n                node.box.contentWidth = 0;\r\n            }\r\n\r\n            node.box.borderBoxWidth = node.box.contentWidth;\r\n            node.box.borderBoxHeight = node.box.contentHeight;\r\n            node.box.marginBoxWidth = node.box.borderBoxWidth;\r\n            node.box.marginBoxHeight = node.box.borderBoxHeight;\r\n            node.box.scrollWidth = Math.max(node.box.scrollWidth, node.box.contentWidth);\r\n            node.box.scrollHeight = Math.max(node.box.scrollHeight, node.box.contentHeight);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Propagate bounding boxes from text nodes to their inline ancestors.\r\n     * This ensures that container nodes (like spans) have a bounding box that encompasses their content,\r\n     * even if they didn't generate box items themselves (e.g. no padding/border).\r\n     */\r\n    propagateBoundingBoxes(nodeRuns: Map<LayoutNode, InlineRun[]>, container: LayoutNode): void {\r\n        // Collect bounding boxes from all nodes with runs\r\n        for (const [node] of nodeRuns.entries()) {\r\n            const rect: BoundingRect = {\r\n                minX: node.box.x,\r\n                minY: node.box.y,\r\n                maxX: node.box.x + node.box.contentWidth,\r\n                maxY: node.box.y + node.box.contentHeight,\r\n            };\r\n\r\n            // Propagate upwards to inline ancestors\r\n            let curr = node.parent;\r\n            while (curr && curr !== container && isInlineDisplay(curr.style.display)) {\r\n                this.updateBox(curr, rect);\r\n                curr = curr.parent;\r\n            }\r\n        }\r\n\r\n        // Apply computed bounding boxes back to the nodes\r\n        for (const [node, rect] of this.boundingBoxes.entries()) {\r\n            node.box.x = rect.minX;\r\n            node.box.y = rect.minY;\r\n            node.box.contentWidth = rect.maxX - rect.minX;\r\n            node.box.contentHeight = rect.maxY - rect.minY;\r\n            node.box.borderBoxWidth = Math.max(node.box.borderBoxWidth, node.box.contentWidth);\r\n            node.box.borderBoxHeight = Math.max(node.box.borderBoxHeight, node.box.contentHeight);\r\n            node.box.marginBoxWidth = Math.max(node.box.marginBoxWidth, node.box.borderBoxWidth);\r\n            node.box.marginBoxHeight = Math.max(node.box.marginBoxHeight, node.box.borderBoxHeight);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update or create a bounding box for a node by incorporating a new rectangle.\r\n     * Expands the existing bounding box to include the new rect.\r\n     */\r\n    private updateBox(node: LayoutNode, rect: BoundingRect): void {\r\n        let current = this.boundingBoxes.get(node);\r\n        if (!current) {\r\n            // Seed with existing box if it appears valid (non-zero size), otherwise start with the new rect.\r\n            if (node.box.contentWidth > 0 || node.box.contentHeight > 0) {\r\n                current = {\r\n                    minX: node.box.x,\r\n                    minY: node.box.y,\r\n                    maxX: node.box.x + node.box.contentWidth,\r\n                    maxY: node.box.y + node.box.contentHeight,\r\n                };\r\n                // Union with the new rect\r\n                current.minX = Math.min(current.minX, rect.minX);\r\n                current.minY = Math.min(current.minY, rect.minY);\r\n                current.maxX = Math.max(current.maxX, rect.maxX);\r\n                current.maxY = Math.max(current.maxY, rect.maxY);\r\n            } else {\r\n                current = { ...rect };\r\n            }\r\n            this.boundingBoxes.set(node, current);\r\n        } else {\r\n            current.minX = Math.min(current.minX, rect.minX);\r\n            current.minY = Math.min(current.minY, rect.minY);\r\n            current.maxX = Math.max(current.maxX, rect.maxX);\r\n            current.maxY = Math.max(current.maxY, rect.maxY);\r\n        }\r\n    }\r\n}\r\n", "import type { FontMetrics } from \"../../fonts/types.js\";\r\n\r\n/**\r\n * Default ascent ratio for fonts when metrics are unavailable.\r\n * Most fonts have an ascent around 75-80% of the font size.\r\n */\r\nconst DEFAULT_ASCENT_RATIO = 0.75;\r\n\r\n/**\r\n * Calculate the baseline position for a line of text.\r\n * \r\n * The baseline is the invisible line on which text sits. In proper typography,\r\n * the baseline should be positioned based on the font's ascent (the height\r\n * above the baseline where ascenders like 'h', 'b' extend).\r\n * \r\n * When line-height is larger than font-size, we need to account for \"half-leading\"\r\n * (the extra space distributed equally above and below the text).\r\n * \r\n * @param lineTop - The Y coordinate of the top of the line box\r\n * @param fontSize - The font size in pixels\r\n * @param lineHeight - The line height in pixels\r\n * @param fontMetrics - Optional font metrics for precise calculations\r\n * @returns The Y coordinate of the baseline\r\n */\r\nexport function calculateBaseline(\r\n    lineTop: number,\r\n    fontSize: number,\r\n    lineHeight: number,\r\n    fontMetrics?: FontMetrics | null\r\n): number {\r\n    let ascent: number;\r\n\r\n    if (fontMetrics) {\r\n        // Use actual font metrics when available\r\n        const { metrics } = fontMetrics;\r\n        const unitsPerEm = metrics.unitsPerEm;\r\n        const ascentUnits = metrics.ascender;\r\n\r\n        // Convert font units to pixels\r\n        ascent = (ascentUnits / unitsPerEm) * fontSize;\r\n    } else {\r\n        // Use heuristic when font metrics unavailable\r\n        ascent = fontSize * DEFAULT_ASCENT_RATIO;\r\n    }\r\n\r\n    // Calculate half-leading (extra space above/below the text)\r\n    const leading = lineHeight - fontSize;\r\n    const halfLeading = leading / 2;\r\n\r\n    // Baseline is at: lineTop + halfLeading + ascent\r\n    return lineTop + halfLeading + ascent;\r\n}\r\n\r\n/**\r\n * Get font metrics ascent ratio for a given font.\r\n * Returns the ratio of ascent to font size.\r\n * \r\n * @param fontMetrics - Font metrics\r\n * @returns Ascent ratio (typically 0.7-0.9)\r\n */\r\nexport function getAscentRatio(fontMetrics: FontMetrics): number {\r\n    const { metrics } = fontMetrics;\r\n    return metrics.ascender / metrics.unitsPerEm;\r\n}\r\n\r\n/**\r\n * Get font metrics descent ratio for a given font.\r\n * Returns the ratio of descent to font size (negative value).\r\n * \r\n * @param fontMetrics - Font metrics\r\n * @returns Descent ratio (typically -0.2 to -0.3)\r\n */\r\nexport function getDescentRatio(fontMetrics: FontMetrics): number {\r\n    const { metrics } = fontMetrics;\r\n    return metrics.descender / metrics.unitsPerEm;\r\n}\r\n", "import { LayoutNode, type InlineRun } from \"../../dom/node.js\";\r\nimport type { LayoutItem } from \"./types.js\";\r\nimport { isBoxItem } from \"./types.js\";\r\nimport { placeInlineItem } from \"./layout.js\";\r\nimport { calculateBaseline } from \"./font-baseline-calculator.js\";\r\nimport type { FontEmbedder } from \"../../pdf/font/embedder.js\";\r\n\r\n/**\r\n * Context information for placing runs on a specific line\r\n */\r\nexport interface LineContext {\r\n    lineTop: number;\r\n    lineHeight: number;\r\n    lineStartX: number;\r\n    lineIndex: number;\r\n    availableWidth: number;\r\n    offsetShift: number;\r\n    isLastLine: boolean;\r\n    contentX: number;\r\n    inlineOffsetStart: number;\r\n}\r\n\r\n/**\r\n * Responsible for placing text runs and box items on lines.\r\n * Tracks runs per node and handles both text and inline-block layouts.\r\n */\r\nexport class RunPlacer {\r\n    private nodeRuns = new Map<LayoutNode, InlineRun[]>();\r\n    private maxInlineEnd = 0;\r\n\r\n    constructor(private readonly fontEmbedder: FontEmbedder | null = null) { }\r\n\r\n    /**\r\n     * Place all items on a line, creating InlineRun objects for text and positioning box items.\r\n     */\r\n    placeRunsForLine(\r\n        parts: { item: LayoutItem; offset: number }[],\r\n        lineContext: LineContext\r\n    ): void {\r\n        if (parts.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const { lineTop, lineHeight, lineStartX, lineIndex, availableWidth, offsetShift, isLastLine, contentX, inlineOffsetStart } = lineContext;\r\n\r\n        const lineWidth = parts.reduce((max, part) => Math.max(max, part.offset + part.item.width), 0);\r\n        const currentAvailableWidth = Math.max(availableWidth, 0);\r\n\r\n        const spaceCount = parts.reduce((count, part) => {\r\n            if (part.item.kind === \"space\") {\r\n                return count + (part.item.spaceCount ?? 1);\r\n            }\r\n            return count;\r\n        }, 0);\r\n\r\n        this.maxInlineEnd = Math.max(this.maxInlineEnd, lineStartX + lineWidth - contentX);\r\n\r\n        for (const part of parts) {\r\n            // Handle box items (inline-block, etc.)\r\n            if (isBoxItem(part.item)) {\r\n                const metrics = part.item.metrics;\r\n                metrics.lineOffset = part.offset + offsetShift;\r\n                placeInlineItem(metrics, contentX + inlineOffsetStart, lineTop);\r\n                continue;\r\n            }\r\n\r\n            // Handle text items\r\n            const node = part.item.node;\r\n            if (!node || !part.item.text) {\r\n                continue;\r\n            }\r\n\r\n            // Calculate baseline based on the item's fontSize and lineHeight\r\n            const fontSize = part.item.style?.fontSize ?? 16;\r\n            const itemLineHeight = part.item.lineHeight ?? lineHeight;\r\n\r\n            // Use calculateBaseline with font metrics when available\r\n            const fontFamily = part.item.style?.fontFamily ?? \"sans-serif\";\r\n            const fontWeight = part.item.style?.fontWeight ?? 400;\r\n            const fontStyle = part.item.style?.fontStyle ?? \"normal\";\r\n\r\n            const fontMetrics = this.fontEmbedder?.getMetrics(fontFamily, fontWeight, fontStyle);\r\n            const lineBaseline = calculateBaseline(lineTop, fontSize, itemLineHeight, fontMetrics);\r\n\r\n            const startX = lineStartX + part.offset;\r\n            const run: InlineRun = {\r\n                lineIndex,\r\n                startX,\r\n                baseline: lineBaseline,\r\n                text: part.item.text,\r\n                width: part.item.width,\r\n                lineWidth,\r\n                targetWidth: currentAvailableWidth,\r\n                spaceCount: spaceCount,\r\n                isLastLine,\r\n            };\r\n\r\n            // Update node.box.x to track the minimum startX across all runs for this node\r\n            // This ensures the bounding box starts at the leftmost run position\r\n            if (!this.nodeRuns.has(node)) {\r\n                // First run for this node - set initial position\r\n                node.box.x = startX;\r\n                node.box.y = lineTop;\r\n            } else {\r\n                // Multiple runs -use the minimum X and Y to encompass all runs\r\n                node.box.x = Math.min(node.box.x, startX);\r\n                node.box.y = Math.min(node.box.y, lineTop);\r\n            }\r\n            node.box.baseline = lineBaseline;\r\n            this.pushRun(node, run);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get all collected node runs\r\n     */\r\n    getNodeRuns(): Map<LayoutNode, InlineRun[]> {\r\n        return this.nodeRuns;\r\n    }\r\n\r\n    /**\r\n     * Get the maximum inline end position seen\r\n     */\r\n    getMaxInlineEnd(): number {\r\n        return this.maxInlineEnd;\r\n    }\r\n\r\n    /**\r\n     * Add a run to a node's run list\r\n     */\r\n    private pushRun(node: LayoutNode, run: InlineRun): void {\r\n        const existing = this.nodeRuns.get(node);\r\n        if (existing) {\r\n            existing.push(run);\r\n        } else {\r\n            this.nodeRuns.set(node, [run]);\r\n        }\r\n    }\r\n}\r\n", "import type { LayoutContext } from \"./pipeline/strategy.js\";\r\n\r\nlet LAYOUT_DEBUG: boolean | undefined;\r\n\r\nconst initialize = (context: LayoutContext) => {\r\n  if (LAYOUT_DEBUG === undefined) {\r\n    LAYOUT_DEBUG = context.env.getEnv(\"PAGYRA_DEBUG_LAYOUT\") === \"1\";\r\n  }\r\n};\r\n\r\nexport const createLayoutDebug = (context: LayoutContext) => {\r\n  initialize(context);\r\n  return (...args: unknown[]): void => {\r\n    if (LAYOUT_DEBUG) {\r\n      console.log(...args);\r\n    }\r\n  };\r\n};\r\n", "import { LayoutNode, type InlineRun } from \"../../dom/node.js\";\r\nimport { Display, FloatMode } from \"../../css/enums.js\";\r\nimport { resolvedLineHeight } from \"../../css/style.js\";\r\nimport { resolveLength } from \"../../css/length.js\";\r\nimport type { InlineLayoutOptions, InlineLayoutResult, LayoutItem, InlineMetrics } from \"./types.js\";\r\nimport { isBoxItem } from \"./types.js\";\r\nimport type { LayoutContext } from \"../pipeline/strategy.js\";\r\nimport { collectInlineFragments, tokenizeFragments, splitWordItemToken } from \"./tokenizer.js\";\r\nimport { FloatContext } from \"../context/float-context.js\";\r\nimport {\r\n    resolveInlineTextAlign,\r\n    isInlineDisplay,\r\n    shouldLayoutInlineChildren,\r\n    collectInlineParticipants,\r\n    inlineExtentWithinContainer,\r\n} from \"./inline-utils.js\";\r\nimport { getAlignmentStrategy, type TextAlignmentStrategy } from \"./text-alignment.js\";\r\nimport { BoundingBoxCalculator } from \"./bounding-box-calculator.js\";\r\nimport { RunPlacer } from \"./run-placer.js\";\r\nimport { createLayoutDebug } from \"../debug.js\";\r\n\r\n\r\n\r\nexport function layoutInlineFormattingContext(options: InlineLayoutOptions): InlineLayoutResult {\r\n    const { container, inlineNodes, context, floatContext, contentX, contentWidth } = options;\r\n    container.establishesIFC = true;\r\n    const layoutDebug = createLayoutDebug(context);\r\n\r\n    const textAlign = container.style.display === Display.Inline\r\n        ? undefined\r\n        : resolveInlineTextAlign(container);\r\n    const alignmentStrategy = getAlignmentStrategy(textAlign);\r\n    const shouldApplyTextIndent = container.style.display !== Display.Inline;\r\n    const resolvedTextIndent = shouldApplyTextIndent\r\n        ? resolveLength(container.style.textIndent, contentWidth, { auto: \"zero\" })\r\n        : 0;\r\n    let firstLineTextIndentPending = shouldApplyTextIndent && resolvedTextIndent !== 0;\r\n\r\n    const layoutCallback = (node: LayoutNode, width: number, ctx: any) => layoutInlineChildrenIfNeeded(node, width, ctx);\r\n    const fragments = collectInlineFragments(inlineNodes, contentWidth, context, layoutCallback);\r\n    const items = tokenizeFragments(fragments, context.env.fontEmbedder);\r\n\r\n    let lineTop = options.startY;\r\n    let lineHeight = Math.max(resolvedLineHeight(container.style), 0);\r\n    let inlineOffset = floatContext.inlineOffsets(lineTop, lineTop + lineHeight, contentWidth);\r\n    let availableWidth = Math.max(0, inlineOffset.end - inlineOffset.start);\r\n    let cursorX = 0;\r\n    let lineIndex = 0;\r\n    const lineParts: { item: LayoutItem; offset: number }[] = [];\r\n    const runPlacer = new RunPlacer(context.env.fontEmbedder);\r\n\r\n    const placeRunsForLine = (parts: { item: LayoutItem; offset: number }[], isLastLine: boolean) => {\r\n        const offsetShift = alignmentStrategy.calculateOffset(\r\n            parts.reduce((max, part) => Math.max(max, part.offset + part.item.width), 0),\r\n            Math.max(availableWidth, 0)\r\n        );\r\n\r\n        runPlacer.placeRunsForLine(parts, {\r\n            lineTop,\r\n            lineHeight,\r\n            lineStartX: contentX + inlineOffset.start + offsetShift,\r\n            lineIndex,\r\n            availableWidth,\r\n            offsetShift,\r\n            isLastLine,\r\n            contentX,\r\n            inlineOffsetStart: inlineOffset.start,\r\n        });\r\n    };\r\n\r\n    const commitLine = (isLastLine: boolean) => {\r\n        if (lineParts.length === 0) {\r\n            lineTop += lineHeight;\r\n        } else {\r\n            placeRunsForLine(lineParts, isLastLine);\r\n            lineTop += lineHeight;\r\n        }\r\n        cursorX = 0;\r\n        lineHeight = Math.max(resolvedLineHeight(container.style), 0);\r\n        lineParts.length = 0;\r\n        inlineOffset = floatContext.inlineOffsets(lineTop, lineTop + lineHeight, contentWidth);\r\n        availableWidth = Math.max(0, inlineOffset.end - inlineOffset.start);\r\n        lineIndex += 1;\r\n    };\r\n\r\n    for (let index = 0; index < items.length; index++) {\r\n        const item = items[index];\r\n\r\n        if (item.kind === \"newline\") {\r\n            commitLine(false);\r\n            continue;\r\n        }\r\n\r\n        let workingItem: LayoutItem | null = item;\r\n\r\n        while (workingItem) {\r\n            if (availableWidth <= 0) {\r\n                const nextLineTop = floatContext.nextUnblockedY(lineTop, lineTop + lineHeight);\r\n                if (nextLineTop === null) {\r\n                    // No floats to skip; allow overflow on this line.\r\n                    availableWidth = Math.max(0, contentWidth);\r\n                    inlineOffset = { start: 0, end: contentWidth };\r\n                } else {\r\n                    lineTop = nextLineTop;\r\n                    inlineOffset = floatContext.inlineOffsets(lineTop, lineTop + lineHeight, contentWidth);\r\n                    availableWidth = Math.max(0, inlineOffset.end - inlineOffset.start);\r\n                    cursorX = 0;\r\n                    lineParts.length = 0;\r\n                    continue;\r\n                }\r\n            }\r\n\r\n            if (lineParts.length === 0 && firstLineTextIndentPending) {\r\n                cursorX += resolvedTextIndent;\r\n                firstLineTextIndentPending = false;\r\n            }\r\n\r\n            const remaining = Math.max(availableWidth - cursorX, 0);\r\n\r\n            if (workingItem.kind === \"box\") {\r\n                if (lineParts.length > 0 && cursorX + workingItem.width > availableWidth) {\r\n                    commitLine(false);\r\n                    continue;\r\n                }\r\n                if (lineParts.length === 0 && workingItem.width > availableWidth) {\r\n                    const nextLineTop = floatContext.nextUnblockedY(lineTop, lineTop + lineHeight);\r\n                    if (nextLineTop === null) {\r\n                        lineParts.push({ item: workingItem, offset: cursorX });\r\n                        cursorX += workingItem.width;\r\n                        lineHeight = Math.max(lineHeight, workingItem.lineHeight);\r\n                        break;\r\n                    }\r\n                    lineTop = nextLineTop;\r\n                    inlineOffset = floatContext.inlineOffsets(lineTop, lineTop + lineHeight, contentWidth);\r\n                    availableWidth = Math.max(0, inlineOffset.end - inlineOffset.start);\r\n                    cursorX = 0;\r\n                    lineParts.length = 0;\r\n                    continue;\r\n                }\r\n\r\n                lineParts.push({ item: workingItem, offset: cursorX });\r\n                cursorX += workingItem.width;\r\n                lineHeight = Math.max(lineHeight, workingItem.lineHeight);\r\n                break;\r\n            }\r\n\r\n            // Text items\r\n            if (workingItem.kind === \"word\" && workingItem.width > remaining) {\r\n                const mode = workingItem.style?.overflowWrap ?? \"normal\";\r\n                if (mode !== \"normal\" && remaining > 0) {\r\n                    const [head, tail] = splitWordItemToken(workingItem, remaining);\r\n                    if (head) {\r\n                        lineParts.push({ item: head, offset: cursorX });\r\n                        cursorX += head.width;\r\n                        lineHeight = Math.max(lineHeight, head.lineHeight);\r\n                    }\r\n                    if (tail) {\r\n                        items.splice(index + 1, 0, tail);\r\n                    }\r\n                    workingItem = null;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (lineParts.length > 0 && cursorX + workingItem.width > availableWidth) {\r\n                commitLine(false);\r\n                continue;\r\n            }\r\n\r\n            if (lineParts.length === 0 && workingItem.width > availableWidth && workingItem.kind === \"word\") {\r\n                const nextLineTop = floatContext.nextUnblockedY(lineTop, lineTop + lineHeight);\r\n                if (nextLineTop === null) {\r\n                    lineParts.push({ item: workingItem, offset: cursorX });\r\n                    cursorX += workingItem.width;\r\n                    lineHeight = Math.max(lineHeight, workingItem.lineHeight);\r\n                    workingItem = null;\r\n                    break;\r\n                }\r\n                lineTop = nextLineTop;\r\n                inlineOffset = floatContext.inlineOffsets(lineTop, lineTop + lineHeight, contentWidth);\r\n                availableWidth = Math.max(0, inlineOffset.end - inlineOffset.start);\r\n                cursorX = 0;\r\n                lineParts.length = 0;\r\n                continue;\r\n            }\r\n\r\n            lineParts.push({ item: workingItem, offset: cursorX });\r\n            cursorX += workingItem.width;\r\n            lineHeight = Math.max(lineHeight, workingItem.lineHeight);\r\n            workingItem = null;\r\n        }\r\n    }\r\n\r\n    if (lineParts.length > 0) {\r\n        commitLine(true);\r\n    }\r\n\r\n    // Compute per-node sizes and propagate bounding boxes\r\n    const nodeRuns = runPlacer.getNodeRuns();\r\n    const boxCalculator = new BoundingBoxCalculator();\r\n    boxCalculator.computeNodeBoxes(nodeRuns);\r\n    boxCalculator.propagateBoundingBoxes(nodeRuns, container);\r\n\r\n    return { newCursorY: lineTop };\r\n}\r\n\r\nexport function placeInlineItem(item: InlineMetrics, lineStartX: number, lineTop: number, context?: LayoutContext): void {\n    const { node } = item;\n    const contentX = lineStartX + item.lineOffset + item.marginLeft + item.borderLeft + item.paddingLeft;\n    const contentY = lineTop + item.marginTop + item.borderTop + item.paddingTop;\n    const layoutDebug = context ? createLayoutDebug(context) : (): void => { /* no-op */ };\n    layoutDebug(`[placeInlineItem] node=${node.tagName ?? \"(anonymous)\"} lineStartX=${lineStartX} lineOffset=${item.lineOffset} marginLeft=${item.marginLeft} paddingLeft=${item.paddingLeft} borderLeft=${item.borderLeft} -> contentX=${contentX}`);\n\r\n    const previousX = node.box.x;\r\n    const previousY = node.box.y;\r\n\r\n    node.box.x = contentX;\r\n    node.box.y = contentY;\r\n    node.box.baseline = contentY + item.contentHeight;\r\n\r\n    const deltaX = node.box.x - previousX;\r\n    const deltaY = node.box.y - previousY;\r\n    if (deltaX !== 0 || deltaY !== 0) {\r\n        offsetInlineDescendants(node, deltaX, deltaY);\r\n    }\r\n}\r\n\r\nexport function offsetInlineDescendants(node: LayoutNode, deltaX: number, deltaY: number): void {\r\n    for (const child of node.children) {\r\n        child.shift(deltaX, deltaY);\r\n    }\r\n}\r\n\r\nfunction layoutInlineChildrenIfNeeded(\r\n    node: LayoutNode,\r\n    containerWidth: number,\r\n    context: any, // Using any to avoid circular type dependency if needed, or import LayoutContext\r\n): { contentWidth: number; contentHeight: number } | null {\r\n    if (!shouldLayoutInlineChildren(node)) {\r\n        return null;\r\n    }\r\n\r\n    const inlineChildren = collectInlineParticipants(node);\r\n    if (inlineChildren.length === 0) {\r\n        return null;\r\n    }\r\n\r\n    const savedX = node.box.x;\r\n    const savedY = node.box.y;\r\n    node.box.x = 0;\r\n    node.box.y = 0;\r\n\r\n    for (const child of inlineChildren) {\r\n        child.box.x = 0;\r\n        child.box.y = 0;\r\n    }\r\n\r\n    const localFloatContext = new FloatContext();\r\n    const result = layoutInlineFormattingContext({\r\n        container: node,\r\n        inlineNodes: inlineChildren,\r\n        context,\r\n        floatContext: localFloatContext,\r\n        contentX: 0,\r\n        contentWidth: Math.max(containerWidth, 0),\r\n        startY: 0,\r\n    });\r\n\r\n    const floatBottom = Math.max(localFloatContext.bottom(\"left\"), localFloatContext.bottom(\"right\"));\r\n    const contentHeight = Math.max(result.newCursorY, floatBottom);\r\n\r\n    let maxInlineEnd = 0;\r\n    for (const child of inlineChildren) {\r\n        const extent = inlineExtentWithinContainer(child, containerWidth);\r\n        maxInlineEnd = Math.max(maxInlineEnd, extent.end);\r\n    }\r\n\r\n    node.box.x = savedX;\r\n    node.box.y = savedY;\r\n\r\n    return {\r\n        contentWidth: Math.max(0, maxInlineEnd),\r\n        contentHeight: Math.max(0, contentHeight),\r\n    };\r\n}\r\n", "import { FloatContext } from \"../context/float-context.js\";\nimport type { LayoutContext } from \"../pipeline/strategy.js\";\nimport type { LayoutNode } from \"../../dom/node.js\";\nimport { layoutInlineFormattingContext, type InlineLayoutResult } from \"./inline-formatting.js\";\n\nexport interface InlineFormattingRequest {\n  container: LayoutNode;\n  inlineNodes: LayoutNode[];\n  context: LayoutContext;\n  floatContext?: FloatContext;\n  contentX: number;\n  contentWidth: number;\n  startY: number;\n}\n\nexport class InlineFormatter {\n  layout(request: InlineFormattingRequest): InlineLayoutResult {\n    const floatContext = request.floatContext ?? new FloatContext();\n    return layoutInlineFormattingContext({\n      container: request.container,\n      inlineNodes: request.inlineNodes,\n      context: request.context,\n      floatContext,\n      contentX: request.contentX,\n      contentWidth: request.contentWidth,\n      startY: request.startY,\n    });\n  }\n}\n\nexport const defaultInlineFormatter = new InlineFormatter();\n", "import { LayoutNode } from \"../../dom/node.js\";\r\nimport { Display } from \"../../css/enums.js\";\r\n\r\n/**\r\n * Determines if a layout node has an inline-level display mode.\r\n * \r\n * Inline-level elements participate in inline formatting contexts\r\n * and can be laid out on the same line with text and other inline elements.\r\n * \r\n * @param node - The layout node to check\r\n * @returns true if the node has an inline-level display mode\r\n */\r\nexport function isInlineLevel(node: LayoutNode): boolean {\r\n    switch (node.style.display) {\r\n        case Display.Inline:\r\n        case Display.InlineBlock:\r\n        case Display.InlineFlex:\r\n        case Display.InlineGrid:\r\n        case Display.InlineTable:\r\n            return true;\r\n        default:\r\n            return false;\r\n    }\r\n}\r\n", "import { LayoutNode } from \"../../dom/node.js\";\r\nimport { Display } from \"../../css/enums.js\";\r\nimport { resolveLength } from \"../../css/length.js\";\r\nimport { inFlow } from \"./node-math.js\";\r\n\r\ntype LayoutDebug = (...args: unknown[]) => void;\r\n\r\n/**\r\n * Handles measurement and adjustment of intrinsic content width for layout nodes.\r\n * \r\n * This class is responsible for:\r\n * - Measuring the actual width used by in-flow children\r\n * - Calculating offsets for content alignment\r\n * - Shifting children horizontally when needed\r\n * \r\n * Primarily used for inline-block sizing where the content width\r\n * needs to shrink-to-fit based on children's actual space usage.\r\n */\r\nexport class ContentMeasurer {\r\n    constructor(private readonly layoutDebug: LayoutDebug) {}\r\n    /**\r\n     * Measures the intrinsic width of in-flow content within a node.\r\n     * \r\n     * Calculates the minimum and maximum horizontal extents of all in-flow\r\n     * children, taking into account their margins, borders, and padding.\r\n     * \r\n     * @param node - The parent node whose content width to measure\r\n     * @param referenceWidth - The reference width for percentage calculations\r\n     * @param contentStartX - The X coordinate where content area begins\r\n     * @returns Object containing the measured width and any left offset\r\n     */\r\n    measureInFlowWidth(\r\n        node: LayoutNode,\r\n        referenceWidth: number,\r\n        contentStartX: number,\r\n    ): { width: number; leftOffset: number } {\r\n        let minStart = Number.POSITIVE_INFINITY;\r\n        let maxEnd = Number.NEGATIVE_INFINITY;\r\n        let hasContent = false;\r\n\r\n        for (const child of node.children) {\r\n            if (!inFlow(child)) {\r\n                continue;\r\n            }\r\n            if (child.style.display === Display.None) {\r\n                continue;\r\n            }\r\n\r\n            const marginLeft =\r\n                child.box.usedMarginLeft !== undefined\r\n                    ? child.box.usedMarginLeft\r\n                    : resolveLength(child.style.marginLeft, referenceWidth, { auto: \"zero\" });\r\n            const marginRight =\r\n                child.box.usedMarginRight !== undefined\r\n                    ? child.box.usedMarginRight\r\n                    : resolveLength(child.style.marginRight, referenceWidth, { auto: \"zero\" });\r\n            const borderLeft = resolveLength(child.style.borderLeft, referenceWidth, { auto: \"zero\" });\r\n            const borderRight = resolveLength(child.style.borderRight, referenceWidth, { auto: \"zero\" });\r\n            const paddingLeft = resolveLength(child.style.paddingLeft, referenceWidth, { auto: \"zero\" });\r\n            const paddingRight = resolveLength(child.style.paddingRight, referenceWidth, { auto: \"zero\" });\r\n\r\n            const borderBoxWidth = child.box.borderBoxWidth || Math.max(0, child.box.contentWidth + paddingLeft + paddingRight + borderLeft + borderRight);\r\n            const marginBoxWidth = borderBoxWidth + marginLeft + marginRight;\r\n            const marginStart = child.box.x - paddingLeft - borderLeft - marginLeft;\r\n            const relativeStart = marginStart - contentStartX;\r\n            const relativeEnd = relativeStart + marginBoxWidth;\r\n\r\n            this.layoutDebug(\r\n                `[measureInFlowContentWidth] parent=${node.tagName ?? \"(anonymous)\"} child=${child.tagName ?? \"(anonymous)\"} marginStart=${marginStart} relativeStart=${relativeStart} marginBoxWidth=${marginBoxWidth} borderBoxWidth=${borderBoxWidth} child.box.x=${child.box.x} contentStartX=${contentStartX}`,\r\n            );\r\n\r\n            minStart = Math.min(minStart, relativeStart);\r\n            maxEnd = Math.max(maxEnd, relativeEnd);\r\n            hasContent = true;\r\n        }\r\n\r\n        if (!hasContent) {\r\n            return { width: 0, leftOffset: 0 };\r\n        }\r\n\r\n        if (!Number.isFinite(minStart)) {\r\n            minStart = 0;\r\n        }\r\n        if (!Number.isFinite(maxEnd)) {\r\n            maxEnd = minStart;\r\n        }\r\n\r\n        const width = Math.max(0, maxEnd - minStart);\r\n        const leftOffset = minStart > 0 ? minStart : 0;\r\n        return { width, leftOffset };\r\n    }\r\n\r\n    /**\r\n     * Shifts all in-flow children horizontally by the specified amount.\r\n     * \r\n     * This is used to adjust child positions when the parent's content width\r\n     * changes (e.g., for inline-block shrink-to-fit).\r\n     * \r\n     * @param node - The parent node whose children to shift\r\n     * @param deltaX - The horizontal offset to apply (negative shifts left)\r\n     */\r\n    shiftInFlowChildrenX(node: LayoutNode, deltaX: number): void {\r\n        if (deltaX === 0) {\r\n            return;\r\n        }\r\n        for (const child of node.children) {\r\n            if (!inFlow(child)) {\r\n                continue;\r\n            }\r\n            if (child.style.display === Display.None) {\r\n                continue;\r\n            }\r\n            // Shift the child and all its descendants\r\n            child.shift(-deltaX, 0);\r\n        }\r\n    }\r\n}\r\n", "import { LayoutNode } from \"../../dom/node.js\";\r\nimport { Display, FloatMode } from \"../../css/enums.js\";\r\nimport type { LayoutContext, LayoutStrategy } from \"../pipeline/strategy.js\";\r\nimport {\r\n  containingBlock,\r\n  establishesBFC,\r\n  horizontalNonContent,\r\n  horizontalMargin,\r\n  inFlow,\r\n  resolveBlockAutoMargins,\r\n  resolveWidthBlock,\r\n  verticalNonContent,\r\n} from \"../utils/node-math.js\";\r\nimport { resolveLength } from \"../../css/length.js\";\r\nimport {\r\n  canCollapseMarginEnd,\r\n  canCollapseMarginStart,\r\n  collapsedGapBetween,\r\n  effectiveMarginBottom,\r\n  effectiveMarginTop,\r\n  findFirstMarginCollapsibleChild,\r\n  findLastMarginCollapsibleChild,\r\n} from \"../utils/margin.js\";\r\nimport { finalizeOverflow } from \"../utils/overflow.js\";\r\nimport { FloatContext } from \"../context/float-context.js\";\r\nimport { clearForBlock, placeFloat } from \"../utils/floats.js\";\r\nimport { defaultInlineFormatter } from \"../utils/inline-formatter.js\";\r\nimport { isInlineLevel } from \"../utils/display-utils.js\";\r\nimport { ContentMeasurer } from \"../utils/content-measurer.js\";\r\nimport { createLayoutDebug } from \"../debug.js\";\r\n\r\nexport class BlockLayoutStrategy implements LayoutStrategy {\r\n  private readonly supportedDisplays = new Set<Display>([Display.Block, Display.FlowRoot, Display.InlineBlock, Display.TableCell]);\r\n\r\n  canLayout(node: LayoutNode): boolean {\r\n    return this.supportedDisplays.has(node.style.display);\r\n  }\r\n\r\n  layout(node: LayoutNode, context: LayoutContext): void {\r\n    const layoutDebug = createLayoutDebug(context);\r\n    const contentMeasurer = new ContentMeasurer(layoutDebug);\r\n    const cb = containingBlock(node, context.env.viewport);\r\n    node.establishesBFC = establishesBFC(node);\r\n\r\n    let contentWidth = resolveWidthBlock(node, cb.width);\r\n    const debugTag = node.tagName ?? \"(anonymous)\";\r\n    if (node.style.display === Display.InlineBlock) {\r\n      layoutDebug(\r\n        `[BlockLayout] start inline-block tag=${debugTag} style.width=${node.style.width} resolvedContentWidth=${contentWidth} cb.width=${cb.width}`,\r\n      );\r\n    }\r\n    const availableWidth = contentWidth;\r\n    node.box.contentWidth = contentWidth;\r\n\r\n    const horizontalExtras = horizontalNonContent(node, contentWidth);\r\n    const horizontalMarginSize = horizontalMargin(node, contentWidth);\r\n    node.box.borderBoxWidth = contentWidth + horizontalExtras;\r\n    node.box.marginBoxWidth = node.box.borderBoxWidth + horizontalMarginSize;\r\n\r\n    const paddingLeft = resolveLength(node.style.paddingLeft, contentWidth, { auto: \"zero\" });\r\n    const borderLeft = resolveLength(node.style.borderLeft, contentWidth, { auto: \"zero\" });\r\n    const paddingTop = resolveLength(node.style.paddingTop, contentWidth, { auto: \"zero\" });\r\n    const borderTop = resolveLength(node.style.borderTop, contentWidth, { auto: \"zero\" });\r\n\r\n    const contentX = node.box.x + borderLeft + paddingLeft;\r\n    const collapseTopWithChildren = canCollapseMarginStart(node, contentWidth);\r\n    const collapseBottomWithChildren = canCollapseMarginEnd(node, contentWidth);\r\n    const firstCollapsibleChild = collapseTopWithChildren ? findFirstMarginCollapsibleChild(node) : undefined;\r\n    const lastCollapsibleChild = collapseBottomWithChildren ? findLastMarginCollapsibleChild(node) : undefined;\r\n    const topCollapseAmount =\r\n      collapseTopWithChildren && firstCollapsibleChild ? effectiveMarginTop(firstCollapsibleChild, contentWidth) : 0;\r\n    const bottomCollapseAmount =\r\n      collapseBottomWithChildren && lastCollapsibleChild ? effectiveMarginBottom(lastCollapsibleChild, contentWidth) : 0;\r\n\r\n    let cursorY = node.box.y + paddingTop + borderTop;\r\n    let previousBottomMargin = 0;\r\n    const floatContext = new FloatContext();\r\n    const children = node.children;\r\n\r\n    for (let index = 0; index < children.length; index++) {\r\n      const child = children[index];\r\n      if (child.style.display === Display.None) {\r\n        continue;\r\n      }\r\n\r\n      if (child.style.float !== FloatMode.None) {\r\n        cursorY = clearForBlock(child, floatContext, cursorY);\r\n        placeFloat({\r\n          node: child,\r\n          floatContext,\r\n          context,\r\n          contentX,\r\n          contentWidth,\r\n          startY: cursorY,\r\n        });\r\n        previousBottomMargin = 0;\r\n        continue;\r\n      }\r\n\r\n      if (!inFlow(child)) {\r\n        continue;\r\n      }\r\n\r\n      if (isInlineLevel(child)) {\r\n        const inlineNodes: LayoutNode[] = [child];\r\n        let lookahead = index + 1;\r\n        while (lookahead < children.length) {\r\n          const candidate = children[lookahead];\r\n          if (candidate.style.float !== FloatMode.None || !isInlineLevel(candidate)) {\r\n            break;\r\n          }\r\n          inlineNodes.push(candidate);\r\n          lookahead += 1;\r\n        }\r\n\r\n        const result = defaultInlineFormatter.layout({\r\n          container: node,\r\n          inlineNodes,\r\n          context,\r\n          floatContext,\r\n          contentX,\r\n          contentWidth,\r\n          startY: cursorY,\r\n        });\r\n        cursorY = result.newCursorY;\r\n        previousBottomMargin = 0;\r\n        index = lookahead - 1;\r\n        continue;\r\n      }\r\n\r\n      const childMarginTopRaw = resolveLength(child.style.marginTop, contentWidth, { auto: \"zero\" });\r\n      const childMarginBottomRaw = resolveLength(child.style.marginBottom, contentWidth, { auto: \"zero\" });\r\n      const collapsedMarginTop = effectiveMarginTop(child, contentWidth);\r\n      const collapsedMarginBottom = effectiveMarginBottom(child, contentWidth);\r\n\r\n      let gap = collapsedGapBetween(previousBottomMargin, collapsedMarginTop, node.establishesBFC);\r\n      if (collapseTopWithChildren && child === firstCollapsibleChild) {\r\n        gap -= topCollapseAmount;\r\n      }\r\n\r\n      child.box.x = contentX;\r\n      child.box.y = cursorY + gap;\r\n\r\n      context.layoutChild(child);\r\n\r\n      const { marginLeft: usedMarginLeft, marginRight: usedMarginRight } = resolveBlockAutoMargins(\r\n        contentWidth,\r\n        child.box.borderBoxWidth,\r\n        child.style.marginLeft,\r\n        child.style.marginRight,\r\n      );\r\n      child.box.usedMarginLeft = usedMarginLeft;\r\n      child.box.usedMarginRight = usedMarginRight;\r\n      const deltaX = usedMarginLeft;\r\n      if (deltaX !== 0) {\r\n        child.shift(deltaX, 0);\r\n      }\r\n      child.box.x = contentX + usedMarginLeft;\r\n\r\n      child.box.marginBoxWidth = child.box.borderBoxWidth + usedMarginLeft + usedMarginRight;\r\n      child.box.marginBoxHeight = child.box.borderBoxHeight + childMarginTopRaw + childMarginBottomRaw;\r\n\r\n      previousBottomMargin = collapsedMarginBottom;\r\n\r\n      cursorY = child.box.y + child.box.borderBoxHeight;\r\n\r\n      if (collapseBottomWithChildren && child === lastCollapsibleChild) {\r\n        cursorY += collapsedMarginBottom - bottomCollapseAmount;\r\n        previousBottomMargin = 0;\r\n      }\r\n    }\r\n\r\n    const measurement = contentMeasurer.measureInFlowWidth(node, contentWidth, contentX);\r\n    if (Number.isFinite(measurement.width)) {\r\n      const intrinsicWidth = Math.max(0, measurement.width);\r\n      node.box.scrollWidth = Math.max(node.box.scrollWidth, intrinsicWidth);\r\n\r\n      if (node.style.display === Display.InlineBlock && node.style.width === \"auto\") {\r\n        const minWidth =\r\n          node.style.minWidth !== undefined ? resolveLength(node.style.minWidth, cb.width, { auto: \"zero\" }) : undefined;\r\n        const maxWidth =\r\n          node.style.maxWidth !== undefined\r\n            ? resolveLength(node.style.maxWidth, cb.width, { auto: \"reference\" })\r\n            : undefined;\r\n\r\n        let targetContentWidth = intrinsicWidth;\r\n        targetContentWidth = Math.min(targetContentWidth, availableWidth);\r\n        if (minWidth !== undefined) {\r\n          targetContentWidth = Math.max(targetContentWidth, minWidth);\r\n        }\r\n        if (maxWidth !== undefined) {\r\n          targetContentWidth = Math.min(targetContentWidth, maxWidth);\r\n        }\r\n        targetContentWidth = Math.max(0, targetContentWidth);\r\n\r\n        if (node.style.display === Display.InlineBlock) {\r\n          layoutDebug(\r\n            `[BlockLayout] intrinsic measurement tag=${debugTag} intrinsic=${intrinsicWidth} current=${node.box.contentWidth} horizontalExtras=${horizontalExtras} available=${availableWidth}`,\r\n          );\r\n        }\r\n        if (measurement.leftOffset > 0) {\r\n          layoutDebug(\r\n            `[BlockLayout] shifting inline-block children tag=${debugTag} offset=${measurement.leftOffset}`,\r\n          );\r\n          contentMeasurer.shiftInFlowChildrenX(node, measurement.leftOffset);\r\n        }\r\n        if (targetContentWidth !== node.box.contentWidth) {\r\n          node.box.contentWidth = targetContentWidth;\r\n          contentWidth = targetContentWidth;\r\n          node.box.borderBoxWidth = node.box.contentWidth + horizontalExtras;\r\n          node.box.marginBoxWidth = node.box.borderBoxWidth + horizontalMarginSize;\r\n          if (node.style.display === Display.InlineBlock) {\r\n            layoutDebug(\r\n              `[BlockLayout] updated inline-block tag=${debugTag} newContentWidth=${node.box.contentWidth} borderBoxWidth=${node.box.borderBoxWidth}`,\r\n            );\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    const floatBottom = Math.max(floatContext.bottom(\"left\"), floatContext.bottom(\"right\"));\r\n    const effectiveCursor = Math.max(cursorY, floatBottom);\r\n    node.box.contentHeight = Math.max(0, effectiveCursor - (node.box.y + borderTop) - paddingTop);\r\n    if (node.style.height !== \"auto\") {\r\n      node.box.contentHeight = resolveLength(node.style.height, cb.height, { auto: \"zero\" });\r\n    }\r\n    const verticalExtras = verticalNonContent(node, contentWidth);\r\n    node.box.borderBoxHeight = node.box.contentHeight + verticalExtras;\r\n    node.box.marginBoxHeight =\r\n      node.box.borderBoxHeight +\r\n      resolveLength(node.style.marginTop, contentWidth, { auto: \"zero\" }) +\r\n      resolveLength(node.style.marginBottom, contentWidth, { auto: \"zero\" });\r\n\r\n    finalizeOverflow(node);\r\n  }\r\n}\r\n", "/**\r\n * Gap calculation utilities for layout strategies.\r\n * Provides SOLID gap handling for grid, flex, and other layout modes.\r\n * \r\n * This module follows the Single Responsibility Principle by focusing\r\n * solely on gap-related calculations, making it reusable across different\r\n * layout strategies.\r\n */\r\n\r\nexport interface GapConfig {\r\n    /** Gap between rows (in pixels) */\r\n    rowGap: number;\r\n\r\n    /** Gap between columns (in pixels) */\r\n    columnGap: number;\r\n}\r\n\r\n/**\r\n * Calculate total gap space for a given number of items in one direction.\r\n * \r\n * Formula: gap \u00D7 (itemCount - 1)\r\n * \r\n * @param gap - Gap value in pixels\r\n * @param itemCount - Number of items\r\n * @returns Total gap space consumed (0 if itemCount <= 1 or gap <= 0)\r\n * \r\n * @example\r\n * calculateTotalGap(10, 3) // returns 20 (2 gaps between 3 items)\r\n * calculateTotalGap(10, 1) // returns 0 (no gaps for single item)\r\n */\r\nexport function calculateTotalGap(gap: number, itemCount: number): number {\r\n    if (itemCount <= 1 || gap <= 0) {\r\n        return 0;\r\n    }\r\n    return gap * (itemCount - 1);\r\n}\r\n\r\n/**\r\n * Calculate available space after accounting for gaps.\r\n * \r\n * @param totalSpace - Total available space in pixels\r\n * @param gap - Gap between items in pixels\r\n * @param itemCount - Number of items\r\n * @returns Available space for content (clamped to 0 minimum)\r\n * \r\n * @example\r\n * calculateAvailableSpace(100, 10, 3) // returns 80 (100 - 20 gap)\r\n */\r\nexport function calculateAvailableSpace(\r\n    totalSpace: number,\r\n    gap: number,\r\n    itemCount: number\r\n): number {\r\n    const totalGap = calculateTotalGap(gap, itemCount);\r\n    return Math.max(0, totalSpace - totalGap);\r\n}\r\n\r\n/**\r\n * Calculate offsets for items with gaps in a single axis.\r\n * \r\n * Returns the starting position of each item, accounting for gaps.\r\n * \r\n * @param itemSizes - Array of item sizes in pixels\r\n * @param gap - Gap between items in pixels\r\n * @returns Array of offsets for each item\r\n * \r\n * @example\r\n * calculateItemOffsets([50, 30, 40], 10)\r\n * // returns [0, 60, 100] (item1 at 0, item2 at 50+10, item3 at 50+10+30+10)\r\n */\r\nexport function calculateItemOffsets(\r\n    itemSizes: number[],\r\n    gap: number\r\n): number[] {\r\n    const offsets: number[] = [];\r\n    let offset = 0;\r\n\r\n    for (let i = 0; i < itemSizes.length; i++) {\r\n        offsets.push(offset);\r\n        offset += itemSizes[i];\r\n\r\n        // Add gap after all items except the last\r\n        if (i < itemSizes.length - 1) {\r\n            offset += gap;\r\n        }\r\n    }\r\n\r\n    return offsets;\r\n}\r\n\r\n/**\r\n * Calculate grid track offsets with gaps.\r\n * \r\n * This is an alias for calculateItemOffsets with clearer naming for grid context.\r\n * \r\n * @param trackSizes - Array of track sizes in pixels\r\n * @param gap - Gap between tracks in pixels\r\n * @returns Array of offsets for each track\r\n */\r\nexport function calculateTrackOffsets(\r\n    trackSizes: number[],\r\n    gap: number\r\n): number[] {\r\n    return calculateItemOffsets(trackSizes, gap);\r\n}\r\n\r\n/**\r\n * Gap calculator service for layout strategies.\r\n * \r\n * This class provides a convenient interface for gap calculations\r\n * with awareness of layout direction (row vs column).\r\n * \r\n * Follows the Dependency Inversion Principle - layout strategies\r\n * depend on this abstraction rather than implementing gap logic themselves.\r\n */\r\nexport class GapCalculator {\r\n    constructor(private config: GapConfig) { }\r\n\r\n    /**\r\n     * Get gap for main axis based on direction.\r\n     * \r\n     * @param isRow - True if main axis is horizontal (row), false for vertical (column)\r\n     * @returns Gap value in pixels\r\n     */\r\n    getMainAxisGap(isRow: boolean): number {\r\n        return isRow ? this.config.columnGap : this.config.rowGap;\r\n    }\r\n\r\n    /**\r\n     * Get gap for cross axis based on direction.\r\n     * \r\n     * @param isRow - True if main axis is horizontal (row), false for vertical (column)\r\n     * @returns Gap value in pixels\r\n     */\r\n    getCrossAxisGap(isRow: boolean): number {\r\n        return isRow ? this.config.rowGap : this.config.columnGap;\r\n    }\r\n\r\n    /**\r\n     * Calculate total gap for main axis.\r\n     * \r\n     * @param isRow - True if main axis is horizontal (row)\r\n     * @param itemCount - Number of items in main axis\r\n     * @returns Total gap space consumed in pixels\r\n     */\r\n    calculateMainAxisTotalGap(isRow: boolean, itemCount: number): number {\r\n        const gap = this.getMainAxisGap(isRow);\r\n        return calculateTotalGap(gap, itemCount);\r\n    }\r\n\r\n    /**\r\n     * Calculate available space in main axis after gaps.\r\n     * \r\n     * @param isRow - True if main axis is horizontal (row)\r\n     * @param totalSpace - Total available space in pixels\r\n     * @param itemCount - Number of items in main axis\r\n     * @returns Available space for content in pixels\r\n     */\r\n    calculateMainAxisAvailableSpace(\r\n        isRow: boolean,\r\n        totalSpace: number,\r\n        itemCount: number\r\n    ): number {\r\n        const gap = this.getMainAxisGap(isRow);\r\n        return calculateAvailableSpace(totalSpace, gap, itemCount);\r\n    }\r\n}\r\n", "import { LayoutNode } from \"../../dom/node.js\";\r\nimport { AlignItems, Display, JustifyContent } from \"../../css/enums.js\";\r\nimport type { LayoutContext, LayoutStrategy } from \"../pipeline/strategy.js\";\r\nimport { containingBlock, resolveBoxMetrics } from \"../utils/node-math.js\";\r\nimport { resolveLength, isAutoLength } from \"../../css/length.js\";\r\nimport type { LengthLike } from \"../../css/length.js\";\r\nimport type { FlexDirection, AlignSelfValue } from \"../../css/style.js\";\r\nimport { GapCalculator, calculateTotalGap } from \"../utils/gap-calculator.js\";\r\n\r\nfunction blockifyFlexItemDisplay(display: Display): Display {\r\n  switch (display) {\r\n    case Display.Inline:\r\n    case Display.InlineBlock:\r\n      return Display.Block;\r\n    case Display.InlineFlex:\r\n      return Display.Flex;\r\n    case Display.InlineGrid:\r\n      return Display.Grid;\r\n    case Display.InlineTable:\r\n      return Display.Table;\r\n    default:\r\n      return display;\r\n  }\r\n}\r\n\r\nfunction allowsPreferredShrink(originalDisplay: Display, effectiveDisplay: Display): boolean {\r\n  switch (effectiveDisplay) {\r\n    case Display.Flex:\r\n    case Display.InlineFlex:\r\n    case Display.Grid:\r\n    case Display.InlineGrid:\r\n      return false;\r\n    default:\r\n      break;\r\n  }\r\n  if (effectiveDisplay === originalDisplay) {\r\n    return true;\r\n  }\r\n  return originalDisplay === Display.Inline;\r\n}\r\n\r\nexport class FlexLayoutStrategy implements LayoutStrategy {\r\n  private readonly supportedDisplays = new Set<Display>([Display.Flex, Display.InlineFlex]);\r\n\r\n  canLayout(node: LayoutNode): boolean {\r\n    return this.supportedDisplays.has(node.style.display);\r\n  }\r\n\r\n  layout(node: LayoutNode, context: LayoutContext): void {\r\n    const cb = containingBlock(node, context.env.viewport);\r\n    const isRow = isRowDirection(node.style.flexDirection);\r\n    const cbMain = isRow ? cb.width : cb.height;\r\n    const cbCross = isRow ? cb.height : cb.width;\r\n    const specifiedMain = resolveFlexSize(isRow ? node.style.width : node.style.height, cbMain);\r\n    const specifiedCross = resolveFlexSize(isRow ? node.style.height : node.style.width, cbCross);\r\n\r\n    // Read gap properties for flex layout\r\n    const rowGap = node.style.rowGap ?? 0;\r\n    const columnGap = node.style.columnGap ?? 0;\r\n    const gapCalculator = new GapCalculator({ rowGap, columnGap });\r\n    const mainAxisGap = gapCalculator.getMainAxisGap(isRow);\r\n\r\n    // Resolve box metrics (padding/border)\r\n    const boxMetrics = resolveBoxMetrics(node, cb.width, cb.height);\r\n\r\n    if (isRow) {\r\n      node.box.contentWidth = resolveInitialDimension(specifiedMain, cbMain);\r\n      node.box.contentHeight = resolveInitialDimension(specifiedCross, cbCross);\r\n    } else {\r\n      node.box.contentWidth = resolveInitialDimension(specifiedCross, cbCross);\r\n      node.box.contentHeight = resolveInitialDimension(specifiedMain, cbMain);\r\n    }\r\n\r\n    node.box.borderBoxWidth =\r\n      node.box.contentWidth +\r\n      boxMetrics.paddingLeft +\r\n      boxMetrics.paddingRight +\r\n      boxMetrics.borderLeft +\r\n      boxMetrics.borderRight;\r\n    node.box.borderBoxHeight =\r\n      node.box.contentHeight +\r\n      boxMetrics.paddingTop +\r\n      boxMetrics.paddingBottom +\r\n      boxMetrics.borderTop +\r\n      boxMetrics.borderBottom;\r\n    node.box.scrollWidth = Math.max(node.box.scrollWidth, node.box.contentWidth);\r\n    node.box.scrollHeight = Math.max(node.box.scrollHeight, node.box.contentHeight);\r\n\r\n    interface FlexItemMetrics {\r\n      node: LayoutNode;\r\n      mainMarginStart: number;\r\n      mainMarginEnd: number;\r\n      crossMarginStart: number;\r\n      crossMarginEnd: number;\r\n      mainSize: number;\r\n      crossSize: number;\r\n      mainContribution: number;\r\n      crossContribution: number;\r\n    }\r\n\r\n    const alignContainer = node.style.alignItems ?? AlignItems.Stretch;\r\n    const items: FlexItemMetrics[] = [];\r\n    let totalMain = 0;\r\n    let maxCrossContribution = 0;\r\n\r\n    for (const child of node.children) {\r\n      if (child.style.display === Display.None) {\r\n        continue;\r\n      }\r\n\r\n      const originalDisplay = child.style.display;\r\n      const blockifiedDisplay = blockifyFlexItemDisplay(originalDisplay);\r\n      const displayMutated = blockifiedDisplay !== originalDisplay;\r\n      if (displayMutated) {\r\n        child.style.display = blockifiedDisplay;\r\n      }\r\n\r\n      try {\r\n        context.layoutChild(child);\r\n\r\n        const marginLeft = resolveLength(child.style.marginLeft, cb.width, { auto: \"zero\" });\r\n        const marginRight = resolveLength(child.style.marginRight, cb.width, { auto: \"zero\" });\r\n        const marginTop = resolveLength(child.style.marginTop, cb.height, { auto: \"zero\" });\r\n        const marginBottom = resolveLength(child.style.marginBottom, cb.height, { auto: \"zero\" });\r\n\r\n        const mainMarginStart = isRow ? marginLeft : marginTop;\r\n        const mainMarginEnd = isRow ? marginRight : marginBottom;\r\n        const crossMarginStart = isRow ? marginTop : marginLeft;\r\n        const crossMarginEnd = isRow ? marginBottom : marginRight;\r\n\r\n        let mainSize = isRow ? child.box.borderBoxWidth : child.box.borderBoxHeight;\r\n        const childDisplay = blockifiedDisplay;\r\n        const allowPreferredShrink = allowsPreferredShrink(originalDisplay, childDisplay);\r\n\r\n        if (isRow && allowPreferredShrink && isAutoMainSize(child.style.width)) {\r\n          const preferredContent = computePreferredInlineWidth(child);\r\n          if (preferredContent !== undefined && preferredContent >= 0) {\r\n            const minWidth =\r\n              child.style.minWidth !== undefined\r\n                ? resolveLength(child.style.minWidth, cb.width, { auto: \"zero\" })\r\n                : undefined;\r\n            const maxWidth =\r\n              child.style.maxWidth !== undefined\r\n                ? resolveLength(child.style.maxWidth, cb.width, { auto: \"reference\" })\r\n                : undefined;\r\n            let targetContentWidth = preferredContent;\r\n            if (minWidth !== undefined) {\r\n              targetContentWidth = Math.max(targetContentWidth, minWidth);\r\n            }\r\n            if (maxWidth !== undefined) {\r\n              targetContentWidth = Math.min(targetContentWidth, maxWidth);\r\n            }\r\n            if (targetContentWidth < child.box.contentWidth) {\r\n              const paddingLeft = resolveLength(child.style.paddingLeft, cb.width, { auto: \"zero\" });\r\n              const paddingRight = resolveLength(child.style.paddingRight, cb.width, { auto: \"zero\" });\r\n              const borderLeft = resolveLength(child.style.borderLeft, cb.width, { auto: \"zero\" });\r\n              const borderRight = resolveLength(child.style.borderRight, cb.width, { auto: \"zero\" });\r\n              child.box.contentWidth = targetContentWidth;\r\n              child.box.borderBoxWidth = targetContentWidth + paddingLeft + paddingRight + borderLeft + borderRight;\r\n              child.box.marginBoxWidth = child.box.borderBoxWidth + marginLeft + marginRight;\r\n              child.box.scrollWidth = Math.max(child.box.scrollWidth, child.box.contentWidth);\r\n              mainSize = child.box.borderBoxWidth;\r\n            }\r\n          }\r\n        }\r\n\r\n        let crossSize = isRow ? child.box.borderBoxHeight : child.box.borderBoxWidth;\r\n        if (!isRow && allowPreferredShrink) {\r\n          const alignSelf = resolveItemAlignment(child.style.alignSelf, alignContainer);\r\n          const autoWidth = isAutoLength(child.style.width);\r\n          if (alignSelf !== AlignItems.Stretch && autoWidth) {\r\n            const preferredContent = computePreferredInlineWidth(child);\r\n            if (preferredContent !== undefined && preferredContent > 0) {\r\n              const widthRef = cb.width;\r\n              const paddingLeft = resolveLength(child.style.paddingLeft, widthRef, { auto: \"zero\" });\r\n              const paddingRight = resolveLength(child.style.paddingRight, widthRef, { auto: \"zero\" });\r\n              const borderLeft = resolveLength(child.style.borderLeft, widthRef, { auto: \"zero\" });\r\n              const borderRight = resolveLength(child.style.borderRight, widthRef, { auto: \"zero\" });\r\n              const minWidth =\r\n                child.style.minWidth !== undefined\r\n                  ? resolveLength(child.style.minWidth, widthRef, { auto: \"zero\" })\r\n                  : undefined;\r\n              const maxWidth =\r\n                child.style.maxWidth !== undefined\r\n                  ? resolveLength(child.style.maxWidth, widthRef, { auto: \"reference\" })\r\n                  : undefined;\r\n              let targetContentWidth = Math.min(preferredContent, child.box.contentWidth);\r\n              if (minWidth !== undefined) {\r\n                targetContentWidth = Math.max(targetContentWidth, minWidth);\r\n              }\r\n              if (maxWidth !== undefined) {\r\n                targetContentWidth = Math.min(targetContentWidth, maxWidth);\r\n              }\r\n              targetContentWidth = Math.max(0, targetContentWidth);\r\n              if (targetContentWidth < child.box.contentWidth) {\r\n                child.box.contentWidth = targetContentWidth;\r\n                const horizontalExtras = paddingLeft + paddingRight + borderLeft + borderRight;\r\n                const newBorderBoxWidth = targetContentWidth + horizontalExtras;\r\n                child.box.borderBoxWidth = newBorderBoxWidth;\r\n                child.box.marginBoxWidth = newBorderBoxWidth + marginLeft + marginRight;\r\n                child.box.scrollWidth = Math.max(child.box.scrollWidth, targetContentWidth);\r\n                crossSize = newBorderBoxWidth;\r\n              }\r\n            }\r\n          }\r\n        }\r\n        const mainContribution = mainSize + mainMarginStart + mainMarginEnd;\r\n        const crossContribution = crossSize + crossMarginStart + crossMarginEnd;\r\n\r\n        items.push({\r\n          node: child,\r\n          mainMarginStart,\r\n          mainMarginEnd,\r\n          crossMarginStart,\r\n          crossMarginEnd,\r\n          mainSize,\r\n          crossSize,\r\n          mainContribution,\r\n          crossContribution,\r\n        });\r\n\r\n        totalMain += mainContribution;\r\n        maxCrossContribution = Math.max(maxCrossContribution, crossContribution);\r\n      } finally {\r\n        if (displayMutated) {\r\n          child.style.display = originalDisplay;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Account for gaps in total main size\r\n    const gapSpace = calculateTotalGap(mainAxisGap, items.length);\r\n    const totalMainWithGaps = totalMain + gapSpace;\r\n\r\n    let containerMainSize: number;\r\n    if (specifiedMain !== undefined) {\r\n      containerMainSize = specifiedMain;\r\n    } else {\r\n      const reference = Number.isFinite(cbMain) && cbMain > 0 ? cbMain : totalMainWithGaps;\r\n      containerMainSize = Math.max(reference, totalMainWithGaps);\r\n    }\r\n\r\n    let containerCrossSize: number;\r\n    if (specifiedCross !== undefined) {\r\n      containerCrossSize = Math.max(specifiedCross, maxCrossContribution);\r\n    } else if (!isRow) {\r\n      const referenceCross = Number.isFinite(cbCross) && cbCross > 0 ? cbCross : maxCrossContribution;\r\n      containerCrossSize = Math.max(referenceCross, maxCrossContribution);\r\n    } else {\r\n      containerCrossSize = maxCrossContribution;\r\n    }\r\n\r\n    const minCrossValue = isRow ? node.style.minHeight : node.style.minWidth;\r\n    const maxCrossValue = isRow ? node.style.maxHeight : node.style.maxWidth;\r\n    const minCross = minCrossValue !== undefined ? resolveLength(minCrossValue, cbCross, { auto: \"zero\" }) : undefined;\r\n    const maxCross = maxCrossValue !== undefined ? resolveLength(maxCrossValue, cbCross, { auto: \"reference\" }) : undefined;\r\n\r\n    if (minCross !== undefined) {\r\n      containerCrossSize = Math.max(containerCrossSize, minCross);\r\n    }\r\n    if (maxCross !== undefined) {\r\n      containerCrossSize = Math.min(containerCrossSize, maxCross);\r\n    }\r\n\r\n\r\n    const justify = node.style.justifyContent ?? JustifyContent.FlexStart;\r\n    const align = alignContainer;\r\n    // Calculate justify spacing based on free space AFTER accounting for gaps\r\n    // This makes gap additive with justify-content spacing (per CSS Flexbox spec)\r\n    const freeSpaceAfterGaps = containerMainSize - totalMainWithGaps;\r\n    const { offset: initialOffset, gap: justifyGap } = resolveJustifySpacing(justify, freeSpaceAfterGaps, items.length);\r\n\r\n    let cursor = initialOffset;\r\n\r\n    for (let index = 0; index < items.length; index++) {\r\n      const item = items[index];\r\n      const alignSelf = resolveItemAlignment(item.node.style.alignSelf, align);\r\n      const crossOffset = computeCrossOffset(alignSelf, containerCrossSize, item.crossSize, item.crossMarginStart, item.crossMarginEnd);\r\n\r\n      const previousX = item.node.box.x;\r\n      const previousY = item.node.box.y;\r\n      if (isRow) {\r\n        item.node.box.x = boxMetrics.contentBoxX + cursor + item.mainMarginStart;\r\n        item.node.box.y = boxMetrics.contentBoxY + crossOffset + item.crossMarginStart;\r\n      } else {\r\n        item.node.box.x = boxMetrics.contentBoxX + crossOffset + item.crossMarginStart;\r\n        item.node.box.y = boxMetrics.contentBoxY + cursor + item.mainMarginStart;\r\n      }\r\n      offsetLayoutSubtree(item.node, item.node.box.x - previousX, item.node.box.y - previousY);\r\n\r\n      cursor += item.mainContribution;\r\n      if (index < items.length - 1) {\r\n        // Apply explicit gap PLUS justify spacing (additive per spec)\r\n        cursor += mainAxisGap + justifyGap;\r\n      }\r\n    }\r\n\r\n    if (isRow) {\r\n      node.box.contentWidth = containerMainSize;\r\n      node.box.contentHeight = containerCrossSize;\r\n    } else {\r\n      node.box.contentWidth = containerCrossSize;\r\n      node.box.contentHeight = containerMainSize;\r\n    }\r\n\r\n    node.box.borderBoxWidth =\r\n      node.box.contentWidth +\r\n      boxMetrics.paddingLeft +\r\n      boxMetrics.paddingRight +\r\n      boxMetrics.borderLeft +\r\n      boxMetrics.borderRight;\r\n    node.box.borderBoxHeight =\r\n      node.box.contentHeight +\r\n      boxMetrics.paddingTop +\r\n      boxMetrics.paddingBottom +\r\n      boxMetrics.borderTop +\r\n      boxMetrics.borderBottom;\r\n    node.box.scrollWidth = node.box.contentWidth;\r\n    node.box.scrollHeight = node.box.contentHeight;\r\n  }\r\n}\r\n\r\nfunction resolveInitialDimension(specified: number | undefined, fallback: number): number {\r\n  if (specified !== undefined && Number.isFinite(specified)) {\r\n    return Math.max(specified, 0);\r\n  }\r\n  if (Number.isFinite(fallback)) {\r\n    return Math.max(fallback, 0);\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction resolveFlexSize(value: LengthLike | undefined, reference: number): number | undefined {\r\n  if (value === undefined) {\r\n    return undefined;\r\n  }\r\n  if (typeof value === \"number\") {\r\n    return value;\r\n  }\r\n  if (value === \"auto\" || isAutoLength(value)) {\r\n    return undefined;\r\n  }\r\n  return resolveLength(value, reference, { auto: \"reference\" });\r\n}\r\n\r\nfunction resolveItemAlignment(alignSelf: AlignSelfValue | undefined, containerAlign: AlignItems): AlignItems {\r\n  if (alignSelf && alignSelf !== \"auto\") {\r\n    return alignSelf;\r\n  }\r\n  return containerAlign;\r\n}\r\n\r\nfunction computeCrossOffset(\r\n  alignment: AlignItems,\r\n  containerSize: number,\r\n  itemSize: number,\r\n  marginStart: number,\r\n  marginEnd: number,\r\n): number {\r\n  const total = itemSize + marginStart + marginEnd;\r\n  const reference = Number.isFinite(containerSize) ? containerSize : total;\r\n  const freeSpace = reference - total;\r\n  if (freeSpace <= 0) {\r\n    return 0;\r\n  }\r\n  switch (alignment) {\r\n    case AlignItems.Center:\r\n      return freeSpace / 2;\r\n    case AlignItems.FlexEnd:\r\n      return freeSpace;\r\n    default:\r\n      return 0;\r\n  }\r\n}\r\n\r\nfunction resolveJustifySpacing(\r\n  justify: JustifyContent,\r\n  freeSpace: number,\r\n  itemCount: number,\r\n): { offset: number; gap: number } {\r\n  if (itemCount <= 0) {\r\n    return { offset: 0, gap: 0 };\r\n  }\r\n  const clamped = Number.isFinite(freeSpace) ? Math.max(freeSpace, 0) : 0;\r\n  switch (justify) {\r\n    case JustifyContent.Center:\r\n      return { offset: clamped / 2, gap: 0 };\r\n    case JustifyContent.FlexEnd:\r\n    case JustifyContent.End:\r\n    case JustifyContent.Right:\r\n      return { offset: clamped, gap: 0 };\r\n    case JustifyContent.SpaceBetween:\r\n      if (itemCount === 1) {\r\n        return { offset: 0, gap: 0 };\r\n      }\r\n      return { offset: 0, gap: clamped / (itemCount - 1) };\r\n    case JustifyContent.SpaceAround: {\r\n      const gap = clamped / itemCount;\r\n      return { offset: gap / 2, gap };\r\n    }\r\n    case JustifyContent.SpaceEvenly: {\r\n      const gap = clamped / (itemCount + 1);\r\n      return { offset: gap, gap };\r\n    }\r\n    default:\r\n      return { offset: 0, gap: 0 };\r\n  }\r\n}\r\n\r\nfunction isRowDirection(direction: FlexDirection): boolean {\r\n  return direction === \"row\" || direction === \"row-reverse\";\r\n}\r\n\r\nfunction isAutoMainSize(value: LengthLike | undefined): boolean {\r\n  if (value === undefined) {\r\n    return true;\r\n  }\r\n  if (typeof value === \"number\") {\r\n    return false;\r\n  }\r\n  if (value === \"auto\") {\r\n    return true;\r\n  }\r\n  return isAutoLength(value);\r\n}\r\n\r\nfunction computePreferredInlineWidth(node: LayoutNode): number | undefined {\r\n  let maxWidth = 0;\r\n  node.walk((desc) => {\r\n    if (desc.inlineRuns && desc.inlineRuns.length > 0) {\r\n      const localMax = desc.inlineRuns.reduce(\r\n        (max, run) => Math.max(max, run.lineWidth ?? run.width),\r\n        0,\r\n      );\r\n      if (localMax > maxWidth) {\r\n        maxWidth = localMax;\r\n      }\r\n      return;\r\n    }\r\n    if (!desc.lineBoxes || desc.lineBoxes.length === 0) {\r\n      return;\r\n    }\r\n    for (const line of desc.lineBoxes) {\r\n      if (!line) {\r\n        continue;\r\n      }\r\n      const width = typeof line.width === \"number\" ? line.width : 0;\r\n      if (width > maxWidth) {\r\n        maxWidth = width;\r\n      }\r\n    }\r\n  });\r\n  return maxWidth > 0 ? maxWidth : undefined;\r\n}\r\n\r\nfunction offsetLayoutSubtree(node: LayoutNode, deltaX: number, deltaY: number): void {\r\n  if (deltaX === 0 && deltaY === 0) {\r\n    return;\r\n  }\r\n  node.walk((desc) => {\r\n    if (desc === node) {\r\n      return;\r\n    }\r\n    desc.box.x += deltaX;\r\n    desc.box.y += deltaY;\r\n    desc.box.baseline += deltaY;\r\n\r\n    // Update inline runs if they exist\r\n    if (desc.inlineRuns && desc.inlineRuns.length > 0) {\r\n      for (const run of desc.inlineRuns) {\r\n        run.startX += deltaX;\r\n        run.baseline += deltaY;\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n", "import { Display } from \"../../css/enums.js\";\r\nimport type { TrackDefinition, TrackSize } from \"../../css/style.js\";\r\nimport { resolveLength } from \"../../css/length.js\";\r\nimport type { LayoutContext, LayoutStrategy } from \"../pipeline/strategy.js\";\r\nimport {\r\n  containingBlock,\r\n  horizontalMargin,\r\n  horizontalNonContent,\r\n  resolveWidthBlock,\r\n  verticalNonContent,\r\n} from \"../utils/node-math.js\";\r\nimport type { LayoutNode } from \"../../dom/node.js\";\r\nimport { calculateTrackOffsets, calculateTotalGap } from \"../utils/gap-calculator.js\";\r\n\r\ntype RepeatTrack = Extract<TrackDefinition, { kind: \"repeat\" }>;\r\ntype AutoRepeatTrack = Extract<TrackDefinition, { kind: \"repeat-auto\" }>;\r\n\r\nfunction isRepeatTrack(def: TrackDefinition): def is RepeatTrack {\r\n  return typeof def === \"object\" && def !== null && \"kind\" in def && def.kind === \"repeat\";\r\n}\r\n\r\nfunction isAutoRepeatTrack(def: TrackDefinition): def is AutoRepeatTrack {\r\n  return typeof def === \"object\" && def !== null && \"kind\" in def && def.kind === \"repeat-auto\";\r\n}\r\n\r\nfunction trackMinSize(track: TrackSize): number {\r\n  switch (track.kind) {\r\n    case \"fixed\":\r\n      return Math.max(0, track.size);\r\n    case \"flex\":\r\n      return Math.max(0, track.min ?? 0);\r\n    case \"auto\":\r\n      return Math.max(0, track.min ?? 0);\r\n    default:\r\n      return 0;\r\n  }\r\n}\r\n\r\nfunction trackFlex(track: TrackSize): number {\r\n  return track.kind === \"flex\" ? Math.max(0, track.flex) : 0;\r\n}\r\n\r\nfunction cloneTrackSize(track: TrackSize): TrackSize {\r\n  if (track.kind === \"fixed\") {\r\n    return { kind: \"fixed\", size: track.size };\r\n  }\r\n  if (track.kind === \"flex\") {\r\n    return {\r\n      kind: \"flex\",\r\n      flex: track.flex,\r\n      min: track.min,\r\n      max: track.max,\r\n    };\r\n  }\r\n  return {\r\n    kind: \"auto\",\r\n    min: track.min,\r\n    max: track.max,\r\n  };\r\n}\r\n\r\nfunction flattenTrackDefinitions(\r\n  definitions: TrackDefinition[],\r\n  childCount: number,\r\n  availableWidth: number,\r\n  columnGap: number,\r\n): TrackSize[] {\r\n  if (definitions.length === 0) {\r\n    return [];\r\n  }\r\n\r\n  const tracks: TrackSize[] = [];\r\n  for (const def of definitions) {\r\n    if (isRepeatTrack(def)) {\r\n      for (let i = 0; i < def.count; i++) {\r\n        tracks.push(cloneTrackSize(def.track));\r\n      }\r\n      continue;\r\n    }\r\n    if (isAutoRepeatTrack(def)) {\r\n      const minSize = trackMinSize(def.track);\r\n      let count = childCount || 1;\r\n      if (minSize > 0) {\r\n        const unit = minSize + columnGap;\r\n        if (unit > 0) {\r\n          count = Math.max(1, Math.floor((availableWidth + columnGap) / unit));\r\n        }\r\n      }\r\n      if (def.mode === \"auto-fit\" && childCount > 0) {\r\n        count = Math.min(count, childCount);\r\n      }\r\n      for (let i = 0; i < count; i++) {\r\n        tracks.push(cloneTrackSize(def.track));\r\n      }\r\n      continue;\r\n    }\r\n    tracks.push(cloneTrackSize(def as TrackSize));\r\n  }\r\n  return tracks;\r\n}\r\n\r\nfunction resolveColumnWidths(tracks: TrackSize[], contentWidth: number, columnGap: number): number[] {\r\n  const columnCount = tracks.length;\r\n  if (columnCount === 0) {\r\n    return [];\r\n  }\r\n\r\n  const gapTotal = calculateTotalGap(columnGap, columnCount);\r\n  const available = Math.max(0, contentWidth - gapTotal);\r\n  const minSizes = tracks.map((track) => trackMinSize(track));\r\n  const flexFactors = tracks.map((track) => trackFlex(track));\r\n  const totalMin = minSizes.reduce((sum, size) => sum + size, 0);\r\n  const totalFlex = flexFactors.reduce((sum, flex) => sum + flex, 0);\r\n  const leftover = Math.max(0, available - totalMin);\r\n\r\n  return tracks.map((track, index) => {\r\n    switch (track.kind) {\r\n      case \"fixed\":\r\n        return Math.max(0, track.size);\r\n      case \"flex\": {\r\n        let size = minSizes[index];\r\n        if (totalFlex > 0 && flexFactors[index] > 0) {\r\n          size += (flexFactors[index] / totalFlex) * leftover;\r\n        }\r\n        if (track.max !== undefined) {\r\n          size = Math.min(size, track.max);\r\n        }\r\n        return Math.max(0, size);\r\n      }\r\n      case \"auto\": {\r\n        let size = minSizes[index];\r\n        if (track.max !== undefined && size > track.max) {\r\n          size = track.max;\r\n        }\r\n        return Math.max(0, size);\r\n      }\r\n      default:\r\n        return available / columnCount;\r\n    }\r\n  });\r\n}\r\n\r\nexport class GridLayoutStrategy implements LayoutStrategy {\r\n  private readonly supportedDisplays = new Set<Display>([Display.Grid, Display.InlineGrid]);\r\n\r\n  canLayout(node: LayoutNode): boolean {\r\n    return this.supportedDisplays.has(node.style.display);\r\n  }\r\n\r\n  layout(node: LayoutNode, context: LayoutContext): void {\r\n    const cb = containingBlock(node, context.env.viewport);\r\n    const baseContentWidth = resolveWidthBlock(node, cb.width);\r\n    node.box.contentWidth = baseContentWidth;\r\n    const horizontalExtras = horizontalNonContent(node, baseContentWidth);\r\n    node.box.borderBoxWidth = baseContentWidth + horizontalExtras;\r\n    node.box.marginBoxWidth = node.box.borderBoxWidth + horizontalMargin(node, baseContentWidth);\r\n\r\n    const paddingLeft = resolveLength(node.style.paddingLeft, baseContentWidth, { auto: \"zero\" });\r\n    const paddingTop = resolveLength(node.style.paddingTop, baseContentWidth, { auto: \"zero\" });\r\n    const borderLeft = resolveLength(node.style.borderLeft, baseContentWidth, { auto: \"zero\" });\r\n    const borderTop = resolveLength(node.style.borderTop, baseContentWidth, { auto: \"zero\" });\r\n\r\n    const contentOriginX = node.box.x + borderLeft + paddingLeft;\r\n    const contentOriginY = node.box.y + borderTop + paddingTop;\r\n\r\n    const columnGap = node.style.columnGap ?? 0;\r\n    const rowGap = node.style.rowGap ?? 0;\r\n\r\n    const flattenedTracks = flattenTrackDefinitions(\r\n      node.style.trackListColumns,\r\n      node.children.length,\r\n      baseContentWidth,\r\n      columnGap,\r\n    );\r\n    const tracks: TrackSize[] =\r\n      flattenedTracks.length > 0 ? flattenedTracks : [{ kind: \"flex\", flex: 1 } as TrackSize];\r\n    const columnWidths = resolveColumnWidths(tracks, baseContentWidth, columnGap);\r\n    const totalColumnWidth =\r\n      columnWidths.reduce((sum, width) => sum + width, 0) + calculateTotalGap(columnGap, columnWidths.length);\r\n    const resolvedContentWidth = columnWidths.length > 0 ? Math.max(baseContentWidth, totalColumnWidth) : baseContentWidth;\r\n    node.box.contentWidth = resolvedContentWidth;\r\n    node.box.borderBoxWidth = resolvedContentWidth + horizontalExtras;\r\n    node.box.marginBoxWidth = node.box.borderBoxWidth + horizontalMargin(node, resolvedContentWidth);\r\n\r\n    const columnOffsets = calculateTrackOffsets(columnWidths, columnGap);\r\n\r\n    let contentHeight = 0;\r\n    let currentRowTop = contentOriginY;\r\n    let currentRowHeight = 0;\r\n    let columnIndex = 0;\r\n    let rowCount = 0;\r\n\r\n    for (const child of node.children) {\r\n      if (child.style.display === Display.None) {\r\n        continue;\r\n      }\r\n\r\n      const columnWidth = columnWidths[columnIndex] ?? columnWidths[columnWidths.length - 1] ?? baseContentWidth;\r\n      const columnX = contentOriginX + (columnOffsets[columnIndex] ?? 0);\r\n\r\n      child.box.x = columnX;\r\n      child.box.y = currentRowTop;\r\n\r\n      const originalContentWidth = node.box.contentWidth;\r\n      node.box.contentWidth = columnWidth;\r\n      context.layoutChild(child);\r\n      node.box.contentWidth = originalContentWidth;\r\n\r\n      child.box.x = columnX;\r\n      child.box.y = currentRowTop;\r\n\r\n      currentRowHeight = Math.max(currentRowHeight, child.box.borderBoxHeight);\r\n\r\n      columnIndex += 1;\r\n      if (columnIndex >= columnWidths.length) {\r\n        rowCount += 1;\r\n        contentHeight += currentRowHeight;\r\n        currentRowTop += currentRowHeight + rowGap;\r\n        currentRowHeight = 0;\r\n        columnIndex = 0;\r\n      }\r\n    }\r\n\r\n    if (columnIndex !== 0) {\r\n      rowCount += 1;\r\n      contentHeight += currentRowHeight;\r\n    }\r\n\r\n    const totalRowGap = calculateTotalGap(rowGap, rowCount);\r\n    const verticalExtras = verticalNonContent(node, node.box.contentWidth);\r\n    node.box.contentHeight = Math.max(0, contentHeight + totalRowGap);\r\n    node.box.borderBoxHeight = node.box.contentHeight + verticalExtras;\r\n    node.box.marginBoxHeight =\r\n      node.box.borderBoxHeight +\r\n      resolveLength(node.style.marginTop, node.box.contentWidth, { auto: \"zero\" }) +\r\n      resolveLength(node.style.marginBottom, node.box.contentWidth, { auto: \"zero\" });\r\n\r\n    node.box.scrollWidth = Math.max(node.box.contentWidth, totalColumnWidth);\r\n    node.box.scrollHeight = node.box.contentHeight;\r\n\r\n    if (columnWidths.length === 0) {\r\n      node.box.contentWidth = baseContentWidth;\r\n      node.box.borderBoxWidth = node.box.contentWidth + horizontalExtras;\r\n      node.box.marginBoxWidth = node.box.borderBoxWidth + horizontalMargin(node, node.box.contentWidth);\r\n    }\r\n  }\r\n}\r\n", "// ===== text/line-breaker.ts =====\r\n\r\nimport { WhiteSpace } from \"../css/enums.js\";\r\nimport { ComputedStyle } from \"../css/style.js\";\r\nimport { estimateLineWidth, measureTextWithGlyphs } from \"../layout/utils/text-metrics.js\";\r\nimport type { FontEmbedder } from \"../pdf/font/embedder.js\";\r\nimport { applyTextTransform } from \"./text-transform.js\"; // Precisaremos exportar esta fun\u00E7\u00E3o\r\n\r\n// Representa uma unidade inquebr\u00E1vel (palavra) ou um espa\u00E7o flex\u00EDvel (cola).\r\nexport interface TextItem {\r\n  type: 'word' | 'space';\r\n  text: string;\r\n  width: number;\r\n}\r\n\r\n// O resultado da quebra de linha para um n\u00F3 de texto.\r\nexport interface LineBox {\r\n  text: string;\r\n  width: number;\r\n  spaceCount: number;\r\n  targetWidth: number;\r\n}\r\n\r\n/**\r\n * Segmenta uma string de texto em palavras e espa\u00E7os.\r\n */\r\nfunction segmentText(text: string): { type: 'word' | 'space', text: string }[] {\r\n  // Uma segmenta\u00E7\u00E3o simples baseada em espa\u00E7os. Uma implementa\u00E7\u00E3o mais robusta\r\n  // poderia usar Intl.Segmenter ou lidar com m\u00FAltiplos tipos de espa\u00E7os.\r\n  const segments: { type: 'word' | 'space', text: string }[] = [];\r\n  const regex = /(\\s+)|([^\\s]+)/g;\r\n  let match;\r\n  while ((match = regex.exec(text)) !== null) {\r\n    if (match[1]) { // \u00C9 um espa\u00E7o\r\n      segments.push({ type: 'space', text: match[1] });\r\n    } else if (match[2]) { // \u00C9 uma palavra\r\n      segments.push({ type: 'word', text: match[2] });\r\n    }\r\n  }\r\n  return segments;\r\n}\r\n\r\n/**\r\n * Mede a largura de cada palavra e espa\u00E7o.\r\n */\r\nfunction measureItems(\r\n  segments: { type: 'word' | 'space', text: string }[],\r\n  style: ComputedStyle,\r\n  fontEmbedder: FontEmbedder | null\r\n): TextItem[] {\r\n  const fontWeight = typeof style.fontWeight === \"number\" ? style.fontWeight : 400;\r\n  const fontStyle = style.fontStyle ?? \"normal\";\r\n  const fontMetrics = fontEmbedder?.getMetrics(style.fontFamily ?? \"\", fontWeight, fontStyle);\r\n\r\n  return segments.map(s => {\r\n    const glyphWidth = measureTextWithGlyphs(s.text, style, fontMetrics ?? null);\r\n    return {\r\n      ...s,\r\n      width: glyphWidth ?? estimateLineWidth(s.text, style),\r\n    };\r\n  });\r\n}\r\n\r\nfunction splitWordItem(\r\n  item: TextItem,\r\n  style: ComputedStyle,\r\n  availableWidth: number\r\n): TextItem[] {\r\n  if (availableWidth <= 0) {\r\n    return [item];\r\n  }\r\n  const pieces: TextItem[] = [];\r\n  let buffer = \"\";\r\n  let bufferWidth = 0;\r\n\r\n  const flush = () => {\r\n    if (!buffer) {\r\n      return;\r\n    }\r\n    pieces.push({ type: \"word\", text: buffer, width: bufferWidth });\r\n    buffer = \"\";\r\n    bufferWidth = 0;\r\n  };\r\n\r\n  for (const char of Array.from(item.text)) {\r\n    const candidate = buffer + char;\r\n    const candidateWidth = estimateLineWidth(candidate, style);\r\n\r\n    if (buffer && candidateWidth > availableWidth) {\r\n      flush();\r\n      buffer = char;\r\n      bufferWidth = estimateLineWidth(char, style);\r\n      continue;\r\n    }\r\n\r\n    if (!buffer && candidateWidth > availableWidth) {\r\n      pieces.push({ type: \"word\", text: char, width: candidateWidth });\r\n      buffer = \"\";\r\n      bufferWidth = 0;\r\n      continue;\r\n    }\r\n\r\n    buffer = candidate;\r\n    bufferWidth = candidateWidth;\r\n  }\r\n\r\n  flush();\r\n  return pieces.length ? pieces : [item];\r\n}\r\n\r\nfunction enforceOverflowWrap(\r\n  items: TextItem[],\r\n  style: ComputedStyle,\r\n  availableWidth: number,\r\n  mode: ComputedStyle[\"overflowWrap\"] | undefined\r\n): TextItem[] {\r\n  if (!mode || mode === \"normal\") {\r\n    return items;\r\n  }\r\n\r\n  const adjusted: TextItem[] = [];\r\n  for (const item of items) {\r\n    if (item.type !== \"word\") {\r\n      adjusted.push(item);\r\n      continue;\r\n    }\r\n    if (item.width <= availableWidth) {\r\n      adjusted.push(item);\r\n      continue;\r\n    }\r\n    adjusted.push(...splitWordItem(item, style, availableWidth));\r\n  }\r\n\r\n  return adjusted.length ? adjusted : items;\r\n}\r\n\r\nfunction countJustifiableSpaces(items: TextItem[]): number {\r\n  let count = 0;\r\n  for (let index = 0; index < items.length; index++) {\r\n    const item = items[index];\r\n    if (item.type !== \"space\") {\r\n      continue;\r\n    }\r\n    const hasWordBefore = items.slice(0, index).some((candidate) => candidate.type === \"word\");\r\n    if (!hasWordBefore) {\r\n      continue;\r\n    }\r\n    const hasWordAfter = items.slice(index + 1).some((candidate) => candidate.type === \"word\");\r\n    if (hasWordAfter) {\r\n      count += 1;\r\n    }\r\n  }\r\n  return count;\r\n}\r\n\r\nfunction shouldTrimLineEdges(style: ComputedStyle): boolean {\r\n  const mode = style.whiteSpace;\r\n  return (\r\n    mode === WhiteSpace.Normal ||\r\n    mode === WhiteSpace.NoWrap ||\r\n    mode === WhiteSpace.PreLine\r\n  );\r\n}\r\n\r\nfunction buildLineBox(items: TextItem[], availableWidth: number, trimEdges: boolean): LineBox | null {\r\n  let start = 0;\r\n  let end = items.length;\r\n\r\n  if (trimEdges) {\r\n    while (start < end && items[start].type === \"space\") {\r\n      start += 1;\r\n    }\r\n    while (end > start && items[end - 1].type === \"space\") {\r\n      end -= 1;\r\n    }\r\n  }\r\n\r\n  if (start >= end) {\r\n    return null;\r\n  }\r\n\r\n  const trimmed = items.slice(start, end);\r\n  const text = trimmed.map((it) => it.text).join(\"\");\r\n  const width = trimmed.reduce((sum, it) => sum + it.width, 0);\r\n\r\n  return {\r\n    text,\r\n    width,\r\n    spaceCount: countJustifiableSpaces(trimmed),\r\n    targetWidth: availableWidth,\r\n  };\r\n}\r\n\r\n/**\r\n * Implementa um algoritmo de quebra de linha inspirado em Knuth-Plass\r\n * usando programa\u00E7\u00E3o din\u00E2mica para encontrar o layout \u00F3timo.\r\n *\r\n * @param text O texto a ser quebrado.\r\n * @param style O estilo computado a ser usado para medi\u00E7\u00E3o.\r\n * @param availableWidth A largura dispon\u00EDvel para o texto.\r\n * @returns Um array de objetos LineBox representando as linhas \u00F3timas.\r\n */\r\nexport function breakTextIntoLines(\r\n  text: string,\r\n  style: ComputedStyle,\r\n  availableWidth: number,\r\n  fontEmbedder: FontEmbedder | null = null\r\n): LineBox[] {\r\n  const effectiveText = applyTextTransform(text, style.textTransform);\r\n  if (effectiveText.length === 0) {\r\n    return [];\r\n  }\r\n\r\n  const rawItems = segmentText(effectiveText);\r\n  let items = measureItems(rawItems, style, fontEmbedder);\r\n  items = enforceOverflowWrap(items, style, availableWidth, style.overflowWrap);\r\n  const n = items.length;\r\n  if (n === 0) return [];\r\n  const trimEdges = shouldTrimLineEdges(style);\r\n\r\n  // Check if entire text fits on one line - if so, keep a single trimmed line\r\n  const totalWidth = items.reduce((sum, it) => sum + it.width, 0);\r\n  if (totalWidth <= availableWidth) {\r\n    const singleLine = buildLineBox(items, availableWidth, trimEdges);\r\n    return singleLine ? [singleLine] : [];\r\n  }\r\n\r\n  // memo[i] armazena o custo m\u00EDnimo (feiura) para quebrar os primeiros `i` itens.\r\n  const memo: number[] = new Array(n + 1).fill(Infinity);\r\n  // breaks[i] armazena o \u00EDndice do in\u00EDcio da \u00FAltima linha na quebra \u00F3tima para os primeiros `i` itens.\r\n  const breaks: number[] = new Array(n + 1).fill(0);\r\n\r\n  memo[0] = 0;\r\n\r\n  for (let i = 1; i <= n; i++) {\r\n    let lineWidth = 0;\r\n    let hasWord = false;\r\n    for (let j = i; j > 0; j--) {\r\n      const item = items[j - 1];\r\n\r\n      if (item.type === \"space\") {\r\n        if (!hasWord && trimEdges) {\r\n          continue;\r\n        }\r\n        lineWidth += item.width;\r\n        if (lineWidth > availableWidth) {\r\n          break;\r\n        }\r\n        if (!trimEdges && !hasWord) {\r\n          const slack = availableWidth - lineWidth;\r\n          const cost = 100 + slack * slack;\r\n          if (memo[j - 1] + cost < memo[i]) {\r\n            memo[i] = memo[j - 1] + cost;\r\n            breaks[i] = j - 1;\r\n          }\r\n        }\r\n        continue;\r\n      }\r\n\r\n      lineWidth += item.width;\r\n      hasWord = true;\r\n\r\n      if (lineWidth > availableWidth) {\r\n        break; // Esta linha \u00E9 longa demais, n\u00E3o h\u00E1 como continuar a partir deste `j`.\r\n      }\r\n\r\n      const slack = availableWidth - lineWidth;\r\n      const cost = 100 + slack * slack;\r\n\r\n      if (memo[j - 1] + cost < memo[i]) {\r\n        memo[i] = memo[j - 1] + cost;\r\n        breaks[i] = j - 1;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Se memo[n] \u00E9 infinito, significa que uma \u00FAnica palavra \u00E9 mais larga que\r\n  // a linha, ent\u00E3o recorremos a uma quebra for\u00E7ada.\r\n  if (!isFinite(memo[n])) {\r\n    const lines: LineBox[] = [];\r\n    let currentWidth = 0;\r\n    let currentItems: TextItem[] = [];\r\n    const pushCurrent = () => {\r\n      const line = buildLineBox(currentItems, availableWidth, trimEdges);\r\n      if (line) {\r\n        lines.push(line);\r\n      }\r\n    };\r\n  for (const item of items) {\r\n    if (trimEdges && item.type === \"space\" && currentItems.length === 0) {\r\n      continue;\r\n    }\r\n    if (item.type === 'word' && currentItems.length > 0 && currentWidth + item.width > availableWidth) {\r\n      pushCurrent();\r\n      currentWidth = 0;\r\n      currentItems = [];\r\n    }\r\n    currentItems.push(item);\r\n    currentWidth += item.width;\r\n  }\r\n    if (currentItems.length > 0) {\r\n      pushCurrent();\r\n    }\r\n    return lines;\r\n  }\r\n  \r\n  // Reconstitui o caminho \u00F3timo usando os backpointers em `breaks`.\r\n  const lines: LineBox[] = [];\r\n  let current = n;\r\n  while (current > 0) {\r\n    const prev = breaks[current];\r\n    const lineItems = items.slice(prev, current);\r\n    const line = buildLineBox(lineItems, availableWidth, trimEdges);\r\n    if (line) {\r\n      lines.unshift(line);\r\n    }\r\n    current = prev;\r\n  }\r\n\r\n  return lines;\r\n}\r\n", "import { LayoutNode } from \"../../dom/node.js\";\nimport { resolvedLineHeight } from \"../../css/style.js\";\nimport { breakTextIntoLines } from \"../../text/line-breaker.js\";\n\nexport function layoutTableCell(td: LayoutNode): void {\n  const availableWidth = Math.max(0, td.box.contentWidth);\n\n  td.walk((node) => {\n    if (!node.textContent) {\n      return;\n    }\n\n    const lines = breakTextIntoLines(node.textContent, node.style, availableWidth);\n    node.lineBoxes = lines;\n\n    const lineHeight = resolvedLineHeight(node.style);\n    const hasRenderableText = node.textContent.trim().length > 0;\n    const totalHeight = lines.length > 0 ? lines.length * lineHeight : (hasRenderableText ? lineHeight : 0);\n    node.box.contentHeight = totalHeight;\n\n    if (lines.length > 0) {\n      const maxWidth = Math.max(...lines.map((line) => line.width));\n      node.box.contentWidth = Math.min(availableWidth, maxWidth);\n    } else {\n      node.box.contentWidth = 0;\n    }\n  });\n\n  const childHeights = Array.from(td.children).map((child) => child.box.contentHeight ?? 0);\n  td.box.contentHeight = Math.max(td.box.contentHeight ?? 0, ...childHeights);\n}\n", "import { LayoutNode } from \"../../dom/node.js\";\nimport { log } from \"../../logging/debug.js\";\n\nexport function auditTableCell(td: LayoutNode): void {\n  log(\"layout\", \"debug\", \"[AUDIT] td inline\", {\n    tdWidth: td.box.contentWidth,\n    lines: (td.lineBoxes ?? []).length,\n    joined: (td.lineBoxes ?? []).map((line) => line.text).join(\" | \"),\n  });\n}\n\nexport function debugTableCell(cell: LayoutNode): void {\n  if (cell.tagName === \"td\" && cell.textContent?.includes(\"Row 3, Cell 3\")) {\n    log(\"layout\", \"debug\", \"[DEBUG] before inline layout for problematic td\", {\n      textContent: cell.textContent,\n      contentWidth: cell.box.contentWidth,\n    });\n  }\n}\n", "import { BorderModel, Display } from \"../../css/enums.js\";\r\nimport { LayoutNode } from \"../../dom/node.js\";\r\nimport { log } from \"../../logging/debug.js\";\r\nimport { resolveLength } from \"../../css/length.js\";\r\nimport { containingBlock, horizontalNonContent, resolveWidthBlock, verticalNonContent } from \"../utils/node-math.js\";\r\nimport type { LayoutContext, LayoutStrategy } from \"../pipeline/strategy.js\";\r\nimport { layoutTableCell } from \"../table/cell_layout.js\";\r\nimport { auditTableCell, debugTableCell } from \"../table/diagnostics.js\";\r\nimport type { LengthLike } from \"../../css/length.js\";\r\n\r\nexport class TableLayoutStrategy implements LayoutStrategy {\r\n  private readonly supportedDisplays = new Set<Display>([Display.Table, Display.InlineTable]);\r\n\r\n  canLayout(node: LayoutNode): boolean {\r\n    return this.supportedDisplays.has(node.style.display);\r\n  }\r\n\r\n  layout(node: LayoutNode, context: LayoutContext): void {\r\n    log(\"layout\", \"debug\", \"TableLayoutStrategy invoked\", {\r\n      tagName: node.tagName,\r\n      display: node.style.display,\r\n      children: node.children.length\r\n    });\r\n\r\n    const cb = containingBlock(node, context.env.viewport);\r\n    node.box.contentWidth = resolveWidthBlock(node, cb.width);\r\n    log(\"layout\", \"debug\", \"Table layout start\", {\r\n      table: node.tagName,\r\n      availableWidth: cb.width,\r\n      resolvedWidth: node.box.contentWidth,\r\n    });\r\n\r\n    const { grid, rowNodes } = this.buildTableGrid(node);\r\n    if (grid.length === 0 || grid[0].length === 0) {\r\n      node.box.contentHeight = 0;\r\n      return;\r\n    }\r\n    const numRows = grid.length;\r\n    const numCols = grid[0].length;\r\n    log(\"layout\", \"debug\", \"Table grid created\", { rows: numRows, cols: numCols });\r\n    const collapsedBorders = node.style.borderModel === BorderModel.Collapse;\r\n\r\n      // Mimic browser border behavior: resolve border styles for each cell\r\n      for (let r = 0; r < numRows; r++) {\r\n        for (let c = 0; c < numCols; c++) {\r\n          const cell = grid[r][c];\r\n          if (!cell || !this.isOriginCell(cell, r, c)) continue;\r\n          const row = cell.parent;\r\n          // Set default border width and color for table cells if not set\r\n          const isTableCell = cell.tagName === 'td' || cell.tagName === 'th';\r\n          if (isTableCell) {\r\n            if (cell.style.borderTop === undefined) cell.style.borderTop = collapsedBorders ? 0 : 1;\r\n            if (cell.style.borderRight === undefined) cell.style.borderRight = collapsedBorders ? 0 : 1;\r\n            if (cell.style.borderBottom === undefined) cell.style.borderBottom = collapsedBorders ? 0 : 1;\r\n            if (cell.style.borderLeft === undefined) cell.style.borderLeft = collapsedBorders ? 0 : 1;\r\n            if (cell.style.borderColor === undefined) cell.style.borderColor = '#000';\r\n          }\r\n          // Inherit from row/table if still not set\r\n          if (cell.style.borderTop === undefined) {\r\n            if (row && row.style.borderTop !== undefined && row.style.borderTop !== 0) {\r\n              cell.style.borderTop = row.style.borderTop;\r\n            } else if (node.style.borderTop !== undefined && node.style.borderTop !== 0) {\r\n              cell.style.borderTop = node.style.borderTop;\r\n            }\r\n          }\r\n          if (cell.style.borderRight === undefined) {\r\n            if (row && row.style.borderRight !== undefined && row.style.borderRight !== 0) {\r\n              cell.style.borderRight = row.style.borderRight;\r\n            } else if (node.style.borderRight !== undefined && node.style.borderRight !== 0) {\r\n              cell.style.borderRight = node.style.borderRight;\r\n            }\r\n          }\r\n          if (cell.style.borderBottom === undefined) {\r\n            if (row && row.style.borderBottom !== undefined && row.style.borderBottom !== 0) {\r\n              cell.style.borderBottom = row.style.borderBottom;\r\n            } else if (node.style.borderBottom !== undefined && node.style.borderBottom !== 0) {\r\n              cell.style.borderBottom = node.style.borderBottom;\r\n            }\r\n          }\r\n          if (cell.style.borderLeft === undefined) {\r\n            if (row && row.style.borderLeft !== undefined && row.style.borderLeft !== 0) {\r\n              cell.style.borderLeft = row.style.borderLeft;\r\n            } else if (node.style.borderLeft !== undefined && node.style.borderLeft !== 0) {\r\n              cell.style.borderLeft = node.style.borderLeft;\r\n            }\r\n          }\r\n          if (cell.style.borderColor === undefined) {\r\n            if (row && row.style.borderColor !== undefined) {\r\n              cell.style.borderColor = row.style.borderColor;\r\n            } else if (node.style.borderColor !== undefined) {\r\n              cell.style.borderColor = node.style.borderColor;\r\n            }\r\n          }\r\n          // Debug log border properties\r\n          log(\"layout\", \"trace\", \"Cell border properties\", {\r\n            row: r,\r\n            col: c,\r\n            borderTop: cell.style.borderTop,\r\n            borderRight: cell.style.borderRight,\r\n            borderBottom: cell.style.borderBottom,\r\n            borderLeft: cell.style.borderLeft,\r\n            borderColor: cell.style.borderColor,\r\n          });\r\n        }\r\n      }\r\n\r\n    if (collapsedBorders) {\r\n      const numericBorder = (value: LengthLike | undefined): number =>\r\n        resolveLength(value, node.box.contentWidth, { auto: \"zero\" });\r\n\r\n      // For collapsed borders, we need to:\r\n      // 1. Collapse borders between adjacent cells (winner takes the shared border)\r\n      // 2. Collapse outer cell borders with table border\r\n      \r\n      // Get table border widths\r\n      const tableBorderTop = numericBorder(node.style.borderTop);\r\n      const tableBorderRight = numericBorder(node.style.borderRight);\r\n      const tableBorderBottom = numericBorder(node.style.borderBottom);\r\n      const tableBorderLeft = numericBorder(node.style.borderLeft);\r\n\r\n      // Collapse table border with outer cells\r\n      for (let c = 0; c < numCols; c++) {\r\n        // Top edge cells collapse with table top border\r\n        const topCell = grid[0][c];\r\n        if (topCell && this.isOriginCell(topCell, 0, c)) {\r\n          const cellTop = numericBorder(topCell.style.borderTop);\r\n          const shared = Math.max(cellTop, tableBorderTop);\r\n          topCell.style.borderTop = shared;\r\n        }\r\n        // Bottom edge cells collapse with table bottom border\r\n        const bottomCell = grid[numRows - 1][c];\r\n        if (bottomCell && this.isOriginCell(bottomCell, numRows - 1, c)) {\r\n          const cellBottom = numericBorder(bottomCell.style.borderBottom);\r\n          const shared = Math.max(cellBottom, tableBorderBottom);\r\n          bottomCell.style.borderBottom = shared;\r\n        }\r\n      }\r\n      for (let r = 0; r < numRows; r++) {\r\n        // Left edge cells collapse with table left border\r\n        const leftCell = grid[r][0];\r\n        if (leftCell && this.isOriginCell(leftCell, r, 0)) {\r\n          const cellLeft = numericBorder(leftCell.style.borderLeft);\r\n          const shared = Math.max(cellLeft, tableBorderLeft);\r\n          leftCell.style.borderLeft = shared;\r\n        }\r\n        // Right edge cells collapse with table right border\r\n        const rightCell = grid[r][numCols - 1];\r\n        if (rightCell && this.isOriginCell(rightCell, r, numCols - 1)) {\r\n          const cellRight = numericBorder(rightCell.style.borderRight);\r\n          const shared = Math.max(cellRight, tableBorderRight);\r\n          rightCell.style.borderRight = shared;\r\n        }\r\n      }\r\n      \r\n      // Clear table border since it's now handled by cells\r\n      node.style.borderTop = 0;\r\n      node.style.borderRight = 0;\r\n      node.style.borderBottom = 0;\r\n      node.style.borderLeft = 0;\r\n\r\n      // Resolve vertical shared borders between adjacent rows\r\n      for (let r = 0; r < numRows - 1; r++) {\r\n        for (let c = 0; c < numCols; c++) {\r\n          const upper = grid[r][c];\r\n          const lower = grid[r + 1][c];\r\n          if (!upper || !lower) continue;\r\n          if (upper === lower) continue;\r\n          if (!this.isRowBoundary(upper, r)) continue;\r\n          const upperBottom = numericBorder(upper.style.borderBottom);\r\n          const lowerTop = numericBorder(lower.style.borderTop);\r\n          const shared = Math.max(upperBottom, lowerTop);\r\n          lower.style.borderTop = shared;\r\n          upper.style.borderBottom = 0;\r\n          if (lower.style.borderColor === undefined && upper.style.borderColor !== undefined) {\r\n            lower.style.borderColor = upper.style.borderColor;\r\n          }\r\n        }\r\n      }\r\n      // Resolve horizontal shared borders between adjacent columns\r\n      for (let r = 0; r < numRows; r++) {\r\n        for (let c = 0; c < numCols - 1; c++) {\r\n          const left = grid[r][c];\r\n          const right = grid[r][c + 1];\r\n          if (!left || !right) continue;\r\n          if (left === right) continue;\r\n          if (!this.isColumnBoundary(left, c)) continue;\r\n          const leftRight = numericBorder(left.style.borderRight);\r\n          const rightLeft = numericBorder(right.style.borderLeft);\r\n          const shared = Math.max(leftRight, rightLeft);\r\n          right.style.borderLeft = shared;\r\n          left.style.borderRight = 0;\r\n          if (right.style.borderColor === undefined && left.style.borderColor !== undefined) {\r\n            right.style.borderColor = left.style.borderColor;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Propagate row background color to cells that don't have their own background\r\n    // This is needed because cells are painted after rows and would cover the row background\r\n    for (let r = 0; r < numRows; r++) {\r\n      const rowNode = rowNodes[r];\r\n      if (!rowNode) continue;\r\n      const rowBgColor = rowNode.style.backgroundColor;\r\n      if (!rowBgColor) continue;\r\n      \r\n      for (let c = 0; c < numCols; c++) {\r\n        const cell = grid[r][c];\r\n        if (!cell || !this.isOriginCell(cell, r, c)) continue;\r\n        // Only propagate if cell doesn't have its own background color\r\n        if (!cell.style.backgroundColor) {\r\n          // Add the row's background color as a color layer\r\n          if (!cell.style.backgroundLayers) {\r\n            cell.style.backgroundLayers = [];\r\n          }\r\n          cell.style.backgroundLayers.push({ kind: 'color', color: rowBgColor });\r\n        }\r\n      }\r\n    }\r\n\r\n    const colWidths = this.calculateColumnWidths(grid, node.box.contentWidth);\r\n    const tableContentWidth = colWidths.reduce((sum, width) => sum + width, 0);\r\n    node.box.contentWidth = tableContentWidth;\r\n    log(\"layout\", \"debug\", \"Table column widths calculated\", { colWidths });\r\n\r\n    const rowHeights = new Array(numRows).fill(0);\r\n    const spanningHeightRequests: { startRow: number; span: number; height: number }[] = [];\r\n    for (let r = 0; r < numRows; r++) {\r\n      for (let c = 0; c < numCols; c++) {\r\n        const cell = grid[r][c];\r\n        if (!cell || !this.isOriginCell(cell, r, c)) continue;\r\n\r\n        const colSpan = Math.min(this.cellColSpan(cell), numCols - c);\r\n        const rowSpan = Math.min(this.cellRowSpan(cell), numRows - r);\r\n        const spannedWidth = this.sumColumns(colWidths, c, colSpan);\r\n\r\n        const boxMetrics = this.resolveCellBoxMetrics(cell, spannedWidth);\r\n        const cellAvailableWidth =\r\n          spannedWidth - boxMetrics.borderLeft - boxMetrics.borderRight - boxMetrics.paddingLeft - boxMetrics.paddingRight;\r\n        cell.box.x = 0;\r\n        cell.box.y = 0;\r\n        cell.box.contentWidth = cellAvailableWidth;\r\n\r\n        debugTableCell(cell);\r\n        layoutTableCell(cell);\r\n        if (cell.textContent?.includes(\"Row 3, Cell 3\")) auditTableCell(cell);\r\n\r\n        for (const child of cell.children) {\r\n          child.box.x = (child.box.x ?? 0) + boxMetrics.paddingLeft;\r\n          child.box.y = (child.box.y ?? 0) + boxMetrics.paddingTop;\r\n        }\r\n\r\n        if (cell.style.textAlign || cell.style.verticalAlign) {\r\n          for (const child of cell.children) {\r\n            if (cell.style.textAlign) child.style.textAlign = cell.style.textAlign;\r\n            if (cell.style.verticalAlign) child.style.verticalAlign = cell.style.verticalAlign;\r\n          }\r\n        }\r\n\r\n        cell.box.contentHeight = cell.box.contentHeight || 0;\r\n        if (cell.children && cell.children.length > 0) {\r\n          let maxChildHeight = 0;\r\n          for (const child of cell.children) {\r\n            maxChildHeight = Math.max(maxChildHeight, child.box.contentHeight || 0);\r\n          }\r\n          cell.box.contentHeight = Math.max(cell.box.contentHeight, maxChildHeight);\r\n        }\r\n\r\n        const cellTotalHeight =\r\n          cell.box.contentHeight + boxMetrics.borderTop + boxMetrics.borderBottom + boxMetrics.paddingTop + boxMetrics.paddingBottom;\r\n\r\n        if (rowSpan === 1) {\r\n          rowHeights[r] = Math.max(rowHeights[r], cellTotalHeight);\r\n        } else {\r\n          spanningHeightRequests.push({ startRow: r, span: rowSpan, height: cellTotalHeight });\r\n        }\r\n      }\r\n    }\r\n\r\n    for (const request of spanningHeightRequests) {\r\n      const share = request.height / request.span;\r\n      for (let offset = 0; offset < request.span; offset++) {\r\n        const targetRow = request.startRow + offset;\r\n        if (targetRow < rowHeights.length) {\r\n          rowHeights[targetRow] = Math.max(rowHeights[targetRow], share);\r\n        }\r\n      }\r\n    }\r\n    log(\"layout\", \"debug\", \"Table row heights calculated\", { rowHeights });\r\n\r\n    const colOffsets = this.prefixSums(colWidths);\r\n    const rowOffsets = this.prefixSums(rowHeights);\r\n\r\n    for (let r = 0; r < numRows; r++) {\r\n      for (let c = 0; c < numCols; c++) {\r\n        const cell = grid[r][c];\r\n\r\n        if (cell && this.isOriginCell(cell, r, c)) {\r\n          const colSpan = Math.min(this.cellColSpan(cell), numCols - c);\r\n          const rowSpan = Math.min(this.cellRowSpan(cell), numRows - r);\r\n          const spanWidth = colOffsets[c + colSpan] - colOffsets[c];\r\n          const spanHeight = rowOffsets[r + rowSpan] - rowOffsets[r];\r\n\r\n          const boxMetrics = this.resolveCellBoxMetrics(cell, spanWidth);\r\n          const availableContentHeight =\r\n            spanHeight - boxMetrics.borderTop - boxMetrics.borderBottom - boxMetrics.paddingTop - boxMetrics.paddingBottom;\r\n          const alignOffsetY = this.computeVerticalAlignOffset(\r\n            cell.style.verticalAlign,\r\n            availableContentHeight,\r\n            cell.box.contentHeight,\r\n          );\r\n\r\n          // Position the cell's border box at the column/row offset\r\n          // The cell's border box starts at colOffsets[c], NOT at the content position\r\n          const borderBoxX = node.box.x + colOffsets[c];\r\n          const borderBoxY = node.box.y + rowOffsets[r];\r\n          \r\n          // Content position is inside border and padding\r\n          const contentX = borderBoxX + boxMetrics.borderLeft + boxMetrics.paddingLeft;\r\n          const contentY = borderBoxY + boxMetrics.borderTop + boxMetrics.paddingTop;\r\n\r\n          // Calculate the offset from the cell's position during layout (which was 0,0)\r\n          const deltaX = contentX - cell.box.x;\r\n          const deltaY = contentY - cell.box.y;\r\n\r\n          // Set cell position to border box position (not content position)\r\n          cell.box.x = borderBoxX;\r\n          cell.box.y = borderBoxY;\r\n\r\n          // Apply the content offset to all of the cell's descendants, plus any vertical-align offset\r\n          cell.walk((descendant) => {\r\n            descendant.box.x += deltaX;\r\n            descendant.box.y += deltaY + alignOffsetY;\r\n            if (descendant.box.baseline !== undefined) {\r\n              descendant.box.baseline += deltaY + alignOffsetY;\r\n            }\r\n          }, false);\r\n\r\n          // Set border box dimensions\r\n          cell.box.borderBoxWidth = spanWidth;\r\n          cell.box.borderBoxHeight = spanHeight;\r\n\r\n          // Debug log for cell position and size\r\n          log(\"layout\", \"trace\", \"Positioning table cell\", {\r\n            row: r,\r\n            col: c,\r\n            x: cell.box.x,\r\n            y: cell.box.y,\r\n            width: cell.box.borderBoxWidth,\r\n            height: cell.box.borderBoxHeight,\r\n            contentWidth: cell.box.contentWidth,\r\n            contentHeight: cell.box.contentHeight,\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    // Position row nodes (<tr>) so their backgrounds render correctly\r\n    for (let r = 0; r < rowNodes.length; r++) {\r\n      const rowNode = rowNodes[r];\r\n      if (rowNode) {\r\n        rowNode.box.x = node.box.x;\r\n        rowNode.box.y = node.box.y + rowOffsets[r];\r\n        rowNode.box.contentWidth = tableContentWidth;\r\n        rowNode.box.contentHeight = rowHeights[r];\r\n        rowNode.box.borderBoxWidth = tableContentWidth;\r\n        rowNode.box.borderBoxHeight = rowHeights[r];\r\n      }\r\n    }\r\n\r\n    node.box.contentHeight = rowOffsets[numRows];\r\n    node.box.borderBoxWidth = node.box.contentWidth + horizontalNonContent(node, cb.width);\r\n    node.box.borderBoxHeight = node.box.contentHeight + verticalNonContent(node, cb.width);\r\n    node.box.scrollWidth = node.box.contentWidth;\r\n    node.box.scrollHeight = node.box.contentHeight;\r\n  }\r\n\r\n  private buildTableGrid(tableNode: LayoutNode): { grid: (LayoutNode | null)[][], rowNodes: LayoutNode[] } {\r\n    const grid: (LayoutNode | null)[][] = [];\r\n    const rowNodes: LayoutNode[] = [];\r\n    const activeRowSpans: { colStart: number; colSpan: number; remainingRows: number; cell: LayoutNode }[] = [];\r\n    let currentRowIndex = -1;\r\n\r\n    const processRow = (rowNode: LayoutNode) => {\r\n      currentRowIndex++;\r\n      rowNodes.push(rowNode);\r\n      const row: (LayoutNode | null)[] = [];\r\n\r\n      for (const span of activeRowSpans) {\r\n        if (span.remainingRows <= 0) continue;\r\n        while (row.length < span.colStart + span.colSpan) row.push(null);\r\n        for (let i = 0; i < span.colSpan; i++) {\r\n          row[span.colStart + i] = span.cell;\r\n        }\r\n        span.remainingRows--;\r\n      }\r\n\r\n      let currentColIndex = 0;\r\n      for (const cellNode of rowNode.children) {\r\n        if (cellNode.style.display === Display.TableCell) {\r\n          while (row[currentColIndex]) currentColIndex++;\r\n\r\n          const colSpan = Math.max(1, cellNode.tableColSpan ?? 1);\r\n          const rowSpan = Math.max(1, cellNode.tableRowSpan ?? 1);\r\n          cellNode.tableColSpan = colSpan;\r\n          cellNode.tableRowSpan = rowSpan;\r\n          cellNode.tableCellOrigin = { row: currentRowIndex, col: currentColIndex };\r\n\r\n          while (row.length < currentColIndex + colSpan) row.push(null);\r\n          for (let i = 0; i < colSpan; i++) {\r\n            row[currentColIndex + i] = cellNode;\r\n          }\r\n\r\n          if (rowSpan > 1) {\r\n            activeRowSpans.push({\r\n              colStart: currentColIndex,\r\n              colSpan,\r\n              remainingRows: rowSpan - 1,\r\n              cell: cellNode,\r\n            });\r\n          }\r\n\r\n          currentColIndex += colSpan;\r\n        }\r\n      }\r\n\r\n      grid.push(row);\r\n      for (let i = activeRowSpans.length - 1; i >= 0; i--) {\r\n        if (activeRowSpans[i].remainingRows <= 0) {\r\n          activeRowSpans.splice(i, 1);\r\n        }\r\n      }\r\n    };\r\n\r\n    for (const child of tableNode.children) {\r\n      if (child.style.display === Display.TableRow) {\r\n        processRow(child);\r\n      } else if (\r\n        [Display.TableRowGroup, Display.TableHeaderGroup, Display.TableFooterGroup].includes(child.style.display)\r\n      ) {\r\n        for (const rowNode of child.children) {\r\n          if (rowNode.style.display === Display.TableRow) {\r\n            processRow(rowNode);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    const maxCols = grid.reduce((max, row) => Math.max(max, row.length), 0);\r\n    grid.forEach((row) => {\r\n      while (row.length < maxCols) row.push(null);\r\n    });\r\n\r\n    return { grid, rowNodes };\r\n  }\r\n\r\n  private calculateColumnWidths(grid: (LayoutNode | null)[][], tableWidth: number): number[] {\r\n    const numCols = grid[0]?.length || 0;\r\n    if (numCols === 0) return [];\r\n\r\n    const minContentWidths = new Array(numCols).fill(0);\r\n\r\n    for (let r = 0; r < grid.length; r++) {\r\n      for (let c = 0; c < numCols; c++) {\r\n        const cell = grid[r][c];\r\n        if (!cell || !this.isOriginCell(cell, r, c)) continue;\r\n\r\n        let maxIntrinsicWidth = 0;\r\n        if (cell.intrinsicInlineSize) {\r\n          maxIntrinsicWidth = cell.intrinsicInlineSize;\r\n        }\r\n        cell.walk((node) => {\r\n          if (node.intrinsicInlineSize !== undefined) {\r\n            maxIntrinsicWidth = Math.max(maxIntrinsicWidth, node.intrinsicInlineSize);\r\n          }\r\n        });\r\n\r\n        const horizontalExtras = horizontalNonContent(cell, tableWidth);\r\n        const cellMinWidth = maxIntrinsicWidth + horizontalExtras;\r\n        const colSpan = Math.min(this.cellColSpan(cell), numCols - c);\r\n\r\n        if (colSpan === 1) {\r\n          minContentWidths[c] = Math.max(minContentWidths[c], cellMinWidth);\r\n        } else {\r\n          const share = cellMinWidth / colSpan;\r\n          for (let offset = 0; offset < colSpan; offset++) {\r\n            minContentWidths[c + offset] = Math.max(minContentWidths[c + offset], share);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    const totalMinWidth = minContentWidths.reduce((a, b) => a + b, 0);\r\n\r\n    if (totalMinWidth < tableWidth) {\r\n      const remainingWidth = tableWidth - totalMinWidth;\r\n      const weights = minContentWidths.map((w) => (w > 0 ? w : totalMinWidth > 0 ? 0 : 1));\r\n      const totalWeight = weights.reduce((a, b) => a + b, 0);\r\n\r\n      if (totalWeight > 0) {\r\n        return minContentWidths.map((minWidth, i) => {\r\n          return minWidth + remainingWidth * (weights[i] / totalWeight);\r\n        });\r\n      } else {\r\n        return new Array(numCols).fill(tableWidth / numCols);\r\n      }\r\n    } else if (totalMinWidth > 0) {\r\n      return minContentWidths;\r\n    } else {\r\n      return new Array(numCols).fill(tableWidth / numCols);\r\n    }\r\n  }\r\n\r\n  private isOriginCell(cell: LayoutNode, row: number, col: number): boolean {\r\n    const origin = cell.tableCellOrigin;\r\n    return !!origin && origin.row === row && origin.col === col;\r\n  }\r\n\r\n  private cellColSpan(cell: LayoutNode): number {\r\n    return Math.max(1, cell.tableColSpan ?? 1);\r\n  }\r\n\r\n  private cellRowSpan(cell: LayoutNode): number {\r\n    return Math.max(1, cell.tableRowSpan ?? 1);\r\n  }\r\n\r\n  private isColumnBoundary(cell: LayoutNode, column: number): boolean {\r\n    const origin = cell.tableCellOrigin;\r\n    if (!origin) return false;\r\n    return origin.col + this.cellColSpan(cell) - 1 === column;\r\n  }\r\n\r\n  private isRowBoundary(cell: LayoutNode, row: number): boolean {\r\n    const origin = cell.tableCellOrigin;\r\n    if (!origin) return false;\r\n    return origin.row + this.cellRowSpan(cell) - 1 === row;\r\n  }\r\n\r\n  private sumColumns(colWidths: number[], start: number, span: number): number {\r\n    let total = 0;\r\n    for (let i = 0; i < span; i++) {\r\n      total += colWidths[start + i] ?? 0;\r\n    }\r\n    return total;\r\n  }\r\n\r\n  private prefixSums(values: number[]): number[] {\r\n    const offsets = [0];\r\n    for (const value of values) {\r\n      offsets.push(offsets[offsets.length - 1] + value);\r\n    }\r\n    return offsets;\r\n  }\r\n\r\n  private resolveCellBoxMetrics(\r\n    cell: LayoutNode,\r\n    referenceWidth: number,\r\n  ): {\r\n    borderLeft: number;\r\n    borderRight: number;\r\n    borderTop: number;\r\n    borderBottom: number;\r\n    paddingLeft: number;\r\n    paddingRight: number;\r\n    paddingTop: number;\r\n    paddingBottom: number;\r\n  } {\r\n    const resolve = (value: LengthLike | undefined) => resolveLength(value, referenceWidth, { auto: \"zero\" });\r\n    return {\r\n      borderLeft: resolve(cell.style.borderLeft),\r\n      borderRight: resolve(cell.style.borderRight),\r\n      borderTop: resolve(cell.style.borderTop),\r\n      borderBottom: resolve(cell.style.borderBottom),\r\n      paddingLeft: resolve(cell.style.paddingLeft),\r\n      paddingRight: resolve(cell.style.paddingRight),\r\n      paddingTop: resolve(cell.style.paddingTop),\r\n      paddingBottom: resolve(cell.style.paddingBottom),\r\n    };\r\n  }\r\n\r\n  private computeVerticalAlignOffset(verticalAlign: string | undefined, available: number, content: number): number {\r\n    const usedContent = Math.max(0, content ?? 0);\r\n    const free = available - usedContent;\r\n    if (!Number.isFinite(free) || free <= 0) return 0;\r\n\r\n    const keyword = (verticalAlign ?? \"top\").toLowerCase();\r\n    if (keyword === \"middle\" || keyword === \"center\") {\r\n      return free / 2;\r\n    }\r\n    if (keyword === \"bottom\" || keyword === \"text-bottom\") {\r\n      return free;\r\n    }\r\n    return 0;\r\n  }\r\n}\r\n", "import { LayoutNode } from \"../../dom/node.js\";\nimport type { LayoutContext, LayoutStrategy } from \"../pipeline/strategy.js\";\n\nexport class FallbackStrategy implements LayoutStrategy {\n  canLayout(): boolean {\n    return true;\n  }\n\n  layout(node: LayoutNode, _context: LayoutContext): void {\n    node.box.contentWidth = 0;\n    node.box.contentHeight = 0;\n    node.box.borderBoxWidth = 0;\n    node.box.borderBoxHeight = 0;\n  }\n}\n", "import { LayoutNode } from \"../../dom/node.js\";\r\nimport { Display, FloatMode } from \"../../css/enums.js\";\r\nimport { resolveLength } from \"../../css/length.js\";\r\nimport { resolvedLineHeight } from \"../../css/style.js\";\r\nimport type { LayoutContext, LayoutStrategy } from \"../pipeline/strategy.js\";\r\nimport { FloatContext } from \"../context/float-context.js\";\r\nimport { defaultInlineFormatter } from \"../utils/inline-formatter.js\";\r\n\r\nexport class InlineLayoutStrategy implements LayoutStrategy {\r\n  canLayout(node: LayoutNode): boolean {\r\n    return node.style.display === Display.Inline;\r\n  }\r\n\r\n  layout(node: LayoutNode, context: LayoutContext): void {\r\n    const refWidth = Math.max(context.env.viewport.width, 0);\r\n    const paddingLeft = resolveLength(node.style.paddingLeft, refWidth, { auto: \"zero\" });\r\n    const paddingRight = resolveLength(node.style.paddingRight, refWidth, { auto: \"zero\" });\r\n    const paddingTop = resolveLength(node.style.paddingTop, refWidth, { auto: \"zero\" });\r\n    const paddingBottom = resolveLength(node.style.paddingBottom, refWidth, { auto: \"zero\" });\r\n    const borderLeft = resolveLength(node.style.borderLeft, refWidth, { auto: \"zero\" });\r\n    const borderRight = resolveLength(node.style.borderRight, refWidth, { auto: \"zero\" });\r\n    const borderTop = resolveLength(node.style.borderTop, refWidth, { auto: \"zero\" });\r\n    const borderBottom = resolveLength(node.style.borderBottom, refWidth, { auto: \"zero\" });\r\n\r\n    const marginLeft = resolveLength(node.style.marginLeft, refWidth, { auto: \"zero\" });\r\n    const marginRight = resolveLength(node.style.marginRight, refWidth, { auto: \"zero\" });\r\n    const marginTop = resolveLength(node.style.marginTop, refWidth, { auto: \"zero\" });\r\n    const marginBottom = resolveLength(node.style.marginBottom, refWidth, { auto: \"zero\" });\r\n\r\n    const horizontalExtras = paddingLeft + paddingRight + borderLeft + borderRight;\r\n    const verticalExtras = paddingTop + paddingBottom + borderTop + borderBottom;\r\n\r\n    const inlineNodes = collectInlineParticipants(node);\r\n    const floatContext = new FloatContext();\r\n    const startY = node.box.y;\r\n    const availableWidth = Math.max(refWidth, 0);\r\n\r\n    const result = defaultInlineFormatter.layout({\r\n      container: node,\r\n      inlineNodes,\r\n      context,\r\n      floatContext,\r\n      contentX: node.box.x + borderLeft + paddingLeft,\r\n      contentWidth: availableWidth,\r\n      startY,\r\n    });\r\n\r\n    const extent = measureInlineExtent(inlineNodes, refWidth, node.box.x + borderLeft + paddingLeft);\r\n    const floatBottom = Math.max(floatContext.bottom(\"left\"), floatContext.bottom(\"right\"));\r\n    const measuredHeight = Math.max(result.newCursorY, floatBottom) - startY;\r\n\r\n    node.box.contentWidth = Math.max(0, extent);\r\n    node.box.contentHeight = Math.max(0, measuredHeight);\r\n    node.box.borderBoxWidth = node.box.contentWidth + horizontalExtras;\r\n    node.box.borderBoxHeight = node.box.contentHeight + verticalExtras;\r\n    node.box.marginBoxWidth = node.box.borderBoxWidth + marginLeft + marginRight;\r\n    node.box.marginBoxHeight = node.box.borderBoxHeight + marginTop + marginBottom;\r\n    node.box.scrollWidth = Math.max(node.box.scrollWidth, node.box.contentWidth);\r\n    node.box.scrollHeight = Math.max(node.box.scrollHeight, node.box.contentHeight);\r\n    if (node.box.baseline === undefined) {\r\n      node.box.baseline = node.box.y + node.box.contentHeight || node.box.y + resolvedLineHeight(node.style);\r\n    }\r\n  }\r\n}\r\n\r\nfunction collectInlineParticipants(node: LayoutNode): LayoutNode[] {\r\n  const participants: LayoutNode[] = [];\r\n  for (const child of node.children) {\r\n    if (child.style.display === Display.None) {\r\n      continue;\r\n    }\r\n    if (child.style.float !== FloatMode.None) {\r\n      continue;\r\n    }\r\n    if (!isInlineDisplay(child.style.display)) {\r\n      continue;\r\n    }\r\n    participants.push(child);\r\n  }\r\n  return participants;\r\n}\r\n\r\nfunction isInlineDisplay(display: Display): boolean {\r\n  switch (display) {\r\n    case Display.Inline:\r\n    case Display.InlineBlock:\r\n    case Display.InlineFlex:\r\n    case Display.InlineGrid:\r\n    case Display.InlineTable:\r\n      return true;\r\n    default:\r\n      return false;\r\n  }\r\n}\r\n\r\nfunction measureInlineExtent(inlineNodes: LayoutNode[], referenceWidth: number, contentStartX: number): number {\r\n  if (inlineNodes.length === 0) {\r\n    return 0;\r\n  }\r\n  let minStart = Number.POSITIVE_INFINITY;\r\n  let maxEnd = Number.NEGATIVE_INFINITY;\r\n  for (const node of inlineNodes) {\r\n    const marginLeft = resolveLength(node.style.marginLeft, referenceWidth, { auto: \"zero\" });\r\n    const marginRight = resolveLength(node.style.marginRight, referenceWidth, { auto: \"zero\" });\r\n    const paddingLeft = resolveLength(node.style.paddingLeft, referenceWidth, { auto: \"zero\" });\r\n    const paddingRight = resolveLength(node.style.paddingRight, referenceWidth, { auto: \"zero\" });\r\n    const borderLeft = resolveLength(node.style.borderLeft, referenceWidth, { auto: \"zero\" });\r\n    const borderRight = resolveLength(node.style.borderRight, referenceWidth, { auto: \"zero\" });\r\n\r\n    const marginStart = node.box.x - paddingLeft - borderLeft - marginLeft;\r\n    const width =\r\n      node.box.contentWidth +\r\n      paddingLeft +\r\n      paddingRight +\r\n      borderLeft +\r\n      borderRight +\r\n      marginLeft +\r\n      marginRight;\r\n    const relativeStart = marginStart - contentStartX;\r\n    const relativeEnd = relativeStart + width;\r\n    minStart = Math.min(minStart, relativeStart);\r\n    maxEnd = Math.max(maxEnd, relativeEnd);\r\n  }\r\n  if (!Number.isFinite(minStart) || !Number.isFinite(maxEnd)) {\r\n    return 0;\r\n  }\r\n  return Math.max(0, maxEnd - minStart);\r\n}\r\n", "import { LayoutNode } from \"../../dom/node.js\";\r\nimport { Display } from \"../../css/enums.js\";\r\nimport { resolveLength, isAutoLength } from \"../../css/length.js\";\r\nimport type { ImageInfo } from \"../../image/types.js\";\r\nimport { containingBlock, horizontalNonContent, horizontalMargin } from \"../utils/node-math.js\";\r\nimport type { LayoutContext, LayoutStrategy } from \"../pipeline/strategy.js\";\r\n\r\n/**\r\n * Image strategy following SOLID principles:\r\n * - Single Responsibility: Handles image layout and sizing\r\n * - Open/Closed: Extensible for different image types\r\n * - Dependency Inversion: Depends on abstractions\r\n */\r\nexport class ImageStrategy {\r\n  /**\r\n   * Processes an image element and sets up its intrinsic dimensions\r\n   */\r\n  public static processImage(node: LayoutNode, imageInfo: ImageInfo): void {\r\n    // Set intrinsic dimensions from the image\r\n    node.intrinsicInlineSize = imageInfo.width;\r\n    node.intrinsicBlockSize = imageInfo.height;\r\n    \r\n    // Set default display properties for images\r\n    if (!node.style.display || node.style.display === Display.Inline) {\r\n      node.style.display = Display.InlineBlock;\r\n    }\r\n    \r\n    // Handle image sizing\r\n    this.setupImageSizing(node, imageInfo);\r\n  }\r\n\r\n  /**\r\n   * Sets up image sizing based on CSS properties\r\n   */\r\n  private static setupImageSizing(node: LayoutNode, _imageInfo: ImageInfo): void {\r\n    // If width is explicitly set, calculate proportional height\r\n    if (node.style.width !== undefined && typeof node.style.width === 'number' && node.style.width > 0) {\r\n      const specifiedWidth = resolveLength(node.style.width, node.intrinsicInlineSize!, { auto: \"zero\" });\r\n      const scale = specifiedWidth / node.intrinsicInlineSize!;\r\n      node.intrinsicBlockSize = Math.round(node.intrinsicBlockSize! * scale);\r\n    }\r\n    // If height is explicitly set, calculate proportional width\r\n    else if (node.style.height !== undefined && typeof node.style.height === 'number' && node.style.height > 0) {\r\n      const specifiedHeight = resolveLength(node.style.height, node.intrinsicBlockSize!, { auto: \"zero\" });\r\n      const scale = specifiedHeight / node.intrinsicBlockSize!;\r\n      node.intrinsicInlineSize = Math.round(node.intrinsicInlineSize! * scale);\r\n    }\r\n    // Handle max-width constraints\r\n    else if (node.style.maxWidth !== undefined && typeof node.style.maxWidth === 'number') {\r\n      const maxWidth = resolveLength(node.style.maxWidth, node.intrinsicInlineSize!, { auto: \"zero\" });\r\n      if (maxWidth < node.intrinsicInlineSize!) {\r\n        const scale = maxWidth / node.intrinsicInlineSize!;\r\n        node.intrinsicInlineSize = maxWidth;\r\n        node.intrinsicBlockSize = Math.round(node.intrinsicBlockSize! * scale);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Determines if an element should be treated as an image\r\n  */\r\n  public static isImageElement(element: LayoutNode): boolean {\r\n    if (!element.tagName) {\r\n      return Boolean(element.textContent && element.textContent.includes(\"data:image\"));\r\n    }\r\n    const tag = element.tagName.toLowerCase();\r\n    if (tag === \"img\" || tag === \"picture\") {\r\n      return true;\r\n    }\r\n    return Boolean(element.textContent && element.textContent.includes(\"data:image\"));\r\n  }\r\n}\r\n\r\n/**\r\n * Determines the object-fit behavior for images\r\n */\r\nexport function determineObjectFit(node: LayoutNode): 'contain' | 'cover' | 'fill' | 'none' | 'scale-down' {\r\n  const style = node.style;\r\n  \r\n  // Check for explicit object-fit property\r\n  if (style.objectFit) {\r\n    return style.objectFit;\r\n  }\r\n  \r\n  // Default behavior based on CSS specification\r\n  if (style.width && style.height) {\r\n    return 'fill';\r\n  }\r\n\r\n  // Check background layers for size information\r\n  if (style.backgroundLayers) {\r\n    for (let i = style.backgroundLayers.length - 1; i >= 0; i--) {\r\n      const layer = style.backgroundLayers[i];\r\n      if (layer.kind === 'image' && layer.size) {\r\n        if (layer.size === 'contain') return 'contain';\r\n        if (layer.size === 'cover') return 'cover';\r\n      }\r\n    }\r\n  }\r\n  \r\n  return 'contain';\r\n}\r\n\r\n/**\r\n * Calculates image position for object-fit positioning\r\n */\r\nexport function calculateImagePosition(\r\n  node: LayoutNode,\r\n  containerWidth: number,\r\n  containerHeight: number,\r\n  imageWidth: number,\r\n  imageHeight: number,\r\n  objectFit: 'contain' | 'cover' | 'fill' | 'none' | 'scale-down'\r\n): { x: number; y: number; width: number; height: number } {\r\n  let x = 0;\r\n  let y = 0;\r\n  let width = imageWidth;\r\n  let height = imageHeight;\r\n\r\n  switch (objectFit) {\r\n    case 'contain':\r\n      const containScale = Math.min(\r\n        containerWidth / imageWidth,\r\n        containerHeight / imageHeight\r\n      );\r\n      width = imageWidth * containScale;\r\n      height = imageHeight * containScale;\r\n      x = (containerWidth - width) / 2;\r\n      y = (containerHeight - height) / 2;\r\n      break;\r\n\r\n    case 'cover':\r\n      const coverScale = Math.max(\r\n        containerWidth / imageWidth,\r\n        containerHeight / imageHeight\r\n      );\r\n      width = imageWidth * coverScale;\r\n      height = imageHeight * coverScale;\r\n      x = (containerWidth - width) / 2;\r\n      y = (containerHeight - height) / 2;\r\n      break;\r\n\r\n    case 'fill':\r\n      // Use the specified dimensions if available\r\n      width = node.style.width ? resolveLength(node.style.width, containerWidth, { auto: \"zero\" }) : containerWidth;\r\n      height = node.style.height ? resolveLength(node.style.height, containerHeight, { auto: \"zero\" }) : containerHeight;\r\n      break;\r\n\r\n    case 'none':\r\n      // Use original image size\r\n      width = imageWidth;\r\n      height = imageHeight;\r\n      x = (containerWidth - width) / 2;\r\n      y = (containerHeight - height) / 2;\r\n      break;\r\n\r\n    case 'scale-down':\r\n      const imageScale = Math.min(\r\n        containerWidth / imageWidth,\r\n        containerHeight / imageHeight\r\n      );\r\n      width = imageWidth * imageScale;\r\n      height = imageHeight * imageScale;\r\n      x = (containerWidth - width) / 2;\r\n      y = (containerHeight - height) / 2;\r\n      break;\r\n  }\r\n\r\n  return { x, y, width, height };\r\n}\r\n\r\nexport class ImageLayoutStrategy implements LayoutStrategy {\r\n  canLayout(node: LayoutNode): boolean {\r\n    const tag = node.tagName?.toLowerCase() ?? \"\";\r\n    if (tag === \"img\") {\r\n      return true;\r\n    }\r\n    if (tag === \"svg\") {\r\n      return Boolean(node.customData && \"svg\" in node.customData);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  layout(node: LayoutNode, context: LayoutContext): void {\r\n    const cb = containingBlock(node, context.env.viewport);\r\n    const widthRef = Math.max(cb.width, 0);\r\n    const heightRef = Math.max(cb.height, 0);\r\n\r\n    const intrinsicWidth = Math.max(0, node.intrinsicInlineSize ?? 0);\r\n    const intrinsicHeight = Math.max(0, node.intrinsicBlockSize ?? 0);\r\n    const hasIntrinsic = intrinsicWidth > 0 && intrinsicHeight > 0;\r\n\r\n    const paddingLeft = resolveLength(node.style.paddingLeft, widthRef, { auto: \"zero\" });\r\n    const paddingRight = resolveLength(node.style.paddingRight, widthRef, { auto: \"zero\" });\r\n    const paddingTop = resolveLength(node.style.paddingTop, heightRef, { auto: \"zero\" });\r\n    const paddingBottom = resolveLength(node.style.paddingBottom, heightRef, { auto: \"zero\" });\r\n\r\n    const borderLeft = resolveLength(node.style.borderLeft, widthRef, { auto: \"zero\" });\r\n    const borderRight = resolveLength(node.style.borderRight, widthRef, { auto: \"zero\" });\r\n    const borderTop = resolveLength(node.style.borderTop, heightRef, { auto: \"zero\" });\r\n    const borderBottom = resolveLength(node.style.borderBottom, heightRef, { auto: \"zero\" });\r\n\r\n    const marginLeft = resolveLength(node.style.marginLeft, widthRef, { auto: \"zero\" });\r\n    const marginRight = resolveLength(node.style.marginRight, widthRef, { auto: \"zero\" });\r\n    const marginTop = resolveLength(node.style.marginTop, heightRef, { auto: \"zero\" });\r\n    const marginBottom = resolveLength(node.style.marginBottom, heightRef, { auto: \"zero\" });\r\n\r\n    const horizontalExtras = paddingLeft + paddingRight + borderLeft + borderRight;\r\n    const verticalExtras = paddingTop + paddingBottom + borderTop + borderBottom;\r\n    const availableContentWidth = Math.max(\r\n      0,\r\n      widthRef - horizontalNonContent(node, widthRef) - horizontalMargin(node, widthRef),\r\n    );\r\n\r\n    const hasExplicitWidth = node.style.width !== \"auto\" && node.style.width !== undefined;\r\n    const hasExplicitHeight = node.style.height !== \"auto\" && node.style.height !== undefined;\r\n\r\n    let contentWidth = hasIntrinsic ? intrinsicWidth : availableContentWidth;\r\n    let contentHeight = hasIntrinsic ? intrinsicHeight : 0;\r\n\r\n    if (hasExplicitWidth) {\r\n      const resolved = resolveLength(node.style.width, widthRef, { auto: \"reference\" });\r\n      if (Number.isFinite(resolved) && resolved > 0) {\r\n        contentWidth = resolved;\r\n      }\r\n    }\r\n\r\n    if (hasExplicitHeight) {\r\n      const resolved = resolveLength(node.style.height, heightRef, { auto: \"reference\" });\r\n      if (Number.isFinite(resolved) && resolved > 0) {\r\n        contentHeight = resolved;\r\n      }\r\n    }\r\n\r\n    if (hasIntrinsic) {\r\n      if (hasExplicitWidth && !hasExplicitHeight) {\r\n        const scale = intrinsicWidth > 0 ? contentWidth / intrinsicWidth : 1;\r\n        contentHeight = Math.max(1, Math.round(intrinsicHeight * scale));\r\n      } else if (!hasExplicitWidth && hasExplicitHeight) {\r\n        const scale = intrinsicHeight > 0 ? contentHeight / intrinsicHeight : 1;\r\n        contentWidth = Math.max(1, Math.round(intrinsicWidth * scale));\r\n      } else if (!hasExplicitWidth && !hasExplicitHeight) {\r\n        contentWidth = intrinsicWidth;\r\n        contentHeight = intrinsicHeight;\r\n      }\r\n    }\r\n\r\n    if (!hasExplicitWidth && availableContentWidth > 0 && contentWidth > availableContentWidth) {\r\n      if (hasIntrinsic && contentWidth > 0) {\r\n        const scale = availableContentWidth / contentWidth;\r\n        contentWidth = availableContentWidth;\r\n        contentHeight = Math.max(1, Math.round(contentHeight * scale));\r\n      } else {\r\n        contentWidth = availableContentWidth;\r\n      }\r\n    }\r\n\r\n    // Apply max-width / min-width constraints while maintaining aspect ratio when possible.\r\n    const lockAspectToWidth = hasIntrinsic && !hasExplicitHeight;\r\n    const lockAspectToHeight = hasIntrinsic && !hasExplicitWidth;\r\n\r\n    if (node.style.maxWidth !== undefined && !isAutoLength(node.style.maxWidth)) {\r\n      const maxWidth = resolveLength(node.style.maxWidth, widthRef, { auto: \"reference\" });\r\n      if (Number.isFinite(maxWidth) && maxWidth > 0 && contentWidth > maxWidth) {\r\n        if (lockAspectToWidth && contentWidth > 0) {\r\n          const scale = maxWidth / contentWidth;\r\n          contentHeight = Math.max(1, Math.round(contentHeight * scale));\r\n        }\r\n        contentWidth = maxWidth;\r\n      }\r\n    }\r\n\r\n    if (node.style.minWidth !== undefined && !isAutoLength(node.style.minWidth)) {\r\n      const minWidth = resolveLength(node.style.minWidth, widthRef, { auto: \"zero\" });\r\n      if (Number.isFinite(minWidth) && minWidth > 0 && contentWidth < minWidth) {\r\n        if (lockAspectToWidth && contentWidth > 0) {\r\n          const scale = minWidth / contentWidth;\r\n          contentHeight = Math.max(1, Math.round(contentHeight * scale));\r\n        }\r\n        contentWidth = minWidth;\r\n      }\r\n    }\r\n\r\n    if (node.style.maxHeight !== undefined && !isAutoLength(node.style.maxHeight)) {\r\n      const maxHeight = resolveLength(node.style.maxHeight, heightRef, { auto: \"reference\" });\r\n      if (Number.isFinite(maxHeight) && maxHeight > 0 && contentHeight > maxHeight) {\r\n        if (lockAspectToHeight && contentHeight > 0) {\r\n          const scale = maxHeight / contentHeight;\r\n          contentWidth = Math.max(1, Math.round(contentWidth * scale));\r\n        }\r\n        contentHeight = maxHeight;\r\n      }\r\n    }\r\n\r\n    if (node.style.minHeight !== undefined && !isAutoLength(node.style.minHeight)) {\r\n      const minHeight = resolveLength(node.style.minHeight, heightRef, { auto: \"zero\" });\r\n      if (Number.isFinite(minHeight) && minHeight > 0 && contentHeight < minHeight) {\r\n        if (lockAspectToHeight && contentHeight > 0) {\r\n          const scale = minHeight / contentHeight;\r\n          contentWidth = Math.max(1, Math.round(contentWidth * scale));\r\n        }\r\n        contentHeight = minHeight;\r\n      }\r\n    }\r\n\r\n    if (!Number.isFinite(contentWidth) || contentWidth <= 0) {\r\n      contentWidth = Math.max(availableContentWidth, hasIntrinsic ? intrinsicWidth : 0);\r\n    }\r\n    if (!Number.isFinite(contentHeight) || contentHeight <= 0) {\r\n      if (hasIntrinsic && contentWidth > 0 && intrinsicWidth > 0) {\r\n        const scale = contentWidth / intrinsicWidth;\r\n        contentHeight = Math.max(1, Math.round(intrinsicHeight * scale));\r\n      } else {\r\n        contentHeight = contentWidth; // square fallback\r\n      }\r\n    }\r\n\r\n    node.box.contentWidth = Math.max(0, contentWidth);\r\n    node.box.contentHeight = Math.max(0, contentHeight);\r\n    node.box.borderBoxWidth = node.box.contentWidth + horizontalExtras;\r\n    node.box.borderBoxHeight = node.box.contentHeight + verticalExtras;\r\n    node.box.marginBoxWidth = node.box.borderBoxWidth + marginLeft + marginRight;\r\n    node.box.marginBoxHeight = node.box.borderBoxHeight + marginTop + marginBottom;\r\n    node.box.scrollWidth = node.box.contentWidth;\r\n    node.box.scrollHeight = node.box.contentHeight;\r\n    node.box.baseline = node.box.borderBoxHeight;\r\n\r\n    // For block-level images, ensure they do not exceed the available space.\r\n    if (node.style.display === Display.Block && node.box.contentWidth > availableContentWidth && availableContentWidth > 0) {\r\n      const scale = availableContentWidth / node.box.contentWidth;\r\n      node.box.contentWidth = availableContentWidth;\r\n      node.box.contentHeight = Math.max(1, Math.round(node.box.contentHeight * scale));\r\n      node.box.borderBoxWidth = node.box.contentWidth + horizontalExtras;\r\n      node.box.borderBoxHeight = node.box.contentHeight + verticalExtras;\r\n      node.box.marginBoxWidth = node.box.borderBoxWidth + marginLeft + marginRight;\r\n      node.box.marginBoxHeight = node.box.borderBoxHeight + marginTop + marginBottom;\r\n      node.box.scrollWidth = node.box.contentWidth;\r\n      node.box.scrollHeight = node.box.contentHeight;\r\n      node.box.baseline = node.box.borderBoxHeight;\r\n    }\r\n  }\r\n}\r\n", "import { LayoutEngine } from \"./engine.js\";\r\nimport type { LayoutStrategy } from \"./strategy.js\";\r\nimport { DisplayNoneStrategy } from \"../strategies/display-none.js\";\r\nimport { BlockLayoutStrategy } from \"../strategies/block.js\";\nimport { FlexLayoutStrategy } from \"../strategies/flex.js\";\nimport { GridLayoutStrategy } from \"../strategies/grid.js\";\nimport { TableLayoutStrategy } from \"../strategies/table.js\";\nimport { FallbackStrategy } from \"../strategies/fallback.js\";\nimport { InlineLayoutStrategy } from \"../strategies/inline.js\";\nimport { ImageLayoutStrategy } from \"../strategies/image.js\";\n\r\nexport function createDefaultLayoutEngine(): LayoutEngine {\r\n  const strategies: LayoutStrategy[] = [\r\n    new DisplayNoneStrategy(),\r\n    new ImageLayoutStrategy(),\n    new InlineLayoutStrategy(),\n    new BlockLayoutStrategy(),\r\n    new FlexLayoutStrategy(),\r\n    new GridLayoutStrategy(),\r\n    new TableLayoutStrategy(),\r\n    new FallbackStrategy(),\r\n  ];\r\n  return new LayoutEngine({ strategies });\r\n}\r\n", "import { LayoutNode } from \"../../dom/node.js\";\r\nimport type { Viewport } from \"../../geometry/box.js\";\r\nimport { createDefaultLayoutEngine } from \"./default-engine.js\";\r\nimport type { FontEmbedder } from \"../../pdf/font/embedder.js\";\r\n\r\nexport function layoutTree(\r\n  root: LayoutNode,\r\n  viewport: Viewport,\r\n  fontEmbedder: FontEmbedder | null = null\r\n): LayoutNode {\r\n  const engine = createDefaultLayoutEngine();\r\n  return engine.layoutTree(root, viewport, fontEmbedder);\r\n}\r\n", "export const NAMED_COLORS: Record<string, string> = {\r\n  \"aliceblue\": \"#f0f8ff\",\r\n  \"antiquewhite\": \"#faebd7\",\r\n  \"aqua\": \"#00ffff\",\r\n  \"aquamarine\": \"#7fffd4\",\r\n  \"azure\": \"#f0ffff\",\r\n  \"beige\": \"#f5f5dc\",\r\n  \"bisque\": \"#ffe4c4\",\r\n  \"black\": \"#000000\",\r\n  \"blanchedalmond\": \"#ffebcd\",\r\n  \"blue\": \"#0000ff\",\r\n  \"blueviolet\": \"#8a2be2\",\r\n  \"brown\": \"#a52a2a\",\r\n  \"burlywood\": \"#deb887\",\r\n  \"cadetblue\": \"#5f9ea0\",\r\n  \"chartreuse\": \"#7fff00\",\r\n  \"chocolate\": \"#d2691e\",\r\n  \"coral\": \"#ff7f50\",\r\n  \"cornflowerblue\": \"#6495ed\",\r\n  \"cornsilk\": \"#fff8dc\",\r\n  \"crimson\": \"#dc143c\",\r\n  \"cyan\": \"#00ffff\",\r\n  \"darkblue\": \"#00008b\",\r\n  \"darkcyan\": \"#008b8b\",\r\n  \"darkgoldenrod\": \"#b8860b\",\r\n  \"darkgray\": \"#a9a9a9\",\r\n  \"darkgreen\": \"#006400\",\r\n  \"darkgrey\": \"#a9a9a9\",\r\n  \"darkkhaki\": \"#bdb76b\",\r\n  \"darkmagenta\": \"#8b008b\",\r\n  \"darkolivegreen\": \"#556b2f\",\r\n  \"darkorange\": \"#ff8c00\",\r\n  \"darkorchid\": \"#9932cc\",\r\n  \"darkred\": \"#8b0000\",\r\n  \"darksalmon\": \"#e9967a\",\r\n  \"darkseagreen\": \"#8fbc8f\",\r\n  \"darkslateblue\": \"#483d8b\",\r\n  \"darkslategray\": \"#2f4f4f\",\r\n  \"darkslategrey\": \"#2f4f4f\",\r\n  \"darkturquoise\": \"#00ced1\",\r\n  \"darkviolet\": \"#9400d3\",\r\n  \"deeppink\": \"#ff1493\",\r\n  \"deepskyblue\": \"#00bfff\",\r\n  \"dimgray\": \"#696969\",\r\n  \"dimgrey\": \"#696969\",\r\n  \"dodgerblue\": \"#1e90ff\",\r\n  \"firebrick\": \"#b22222\",\r\n  \"floralwhite\": \"#fffaf0\",\r\n  \"forestgreen\": \"#228b22\",\r\n  \"fuchsia\": \"#ff00ff\",\r\n  \"gainsboro\": \"#dcdcdc\",\r\n  \"ghostwhite\": \"#f8f8ff\",\r\n  \"gold\": \"#ffd700\",\r\n  \"goldenrod\": \"#daa520\",\r\n  \"gray\": \"#808080\",\r\n  \"green\": \"#008000\",\r\n  \"greenyellow\": \"#adff2f\",\r\n  \"grey\": \"#808080\",\r\n  \"honeydew\": \"#f0fff0\",\r\n  \"hotpink\": \"#ff69b4\",\r\n  \"indianred\": \"#cd5c5c\",\r\n  \"indigo\": \"#4b0082\",\r\n  \"ivory\": \"#fffff0\",\r\n  \"khaki\": \"#f0e68c\",\r\n  \"lavender\": \"#e6e6fa\",\r\n  \"lavenderblush\": \"#fff0f5\",\r\n  \"lawngreen\": \"#7cfc00\",\r\n  \"lemonchiffon\": \"#fffacd\",\r\n  \"lightblue\": \"#add8e6\",\r\n  \"lightcoral\": \"#f08080\",\r\n  \"lightcyan\": \"#e0ffff\",\r\n  \"lightgoldenrodyellow\": \"#fafad2\",\r\n  \"lightgray\": \"#d3d3d3\",\r\n  \"lightgreen\": \"#90ee90\",\r\n  \"lightgrey\": \"#d3d3d3\",\r\n  \"lightpink\": \"#ffb6c1\",\r\n  \"lightsalmon\": \"#ffa07a\",\r\n  \"lightseagreen\": \"#20b2aa\",\r\n  \"lightskyblue\": \"#87cefa\",\r\n  \"lightslategray\": \"#778899\",\r\n  \"lightslategrey\": \"#778899\",\r\n  \"lightsteelblue\": \"#b0c4de\",\r\n  \"lightyellow\": \"#ffffe0\",\r\n  \"lime\": \"#00ff00\",\r\n  \"limegreen\": \"#32cd32\",\r\n  \"linen\": \"#faf0e6\",\r\n  \"magenta\": \"#ff00ff\",\r\n  \"maroon\": \"#800000\",\r\n  \"mediumaquamarine\": \"#66cdaa\",\r\n  \"mediumblue\": \"#0000cd\",\r\n  \"mediumorchid\": \"#ba55d3\",\r\n  \"mediumpurple\": \"#9370db\",\r\n  \"mediumseagreen\": \"#3cb371\",\r\n  \"mediumslateblue\": \"#7b68ee\",\r\n  \"mediumspringgreen\": \"#00fa9a\",\r\n  \"mediumturquoise\": \"#48d1cc\",\r\n  \"mediumvioletred\": \"#c71585\",\r\n  \"midnightblue\": \"#191970\",\r\n  \"mintcream\": \"#f5fffa\",\r\n  \"mistyrose\": \"#ffe4e1\",\r\n  \"moccasin\": \"#ffe4b5\",\r\n  \"navajowhite\": \"#ffdead\",\r\n  \"navy\": \"#000080\",\r\n  \"oldlace\": \"#fdf5e6\",\r\n  \"olive\": \"#808000\",\r\n  \"olivedrab\": \"#6b8e23\",\r\n  \"orange\": \"#ffa500\",\r\n  \"orangered\": \"#ff4500\",\r\n  \"orchid\": \"#da70d6\",\r\n  \"palegoldenrod\": \"#eee8aa\",\r\n  \"palegreen\": \"#98fb98\",\r\n  \"paleturquoise\": \"#afeeee\",\r\n  \"palevioletred\": \"#db7093\",\r\n  \"papayawhip\": \"#ffefd5\",\r\n  \"peachpuff\": \"#ffdab9\",\r\n  \"peru\": \"#cd853f\",\r\n  \"pink\": \"#ffc0cb\",\r\n  \"plum\": \"#dda0dd\",\r\n  \"powderblue\": \"#b0e0e6\",\r\n  \"purple\": \"#800080\",\r\n  \"rebeccapurple\": \"#663399\",\r\n  \"red\": \"#ff0000\",\r\n  \"rosybrown\": \"#bc8f8f\",\r\n  \"royalblue\": \"#4169e1\",\r\n  \"saddlebrown\": \"#8b4513\",\r\n  \"salmon\": \"#fa8072\",\r\n  \"sandybrown\": \"#f4a460\",\r\n  \"seagreen\": \"#2e8b57\",\r\n  \"seashell\": \"#fff5ee\",\r\n  \"sienna\": \"#a0522d\",\r\n  \"silver\": \"#c0c0c0\",\r\n  \"skyblue\": \"#87ceeb\",\r\n  \"slateblue\": \"#6a5acd\",\r\n  \"slategray\": \"#708090\",\r\n  \"slategrey\": \"#708090\",\r\n  \"snow\": \"#fffafa\",\r\n  \"springgreen\": \"#00ff7f\",\r\n  \"steelblue\": \"#4682b4\",\r\n  \"tan\": \"#d2b48c\",\r\n  \"teal\": \"#008080\",\r\n  \"thistle\": \"#d8bfd8\",\r\n  \"tomato\": \"#ff6347\",\r\n  \"turquoise\": \"#40e0d0\",\r\n  \"violet\": \"#ee82ee\",\r\n  \"wheat\": \"#f5deb3\",\r\n  \"white\": \"#ffffff\",\r\n  \"whitesmoke\": \"#f5f5f5\",\r\n  \"yellow\": \"#ffff00\",\r\n  \"yellowgreen\": \"#9acd32\"\r\n};\r\n", "import { NAMED_COLORS } from \"../../css/named-colors.js\";\r\nimport type { RGBA } from \"../types.js\";\r\n\r\nexport function parseColor(value: string | undefined): RGBA | undefined {\r\n  if (!value) {\r\n    return undefined;\r\n  }\r\n\r\n  let normalized = value.trim().toLowerCase();\r\n  if (normalized in NAMED_COLORS) {\r\n    normalized = NAMED_COLORS[normalized];\r\n  }\r\n\r\n  if (normalized === \"transparent\") {\r\n    return undefined;\r\n  }\r\n\r\n  const hexMatch = normalized.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i);\r\n  if (hexMatch) {\r\n    const digits = hexMatch[1];\r\n    if (digits.length === 3) {\r\n      const r = parseHex(digits[0] + digits[0]);\r\n      const g = parseHex(digits[1] + digits[1]);\r\n      const b = parseHex(digits[2] + digits[2]);\r\n      return { r, g, b, a: 1 };\r\n    }\r\n    const r = parseHex(digits.slice(0, 2));\r\n    const g = parseHex(digits.slice(2, 4));\r\n    const b = parseHex(digits.slice(4, 6));\r\n    return { r, g, b, a: 1 };\r\n  }\r\n  const rgbMatch = normalized.match(/^rgba?\\((.+)\\)$/);\r\n  if (rgbMatch) {\r\n    const parts = rgbMatch[1].split(\",\").map((part) => part.trim());\r\n    const r = clampColor(Number.parseFloat(parts[0]));\r\n    const g = clampColor(Number.parseFloat(parts[1]));\r\n    const b = clampColor(Number.parseFloat(parts[2]));\r\n    const a = parts[3] !== undefined ? clampAlpha(Number.parseFloat(parts[3])) : 1;\r\n    return { r, g, b, a };\r\n  }\r\n  return undefined;\r\n}\r\n\r\nfunction parseHex(value: string): number {\r\n  return Number.parseInt(value, 16);\r\n}\r\n\r\nexport function clampColor(value: number): number {\r\n  if (Number.isNaN(value)) {\r\n    return 0;\r\n  }\r\n  if (value > 255) {\r\n    return 255;\r\n  }\r\n  if (value < 0) {\r\n    return 0;\r\n  }\r\n  return value;\r\n}\r\n\r\nexport function clampAlpha(value: number): number {\r\n  if (Number.isNaN(value)) {\r\n    return 1;\r\n  }\r\n  if (value > 1) {\r\n    return 1;\r\n  }\r\n  if (value < 0) {\r\n    return 0;\r\n  }\r\n  return value;\r\n}\r\n\r\nexport function cloneColor(color: RGBA): RGBA {\r\n  return { r: color.r, g: color.g, b: color.b, a: color.a };\r\n}\r\n\r\n/**\r\n * Converts a CSS color string to a PDF RGB color array [r, g, b] where values are normalized to 0-1.\r\n * Ignores alpha channel.\r\n */\r\nexport function cssColorStringToPdfRgbArray(colorString: string): number[] | undefined {\r\n  const rgba = parseColor(colorString);\r\n  if (!rgba) return undefined;\r\n  return [rgba.r / 255, rgba.g / 255, rgba.b / 255];\r\n}\r\n\r\n/**\r\n * Converts RGB values (0-255) to CMYK array [c, m, y, k] normalized to 0-1.\r\n */\r\nexport function rgbToCmyk(r: number, g: number, b: number): [number, number, number, number] {\r\n  const rNorm = Math.max(0, Math.min(1, r / 255));\r\n  const gNorm = Math.max(0, Math.min(1, g / 255));\r\n  const bNorm = Math.max(0, Math.min(1, b / 255));\r\n\r\n  const k = 1 - Math.max(rNorm, gNorm, bNorm);\r\n  const c = k === 1 ? 0 : (1 - rNorm - k) / (1 - k);\r\n  const m = k === 1 ? 0 : (1 - gNorm - k) / (1 - k);\r\n  const y = k === 1 ? 0 : (1 - bNorm - k) / (1 - k);\r\n\r\n  return [c, m, y, k];\r\n}\r\n", "import { Display, JustifyContent } from \"../../css/enums.js\";\r\nimport type { LayoutNode } from \"../../dom/node.js\";\r\n\r\nexport function resolveTextAlign(node: LayoutNode): string | undefined {\r\n  let current: LayoutNode | null = node;\r\n  while (current) {\r\n    const value = current.style.textAlign;\r\n    if (value && value !== \"start\" && value !== \"auto\") {\r\n      return value;\r\n    }\r\n    current = current.parent;\r\n  }\r\n  return undefined;\r\n}\r\n\r\nexport function resolveFallbackStartX(node: LayoutNode, advanceWidth: number, textAlign?: string): number {\r\n  let startX = node.box.x;\r\n  if (advanceWidth > 0 && Number.isFinite(node.box.contentWidth) && node.box.contentWidth > 0) {\r\n    const slack = Math.max(node.box.contentWidth - advanceWidth, 0);\r\n    if (textAlign === \"center\") {\r\n      startX = node.box.x + slack / 2;\r\n    } else if (textAlign === \"right\" || textAlign === \"end\") {\r\n      startX = node.box.x + slack;\r\n    } else if (textAlign === \"left\" || textAlign === \"start\") {\r\n      startX = node.box.x;\r\n    }\r\n  }\r\n\r\n  const flexStart = resolveFlexSingleChildStart(node, advanceWidth);\r\n  if (flexStart !== null) {\r\n    startX = flexStart;\r\n  }\r\n  return startX;\r\n}\r\n\r\nexport function resolveFlexSingleChildStart(node: LayoutNode, advanceWidth: number): number | null {\r\n  if (!node.parent || advanceWidth <= 0) {\r\n    return null;\r\n  }\r\n  const parent = node.parent;\r\n  if (parent.style.display !== Display.Flex) {\r\n    return null;\r\n  }\r\n  if (parent.children.length !== 1) {\r\n    return null;\r\n  }\r\n  const direction = parent.style.flexDirection ?? \"row\";\r\n  if (direction !== \"row\" && direction !== \"row-reverse\") {\r\n    return null;\r\n  }\r\n  const justify = parent.style.justifyContent ?? JustifyContent.FlexStart;\r\n  const parentWidth = Number.isFinite(parent.box.contentWidth) ? parent.box.contentWidth : 0;\r\n  if (!(parentWidth > 0)) {\r\n    return null;\r\n  }\r\n  const constrainedWidth = advanceWidth > parentWidth ? parentWidth : advanceWidth;\r\n  const slack = Math.max(parentWidth - constrainedWidth, 0);\r\n  const parentStart = parent.box.x;\r\n  const parentEnd = parentStart + parentWidth;\r\n  const isReverse = direction === \"row-reverse\";\r\n\r\n  switch (justify) {\r\n    case JustifyContent.Center:\r\n      return parentStart + slack / 2;\r\n    case JustifyContent.FlexEnd:\r\n    case JustifyContent.End:\r\n    case JustifyContent.Right:\r\n      return isReverse ? parentStart : parentEnd - constrainedWidth;\r\n    case JustifyContent.FlexStart:\r\n    case JustifyContent.Start:\r\n    case JustifyContent.Left:\r\n      return isReverse ? parentEnd - constrainedWidth : parentStart;\r\n    default:\r\n      return null;\r\n  }\r\n}\r\n", "import type { ComputedStyle } from \"../../css/style.js\";\r\nimport type { Rect, Radius } from \"../types.js\";\r\n\r\nexport function resolveBorderRadius(style: ComputedStyle, borderBox: Rect): Radius {\r\n  const raw: Radius = {\r\n    topLeft: {\r\n      x: clampRadius(style.borderTopLeftRadiusX),\r\n      y: clampRadius(style.borderTopLeftRadiusY),\r\n    },\r\n    topRight: {\r\n      x: clampRadius(style.borderTopRightRadiusX),\r\n      y: clampRadius(style.borderTopRightRadiusY),\r\n    },\r\n    bottomRight: {\r\n      x: clampRadius(style.borderBottomRightRadiusX),\r\n      y: clampRadius(style.borderBottomRightRadiusY),\r\n    },\r\n    bottomLeft: {\r\n      x: clampRadius(style.borderBottomLeftRadiusX),\r\n      y: clampRadius(style.borderBottomLeftRadiusY),\r\n    },\r\n  };\r\n  return normalizeBorderRadius(raw, borderBox.width, borderBox.height);\r\n}\r\n\r\nfunction clampRadius(value: number | undefined): number {\r\n  if (!Number.isFinite(value ?? NaN)) {\r\n    return 0;\r\n  }\r\n  const numeric = Number(value);\r\n  return numeric > 0 ? numeric : 0;\r\n}\r\n\r\nexport function normalizeBorderRadius(input: Radius, width: number, height: number): Radius {\r\n  const result: Radius = {\r\n    topLeft: { ...input.topLeft },\r\n    topRight: { ...input.topRight },\r\n    bottomRight: { ...input.bottomRight },\r\n    bottomLeft: { ...input.bottomLeft },\r\n  };\r\n\r\n  const safeWidth = Math.max(width, 0);\r\n  const safeHeight = Math.max(height, 0);\r\n\r\n  if (safeWidth <= 0) {\r\n    result.topLeft.x = 0;\r\n    result.topRight.x = 0;\r\n    result.bottomRight.x = 0;\r\n    result.bottomLeft.x = 0;\r\n  } else {\r\n    const topSum = result.topLeft.x + result.topRight.x;\r\n    if (topSum > safeWidth && topSum > 0) {\r\n      const scale = safeWidth / topSum;\r\n      result.topLeft.x *= scale;\r\n      result.topRight.x *= scale;\r\n    }\r\n    const bottomSum = result.bottomLeft.x + result.bottomRight.x;\r\n    if (bottomSum > safeWidth && bottomSum > 0) {\r\n      const scale = safeWidth / bottomSum;\r\n      result.bottomLeft.x *= scale;\r\n      result.bottomRight.x *= scale;\r\n    }\r\n  }\r\n\r\n  if (safeHeight <= 0) {\r\n    result.topLeft.y = 0;\r\n    result.topRight.y = 0;\r\n    result.bottomRight.y = 0;\r\n    result.bottomLeft.y = 0;\r\n  } else {\r\n    const leftSum = result.topLeft.y + result.bottomLeft.y;\r\n    if (leftSum > safeHeight && leftSum > 0) {\r\n      const scale = safeHeight / leftSum;\r\n      result.topLeft.y *= scale;\r\n      result.bottomLeft.y *= scale;\r\n    }\r\n    const rightSum = result.topRight.y + result.bottomRight.y;\r\n    if (rightSum > safeHeight && rightSum > 0) {\r\n      const scale = safeHeight / rightSum;\r\n      result.topRight.y *= scale;\r\n      result.bottomRight.y *= scale;\r\n    }\r\n  }\r\n\r\n  return result;\r\n}\r\n", "import type { LayoutNode } from \"../../dom/node.js\";\r\nimport type { Rect, ShadowLayer, RGBA } from \"../types.js\";\r\nimport { parseColor, cloneColor } from \"./color-utils.js\";\r\n\r\nexport function resolveBoxShadows(node: LayoutNode, fallbackColor: RGBA): ShadowLayer[] {\r\n  const result: ShadowLayer[] = [];\r\n  const shadows = node.style.boxShadows ?? [];\r\n  for (const shadow of shadows) {\r\n    const color = resolveShadowColor(shadow.color, node.style.color, fallbackColor);\r\n    if (!color) {\r\n      continue;\r\n    }\r\n    result.push({\r\n      inset: shadow.inset,\r\n      offsetX: shadow.offsetX,\r\n      offsetY: shadow.offsetY,\r\n      blur: clampNonNegative(shadow.blurRadius),\r\n      spread: shadow.spreadRadius ?? 0,\r\n      color,\r\n    });\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function resolveTextShadows(node: LayoutNode, fallbackColor: RGBA): ShadowLayer[] {\r\n  const result: ShadowLayer[] = [];\r\n  const shadows = (node.style as any).textShadows ?? [];\r\n  for (const shadow of shadows) {\r\n    // shadow here is expected to have numeric offsetX/offsetY/blurRadius and optional color\r\n    const offsetX = shadow.offsetX ?? 0;\r\n    const offsetY = shadow.offsetY ?? 0;\r\n    const blur = clampNonNegative(shadow.blurRadius ?? 0);\r\n    const color = resolveShadowColor(shadow.color, node.style.color, fallbackColor);\r\n    if (!color) {\r\n      continue;\r\n    }\r\n    result.push({\r\n      inset: false,\r\n      offsetX,\r\n      offsetY,\r\n      blur,\r\n      spread: 0,\r\n      color,\r\n    });\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function resolveShadowColor(specified: string | undefined, styleColor: string | undefined, fallbackColor: RGBA): RGBA | undefined {\r\n  if (!specified || specified.trim().length === 0) {\r\n    return cloneColor(fallbackColor);\r\n  }\r\n  const normalized = specified.trim().toLowerCase();\r\n  if (normalized === \"transparent\") {\r\n    return undefined;\r\n  }\r\n  if (normalized === \"currentcolor\") {\r\n    const current = parseColor(styleColor);\r\n    return cloneColor(current ?? fallbackColor);\r\n  }\r\n  const parsed = parseColor(specified);\r\n  if (parsed) {\r\n    return cloneColor(parsed);\r\n  }\r\n  return cloneColor(fallbackColor);\r\n}\r\n\r\nexport function computeShadowVisualOverflow(base: Rect, shadow: ShadowLayer): Rect | null {\r\n  const spread = shadow.spread;\r\n  const blur = shadow.blur;\r\n  const baseWidth = Math.max(base.width + spread * 2, 0);\r\n  const baseHeight = Math.max(base.height + spread * 2, 0);\r\n  const baseX = base.x + shadow.offsetX - spread;\r\n  const baseY = base.y + shadow.offsetY - spread;\r\n  const finalWidth = baseWidth + blur * 2;\r\n  const finalHeight = baseHeight + blur * 2;\r\n  if (finalWidth <= 0 || finalHeight <= 0) {\r\n    return null;\r\n  }\r\n  return {\r\n    x: baseX - blur,\r\n    y: baseY - blur,\r\n    width: finalWidth,\r\n    height: finalHeight,\r\n  };\r\n}\r\n\r\nexport function calculateVisualOverflow(_node: LayoutNode, borderBox: Rect, boxShadows: ShadowLayer[]): Rect {\r\n  const visualOverflow = cloneRect(borderBox);\r\n  \r\n  for (const shadow of boxShadows) {\r\n    if (shadow.inset) {\r\n      continue;\r\n    }\r\n    const shadowRect = computeShadowVisualOverflow(borderBox, shadow);\r\n    if (shadowRect) {\r\n      expandRectToInclude(visualOverflow, shadowRect);\r\n    }\r\n  }\r\n\r\n  return visualOverflow;\r\n}\r\n\r\nfunction clampNonNegative(value: number): number {\r\n  if (!Number.isFinite(value)) {\r\n    return 0;\r\n  }\r\n  return value < 0 ? 0 : value;\r\n}\r\n\r\nfunction cloneRect(rect: Rect): Rect {\r\n  return { x: rect.x, y: rect.y, width: rect.width, height: rect.height };\r\n}\r\n\r\nfunction expandRectToInclude(target: Rect, addition: Rect): void {\r\n  if (addition.width <= 0 || addition.height <= 0) {\r\n    return;\r\n  }\r\n  const minX = Math.min(target.x, addition.x);\r\n  const minY = Math.min(target.y, addition.y);\r\n  const maxX = Math.max(target.x + target.width, addition.x + addition.width);\r\n  const maxY = Math.max(target.y + target.height, addition.y + addition.height);\r\n  target.x = minX;\r\n  target.y = minY;\r\n  target.width = Math.max(0, maxX - minX);\r\n  target.height = Math.max(0, maxY - minY);\r\n}\r\n", "import type { LayoutNode } from \"../../dom/node.js\";\r\nimport type { ImageRef } from \"../types.js\";\r\nimport type { ImageInfo } from \"../../image/types.js\";\r\n\r\nexport function extractImageRef(node: LayoutNode): ImageRef | undefined {\r\n  if (node.tagName !== \"img\") {\r\n    return undefined;\r\n  }\r\n  const payload = node.customData?.image as\r\n    | { originalSrc?: string; resolvedSrc?: string; info?: ImageInfo }\r\n    | undefined;\r\n  if (!payload?.info) {\r\n    return undefined;\r\n  }\r\n  const info = payload.info;\r\n  const src = payload.resolvedSrc ?? payload.originalSrc ?? \"\";\r\n  return {\r\n    src,\r\n    width: info.width,\r\n    height: info.height,\r\n    format: info.format,\r\n    channels: info.channels,\r\n    bitsPerComponent: info.bitsPerChannel,\r\n    data: info.data,\r\n  };\r\n}\r\n", "import { resolveLength } from \"../../css/length.js\";\r\nimport type { LayoutNode } from \"../../dom/node.js\";\r\nimport type { Rect, Edges } from \"../types.js\";\r\n\r\nexport function calculateBoxDimensions(node: LayoutNode): { borderBox: Rect, paddingBox: Rect, contentBox: Rect } {\r\n  const widthRef = Math.max(node.box.contentWidth, 0);\r\n  const contentHeightRef = Math.max(node.box.contentHeight, 0);\r\n  const padding: Edges = {\r\n    top: resolveLength(node.style.paddingTop, widthRef, { auto: \"zero\" }),\r\n    right: resolveLength(node.style.paddingRight, widthRef, { auto: \"zero\" }),\r\n    bottom: resolveLength(node.style.paddingBottom, widthRef, { auto: \"zero\" }),\r\n    left: resolveLength(node.style.paddingLeft, widthRef, { auto: \"zero\" }),\r\n  };\r\n  const border: Edges = {\r\n    top: resolveLength(node.style.borderTop, widthRef, { auto: \"zero\" }),\r\n    right: resolveLength(node.style.borderRight, widthRef, { auto: \"zero\" }),\r\n    bottom: resolveLength(node.style.borderBottom, widthRef, { auto: \"zero\" }),\r\n    left: resolveLength(node.style.borderLeft, widthRef, { auto: \"zero\" }),\r\n  };\r\n  const borderBox: Rect = {\r\n    x: node.box.x,\r\n    y: node.box.y,\r\n    width: fallbackDimension(node.box.borderBoxWidth, node.box.contentWidth + padding.left + padding.right + border.left + border.right),\r\n    height: fallbackDimension(\r\n      node.box.borderBoxHeight,\r\n      contentHeightRef + padding.top + padding.bottom + border.top + border.bottom,\r\n    ),\r\n  };\r\n  const paddingBox: Rect = {\r\n    x: borderBox.x + border.left,\r\n    y: borderBox.y + border.top,\r\n    width: borderBox.width - border.left - border.right,\r\n    height: borderBox.height - border.top - border.bottom,\r\n  };\r\n  const contentBox: Rect = {\r\n    x: paddingBox.x + padding.left,\r\n    y: paddingBox.y + padding.top,\r\n    width: paddingBox.width - padding.left - padding.right,\r\n    height: paddingBox.height - padding.top - padding.bottom,\r\n  };\r\n\r\n  return { borderBox, paddingBox, contentBox };\r\n}\r\n\r\nexport function fallbackDimension(value: number, computed: number): number {\r\n  return value > 0 ? value : computed;\r\n}\r\n", "import type { ComputedStyle } from \"../../css/style.js\";\nimport type { Decorations, RGBA } from \"../types.js\";\nimport { parseColor } from \"./color-utils.js\";\n\r\nexport function resolveDecorations(style: ComputedStyle): Decorations | undefined {\n  const value = style.textDecorationLine?.trim().toLowerCase();\n  if (!value || value === \"none\") {\n    return undefined;\n  }\n  const tokens = value.split(/\\s+/);\n  const decoration: Decorations = {};\n  for (const token of tokens) {\n    switch (token) {\n      case \"underline\":\n        decoration.underline = true;\n        break;\n      case \"overline\":\n        decoration.overline = true;\n        break;\n      case \"line-through\":\n        decoration.lineThrough = true;\n        break;\n      default:\n        break;\n    }\n  }\n  if (!(decoration.underline || decoration.overline || decoration.lineThrough)) {\n    return undefined;\n  }\n\n  const styleKeyword = style.textDecorationStyle?.trim().toLowerCase();\n  switch (styleKeyword) {\n    case \"solid\":\n    case \"double\":\n    case \"dotted\":\n    case \"dashed\":\n    case \"wavy\":\n      decoration.style = styleKeyword;\n      break;\n    default:\n      decoration.style = \"solid\";\n      break;\n  }\n\n  const color = resolveDecorationColor(style);\n  if (color) {\n    decoration.color = color;\n  }\n  return decoration;\n}\n\nfunction resolveDecorationColor(style: ComputedStyle): RGBA | undefined {\n  const raw = style.textDecorationColor;\n  if (raw) {\n    if (raw.toLowerCase() === \"currentcolor\") {\n      return parseColor(style.color);\n    }\n    const parsed = parseColor(raw);\n    if (parsed) {\n      return parsed;\n    }\n  }\n  return parseColor(style.color);\n}\n", "import type { LayoutNode } from \"../../dom/node.js\";\r\nimport type { Rect, Background, ImageRef } from \"../types.js\";\r\nimport { parseColor } from \"./color-utils.js\";\nimport type {\n  BackgroundPosition,\n  BackgroundSize,\n  GradientBackgroundLayer,\n  ImageBackgroundLayer,\n} from \"../../css/background-types.js\";\nimport type { ImageInfo } from \"../../image/types.js\";\nimport type { RadialGradient } from \"../../css/parsers/gradient-parser.js\";\n\r\nexport interface BackgroundBoxes {\r\n  borderBox: Rect;\r\n  paddingBox: Rect;\r\n  contentBox: Rect;\r\n}\r\n\r\nexport function resolveBackgroundLayers(node: LayoutNode, boxes: BackgroundBoxes): Background {\n  const layers = node.style.backgroundLayers ?? [];\n  const background: Background = {};\n\n  for (let i = layers.length - 1; i >= 0; i--) {\n    const layer = layers[i];\n    if (layer.clip === \"text\") {\n      continue;\n    }\n\n    if (layer.kind === \"gradient\" && background.gradient === undefined) {\n      const gradient = createGradientBackground(layer, boxes);\n      if (gradient) {\n        background.gradient = gradient;\n      }\n    } else if (layer.kind === \"image\" && background.image === undefined) {\n      const image = createBackgroundImage(layer, boxes);\r\n      if (image) {\r\n        background.image = image;\r\n      }\r\n    }\r\n  }\r\n\r\n  const color = parseColor(node.style.backgroundColor || undefined);\n  if (color) {\n    background.color = color;\n  }\n\n  return background;\n}\n\nexport function resolveTextGradientLayer(node: LayoutNode, boxes: BackgroundBoxes): Background[\"gradient\"] | undefined {\n  const layers = node.style.backgroundLayers ?? [];\n  for (let i = layers.length - 1; i >= 0; i--) {\n    const layer = layers[i];\n    if (layer.kind === \"gradient\" && layer.clip === \"text\") {\n      const gradient = createGradientBackground(layer, boxes);\n      if (gradient) {\n        return gradient;\n      }\n    }\n  }\n  return undefined;\n}\n\r\nfunction createBackgroundImage(layer: ImageBackgroundLayer, boxes: BackgroundBoxes): Background[\"image\"] | undefined {\r\n  if (!layer.imageInfo) {\r\n    return undefined;\r\n  }\r\n  const originRect = selectBackgroundOriginRect(layer, boxes);\r\n  const size = resolveBackgroundImageSize(layer.size, originRect, layer.imageInfo);\r\n  if (size.width <= 0 || size.height <= 0) {\r\n    return undefined;\r\n  }\r\n  const position = resolveBackgroundPosition(layer.position, originRect, size.width, size.height);\r\n  const imageRef = convertToImageRef(layer, layer.imageInfo);\r\n  return {\r\n    image: imageRef,\r\n    rect: {\r\n      x: position.x,\r\n      y: position.y,\r\n      width: size.width,\r\n      height: size.height,\r\n    },\r\n    repeat: layer.repeat ?? \"repeat\",\r\n    originRect,\r\n  };\r\n}\r\n\r\nfunction createGradientBackground(\n  layer: GradientBackgroundLayer,\n  boxes: BackgroundBoxes,\n): Background[\"gradient\"] | undefined {\n  const originRect = selectBackgroundOriginRect(layer, boxes);\n  const size = resolveGradientSize(layer.size, originRect);\n  if (size.width <= 0 || size.height <= 0) {\n    return undefined;\n  }\n  const position = resolveBackgroundPosition(layer.position, originRect, size.width, size.height);\n  const rect = {\n    x: position.x,\n    y: position.y,\n    width: size.width,\n    height: size.height,\n  };\n\n  const normalizedGradient = normalizeGradientGeometry(layer.gradient, rect);\n  if (!normalizedGradient) {\n    return undefined;\n  }\n  return {\n    gradient: normalizedGradient,\n    rect,\n    repeat: layer.repeat ?? \"no-repeat\",\n    originRect,\n  };\n}\n\r\nfunction selectBackgroundOriginRect(\r\n  layer: { origin?: \"border-box\" | \"padding-box\" | \"content-box\" },\r\n  boxes: BackgroundBoxes,\r\n): Rect {\r\n  switch (layer.origin) {\r\n    case \"border-box\":\r\n      return boxes.borderBox;\r\n    case \"padding-box\":\r\n      return boxes.paddingBox;\r\n    case \"content-box\":\r\n      return boxes.contentBox;\r\n    default:\r\n      return boxes.paddingBox;\r\n  }\r\n}\r\n\r\nfunction resolveBackgroundImageSize(size: BackgroundSize | undefined, area: Rect, info: ImageInfo): {\r\n  width: number;\r\n  height: number;\r\n} {\r\n  const intrinsicWidth = info.width;\r\n  const intrinsicHeight = info.height;\r\n  const areaWidth = area.width;\r\n  const areaHeight = area.height;\r\n  const ratio = intrinsicWidth > 0 && intrinsicHeight > 0 ? intrinsicWidth / intrinsicHeight : 1;\r\n\r\n  if (!size || typeof size === \"string\") {\r\n    if (size === \"cover\") {\r\n      if (ratio >= areaWidth / areaHeight) {\r\n        return { width: ratio * areaHeight, height: areaHeight };\r\n      }\r\n      return { width: areaWidth, height: areaWidth / ratio };\r\n    }\r\n    if (size === \"contain\") {\r\n      if (ratio >= areaWidth / areaHeight) {\r\n        return { width: areaWidth, height: areaWidth / ratio };\r\n      }\r\n      return { width: ratio * areaHeight, height: areaHeight };\r\n    }\r\n    if (intrinsicWidth > 0 && intrinsicHeight > 0) {\r\n      return { width: intrinsicWidth, height: intrinsicHeight };\r\n    }\r\n    return { width: areaWidth, height: areaHeight };\r\n  }\r\n\r\n  const widthComponent =\r\n    parseBackgroundSizeComponent(size.width, areaWidth, intrinsicWidth) ?? parseBackgroundSizeComponent(\"auto\", areaWidth, intrinsicWidth);\r\n  const heightComponent =\r\n    parseBackgroundSizeComponent(size.height, areaHeight, intrinsicHeight) ?? parseBackgroundSizeComponent(\"auto\", areaHeight, intrinsicHeight);\r\n\r\n  return { width: widthComponent ?? areaWidth, height: heightComponent ?? areaHeight };\r\n}\r\n\r\nfunction resolveGradientSize(size: BackgroundSize | undefined, area: Rect): { width: number; height: number } {\r\n  if (!size || typeof size === \"string\") {\r\n    return { width: area.width, height: area.height };\r\n  }\r\n\r\n  const resolvedWidth = parseBackgroundSizeComponent(size.width, area.width, area.width) ?? area.width;\r\n  const resolvedHeight = parseBackgroundSizeComponent(size.height, area.height, area.height) ?? area.height;\r\n\r\n  return { width: resolvedWidth, height: resolvedHeight };\r\n}\r\n\r\nfunction resolveBackgroundPosition(\r\n  position: BackgroundPosition | undefined,\r\n  area: Rect,\r\n  width: number,\r\n  height: number,\r\n): { x: number; y: number } {\r\n  const x = resolvePositionComponent(position?.x, area.x, area.width - width, width, \"x\");\r\n  const y = resolvePositionComponent(position?.y, area.y, area.height - height, height, \"y\");\r\n  return { x, y };\r\n}\r\n\r\nfunction resolvePositionComponent(\r\n  value: string | undefined,\r\n  start: number,\r\n  available: number,\r\n  size: number,\r\n  axis: \"x\" | \"y\",\r\n): number {\r\n  if (!value || value === \"left\" || value === \"top\") {\r\n    return start;\r\n  }\r\n  if (value === \"center\") {\r\n    return start + available / 2;\r\n  }\r\n  if (value === \"right\" || value === \"bottom\") {\r\n    return start + available;\r\n  }\r\n  if (value.endsWith(\"%\")) {\r\n    const percent = parseFloat(value);\r\n    if (!Number.isNaN(percent)) {\r\n      return start + (percent / 100) * available;\r\n    }\r\n  }\r\n  if (value.endsWith(\"px\")) {\r\n    const px = parseFloat(value);\r\n    if (!Number.isNaN(px)) {\r\n      return start + px;\r\n    }\r\n  }\r\n  return axis === \"x\" ? start : start + available;\r\n}\r\n\r\nfunction parseBackgroundSizeComponent(\n  component: string | undefined,\n  axisLength: number,\n  intrinsic: number,\n): number | undefined {\n  if (!component || component === \"auto\") {\r\n    return intrinsic > 0 ? intrinsic : undefined;\r\n  }\r\n  if (component.endsWith(\"%\")) {\r\n    const percent = parseFloat(component);\r\n    if (!Number.isNaN(percent)) {\r\n      return (percent / 100) * axisLength;\r\n    }\r\n    return undefined;\r\n  }\r\n  if (component.endsWith(\"px\")) {\r\n    const px = parseFloat(component);\r\n    if (!Number.isNaN(px)) {\r\n      return px;\r\n    }\r\n    return undefined;\r\n  }\n  const value = Number(component);\n  if (Number.isFinite(value)) {\n    return value;\n  }\n  return undefined;\n}\n\nfunction normalizeGradientGeometry(\n  gradient: GradientBackgroundLayer[\"gradient\"],\n  rect: Rect,\n): GradientBackgroundLayer[\"gradient\"] | undefined {\n  if (!gradient) {\n    return undefined;\n  }\n  if ((gradient as any).type === \"radial\") {\n    return normalizeRadialGradient(gradient as RadialGradient, rect);\n  }\n  return gradient;\n}\n\nfunction normalizeRadialGradient(\n  gradient: RadialGradient,\n  rect: Rect,\n): RadialGradient | undefined {\n  if (gradient.coordsUnits === \"userSpace\") {\n    return gradient;\n  }\n  if (rect.width <= 0 || rect.height <= 0) {\n    return undefined;\n  }\n\n  const hasCssHints = !!gradient.at || !!gradient.size || !!gradient.shape || gradient.source === \"css\";\n  if (!hasCssHints) {\n    return gradient;\n  }\n\n  const cxPx = resolvePositionToPx(gradient.at?.x, rect.width, (gradient.cx ?? 0.5) * rect.width, \"x\");\n  const cyPx = resolvePositionToPx(gradient.at?.y, rect.height, (gradient.cy ?? 0.5) * rect.height, \"y\");\n  const radiusPx = resolveRadialRadiusPx(\n    gradient.size,\n    gradient.shape,\n    rect.width,\n    rect.height,\n    cxPx,\n    cyPx,\n    gradient.r,\n  );\n  const maxDimension = Math.max(rect.width, rect.height, 1);\n\n  return {\n    ...gradient,\n    cx: clampUnit(cxPx / rect.width),\n    cy: clampUnit(cyPx / rect.height),\n    r: clampUnit(radiusPx / maxDimension),\n    coordsUnits: \"ratio\",\n  };\n}\n\nfunction resolvePositionToPx(\n  raw: string | undefined,\n  length: number,\n  fallbackPx: number,\n  axis: \"x\" | \"y\",\n): number {\n  if (!Number.isFinite(length) || length <= 0) {\n    return fallbackPx;\n  }\n  if (!raw) {\n    return clamp(rawNumber(fallbackPx), 0, length);\n  }\n  const lower = raw.trim().toLowerCase();\n  if (lower === \"left\" || lower === \"top\") return 0;\n  if (lower === \"center\") return length / 2;\n  if (lower === \"right\" || lower === \"bottom\") return length;\n  if (lower.endsWith(\"%\")) {\n    const pct = Number.parseFloat(lower.slice(0, -1));\n    if (Number.isFinite(pct)) {\n      return clamp((pct / 100) * length, 0, length);\n    }\n  }\n  if (lower.endsWith(\"px\")) {\n    const px = Number.parseFloat(lower);\n    if (Number.isFinite(px)) {\n      return clamp(px, 0, length);\n    }\n  }\n  const numeric = Number.parseFloat(lower);\n  if (Number.isFinite(numeric)) {\n    return clamp(numeric, 0, length);\n  }\n  return clamp(rawNumber(fallbackPx), 0, length);\n}\n\nfunction resolveRadialRadiusPx(\n  size: RadialGradient[\"size\"],\n  shape: RadialGradient[\"shape\"],\n  width: number,\n  height: number,\n  cx: number,\n  cy: number,\n  fallbackRatio: number,\n): number {\n  const distanceLeft = Math.max(cx, 0);\n  const distanceRight = Math.max(width - cx, 0);\n  const distanceTop = Math.max(cy, 0);\n  const distanceBottom = Math.max(height - cy, 0);\n\n  const sideMin = Math.min(distanceLeft, distanceRight, distanceTop, distanceBottom);\n  const sideMax = Math.max(distanceLeft, distanceRight, distanceTop, distanceBottom);\n\n  const cornerDistances = [\n    Math.hypot(cx, cy),\n    Math.hypot(cx, Math.max(height - cy, 0)),\n    Math.hypot(Math.max(width - cx, 0), cy),\n    Math.hypot(Math.max(width - cx, 0), Math.max(height - cy, 0)),\n  ];\n  const cornerMin = Math.min(...cornerDistances);\n  const cornerMax = Math.max(...cornerDistances);\n\n  const keyword = typeof size === \"string\" ? size.toLowerCase() : undefined;\n  if (keyword === \"closest-side\") {\n    return sideMin;\n  }\n  if (keyword === \"farthest-side\") {\n    return sideMax;\n  }\n  if (keyword === \"closest-corner\") {\n    return cornerMin;\n  }\n  if (keyword === \"farthest-corner\" || keyword === undefined) {\n    return cornerMax;\n  }\n\n  const explicit = parseLength(size, Math.max(width, height));\n  if (explicit !== undefined) {\n    return explicit;\n  }\n\n  const fallback = Number.isFinite(fallbackRatio) ? fallbackRatio * Math.max(width, height) : cornerMax;\n  return fallback;\n}\n\nfunction parseLength(value: string | undefined, relativeTo: number): number | undefined {\n  if (!value) {\n    return undefined;\n  }\n  const trimmed = value.trim().toLowerCase();\n  if (trimmed.endsWith(\"%\")) {\n    const pct = Number.parseFloat(trimmed.slice(0, -1));\n    if (Number.isFinite(pct)) {\n      return (pct / 100) * relativeTo;\n    }\n    return undefined;\n  }\n  if (trimmed.endsWith(\"px\")) {\n    const px = Number.parseFloat(trimmed);\n    return Number.isFinite(px) ? px : undefined;\n  }\n  const numeric = Number.parseFloat(trimmed);\n  return Number.isFinite(numeric) ? numeric : undefined;\n}\n\nfunction clamp(value: number, min: number, max: number): number {\n  if (!Number.isFinite(value)) {\n    return min;\n  }\n  if (value < min) return min;\n  if (value > max) return max;\n  return value;\n}\n\nfunction rawNumber(value: number): number {\n  return Number.isFinite(value) ? value : 0;\n}\n\nfunction clampUnit(value: number): number {\n  if (!Number.isFinite(value)) {\n    return 0;\n  }\n  if (value < 0) return 0;\n  if (value > 1) return 1;\n  return value;\n}\n\r\nfunction convertToImageRef(layer: ImageBackgroundLayer, info: ImageInfo): ImageRef {\r\n  return {\r\n    src: layer.resolvedUrl ?? layer.originalUrl ?? \"\",\r\n    width: info.width,\r\n    height: info.height,\r\n    format: info.format,\r\n    channels: info.channels,\r\n    bitsPerComponent: info.bitsPerChannel,\r\n    data: info.data,\r\n  };\r\n}\r\n", "import type { LayoutNode } from \"../../dom/node.js\";\nimport type { ClipPath, Rect } from \"../types.js\";\nimport type { BackgroundBoxes } from \"./background-layer-resolver.js\";\nimport type { ClipPath as CssClipPath, ClipPathLength, ClipPathReferenceBox } from \"../../css/clip-path-types.js\";\n\nexport function resolveClipPath(node: LayoutNode, boxes: BackgroundBoxes): ClipPath | undefined {\n  const clip = node.style.clipPath as CssClipPath | undefined;\n  if (!clip || clip.type !== \"polygon\" || !clip.points.length) {\n    return undefined;\n  }\n\n  const referenceRect = selectReferenceRect(clip.referenceBox, boxes);\n  if (!referenceRect || referenceRect.width <= 0 || referenceRect.height <= 0) {\n    return undefined;\n  }\n\n  const points = clip.points.map((point) => {\n    const x = resolveClipLength(point.x, referenceRect.width);\n    const y = resolveClipLength(point.y, referenceRect.height);\n    return {\n      x: referenceRect.x + x,\n      y: referenceRect.y + y,\n    };\n  });\n\n  if (points.some((p) => !Number.isFinite(p.x) || !Number.isFinite(p.y))) {\n    return undefined;\n  }\n\n  return { type: \"polygon\", points };\n}\n\nfunction selectReferenceRect(box: ClipPathReferenceBox | undefined, boxes: BackgroundBoxes): Rect {\n  switch (box) {\n    case \"padding-box\":\n      return boxes.paddingBox;\n    case \"content-box\":\n      return boxes.contentBox;\n    case \"border-box\":\n    default:\n      return boxes.borderBox;\n  }\n}\n\nfunction resolveClipLength(length: ClipPathLength, reference: number): number {\n  if (length.unit === \"percent\") {\n    return length.value * reference;\n  }\n  return length.value;\n}\n", "export interface Matrix {\r\n  a: number;\r\n  b: number;\r\n  c: number;\r\n  d: number;\r\n  e: number;\r\n  f: number;\r\n}\r\n\r\n/**\r\n * Identity matrix (SVG/PDF convention: matrix(a,b,c,d,e,f) maps (x,y) -> (a*x + c*y + e, b*x + d*y + f))\r\n */\r\nexport function identityMatrix(): Matrix {\r\n  return { a: 1, b: 0, c: 0, d: 1, e: 0, f: 0 };\r\n}\r\n\r\n/**\r\n * Multiply two matrices in the conventional SVG 3x3 representation.\r\n * Result = m1 * m2\r\n */\r\nexport function multiplyMatrices(m1: Matrix, m2: Matrix): Matrix {\r\n  return {\r\n    a: m1.a * m2.a + m1.c * m2.b,\r\n    b: m1.b * m2.a + m1.d * m2.b,\r\n    c: m1.a * m2.c + m1.c * m2.d,\r\n    d: m1.b * m2.c + m1.d * m2.d,\r\n    e: m1.a * m2.e + m1.c * m2.f + m1.e,\r\n    f: m1.b * m2.e + m1.d * m2.f + m1.f,\r\n  };\r\n}\r\n\r\n/**\r\n * Apply a matrix to a point (x,y) and return transformed coordinates.\r\n */\r\nexport function applyMatrixToPoint(matrix: Matrix, x: number, y: number): { x: number; y: number } {\r\n  return {\r\n    x: matrix.a * x + matrix.c * y + matrix.e,\r\n    y: matrix.b * x + matrix.d * y + matrix.f,\r\n  };\r\n}\r\n\r\n/**\r\n * Compute an approximate stroke scale for stroke-width adjustments based on a transform.\r\n * This mirrors prior behavior used by the codebase but kept generic here.\r\n */\r\nexport function computeStrokeScale(viewportMatrix: Matrix, transform: Matrix): number {\r\n  const combined = multiplyMatrices(viewportMatrix, transform);\r\n  const det = combined.a * combined.d - combined.b * combined.c;\r\n  if (Number.isFinite(det) && det !== 0) {\r\n    const scale = Math.sqrt(Math.abs(det));\r\n    if (scale > 0) {\r\n      return scale;\r\n    }\r\n  }\r\n  const col1 = Math.hypot(combined.a, combined.b);\r\n  const col2 = Math.hypot(combined.c, combined.d);\r\n  const average = (col1 + col2) / 2;\r\n  return average > 0 ? average : 1;\r\n}\r\n", "import { identityMatrix, multiplyMatrices } from \"../geometry/matrix.js\";\r\nimport type { Matrix } from \"../geometry/matrix.js\";\r\n\r\n/**\r\n * Parse CSS/SVG transform string into a Matrix using the SVG convention.\r\n * This parser follows the SVG/CSS syntax and semantics and does NOT adapt\r\n * the resulting matrix to any target coordinate system (e.g., PDF).\r\n *\r\n * Returned matrix components are in the same units as the input values\r\n * (typically px for translate).\r\n */\r\nexport function parseTransform(raw: string | undefined): Matrix | null {\r\n  if (!raw) {\r\n    return null;\r\n  }\r\n  const regex = /([a-zA-Z]+)\\(([^)]*)\\)/g;\r\n  let match: RegExpExecArray | null;\r\n  let current = identityMatrix();\r\n  let found = false;\r\n  while ((match = regex.exec(raw)) !== null) {\r\n    const type = match[1].toLowerCase();\r\n    const params = parseNumberList(match[2]);\r\n    const matrix = transformFromValues(type, params);\r\n    if (matrix) {\r\n      current = multiplyMatrices(current, matrix);\r\n      found = true;\r\n    }\r\n  }\r\n  return found ? current : null;\r\n}\r\n\r\nfunction transformFromValues(type: string, values: number[]): Matrix | null {\r\n  switch (type) {\r\n    case \"matrix\":\r\n      if (values.length >= 6) {\r\n        return {\r\n          a: values[0],\r\n          b: values[1],\r\n          c: values[2],\r\n          d: values[3],\r\n          e: values[4],\r\n          f: values[5],\r\n        };\r\n      }\r\n      return null;\r\n    case \"translate\": {\r\n      const tx = Number.isFinite(values[0]) ? values[0] : 0;\r\n      const ty = Number.isFinite(values[1]) ? values[1] : 0;\r\n      return { a: 1, b: 0, c: 0, d: 1, e: tx, f: ty };\r\n    }\r\n    case \"scale\": {\r\n      const sx = Number.isFinite(values[0]) ? values[0] : 1;\r\n      const sy = Number.isFinite(values[1]) ? values[1] : sx;\r\n      return { a: sx, b: 0, c: 0, d: sy, e: 0, f: 0 };\r\n    }\r\n    case \"rotate\": {\r\n      // SVG rotate(angle [, cx, cy])\r\n      const angle = (Number.isFinite(values[0]) ? values[0] : 0) * (Math.PI / 180);\r\n      const cos = Math.cos(angle);\r\n      const sin = Math.sin(angle);\r\n      let base: Matrix = { a: cos, b: sin, c: -sin, d: cos, e: 0, f: 0 };\r\n      if (values.length >= 3 && Number.isFinite(values[1]) && Number.isFinite(values[2])) {\r\n        const cx = values[1];\r\n        const cy = values[2];\r\n        const translateTo: Matrix = { a: 1, b: 0, c: 0, d: 1, e: cx, f: cy };\r\n        const translateBack: Matrix = { a: 1, b: 0, c: 0, d: 1, e: -cx, f: -cy };\r\n        base = multiplyMatrices(translateTo, multiplyMatrices(base, translateBack));\r\n      }\r\n      return base;\r\n    }\r\n    case \"skewx\": {\r\n      const angle = (Number.isFinite(values[0]) ? values[0] : 0) * (Math.PI / 180);\r\n      return { a: 1, b: 0, c: Math.tan(angle), d: 1, e: 0, f: 0 };\r\n    }\r\n    case \"skewy\": {\r\n      const angle = (Number.isFinite(values[0]) ? values[0] : 0) * (Math.PI / 180);\r\n      return { a: 1, b: Math.tan(angle), c: 0, d: 1, e: 0, f: 0 };\r\n    }\r\n    default:\r\n      return null;\r\n  }\r\n}\r\n\r\nfunction parseNumberList(value: string): number[] {\r\n  const result: number[] = [];\r\n  const regex = /[-+]?(?:\\d+\\.?\\d*|\\.\\d+)(?:[eE][-+]?\\d+)?/g;\r\n  let match: RegExpExecArray | null;\r\n  while ((match = regex.exec(value)) !== null) {\r\n    const parsed = Number.parseFloat(match[0]);\r\n    if (Number.isFinite(parsed)) {\r\n      result.push(parsed);\r\n    }\r\n  }\r\n  return result;\r\n}\r\n", "import { resolvedLineHeight } from \"../../css/style.js\";\r\nimport type { ComputedStyle } from \"../../css/style.js\";\r\nimport { estimateLineWidth } from \"../../layout/utils/text-metrics.js\";\r\nimport type { LayoutNode } from \"../../dom/node.js\";\r\nimport type { Run, Decorations, RGBA } from \"../types.js\";\r\nimport { applyTextTransform } from \"../../text/text-transform.js\";\r\nimport { resolveTextShadows } from \"../../pdf/utils/shadow-utils.js\";\r\nimport { resolveTextAlign, resolveFallbackStartX } from \"./text-alignment-resolver.js\";\r\nimport { resolveDecorations } from \"./text-decoration-utils.js\";\r\n\r\nexport function createTextRuns(node: LayoutNode, color: RGBA | undefined, inheritedDecorations?: Decorations): Run[] {\r\n  const runs: Run[] = [];\r\n  const defaultColor = color ?? { r: 0, g: 0, b: 0, a: 1 };\r\n  const effectiveTextAlign = resolveTextAlign(node) ?? node.style.textAlign;\r\n  const decoration = inheritedDecorations ?? resolveDecorations(node.style);\r\n  const fontFamily = node.style.fontFamily ?? \"sans-serif\";\r\n  const fontSize = node.style.fontSize;\r\n  const fontWeight = node.style.fontWeight;\r\n  const fontStyle = node.style.fontStyle;\r\n  const fontVariant = node.style.fontVariant;\r\n  const letterSpacing = node.style.letterSpacing;\r\n\r\n\r\n  // Se o layout calculou inlineRuns (novo builder), use-os.\r\n  if (node.inlineRuns && node.inlineRuns.length > 0) {\r\n    for (const inlineRun of node.inlineRuns) {\r\n      const justifyLine =\r\n        effectiveTextAlign === \"justify\" && !inlineRun.isLastLine;\r\n\r\n      let wordSpacing: number | undefined;\r\n      const targetWidth =\r\n        inlineRun.targetWidth ?? inlineRun.lineWidth ?? inlineRun.width;\r\n      const lineWidth = inlineRun.lineWidth ?? inlineRun.width;\r\n\r\n      if (justifyLine && inlineRun.spaceCount > 0) {\r\n        const slack = Math.max(targetWidth - lineWidth, 0);\r\n        if (slack > 0) {\r\n          wordSpacing = slack / inlineRun.spaceCount;\r\n        }\r\n      }\r\n\r\n      // Count spaces *inside this run's text*\r\n      const spacesInRun =\r\n        inlineRun.text.split(\"\").reduce(\r\n          (count, ch) => (ch === \" \" ? count + 1 : count),\r\n          0,\r\n        );\r\n\r\n      const extraWidth =\r\n        spacesInRun > 0 && wordSpacing !== undefined\r\n          ? spacesInRun * wordSpacing\r\n          : 0;\r\n\r\n      // Run-local visual width (base width + justified expansion)\r\n      const advanceWidth = inlineRun.width + extraWidth;\r\n\r\n      const resolvedShadows = resolveTextShadows(node, defaultColor);\r\n      const baseLineMatrix = {\r\n        a: 1,\r\n        b: 0,\r\n        c: 0,\r\n        d: 1,\r\n        e: inlineRun.startX,\r\n        f: inlineRun.baseline,\r\n      };\r\n\r\n      runs.push({\r\n        text: inlineRun.text.normalize(\"NFC\"),\r\n        fontFamily,\r\n        fontSize,\r\n        fontWeight,\r\n        fontStyle,\r\n        fontVariant,\r\n        fill: defaultColor,\r\n        letterSpacing,\r\n        lineMatrix: baseLineMatrix,\r\n        wordSpacing,\r\n        decorations: decoration ? { ...decoration } : undefined,\r\n        advanceWidth,\r\n        textShadows: resolvedShadows,\r\n\r\n        // New metadata\r\n        lineIndex: inlineRun.lineIndex,\r\n        isLastLine: inlineRun.isLastLine,\r\n        spacesInRun,\r\n      });\r\n    }\r\n    return runs;\r\n  }\r\n\r\n  // Se o layout calculou caixas de linha, use-as (caminho leg legado).\r\n  if (node.lineBoxes && node.lineBoxes.length > 0) {\r\n    const lineHeight = resolvedLineHeight(node.style);\r\n    // For table cells, we need the parent cell's contentWidth, not the text node's width\r\n    const parentIsTableCell = node.parent && (node.parent.tagName === 'td' || node.parent.tagName === 'th');\r\n    const contentWidth = parentIsTableCell\r\n      ? Math.max(node.parent!.box.contentWidth, 0)\r\n      : Math.max(node.box.contentWidth, 0);\r\n    // Alignment logic\r\n    let alignY = node.box.y;\r\n    // Vertical alignment\r\n    let totalTextHeight = node.lineBoxes.length * lineHeight;\r\n    if (node.style.verticalAlign === \"middle\") {\r\n      alignY = node.box.y + (node.box.contentHeight - totalTextHeight) / 2;\r\n    } else if (node.style.verticalAlign === \"bottom\") {\r\n      alignY = node.box.y + (node.box.contentHeight - totalTextHeight);\r\n    }\r\n    const justify = effectiveTextAlign === \"justify\";\r\n    for (let i = 0; i < node.lineBoxes.length; i++) {\r\n      const line = node.lineBoxes[i];\r\n      const normalizedText = line.text.normalize(\"NFC\");\r\n      const baseWidth = line.width ?? estimateLineWidth(normalizedText, node.style);\r\n      const lineYOffset = i * lineHeight;\r\n      const baseline = alignY + lineYOffset + fontSize;\r\n      let wordSpacing: number | undefined;\r\n      if (justify && i < node.lineBoxes.length - 1) {\r\n        const gapCount = line.spaceCount ?? 0;\r\n        if (gapCount > 0) {\r\n          const targetWidth = line.targetWidth ?? contentWidth ?? baseWidth;\r\n          const slack = Math.max(targetWidth - baseWidth, 0);\r\n          if (slack > 0) {\r\n            wordSpacing = slack / gapCount;\r\n          }\r\n        }\r\n      }\r\n      const targetWidth = line.targetWidth ?? baseWidth;\r\n      const advanceWidth =\r\n        wordSpacing !== undefined && wordSpacing !== 0 && targetWidth > 0\r\n          ? Math.max(targetWidth, baseWidth)\r\n          : Math.max(baseWidth, 0);\r\n\r\n      // Apply horizontal text alignment\r\n      let startX = node.box.x;\r\n      if (advanceWidth > 0 && Number.isFinite(contentWidth) && contentWidth > 0) {\r\n        const slack = Math.max(contentWidth - advanceWidth, 0);\r\n        if (effectiveTextAlign === \"center\") {\r\n          startX = node.box.x + slack / 2;\r\n        } else if (effectiveTextAlign === \"right\" || effectiveTextAlign === \"end\") {\r\n          startX = node.box.x + slack;\r\n        }\r\n      }\r\n\r\n      const resolvedShadows = resolveTextShadows(node, defaultColor);\r\n      const baseLineMatrix = { a: 1, b: 0, c: 0, d: 1, e: startX, f: baseline };\r\n      runs.push({\r\n        text: normalizedText,\r\n        fontFamily,\r\n        fontSize,\r\n        fontWeight,\r\n        fontStyle,\r\n        fontVariant,\r\n        fill: defaultColor,\r\n        letterSpacing,\r\n        lineMatrix: baseLineMatrix,\r\n        wordSpacing,\r\n        decorations: decoration ? { ...decoration } : undefined,\r\n        advanceWidth,\r\n        textShadows: resolvedShadows,\r\n      });\r\n    }\r\n    return runs;\r\n  }\r\n\r\n  // Fallback para o comportamento original se n\u00E3o houver quebra de linha calculada\r\n  if (node.textContent) {\r\n    const raw = node.textContent;\r\n    const transformed = applyTextTransform(raw, node.style.textTransform);\r\n    const normalized = transformed.normalize(\"NFC\");\r\n    // Se n\u00E3o houver lineBoxes, a baseline \u00E9 a calculada para a caixa inteira.\r\n    const baseline = node.box.baseline > 0 ? node.box.baseline : node.box.y + node.box.contentHeight;\r\n    const advanceWidth = Math.max(estimateLineWidth(normalized, node.style), 0);\r\n    const startX = resolveFallbackStartX(node, advanceWidth, effectiveTextAlign);\r\n\r\n    const resolvedShadows = resolveTextShadows(node, defaultColor);\r\n    const baseLineMatrix = { a: 1, b: 0, c: 0, d: 1, e: startX, f: baseline };\r\n    return [{\r\n      text: normalized,\r\n      fontFamily,\r\n      fontSize,\r\n      fontWeight,\r\n      fontStyle,\r\n      fontVariant,\r\n      letterSpacing,\r\n      fill: defaultColor,\r\n      lineMatrix: baseLineMatrix,\r\n      decorations: decoration ? { ...decoration } : undefined,\r\n      advanceWidth,\r\n      textShadows: resolvedShadows,\r\n    }];\r\n  }\r\n\r\n  return [];\r\n}\r\n", "import { estimateLineWidth } from \"../../layout/utils/text-metrics.js\";\r\nimport type { LayoutNode } from \"../../dom/node.js\";\r\nimport type { RenderBox, Run, RGBA, Rect } from \"../types.js\";\r\n\r\nexport function createListMarkerRun(\r\n  node: LayoutNode,\r\n  contentBox: Rect,\r\n  children: RenderBox[],\r\n  fallbackColor: RGBA,\r\n): Run | undefined {\r\n  const styleType = resolveListStyleType(node);\r\n  if (!styleType || styleType === \"none\") {\r\n    return undefined;\r\n  }\r\n  const markerIndex = computeListItemIndex(node);\r\n  const markerText = formatListMarker(styleType, markerIndex);\r\n  if (!markerText) {\r\n    return undefined;\r\n  }\r\n\r\n  const firstRun = findFirstDescendantTextRun(children);\r\n  const fontFamily = node.style.fontFamily ?? \"sans-serif\";\r\n  const fontSize = node.style.fontSize;\r\n  const fontWeight = node.style.fontWeight;\r\n  const color = fallbackColor ?? { r: 0, g: 0, b: 0, a: 1 };\r\n\r\n  const baseline =\r\n    firstRun?.lineMatrix.f ??\r\n    (node.box.baseline > 0 ? node.box.baseline : contentBox.y + fontSize);\r\n  const textStartX = firstRun?.lineMatrix.e ?? contentBox.x;\r\n  const markerWidth = Math.max(estimateLineWidth(markerText, node.style), 0);\r\n  const gap = Math.max(fontSize * 0.5, 6);\r\n  const markerX = textStartX - gap - markerWidth;\r\n\r\n  return {\r\n    text: markerText,\r\n    fontFamily,\r\n    fontSize,\r\n    fontWeight,\r\n    fill: color,\r\n    lineMatrix: { a: 1, b: 0, c: 0, d: 1, e: markerX, f: baseline },\r\n    advanceWidth: markerWidth + gap,\r\n  };\r\n}\r\n\r\nexport function findFirstDescendantTextRun(children: RenderBox[]): Run | undefined {\r\n  for (const child of children) {\r\n    if (child.textRuns.length > 0) {\r\n      return child.textRuns[0];\r\n    }\r\n    const nested = findFirstDescendantTextRun(child.children);\r\n    if (nested) {\r\n      return nested;\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n\r\nexport function computeListItemIndex(node: LayoutNode): number {\r\n  const parent = node.parent;\r\n  if (!parent) {\r\n    return 1;\r\n  }\r\n  let index = 0;\r\n  for (const sibling of parent.children) {\r\n    if (sibling.tagName === \"li\") {\r\n      index += 1;\r\n    }\r\n    if (sibling === node) {\r\n      break;\r\n    }\r\n  }\r\n  return Math.max(index, 1);\r\n}\r\n\r\nexport const LIST_STYLE_MARKERS: Record<\"disc\" | \"circle\" | \"square\", string> = {\r\n  disc: \"\\u2022\", // \u2022 BULLET\r\n  circle: \"\\u25E6\", // \u25E6 WHITE BULLET\r\n  square: \"\\u25AA\", // \u25AA BLACK SMALL SQUARE\r\n};\r\n\r\nconst DEFAULT_MARKER = LIST_STYLE_MARKERS.disc;\r\n\r\nexport function formatListMarker(styleType: string, index: number): string | undefined {\r\n  const normalized = styleType.trim().toLowerCase();\r\n  switch (normalized) {\r\n    case \"none\":\r\n      return undefined;\r\n    case \"decimal\":\r\n      return `${index}.`;\r\n    case \"decimal-leading-zero\":\r\n      return `${String(index).padStart(2, \"0\")}.`;\r\n    case \"lower-alpha\":\r\n      return `${toAlphaSequence(index).toLowerCase()}.`;\r\n    case \"upper-alpha\":\r\n      return `${toAlphaSequence(index).toUpperCase()}.`;\r\n    case \"lower-roman\": {\r\n      const roman = toRomanNumeral(index);\r\n      return roman ? `${roman.toLowerCase()}.` : `${index}.`;\r\n    }\r\n    case \"upper-roman\": {\r\n      const roman = toRomanNumeral(index);\r\n      return roman ? `${roman.toUpperCase()}.` : `${index}.`;\r\n    }\r\n    case \"disc\":\r\n    case \"circle\":\r\n    case \"square\":\r\n      return LIST_STYLE_MARKERS[normalized];\r\n    default:\r\n      return DEFAULT_MARKER;\r\n  }\r\n}\r\n\r\nfunction toAlphaSequence(index: number): string {\r\n  let n = Math.max(1, Math.floor(index));\r\n  let result = \"\";\r\n  while (n > 0) {\r\n    n -= 1;\r\n    const charCode = 65 + (n % 26);\r\n    result = String.fromCharCode(charCode) + result;\r\n    n = Math.floor(n / 26);\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction toRomanNumeral(index: number): string | undefined {\r\n  if (!Number.isFinite(index) || index <= 0 || index >= 4000) {\r\n    return undefined;\r\n  }\r\n  const romanPairs: Array<[number, string]> = [\r\n    [1000, \"M\"],\r\n    [900, \"CM\"],\r\n    [500, \"D\"],\r\n    [400, \"CD\"],\r\n    [100, \"C\"],\r\n    [90, \"XC\"],\r\n    [50, \"L\"],\r\n    [40, \"XL\"],\r\n    [10, \"X\"],\r\n    [9, \"IX\"],\r\n    [5, \"V\"],\r\n    [4, \"IV\"],\r\n    [1, \"I\"],\r\n  ];\r\n  let remainder = Math.floor(index);\r\n  let result = \"\";\r\n  for (const [value, numeral] of romanPairs) {\r\n    while (remainder >= value) {\r\n      result += numeral;\r\n      remainder -= value;\r\n    }\r\n    if (remainder === 0) {\r\n      break;\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function resolveListStyleType(node: LayoutNode): string | undefined {\r\n  const own = normalizeListStyleType(node.style.listStyleType);\r\n  if (own === \"none\") {\r\n    return \"none\";\r\n  }\r\n  if (own && own !== \"disc\") {\r\n    return own;\r\n  }\r\n\r\n  const parent = node.parent;\r\n  if (parent) {\r\n    const parentStyle = normalizeListStyleType(parent.style.listStyleType);\r\n    if (parentStyle === \"none\") {\r\n      return \"none\";\r\n    }\r\n    if (parentStyle) {\r\n      return parentStyle;\r\n    }\r\n    if (parent.tagName === \"ol\") {\r\n      return \"decimal\";\r\n    }\r\n    if (parent.tagName === \"ul\") {\r\n      return \"disc\";\r\n    }\r\n  }\r\n\r\n  return own ?? \"disc\";\r\n}\r\n\r\nexport function normalizeListStyleType(value: string | undefined): string | undefined {\r\n  if (!value) {\r\n    return undefined;\r\n  }\r\n  const normalized = value.trim().toLowerCase();\r\n  return normalized.length > 0 ? normalized : undefined;\r\n}\r\n", "import type { Matrix } from \"../geometry/matrix.js\";\r\nimport { multiplyMatrices, identityMatrix } from \"../geometry/matrix.js\";\r\n\r\n/**\r\n * Convert an SVG/CSS matrix (y-down coordinate system) into a matrix suitable\r\n * for use in PDF content streams (y-up coordinate system) by conjugating with\r\n * a Y-flip matrix: M_pdf = F * M_svg * F, where F = diag(1, -1).\r\n *\r\n * This flips the signs of the shear components (b and c) and the vertical\r\n * translation (f) so that when the matrix is later emitted directly into a\r\n * PDF text matrix (Tm) the visual result matches the original SVG/CSS.\r\n */\r\nexport function svgMatrixToPdf(matrix: Matrix | null): Matrix | null {\r\n  if (!matrix) return null;\r\n  // Flip Y matrix F\r\n  const F: Matrix = { a: 1, b: 0, c: 0, d: -1, e: 0, f: 0 };\r\n  // M' = F * M * F\r\n  return multiplyMatrices(multiplyMatrices(F, matrix), F);\r\n}\r\n\r\n/**\r\n * Identity adapter (when no transform present).\r\n */\r\nexport function identityAdapter(): Matrix {\r\n  return identityMatrix();\r\n}\r\n", "import type { LayoutNode } from \"../../dom/node.js\";\r\nimport type { RenderBox, Rect, RGBA, Run, Decorations, GradientBackground } from \"../types.js\";\nimport type { Matrix } from \"../../geometry/matrix.js\";\r\nimport { createTextRuns } from \"./text-utils.js\";\r\nimport { createListMarkerRun } from \"./list-utils.js\";\r\nimport { svgMatrixToPdf } from \"../transform-adapter.js\";\r\nimport { multiplyMatrices } from \"../../geometry/matrix.js\";\r\nimport type { FontResolver } from \"../../fonts/types.js\";\r\nimport type { GlyphRun } from \"../../layout/text-run.js\";\r\nimport type { UnifiedFont } from \"../../fonts/types.js\";\r\nimport type { KerningMap } from \"../../types/fonts.js\";\r\n\r\nexport interface NodeTextRunContext {\n  node: LayoutNode;\n  children: RenderBox[];\n  borderBox: Rect;\n  contentBox: Rect;\n  textColor?: RGBA;\n  decorations?: Decorations;\n  transform?: Matrix;\n  fallbackColor: RGBA;\n  fontResolver?: FontResolver;\n  textGradient?: GradientBackground;\n}\n\r\nexport function buildNodeTextRuns(context: NodeTextRunContext): Run[] {\n  const { node, children, borderBox, contentBox, textColor, decorations, transform, fallbackColor, fontResolver, textGradient } = context;\n  const textRuns = createTextRuns(node, textColor, decorations);\n\r\n  // If we have a fontResolver, enhance text runs with GlyphRun data\r\n  if (fontResolver) {\r\n    enrichTextRunsWithGlyphs(textRuns, fontResolver);\r\n  }\r\n\r\n  if (node.tagName === \"li\") {\n    const markerRun = createListMarkerRun(node, contentBox, children, textColor ?? fallbackColor);\n    if (markerRun) {\n      textRuns.unshift(markerRun);\n    }\n  }\n\n  if (textGradient) {\n    for (const run of textRuns) {\n      run.textGradient = textGradient;\n    }\n  }\n\r\n  if (transform && textRuns.length > 0) {\r\n    applyTransformToTextRuns(textRuns, transform, borderBox);\r\n  }\r\n\r\n  return textRuns;\r\n}\r\n\r\nfunction applyTransformToTextRuns(runs: Run[], cssMatrix: Matrix, originBox: Rect): void {\r\n  if (runs.length === 0) {\r\n    return;\r\n  }\r\n  const pdfMatrix = svgMatrixToPdf(cssMatrix);\r\n  if (!pdfMatrix) {\r\n    return;\r\n  }\r\n  const baseOriginX = Number.isFinite(originBox.x) ? originBox.x : 0;\r\n  const baseOriginY = Number.isFinite(originBox.y) ? originBox.y : 0;\r\n  const originWidth = Number.isFinite(originBox.width) ? originBox.width : 0;\r\n  const originHeight = Number.isFinite(originBox.height) ? originBox.height : 0;\r\n  const originX = baseOriginX + originWidth / 2;\r\n  const originY = baseOriginY + originHeight / 2;\r\n  const toOrigin = translationMatrix(-originX, -originY);\r\n  const fromOrigin = translationMatrix(originX, originY);\r\n  for (const run of runs) {\r\n    const baseMatrix = run.lineMatrix ?? { a: 1, b: 0, c: 0, d: 1, e: 0, f: 0 };\r\n    const localMatrix = multiplyMatrices(toOrigin, baseMatrix);\r\n    const transformedLocal = multiplyMatrices(pdfMatrix, localMatrix);\r\n    run.lineMatrix = multiplyMatrices(fromOrigin, transformedLocal);\r\n  }\r\n}\r\n\r\nfunction translationMatrix(tx: number, ty: number): Matrix {\r\n  return { a: 1, b: 0, c: 0, d: 1, e: tx, f: ty };\r\n}\r\n\r\n/**\r\n * Enriches text runs with GlyphRun data for TTF-based rendering.\r\n * For each run, resolves the font, maps text to glyph IDs, and computes positions.\r\n */\r\nfunction enrichTextRunsWithGlyphs(runs: Run[], fontResolver: FontResolver): void {\r\n  for (const run of runs) {\r\n    try {\r\n      // Resolve the font synchronously if possible\r\n      const font = fontResolver.resolveSync\r\n        ? fontResolver.resolveSync(run.fontFamily, run.fontWeight, run.fontStyle)\r\n        : undefined;\r\n\r\n      if (!font) {\r\n        // If we can't resolve synchronously, skip glyph enrichment for now\r\n        continue;\r\n      }\r\n\r\n      // Map Unicode text to glyph IDs\r\n      const glyphRun = computeGlyphRun(font, run.text, run.fontSize, run.letterSpacing ?? 0);\r\n      // Carry through any word spacing for justified lines so glyph positioning can reflect it.\r\n      if (run.wordSpacing !== undefined && glyphRun.positions.length > 0) {\r\n        applyWordSpacingToGlyphRun(glyphRun, run.text, run.wordSpacing);\r\n      }\r\n\r\n      run.glyphs = glyphRun;\r\n    } catch (error) {\r\n      // If font resolution or glyph mapping fails, continue without glyph data\r\n      console.warn(`Failed to create GlyphRun for text \"${run.text}\": ${error}`);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Map text to glyph IDs and compute positions with optional letter spacing.\r\n * Letter spacing is added between glyphs (not after the last glyph) in CSS px units.\r\n */\r\nexport function computeGlyphRun(font: UnifiedFont, text: string, fontSize: number, letterSpacing: number): GlyphRun {\r\n  const glyphIds: number[] = [];\r\n  const positions: { x: number; y: number }[] = [];\r\n  let currentX = 0;\r\n  const kerning = font.metrics.kerning;\r\n  const unitsPerEm = font.metrics.metrics.unitsPerEm;\r\n  let prevGid: number | null = null;\r\n\r\n  for (let i = 0; i < text.length; i++) {\r\n    const codePoint = text.codePointAt(i) ?? 0;\r\n    const glyphId = font.metrics.cmap.getGlyphId(codePoint);\r\n\r\n    glyphIds.push(glyphId);\r\n\r\n    // Get advance width for this glyph\r\n    const glyphMetric = font.metrics.glyphMetrics.get(glyphId);\r\n    const advanceWidth = glyphMetric?.advanceWidth ?? 0;\r\n\r\n    // Apply kerning adjustment from previous glyph if present\r\n    if (prevGid !== null && kerning) {\r\n      const kernAdjust = getKerningAdjustment(kerning, prevGid, glyphId);\r\n      if (kernAdjust !== 0) {\r\n        currentX += (kernAdjust / unitsPerEm) * fontSize;\r\n      }\r\n    }\r\n\r\n    // Scale advance width to font size\r\n    const scaledAdvance = (advanceWidth / unitsPerEm) * fontSize;\r\n\r\n    positions.push({ x: currentX, y: 0 });\r\n    currentX += scaledAdvance;\r\n\r\n    // Apply letter-spacing between glyphs\r\n    if (i < text.length - 1) {\r\n      currentX += letterSpacing;\r\n    }\r\n\r\n    // Handle surrogate pairs (advance i if this was a surrogate pair)\r\n    if (codePoint > 0xFFFF) {\r\n      i++;\r\n    }\r\n\r\n    prevGid = glyphId;\r\n  }\r\n\r\n  return {\r\n    font,\r\n    glyphIds,\r\n    positions,\r\n    text,\r\n    fontSize,\r\n    width: currentX,\r\n  };\r\n}\r\n\r\nexport function applyWordSpacingToGlyphRun(glyphRun: GlyphRun, text: string, wordSpacing: number | undefined): void {\r\n  if (!wordSpacing) {\r\n    return;\r\n  }\r\n  const additional = wordSpacing;\r\n  for (let idx = 0; idx < glyphRun.positions.length; idx++) {\r\n    const ch = text[idx];\r\n    if (ch === \" \" && idx < glyphRun.positions.length - 1) {\r\n      for (let j = idx + 1; j < glyphRun.positions.length; j++) {\r\n        glyphRun.positions[j] = {\r\n          x: glyphRun.positions[j].x + additional,\r\n          y: glyphRun.positions[j].y,\r\n        };\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction getKerningAdjustment(map: KerningMap, left: number, right: number): number {\r\n  const rightMap = map.get(left);\r\n  if (!rightMap) return 0;\r\n  return rightMap.get(right) ?? 0;\r\n}\r\n", "import { FloatMode, OverflowMode, Position } from \"../css/enums.js\";\r\nimport type { ComputedStyle } from \"../css/style.js\";\r\nimport { LayoutNode } from \"../dom/node.js\";\r\nimport { resolveLength } from \"../css/length.js\";\r\nimport { log } from \"../logging/debug.js\";\r\nimport {\r\n  type LayoutTree,\r\n  type RenderBox,\r\n  type Rect,\n  type HeaderFooterHTML,\n  type StyleSheets,\n  type Positioning,\n  type RGBA,\n  type ImageRef,\n  type BorderStyles,\n  type Background,\n  NodeKind,\r\n  Overflow,\r\n  LayerMode,\r\n} from \"./types.js\";\r\nimport { parseColor } from \"./utils/color-utils.js\";\r\nimport { resolveTextAlign } from \"./utils/text-alignment-resolver.js\";\r\nimport { resolveBorderRadius } from \"./utils/border-radius-utils.js\";\r\nimport { resolveBoxShadows, resolveTextShadows, calculateVisualOverflow } from \"./utils/shadow-utils.js\";\r\nimport { extractImageRef } from \"./utils/image-utils.js\";\r\nimport { calculateBoxDimensions } from \"./utils/box-dimensions-utils.js\";\r\nimport { resolveDecorations } from \"./utils/text-decoration-utils.js\";\nimport {\n  resolveBackgroundLayers,\n  resolveTextGradientLayer,\n} from \"./utils/background-layer-resolver.js\";\nimport { resolveClipPath } from \"./utils/clip-path-resolver.js\";\nimport { parseTransform } from \"../transform/css-parser.js\";\nimport { buildNodeTextRuns } from \"./utils/node-text-run-factory.js\";\nimport type { FontResolver } from \"../fonts/types.js\";\n\r\nexport interface RenderTreeOptions {\r\n  dpiAssumption?: number;\r\n  stylesheets?: Partial<StyleSheets>;\r\n  headerFooter?: Partial<HeaderFooterHTML>;\r\n  fontResolver?: FontResolver;\r\n}\r\n\r\nexport function buildRenderTree(root: LayoutNode, options: RenderTreeOptions = {}): LayoutTree {\r\n  const dpiAssumption = options.dpiAssumption ?? 96;\r\n  const stylesheets: StyleSheets = {\r\n    fontFaces: options.stylesheets?.fontFaces ?? [],\r\n  };\r\n  const headerFooter: HeaderFooterHTML = {\r\n    headerHtml: options.headerFooter?.headerHtml,\r\n    footerHtml: options.headerFooter?.footerHtml,\r\n    headerFirstHtml: options.headerFooter?.headerFirstHtml,\r\n    footerFirstHtml: options.headerFooter?.footerFirstHtml,\r\n    headerEvenHtml: options.headerFooter?.headerEvenHtml,\r\n    footerEvenHtml: options.headerFooter?.footerEvenHtml,\r\n    headerOddHtml: options.headerFooter?.headerOddHtml,\r\n    footerOddHtml: options.headerFooter?.footerOddHtml,\r\n    placeholders: options.headerFooter?.placeholders ?? {},\r\n    layerMode: options.headerFooter?.layerMode ?? LayerMode.Under,\r\n    maxHeaderHeightPx: options.headerFooter?.maxHeaderHeightPx ?? 0,\r\n    maxFooterHeightPx: options.headerFooter?.maxFooterHeightPx ?? 0,\r\n    clipOverflow: options.headerFooter?.clipOverflow ?? false,\r\n    fontFamily: options.headerFooter?.fontFamily,\r\n  };\r\n\r\n  const state = { counter: 0, fontResolver: options.fontResolver };\n  const renderRoot = convertNode(root, state);\n  return {\r\n    root: renderRoot,\r\n    dpiAssumption,\r\n    css: stylesheets,\r\n    hf: headerFooter,\r\n  };\r\n}\r\n\r\nconst DEFAULT_TEXT_COLOR: RGBA = { r: 0, g: 0, b: 0, a: 1 };\r\n\r\nfunction mapNodeKind(node: LayoutNode): NodeKind {\r\n  if (node.tagName === \"img\") {\r\n    return NodeKind.Image;\r\n  }\r\n  if (node.tagName === \"svg\" && node.customData && \"svg\" in node.customData) {\r\n    return NodeKind.Svg;\r\n  }\r\n  if (node.tagName === \"li\") {\r\n    return NodeKind.ListItem;\r\n  }\r\n  if (node.textContent && node.textContent.length > 0) {\r\n    return NodeKind.TextRuns;\r\n  }\r\n  return NodeKind.Container;\r\n}\r\n\r\nfunction mapPosition(style: ComputedStyle): Positioning {\r\n  if (style.float !== FloatMode.None) {\r\n    return { type: \"float\" };\r\n  }\r\n  switch (style.position) {\r\n    case Position.Absolute:\r\n      return { type: \"absolute\" };\r\n    case Position.Fixed:\r\n      return { type: \"fixed\" };\r\n    case Position.Sticky:\r\n      return { type: \"sticky\" };\r\n    default:\r\n      return { type: \"normal\" };\r\n  }\r\n}\r\n\r\nfunction mapOverflow(mode: OverflowMode): Overflow {\r\n  switch (mode) {\r\n    case OverflowMode.Hidden:\r\n      return Overflow.Hidden;\r\n    case OverflowMode.Scroll:\r\n      return Overflow.Scroll;\r\n    case OverflowMode.Auto:\r\n      return Overflow.Auto;\r\n    case OverflowMode.Clip:\r\n      return Overflow.Clip;\r\n    default:\r\n      return Overflow.Visible;\r\n  }\r\n}\r\n\r\n\r\n// ====================\r\n// MAIN CONVERSION FUNCTION\r\n// ====================\r\n\r\nfunction convertNode(\n  node: LayoutNode,\n  state: { counter: number; fontResolver?: FontResolver },\n  inheritedTextGradient?: Background[\"gradient\"],\n): RenderBox {\n  // Use the original HTML ID if available, otherwise generate a new one\r\n  const originalId = node.customData?.id as string | undefined;\r\n  const id = originalId || `node-${state.counter++}`;\r\n  const { borderBox, paddingBox, contentBox } = calculateBoxDimensions(node);\r\n  const textColor = parseColor(node.style.color);\r\n  const fallbackShadowColor = textColor ?? DEFAULT_TEXT_COLOR;\r\n  const boxShadows = resolveBoxShadows(node, fallbackShadowColor);\r\n  const visualOverflow = calculateVisualOverflow(node, borderBox, boxShadows);\r\n  const borderRadius = resolveBorderRadius(node.style, borderBox);\r\n\r\n  const transformString = node.style.transform;\r\n  const transform = transformString ? parseTransform(transformString) ?? undefined : undefined;\r\n\r\n  const ownTextGradient = resolveTextGradientLayer(node, { borderBox, paddingBox, contentBox });\n  if (ownTextGradient) {\n    log(\"layout\", \"debug\", \"node has background-clip:text gradient\", {\n      tagName: node.tagName,\n      rect: ownTextGradient.rect,\n    });\n  }\n  const textGradient = ownTextGradient ?? inheritedTextGradient;\n\n  const children = node.children.map((child) => convertNode(child, state, textGradient));\n  const imageRef = extractImageRef(node);\n  const decorations = resolveDecorations(node.style);\n  const textRuns = buildNodeTextRuns({\n    node,\n    children,\n    borderBox,\n    contentBox,\n    textColor,\n    decorations,\n    transform: transform ?? undefined,\n    fallbackColor: textColor ?? DEFAULT_TEXT_COLOR,\n    fontResolver: state.fontResolver,\n    textGradient,\n  });\n\r\n  log(\"layout\", \"debug\", \"node converted\", {\n    tagName: node.tagName,\n    textContent: node.textContent?.slice(0, 40),\n    fontFamily: node.style.fontFamily,\n    fontSize: node.style.fontSize,\n    contentBox,\n  });\n\n  const background = resolveBackgroundLayers(node, { borderBox, paddingBox, contentBox });\n  const clipPath = resolveClipPath(node, { borderBox, paddingBox, contentBox });\n\r\n  const zIndex = typeof node.style.zIndex === \"number\" ? node.style.zIndex : 0;\r\n  const establishesStackingContext =\r\n    typeof node.style.zIndex === \"number\" && node.style.position !== Position.Static;\r\n\r\n  const borderStyle: BorderStyles = {\r\n    top: normalizeBorderStyle(node.style.borderStyleTop),\r\n    right: normalizeBorderStyle(node.style.borderStyleRight),\r\n    bottom: normalizeBorderStyle(node.style.borderStyleBottom),\r\n    left: normalizeBorderStyle(node.style.borderStyleLeft),\r\n  };\r\n\r\n  const rawTextAlign = resolveTextAlign(node);\r\n  const textAlign =\r\n    rawTextAlign === \"left\" ||\r\n      rawTextAlign === \"center\" ||\r\n      rawTextAlign === \"right\" ||\r\n      rawTextAlign === \"justify\"\r\n      ? (rawTextAlign as \"left\" | \"center\" | \"right\" | \"justify\")\r\n      : undefined;\r\n\r\n  return {\r\n    id,\r\n    tagName: node.tagName,\r\n    textContent: node.textContent,\r\n    kind: mapNodeKind(node),\r\n    contentBox,\r\n    paddingBox,\r\n    borderBox,\r\n    visualOverflow,\r\n    padding: {\r\n      top: resolveLength(node.style.paddingTop, Math.max(node.box.contentWidth, 0), { auto: \"zero\" }),\r\n      right: resolveLength(node.style.paddingRight, Math.max(node.box.contentWidth, 0), { auto: \"zero\" }),\r\n      bottom: resolveLength(node.style.paddingBottom, Math.max(node.box.contentWidth, 0), { auto: \"zero\" }),\r\n      left: resolveLength(node.style.paddingLeft, Math.max(node.box.contentWidth, 0), { auto: \"zero\" }),\r\n    },\r\n    border: {\r\n      top: resolveLength(node.style.borderTop, Math.max(node.box.contentWidth, 0), { auto: \"zero\" }),\r\n      right: resolveLength(node.style.borderRight, Math.max(node.box.contentWidth, 0), { auto: \"zero\" }),\r\n      bottom: resolveLength(node.style.borderBottom, Math.max(node.box.contentWidth, 0), { auto: \"zero\" }),\r\n      left: resolveLength(node.style.borderLeft, Math.max(node.box.contentWidth, 0), { auto: \"zero\" }),\r\n    },\r\n    borderRadius,\r\n    opacity: node.style.opacity ?? 1,\r\n    overflow: mapOverflow(node.style.overflowX ?? OverflowMode.Visible),\r\n    textRuns,\r\n    decorations: decorations ?? {},\r\n    textShadows: resolveTextShadows(node, fallbackShadowColor),\r\n    boxShadows: resolveBoxShadows(node, textColor ?? DEFAULT_TEXT_COLOR),\r\n    establishesStackingContext,\n    zIndexComputed: zIndex,\n    positioning: mapPosition(node.style),\n    children,\n    links: [],\n    borderColor: parseColor(node.style.borderColor),\r\n    borderStyle,\r\n    color: textColor,\r\n    background,\n    clipPath,\n    image: imageRef,\n    customData: node.customData ? { ...node.customData } : undefined,\r\n    textAlign,\r\n    transform,\r\n  };\r\n}\r\n\r\nfunction normalizeBorderStyle(value: string | undefined): \"none\" | \"solid\" | \"dashed\" | \"dotted\" | \"double\" {\r\n  if (!value) {\r\n    return \"solid\";\r\n  }\r\n  const keyword = value.toLowerCase();\r\n  if (keyword === \"dashed\" || keyword === \"dotted\" || keyword === \"double\") {\r\n    return keyword;\r\n  }\r\n  if (keyword === \"none\" || keyword === \"hidden\") {\r\n    return \"none\";\r\n  }\r\n  return \"solid\";\r\n}\r\n", "import type { PdfObjectRef } from \"./pdf-types.js\";\r\n\r\n/**\r\n * Manages PDF object reference assignment and numbering.\r\n * \r\n * This class follows the Single Responsibility Principle by handling\r\n * only object reference creation and number assignment.\r\n */\r\nexport class PdfReferenceManager {\r\n    private currentObjectNumber = 1;\r\n\r\n    /**\r\n     * Creates a new PDF object reference with an unassigned object number.\r\n     * The actual number will be assigned later by ensureRefNumber().\r\n     */\r\n    createRef(): PdfObjectRef {\r\n        return { objectNumber: -1 };\r\n    }\r\n\r\n    /**\r\n     * Ensures the given reference has a valid object number.\r\n     * If the reference already has a number, it updates the internal counter.\r\n     * Otherwise, it assigns the next available number.\r\n     */\r\n    ensureRefNumber(ref: PdfObjectRef): PdfObjectRef {\r\n        if (ref.objectNumber <= 0) {\r\n            ref.objectNumber = this.currentObjectNumber++;\r\n        } else if (ref.objectNumber >= this.currentObjectNumber) {\r\n            this.currentObjectNumber = ref.objectNumber + 1;\r\n        }\r\n        return ref;\r\n    }\r\n\r\n    /**\r\n     * Returns the next available object number without incrementing.\r\n     */\r\n    getNextObjectNumber(): number {\r\n        return this.currentObjectNumber;\r\n    }\r\n\r\n    /**\r\n     * Returns the current total count of objects (for PDF size field).\r\n     */\r\n    getObjectCount(): number {\r\n        return this.currentObjectNumber;\r\n    }\r\n}\r\n", "import type {\r\n    PdfObjectRef,\r\n    PdfFontResource,\r\n    PdfImageResource,\r\n    PdfExtGStateResource,\r\n    PdfShadingResource,\r\n    PdfPatternResource,\r\n    PdfRegisteredObject,\r\n    PdfRegisteredStream,\r\n} from \"./pdf-types.js\";\r\n\r\n/**\r\n * Registry for standard Type1 PDF fonts.\r\n * Handles font registration with deduplication by base font name.\r\n */\r\nexport class FontRegistry {\r\n    private readonly fonts = new Map<string, PdfFontResource>();\r\n\r\n    register(baseFont: string): PdfObjectRef {\r\n        const existing = this.fonts.get(baseFont);\r\n        if (existing) {\r\n            return existing.objectRef!;\r\n        }\r\n        const objectRef: PdfObjectRef = { objectNumber: -1 };\r\n        this.fonts.set(baseFont, { name: baseFont, baseFont, objectRef });\r\n        return objectRef;\r\n    }\r\n\r\n    getAll(): PdfFontResource[] {\r\n        return Array.from(this.fonts.values());\r\n    }\r\n}\r\n\r\n/**\r\n * Registry for image resources.\r\n * Handles image registration with deduplication and PNG alpha channel separation.\r\n */\r\nexport class ImageRegistry {\r\n    private readonly images: PdfImageResource[] = [];\r\n\r\n    register(image: {\r\n        src: string;\r\n        width: number;\r\n        height: number;\r\n        format: \"jpeg\" | \"png\" | \"gif\" | \"webp\";\r\n        channels: number;\r\n        bitsPerComponent: number;\r\n        data: Uint8Array;\r\n    }): PdfObjectRef {\r\n        // Deduplicate by src when provided\r\n        if (image.src) {\r\n            for (const existing of this.images) {\r\n                if (\r\n                    existing.src === image.src &&\r\n                    existing.width === image.width &&\r\n                    existing.height === image.height\r\n                ) {\r\n                    return existing.ref;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Handle PNG with alpha channel - split into RGB + SMask\r\n        if (image.format === \"png\" && image.channels === 4) {\r\n            return this.registerPngWithAlpha(image);\r\n        }\r\n\r\n        // Regular image registration\r\n        const colorSpace =\r\n            image.channels === 1\r\n                ? \"DeviceGray\"\r\n                : image.channels === 3\r\n                    ? \"DeviceRGB\"\r\n                    : \"DeviceRGB\";\r\n        const filter = image.format === \"jpeg\" ? \"DCTDecode\" : undefined;\r\n        const ref: PdfObjectRef = { objectNumber: -1 };\r\n\r\n        this.images.push({\r\n            ref,\r\n            src: image.src,\r\n            width: image.width,\r\n            height: image.height,\r\n            colorSpace,\r\n            bitsPerComponent: image.bitsPerComponent,\r\n            filter,\r\n            data: image.data.slice(),\r\n            sMask: undefined,\r\n        });\r\n\r\n        return ref;\r\n    }\r\n\r\n    private registerPngWithAlpha(image: {\r\n        src: string;\r\n        width: number;\r\n        height: number;\r\n        data: Uint8Array;\r\n    }): PdfObjectRef {\r\n        const rgbData = new Uint8Array(image.width * image.height * 3);\r\n        const alphaData = new Uint8Array(image.width * image.height);\r\n\r\n        for (let i = 0, j = 0, k = 0; i < image.data.length; i += 4, j += 3, k++) {\r\n            rgbData[j] = image.data[i];\r\n            rgbData[j + 1] = image.data[i + 1];\r\n            rgbData[j + 2] = image.data[i + 2];\r\n            alphaData[k] = image.data[i + 3];\r\n        }\r\n\r\n        // Register alpha mask first\r\n        const sMaskRef: PdfObjectRef = { objectNumber: -1 };\r\n        this.images.push({\r\n            ref: sMaskRef,\r\n            src: image.src,\r\n            width: image.width,\r\n            height: image.height,\r\n            colorSpace: \"DeviceGray\",\r\n            bitsPerComponent: 8,\r\n            data: alphaData,\r\n            sMask: undefined,\r\n        });\r\n\r\n        // Register RGB image with reference to alpha mask\r\n        const ref: PdfObjectRef = { objectNumber: -1 };\r\n        this.images.push({\r\n            ref,\r\n            src: image.src,\r\n            width: image.width,\r\n            height: image.height,\r\n            colorSpace: \"DeviceRGB\",\r\n            bitsPerComponent: 8,\r\n            data: rgbData,\r\n            sMask: sMaskRef,\r\n        });\r\n\r\n        return ref;\r\n    }\r\n\r\n    getAll(): PdfImageResource[] {\r\n        return this.images;\r\n    }\r\n}\r\n\r\n/**\r\n * Registry for ExtGState (graphics state) resources.\r\n * Handles registration with deduplication by alpha value.\r\n */\r\nexport class ExtGStateRegistry {\r\n    private readonly states = new Map<string, PdfExtGStateResource>();\r\n\r\n    register(alpha: number): PdfObjectRef {\r\n        const normalized = this.clampAlpha(alpha);\r\n        const key = normalized.toFixed(4);\r\n        const existing = this.states.get(key);\r\n\r\n        if (existing) {\r\n            return existing.ref;\r\n        }\r\n\r\n        const ref: PdfObjectRef = { objectNumber: -1 };\r\n        this.states.set(key, { ref, alpha: normalized });\r\n        return ref;\r\n    }\r\n\r\n    private clampAlpha(value: number): number {\r\n        if (!Number.isFinite(value)) return 1;\r\n        if (value <= 0) return 0;\r\n        if (value >= 1) return 1;\r\n        return value;\r\n    }\r\n\r\n    getAll(): PdfExtGStateResource[] {\r\n        return Array.from(this.states.values());\r\n    }\r\n}\r\n\r\n/**\r\n * Registry for shading resources.\r\n * Handles registration with deduplication by name.\r\n */\r\nexport class ShadingRegistry {\r\n    private readonly shadings = new Map<string, PdfShadingResource>();\r\n\r\n    register(name: string, dict: string): PdfObjectRef {\r\n        const existing = this.shadings.get(name);\r\n        if (existing) {\r\n            return existing.ref;\r\n        }\r\n\r\n        const ref: PdfObjectRef = { objectNumber: -1 };\r\n        this.shadings.set(name, { ref, dict });\r\n        return ref;\r\n    }\r\n\r\n    getAll(): PdfShadingResource[] {\r\n        return Array.from(this.shadings.values());\r\n    }\r\n}\r\n\r\n/**\r\n * Registry for pattern resources.\r\n * Handles registration with deduplication by name.\r\n */\r\nexport class PatternRegistry {\r\n    private readonly patterns = new Map<string, PdfPatternResource>();\r\n\r\n    register(name: string, dict: string): PdfObjectRef {\r\n        const existing = this.patterns.get(name);\r\n        if (existing) {\r\n            return existing.ref;\r\n        }\r\n\r\n        const ref: PdfObjectRef = { objectNumber: -1 };\r\n        this.patterns.set(name, { ref, dict });\r\n        return ref;\r\n    }\r\n\r\n    getAll(): PdfPatternResource[] {\r\n        return Array.from(this.patterns.values());\r\n    }\r\n}\r\n\r\n/**\r\n * Generic registry for custom PDF objects.\r\n * Stores arbitrary values to be serialized later.\r\n */\r\nexport class ObjectRegistry {\r\n    private readonly objects: PdfRegisteredObject[] = [];\r\n\r\n    register(value: string | Record<string, unknown> | readonly unknown[] | object): PdfObjectRef {\r\n        const ref = { objectNumber: -1 };\r\n        this.objects.push({ ref, value });\r\n        return ref;\r\n    }\r\n\r\n    getAll(): PdfRegisteredObject[] {\r\n        return this.objects;\r\n    }\r\n}\r\n\r\n/**\r\n * Registry for stream objects with custom headers.\r\n */\r\nexport class StreamRegistry {\r\n    private readonly streams: PdfRegisteredStream[] = [];\r\n\r\n    register(data: Uint8Array, headers: Record<string, string> = {}): PdfObjectRef {\r\n        const ref = { objectNumber: -1 };\r\n        this.streams.push({ ref, data, headers });\r\n        return ref;\r\n    }\r\n\r\n    getAll(): PdfRegisteredStream[] {\r\n        return this.streams;\r\n    }\r\n}\r\n", "import { log } from \"../../logging/debug.js\";\n\r\nconst WIN_ANSI_UNICODE = (() => {\r\n  const table: number[] = new Array(256);\r\n  for (let code = 0; code <= 0xff; code++) {\r\n    table[code] = code;\r\n  }\r\n\r\n  const overrides: Record<number, number> = {\r\n    0x80: 0x20ac,\r\n    0x82: 0x201a,\r\n    0x83: 0x0192,\r\n    0x84: 0x201e,\r\n    0x85: 0x2026,\r\n    0x86: 0x2020,\r\n    0x87: 0x2021,\r\n    0x88: 0x02c6,\r\n    0x89: 0x2030,\r\n    0x8a: 0x0160,\r\n    0x8b: 0x2039,\r\n    0x8c: 0x0152,\r\n    0x8e: 0x017d,\r\n    0x91: 0x2018,\r\n    0x92: 0x2019,\r\n    0x93: 0x201c,\r\n    0x94: 0x201d,\r\n    0x95: 0x2022,\r\n    0x96: 0x2013,\r\n    0x97: 0x2014,\r\n    0x98: 0x02dc,\r\n    0x99: 0x2122,\r\n    0x9a: 0x0161,\r\n    0x9b: 0x203a,\r\n    0x9c: 0x0153,\r\n    0x9e: 0x017e,\r\n    0x9f: 0x0178,\r\n  };\r\n\r\n  for (const [codePoint, unicode] of Object.entries(overrides)) {\r\n    const code = Number(codePoint);\r\n    table[code] = unicode;\r\n  }\r\n\r\n  return table;\r\n})();\r\n\r\nconst UNICODE_TO_WIN_ANSI = (() => {\r\n  const map = new Map<number, number>();\r\n  for (let code = 0; code <= 0xff; code++) {\r\n    const unicode = WIN_ANSI_UNICODE[code];\r\n    if (!map.has(unicode)) {\r\n      map.set(unicode, code);\r\n    }\r\n  }\r\n  return map;\r\n})();\r\n\r\nexport { UNICODE_TO_WIN_ANSI };\r\n\r\nexport type PdfEncodingScheme = \"WinAnsi\" | \"Identity-H\";\r\n\r\nexport function encodeToWinAnsi(text: string): string {\r\n  let result = \"\",\r\n    misses = 0,\r\n    details: number[] = [];\r\n  for (const char of text) {\r\n    const codePoint = char.codePointAt(0);\r\n    if (codePoint === undefined) {\r\n      continue;\r\n    }\r\n    const byte = UNICODE_TO_WIN_ANSI.get(codePoint);\r\n    if (byte === undefined) {\r\n      misses++;\r\n      details.push(codePoint);\r\n      result += \"?\";\r\n      continue;\r\n    }\r\n    result += String.fromCharCode(byte);\r\n  }\r\n  if (misses) {\r\n    log(\"encoding\", \"debug\", \"WinAnsi misses\", {\n      misses,\r\n      codepoints: details.slice(0, 20),\r\n    });\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function escapePdfLiteral(text: string): string {\r\n  return text.replace(/([()\\\\])/g, \"\\\\$1\");\r\n}\r\n\r\nexport function encodeAndEscapePdfText(text: string, scheme: PdfEncodingScheme = \"WinAnsi\"): string {\r\n  const before = text;\r\n  const payload = scheme === \"WinAnsi\" ? encodeToWinAnsi(text) : text;\r\n  log(\"encoding\", \"trace\", \"PdfText transformation\", { scheme, before, after: payload });\n  return escapePdfLiteral(payload);\r\n}\r\n", "/**\n * Helpers for working with PDF byte data without relying on Node's Buffer.\n * These utilities keep encoding predictable across Node and browser builds.\n */\n\n/**\n * Encode a \"binary\" string (latin1) into a Uint8Array.\n * Characters beyond 0xFF are truncated to preserve byte-for-byte output.\n */\nexport function encodeBinaryString(value: string): Uint8Array {\n  const out = new Uint8Array(value.length);\n  for (let i = 0; i < value.length; i++) {\n    out[i] = value.charCodeAt(i) & 0xff;\n  }\n  return out;\n}\n\n/**\n * Encode a UTF-8 string into bytes. Use this for plain text sections; avoids Buffer.\n */\nconst utf8Encoder = new TextEncoder();\nexport function encodeText(value: string): Uint8Array {\n  return utf8Encoder.encode(value);\n}\n\n/**\n * Concatenate byte chunks into a single Uint8Array.\n */\nexport function concatBytes(chunks: Uint8Array[]): Uint8Array {\n  let total = 0;\n  for (const chunk of chunks) total += chunk.length;\n\n  const out = new Uint8Array(total);\n  let offset = 0;\n  for (const chunk of chunks) {\n    out.set(chunk, offset);\n    offset += chunk.length;\n  }\n  return out;\n}\n", "import type { PdfObjectRef } from \"./pdf-types.js\";\nimport type { PdfMetadata } from \"../types.js\";\nimport { encodeAndEscapePdfText } from \"../utils/encoding.js\";\nimport { log } from \"../../logging/debug.js\";\nimport { concatBytes, encodeBinaryString } from \"./pdf-bytes.js\";\n\r\n/**\r\n * Pure serialization functions for PDF objects and values.\r\n * These functions follow the Single Responsibility Principle and are\r\n * easy to test in isolation.\r\n */\r\n\r\n/**\r\n * Serializes a JavaScript value to PDF syntax.\r\n */\r\nexport function serializeValue(value: unknown): string {\r\n    if (typeof value === \"number\") return formatNumber(value);\r\n    if (typeof value === \"string\") return value;\r\n    if (Array.isArray(value))\r\n        return `[${value.map((v) => serializeValue(v)).join(\" \")}]`;\r\n    if (typeof value === \"object\" && value !== null && \"objectNumber\" in value)\r\n        return `${(value as { objectNumber: number }).objectNumber} 0 R`;\r\n    if (typeof value === \"object\" && value !== null) {\r\n        const entries = Object.entries(value).map(\r\n            ([k, v]) => `/${k} ${serializeValue(v)}`\r\n        );\r\n        return `<< ${entries.join(\" \")} >>`;\r\n    }\r\n    return \"null\";\r\n}\r\n\r\n/**\r\n * Serializes a Type1 font dictionary.\r\n */\r\nexport function serializeType1Font(baseFont: string): string {\r\n    const body = [\r\n        \"<<\",\r\n        \"/Type /Font\",\r\n        \"/Subtype /Type1\",\r\n        `/BaseFont /${sanitizeName(baseFont)}`,\r\n    ];\r\n    if (!usesSymbolEncoding(baseFont)) {\r\n        body.push(\"/Encoding /WinAnsiEncoding\");\r\n    }\r\n    body.push(\">>\");\r\n    return body.join(\"\\n\");\r\n}\r\n\r\n/**\r\n * Serializes an ExtGState dictionary with alpha values.\r\n */\r\nexport function serializeExtGState(alpha: number): string {\r\n    const safeAlpha = clampUnitAlpha(alpha);\r\n    const formatted = formatNumber(safeAlpha);\r\n    return [\"<<\", \"/Type /ExtGState\", `/ca ${formatted}`, `/CA ${formatted}`, \">>\"].join(\"\\n\");\r\n}\r\n\r\n/**\r\n * Creates a PDF stream object with the given content and headers.\r\n */\r\nexport function serializeStream(\n    content: string | Uint8Array,\n    extraEntries: string[] = []\n): Uint8Array {\n    const encoded = typeof content === \"string\" ? encodeBinaryString(content) : new Uint8Array(content);\n    const entries = [`/Length ${encoded.length}`, ...extraEntries].join(\" \");\n    const header = encodeBinaryString(`<< ${entries} >>\\nstream\\n`);\n    const footer = encodeBinaryString(\"\\nendstream\");\n    return concatBytes([header, encoded, footer]);\n}\n\r\n/**\r\n * Serializes PDF metadata (Info dictionary).\r\n */\r\nexport function serializeInfo(meta: PdfMetadata): string {\r\n    const entries: string[] = [];\r\n\r\n    if (meta.title) {\r\n        const encoded = encodeAndEscapePdfText(meta.title);\r\n        log(\"pdf\", \"debug\", \"serializing metadata title\", {\r\n            title: meta.title.slice(0, 50),\r\n            encoded,\r\n        });\r\n        entries.push(`/Title (${encoded})`);\r\n    }\r\n\r\n    if (meta.author) {\r\n        const encoded = encodeAndEscapePdfText(meta.author);\r\n        log(\"pdf\", \"debug\", \"serializing metadata author\", {\r\n            author: meta.author.slice(0, 50),\r\n            encoded,\r\n        });\r\n        entries.push(`/Author (${encoded})`);\r\n    }\r\n\r\n    if (meta.subject) {\r\n        const encoded = encodeAndEscapePdfText(meta.subject);\r\n        log(\"pdf\", \"debug\", \"serializing metadata subject\", {\r\n            subject: meta.subject.slice(0, 50),\r\n            encoded,\r\n        });\r\n        entries.push(`/Subject (${encoded})`);\r\n    }\r\n\r\n    if (meta.keywords?.length) {\r\n        const keywordsText = meta.keywords.join(\", \");\r\n        const encoded = encodeAndEscapePdfText(keywordsText);\r\n        log(\"pdf\", \"debug\", \"serializing metadata keywords\", {\r\n            keywords: keywordsText.slice(0, 50),\r\n            encoded,\r\n        });\r\n        entries.push(`/Keywords (${encoded})`);\r\n    }\r\n\r\n    if (meta.producer) {\r\n        const encoded = encodeAndEscapePdfText(meta.producer);\r\n        log(\"pdf\", \"debug\", \"serializing metadata producer\", {\r\n            producer: meta.producer.slice(0, 50),\r\n            encoded,\r\n        });\r\n        entries.push(`/Producer (${encoded})`);\r\n    }\r\n\r\n    return `<< ${entries.join(\" \")} >>`;\r\n}\r\n\r\n/**\r\n * Serializes the PDF trailer dictionary.\r\n */\r\nexport function serializeTrailer(\r\n    size: number,\r\n    catalogRef: PdfObjectRef,\r\n    infoRef: PdfObjectRef | null\r\n): string {\r\n    const entries = [`/Size ${size}`, `/Root ${catalogRef.objectNumber} 0 R`];\r\n    if (infoRef) {\r\n        entries.push(`/Info ${infoRef.objectNumber} 0 R`);\r\n    }\r\n    return `<< ${entries.join(\" \")} >>`;\r\n}\r\n\r\n/**\r\n * Formats a cross-reference table entry.\r\n */\r\nexport function formatXref(offset: number): string {\r\n    return `${offset.toString().padStart(10, \"0\")} 00000 n \\n`;\r\n}\r\n\r\n/**\r\n * Formats a number for PDF output, removing trailing zeros from decimals.\r\n */\r\nexport function formatNumber(value: number): string {\r\n    return Number.isInteger(value)\r\n        ? value.toString()\r\n        : value.toFixed(2).replace(/0+$/, \"\").replace(/\\.$/, \"\");\r\n}\r\n\r\n/**\r\n * Sanitizes a PDF name by removing non-printable characters.\r\n */\r\nexport function sanitizeName(name: string): string {\r\n    return name.replace(/[^!-~]/g, \"\");\r\n}\r\n\r\n/**\r\n * Checks if a font uses symbol encoding (Symbol or ZapfDingbats).\r\n */\r\nexport function usesSymbolEncoding(baseFont: string): boolean {\r\n    const normalized = sanitizeName(baseFont).toLowerCase();\r\n    return normalized === \"symbol\" || normalized === \"zapfdingbats\";\r\n}\r\n\r\n/**\r\n * Checks if metadata object has any fields set.\r\n */\r\nexport function hasMetadata(meta: PdfMetadata): boolean {\r\n    return Boolean(\r\n        meta.title ||\r\n        meta.author ||\r\n        meta.subject ||\r\n        meta.keywords?.length ||\r\n        meta.producer\r\n    );\r\n}\r\n\r\n/**\r\n * Clamps alpha value to [0, 1] range.\r\n */\r\nexport function clampUnitAlpha(value: number): number {\r\n    if (!Number.isFinite(value)) return 1;\r\n    if (value <= 0) return 0;\r\n    if (value >= 1) return 1;\r\n    return value;\r\n}\r\n", "import type { PdfMetadata } from \"../types.js\";\r\nimport type { PdfObjectRef, PdfObject, PdfPage } from \"./pdf-types.js\";\r\nimport { PdfReferenceManager } from \"./pdf-reference-manager.js\";\r\nimport {\r\n    FontRegistry,\r\n    ImageRegistry,\r\n    ExtGStateRegistry,\r\n    ShadingRegistry,\r\n    PatternRegistry,\r\n    ObjectRegistry,\r\n    StreamRegistry,\r\n} from \"./pdf-resource-registries.js\";\r\nimport {\n    serializeValue,\n    serializeType1Font,\n    serializeExtGState,\n    serializeStream,\n    serializeInfo,\r\n    serializeTrailer,\r\n    formatXref,\r\n    formatNumber,\n    hasMetadata,\n} from \"./pdf-serializers.js\";\nimport { concatBytes, encodeBinaryString } from \"./pdf-bytes.js\";\n\r\n/**\r\n * Orchestrates PDF document generation by coordinating resource registries,\r\n * reference management, and serialization.\r\n * \r\n * This class follows the Single Responsibility Principle by focusing on\r\n * assembling the PDF document from registered resources.\r\n */\r\nexport class PdfBuilder {\r\n    private readonly pages: PdfPage[] = [];\r\n    private readonly refManager = new PdfReferenceManager();\r\n\r\n    // Public registries for resource management\r\n    readonly fontRegistry = new FontRegistry();\r\n    readonly imageRegistry = new ImageRegistry();\r\n    readonly extGStateRegistry = new ExtGStateRegistry();\r\n    readonly shadingRegistry = new ShadingRegistry();\r\n    readonly patternRegistry = new PatternRegistry();\r\n    readonly objectRegistry = new ObjectRegistry();\r\n    readonly streamRegistry = new StreamRegistry();\r\n\r\n    constructor(private readonly metadata: PdfMetadata = {}) { }\r\n\r\n    /**\r\n     * Adds a page to the document.\r\n     */\r\n    addPage(page: PdfPage): void {\r\n        this.pages.push(page);\r\n    }\r\n\r\n    /**\n     * Finalizes the document and returns the complete PDF as bytes.\n     */\n    finalize(): Uint8Array {\n        const objects: PdfObject[] = [];\n        const header = encodeBinaryString(\"%PDF-1.4\\n\");\n\n        // Helper to push objects with proper reference assignment\n        const pushObject = (\n            body: string | Uint8Array | unknown,\n            ref?: PdfObjectRef | null\n        ): PdfObjectRef => {\n            const objectRef = this.refManager.ensureRefNumber(ref ?? { objectNumber: 0 });\n            let payload: Uint8Array;\n\n            if (typeof body === \"string\") {\n                payload = encodeBinaryString(body);\n            } else if (body instanceof Uint8Array) {\n                payload = body;\n            } else {\n                const serialized = serializeValue(body as Record<string, unknown> | readonly unknown[]);\n                payload = encodeBinaryString(serialized);\n            }\n\n            objects.push({ ref: objectRef, body: payload });\n            return objectRef;\n        };\n\r\n        // Reserve object numbers for streams/objects that may be referenced\r\n        this.reserveObjectNumbers();\n\n        // Build all PDF objects\n        this.buildFonts(pushObject);\n        this.buildExtGStates(pushObject);\n        this.buildShadings(pushObject);\n        this.buildPatterns(pushObject);\n        this.buildImages(pushObject);\n        this.buildStreams(pushObject);\n        this.buildCustomObjects(pushObject);\n\r\n        const pageRefs = this.buildPages(pushObject);\r\n        const pagesRef = this.buildPagesTree(pageRefs, pushObject);\r\n        const catalogRef = this.buildCatalog(pagesRef, pushObject);\r\n        const infoRef = this.buildMetadata(pushObject);\r\n\r\n        return this.assemblePdf(header, objects, catalogRef, infoRef);\r\n    }\r\n\r\n    /**\r\n     * Reserves object numbers for resources that may be referenced by others.\r\n     */\r\n    private reserveObjectNumbers(): void {\n        for (const stream of this.streamRegistry.getAll()) {\n            this.refManager.ensureRefNumber(stream.ref);\n        }\n        for (const obj of this.objectRegistry.getAll()) {\n            this.refManager.ensureRefNumber(obj.ref);\n        }\n        for (const pattern of this.patternRegistry.getAll()) {\n            this.refManager.ensureRefNumber(pattern.ref);\n        }\n    }\n\r\n    /**\r\n     * Builds font objects.\r\n     */\r\n    private buildFonts(pushObject: (body: string | Uint8Array | unknown, ref?: PdfObjectRef | null) => PdfObjectRef): void {\n        for (const font of this.fontRegistry.getAll()) {\r\n            font.objectRef = pushObject(serializeType1Font(font.baseFont), font.objectRef);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Builds ExtGState objects.\r\n     */\r\n    private buildExtGStates(pushObject: (body: string | Uint8Array | unknown, ref?: PdfObjectRef | null) => PdfObjectRef): void {\n        for (const state of this.extGStateRegistry.getAll()) {\r\n            state.ref = pushObject(serializeExtGState(state.alpha), state.ref);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Builds shading objects.\r\n     */\r\n    private buildShadings(pushObject: (body: string | Uint8Array | unknown, ref?: PdfObjectRef | null) => PdfObjectRef): void {\n        for (const shading of this.shadingRegistry.getAll()) {\n            shading.ref = pushObject(shading.dict, shading.ref);\n        }\n    }\n\n    /**\n     * Builds pattern objects.\n     */\n    private buildPatterns(pushObject: (body: string | Uint8Array | unknown, ref?: PdfObjectRef | null) => PdfObjectRef): void {\n        for (const pattern of this.patternRegistry.getAll()) {\n            pattern.ref = pushObject(pattern.dict, pattern.ref);\n        }\n    }\n\r\n    /**\r\n     * Builds image XObject streams.\r\n     */\r\n    private buildImages(pushObject: (body: string | Uint8Array | unknown, ref?: PdfObjectRef | null) => PdfObjectRef): void {\n        for (const image of this.imageRegistry.getAll()) {\r\n            const entries = [\r\n                \"/Type /XObject\",\r\n                \"/Subtype /Image\",\r\n                `/Width ${image.width}`,\r\n                `/Height ${image.height}`,\r\n                `/ColorSpace /${image.colorSpace}`,\r\n                `/BitsPerComponent ${image.bitsPerComponent}`,\r\n            ];\r\n\r\n            if (image.filter) {\r\n                entries.push(`/Filter /${image.filter}`);\r\n            }\r\n\r\n            if (image.sMask) {\r\n                entries.push(`/SMask ${image.sMask.objectNumber} 0 R`);\r\n            }\r\n\r\n            const stream = serializeStream(image.data, entries);\r\n            image.ref = pushObject(stream, image.ref);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Builds custom stream objects.\r\n     */\r\n    private buildStreams(pushObject: (body: string | Uint8Array | unknown, ref?: PdfObjectRef | null) => PdfObjectRef): void {\n        for (const stream of this.streamRegistry.getAll()) {\r\n            const entries = Object.entries(stream.headers).map(([k, v]) => `/${k} ${v}`);\r\n            const body = serializeStream(stream.data, entries);\r\n            stream.ref = pushObject(body, stream.ref);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Builds custom registered objects.\r\n     */\r\n    private buildCustomObjects(pushObject: (body: string | Uint8Array | unknown, ref?: PdfObjectRef | null) => PdfObjectRef): void {\n        for (const obj of this.objectRegistry.getAll()) {\r\n            obj.ref = pushObject(obj.value, obj.ref);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Builds page objects and returns their references.\r\n     */\r\n    private buildPages(pushObject: (body: string | Uint8Array | unknown, ref?: PdfObjectRef | null) => PdfObjectRef): PdfObjectRef[] {\n        const pageRefs: PdfObjectRef[] = [];\r\n\r\n        for (const page of this.pages) {\r\n            const contentRef = pushObject(serializeStream(page.contents));\r\n\r\n            const resourcesParts = this.buildPageResources(page);\r\n            const annotationRefs = this.buildPageAnnotations(page, pushObject);\r\n\r\n            const resources = resourcesParts.length > 0 ? `/Resources << ${resourcesParts.join(\" \")} >>` : \"\";\r\n            const annots = annotationRefs.length > 0\r\n                ? `/Annots [${annotationRefs.map((r) => `${r.objectNumber} 0 R`).join(\" \")}]`\r\n                : \"\";\r\n\r\n            const pageBody = [\r\n                \"<<\",\r\n                \"/Type /Page\",\r\n                `/MediaBox [0 0 ${formatNumber(page.width)} ${formatNumber(page.height)}]`,\r\n                resources,\r\n                annots,\r\n                `/Contents ${contentRef.objectNumber} 0 R`,\r\n                \">>\",\r\n            ]\r\n                .filter(Boolean)\r\n                .join(\"\\n\");\r\n\r\n            const pageRef = pushObject(pageBody);\r\n            pageRefs.push(pageRef);\r\n        }\r\n\r\n        return pageRefs;\r\n    }\r\n\r\n    /**\r\n     * Builds page resources dictionary parts.\r\n     */\r\n    private buildPageResources(page: PdfPage): string[] {\n        const resourcesParts: string[] = [];\n\r\n        // Fonts\r\n        const fontEntries: string[] = [];\r\n        for (const [alias, ref] of page.resources.fonts) {\r\n            fontEntries.push(`/${alias} ${ref.objectNumber} 0 R`);\r\n        }\r\n        if (fontEntries.length > 0) {\r\n            resourcesParts.push(`/Font << ${fontEntries.join(\" \")} >>`);\r\n        }\r\n\r\n        // XObjects (images)\r\n        const xObjectEntries: string[] = [];\r\n        for (const [alias, ref] of page.resources.xObjects) {\r\n            xObjectEntries.push(`/${alias} ${ref.objectNumber} 0 R`);\r\n        }\r\n        if (xObjectEntries.length > 0) {\r\n            resourcesParts.push(`/XObject << ${xObjectEntries.join(\" \")} >>`);\r\n        }\r\n\r\n        // ExtGStates\r\n        const gStateEntries: string[] = [];\r\n        for (const [alias, ref] of page.resources.extGStates) {\r\n            gStateEntries.push(`/${alias} ${ref.objectNumber} 0 R`);\r\n        }\r\n        if (gStateEntries.length > 0) {\n            resourcesParts.push(`/ExtGState << ${gStateEntries.join(\" \")} >>`);\n        }\n\n        // Shadings\n        const shadingEntries: string[] = [];\n        for (const [alias, ref] of page.resources.shadings) {\n            shadingEntries.push(`/${alias} ${ref.objectNumber} 0 R`);\n        }\n        if (shadingEntries.length > 0) {\n            resourcesParts.push(`/Shading << ${shadingEntries.join(\" \")} >>`);\n        }\n\n        // Patterns\n        const patternEntries: string[] = [];\n        if (page.resources.patterns) {\n            for (const [alias, ref] of page.resources.patterns) {\n                patternEntries.push(`/${alias} ${ref.objectNumber} 0 R`);\n            }\n            if (patternEntries.length > 0) {\n                resourcesParts.push(`/Pattern << ${patternEntries.join(\" \")} >>`);\n            }\n        }\n\n        return resourcesParts;\n    }\n\r\n    /**\r\n     * Builds page annotation objects.\r\n     */\r\n    private buildPageAnnotations(\r\n        page: PdfPage,\r\n        pushObject: (body: string | Uint8Array | unknown, ref?: PdfObjectRef | null) => PdfObjectRef\n    ): PdfObjectRef[] {\r\n        const annotationRefs: PdfObjectRef[] = [];\r\n        for (const annotation of page.annotations) {\r\n            const annotRef = pushObject(annotation);\r\n            annotationRefs.push(annotRef);\r\n        }\r\n        return annotationRefs;\r\n    }\r\n\r\n    /**\r\n     * Builds the Pages tree object.\r\n     */\r\n    private buildPagesTree(\r\n        pageRefs: PdfObjectRef[],\r\n        pushObject: (body: string | Uint8Array | unknown, ref?: PdfObjectRef | null) => PdfObjectRef\n    ): PdfObjectRef {\r\n        const kids = pageRefs.map((ref) => `${ref.objectNumber} 0 R`).join(\" \");\r\n        return pushObject(\r\n            [\"<<\", \"/Type /Pages\", `/Count ${pageRefs.length}`, `/Kids [${kids}]`, \">>\"].join(\"\\n\")\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Builds the Catalog object.\r\n     */\r\n    private buildCatalog(\r\n        pagesRef: PdfObjectRef,\r\n        pushObject: (body: string | Uint8Array | unknown, ref?: PdfObjectRef | null) => PdfObjectRef\n    ): PdfObjectRef {\r\n        return pushObject(\r\n            [\"<<\", \"/Type /Catalog\", `/Pages ${pagesRef.objectNumber} 0 R`, \">>\"].join(\"\\n\")\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Builds the Info (metadata) object if metadata is present.\r\n     */\r\n    private buildMetadata(\r\n        pushObject: (body: string | Uint8Array | unknown, ref?: PdfObjectRef | null) => PdfObjectRef\n    ): PdfObjectRef | null {\r\n        if (hasMetadata(this.metadata)) {\r\n            return pushObject(serializeInfo(this.metadata));\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Assembles the final PDF byte array.\r\n     */\r\n    private assemblePdf(\n        header: Uint8Array,\n        objects: PdfObject[],\n        catalogRef: PdfObjectRef,\n        infoRef: PdfObjectRef | null\n    ): Uint8Array {\n        const xrefEntries: string[] = [\"0000000000 65535 f \\n\"];\n        const chunks: Uint8Array[] = [header];\n        let offset = header.length;\n\n        // Write all objects\n        for (const object of objects) {\n            const objectHeader = encodeBinaryString(`${object.ref.objectNumber} 0 obj\\n`);\n            const objectFooter = encodeBinaryString(\"\\nendobj\\n\");\n            const objectBuffer = concatBytes([objectHeader, object.body, objectFooter]);\n            xrefEntries.push(formatXref(offset));\n            chunks.push(objectBuffer);\n            offset += objectBuffer.length;\n        }\n\n        // Write cross-reference table and trailer\n        const xrefStart = offset;\n        const size = this.refManager.getObjectCount();\n        const trailerBody = encodeBinaryString(\n            `xref\\n0 ${size}\\n${xrefEntries.join(\"\")}trailer\\n${serializeTrailer(size, catalogRef, infoRef)}\\nstartxref\\n${xrefStart}\\n%%EOF\\n`\n        );\n        chunks.push(trailerBody);\n\n        return concatBytes(chunks);\n    }\n}\n", "import type { PdfMetadata } from \"../types.js\";\r\nimport type { PdfObjectRef, PdfPage, PdfResources } from \"./pdf-types.js\";\r\nimport { PdfBuilder } from \"./pdf-builder.js\";\r\n\r\n/**\r\n * Main PDF document class that provides a public API for PDF generation.\r\n * \r\n * This class now acts as a thin facade over the PdfBuilder architecture,\r\n * delegating all responsibilities to focused, single-purpose components.\r\n * The public API remains unchanged for backward compatibility.\r\n */\r\nexport class PdfDocument {\r\n  private readonly builder: PdfBuilder;\r\n\r\n  constructor(metadata: PdfMetadata = {}) {\r\n    this.builder = new PdfBuilder(metadata);\r\n  }\r\n\r\n  /**\r\n   * Registers a standard Type1 font and returns a reference to it.\r\n   */\r\n  registerStandardFont(baseFont: string): PdfObjectRef {\r\n    return this.builder.fontRegistry.register(baseFont);\r\n  }\r\n\r\n  /**\r\n   * Adds a page to the document.\r\n   */\r\n  addPage(page: Omit<PdfPage, \"resources\"> & { resources?: Partial<PdfResources> }): void {\r\n    const resources: PdfResources = {\n      fonts: page.resources?.fonts ?? new Map(),\n      xObjects: page.resources?.xObjects ?? new Map(),\n      extGStates: page.resources?.extGStates ?? new Map(),\n      shadings: page.resources?.shadings ?? new Map(),\n      patterns: page.resources?.patterns ?? new Map(),\n    };\n\r\n    this.builder.addPage({\r\n      width: page.width,\r\n      height: page.height,\r\n      contents: page.contents,\r\n      resources,\r\n      annotations: page.annotations ?? [],\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Registers an image and returns a reference to it.\r\n   * Handles deduplication and PNG alpha channel separation automatically.\r\n   */\r\n  registerImage(image: {\r\n    src: string;\r\n    width: number;\r\n    height: number;\r\n    format: \"jpeg\" | \"png\" | \"gif\" | \"webp\";\r\n    channels: number;\r\n    bitsPerComponent: number;\r\n    data: Uint8Array;\r\n  }): PdfObjectRef {\r\n    return this.builder.imageRegistry.register(image);\r\n  }\r\n\r\n  /**\r\n   * Registers an ExtGState with the given alpha value.\r\n   * Automatically deduplicates by alpha value.\r\n   */\r\n  registerExtGState(alpha: number): PdfObjectRef {\r\n    return this.builder.extGStateRegistry.register(alpha);\r\n  }\r\n\r\n  /**\r\n   * Registers a shading resource.\r\n   */\r\n  registerShading(name: string, dict: string): PdfObjectRef {\r\n    return this.builder.shadingRegistry.register(name, dict);\r\n  }\r\n\r\n  /**\r\n   * Registers a pattern resource.\r\n   */\r\n  registerPattern(name: string, dict: string): PdfObjectRef {\r\n    return this.builder.patternRegistry.register(name, dict);\r\n  }\r\n\r\n  /**\r\n   * Registers a custom PDF object.\r\n   */\r\n  register(value: string | Record<string, unknown> | readonly unknown[] | object): PdfObjectRef {\r\n    return this.builder.objectRegistry.register(value);\r\n  }\r\n\r\n  /**\r\n   * Registers a stream object with custom headers.\r\n   */\r\n  registerStream(data: Uint8Array, extraHeaders: Record<string, string> = {}): PdfObjectRef {\r\n    return this.builder.streamRegistry.register(data, extraHeaders);\r\n  }\r\n\r\n  /**\r\n   * Finalizes the PDF document and returns the complete PDF as a byte array.\r\n   */\r\n  finalize(): Uint8Array {\r\n    return this.builder.finalize();\r\n  }\r\n}\r\n\r\n// Re-export PdfObjectRef for backward compatibility\r\nexport type { PdfObjectRef } from \"./pdf-types.js\";\r\n", "import type { HeaderFooterHTML, LayerMode, PageSize, Rect } from \"./types.js\";\r\n\r\nexport interface HeaderFooterContext {\r\n  readonly hf: HeaderFooterHTML;\r\n  readonly pageSize: PageSize;\r\n  readonly baseBox: Rect;\r\n}\r\n\r\nexport interface HeaderFooterLayout {\r\n  readonly headerHeightPt: number;\r\n  readonly footerHeightPt: number;\r\n  readonly headerHeightPx: number;\r\n  readonly footerHeightPx: number;\r\n  readonly layerMode: LayerMode;\r\n  readonly header: HeaderFooterVariants;\r\n  readonly footer: HeaderFooterVariants;\r\n  readonly clipOverflow: boolean;\r\n}\r\n\r\nexport interface HeaderFooterVariants {\r\n  readonly defaultVariant?: HeaderFooterVariant;\r\n  readonly firstVariant?: HeaderFooterVariant;\r\n  readonly evenVariant?: HeaderFooterVariant;\r\n  readonly oddVariant?: HeaderFooterVariant;\r\n}\r\n\r\nexport interface HeaderFooterVariant {\r\n  readonly content: unknown;\r\n  readonly maxHeightPt: number;\r\n  readonly maxHeightPx: number;\r\n}\r\n\r\nexport function initHeaderFooterContext(hf: HeaderFooterHTML, pageSize: PageSize, basePageBox: Rect): HeaderFooterContext {\r\n  return { hf, pageSize, baseBox: basePageBox };\r\n}\r\n\r\nexport function layoutHeaderFooterTrees(ctx: HeaderFooterContext, pxToPt: (px: number) => number): HeaderFooterLayout {\r\n  const headerVariants = prepareVariants(ctx.hf, pxToPt, \"header\");\r\n  const footerVariants = prepareVariants(ctx.hf, pxToPt, \"footer\");\r\n  const headerHeightPt = resolveVariantHeight(headerVariants);\r\n  const footerHeightPt = resolveVariantHeight(footerVariants);\r\n  const headerHeightPx = resolveVariantHeightPx(headerVariants);\r\n  const footerHeightPx = resolveVariantHeightPx(footerVariants);\r\n\r\n  return {\r\n    headerHeightPt,\r\n    footerHeightPt,\r\n    headerHeightPx,\r\n    footerHeightPx,\r\n    layerMode: ctx.hf.layerMode,\r\n    header: headerVariants,\r\n    footer: footerVariants,\r\n    clipOverflow: ctx.hf.clipOverflow,\r\n  };\r\n}\r\n\r\nexport function adjustPageBoxForHf(baseBox: Rect, layout: HeaderFooterLayout): Rect {\r\n  return {\r\n    x: baseBox.x,\r\n    y: baseBox.y + layout.headerHeightPx,\r\n    width: baseBox.width,\r\n    height: Math.max(0, baseBox.height - layout.headerHeightPx - layout.footerHeightPx),\r\n  };\r\n}\r\n\r\nexport function pickHeaderVariant(\r\n  layout: HeaderFooterLayout,\r\n  pageIndex: number,\r\n  totalPages: number,\r\n): HeaderFooterVariant | undefined {\r\n  return pickVariant(layout.header, pageIndex, totalPages);\r\n}\r\n\r\nexport function pickFooterVariant(\r\n  layout: HeaderFooterLayout,\r\n  pageIndex: number,\r\n  totalPages: number,\r\n): HeaderFooterVariant | undefined {\r\n  return pickVariant(layout.footer, pageIndex, totalPages);\r\n}\r\n\r\nfunction prepareVariants(\r\n  hf: HeaderFooterHTML,\r\n  pxToPt: (value: number) => number,\r\n  position: \"header\" | \"footer\",\r\n): HeaderFooterVariants {\r\n  const maxHeightPx = position === \"header\" ? hf.maxHeaderHeightPx ?? 0 : hf.maxFooterHeightPx ?? 0;\r\n  const createVariant = (content: unknown | undefined): HeaderFooterVariant | undefined => {\r\n    if (!content) {\r\n      return undefined;\r\n    }\r\n    return {\r\n      content,\r\n      maxHeightPt: pxToPt(maxHeightPx),\r\n      maxHeightPx,\r\n    };\r\n  };\r\n\r\n  if (position === \"header\") {\r\n    return {\r\n      defaultVariant: createVariant(hf.headerHtml),\r\n      firstVariant: createVariant(hf.headerFirstHtml),\r\n      evenVariant: createVariant(hf.headerEvenHtml),\r\n      oddVariant: createVariant(hf.headerOddHtml),\r\n    };\r\n  }\r\n\r\n  return {\r\n    defaultVariant: createVariant(hf.footerHtml),\r\n    firstVariant: createVariant(hf.footerFirstHtml),\r\n    evenVariant: createVariant(hf.footerEvenHtml),\r\n    oddVariant: createVariant(hf.footerOddHtml),\r\n  };\r\n}\r\n\r\nfunction resolveVariantHeight(variants: HeaderFooterVariants): number {\r\n  const heights = [\r\n    variants.defaultVariant?.maxHeightPt ?? 0,\r\n    variants.firstVariant?.maxHeightPt ?? 0,\r\n    variants.evenVariant?.maxHeightPt ?? 0,\r\n    variants.oddVariant?.maxHeightPt ?? 0,\r\n  ];\r\n  return Math.max(...heights);\r\n}\r\n\r\nfunction resolveVariantHeightPx(variants: HeaderFooterVariants): number {\r\n  const heights = [\r\n    variants.defaultVariant?.maxHeightPx ?? 0,\r\n    variants.firstVariant?.maxHeightPx ?? 0,\r\n    variants.evenVariant?.maxHeightPx ?? 0,\r\n    variants.oddVariant?.maxHeightPx ?? 0,\r\n  ];\r\n  return Math.max(...heights);\r\n}\r\n\r\nfunction pickVariant(\r\n  variants: HeaderFooterVariants,\r\n  pageIndex: number,\r\n  totalPages: number,\r\n): HeaderFooterVariant | undefined {\r\n  if (pageIndex === 1 && variants.firstVariant) {\r\n    return variants.firstVariant;\r\n  }\r\n  if (totalPages > 1) {\r\n    if (pageIndex % 2 === 0 && variants.evenVariant) {\r\n      return variants.evenVariant;\r\n    }\r\n    if (pageIndex % 2 === 1 && variants.oddVariant) {\r\n      return variants.oddVariant;\r\n    }\r\n  }\r\n  return variants.defaultVariant;\r\n}\r\n", "import type { HeaderFooterHTML } from \"./types.js\";\r\n\r\nexport function computeHfTokens(\r\n  placeholders: HeaderFooterHTML[\"placeholders\"],\r\n  _totalPages: number,\r\n  meta: { title?: string } = {},\r\n): Map<string, string | ((page: number, total: number) => string)> {\r\n  const tokens = new Map<string, string | ((page: number, total: number) => string)>();\r\n  for (const [key, value] of Object.entries(placeholders ?? {})) {\r\n    tokens.set(key, value);\r\n  }\r\n  // Support multiple naming conventions for page numbers\r\n  tokens.set(\"page\", (page, _total) => String(page));\r\n  tokens.set(\"pageNumber\", (page, _total) => String(page));\r\n  tokens.set(\"pages\", (_page, total) => String(total));\r\n  tokens.set(\"totalPages\", (_page, total) => String(total));\r\n  if (!tokens.has(\"title\") && meta.title) {\r\n    tokens.set(\"title\", meta.title);\r\n  }\r\n  tokens.set(\"date\", () => new Date().toLocaleDateString());\r\n  return tokens;\r\n}\r\n\r\nexport function applyPlaceholders(\r\n  template: string,\r\n  tokens: Map<string, string | ((page: number, total: number) => string)>,\r\n  pageIndex: number,\r\n  totalPages: number,\r\n): string {\r\n  // Support both {{key}} (double curly braces) and {key} (single curly braces) syntax\r\n  // First replace double braces, then single braces\r\n  let result = template.replace(/\\{\\{([^}]+)\\}\\}/g, (_, key) => {\r\n    const entry = tokens.get(key.trim());\r\n    if (entry === undefined) {\r\n      return \"\";\r\n    }\r\n    if (typeof entry === \"string\") {\r\n      return entry;\r\n    }\r\n    return entry(pageIndex, totalPages);\r\n  });\r\n\r\n  result = result.replace(/\\{([^}]+)\\}/g, (_, key) => {\r\n    const entry = tokens.get(key.trim());\r\n    if (entry === undefined) {\r\n      return \"\";\r\n    }\r\n    if (typeof entry === \"string\") {\r\n      return entry;\r\n    }\r\n    return entry(pageIndex, totalPages);\r\n  });\r\n\r\n  return result;\r\n}\r\n", "// src/css/parsers/registry.ts\r\n\r\nimport type { StyleAccumulator } from \"../style.js\";\r\nimport type { UnitParsers } from \"../../units/units.js\";\r\n\r\nexport interface PropertyParser {\r\n  (value: string, target: StyleAccumulator, units: UnitParsers, inheritedFontWeight?: number): void;\r\n}\r\n\r\nexport const propertyParserRegistry = new Map<string, PropertyParser>();\r\n\r\nexport function registerPropertyParser(property: string, parser: PropertyParser): void {\r\n  propertyParserRegistry.set(property, parser);\r\n}\r\n\r\nexport function getPropertyParser(property: string): PropertyParser | undefined {\r\n  return propertyParserRegistry.get(property);\r\n}\r\n", "// src/css/parsers/flex-parser.ts\r\n\r\nimport {\r\n  AlignContent,\r\n  AlignItems,\r\n  Display,\r\n  JustifyContent,\r\n  type FlexDirection,\r\n  type AlignSelfValue,\r\n} from \"../enums.js\";\r\n\r\nexport function mapDisplay(value: string | undefined): Display | undefined {\r\n  switch (value) {\r\n    case \"block\":\r\n      return Display.Block;\r\n    case \"inline\":\r\n      return Display.Inline;\r\n    case \"inline-block\":\r\n      return Display.InlineBlock;\r\n    case \"flex\":\r\n      return Display.Flex;\r\n    case \"grid\":\r\n      return Display.Grid;\r\n    case \"table\":\r\n      return Display.Table;\r\n    case \"table-row\":\r\n      return Display.TableRow;\r\n    case \"table-cell\":\r\n      return Display.TableCell;\r\n    case \"table-row-group\":\r\n      return Display.TableRowGroup;\r\n    case \"table-header-group\":\r\n      return Display.TableHeaderGroup;\r\n    case \"table-footer-group\":\r\n      return Display.TableFooterGroup;\r\n    case \"table-caption\":\r\n      return Display.TableCaption;\r\n    case \"none\":\r\n      return Display.None;\r\n    default:\r\n      return undefined;\r\n  }\r\n}\r\n\r\nexport function mapJustifyContent(value: string | undefined): JustifyContent | undefined {\r\n  if (!value) {\r\n    return undefined;\r\n  }\r\n  switch (value.trim().toLowerCase()) {\r\n    case \"flex-start\":\r\n      return JustifyContent.FlexStart;\r\n    case \"flex-end\":\r\n      return JustifyContent.FlexEnd;\r\n    case \"center\":\r\n      return JustifyContent.Center;\r\n    case \"space-between\":\r\n      return JustifyContent.SpaceBetween;\r\n    case \"space-around\":\r\n      return JustifyContent.SpaceAround;\r\n    case \"space-evenly\":\r\n      return JustifyContent.SpaceEvenly;\r\n    case \"start\":\r\n      return JustifyContent.Start;\r\n    case \"end\":\r\n      return JustifyContent.End;\r\n    case \"left\":\r\n      return JustifyContent.Left;\r\n    case \"right\":\r\n      return JustifyContent.Right;\r\n    default:\r\n      return undefined;\r\n  }\r\n}\r\n\r\nexport function mapAlignItemsValue(value: string | undefined): AlignItems | undefined {\r\n  if (!value) {\r\n    return undefined;\r\n  }\r\n  switch (value.trim().toLowerCase()) {\r\n    case \"flex-start\":\r\n      return AlignItems.FlexStart;\r\n    case \"flex-end\":\r\n      return AlignItems.FlexEnd;\r\n    case \"center\":\r\n      return AlignItems.Center;\r\n    case \"baseline\":\r\n      return AlignItems.Baseline;\r\n    case \"stretch\":\r\n      return AlignItems.Stretch;\r\n    default:\r\n      return undefined;\r\n  }\r\n}\r\n\r\nexport function mapAlignContentValue(value: string | undefined): AlignContent | undefined {\r\n  if (!value) {\r\n    return undefined;\r\n  }\r\n  switch (value.trim().toLowerCase()) {\r\n    case \"flex-start\":\r\n      return AlignContent.FlexStart;\r\n    case \"flex-end\":\r\n      return AlignContent.FlexEnd;\r\n    case \"center\":\r\n      return AlignContent.Center;\r\n    case \"space-between\":\r\n      return AlignContent.SpaceBetween;\r\n    case \"space-around\":\r\n      return AlignContent.SpaceAround;\r\n    case \"space-evenly\":\r\n      return AlignContent.SpaceEvenly;\r\n    case \"stretch\":\r\n      return AlignContent.Stretch;\r\n    default:\r\n      return undefined;\r\n  }\r\n}\r\n\r\nexport function mapAlignSelfValue(value: string | undefined): AlignSelfValue | undefined {\r\n  if (!value) {\r\n    return undefined;\r\n  }\r\n  const normalized = value.trim().toLowerCase();\r\n  if (normalized === \"auto\") {\r\n    return \"auto\";\r\n  }\r\n  return mapAlignItemsValue(normalized);\r\n}\r\n\r\nexport function parseFlexDirectionValue(value: string | undefined): FlexDirection | undefined {\r\n  if (!value) {\r\n    return undefined;\r\n  }\r\n  const normalized = value.trim().toLowerCase();\r\n  switch (normalized) {\r\n    case \"row\":\r\n    case \"row-reverse\":\r\n    case \"column\":\r\n    case \"column-reverse\":\r\n      return normalized as FlexDirection;\r\n    default:\r\n      return undefined;\r\n  }\r\n}\r\n", "// src/css/parsers/display-flex-parser.ts\r\n\r\nimport {\r\n  mapAlignContentValue,\r\n  mapAlignItemsValue,\r\n  mapAlignSelfValue,\r\n  mapDisplay,\r\n  mapJustifyContent,\r\n  parseFlexDirectionValue,\r\n} from \"./flex-parser.js\";\r\nimport type { StyleAccumulator } from \"../style.js\";\r\n\r\nexport function parseDisplay(value: string, target: StyleAccumulator): void {\r\n  target.display = mapDisplay(value);\r\n}\r\n\r\nexport function parseJustifyContent(value: string, target: StyleAccumulator): void {\r\n  const mapped = mapJustifyContent(value);\r\n  if (mapped !== undefined) {\r\n    target.justifyContent = mapped;\r\n  }\r\n}\r\n\r\nexport function parseAlignItems(value: string, target: StyleAccumulator): void {\r\n  const mapped = mapAlignItemsValue(value);\r\n  if (mapped !== undefined) {\r\n    target.alignItems = mapped;\r\n  }\r\n}\r\n\r\nexport function parseAlignContent(value: string, target: StyleAccumulator): void {\r\n  const mapped = mapAlignContentValue(value);\r\n  if (mapped !== undefined) {\r\n    target.alignContent = mapped;\r\n  }\r\n}\r\n\r\nexport function parseAlignSelf(value: string, target: StyleAccumulator): void {\r\n  const mapped = mapAlignSelfValue(value);\r\n  if (mapped !== undefined) {\r\n    target.alignSelf = mapped;\r\n  }\r\n}\r\n\r\nexport function parseFlexDirection(value: string, target: StyleAccumulator): void {\r\n  const mapped = parseFlexDirectionValue(value);\r\n  if (mapped !== undefined) {\r\n    target.flexDirection = mapped;\r\n  }\r\n}\r\n\r\nexport function parseFlexWrap(value: string, target: StyleAccumulator): void {\r\n  const normalized = value.trim().toLowerCase();\r\n  if (normalized === \"nowrap\") {\r\n    target.flexWrap = false;\r\n  } else if (normalized === \"wrap\" || normalized === \"wrap-reverse\") {\r\n    target.flexWrap = true;\r\n  }\r\n}\r\n", "// src/css/parsers/color-parser.ts\r\n\r\nimport type { StyleAccumulator } from \"../style.js\";\r\n\r\nexport function parseColor(value: string, target: StyleAccumulator): void {\r\n  target.color = value;\r\n}\r\n\r\nexport function parseBackgroundColor(value: string, target: StyleAccumulator): void {\r\n  if (!target.backgroundLayers) {\r\n    target.backgroundLayers = [];\r\n  }\r\n  target.backgroundLayers.push({ kind: \"color\", color: value });\r\n}\r\n", "// src/css/utils.ts\r\n\r\nexport function clampPositive(value: number | undefined): number {\r\n  if (!Number.isFinite(value ?? NaN)) {\r\n    return 0;\r\n  }\r\n  const numeric = Number(value);\r\n  return numeric > 0 ? numeric : 0;\r\n}\r\n\r\nexport function clampNonNegative(value: number): number {\r\n  if (!Number.isFinite(value)) {\r\n    return 0;\r\n  }\r\n  return value < 0 ? 0 : value;\r\n}\r\n\r\nexport function splitCssCommaList(value: string): string[] {\r\n  const result: string[] = [];\r\n  let current = \"\";\r\n  let depth = 0;\r\n  let quote: string | null = null;\r\n\r\n  for (const char of value) {\r\n    if (quote) {\r\n      current += char;\r\n      if (char === quote) {\r\n        quote = null;\r\n      }\r\n      continue;\r\n    }\r\n    if (char === \"'\" || char === \"\\\"\") {\r\n      quote = char;\r\n      current += char;\r\n      continue;\r\n    }\r\n    if (char === \"(\") {\r\n      depth += 1;\r\n      current += char;\r\n      continue;\r\n    }\r\n    if (char === \")\") {\r\n      depth = Math.max(0, depth - 1);\r\n      current += char;\r\n      continue;\r\n    }\r\n    if (char === \",\" && depth === 0) {\r\n      if (current.trim()) {\r\n        result.push(current.trim());\r\n      }\r\n      current = \"\";\r\n      continue;\r\n    }\r\n    current += char;\r\n  }\r\n\r\n  if (current.trim()) {\r\n    result.push(current.trim());\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nexport function splitCssList(value: string): string[] {\r\n  const result: string[] = [];\r\n  let current = \"\";\r\n  let depth = 0;\r\n  let quote: string | null = null;\r\n\r\n  for (const char of value) {\r\n    if (quote) {\r\n      current += char;\r\n      if (char === quote) {\r\n        quote = null;\r\n      }\r\n      continue;\r\n    }\r\n    if (char === \"'\" || char === \"\\\"\") {\r\n      quote = char;\r\n      current += char;\r\n      continue;\r\n    }\r\n    if (char === \"(\") {\r\n      depth += 1;\r\n      current += char;\r\n      continue;\r\n    }\r\n    if (char === \")\") {\r\n      depth = Math.max(0, depth - 1);\r\n      current += char;\r\n      continue;\r\n    }\r\n    if (/\\s/.test(char) && depth === 0) {\r\n      if (current.trim()) {\r\n        result.push(current.trim());\r\n      }\r\n      current = \"\";\r\n      continue;\r\n    }\r\n    current += char;\r\n  }\r\n\r\n  if (current.trim()) {\r\n    result.push(current.trim());\r\n  }\r\n\r\n  return result;\r\n}\r\n", "// src/css/parsers/border-parser.ts\r\n\r\nimport { clampPositive, splitCssList } from \"../utils.js\";\r\nimport { parseLength } from \"./length-parser.js\";\r\nimport type { NumericLength } from \"../style.js\";\r\n\r\nexport const BORDER_STYLE_KEYWORDS = new Set([\r\n  \"none\",\r\n  \"hidden\",\r\n  \"solid\",\r\n  \"dashed\",\r\n  \"dotted\",\r\n  \"double\",\r\n  \"groove\",\r\n  \"ridge\",\r\n  \"inset\",\r\n  \"outset\",\r\n]);\r\n\r\nexport const BORDER_WIDTH_KEYWORD_MAP: Record<string, number> = {\r\n  thin: 1,\r\n  medium: 3,\r\n  thick: 5,\r\n};\r\n\r\nexport const DEFAULT_BORDER_WIDTH = BORDER_WIDTH_KEYWORD_MAP.medium;\r\n\r\nexport interface ParsedBorder {\r\n  width?: NumericLength;\r\n  style?: string;\r\n  color?: string;\r\n}\r\n\r\nexport function parseBorderShorthand(value: string): ParsedBorder | null {\r\n  const parts = splitCssList(value);\r\n  if (parts.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  let width: NumericLength | undefined;\r\n  let style: string | undefined;\r\n  let color: string | undefined;\r\n\r\n  for (const part of parts) {\r\n    const trimmed = part.trim();\r\n    if (!trimmed) {\r\n      continue;\r\n    }\r\n    if (width === undefined) {\r\n      const maybeWidth = parseBorderWidth(trimmed);\r\n      if (maybeWidth !== undefined) {\r\n        width = maybeWidth;\r\n        continue;\r\n      }\r\n    }\r\n\r\n    const lower = trimmed.toLowerCase();\r\n    if (!style && BORDER_STYLE_KEYWORDS.has(lower)) {\r\n      style = lower;\r\n      continue;\r\n    }\r\n\r\n    if (color === undefined) {\r\n      color = trimmed;\r\n    }\r\n  }\r\n\r\n  if (style === \"none\" || style === \"hidden\") {\r\n    width = 0;\r\n  } else if (width === undefined && style) {\r\n    width = DEFAULT_BORDER_WIDTH;\r\n  }\r\n\r\n  return { width, style, color };\r\n}\r\n\r\nexport function parseBorderWidth(value: string): NumericLength | undefined {\r\n  const trimmed = value.trim().toLowerCase();\r\n  if (!trimmed) {\r\n    return undefined;\r\n  }\r\n  if (trimmed in BORDER_WIDTH_KEYWORD_MAP) {\r\n    return BORDER_WIDTH_KEYWORD_MAP[trimmed];\r\n  }\r\n  return parseLength(value);\r\n}\r\n\r\nexport interface ParsedCornerRadiusPair {\r\n  x: NumericLength;\r\n  y: NumericLength;\r\n}\r\n\r\nexport interface ParsedBorderRadius {\r\n  topLeft: ParsedCornerRadiusPair;\r\n  topRight: ParsedCornerRadiusPair;\r\n  bottomRight: ParsedCornerRadiusPair;\r\n  bottomLeft: ParsedCornerRadiusPair;\r\n}\r\n\r\nexport function parseBorderRadiusShorthand(value: string): ParsedBorderRadius | null {\r\n  const trimmed = value.trim();\r\n  if (!trimmed) {\r\n    return null;\r\n  }\r\n  const [horizontalPart, verticalPart] = trimmed.split(\"/\").map((part) => part.trim());\r\n  const horizontalValues = expandBorderRadiusList(horizontalPart);\r\n  if (!horizontalValues) {\r\n    return null;\r\n  }\r\n  const verticalValues = verticalPart ? expandBorderRadiusList(verticalPart) : horizontalValues;\r\n  if (!verticalValues) {\r\n    return null;\r\n  }\r\n  return {\r\n    topLeft: { x: horizontalValues[0], y: verticalValues[0] },\r\n    topRight: { x: horizontalValues[1], y: verticalValues[1] },\r\n    bottomRight: { x: horizontalValues[2], y: verticalValues[2] },\r\n    bottomLeft: { x: horizontalValues[3], y: verticalValues[3] },\r\n  };\r\n}\r\n\r\nexport function parseBorderCornerRadius(value: string): ParsedCornerRadiusPair | undefined {\r\n  const trimmed = value.trim();\r\n  if (!trimmed) {\r\n    return undefined;\r\n  }\r\n  const [horizontalRaw, verticalRaw] = trimmed.split(\"/\").map((part) => part.trim());\r\n  const horizontalList = splitCssList(horizontalRaw);\r\n  if (horizontalList.length === 0) {\r\n    return undefined;\r\n  }\r\n  const horizontal = parseRadiusValue(horizontalList[0]);\r\n  let vertical: NumericLength;\r\n  if (verticalRaw) {\r\n    const verticalList = splitCssList(verticalRaw);\r\n    vertical = parseRadiusValue(verticalList[0]);\r\n  } else if (horizontalList.length > 1) {\r\n    vertical = parseRadiusValue(horizontalList[1]);\r\n  } else {\r\n    vertical = horizontal;\r\n  }\r\n  return { x: horizontal, y: vertical };\r\n}\r\n\r\nfunction parseRadiusValue(value: string): NumericLength {\r\n  const parsed = parseLength(value);\r\n  if (parsed === undefined) {\r\n    return 0;\r\n  }\r\n  if (typeof parsed === \"number\") {\r\n    return clampPositive(parsed);\r\n  }\r\n  return parsed;\r\n}\r\n\r\nfunction expandBorderRadiusList(input: string | undefined): [NumericLength, NumericLength, NumericLength, NumericLength] | null {\r\n  if (!input) {\r\n    return null;\r\n  }\r\n  const parts = splitCssList(input);\r\n  if (parts.length === 0) {\r\n    return null;\r\n  }\r\n  const resolved = parts.map((part) => parseRadiusValue(part));\r\n  switch (resolved.length) {\r\n    case 1:\r\n      return [resolved[0], resolved[0], resolved[0], resolved[0]];\r\n    case 2:\r\n      return [resolved[0], resolved[1], resolved[0], resolved[1]];\r\n    case 3:\r\n      return [resolved[0], resolved[1], resolved[2], resolved[1]];\r\n    default:\r\n      return [resolved[0], resolved[1], resolved[2], resolved[3]];\r\n  }\r\n}\r\n", "// src/css/parsers/box-shadow-parser.ts\r\n\r\nimport { type BoxShadowInput, type NumericLength } from \"../style.js\";\r\nimport { clampNonNegative, splitCssCommaList, splitCssList } from \"../utils.js\";\r\nimport { parseLength } from \"./length-parser.js\";\r\n\r\nexport function parseBoxShadowList(value: string): BoxShadowInput[] | undefined {\r\n  const trimmed = value.trim();\r\n  if (!trimmed) {\r\n    return undefined;\r\n  }\r\n  const keyword = trimmed.toLowerCase();\r\n  if (keyword === \"none\" || keyword === \"initial\") {\r\n    return [];\r\n  }\r\n  if (keyword === \"inherit\" || keyword === \"revert\" || keyword === \"revert-layer\") {\r\n    return undefined;\r\n  }\r\n  const layers = splitCssCommaList(trimmed);\r\n  const result: BoxShadowInput[] = [];\r\n  for (const layer of layers) {\r\n    const parsed = parseSingleBoxShadow(layer);\r\n    if (parsed) {\r\n      result.push(parsed);\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction parseSingleBoxShadow(input: string): BoxShadowInput | null {\r\n  const tokens = splitCssList(input);\r\n  if (tokens.length === 0) {\r\n    return null;\r\n  }\r\n  let inset = false;\r\n  const lengths: NumericLength[] = [];\r\n  let color: string | undefined;\r\n\r\n  for (const token of tokens) {\r\n    const lowered = token.toLowerCase();\r\n    if (lowered === \"inset\") {\r\n      inset = true;\r\n      continue;\r\n    }\r\n    const length = parseLength(token);\r\n    if (length !== undefined) {\r\n      lengths.push(length);\r\n      continue;\r\n    }\r\n    if (color === undefined) {\r\n      // Check if this looks like a color\r\n      if (isColorLike(token)) {\r\n        color = token;\r\n        continue;\r\n      }\r\n    }\r\n    // Ignore unknown tokens instead of failing\r\n    continue;\r\n  }\r\n\r\n  if (lengths.length < 2) {\r\n    return null;\r\n  }\r\n\r\n  const asLength = (value: NumericLength | undefined, clamp = false): NumericLength => {\r\n    if (value === undefined) {\r\n      return 0;\r\n    }\r\n    if (typeof value === \"number\" && clamp) {\r\n      return clampNonNegative(value);\r\n    }\r\n    if (typeof value === \"number\") {\r\n      return value;\r\n    }\r\n    return value;\r\n  };\r\n\r\n  const offsetX = asLength(lengths[0]);\r\n  const offsetY = asLength(lengths[1]);\r\n  const blurRadius = asLength(lengths[2], true);\r\n  const spreadRadius = asLength(lengths[3]);\r\n\r\n  return {\r\n    inset,\r\n    offsetX,\r\n    offsetY,\r\n    blurRadius,\r\n    spreadRadius,\r\n    color,\r\n  };\r\n}\r\n\r\nfunction isColorLike(value: string): boolean {\r\n  const lowerValue = value.toLowerCase();\r\n  // Basic color detection\r\n  if (lowerValue.startsWith('#') ||\r\n      lowerValue.startsWith('rgb(') ||\r\n      lowerValue.startsWith('rgba(') ||\r\n      lowerValue.startsWith('hsl(') ||\r\n      lowerValue.startsWith('hsla(')) {\r\n    return true;\r\n  }\r\n  // Common color names\r\n  const colorNames = ['transparent', 'black', 'white', 'red', 'green', 'blue', 'yellow', 'gray', 'grey'];\r\n  return colorNames.includes(lowerValue);\r\n}\r\n", "// src/css/shorthands/border-shorthand.ts\r\n\r\nimport { DEFAULT_BORDER_WIDTH, parseBorderShorthand } from \"../parsers/border-parser.js\";\nimport { splitCssList } from \"../utils.js\";\nimport type { NumericLength } from \"../style.js\";\n\nexport function applyBorderShorthand(\n  value: string,\n  applyWidth: (width: NumericLength) => void,\n  applyColor: (color: string | undefined) => void,\n  applyStyle?: (style: string | undefined) => void,\n): void {\n  const parsed = parseBorderShorthand(value);\n  if (!parsed) {\n    return;\n  }\n\n  if (applyStyle) {\n    applyStyle(parsed.style);\n  }\n\n  if (parsed.style === \"none\" || parsed.style === \"hidden\") {\n    applyWidth(0);\n  } else if (parsed.width !== undefined) {\n    applyWidth(parsed.width);\n  } else if (parsed.style) {\n    applyWidth(DEFAULT_BORDER_WIDTH);\n  }\n\n  if (parsed.color !== undefined) {\n    applyColor(parsed.color);\n  }\n}\n\r\nexport function applyBorderColorShorthand(value: string, applyColor: (color: string) => void): void {\r\n  const parts = splitCssList(value);\r\n  if (parts.length === 0) {\r\n    return;\r\n  }\r\n  const [top] =\r\n    parts.length === 1\r\n      ? [parts[0], parts[0], parts[0], parts[0]]\r\n      : parts.length === 2\r\n        ? [parts[0], parts[1], parts[0], parts[1]]\r\n        : parts.length === 3\r\n          ? [parts[0], parts[1], parts[2], parts[1]]\r\n          : [parts[0], parts[1], parts[2], parts[3]];\r\n  if (top) {\r\n    applyColor(top);\r\n  }\r\n}\r\n\r\nexport function applyBorderStyleShorthand(value: string, apply: (style: string | undefined) => void): void {\r\n  const parts = splitCssList(value);\r\n  if (parts.length === 0) {\r\n    return;\r\n  }\r\n  apply(parts[0]?.toLowerCase());\r\n}\r\n\r\nexport function isNoneBorderStyle(value: string): boolean {\r\n  const parts = splitCssList(value);\r\n  if (parts.length === 0) {\r\n    return false;\r\n  }\r\n  const keyword = parts[0]?.toLowerCase();\r\n  return keyword === \"none\" || keyword === \"hidden\";\r\n}\r\n", "// src/css/shorthands/box-shorthand.ts\r\n\r\nimport { parseLength, parseLengthOrAuto } from \"../parsers/length-parser.js\";\nimport { splitCssList } from \"../utils.js\";\nimport type { RelativeLength } from \"../length.js\";\n\ntype BoxLength = number | RelativeLength | \"auto\" | undefined;\n\nexport function applyBoxShorthand<T extends BoxLength = BoxLength>(\n  value: string,\n  apply: (\n    top: T,\n    right: T,\n    bottom: T,\n    left: T,\n  ) => void,\n  parser: (input: string) => T = parseLengthOrAuto as unknown as (input: string) => T,\n): void {\n  const parts = splitCssList(value);\n  if (parts.length === 0) {\n    return;\n  }\n  const resolved = parts.map((part) => parser(part));\r\n  const [top, right, bottom, left] =\r\n    resolved.length === 1\r\n      ? [resolved[0], resolved[0], resolved[0], resolved[0]]\r\n      : resolved.length === 2\r\n        ? [resolved[0], resolved[1], resolved[0], resolved[1]]\r\n        : resolved.length === 3\n          ? [resolved[0], resolved[1], resolved[2], resolved[1]]\n          : [resolved[0], resolved[1], resolved[2], resolved[3]];\n  apply(top as T, right as T, bottom as T, left as T);\n}\n", "// src/css/parsers/border-parser-extended.ts\r\n\r\nimport { BorderModel } from \"../enums.js\";\r\nimport {\r\n  parseBorderCornerRadius,\r\n  parseBorderRadiusShorthand,\r\n  parseBorderWidth as parseBorderWidthValue,\r\n} from \"./border-parser.js\";\r\nimport { parseBoxShadowList } from \"./box-shadow-parser.js\";\r\nimport {\r\n  applyBorderColorShorthand,\r\n  applyBorderStyleShorthand,\r\n  applyBorderShorthand,\r\n  isNoneBorderStyle,\r\n} from \"../shorthands/border-shorthand.js\";\r\nimport { applyBoxShorthand } from \"../shorthands/box-shorthand.js\";\r\nimport type { NumericLength, StyleAccumulator } from \"../style.js\";\r\n\r\nexport function parseBorderColor(value: string, target: StyleAccumulator): void {\r\n  applyBorderColorShorthand(value, (color) => {\r\n    target.borderColor = color;\r\n  });\r\n}\r\n\r\nexport function parseBoxShadow(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseBoxShadowList(value);\r\n  if (parsed !== undefined) {\r\n    target.boxShadows = parsed;\r\n  }\r\n}\r\n\r\nexport function parseBorder(value: string, target: StyleAccumulator): void {\n  applyBorderShorthand(value, (width) => {\n    target.borderTop = width;\n    target.borderRight = width;\n    target.borderBottom = width;\n    target.borderLeft = width;\n  }, (color) => {\n    target.borderColor = color ?? target.borderColor;\n  }, (style) => {\n    if (!style) return;\n    const keyword = style.toLowerCase();\n    target.borderStyleTop = keyword;\n    target.borderStyleRight = keyword;\n    target.borderStyleBottom = keyword;\n    target.borderStyleLeft = keyword;\n  });\n}\n\nexport function parseBorderTop(value: string, target: StyleAccumulator): void {\n  applyBorderShorthand(value, (width) => {\n    target.borderTop = width;\n  }, (color) => {\n    target.borderColor = color ?? target.borderColor;\n  }, (style) => {\n    if (!style) return;\n    target.borderStyleTop = style.toLowerCase();\n  });\n}\n\nexport function parseBorderRight(value: string, target: StyleAccumulator): void {\n  applyBorderShorthand(value, (width) => {\n    target.borderRight = width;\n  }, (color) => {\n    target.borderColor = color ?? target.borderColor;\n  }, (style) => {\n    if (!style) return;\n    target.borderStyleRight = style.toLowerCase();\n  });\n}\n\nexport function parseBorderBottom(value: string, target: StyleAccumulator): void {\n  applyBorderShorthand(value, (width) => {\n    target.borderBottom = width;\n  }, (color) => {\n    target.borderColor = color ?? target.borderColor;\n  }, (style) => {\n    if (!style) return;\n    target.borderStyleBottom = style.toLowerCase();\n  });\n}\n\nexport function parseBorderLeft(value: string, target: StyleAccumulator): void {\n  applyBorderShorthand(value, (width) => {\n    target.borderLeft = width;\n  }, (color) => {\n    target.borderColor = color ?? target.borderColor;\n  }, (style) => {\n    if (!style) return;\n    target.borderStyleLeft = style.toLowerCase();\n  });\n}\n\r\nexport function parseBorderRadius(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseBorderRadiusShorthand(value);\r\n  if (parsed) {\r\n    target.borderTopLeftRadiusX = parsed.topLeft.x;\r\n    target.borderTopLeftRadiusY = parsed.topLeft.y;\r\n    target.borderTopRightRadiusX = parsed.topRight.x;\r\n    target.borderTopRightRadiusY = parsed.topRight.y;\r\n    target.borderBottomRightRadiusX = parsed.bottomRight.x;\r\n    target.borderBottomRightRadiusY = parsed.bottomRight.y;\r\n    target.borderBottomLeftRadiusX = parsed.bottomLeft.x;\r\n    target.borderBottomLeftRadiusY = parsed.bottomLeft.y;\r\n  }\r\n}\r\n\r\nexport function parseBorderTopLeftRadius(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseBorderCornerRadius(value);\r\n  if (parsed) {\r\n    target.borderTopLeftRadiusX = parsed.x;\r\n    target.borderTopLeftRadiusY = parsed.y;\r\n  }\r\n}\r\n\r\nexport function parseBorderTopRightRadius(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseBorderCornerRadius(value);\r\n  if (parsed) {\r\n    target.borderTopRightRadiusX = parsed.x;\r\n    target.borderTopRightRadiusY = parsed.y;\r\n  }\r\n}\r\n\r\nexport function parseBorderBottomRightRadius(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseBorderCornerRadius(value);\r\n  if (parsed) {\r\n    target.borderBottomRightRadiusX = parsed.x;\r\n    target.borderBottomRightRadiusY = parsed.y;\r\n  }\r\n}\r\n\r\nexport function parseBorderBottomLeftRadius(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseBorderCornerRadius(value);\r\n  if (parsed) {\r\n    target.borderBottomLeftRadiusX = parsed.x;\r\n    target.borderBottomLeftRadiusY = parsed.y;\r\n  }\r\n}\r\n\r\nexport function parseBorderWidth(value: string, target: StyleAccumulator): void {\r\n  applyBoxShorthand(\r\n    value,\r\n    (\r\n      top: NumericLength | undefined,\r\n      right: NumericLength | undefined,\r\n      bottom: NumericLength | undefined,\r\n      left: NumericLength | undefined,\r\n    ) => {\r\n      target.borderTop = top;\r\n      target.borderRight = right;\r\n      target.borderBottom = bottom;\r\n      target.borderLeft = left;\r\n    },\r\n    parseBorderWidthValue,\r\n  );\r\n}\r\n\r\nexport function parseBorderTopWidth(value: string, target: StyleAccumulator): void {\r\n  target.borderTop = parseBorderWidthValue(value) ?? target.borderTop;\r\n}\r\n\r\nexport function parseBorderRightWidth(value: string, target: StyleAccumulator): void {\r\n  target.borderRight = parseBorderWidthValue(value) ?? target.borderRight;\r\n}\r\n\r\nexport function parseBorderBottomWidth(value: string, target: StyleAccumulator): void {\r\n  target.borderBottom = parseBorderWidthValue(value) ?? target.borderBottom;\r\n}\r\n\r\nexport function parseBorderLeftWidth(value: string, target: StyleAccumulator): void {\r\n  target.borderLeft = parseBorderWidthValue(value) ?? target.borderLeft;\r\n}\r\n\r\nexport function parseBorderTopColor(value: string, target: StyleAccumulator): void {\r\n  if (value.trim()) {\r\n    target.borderColor = value.trim();\r\n  }\r\n}\r\n\r\nexport function parseBorderRightColor(value: string, target: StyleAccumulator): void {\r\n  if (value.trim()) {\r\n    target.borderColor = value.trim();\r\n  }\r\n}\r\n\r\nexport function parseBorderBottomColor(value: string, target: StyleAccumulator): void {\r\n  if (value.trim()) {\r\n    target.borderColor = value.trim();\r\n  }\r\n}\r\n\r\nexport function parseBorderLeftColor(value: string, target: StyleAccumulator): void {\r\n  if (value.trim()) {\r\n    target.borderColor = value.trim();\r\n  }\r\n}\r\n\r\nexport function parseBorderStyle(value: string, target: StyleAccumulator): void {\n  applyBorderStyleShorthand(value, (style) => {\n    if (!style) {\n      return;\n    }\n    const keyword = style.toLowerCase();\n    target.borderStyleTop = keyword;\n    target.borderStyleRight = keyword;\n    target.borderStyleBottom = keyword;\n    target.borderStyleLeft = keyword;\n    if (keyword === \"none\" || keyword === \"hidden\") {\n      target.borderTop = 0;\n      target.borderRight = 0;\n      target.borderBottom = 0;\n      target.borderLeft = 0;\n    }\n  });\n}\n\nexport function parseBorderTopStyle(value: string, target: StyleAccumulator): void {\n  const parts = value.trim().toLowerCase();\n  if (!parts) return;\n  target.borderStyleTop = parts;\n  if (isNoneBorderStyle(value)) {\n    target.borderTop = 0;\n  }\n}\n\nexport function parseBorderRightStyle(value: string, target: StyleAccumulator): void {\n  const parts = value.trim().toLowerCase();\n  if (!parts) return;\n  target.borderStyleRight = parts;\n  if (isNoneBorderStyle(value)) {\n    target.borderRight = 0;\n  }\n}\n\nexport function parseBorderBottomStyle(value: string, target: StyleAccumulator): void {\n  const parts = value.trim().toLowerCase();\n  if (!parts) return;\n  target.borderStyleBottom = parts;\n  if (isNoneBorderStyle(value)) {\n    target.borderBottom = 0;\n  }\n}\n\nexport function parseBorderLeftStyle(value: string, target: StyleAccumulator): void {\n  const parts = value.trim().toLowerCase();\n  if (!parts) return;\n  target.borderStyleLeft = parts;\n  if (isNoneBorderStyle(value)) {\n    target.borderLeft = 0;\n  }\n}\n\r\nexport function parseBorderCollapse(value: string, target: StyleAccumulator): void {\r\n  const keyword = value.trim().toLowerCase();\r\n  target.borderModel = keyword === \"collapse\" ? BorderModel.Collapse : BorderModel.Separate;\r\n}\r\n", "// src/css/parsers/border-block-parser.ts\r\n\r\nimport { applyBorderShorthand } from \"../shorthands/border-shorthand.js\";\r\nimport type { StyleAccumulator } from \"../style.js\";\r\n\r\nexport function parseBorderBlockStart(value: string, target: StyleAccumulator): void {\n  applyBorderShorthand(value, (width) => {\n    target.borderTop = width;\n  }, (color) => {\n    target.borderColor = color ?? target.borderColor;\n  }, (style) => {\n    if (!style) return;\n    target.borderStyleTop = style.toLowerCase();\n  });\n}\n\nexport function parseBorderBlockEnd(value: string, target: StyleAccumulator): void {\n  applyBorderShorthand(value, (width) => {\n    target.borderBottom = width;\n  }, (color) => {\n    target.borderColor = color ?? target.borderColor;\n  }, (style) => {\n    if (!style) return;\n    target.borderStyleBottom = style.toLowerCase();\n  });\n}\n", "// src/css/parsers/border-inline-parser.ts\r\n\r\nimport { applyBorderShorthand } from \"../shorthands/border-shorthand.js\";\r\nimport type { StyleAccumulator } from \"../style.js\";\r\n\r\nexport function parseBorderInlineStart(value: string, target: StyleAccumulator): void {\n  applyBorderShorthand(value, (width) => {\n    target.borderLeft = width;\n  }, (color) => {\n    target.borderColor = color ?? target.borderColor;\n  }, (style) => {\n    if (!style) return;\n    target.borderStyleLeft = style.toLowerCase();\n  });\n}\n\nexport function parseBorderInlineEnd(value: string, target: StyleAccumulator): void {\n  applyBorderShorthand(value, (width) => {\n    target.borderRight = width;\n  }, (color) => {\n    target.borderColor = color ?? target.borderColor;\n  }, (style) => {\n    if (!style) return;\n    target.borderStyleRight = style.toLowerCase();\n  });\n}\n", "// src/css/parsers/margin-parser.ts\r\n\nimport { applyBoxShorthand } from \"../shorthands/box-shorthand.js\";\nimport { parseLength, parseLengthOrAuto } from \"./length-parser.js\";\nimport type { StyleAccumulator } from \"../style.js\";\n\nexport function parseMargin(value: string, target: StyleAccumulator): void {\n  applyBoxShorthand(value, (top, right, bottom, left) => {\n    target.marginTop = top;\n    target.marginRight = right;\n    target.marginBottom = bottom;\n    target.marginLeft = left;\n  });\n}\r\n\r\nexport function parseMarginTop(value: string, target: StyleAccumulator): void {\r\n  target.marginTop = parseLength(value) ?? target.marginTop;\r\n}\r\n\r\nexport function parseMarginRight(value: string, target: StyleAccumulator): void {\n  target.marginRight = parseLengthOrAuto(value) ?? target.marginRight;\n}\n\nexport function parseMarginBottom(value: string, target: StyleAccumulator): void {\n  target.marginBottom = parseLength(value) ?? target.marginBottom;\n}\n\nexport function parseMarginLeft(value: string, target: StyleAccumulator): void {\n  target.marginLeft = parseLengthOrAuto(value) ?? target.marginLeft;\n}\n", "// src/css/parsers/margin-block-parser.ts\r\n\r\nimport { parseLength } from \"./length-parser.js\";\r\nimport type { StyleAccumulator } from \"../style.js\";\r\n\r\nexport function parseMarginBlockStart(value: string, target: StyleAccumulator): void {\r\n  target.marginTop = parseLength(value) ?? target.marginTop;\r\n}\r\n\r\nexport function parseMarginBlockEnd(value: string, target: StyleAccumulator): void {\r\n  target.marginBottom = parseLength(value) ?? target.marginBottom;\r\n}\r\n", "// src/css/parsers/margin-inline-parser.ts\r\n\r\nimport { parseLengthOrAuto } from \"./length-parser.js\";\nimport type { StyleAccumulator } from \"../style.js\";\n\nexport function parseMarginInlineStart(value: string, target: StyleAccumulator): void {\n  target.marginLeft = parseLengthOrAuto(value) ?? target.marginLeft;\n}\n\nexport function parseMarginInlineEnd(value: string, target: StyleAccumulator): void {\n  target.marginRight = parseLengthOrAuto(value) ?? target.marginRight;\n}\n", "// src/css/parsers/padding-parser.ts\r\n\r\nimport { applyBoxShorthand } from \"../shorthands/box-shorthand.js\";\r\nimport { parseLength } from \"./length-parser.js\";\r\nimport type { StyleAccumulator } from \"../style.js\";\r\n\r\nexport function parsePadding(value: string, target: StyleAccumulator): void {\n  applyBoxShorthand(value, (top, right, bottom, left) => {\n    target.paddingTop = top;\n    target.paddingRight = right;\n    target.paddingBottom = bottom;\n    target.paddingLeft = left;\n  }, parseLength);\n}\n\r\nexport function parsePaddingTop(value: string, target: StyleAccumulator): void {\r\n  target.paddingTop = parseLength(value) ?? target.paddingTop;\r\n}\r\n\r\nexport function parsePaddingRight(value: string, target: StyleAccumulator): void {\r\n  target.paddingRight = parseLength(value) ?? target.paddingRight;\r\n}\r\n\r\nexport function parsePaddingBottom(value: string, target: StyleAccumulator): void {\r\n  target.paddingBottom = parseLength(value) ?? target.paddingBottom;\r\n}\r\n\r\nexport function parsePaddingLeft(value: string, target: StyleAccumulator): void {\r\n  target.paddingLeft = parseLength(value) ?? target.paddingLeft;\r\n}\r\n", "// src/css/parsers/padding-block-parser.ts\r\n\r\nimport { parseLength } from \"./length-parser.js\";\r\nimport type { StyleAccumulator } from \"../style.js\";\r\n\r\nexport function parsePaddingBlockStart(value: string, target: StyleAccumulator): void {\r\n  target.paddingTop = parseLength(value) ?? target.paddingTop;\r\n}\r\n\r\nexport function parsePaddingBlockEnd(value: string, target: StyleAccumulator): void {\r\n  target.paddingBottom = parseLength(value) ?? target.paddingBottom;\r\n}\r\n", "// src/css/parsers/padding-inline-parser.ts\r\n\r\nimport { parseLength } from \"./length-parser.js\";\r\nimport type { StyleAccumulator } from \"../style.js\";\r\n\r\nexport function parsePaddingInlineStart(value: string, target: StyleAccumulator): void {\r\n  target.paddingLeft = parseLength(value) ?? target.paddingLeft;\r\n}\r\n\r\nexport function parsePaddingInlineEnd(value: string, target: StyleAccumulator): void {\r\n  target.paddingRight = parseLength(value) ?? target.paddingRight;\r\n}\r\n", "import { parseLength, parseNumeric } from \"./length-parser.js\";\r\nimport { percent } from \"../length.js\";\r\nimport type { LengthLike, RelativeLength } from \"../length.js\";\r\nimport type { StyleAccumulator } from \"../style.js\";\r\nimport type { LineHeightInput } from \"../line-height.js\";\r\n\r\nconst PERCENT_LENGTH_REGEX = /^(-?\\d+(?:\\.\\d+)?)%$/;\r\n\r\ntype LengthOrRelative = LengthLike | RelativeLength;\r\n\r\nfunction parseLengthOrPercent(value: string): LengthOrRelative | undefined {\r\n  const parsed = parseLength(value);\r\n  if (parsed !== undefined) {\r\n    return parsed;\r\n  }\r\n  const match = PERCENT_LENGTH_REGEX.exec(value.trim());\r\n  if (!match) {\r\n    return undefined;\r\n  }\r\n  const numeric = Number.parseFloat(match[1]);\r\n  if (Number.isNaN(numeric)) {\r\n    return undefined;\r\n  }\r\n  return percent(numeric / 100);\r\n}\r\n\r\nexport function parseWidth(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseLengthOrPercent(value);\r\n  if (parsed !== undefined) {\r\n    target.width = parsed;\r\n  }\r\n}\r\n\r\nexport function parseMinWidth(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseLengthOrPercent(value);\r\n  if (parsed !== undefined) {\r\n    target.minWidth = parsed;\r\n  }\r\n}\r\n\r\nexport function parseMaxWidth(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseLengthOrPercent(value);\r\n  if (parsed !== undefined) {\r\n    target.maxWidth = parsed;\r\n  }\r\n}\r\n\r\nexport function parseHeight(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseLengthOrPercent(value);\r\n  if (parsed !== undefined) {\r\n    target.height = parsed;\r\n  }\r\n}\r\n\r\nexport function parseMinHeight(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseLengthOrPercent(value);\r\n  if (parsed !== undefined) {\r\n    target.minHeight = parsed;\r\n  }\r\n}\r\n\r\nexport function parseMaxHeight(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseLengthOrPercent(value);\r\n  if (parsed !== undefined) {\r\n    target.maxHeight = parsed;\r\n  }\r\n}\r\n\r\nexport function parseFontSize(value: string, target: StyleAccumulator): void {\r\n  target.fontSize = parseNumeric(value) ?? target.fontSize;\r\n}\r\n\r\nfunction parseLineHeightValue(value: string): LineHeightInput | undefined {\r\n  const trimmed = value.trim();\r\n  if (!trimmed) {\r\n    return undefined;\r\n  }\r\n  const normalized = trimmed.toLowerCase();\r\n  if (normalized === \"normal\") {\r\n    return { kind: \"normal\" };\r\n  }\r\n  if (/^[+-]?\\d+(?:\\.\\d+)?%$/.test(normalized)) {\r\n    const numeric = Number.parseFloat(normalized.slice(0, -1));\r\n    if (Number.isNaN(numeric)) {\r\n      return undefined;\r\n    }\r\n    return { kind: \"unitless\", value: numeric / 100 };\r\n  }\r\n  if (/^[+-]?\\d+(?:\\.\\d+)?$/.test(normalized)) {\r\n    const numeric = Number.parseFloat(normalized);\r\n    if (Number.isNaN(numeric)) {\r\n      return undefined;\r\n    }\r\n    return { kind: \"unitless\", value: numeric };\r\n  }\r\n  const parsed = parseLength(trimmed);\r\n  if (parsed !== undefined) {\r\n    return { kind: \"length\", value: parsed };\r\n  }\r\n  return undefined;\r\n}\r\n\r\nexport function parseLineHeight(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseLineHeightValue(value);\r\n  if (parsed) {\r\n    target.lineHeight = parsed;\r\n  }\r\n}\r\n\r\nexport function parseZIndex(value: string, target: StyleAccumulator): void {\r\n  const trimmed = value.trim();\r\n  if (trimmed.toLowerCase() === \"auto\") {\r\n    target.zIndex = \"auto\";\r\n  } else if (/^-?\\d+$/.test(trimmed)) {\r\n    target.zIndex = Number.parseInt(trimmed, 10);\r\n  }\r\n}\r\n", "// src/css/parsers/font-parser.ts\n\nimport { parseFontWeightValue } from \"../font-weight.js\";\nimport type { StyleAccumulator } from \"../style.js\";\nimport type { UnitParsers } from \"../../units/units.js\";\n\nexport function parseFontFamily(value: string, target: StyleAccumulator): void {\n  target.fontFamily = value;\n}\n\nexport function parseFontStyle(value: string, target: StyleAccumulator): void {\n  const normalized = value.trim().toLowerCase();\n  if (normalized === \"inherit\") {\n    // Let inheritance fall back to parent; no override needed.\n    return;\n  }\n\n  if (normalized === \"normal\" || normalized === \"italic\" || normalized === \"oblique\" || normalized.startsWith(\"oblique \")) {\n    target.fontStyle = normalized.startsWith(\"oblique\") ? \"oblique\" : normalized;\n  }\n}\n\nexport function parseFontWeight(value: string, target: StyleAccumulator, _units: UnitParsers, inheritedFontWeight?: number): void {\n  const parsed = parseFontWeightValue(value, inheritedFontWeight);\n  if (parsed !== undefined) {\n    target.fontWeight = parsed;\n  }\n}\n\nexport function parseFontVariant(value: string, target: StyleAccumulator): void {\n  const normalized = value.trim().toLowerCase();\n  if (normalized === \"inherit\") {\n    // Let inheritance fall back to parent; no override needed.\n    return;\n  }\n\n  if (normalized === \"normal\" || normalized === \"small-caps\") {\n    target.fontVariant = normalized;\n  }\n}\n", "import { Position } from \"../enums.js\";\nimport { percent } from \"../length.js\";\nimport type { LengthInput } from \"../length.js\";\nimport type { StyleAccumulator } from \"../style.js\";\nimport { parseLength } from \"./length-parser.js\";\n\nconst PERCENT_LENGTH_REGEX = /^(-?\\d+(?:\\.\\d+)?)%$/;\n\nfunction parseLengthLike(value: string): LengthInput | undefined {\n  const trimmed = value.trim();\n  if (!trimmed) {\n    return undefined;\n  }\n  if (trimmed.toLowerCase() === \"auto\") {\n    return \"auto\";\n  }\n\n  const parsed = parseLength(trimmed);\n  if (parsed !== undefined) {\n    return parsed;\n  }\n\n  const percentMatch = PERCENT_LENGTH_REGEX.exec(trimmed);\n  if (percentMatch) {\n    const numeric = Number.parseFloat(percentMatch[1]);\n    if (!Number.isNaN(numeric)) {\n      return percent(numeric / 100);\n    }\n  }\n\n  return undefined;\n}\n\nexport function parsePosition(value: string, target: StyleAccumulator): void {\n  const normalized = value.trim().toLowerCase();\n  switch (normalized) {\n    case Position.Static:\n    case Position.Relative:\n    case Position.Absolute:\n    case Position.Fixed:\n    case Position.Sticky:\n      target.position = normalized as Position;\n      break;\n    default:\n      break;\n  }\n}\n\nexport function parseTop(value: string, target: StyleAccumulator): void {\n  const parsed = parseLengthLike(value);\n  if (parsed !== undefined) {\n    target.top = parsed;\n  }\n}\n\nexport function parseRight(value: string, target: StyleAccumulator): void {\n  const parsed = parseLengthLike(value);\n  if (parsed !== undefined) {\n    target.right = parsed;\n  }\n}\n\nexport function parseBottom(value: string, target: StyleAccumulator): void {\n  const parsed = parseLengthLike(value);\n  if (parsed !== undefined) {\n    target.bottom = parsed;\n  }\n}\n\nexport function parseLeft(value: string, target: StyleAccumulator): void {\n  const parsed = parseLengthLike(value);\n  if (parsed !== undefined) {\n    target.left = parsed;\n  }\n}\n", "// src/css/parsers/text-parser.ts\r\n\r\nexport function parseTextDecorationLine(value: string): string | undefined {\r\n  if (!value) {\r\n    return undefined;\r\n  }\r\n  const tokens = value\r\n    .trim()\r\n    .toLowerCase()\r\n    .split(/\\s+/)\r\n    .filter(Boolean);\r\n  if (tokens.length === 0) {\r\n    return undefined;\r\n  }\r\n  if (tokens.includes(\"none\")) {\r\n    return \"none\";\r\n  }\r\n  const allowed = new Set([\"underline\", \"overline\", \"line-through\"]);\r\n  const matches = tokens.filter((token) => allowed.has(token));\r\n  if (matches.length === 0) {\r\n    return undefined;\r\n  }\r\n  const unique = [...new Set(matches)];\r\n  return unique.join(\" \");\r\n}\r\n", "// src/css/parsers/text-parser-extended.ts\r\n\r\nimport { parseTextDecorationLine as parseTextDecorationLineValue } from \"./text-parser.js\";\r\nimport { parseLengthOrPercent, parseNumeric } from \"./length-parser.js\";\nimport type { StyleAccumulator, TextTransform } from \"../style.js\";\r\nimport { NAMED_COLORS } from \"../named-colors.js\";\r\n\r\nexport function parseTextAlign(value: string, target: StyleAccumulator): void {\r\n  target.textAlign = value.toLowerCase();\r\n}\r\n\r\nexport function parseTextDecoration(value: string, target: StyleAccumulator): void {\n  const parsed = parseTextDecorationLineValue(value);\n  if (parsed !== undefined) {\n    target.textDecorationLine = parsed;\n  }\n  const style = extractTextDecorationStyle(value);\n  if (style) {\n    target.textDecorationStyle = style;\n  }\n  const color = extractTextDecorationColor(value);\n  if (color) {\n    target.textDecorationColor = color;\n  }\n}\n\r\nexport function parseTextDecorationLine(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseTextDecorationLineValue(value);\r\n  if (parsed !== undefined) {\r\n    target.textDecorationLine = parsed;\r\n  }\r\n}\r\n\r\nexport function parseTextDecorationColor(value: string, target: StyleAccumulator): void {\n  const trimmed = value.trim();\n  if (!trimmed) {\n    return;\n  }\n  target.textDecorationColor = trimmed;\n}\n\nexport function parseTextDecorationStyle(value: string, target: StyleAccumulator): void {\n  const style = extractTextDecorationStyle(value);\n  if (style) {\n    target.textDecorationStyle = style;\n  }\n}\n\r\nexport function parseFloat(value: string, target: StyleAccumulator): void {\r\n  target.float = value;\r\n}\r\n\r\nexport function parseTextIndent(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseLengthOrPercent(value);\r\n  if (parsed !== undefined) {\r\n    target.textIndent = parsed;\r\n  }\r\n}\r\n\r\nexport function parseTextTransform(value: string, target: StyleAccumulator): void {\r\n  const normalized = value.trim().toLowerCase();\r\n  if (normalized === \"initial\") {\r\n    target.textTransform = \"none\";\r\n    return;\r\n  }\r\n  if (INHERITABLE_KEYWORDS.has(normalized)) {\r\n    return;\r\n  }\r\n  const resolved = TEXT_TRANSFORM_KEYWORDS[normalized];\r\n  if (resolved) {\r\n    target.textTransform = resolved;\r\n  }\r\n}\r\n\r\nexport function parseLetterSpacing(value: string, target: StyleAccumulator): void {\r\n  const normalized = value.trim().toLowerCase();\r\n  if (!normalized) {\r\n    return;\r\n  }\r\n  if (normalized === \"normal\") {\r\n    target.letterSpacing = 0;\r\n    return;\r\n  }\r\n  if (INHERITABLE_KEYWORDS.has(normalized)) {\r\n    return;\r\n  }\r\n  const parsed = parseNumeric(value);\r\n  if (parsed !== undefined) {\r\n    target.letterSpacing = parsed;\r\n  }\r\n}\r\n\r\nconst TEXT_TRANSFORM_KEYWORDS: Record<string, TextTransform> = {\r\n  none: \"none\",\r\n  uppercase: \"uppercase\",\r\n  lowercase: \"lowercase\",\r\n  capitalize: \"capitalize\",\r\n};\r\n\r\nconst INHERITABLE_KEYWORDS = new Set([\"inherit\", \"unset\", \"revert\", \"revert-layer\"]);\r\n\r\nconst COLOR_KEYWORDS = new Set(Object.keys(NAMED_COLORS).map((name) => name.toLowerCase()));\r\nCOLOR_KEYWORDS.add(\"transparent\");\nCOLOR_KEYWORDS.add(\"currentcolor\");\nconst DECORATION_LINE_KEYWORDS = new Set([\"underline\", \"overline\", \"line-through\", \"none\"]);\nconst DECORATION_STYLE_KEYWORDS = new Set([\"solid\", \"double\", \"dotted\", \"dashed\", \"wavy\"]);\n\nfunction extractTextDecorationStyle(value: string): string | undefined {\n  if (!value) {\n    return undefined;\n  }\n  const tokens = value.trim().toLowerCase().split(/\\s+/);\n  for (const token of tokens) {\n    if (DECORATION_STYLE_KEYWORDS.has(token)) {\n      return token;\n    }\n  }\n  return undefined;\n}\n\r\nfunction extractTextDecorationColor(value: string): string | undefined {\r\n  if (!value) {\r\n    return undefined;\r\n  }\r\n  const functionalMatch = value.match(/\\b(?:rgba?|hsla?)\\([^)]*\\)/i);\r\n  if (functionalMatch) {\r\n    return functionalMatch[0].trim();\r\n  }\r\n  const hexMatch = value.match(/#[0-9a-f]{3,8}\\b/i);\r\n  if (hexMatch) {\r\n    return hexMatch[0];\r\n  }\r\n  const tokens = value.trim().split(/\\s+/);\r\n  for (const token of tokens) {\r\n    const normalized = token.toLowerCase();\r\n    if (DECORATION_LINE_KEYWORDS.has(normalized)) {\r\n      continue;\r\n    }\r\n    if (COLOR_KEYWORDS.has(normalized)) {\r\n      return normalized;\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n", "// src/css/parsers/overflow-wrap-parser.ts\n\nimport type { OverflowWrap, StyleAccumulator } from \"../style.js\";\n\nfunction normalizeOverflowWrap(value: string): OverflowWrap | undefined {\n  switch (value) {\n    case \"normal\":\n      return \"normal\";\n    case \"anywhere\":\n      return \"anywhere\";\n    case \"break-word\":\n      return \"break-word\";\n    default:\n      return undefined;\n  }\n}\n\nexport function parseOverflowWrap(value: string, target: StyleAccumulator): void {\n  if (!value) {\n    return;\n  }\n  const keyword = normalizeOverflowWrap(value.trim().toLowerCase());\n  if (keyword) {\n    target.overflowWrap = keyword;\n  }\n}\n\nexport function parseWordWrap(value: string, target: StyleAccumulator): void {\n  if (!value) {\n    return;\n  }\n  const keyword = normalizeOverflowWrap(value.trim().toLowerCase());\n  if (!keyword) {\n    return;\n  }\n  // The legacy property only supports normal/break-word, but map through the same normalization.\n  target.overflowWrap = keyword === \"anywhere\" ? \"break-word\" : keyword;\n}\n", "import { type TextShadowInput, type StyleAccumulator } from \"../style.js\";\r\nimport { clampNonNegative, splitCssCommaList, splitCssList } from \"../utils.js\";\r\nimport { parseLength } from \"./length-parser.js\";\r\n\r\nexport function parseTextShadowList(value: string): TextShadowInput[] | undefined {\r\n  const trimmed = value.trim();\r\n  if (!trimmed) {\r\n    return undefined;\r\n  }\r\n  const keyword = trimmed.toLowerCase();\r\n  if (keyword === \"none\" || keyword === \"initial\") {\r\n    return [];\r\n  }\r\n  if (keyword === \"inherit\" || keyword === \"revert\" || keyword === \"revert-layer\") {\r\n    return undefined;\r\n  }\r\n  const layers = splitCssCommaList(trimmed);\r\n  const result: TextShadowInput[] = [];\r\n  for (const layer of layers) {\r\n    const parsed = parseSingleTextShadow(layer);\r\n    if (parsed) {\r\n      result.push(parsed);\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\n// Wrapper parser used by the declarations registry: assigns parsed value to the style accumulator\r\nexport function parseTextShadow(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseTextShadowList(value);\r\n  if (parsed !== undefined) {\r\n    target.textShadows = parsed;\r\n  }\r\n}\r\n\r\nfunction parseSingleTextShadow(input: string): TextShadowInput | null {\r\n  const tokens = splitCssList(input);\r\n  if (tokens.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  const lengths = [];\r\n  let color: string | undefined;\r\n\r\n  for (const token of tokens) {\r\n    const length = parseLength(token);\r\n    if (length !== undefined) {\r\n      lengths.push(length);\r\n      continue;\r\n    }\r\n    if (color === undefined) {\r\n      // Heuristic for color tokens\r\n      const lowered = token.toLowerCase();\r\n      if (isColorLike(lowered)) {\r\n        color = token;\r\n        continue;\r\n      }\r\n    }\r\n    // ignore unknown tokens\r\n  }\r\n\r\n  if (lengths.length < 2) {\r\n    return null;\r\n  }\r\n\r\n  const asLength = (value: any, clamp = false) => {\r\n    if (value === undefined) return 0;\r\n    if (typeof value === \"number\" && clamp) {\r\n      return clampNonNegative(value);\r\n    }\r\n    if (typeof value === \"number\") return value;\r\n    return value;\r\n  };\r\n\r\n  const offsetX = asLength(lengths[0]);\r\n  const offsetY = asLength(lengths[1]);\r\n  const blurRadius = asLength(lengths[2], true);\r\n\r\n  return {\r\n    offsetX,\r\n    offsetY,\r\n    blurRadius,\r\n    color,\r\n  };\r\n}\r\n\r\nfunction isColorLike(value: string): boolean {\r\n  if (!value) return false;\r\n  if (value.startsWith(\"#\") || value.startsWith(\"rgb(\") || value.startsWith(\"rgba(\") || value.startsWith(\"hsl(\") || value.startsWith(\"hsla(\")) {\r\n    return true;\r\n  }\r\n  const colorNames = ['transparent', 'black', 'white', 'red', 'green', 'blue', 'yellow', 'gray', 'grey'];\r\n  return colorNames.includes(value.toLowerCase());\r\n}\r\n", "// src/css/parsers/list-style-parser.ts\r\n\r\nimport type { StyleAccumulator } from \"../style.js\";\r\n\r\nconst LIST_STYLE_KEYWORD_MAP: Record<string, string> = {\r\n  none: \"none\",\r\n  disc: \"disc\",\r\n  circle: \"circle\",\r\n  square: \"square\",\r\n  decimal: \"decimal\",\r\n  \"decimal-leading-zero\": \"decimal-leading-zero\",\r\n  \"lower-alpha\": \"lower-alpha\",\r\n  \"lower-latin\": \"lower-alpha\",\r\n  \"upper-alpha\": \"upper-alpha\",\r\n  \"upper-latin\": \"upper-alpha\",\r\n  \"lower-roman\": \"lower-roman\",\r\n  \"upper-roman\": \"upper-roman\",\r\n};\r\n\r\nconst INHERITABLE_KEYWORDS = new Set([\"inherit\", \"unset\", \"revert\", \"revert-layer\"]);\r\n\r\nexport function parseListStyleType(value: string, target: StyleAccumulator): void {\r\n  if (!value) {\r\n    return;\r\n  }\r\n  const normalized = value.trim().toLowerCase();\r\n  if (!normalized) {\r\n    return;\r\n  }\r\n  if (normalized === \"initial\") {\r\n    target.listStyleType = \"disc\";\r\n    return;\r\n  }\r\n  if (INHERITABLE_KEYWORDS.has(normalized)) {\r\n    return;\r\n  }\r\n  target.listStyleType = LIST_STYLE_KEYWORD_MAP[normalized] ?? normalized;\r\n}\r\n\r\n", "import { splitCssCommaList, splitCssList } from \"../utils.js\";\r\n\r\nexport interface GradientStop {\r\n  color: string;\r\n  position?: number;\r\n}\r\n\r\nexport interface LinearGradient {\r\n  type: \"linear\";\r\n  direction: string;\r\n  stops: GradientStop[];\r\n  // Optional coordinate hints (used when converting SVG gradients)\r\n  coords?: { x1: number; y1: number; x2: number; y2: number; units: \"ratio\" | \"userSpace\" };\r\n  renderOffset?: { x: number; y: number };\r\n  renderScale?: { x: number; y: number };\r\n}\r\n\r\nexport interface RadialGradient {\n  type: \"radial\";\n  cx: number;\n  cy: number;\n  r: number;\n  fx?: number;\n  fy?: number;\n  stops: GradientStop[];\n  // Optional coordinate units: \"ratio\" = objectBoundingBox (0..1), \"userSpace\" = absolute page pixels\n  coordsUnits?: \"ratio\" | \"userSpace\";\n  // Optional transform parsed from SVG's gradientTransform (matrix with a,b,c,d,e,f)\n  transform?: { a: number; b: number; c: number; d: number; e: number; f: number };\n  // gradientUnits omitted for CSS radial gradients; SVG will supply via its own node conversion\n  shape?: \"circle\" | \"ellipse\";\n  size?: \"closest-side\" | \"farthest-side\" | \"closest-corner\" | \"farthest-corner\" | string;\n  at?: { x: string; y: string };\n  source?: \"css\" | \"svg\";\n}\n\nexport function parseLinearGradient(value: string): LinearGradient | null {\n  const trimmed = value.trim();\n  console.log(\"parseLinearGradient - input:\", value);\n  console.log(\"parseLinearGradient - trimmed:\", trimmed);\r\n\r\n  // Check if it's a linear gradient (case-insensitive check)\r\n  if (!trimmed.toLowerCase().startsWith(\"linear-gradient(\")) {\r\n    console.log(\"parseLinearGradient - not a linear gradient, returning null\");\r\n    return null;\r\n  }\r\n\r\n  // Extract the content inside parentheses\r\n  const content = trimmed.slice(\"linear-gradient(\".length, -1);\r\n  if (!content) {\r\n    return null;\r\n  }\r\n  \r\n  // Parse the gradient content\r\n  let direction = 'to bottom'; // default\r\n  let colorStopsContent = content;\r\n\r\n  // Check if the first comma-separated part looks like a direction\r\n  // We need to be more careful to find the first actual comma that separates direction from color stops\r\n  // rather than commas inside parentheses like in \"linear-gradient(45deg, red, blue)\"\r\n  let commaPos = -1;\r\n  let parenCount = 0;\r\n  for (let i = 0; i < content.length; i++) {\r\n    if (content[i] === '(') {\r\n      parenCount++;\r\n    } else if (content[i] === ')') {\r\n      parenCount--;\r\n    } else if (content[i] === ',' && parenCount === 0) {\r\n      commaPos = i;\r\n      break;\r\n    }\r\n  }\r\n\r\n  if (commaPos !== -1) {\r\n    const potentialDirection = content.substring(0, commaPos).trim();\r\n    const lowerDirection = potentialDirection.toLowerCase();\r\n\r\n    // Check if this part is a known direction\r\n    const directionPatterns = ['to', 'to bottom', 'to right', 'to left', 'to top right', 'to top left', 'to bottom right', 'to bottom left'];\r\n    const isDirection = directionPatterns.some(pattern => lowerDirection === pattern) ||\r\n                       lowerDirection.endsWith('deg');\r\n\r\n    if (isDirection) {\r\n      direction = lowerDirection;\r\n      colorStopsContent = content.substring(commaPos + 1).trim();\r\n    } else {\r\n      // If it's not a direction, treat the whole content as color stops\r\n      colorStopsContent = content;\r\n    }\r\n  } else {\r\n    // Single part - check if it's just a direction\r\n    const trimmedContent = content.trim().toLowerCase();\r\n    if (trimmedContent === 'to' ||\r\n        trimmedContent.startsWith('to ') ||\r\n        trimmedContent.endsWith('deg')) {\r\n      direction = trimmedContent;\r\n      colorStopsContent = '';\r\n    } else {\r\n      // Otherwise, treat as color stops\r\n      colorStopsContent = content;\r\n    }\r\n  }\r\n  \r\n  // Clean up direction value\r\n  if (direction.startsWith('to ')) {\r\n    // Fix truncated direction values\r\n    if (direction === 'to righ') {\r\n      direction = 'to right';\r\n    } else if (direction === 'to botto') {\r\n      direction = 'to bottom';\r\n    } else if (direction === 'to bott') {\r\n      direction = 'to bottom';\r\n    } else if (direction === 'to bot') {\r\n      direction = 'to bottom';\r\n    }\r\n    // Remove trailing comma from \"to\" directions\r\n    direction = direction.replace(/,$/, '');\r\n  } else if (direction.endsWith('deg')) {\r\n    // Remove comma from angle values\r\n    direction = direction.replace(/,$/, '');\r\n  }\r\n  \r\n  // Clean up direction value\r\n  if (direction.startsWith('to ')) {\r\n    // Remove trailing comma from \"to\" directions\r\n    direction = direction.replace(/,$/, '');\r\n  } else if (direction.endsWith('deg')) {\r\n    // Remove comma from angle values\r\n    direction = direction.replace(/,$/, '');\r\n  }\r\n  \r\n  // Now split the color stops by commas that are not inside parentheses or quotes\r\n  const colorStopValues = splitCssCommaList(colorStopsContent);\r\n  \r\n  console.log(\"Gradient parser - input value:\", value);\r\n  console.log(\"Gradient parser - content:\", content);\r\n  console.log(\"Gradient parser - direction:\", direction);\r\n  console.log(\"Gradient parser - colorStopsContent:\", colorStopsContent);\r\n  console.log(\"Gradient parser - colorStopValues:\", colorStopValues);\r\n  \r\n  // Parse color stops\r\n  const stops: GradientStop[] = [];\r\n  for (const stopValue of colorStopValues) {\r\n    if (!stopValue.trim()) continue;\r\n    \r\n    const stop = parseGradientStop(stopValue);\r\n    if (stop) {\r\n      stops.push(stop);\r\n    }\r\n  }\r\n  \r\n  console.log(\"Gradient parser - parsed stops:\", stops);\r\n  \r\n  // If no color stops, create a default one\r\n  if (stops.length === 0) {\r\n    stops.push({ color: \"#000000\" });\r\n  }\r\n  \r\n  return {\r\n    type: \"linear\",\r\n    direction,\r\n    stops,\n  };\n}\n\nexport function parseRadialGradient(value: string): RadialGradient | null {\n  const trimmed = value.trim();\n  const lower = trimmed.toLowerCase();\n  if (!lower.startsWith(\"radial-gradient(\") || !trimmed.endsWith(\")\")) {\n    return null;\n  }\n\n  const content = trimmed.slice(\"radial-gradient(\".length, -1);\n  if (!content) {\n    return null;\n  }\n\n  const commaIndex = findTopLevelComma(content);\n  const descriptorPart = commaIndex === -1 ? \"\" : content.slice(0, commaIndex).trim();\n  let stopsContent = commaIndex === -1 ? content : content.slice(commaIndex + 1).trim();\n\n  const descriptor = parseRadialDescriptor(descriptorPart);\n  if (!descriptor.hasDescriptor) {\n    stopsContent = content;\n  }\n\n  const stops: GradientStop[] = [];\n  const colorStopValues = splitCssCommaList(stopsContent);\n  for (const stopValue of colorStopValues) {\n    if (!stopValue.trim()) continue;\n    const stop = parseGradientStop(stopValue);\n    if (stop) {\n      stops.push(stop);\n    }\n  }\n\n  if (stops.length === 0) {\n    stops.push({ color: \"#000000\" });\n  }\n\n  return {\n    type: \"radial\",\n    cx: 0.5,\n    cy: 0.5,\n    r: 0.5,\n    stops,\n    coordsUnits: \"ratio\",\n    shape: descriptor.shape,\n    size: descriptor.size,\n    at: descriptor.position,\n    source: \"css\",\n  };\n}\n\nfunction parseGradientStop(value: string): GradientStop | null {\n  const parts = splitCssList(value);\n  if (parts.length === 0) {\n    return null;\n  }\n  \r\n  let color = parts[0].trim();\r\n  if (!color) {\r\n    return null;\r\n  }\r\n  \r\n  // Preserve color names - don't convert to hex values\r\n  // The tests expect the original color names to be preserved\r\n  const colorNames: Record<string, boolean> = {\r\n    'red': true,\r\n    'yellow': true,\r\n    'green': true,\r\n    'blue': true,\r\n    'black': true,\r\n    'white': true,\r\n    'gray': true,\r\n    'grey': true,\r\n    'lime': true,\r\n  };\r\n  \r\n  // Just validate that it's a known color name, but preserve the original value\r\n  if (colorNames[color.toLowerCase()]) {\r\n    // Keep the original color value (don't convert to hex)\r\n    // No conversion needed, color remains as-is\r\n  }\r\n  \r\n  // Check if there's a position\r\n  let position: number | undefined;\r\n  if (parts.length > 1) {\r\n    const positionStr = parts[1].trim();\r\n      const num = parseFloat(positionStr.slice(0, -1));\r\n      if (!isNaN(num)) {\r\n        position = num / 100;\r\n    } else {\r\n      // Try to parse as a number (0-1 range)\r\n      const num = parseFloat(positionStr);\r\n      if (!isNaN(num) && num >= 0 && num <= 1) {\r\n        position = num;\r\n      }\r\n    }\r\n  }\r\n  \n  return { color, position };\n}\n\nfunction parseRadialDescriptor(value: string): { shape?: \"circle\" | \"ellipse\"; size?: RadialGradient[\"size\"]; position?: { x: string; y: string }; hasDescriptor: boolean } {\n  const trimmed = value.trim();\n  if (!trimmed) {\n    return { hasDescriptor: false };\n  }\n\n  const tokens = trimmed.split(/\\s+/).filter(Boolean);\n  if (tokens.length === 0) {\n    return { hasDescriptor: false };\n  }\n\n  const atIndex = tokens.findIndex((token) => token.toLowerCase() === \"at\");\n  const beforeAt = atIndex === -1 ? tokens : tokens.slice(0, atIndex);\n  const positionTokens = atIndex === -1 ? [] : tokens.slice(atIndex + 1);\n\n  let shape: \"circle\" | \"ellipse\" | undefined;\n  let size: RadialGradient[\"size\"];\n\n  for (const token of beforeAt) {\n    const lower = token.toLowerCase();\n    if (lower === \"circle\" || lower === \"ellipse\") {\n      shape = lower;\n      continue;\n    }\n    if (isRadialSizeKeyword(lower)) {\n      size = lower;\n      continue;\n    }\n  }\n\n  const position = parseRadialPosition(positionTokens);\n  const hasDescriptor = !!shape || !!size || !!position;\n  return { shape, size, position, hasDescriptor };\n}\n\nfunction parseRadialPosition(tokens: string[]): { x: string; y: string } | undefined {\n  if (!tokens || tokens.length === 0) {\n    return undefined;\n  }\n\n  if (tokens.length === 1) {\n    const token = tokens[0];\n    if (isVerticalKeyword(token)) {\n      return { x: \"50%\", y: keywordToPositionValue(token, \"y\") };\n    }\n    return { x: keywordToPositionValue(token, \"x\"), y: \"50%\" };\n  }\n\n  const xToken = tokens[0];\n  const yToken = tokens[1];\n  return {\n    x: keywordToPositionValue(xToken, \"x\"),\n    y: keywordToPositionValue(yToken, \"y\"),\n  };\n}\n\nfunction keywordToPositionValue(token: string, axis: \"x\" | \"y\"): string {\n  const lower = token.toLowerCase();\n  if (axis === \"x\") {\n    if (lower === \"left\") return \"0%\";\n    if (lower === \"right\") return \"100%\";\n  } else {\n    if (lower === \"top\") return \"0%\";\n    if (lower === \"bottom\") return \"100%\";\n  }\n  if (lower === \"center\") return \"50%\";\n  return token;\n}\n\nfunction isVerticalKeyword(value: string): boolean {\n  const lower = value.toLowerCase();\n  return lower === \"top\" || lower === \"bottom\";\n}\n\nfunction isRadialSizeKeyword(\n  value: string,\n): value is \"closest-side\" | \"farthest-side\" | \"closest-corner\" | \"farthest-corner\" {\n  switch (value) {\n    case \"closest-side\":\n    case \"farthest-side\":\n    case \"closest-corner\":\n    case \"farthest-corner\":\n      return true;\n    default:\n      return false;\n  }\n}\n\nfunction findTopLevelComma(value: string): number {\n  let depth = 0;\n  for (let i = 0; i < value.length; i++) {\n    const char = value[i];\n    if (char === \"(\") {\n      depth++;\n    } else if (char === \")\") {\n      depth = Math.max(0, depth - 1);\n    } else if (char === \",\" && depth === 0) {\n      return i;\n    }\n  }\n  return -1;\n}\n", "import type {\n  BackgroundLayer,\n  BackgroundOrigin,\n  BackgroundPosition,\n  BackgroundRepeat,\n  BackgroundSize,\n  GradientBackgroundLayer,\n} from \"../background-types.js\";\nimport { parseLinearGradient, parseRadialGradient } from \"./gradient-parser.js\";\nimport { NAMED_COLORS } from \"../named-colors.js\";\n\r\nfunction normalizeBackgroundSizeKeyword(value: string): \"cover\" | \"contain\" | \"auto\" | undefined {\r\n  const trimmed = value.trim().toLowerCase();\r\n  if (!trimmed) {\r\n    return undefined;\r\n  }\r\n\r\n  const matchesKeyword = (keyword: \"cover\" | \"contain\" | \"auto\") => {\r\n    return (\r\n      trimmed === keyword ||\r\n      trimmed.startsWith(`${keyword} `) ||\r\n      trimmed.startsWith(`${keyword}(`)\r\n    );\r\n  };\r\n\r\n  if (matchesKeyword(\"cover\")) {\r\n    return \"cover\";\r\n  }\r\n  if (matchesKeyword(\"contain\")) {\r\n    return \"contain\";\r\n  }\r\n  if (matchesKeyword(\"auto\")) {\r\n    return \"auto\";\r\n  }\r\n  return undefined;\r\n}\r\n\r\nfunction normalizeBackgroundSizeComponent(value: string): string {\r\n  const keyword = normalizeBackgroundSizeKeyword(value);\r\n  return keyword ?? value.trim();\r\n}\r\n\r\ninterface FunctionSlice {\r\n  text: string;\r\n  start: number;\r\n  end: number;\r\n}\r\n\r\nfunction extractFunctionCall(value: string, fnName: string): FunctionSlice | null {\r\n  const lower = value.toLowerCase();\r\n  const needle = `${fnName.toLowerCase()}(`;\r\n  const start = lower.indexOf(needle);\r\n  if (start === -1) {\r\n    return null;\r\n  }\r\n  let depth = 0;\r\n  for (let i = start; i < value.length; i++) {\r\n    const ch = value[i];\r\n    if (ch === \"(\") {\r\n      depth++;\r\n    } else if (ch === \")\") {\r\n      depth--;\r\n      if (depth === 0) {\r\n        return { text: value.slice(start, i + 1), start, end: i + 1 };\r\n      }\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\n * Ensures background layers array exists and returns the top renderable layer\n */\nexport function ensureLayers(style: any): BackgroundLayer[] {\n  if (!style.backgroundLayers) {\n    style.backgroundLayers = [];\n  }\n  return style.backgroundLayers;\n}\n\r\n/**\r\n * Gets or creates the top renderable layer (skips color-only layers)\r\n */\r\nfunction getOrCreateTopRenderableLayer(style: any): BackgroundLayer {\r\n  const layers = ensureLayers(style);\r\n\r\n  // Find the last non-color layer\r\n  for (let i = layers.length - 1; i >= 0; i--) {\r\n    if (layers[i].kind !== 'color') {\r\n      return layers[i];\r\n    }\r\n  }\r\n\r\n  // If no renderable layer exists, create an image layer\r\n  const newLayer: BackgroundLayer = { kind: \"image\", url: \"\" };\r\n  layers.push(newLayer);\r\n  return newLayer;\r\n}\r\n\r\n/**\r\n * Parses background shorthand property\r\n */\r\nexport function parseBackgroundShorthand(value: string): BackgroundLayer[] {\r\n  const trimmed = value.trim();\r\n  if (!trimmed) return [];\r\n\r\n  // Split by commas to handle multiple layers, but be careful with commas inside functions like gradients\r\n  const layerStrings = splitBackgroundLayers(trimmed);\r\n  const layers: BackgroundLayer[] = [];\r\n\r\n  for (const layerStr of layerStrings) {\r\n    const layer = parseSingleBackgroundLayer(layerStr);\r\n    if (layer) {\r\n      layers.push(layer);\r\n    }\r\n  }\r\n\r\n  return layers;\r\n}\r\n\r\nfunction splitBackgroundLayers(value: string): string[] {\r\n  const result: string[] = [];\r\n  let current = '';\r\n  let parenCount = 0;\r\n  let i = 0;\r\n\r\n  while (i < value.length) {\r\n    const char = value[i];\r\n\r\n    if (char === '(') {\r\n      parenCount++;\r\n      current += char;\r\n    } else if (char === ')') {\r\n      parenCount--;\r\n      current += char;\r\n    } else if (char === ',' && parenCount === 0) {\r\n      // Only split on commas that are not inside parentheses\r\n      result.push(current.trim());\r\n      current = '';\r\n    } else {\r\n      current += char;\r\n    }\r\n    i++;\r\n  }\r\n\r\n  if (current.trim()) {\r\n    result.push(current.trim());\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Parses a single background layer\r\n */\r\nfunction parseSingleBackgroundLayer(value: string): BackgroundLayer | null {\n  const trimmed = value.trim();\n  if (!trimmed) return null;\n\n  // Handle gradients\n  const gradientSlice =\n    extractFunctionCall(trimmed, \"radial-gradient\") ??\n    extractFunctionCall(trimmed, \"linear-gradient\");\n  if (gradientSlice) {\n    const gradientLayer = parseGradientLayer(gradientSlice.text);\n    if (gradientLayer) {\n      const before = trimmed.slice(0, gradientSlice.start).trim();\n      const after = trimmed.slice(gradientSlice.end).trim();\n      const remainder = [before, after].filter(Boolean).join(\" \");\r\n      if (remainder && gradientLayer.kind === \"gradient\") {\r\n        const tokens = remainder.split(/\\s+/).filter(Boolean);\r\n        for (const token of tokens) {\r\n          const lower = token.toLowerCase();\r\n          if (isRepeatKeyword(lower)) {\r\n            gradientLayer.repeat = lower as BackgroundRepeat;\r\n          } else if (isBoxKeyword(lower)) {\r\n            gradientLayer.origin = lower as BackgroundOrigin;\r\n          }\r\n        }\r\n      }\r\n      return gradientLayer;\r\n    }\r\n  }\r\n\r\n  // Handle colors\r\n  if (isColorValue(trimmed)) {\r\n    return { kind: \"color\", color: trimmed };\r\n  }\r\n\r\n  // Handle images with properties\r\n  return parseImageLayer(trimmed);\r\n}\r\n\r\n/**\r\n * Parses gradient background layer\r\n */\r\nfunction parseGradientLayer(value: string): GradientBackgroundLayer | null {\n  const normalized = value.trim().toLowerCase();\n  const gradient =\n    normalized.startsWith(\"linear-gradient(\") ? parseLinearGradient(value) :\n    normalized.startsWith(\"radial-gradient(\") ? parseRadialGradient(value) :\n    null;\n  if (!gradient) {\n    return null;\n  }\n  return {\n    kind: \"gradient\",\n    gradient,\r\n  };\r\n}\r\n\r\n/**\r\n * Parses image background layer with properties\r\n */\r\nfunction parseImageLayer(value: string): BackgroundLayer | null {\r\n  const parts = value.split(/\\s+/).filter(p => p.length > 0);\r\n  if (parts.length === 0) return null;\r\n\r\n  let url = \"\";\r\n  let position: { x: string; y: string } = { x: \"left\", y: \"top\" };\r\n  let size: BackgroundSize = \"auto\";\r\n  let repeat = \"repeat\";\r\n  let origin: BackgroundOrigin | undefined;\r\n  let currentIndex = 0;\r\n\r\n  // Find URL first\r\n  for (let i = 0; i < parts.length; i++) {\r\n    if (parts[i].startsWith('url(')) {\r\n      url = parts[i];\r\n      currentIndex = i + 1;\r\n      break;\r\n    }\r\n  }\r\n\r\n  if (!url) return null;\r\n\r\n  // Parse remaining properties\r\n  while (currentIndex < parts.length) {\r\n    const partRaw = parts[currentIndex];\r\n    const part = partRaw.toLowerCase();\r\n\r\n    // Check for size (contains /)\r\n    if (part.includes(\"/\")) {\r\n      size = parseBackgroundSizeValue(partRaw);\r\n      currentIndex++;\r\n    }\r\n    // Check for position keywords\r\n    else if (isPositionKeyword(part)) {\r\n      position = parseBackgroundPosition(part, parts[currentIndex + 1]);\r\n      currentIndex += position.y !== \"top\" ? 2 : 1;\r\n    }\r\n    // Check for repeat keywords\r\n    else if (isRepeatKeyword(part)) {\r\n      repeat = part as BackgroundRepeat;\r\n      currentIndex++;\r\n    }\r\n    // Check for background-origin keywords (box)\r\n    else if (isBoxKeyword(part) && origin === undefined) {\r\n      origin = part as BackgroundOrigin;\r\n      currentIndex++;\r\n    }\r\n    else {\r\n      currentIndex++;\r\n    }\r\n  }\r\n\r\n  return {\r\n    kind: \"image\",\r\n    url,\r\n    position,\r\n    size,\r\n    repeat: repeat as any,\r\n    origin,\r\n  };\r\n}\r\n\r\n/**\r\n * Parses background-size value\r\n */\r\nfunction parseBackgroundSizeValue(value: string): BackgroundSize {\r\n  // Split on '/' as independent token, not within tokens\r\n  const slashIndex = value.indexOf('/');\r\n  if (slashIndex === -1) {\r\n    const keyword = normalizeBackgroundSizeKeyword(value);\r\n    if (keyword) {\r\n      return keyword;\r\n    }\r\n    const tokens = value.trim().split(/\\s+/).filter(Boolean);\r\n    if (tokens.length === 1) {\r\n      return { width: normalizeBackgroundSizeComponent(tokens[0]), height: \"auto\" };\r\n    }\r\n    return {\r\n      width: normalizeBackgroundSizeComponent(tokens[0]),\r\n      height: normalizeBackgroundSizeComponent(tokens[1] ?? \"auto\"),\r\n    };\r\n  } else {\r\n    const width = value.substring(0, slashIndex).trim();\r\n    const height = value.substring(slashIndex + 1).trim();\r\n    return {\r\n      width: width ? normalizeBackgroundSizeComponent(width) : \"auto\",\r\n      height: height ? normalizeBackgroundSizeComponent(height) : \"auto\"\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Parses background-position value\r\n */\r\nconst VERTICAL_POSITION_KEYWORDS = new Set([\"top\", \"bottom\"]);\r\n\r\nfunction parseBackgroundPosition(x: string, y: string): { x: string; y: string } {\r\n  return {\r\n    x: x.toLowerCase(),\r\n    y: y.toLowerCase(),\r\n  };\r\n}\r\n\r\n/**\r\n * Checks if value is a color\r\n */\r\nfunction isColorValue(value: string): boolean {\n  const lowerValue = value.toLowerCase();\n  if (lowerValue in NAMED_COLORS) {\n    return true;\n  }\n  if (lowerValue === \"transparent\") {\n    return true;\n  }\n  if (lowerValue.startsWith(\"#\") && (lowerValue.length === 4 || lowerValue.length === 7)) {\n    return true;\n  }\n  if (lowerValue.startsWith(\"rgb(\") || lowerValue.startsWith(\"rgba(\")) {\n    return true;\n  }\n  if (lowerValue.startsWith(\"hsl(\") || lowerValue.startsWith(\"hsla(\")) {\n    return true;\n  }\n  return false;\n}\n\r\n/**\r\n * Checks if value is a position keyword\r\n */\r\nfunction isPositionKeyword(value: string): boolean {\r\n  const positions = ['left', 'center', 'right', 'top', 'bottom'];\r\n  return positions.includes(value.toLowerCase());\r\n}\r\n\r\n/**\r\n * Checks if value is a repeat keyword\r\n */\r\nfunction isRepeatKeyword(value: string): boolean {\r\n  const repeats = ['repeat', 'repeat-x', 'repeat-y', 'no-repeat', 'space', 'round'];\r\n  return repeats.includes(value.toLowerCase());\r\n}\r\n\r\n/**\r\n * Checks if value is a background box keyword used by background-origin/background-clip\r\n */\r\nfunction isBoxKeyword(value: string): value is BackgroundOrigin {\r\n  const lower = value.toLowerCase();\r\n  return lower === \"border-box\" || lower === \"padding-box\" || lower === \"content-box\";\r\n}\r\n\r\n/**\r\n * Applies background-size longhand property\r\n */\r\nexport function applyBackgroundSize(style: any, value: string): void {\r\n  ensureLayers(style);\r\n  const layer = getOrCreateTopRenderableLayer(style);\r\n  const keyword = normalizeBackgroundSizeKeyword(value);\r\n  let size: BackgroundSize;\r\n\r\n  if (keyword) {\r\n    size = keyword;\r\n  } else {\r\n    const tokens = value.trim().split(/\\s+/).filter(Boolean);\r\n    if (tokens.length === 0) {\r\n      size = \"auto\";\r\n    } else if (tokens.length === 1) {\r\n      size = { width: normalizeBackgroundSizeComponent(tokens[0]), height: \"auto\" };\r\n    } else {\r\n      size = {\r\n        width: normalizeBackgroundSizeComponent(tokens[0]),\r\n        height: normalizeBackgroundSizeComponent(tokens[1] ?? \"auto\"),\r\n      };\r\n    }\r\n  }\r\n\r\n  if (layer.kind === \"image\" || layer.kind === \"gradient\") {\r\n    layer.size = size;\r\n  }\r\n}\r\n\r\nfunction parseBackgroundPositionValue(value: string): BackgroundPosition {\r\n  const tokens = value.trim().split(/\\s+/).filter(Boolean);\r\n  if (tokens.length === 0) {\r\n    return { x: \"left\", y: \"top\" };\r\n  }\r\n\r\n  const normalizedTokens = tokens.map((token) => token.toLowerCase());\r\n  const first = normalizedTokens[0];\r\n\r\n  if (tokens.length === 1) {\r\n    if (first === \"center\") {\r\n      return parseBackgroundPosition(\"center\", \"center\");\r\n    }\r\n    if (VERTICAL_POSITION_KEYWORDS.has(first)) {\r\n      return parseBackgroundPosition(\"center\", first);\r\n    }\r\n    return parseBackgroundPosition(first, \"center\");\r\n  }\r\n\r\n  const second = normalizedTokens[1];\r\n  const firstIsVertical = VERTICAL_POSITION_KEYWORDS.has(first);\r\n\r\n  if (firstIsVertical) {\r\n    const horizontalToken = tokens[1] ?? \"center\";\r\n    return parseBackgroundPosition(horizontalToken, first);\r\n  }\r\n\r\n  return parseBackgroundPosition(first, second ?? \"center\");\r\n}\r\n\r\nexport function applyBackgroundPosition(style: any, value: string): void {\r\n  ensureLayers(style);\r\n  const layer = getOrCreateTopRenderableLayer(style);\r\n  const position = parseBackgroundPositionValue(value);\r\n  if (layer.kind === \"image\" || layer.kind === \"gradient\") {\r\n    layer.position = position;\r\n  }\r\n}\r\n\r\nexport function applyBackgroundOrigin(style: any, value: string): void {\r\n  ensureLayers(style);\r\n  const token = value.trim().toLowerCase();\r\n  if (!isBoxKeyword(token)) {\r\n    return;\r\n  }\r\n  const layer = getOrCreateTopRenderableLayer(style);\r\n  if (layer.kind === \"image\" || layer.kind === \"gradient\") {\r\n    layer.origin = token;\r\n  }\r\n}\r\n\r\nexport function applyBackgroundRepeat(style: any, value: string): void {\r\n  ensureLayers(style);\r\n  const token = value.trim().toLowerCase();\r\n  if (!isRepeatKeyword(token)) {\r\n    return;\r\n  }\r\n  const layer = getOrCreateTopRenderableLayer(style);\r\n  if (layer.kind === \"image\" || layer.kind === \"gradient\") {\r\n    layer.repeat = token as BackgroundRepeat;\r\n  }\r\n}\r\n", "// src/css/parsers/background-parser-extended.ts\r\n\r\nimport { parseLinearGradient, parseRadialGradient } from \"./gradient-parser.js\";\nimport {\n  parseBackgroundShorthand,\n  applyBackgroundSize,\n  applyBackgroundPosition,\n  applyBackgroundOrigin,\n  applyBackgroundRepeat,\n  ensureLayers,\n} from \"./background-parser.js\";\nimport type { StyleAccumulator } from \"../style.js\";\nimport type { BackgroundClip } from \"../background-types.js\";\n\nconst BACKGROUND_CLIP_VALUES = new Set<BackgroundClip>([\n  \"border-box\",\n  \"padding-box\",\n  \"content-box\",\n  \"text\",\n]);\n\r\nexport function applyBackgroundSizeDecl(value: string, target: StyleAccumulator): void {\r\n  applyBackgroundSize(target, value);\r\n}\r\n\r\nexport function applyBackgroundPositionDecl(value: string, target: StyleAccumulator): void {\r\n  applyBackgroundPosition(target, value);\r\n}\r\n\r\nexport function applyBackgroundOriginDecl(value: string, target: StyleAccumulator): void {\r\n  applyBackgroundOrigin(target, value);\r\n}\r\n\r\nexport function applyBackgroundRepeatDecl(value: string, target: StyleAccumulator): void {\n  applyBackgroundRepeat(target, value);\n}\n\nexport function applyBackgroundClipDecl(value: string, target: StyleAccumulator): void {\n  const layers = ensureLayers(target);\n  if (layers.length === 0) {\n    return;\n  }\n\n  const tokens = value\n    .split(\",\")\n    .map((token) => token.trim().toLowerCase())\n    .filter((token) => token.length > 0);\n\n  if (tokens.length === 0) {\n    return;\n  }\n\n  for (let i = 0; i < tokens.length; i++) {\n    const clipValue = tokens[i] as BackgroundClip;\n    if (!BACKGROUND_CLIP_VALUES.has(clipValue)) {\n      continue;\n    }\n    const layerIndex = Math.min(i, layers.length - 1);\n    const layer = layers[layerIndex];\n    if (layer) {\n      layer.clip = clipValue as BackgroundClip;\n    }\n  }\n}\n\nexport function parseBackgroundImage(value: string, target: StyleAccumulator): void {\n  const trimmed = value.trim();\n\n  // Try to parse gradients first\n  const gradient = parseLinearGradient(value) ?? parseRadialGradient(value);\n  if (gradient) {\n    if (!target.backgroundLayers) {\n      target.backgroundLayers = [];\n    }\n    target.backgroundLayers.push({ kind: \"gradient\", gradient });\r\n    return;\r\n  }\r\n\r\n  // If not a gradient, treat as direct url\r\n  if (trimmed.startsWith('url(')) {\r\n    if (!target.backgroundLayers) {\r\n      target.backgroundLayers = [];\r\n    }\r\n    target.backgroundLayers.push({\r\n      kind: \"image\",\r\n      url: trimmed,\r\n      position: { x: \"left\", y: \"top\" },\r\n      size: \"auto\",\r\n      repeat: \"repeat\"\r\n    });\r\n  }\r\n}\r\n\r\nexport function parseBackground(value: string, target: StyleAccumulator): void {\r\n  console.log(\"Processing background property:\", value);\r\n  const layers = parseBackgroundShorthand(value);\r\n  console.log(\"Parsed background layers:\", layers);\r\n  if (layers.length > 0) {\r\n    if (!target.backgroundLayers) {\r\n      target.backgroundLayers = [];\r\n    }\r\n    target.backgroundLayers.push(...layers);\r\n  }\r\n}\r\n\r\nexport function parseObjectFit(value: string, target: StyleAccumulator): void {\r\n  const normalized = value.trim().toLowerCase();\r\n  if ([\"contain\", \"cover\", \"fill\", \"none\", \"scale-down\"].includes(normalized)) {\r\n    target.objectFit = normalized;\r\n  }\r\n}\r\n", "import type { StyleAccumulator } from \"../style.js\";\nimport type { ClipPath, ClipPathLength, ClipPathPolygon, ClipPathReferenceBox } from \"../clip-path-types.js\";\nimport { parseLengthOrPercent } from \"./length-parser.js\";\n\n// Parses clip-path values. Currently supports polygon() with px or % coordinates.\nexport function parseClipPath(value: string, target: StyleAccumulator): void {\n  const parsed = parseClipPathValue(value);\n  if (!parsed) {\n    return;\n  }\n  target.clipPath = parsed;\n}\n\nfunction parseClipPathValue(value: string): ClipPath | undefined {\n  if (!value) return undefined;\n  const normalized = value.trim();\n  if (normalized === \"none\") {\n    return undefined;\n  }\n\n  const polygon = parsePolygon(normalized);\n  if (polygon) {\n    return polygon;\n  }\n  return undefined;\n}\n\nfunction parsePolygon(input: string): ClipPathPolygon | undefined {\n  const match = /^polygon\\s*\\((.+)\\)$/i.exec(input);\n  if (!match) {\n    return undefined;\n  }\n  const body = match[1].trim();\n  if (!body) {\n    return undefined;\n  }\n\n  // Split points by commas; if no commas, fall back to whitespace grouping.\n  const rawPoints = body.includes(\",\") ? body.split(/\\s*,\\s*/) : splitEvenTokens(body.split(/\\s+/));\n  const points: ClipPathPolygon[\"points\"] = [];\n\n  for (const raw of rawPoints) {\n    const coords = raw.trim().split(/\\s+/).filter(Boolean);\n    if (coords.length < 2) {\n      return undefined;\n    }\n    const x = parseClipLength(coords[0]);\n    const y = parseClipLength(coords[1]);\n    if (!x || !y) {\n      return undefined;\n    }\n    points.push({ x, y });\n  }\n\n  if (points.length < 3) {\n    return undefined;\n  }\n\n  const referenceBox: ClipPathReferenceBox = \"border-box\";\n  return {\n    type: \"polygon\",\n    points,\n    referenceBox,\n  };\n}\n\nfunction splitEvenTokens(tokens: string[]): string[] {\n  const result: string[] = [];\n  for (let i = 0; i < tokens.length; i += 2) {\n    const a = tokens[i];\n    const b = tokens[i + 1];\n    if (!a || !b) {\n      break;\n    }\n    result.push(`${a} ${b}`);\n  }\n  return result;\n}\n\nfunction parseClipLength(token: string): ClipPathLength | undefined {\n  const parsed = parseLengthOrPercent(token);\n  if (parsed === undefined) {\n    return undefined;\n  }\n  if (typeof parsed === \"number\") {\n    return { unit: \"px\", value: parsed };\n  }\n  if (typeof parsed === \"object\" && (parsed as any).unit === \"percent\") {\n    return { unit: \"percent\", value: (parsed as any).value as number };\n  }\n  return undefined;\n}\n", "import type {\n  TrackDefinitionInput,\n  TrackSizeInput,\n  RepeatTrackDefinitionInput,\n  AutoRepeatTrackDefinitionInput,\n  FlexTrackSizeInput,\n  NumericLength,\n} from \"../style.js\";\nimport { parseLength } from \"./length-parser.js\";\n\nfunction tokenizeTrackList(value: string): string[] {\n  const tokens: string[] = [];\n  let buffer = \"\";\n  let depth = 0;\n\n  for (let i = 0; i < value.length; i++) {\n    const char = value[i];\n    if (char === \"(\") {\n      depth += 1;\n      buffer += char;\n      continue;\n    }\n    if (char === \")\") {\n      depth = Math.max(0, depth - 1);\n      buffer += char;\n      continue;\n    }\n    if (/\\s/.test(char) && depth === 0) {\n      if (buffer) {\n        tokens.push(buffer.trim());\n        buffer = \"\";\n      }\n      continue;\n    }\n    buffer += char;\n  }\n\n  if (buffer) {\n    tokens.push(buffer.trim());\n  }\n\n  return tokens;\n}\n\nfunction splitArgs(value: string): string[] {\n  const args: string[] = [];\n  let buffer = \"\";\n  let depth = 0;\n\n  for (let i = 0; i < value.length; i++) {\n    const char = value[i];\n    if (char === \"(\") {\n      depth += 1;\n      buffer += char;\n      continue;\n    }\n    if (char === \")\") {\n      depth = Math.max(0, depth - 1);\n      buffer += char;\n      continue;\n    }\n    if (char === \",\" && depth === 0) {\n      args.push(buffer.trim());\n      buffer = \"\";\n      continue;\n    }\n    buffer += char;\n  }\n\n  if (buffer) {\n    args.push(buffer.trim());\n  }\n\n  return args;\n}\n\nfunction parseFlex(value: string): number | undefined {\n  const match = value.trim().match(/^(-?\\d+(?:\\.\\d+)?)fr$/i);\n  if (!match) {\n    return undefined;\n  }\n  const parsed = Number.parseFloat(match[1]);\n  return Number.isNaN(parsed) ? undefined : parsed;\n}\n\nfunction parseTrackSize(token: string): TrackSizeInput | undefined {\n  const normalized = token.trim().toLowerCase();\n\n  if (normalized.startsWith(\"minmax(\") && normalized.endsWith(\")\")) {\n    const inner = normalized.slice(7, -1);\n    const [minArg, maxArg] = splitArgs(inner);\n    if (!minArg || !maxArg) {\n      return undefined;\n    }\n    const min = parseLength(minArg);\n    if (min === undefined) {\n      return undefined;\n    }\n    const flex = parseFlex(maxArg);\n    if (flex !== undefined) {\n      const track: FlexTrackSizeInput = { kind: \"flex\", flex, min };\n      return track;\n    }\n    const maxLength = parseLength(maxArg);\n    if (maxLength !== undefined) {\n      if (typeof min === \"number\" && typeof maxLength === \"number\") {\n        return {\n          kind: \"fixed\",\n          size: Math.max(min, maxLength),\n        };\n      }\n      return {\n        kind: \"fixed\",\n        size: maxLength,\n      };\n    }\n    if (maxArg.trim() === \"auto\") {\n      return { kind: \"auto\", min };\n    }\n    return undefined;\n  }\n\n  const flex = parseFlex(normalized);\n  if (flex !== undefined) {\n    return { kind: \"flex\", flex };\n  }\n\n  if (normalized === \"auto\") {\n    return { kind: \"auto\" };\n  }\n\n  const length = parseLength(normalized);\n  if (length !== undefined) {\n    return { kind: \"fixed\", size: length };\n  }\n\n  return undefined;\n}\n\nexport function parseGridTemplate(value: string): TrackDefinitionInput[] | undefined {\n  if (!value) {\n    return undefined;\n  }\n  const tokens = tokenizeTrackList(value.trim());\n  if (tokens.length === 0) {\n    return undefined;\n  }\n\n  const tracks: TrackDefinitionInput[] = [];\n  for (const token of tokens) {\n    const normalized = token.trim().toLowerCase();\n    if (normalized.startsWith(\"repeat(\") && normalized.endsWith(\")\")) {\n      const inner = token.trim().slice(7, -1);\n      const [countArg, trackArg] = splitArgs(inner);\n      if (!countArg || !trackArg) {\n        return undefined;\n      }\n\n      const track = parseTrackSize(trackArg);\n      if (!track) {\n        return undefined;\n      }\n\n      const normalizedCount = countArg.trim().toLowerCase();\n      if (normalizedCount === \"auto-fit\" || normalizedCount === \"auto-fill\") {\n        const repeat: AutoRepeatTrackDefinitionInput = {\n          kind: \"repeat-auto\",\n          mode: normalizedCount as \"auto-fit\" | \"auto-fill\",\n          track,\n        };\n        tracks.push(repeat);\n        continue;\n      }\n\n      const numericCount = Number.parseInt(normalizedCount, 10);\n      if (!Number.isFinite(numericCount) || numericCount <= 0) {\n        return undefined;\n      }\n      const repeat: RepeatTrackDefinitionInput = {\n        kind: \"repeat\",\n        count: numericCount,\n        track,\n      };\n      tracks.push(repeat);\n      continue;\n    }\n\n    const track = parseTrackSize(token);\n    if (!track) {\n      return undefined;\n    }\n    tracks.push(track);\n  }\n  return tracks;\n}\n\nexport function parseGap(value: string): { row: NumericLength; column: NumericLength } | undefined {\n  if (!value) {\n    return undefined;\n  }\n  const tokens = value\n    .split(/\\s+/)\n    .map((token) => token.trim())\n    .filter((token) => token.length > 0);\n  if (tokens.length === 0) {\n    return undefined;\n  }\n\n  const first = parseLength(tokens[0]);\n  if (first === undefined) {\n    return undefined;\n  }\n  const second = tokens.length > 1 ? parseLength(tokens[1]) : undefined;\n  return {\n    row: first,\n    column: second ?? first,\n  };\n}\n", "// src/css/parsers/grid-parser-extended.ts\r\n\r\nimport { parseGap as parseGapValue, parseGridTemplate } from \"./grid-parser.js\";\r\nimport { parseLength } from \"./length-parser.js\";\r\nimport type { GridAutoFlow, StyleAccumulator } from \"../style.js\";\r\n\r\nexport function parseGridTemplateColumns(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseGridTemplate(value);\r\n  if (parsed) {\r\n    target.trackListColumns = parsed;\r\n  }\r\n}\r\n\r\nexport function parseGridTemplateRows(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseGridTemplate(value);\r\n  if (parsed) {\r\n    target.trackListRows = parsed;\r\n  }\r\n}\r\n\r\nexport function parseGridAutoFlow(value: string, target: StyleAccumulator): void {\r\n  const normalized = value.trim().toLowerCase();\r\n  switch (normalized) {\r\n    case \"row\":\r\n    case \"column\":\r\n    case \"row dense\":\r\n    case \"column dense\":\r\n      target.autoFlow = normalized as GridAutoFlow;\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n}\r\n\r\nexport function parseGap(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseGapValue(value);\r\n  if (parsed) {\r\n    target.rowGap = parsed.row;\r\n    target.columnGap = parsed.column;\r\n  }\r\n}\r\n\r\nexport function parseRowGap(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseLength(value);\r\n  if (parsed !== undefined) {\r\n    target.rowGap = parsed;\r\n  }\r\n}\r\n\r\nexport function parseColumnGap(value: string, target: StyleAccumulator): void {\r\n  const parsed = parseLength(value);\r\n  if (parsed !== undefined) {\r\n    target.columnGap = parsed;\r\n  }\r\n}\r\n", "import type { StyleAccumulator } from \"../style.js\";\r\n\r\nexport function parseOpacity(value: string, target: StyleAccumulator): void {\r\n  console.log(`DEBUG: parseOpacity called with value: \"${value}\"`);\r\n  // Normalize the value by trimming whitespace and converting to lowercase\r\n  const normalizedValue = value.trim().toLowerCase();\r\n  \r\n  // Parse as a number - opacity can be a number between 0 and 1 or a percentage\r\n  let opacityValue: number;\r\n  \r\n  if (normalizedValue.endsWith('%')) {\r\n    // Handle percentage values (e.g., \"50%\")\r\n    const percentStr = normalizedValue.slice(0, -1);\r\n    const percent = parseFloat(percentStr);\r\n    if (isNaN(percent)) {\r\n      return; // Invalid percentage, don't set opacity\r\n    }\r\n    opacityValue = percent / 100;\r\n  } else {\r\n    // Handle decimal values (e.g., \"0.5\")\r\n    opacityValue = parseFloat(normalizedValue);\r\n    if (isNaN(opacityValue)) {\r\n      return; // Invalid number, don't set opacity\r\n    }\r\n  }\r\n  \r\n  // Clamp the value between 0 and 1\r\n  opacityValue = Math.max(0, Math.min(1, opacityValue));\r\n  \r\n  // Set the opacity in the target accumulator\r\n  target.opacity = opacityValue;\r\n}\r\n", "// src/css/parsers/register-parsers.ts\r\n\r\nimport { registerPropertyParser } from \"./registry.js\";\r\n\r\n// Display and Flex\r\nimport {\r\n  parseDisplay,\r\n  parseJustifyContent,\r\n  parseAlignItems,\r\n  parseAlignContent,\r\n  parseAlignSelf,\r\n  parseFlexDirection,\r\n  parseFlexWrap,\r\n} from \"./display-flex-parser.js\";\r\n\r\n// Color\r\nimport { parseColor, parseBackgroundColor } from \"./color-parser.js\";\r\n\r\n// Border\r\nimport {\r\n  parseBorderColor,\r\n  parseBoxShadow,\r\n  parseBorder,\r\n  parseBorderTop,\r\n  parseBorderRight,\r\n  parseBorderBottom,\r\n  parseBorderLeft,\r\n  parseBorderRadius,\r\n  parseBorderTopLeftRadius,\r\n  parseBorderTopRightRadius,\r\n  parseBorderBottomRightRadius,\r\n  parseBorderBottomLeftRadius,\r\n  parseBorderWidth,\r\n  parseBorderTopWidth,\r\n  parseBorderRightWidth,\r\n  parseBorderBottomWidth,\r\n  parseBorderLeftWidth,\r\n  parseBorderTopColor,\r\n  parseBorderRightColor,\r\n  parseBorderBottomColor,\r\n  parseBorderLeftColor,\r\n  parseBorderStyle,\r\n  parseBorderTopStyle,\r\n  parseBorderRightStyle,\r\n  parseBorderBottomStyle,\r\n  parseBorderLeftStyle,\r\n  parseBorderCollapse,\r\n} from \"./border-parser-extended.js\";\r\n\r\nimport {\r\n  parseBorderBlockStart,\r\n  parseBorderBlockEnd,\r\n} from \"./border-block-parser.js\";\r\n\r\nimport {\r\n  parseBorderInlineStart,\r\n  parseBorderInlineEnd,\r\n} from \"./border-inline-parser.js\";\r\n\r\n// Margin\r\nimport {\r\n  parseMargin,\r\n  parseMarginTop,\r\n  parseMarginRight,\r\n  parseMarginBottom,\r\n  parseMarginLeft,\r\n} from \"./margin-parser.js\";\r\n\r\nimport {\r\n  parseMarginBlockStart,\r\n  parseMarginBlockEnd,\r\n} from \"./margin-block-parser.js\";\r\n\r\nimport {\r\n  parseMarginInlineStart,\r\n  parseMarginInlineEnd,\r\n} from \"./margin-inline-parser.js\";\r\n\r\n// Padding\r\nimport {\r\n  parsePadding,\r\n  parsePaddingTop,\r\n  parsePaddingRight,\r\n  parsePaddingBottom,\r\n  parsePaddingLeft,\r\n} from \"./padding-parser.js\";\r\n\r\nimport {\r\n  parsePaddingBlockStart,\r\n  parsePaddingBlockEnd,\r\n} from \"./padding-block-parser.js\";\r\n\r\nimport {\r\n  parsePaddingInlineStart,\r\n  parsePaddingInlineEnd,\r\n} from \"./padding-inline-parser.js\";\r\n\r\n// Dimensions\r\nimport {\r\n  parseWidth,\r\n  parseMinWidth,\r\n  parseMaxWidth,\r\n  parseHeight,\r\n  parseMinHeight,\r\n  parseMaxHeight,\r\n  parseFontSize,\r\n  parseLineHeight,\r\n  parseZIndex,\r\n} from \"./dimension-parser.js\";\r\n\r\n// Font\r\nimport { parseFontFamily, parseFontStyle, parseFontVariant, parseFontWeight } from \"./font-parser.js\";\r\n\r\n// Positioning\r\nimport { parsePosition, parseTop, parseRight, parseBottom, parseLeft } from \"./position-parser.js\";\r\n\r\n// Text\r\nimport {\r\n  parseTextAlign,\r\n  parseTextDecoration,\r\n  parseTextDecorationLine,\r\n  parseTextDecorationColor,\r\n  parseTextDecorationStyle,\r\n  parseFloat,\r\n  parseTextIndent,\r\n  parseTextTransform,\r\n  parseLetterSpacing,\r\n} from \"./text-parser-extended.js\";\r\nimport { parseOverflowWrap, parseWordWrap } from \"./overflow-wrap-parser.js\";\r\nimport { parseTextShadow } from \"./text-shadow-parser.js\";\r\nimport { parseListStyleType } from \"./list-style-parser.js\";\r\n\r\n// Background\r\nimport {\n  applyBackgroundSizeDecl,\n  applyBackgroundPositionDecl,\n  applyBackgroundOriginDecl,\n  applyBackgroundRepeatDecl,\n  applyBackgroundClipDecl,\n  parseBackgroundImage,\n  parseBackground,\n  parseObjectFit,\n} from \"./background-parser-extended.js\";\nimport { parseClipPath } from \"./clip-path-parser.js\";\n\r\n// Grid\r\nimport {\r\n  parseGridTemplateColumns,\r\n  parseGridTemplateRows,\r\n  parseGridAutoFlow,\r\n  parseGap,\r\n  parseRowGap,\r\n  parseColumnGap,\r\n} from \"./grid-parser-extended.js\";\r\n\r\n// Opacity\r\nimport { parseOpacity } from \"./opacity-parser.js\";\r\n\r\n// Flag to ensure parsers are registered only once\r\nlet parsersRegistered = false;\r\n\r\nexport function registerAllPropertyParsers(): void {\r\n  // Idempotency guard\r\n  if (parsersRegistered) {\r\n    return;\r\n  }\r\n  parsersRegistered = true;\r\n\r\n  // Display and Flex\r\n  registerPropertyParser(\"display\", parseDisplay);\r\n  registerPropertyParser(\"justify-content\", parseJustifyContent);\r\n  registerPropertyParser(\"align-items\", parseAlignItems);\r\n  registerPropertyParser(\"align-content\", parseAlignContent);\r\n  registerPropertyParser(\"align-self\", parseAlignSelf);\r\n  registerPropertyParser(\"flex-direction\", parseFlexDirection);\r\n  registerPropertyParser(\"flex-wrap\", parseFlexWrap);\r\n\r\n  // Color\r\n  registerPropertyParser(\"color\", parseColor);\r\n  registerPropertyParser(\"background-color\", parseBackgroundColor);\r\n\r\n  // Border\r\n  registerPropertyParser(\"border-color\", parseBorderColor);\r\n  registerPropertyParser(\"box-shadow\", parseBoxShadow);\r\n  registerPropertyParser(\"border\", parseBorder);\r\n  registerPropertyParser(\"border-top\", parseBorderTop);\r\n  registerPropertyParser(\"border-right\", parseBorderRight);\r\n  registerPropertyParser(\"border-bottom\", parseBorderBottom);\r\n  registerPropertyParser(\"border-left\", parseBorderLeft);\r\n  registerPropertyParser(\"border-radius\", parseBorderRadius);\r\n  registerPropertyParser(\"border-top-left-radius\", parseBorderTopLeftRadius);\r\n  registerPropertyParser(\"border-top-right-radius\", parseBorderTopRightRadius);\r\n  registerPropertyParser(\"border-bottom-right-radius\", parseBorderBottomRightRadius);\r\n  registerPropertyParser(\"border-bottom-left-radius\", parseBorderBottomLeftRadius);\r\n  registerPropertyParser(\"border-width\", parseBorderWidth);\r\n  registerPropertyParser(\"border-top-width\", parseBorderTopWidth);\r\n  registerPropertyParser(\"border-right-width\", parseBorderRightWidth);\r\n  registerPropertyParser(\"border-bottom-width\", parseBorderBottomWidth);\r\n  registerPropertyParser(\"border-left-width\", parseBorderLeftWidth);\r\n  registerPropertyParser(\"border-top-color\", parseBorderTopColor);\r\n  registerPropertyParser(\"border-right-color\", parseBorderRightColor);\r\n  registerPropertyParser(\"border-bottom-color\", parseBorderBottomColor);\r\n  registerPropertyParser(\"border-left-color\", parseBorderLeftColor);\r\n  registerPropertyParser(\"border-style\", parseBorderStyle);\r\n  registerPropertyParser(\"border-top-style\", parseBorderTopStyle);\r\n  registerPropertyParser(\"border-right-style\", parseBorderRightStyle);\r\n  registerPropertyParser(\"border-bottom-style\", parseBorderBottomStyle);\r\n  registerPropertyParser(\"border-left-style\", parseBorderLeftStyle);\r\n  registerPropertyParser(\"border-collapse\", parseBorderCollapse);\r\n  registerPropertyParser(\"border-block-start\", parseBorderBlockStart);\r\n  registerPropertyParser(\"border-block-end\", parseBorderBlockEnd);\r\n  registerPropertyParser(\"border-inline-start\", parseBorderInlineStart);\r\n  registerPropertyParser(\"border-inline-end\", parseBorderInlineEnd);\r\n\r\n  // Margin\r\n  registerPropertyParser(\"margin\", parseMargin);\r\n  registerPropertyParser(\"margin-top\", parseMarginTop);\r\n  registerPropertyParser(\"margin-right\", parseMarginRight);\r\n  registerPropertyParser(\"margin-bottom\", parseMarginBottom);\r\n  registerPropertyParser(\"margin-left\", parseMarginLeft);\r\n  registerPropertyParser(\"margin-block-start\", parseMarginBlockStart);\r\n  registerPropertyParser(\"margin-block-end\", parseMarginBlockEnd);\r\n  registerPropertyParser(\"margin-inline-start\", parseMarginInlineStart);\r\n  registerPropertyParser(\"margin-inline-end\", parseMarginInlineEnd);\r\n\r\n  // Padding\r\n  registerPropertyParser(\"padding\", parsePadding);\r\n  registerPropertyParser(\"padding-top\", parsePaddingTop);\r\n  registerPropertyParser(\"padding-right\", parsePaddingRight);\r\n  registerPropertyParser(\"padding-bottom\", parsePaddingBottom);\r\n  registerPropertyParser(\"padding-left\", parsePaddingLeft);\r\n  registerPropertyParser(\"padding-block-start\", parsePaddingBlockStart);\r\n  registerPropertyParser(\"padding-block-end\", parsePaddingBlockEnd);\r\n  registerPropertyParser(\"padding-inline-start\", parsePaddingInlineStart);\r\n  registerPropertyParser(\"padding-inline-end\", parsePaddingInlineEnd);\r\n\r\n  // Dimensions\r\n  registerPropertyParser(\"width\", parseWidth);\r\n  registerPropertyParser(\"min-width\", parseMinWidth);\r\n  registerPropertyParser(\"max-width\", parseMaxWidth);\r\n  registerPropertyParser(\"height\", parseHeight);\r\n  registerPropertyParser(\"min-height\", parseMinHeight);\r\n  registerPropertyParser(\"max-height\", parseMaxHeight);\r\n  registerPropertyParser(\"font-size\", parseFontSize);\r\n  registerPropertyParser(\"line-height\", parseLineHeight);\r\n  registerPropertyParser(\"z-index\", parseZIndex);\r\n\r\n  // Font\r\n  registerPropertyParser(\"font-family\", parseFontFamily);\r\n  registerPropertyParser(\"font-style\", parseFontStyle);\r\n  registerPropertyParser(\"font-variant\", parseFontVariant);\r\n  registerPropertyParser(\"font-weight\", parseFontWeight);\r\n\r\n  // Positioning\r\n  registerPropertyParser(\"position\", parsePosition);\r\n  registerPropertyParser(\"top\", parseTop);\r\n  registerPropertyParser(\"right\", parseRight);\r\n  registerPropertyParser(\"bottom\", parseBottom);\r\n  registerPropertyParser(\"left\", parseLeft);\r\n\r\n  // Text\r\n  registerPropertyParser(\"text-align\", parseTextAlign);\r\n  registerPropertyParser(\"text-decoration\", parseTextDecoration);\r\n  registerPropertyParser(\"text-decoration-line\", parseTextDecorationLine);\r\n  registerPropertyParser(\"text-decoration-color\", parseTextDecorationColor);\r\n  registerPropertyParser(\"text-decoration-style\", parseTextDecorationStyle);\r\n  registerPropertyParser(\"letter-spacing\", parseLetterSpacing);\r\n  registerPropertyParser(\"text-indent\", parseTextIndent);\r\n  registerPropertyParser(\"text-transform\", parseTextTransform);\r\n  registerPropertyParser(\"float\", parseFloat);\r\n  registerPropertyParser(\"overflow-wrap\", parseOverflowWrap);\r\n  registerPropertyParser(\"word-wrap\", parseWordWrap);\r\n  registerPropertyParser(\"text-shadow\", parseTextShadow);\r\n  registerPropertyParser(\"list-style-type\", parseListStyleType);\r\n  // Transform (store as raw string for limited later use)\r\n  registerPropertyParser(\"transform\", (value, target) => {\r\n    // store raw transform string\r\n    (target as any).transform = value;\r\n  });\r\n\r\n  // Background\r\n  registerPropertyParser(\"background-size\", applyBackgroundSizeDecl);\r\n  registerPropertyParser(\"background-position\", applyBackgroundPositionDecl);\r\n  registerPropertyParser(\"background-origin\", applyBackgroundOriginDecl);\n  registerPropertyParser(\"background-repeat\", applyBackgroundRepeatDecl);\n  registerPropertyParser(\"background-clip\", applyBackgroundClipDecl);\n  registerPropertyParser(\"background-image\", parseBackgroundImage);\n  registerPropertyParser(\"background\", parseBackground);\n  registerPropertyParser(\"object-fit\", parseObjectFit);\n  registerPropertyParser(\"clip-path\", parseClipPath);\n\r\n  // Grid\r\n  registerPropertyParser(\"grid-template-columns\", parseGridTemplateColumns);\r\n  registerPropertyParser(\"grid-template-rows\", parseGridTemplateRows);\r\n  registerPropertyParser(\"grid-auto-flow\", parseGridAutoFlow);\r\n  registerPropertyParser(\"gap\", parseGap);\r\n  registerPropertyParser(\"row-gap\", parseRowGap);\r\n  registerPropertyParser(\"column-gap\", parseColumnGap);\r\n\r\n  // Opacity\r\n  registerPropertyParser(\"opacity\", parseOpacity);\r\n}\r\n", "// src/css/apply-declarations.ts\r\n\r\nimport { getPropertyParser, type PropertyParser } from \"./parsers/registry.js\";\r\nimport { registerAllPropertyParsers } from \"./parsers/register-parsers.js\";\r\nimport { type StyleAccumulator } from \"./style.js\";\r\nimport { type UnitParsers } from \"../units/units.js\";\r\n\r\nexport { setViewportSize } from \"./viewport.js\";\r\n\r\n// Initialize the property parsers registry\r\nregisterAllPropertyParsers();\r\n\r\n// Define shorthand properties that should be applied before longhands\r\nconst SHORTHAND_PROPERTIES = new Set([\r\n  \"border\",\r\n  \"border-color\",\r\n  \"border-style\",\r\n  \"border-width\",\r\n  \"border-radius\",\r\n  \"margin\",\r\n  \"padding\",\r\n  \"background\",\r\n  \"font\",\r\n  \"text-decoration\",\r\n  \"flex\",\r\n  \"gap\"\r\n]);\r\n\r\n// Cache for frequently used parsers to reduce Map lookups\r\nconst parserCache = new Map<string, PropertyParser>();\r\n\r\nfunction getCachedParser(property: string) {\r\n  if (parserCache.has(property)) {\r\n    return parserCache.get(property);\r\n  }\r\n  const parser = getPropertyParser(property);\r\n  if (parser) {\r\n    parserCache.set(property, parser);\r\n  }\r\n  return parser;\r\n}\r\n\r\nexport function applyDeclarationsToStyle(\r\n  declarations: Record<string, string>,\r\n  target: StyleAccumulator,\r\n  units: UnitParsers,\r\n  inheritedFontWeight?: number\r\n): void {\r\n  // Pre-normalize declarations (lowercase keys and trim values)\r\n  const normalizedDeclarations: Record<string, string> = {};\r\n  for (const [property, value] of Object.entries(declarations)) {\r\n    normalizedDeclarations[property.toLowerCase()] = value.trim();\r\n  }\r\n\r\n  // Separate shorthands and longhands\r\n  const shorthands: Array<[string, string]> = [];\r\n  const longhands: Array<[string, string]> = [];\r\n\r\n  for (const [property, value] of Object.entries(normalizedDeclarations)) {\r\n    if (SHORTHAND_PROPERTIES.has(property)) {\r\n      shorthands.push([property, value]);\r\n    } else {\r\n      longhands.push([property, value]);\r\n    }\r\n  }\r\n\r\n  // Pass 1: Apply shorthands first\r\n  for (const [property, value] of shorthands) {\r\n    const parser = getCachedParser(property);\r\n    if (parser) {\r\n      parser(value, target, units, inheritedFontWeight);\r\n    } else if (!property.startsWith('--')) {\r\n      console.warn(`Unsupported CSS property: ${property}`);\r\n    }\r\n  }\r\n\r\n  // Pass 2: Apply longhands (they can override shorthands)\r\n  for (const [property, value] of longhands) {\r\n    const parser = getCachedParser(property);\r\n    if (parser) {\r\n      parser(value, target, units, inheritedFontWeight);\r\n    } else if (!property.startsWith('--')) {\r\n      console.warn(`Unsupported CSS property: ${property}`);\r\n    }\r\n  }\r\n}\r\n", "/**\r\n * Parse inline style attribute\r\n * Responsibility: Convert style string to property map\r\n */\r\nexport function parseInlineStyle(style: string): Record<string, string> {\r\n    const properties: Record<string, string> = {};\r\n\r\n    if (!style || typeof style !== 'string') {\r\n        return properties;\r\n    }\r\n\r\n    const declarations = style.split(';');\r\n\r\n    for (const decl of declarations) {\r\n        const colonIndex = decl.indexOf(':');\r\n        if (colonIndex === -1) continue;\r\n\r\n        const property = decl.substring(0, colonIndex).trim();\r\n        const value = decl.substring(colonIndex + 1).trim();\r\n\r\n        if (property && value) {\r\n            properties[property] = value;\r\n        }\r\n    }\r\n\r\n    return properties;\r\n}\r\n", "import type { ComputedStyle } from \"./style.js\";\r\nimport { cloneLineHeight } from \"./line-height.js\";\r\n\r\n/**\r\n * Style inheritance resolver\r\n * Responsibility: Determine which CSS properties inherit from parent\r\n */\r\nexport class StyleInheritanceResolver {\r\n    /**\r\n     * Resolve inherited properties from parent style\r\n     */\r\n    static resolveInheritedProperties(\r\n        parentStyle: ComputedStyle,\r\n        mergedDefaults: Partial<any>\r\n    ): {\r\n        color?: string;\r\n        fontSize: number;\r\n        lineHeight: any;\n        fontFamily?: string;\n        fontStyle?: string;\n        fontVariant?: string;\n        fontWeight?: number;\n        letterSpacing?: number;\n        textDecorationLine?: string;\n        textDecorationColor?: string;\n        textDecorationStyle?: string;\n        overflowWrap?: string;\n        textIndent: any; // Using any to match the flexible type system\n        textTransform: string;\n        listStyleType: string;\r\n    } {\r\n        return {\r\n            color: parentStyle.color ?? mergedDefaults.color,\r\n            fontSize: parentStyle.fontSize,\r\n            lineHeight: cloneLineHeight(parentStyle.lineHeight),\n            fontFamily: parentStyle.fontFamily ?? mergedDefaults.fontFamily,\n            fontStyle: parentStyle.fontStyle ?? mergedDefaults.fontStyle,\n            fontVariant: parentStyle.fontVariant ?? mergedDefaults.fontVariant,\n            fontWeight: parentStyle.fontWeight ?? mergedDefaults.fontWeight,\n            letterSpacing: parentStyle.letterSpacing ?? mergedDefaults.letterSpacing,\n            textDecorationLine: parentStyle.textDecorationLine ?? mergedDefaults.textDecorationLine,\n            textDecorationColor: parentStyle.textDecorationColor ?? mergedDefaults.textDecorationColor,\n            textDecorationStyle: parentStyle.textDecorationStyle ?? mergedDefaults.textDecorationStyle,\n            overflowWrap: parentStyle.overflowWrap ?? mergedDefaults.overflowWrap,\n            textIndent: parentStyle.textIndent ?? mergedDefaults.textIndent ?? 0,\n            textTransform: parentStyle.textTransform ?? mergedDefaults.textTransform ?? \"none\",\n            listStyleType: parentStyle.listStyleType ?? mergedDefaults.listStyleType ?? \"disc\",\r\n        };\r\n    }\r\n}\r\n", "import type { LengthInput, LengthLike, RelativeLength } from \"./length.js\";\r\nimport { resolveLengthInput, resolveNumberLike } from \"./length.js\";\r\n\r\n/**\r\n * CSS unit resolver\r\n * Responsibility: Resolve CSS units (px, em, rem, %) to absolute values\r\n */\r\nexport class CssUnitResolver {\r\n    constructor(\r\n        private readonly fontSize: number,\r\n        private readonly rootFontSize: number\r\n    ) { }\r\n\r\n    /**\r\n     * Resolve a LengthInput to absolute pixels\r\n     */\r\n    resolveLengthInput(value: LengthInput | undefined): LengthLike | undefined {\r\n        return resolveLengthInput(value, this.fontSize, this.rootFontSize);\r\n    }\r\n\r\n    /**\r\n     * Resolve a numeric length (number or relative) to pixels\r\n     */\r\n    resolveNumberLike(value: number | RelativeLength | undefined): number | undefined {\r\n        return resolveNumberLike(value, this.fontSize, this.rootFontSize);\r\n    }\r\n\r\n    /**\r\n     * Resolve shadow length with optional clamping to non-negative\r\n     */\r\n    resolveShadowLength(value: number | RelativeLength | undefined, clamp = false): number {\r\n        const resolved = this.resolveNumberLike(value);\r\n        if (resolved === undefined) {\r\n            return 0;\r\n        }\r\n        if (clamp && resolved < 0) {\r\n            return 0;\r\n        }\r\n        return resolved;\r\n    }\r\n\r\n    /**\r\n     * Create a callback to assign resolved length\r\n     */\r\n    createLengthAssigner(setter: (resolved: LengthLike) => void) {\r\n        return (value: LengthInput | undefined): void => {\r\n            const resolved = this.resolveLengthInput(value);\r\n            if (resolved !== undefined) {\r\n                setter(resolved);\r\n            }\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Create a callback to assign resolved numeric length\r\n     */\r\n    createNumberAssigner(setter: (resolved: number) => void) {\r\n        return (value: number | RelativeLength | undefined): void => {\r\n            const resolved = this.resolveNumberLike(value);\r\n            if (resolved !== undefined) {\r\n                setter(resolved);\r\n            }\r\n        };\r\n    }\r\n}\r\n", "import type { TrackDefinitionInput, TrackSizeInput, TrackDefinition, TrackSize } from \"./style.js\";\r\nimport { resolveNumberLike } from \"./length.js\";\r\n\r\n/**\r\n * Layout property resolver\r\n * Responsibility: Resolve complex layout properties (grid, flexbox)\r\n */\r\nexport class LayoutPropertyResolver {\r\n    /**\r\n     * Resolve a track size input to absolute values\r\n     */\r\n    static resolveTrackSizeInputToAbsolute(\r\n        track: TrackSizeInput,\r\n        fontSize: number,\r\n        rootFontSize: number\r\n    ): TrackSize {\r\n        if (track.kind === \"fixed\") {\r\n            return {\r\n                kind: \"fixed\",\r\n                size: resolveNumberLike(track.size, fontSize, rootFontSize) ?? 0,\r\n            };\r\n        }\r\n        if (track.kind === \"flex\") {\r\n            return {\r\n                kind: \"flex\",\r\n                flex: track.flex,\r\n                min: resolveNumberLike(track.min, fontSize, rootFontSize),\r\n                max: resolveNumberLike(track.max, fontSize, rootFontSize),\r\n            };\r\n        }\r\n        return {\r\n            kind: \"auto\",\r\n            min: resolveNumberLike(track.min, fontSize, rootFontSize),\r\n            max: resolveNumberLike(track.max, fontSize, rootFontSize),\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Resolve track definitions (for CSS Grid)\r\n     */\r\n    static resolveTrackDefinitionsInput(\r\n        definitions: TrackDefinitionInput[] | undefined,\r\n        fontSize: number,\r\n        rootFontSize: number\r\n    ): TrackDefinition[] | undefined {\r\n        if (!definitions) {\r\n            return undefined;\r\n        }\r\n        return definitions.map((definition) => {\r\n            if (definition.kind === \"repeat\") {\r\n                return {\r\n                    kind: \"repeat\",\r\n                    count: definition.count,\r\n                    track: LayoutPropertyResolver.resolveTrackSizeInputToAbsolute(\r\n                        definition.track,\r\n                        fontSize,\r\n                        rootFontSize\r\n                    ),\r\n                };\r\n            }\r\n            if (definition.kind === \"repeat-auto\") {\r\n                return {\r\n                    kind: \"repeat-auto\",\r\n                    mode: definition.mode,\r\n                    track: LayoutPropertyResolver.resolveTrackSizeInputToAbsolute(\r\n                        definition.track,\r\n                        fontSize,\r\n                        rootFontSize\r\n                    ),\r\n                };\r\n            }\r\n            return LayoutPropertyResolver.resolveTrackSizeInputToAbsolute(definition, fontSize, rootFontSize);\r\n        });\r\n    }\r\n}\r\n", "// src/css/compute-style.ts\r\n\r\nimport { type DomEl, type CssRuleEntry } from \"../html/css/parse-css.js\";\r\nimport { type UnitParsers } from \"../units/units.js\";\r\nimport {\r\n  ComputedStyle,\r\n  type StyleProperties,\r\n  type StyleAccumulator,\r\n} from \"./style.js\";\r\nimport { resolveNumberLike } from \"./length.js\";\r\nimport { ElementSpecificDefaults, BrowserDefaults } from \"./browser-defaults.js\";\r\nimport { applyDeclarationsToStyle } from \"./apply-declarations.js\";\r\nimport { normalizeFontWeight } from './font-weight.js';\r\nimport { FloatMode, Display } from \"./enums.js\";\r\nimport { log } from \"../logging/debug.js\";\r\nimport { cloneLineHeight, lineHeightEquals, resolveLineHeightInput } from \"./line-height.js\";\r\nimport { parseInlineStyle } from \"./inline-style-parser.js\";\r\nimport { StyleInheritanceResolver } from \"./style-inheritance.js\";\r\nimport { CssUnitResolver } from \"./css-unit-resolver.js\";\r\nimport { LayoutPropertyResolver } from \"./layout-property-resolver.js\";\r\nimport {\r\n  CustomPropertiesMap,\r\n  extractCustomProperties,\r\n  resolveDeclarationsWithVariables,\r\n} from \"./custom-properties.js\";\r\n\r\nfunction mapFloat(value: string | undefined): FloatMode | undefined {\r\n  switch (value) {\r\n    case \"left\":\r\n      return FloatMode.Left;\r\n    case \"right\":\r\n      return FloatMode.Right;\r\n    case \"none\":\r\n      return FloatMode.None;\r\n    default:\r\n      return undefined;\r\n  }\r\n}\r\n\r\n// parseInlineStyle now imported from inline-style-parser.ts\r\n\r\nfunction defaultDisplayForTag(tag: string): Display {\r\n  let display: Display;\r\n  switch (tag) {\r\n    case \"span\":\r\n    case \"a\":\r\n    case \"strong\":\r\n    case \"em\":\r\n    case \"b\":\r\n    case \"s\":\r\n    case \"strike\":\r\n    case \"del\":\r\n    case \"label\":\r\n    case \"code\":\r\n    case \"small\":\r\n    case \"time\":\r\n    case \"i\":\r\n    case \"u\":\r\n    case \"sub\":\r\n    case \"sup\":\r\n    case \"mark\":\r\n    case \"abbr\":\r\n    case \"cite\":\r\n    case \"dfn\":\r\n    case \"kbd\":\r\n    case \"q\":\r\n    case \"tt\":\r\n      display = Display.Inline;\r\n      break;\r\n    case \"table\":\r\n      display = Display.Table;\r\n      break;\r\n    case \"tbody\":\r\n    case \"thead\":\r\n    case \"tfoot\":\r\n      display = Display.TableRowGroup;\r\n      break;\r\n    case \"tr\":\r\n      display = Display.TableRow;\r\n      break;\r\n    case \"td\":\r\n    case \"th\":\r\n      display = Display.TableCell;\r\n      break;\r\n    case \"caption\":\r\n      display = Display.TableCaption;\r\n      break;\r\n    case \"div\":\r\n    case \"section\":\r\n    case \"main\":\r\n    case \"article\":\r\n    case \"header\":\r\n    case \"footer\":\r\n    case \"nav\":\r\n    case \"p\":\r\n    case \"ul\":\r\n    case \"ol\":\r\n    case \"li\":\r\n    case \"h1\":\r\n    case \"h2\":\r\n    case \"h3\":\r\n    case \"h4\":\r\n    case \"h5\":\r\n    case \"h6\":\r\n      display = Display.Block;\r\n      break;\r\n    default:\r\n      display = Display.Block;\r\n      break;\r\n  }\r\n  log(\"style\", \"trace\", \"defaultDisplayForTag\", { tag, display });\r\n  return display;\r\n}\r\n\r\nconst RELATIVE_FONT_SIZE_TAG_SCALE: Record<string, number> = {\r\n  small: 0.8,\r\n  big: 1.2,\r\n};\r\n\r\n// resolveTrackSizeInputToAbsolute and resolveTrackDefinitionsInput now in layout-property-resolver.ts\r\n\r\nexport function computeStyleForElement(\r\n  element: DomEl,\r\n  cssRules: CssRuleEntry[],\r\n  parentStyle: ComputedStyle,\r\n  units: UnitParsers,\r\n  rootFontSize?: number,\r\n): ComputedStyle {\r\n  const tagName = element.tagName.toLowerCase();\r\n\r\n  // Get element-specific defaults from browser defaults system\r\n  const elementDefaults = ElementSpecificDefaults.getDefaultsForElement(tagName);\r\n\r\n  // Create base style with browser defaults\r\n  const baseDefaults = BrowserDefaults.createBaseDefaults();\r\n\r\n  // Merge element-specific defaults with base defaults\r\n  const mergedDefaults = BrowserDefaults.mergeElementDefaults(baseDefaults, elementDefaults);\r\n\r\n  // Apply inheritance from parent\r\n  const inherited = StyleInheritanceResolver.resolveInheritedProperties(parentStyle, mergedDefaults);\r\n\r\n  const styleInit: StyleAccumulator = {};\r\n  const aggregated: Record<string, string> = {};\r\n\r\n  // Apply CSS rules\r\n  for (const rule of cssRules) {\r\n    if (rule.match(element)) {\r\n      log(\"style\", \"debug\", \"CSS rule matched\", { selector: rule.selector, declarations: rule.declarations });\r\n      if (rule.declarations.display) {\r\n        log(\"style\", \"debug\", \"Display declaration found\", { selector: rule.selector, display: rule.declarations.display });\r\n      }\r\n      // Normalize rule declarations to lowercase keys (except custom properties which are case-sensitive)\r\n      const normalizedRuleDeclarations: Record<string, string> = {};\r\n      for (const [prop, value] of Object.entries(rule.declarations)) {\r\n        if (prop.startsWith('--')) {\r\n          normalizedRuleDeclarations[prop] = value;\r\n        } else {\r\n          normalizedRuleDeclarations[prop.toLowerCase()] = value;\r\n        }\r\n      }\r\n      Object.assign(aggregated, normalizedRuleDeclarations);\r\n    }\r\n  }\r\n\r\n  // Apply inline styles (highest priority)\r\n  const inlineStyle = parseInlineStyle(element.getAttribute(\"style\") ?? \"\");\r\n  if (Object.keys(inlineStyle).length > 0) {\r\n    log(\"style\", \"debug\", \"inline style applied\", { declarations: inlineStyle });\r\n  }\r\n  Object.assign(aggregated, inlineStyle);\r\n\r\n  // === CSS Custom Properties (CSS Variables) Support ===\r\n\r\n  // 1. Inherit custom properties from parent\r\n  let customProperties = parentStyle.customProperties\r\n    ? parentStyle.customProperties.clone()\r\n    : new CustomPropertiesMap();\r\n\r\n  // 2. Extract and merge custom properties from this element's declarations\r\n  const elementCustomProps = extractCustomProperties(aggregated);\r\n  customProperties = elementCustomProps.inherit(customProperties);\r\n\r\n  log(\"style\", \"debug\", \"custom properties\", {\r\n    count: customProperties.size,\r\n    keys: customProperties.keys()\r\n  });\r\n\r\n  // 3. Resolve var() references in all declarations\r\n  const resolvedDeclarations = resolveDeclarationsWithVariables(aggregated, customProperties);\r\n\r\n  // Apply declarations to style accumulator\r\n  applyDeclarationsToStyle(resolvedDeclarations, styleInit, units, inherited.fontWeight ?? mergedDefaults.fontWeight);\r\n\r\n  // Determine final display value\r\n  const defaultDisplay = mergedDefaults.display ?? defaultDisplayForTag(tagName);\r\n  let display = styleInit.display ?? defaultDisplay;\r\n\r\n  log(\"style\", \"debug\", \"computeStyleForElement display\", {\r\n    tagName,\r\n    styleInitDisplay: styleInit.display,\r\n    defaultDisplay,\r\n    finalDisplay: display\r\n  });\r\n\r\n  // Force correct display for table elements if they're not set correctly\r\n  if (tagName === 'table') {\r\n    if (display !== Display.Table) {\r\n      log(\"style\", \"debug\", \"Forcing table display\", { tagName, originalDisplay: display });\r\n      display = Display.Table;\r\n    }\r\n  } else if (tagName === 'thead' || tagName === 'tbody' || tagName === 'tfoot') {\r\n    if (display !== Display.TableRowGroup) {\r\n      log(\"style\", \"debug\", \"Forcing table-row-group display\", { tagName, originalDisplay: display });\r\n      display = Display.TableRowGroup;\r\n    }\r\n  } else if (tagName === 'tr') {\r\n    if (display !== Display.TableRow) {\r\n      log(\"style\", \"debug\", \"Forcing table-row display\", { tagName, originalDisplay: display });\r\n      display = Display.TableRow;\r\n    }\r\n  } else if (tagName === 'td' || tagName === 'th') {\r\n    if (display !== Display.TableCell) {\r\n      log(\"style\", \"debug\", \"Forcing table-cell display\", { tagName, originalDisplay: display });\r\n      display = Display.TableCell;\r\n    }\r\n  }\r\n\r\n  const floatValue = mapFloat(styleInit.float);\r\n\r\n  // Build final style options with proper precedence:\r\n  // 1. Base browser defaults\r\n  // 2. Element-specific defaults\r\n  // 3. Inherited values\r\n  // 4. CSS rules\r\n  // 5. Inline styles (already applied in aggregated)\r\n  const elementDefinesFontWeight = elementDefaults.fontWeight !== undefined;\r\n  const elementDefinesFontStyle = elementDefaults.fontStyle !== undefined;\r\n  const elementDefinesFontSize = mergedDefaults.fontSize !== baseDefaults.fontSize;\r\n  const elementDefinesLineHeight = !lineHeightEquals(mergedDefaults.lineHeight, baseDefaults.lineHeight);\r\n\r\n  const styleOptions: Partial<StyleProperties> & { customProperties?: CustomPropertiesMap } = {\r\n    customProperties,\r\n    // Start with merged defaults\r\n    ...mergedDefaults,\r\n    // Override with inherited values\r\n    color: inherited.color,\r\n    fontSize: elementDefinesFontSize ? mergedDefaults.fontSize : inherited.fontSize,\r\n    lineHeight: cloneLineHeight(\r\n      elementDefinesLineHeight ? mergedDefaults.lineHeight : inherited.lineHeight,\r\n    ),\r\n    fontFamily: inherited.fontFamily,\r\n    fontStyle: elementDefinesFontStyle ? mergedDefaults.fontStyle : inherited.fontStyle,\r\n    fontWeight: elementDefinesFontWeight ? mergedDefaults.fontWeight : normalizeFontWeight(inherited.fontWeight),\r\n    overflowWrap: inherited.overflowWrap,\r\n    textIndent: inherited.textIndent ?? mergedDefaults.textIndent ?? 0,\r\n    textTransform: inherited.textTransform ?? \"none\",\r\n    letterSpacing: inherited.letterSpacing ?? mergedDefaults.letterSpacing,\r\n    listStyleType: inherited.listStyleType ?? mergedDefaults.listStyleType ?? \"disc\",\r\n    // Apply computed values\r\n    display,\r\n    float: floatValue ?? FloatMode.None,\r\n    borderModel: styleInit.borderModel ?? mergedDefaults.borderModel,\r\n  };\r\n\r\n  const rootFontReference = rootFontSize ?? parentStyle.fontSize ?? mergedDefaults.fontSize;\r\n\r\n  const baseFontSize = styleOptions.fontSize ?? inherited.fontSize ?? mergedDefaults.fontSize;\r\n  let computedFontSize: number = baseFontSize;\r\n  if (styleInit.fontSize !== undefined) {\r\n    const resolvedFontSize = resolveNumberLike(styleInit.fontSize, inherited.fontSize, rootFontReference);\r\n    if (resolvedFontSize !== undefined) {\r\n      computedFontSize = resolvedFontSize;\r\n    }\r\n  } else {\r\n    const resolvedFontSize = resolveNumberLike(mergedDefaults.fontSize, inherited.fontSize, rootFontReference);\r\n    if (resolvedFontSize !== undefined) {\r\n      computedFontSize = resolvedFontSize;\r\n    }\r\n    const relativeScale = RELATIVE_FONT_SIZE_TAG_SCALE[tagName];\r\n    if (relativeScale !== undefined) {\r\n      computedFontSize = (inherited.fontSize ?? 16) * relativeScale;\r\n    }\r\n  }\r\n  styleOptions.fontSize = computedFontSize;\r\n\r\n  if (styleInit.lineHeight !== undefined) {\r\n    styleOptions.lineHeight = resolveLineHeightInput(\r\n      styleInit.lineHeight,\r\n      computedFontSize,\r\n      rootFontReference,\r\n    );\r\n  }\r\n\r\n  // Create unit resolver with computed font sizes\r\n  const unitResolver = new CssUnitResolver(computedFontSize, rootFontReference);\r\n  const assignLength = (value: any, setter: (resolved: any) => void): void => {\r\n    unitResolver.createLengthAssigner(setter)(value);\r\n  };\r\n  const assignNumberLength = (value: any, setter: (resolved: any) => void): void => {\r\n    unitResolver.createNumberAssigner(setter)(value);\r\n  };\r\n\r\n  if (styleInit.position !== undefined) styleOptions.position = styleInit.position;\r\n  if (styleInit.top !== undefined) assignLength(styleInit.top, (v) => (styleOptions.top = v));\r\n  if (styleInit.right !== undefined) assignLength(styleInit.right, (v) => (styleOptions.right = v));\r\n  if (styleInit.bottom !== undefined) assignLength(styleInit.bottom, (v) => (styleOptions.bottom = v));\r\n  if (styleInit.left !== undefined) assignLength(styleInit.left, (v) => (styleOptions.left = v));\r\n  if (styleInit.zIndex !== undefined) styleOptions.zIndex = styleInit.zIndex;\r\n  if (styleInit.color !== undefined) styleOptions.color = styleInit.color;\r\n  if (styleInit.backgroundLayers !== undefined) styleOptions.backgroundLayers = styleInit.backgroundLayers;\n  if (styleInit.clipPath !== undefined) (styleOptions as any).clipPath = styleInit.clipPath;\n  if (styleInit.borderColor !== undefined) styleOptions.borderColor = styleInit.borderColor;\r\n  if (styleInit.borderStyleTop !== undefined) styleOptions.borderStyleTop = styleInit.borderStyleTop;\r\n  if (styleInit.borderStyleRight !== undefined) styleOptions.borderStyleRight = styleInit.borderStyleRight;\r\n  if (styleInit.borderStyleBottom !== undefined) styleOptions.borderStyleBottom = styleInit.borderStyleBottom;\r\n  if (styleInit.borderStyleLeft !== undefined) styleOptions.borderStyleLeft = styleInit.borderStyleLeft;\r\n  if (styleInit.boxShadows !== undefined) {\r\n    styleOptions.boxShadows = styleInit.boxShadows.map((shadow) => ({\r\n      inset: shadow.inset,\r\n      offsetX: unitResolver.resolveShadowLength(shadow.offsetX),\r\n      offsetY: unitResolver.resolveShadowLength(shadow.offsetY),\r\n      blurRadius: unitResolver.resolveShadowLength(shadow.blurRadius, true),\r\n      spreadRadius: unitResolver.resolveShadowLength(shadow.spreadRadius),\r\n      color: shadow.color,\r\n    }));\r\n  }\r\n\r\n  if (styleInit.textShadows !== undefined) {\r\n    styleOptions.textShadows = styleInit.textShadows.map((shadow) => ({\r\n      offsetX: unitResolver.resolveShadowLength(shadow.offsetX),\r\n      offsetY: unitResolver.resolveShadowLength(shadow.offsetY),\r\n      blurRadius: unitResolver.resolveShadowLength(shadow.blurRadius, true),\r\n      color: shadow.color,\r\n    }));\r\n  }\r\n  if (styleInit.fontFamily !== undefined) styleOptions.fontFamily = styleInit.fontFamily;\r\n  if (styleInit.fontStyle !== undefined) styleOptions.fontStyle = styleInit.fontStyle;\r\n  if (styleInit.fontVariant !== undefined) styleOptions.fontVariant = styleInit.fontVariant;\r\n  if (styleInit.fontWeight !== undefined) styleOptions.fontWeight = normalizeFontWeight(styleInit.fontWeight);\r\n  if (styleInit.overflowWrap !== undefined) styleOptions.overflowWrap = styleInit.overflowWrap;\r\n  if (styleInit.marginTop !== undefined) assignLength(styleInit.marginTop, (v) => (styleOptions.marginTop = v));\r\n  else styleOptions.marginTop = resolveNumberLike(mergedDefaults.marginTop, computedFontSize, rootFontReference);\r\n  if (styleInit.marginRight !== undefined) assignLength(styleInit.marginRight, (v) => (styleOptions.marginRight = v));\r\n  else styleOptions.marginRight = resolveNumberLike(mergedDefaults.marginRight, computedFontSize, rootFontReference);\r\n  if (styleInit.marginBottom !== undefined) assignLength(styleInit.marginBottom, (v) => (styleOptions.marginBottom = v));\r\n  else styleOptions.marginBottom = resolveNumberLike(mergedDefaults.marginBottom, computedFontSize, rootFontReference);\r\n  if (styleInit.marginLeft !== undefined) assignLength(styleInit.marginLeft, (v) => (styleOptions.marginLeft = v));\r\n  else styleOptions.marginLeft = resolveNumberLike(mergedDefaults.marginLeft, computedFontSize, rootFontReference);\r\n  if (styleInit.paddingTop !== undefined) assignLength(styleInit.paddingTop, (v) => (styleOptions.paddingTop = v));\r\n  if (styleInit.paddingRight !== undefined) assignLength(styleInit.paddingRight, (v) => (styleOptions.paddingRight = v));\r\n  if (styleInit.paddingBottom !== undefined) assignLength(styleInit.paddingBottom, (v) => (styleOptions.paddingBottom = v));\r\n  if (styleInit.paddingLeft !== undefined) assignLength(styleInit.paddingLeft, (v) => (styleOptions.paddingLeft = v));\r\n  if (styleInit.borderTop !== undefined) assignLength(styleInit.borderTop, (v) => (styleOptions.borderTop = v));\r\n  if (styleInit.borderRight !== undefined) assignLength(styleInit.borderRight, (v) => (styleOptions.borderRight = v));\r\n  if (styleInit.borderBottom !== undefined) assignLength(styleInit.borderBottom, (v) => (styleOptions.borderBottom = v));\r\n  if (styleInit.borderLeft !== undefined) assignLength(styleInit.borderLeft, (v) => (styleOptions.borderLeft = v));\r\n  if (styleInit.borderTopLeftRadiusX !== undefined)\r\n    assignNumberLength(styleInit.borderTopLeftRadiusX, (v) => (styleOptions.borderTopLeftRadiusX = v));\r\n  if (styleInit.borderTopLeftRadiusY !== undefined)\r\n    assignNumberLength(styleInit.borderTopLeftRadiusY, (v) => (styleOptions.borderTopLeftRadiusY = v));\r\n  if (styleInit.borderTopRightRadiusX !== undefined)\r\n    assignNumberLength(styleInit.borderTopRightRadiusX, (v) => (styleOptions.borderTopRightRadiusX = v));\r\n  if (styleInit.borderTopRightRadiusY !== undefined)\r\n    assignNumberLength(styleInit.borderTopRightRadiusY, (v) => (styleOptions.borderTopRightRadiusY = v));\r\n  if (styleInit.borderBottomRightRadiusX !== undefined)\r\n    assignNumberLength(styleInit.borderBottomRightRadiusX, (v) => (styleOptions.borderBottomRightRadiusX = v));\r\n  if (styleInit.borderBottomRightRadiusY !== undefined)\r\n    assignNumberLength(styleInit.borderBottomRightRadiusY, (v) => (styleOptions.borderBottomRightRadiusY = v));\r\n  if (styleInit.borderBottomLeftRadiusX !== undefined)\r\n    assignNumberLength(styleInit.borderBottomLeftRadiusX, (v) => (styleOptions.borderBottomLeftRadiusX = v));\r\n  if (styleInit.borderBottomLeftRadiusY !== undefined)\r\n    assignNumberLength(styleInit.borderBottomLeftRadiusY, (v) => (styleOptions.borderBottomLeftRadiusY = v));\r\n  if (styleInit.width !== undefined) assignLength(styleInit.width, (v) => (styleOptions.width = v));\r\n  if (styleInit.minWidth !== undefined) assignLength(styleInit.minWidth, (v) => (styleOptions.minWidth = v));\r\n  if (styleInit.maxWidth !== undefined) assignLength(styleInit.maxWidth, (v) => (styleOptions.maxWidth = v));\r\n  if (styleInit.height !== undefined) assignLength(styleInit.height, (v) => (styleOptions.height = v));\r\n  if (styleInit.minHeight !== undefined) assignLength(styleInit.minHeight, (v) => (styleOptions.minHeight = v));\r\n  if (styleInit.maxHeight !== undefined) assignLength(styleInit.maxHeight, (v) => (styleOptions.maxHeight = v));\r\n  if (styleInit.trackListColumns !== undefined) {\r\n    const resolved = LayoutPropertyResolver.resolveTrackDefinitionsInput(styleInit.trackListColumns, computedFontSize, rootFontReference);\r\n    if (resolved) {\r\n      styleOptions.trackListColumns = resolved;\r\n    }\r\n  }\r\n  if (styleInit.trackListRows !== undefined) {\r\n    const resolved = LayoutPropertyResolver.resolveTrackDefinitionsInput(styleInit.trackListRows, computedFontSize, rootFontReference);\r\n    if (resolved) {\r\n      styleOptions.trackListRows = resolved;\r\n    }\r\n  }\r\n  if (styleInit.autoFlow !== undefined) {\r\n    styleOptions.autoFlow = styleInit.autoFlow;\r\n  }\r\n  if (styleInit.rowGap !== undefined) {\r\n    assignNumberLength(styleInit.rowGap, (v) => (styleOptions.rowGap = v));\r\n  }\r\n  if (styleInit.columnGap !== undefined) {\r\n    assignNumberLength(styleInit.columnGap, (v) => (styleOptions.columnGap = v));\r\n  }\r\n  if (styleInit.justifyContent !== undefined) styleOptions.justifyContent = styleInit.justifyContent;\r\n  if (styleInit.alignItems !== undefined) styleOptions.alignItems = styleInit.alignItems;\r\n  if (styleInit.alignContent !== undefined) styleOptions.alignContent = styleInit.alignContent;\r\n  if (styleInit.alignSelf !== undefined) styleOptions.alignSelf = styleInit.alignSelf;\r\n  if (styleInit.flexDirection !== undefined) styleOptions.flexDirection = styleInit.flexDirection;\r\n  if (styleInit.flexWrap !== undefined) styleOptions.flexWrap = styleInit.flexWrap;\r\n  if (styleInit.textAlign !== undefined) styleOptions.textAlign = styleInit.textAlign;\r\n  if (styleInit.textIndent !== undefined) assignLength(styleInit.textIndent, (v) => (styleOptions.textIndent = v));\r\n  if (styleInit.textTransform !== undefined) styleOptions.textTransform = styleInit.textTransform;\r\n  if (styleInit.letterSpacing !== undefined) assignNumberLength(styleInit.letterSpacing, (v) => (styleOptions.letterSpacing = v));\r\n  if (styleInit.listStyleType !== undefined) styleOptions.listStyleType = styleInit.listStyleType;\r\n  // If a raw transform string was parsed, preserve it on the computed style so downstream\r\n  // consumers (e.g. text run builders / renderers) can apply mapping for text.\r\n  if ((styleInit as any).transform !== undefined) {\r\n    styleOptions.transform = (styleInit as any).transform;\r\n  }\r\n  if (styleInit.objectFit !== undefined) {\r\n    styleOptions.objectFit = styleInit.objectFit as StyleProperties[\"objectFit\"];\r\n  }\r\n  if (styleInit.opacity !== undefined) {\r\n    styleOptions.opacity = styleInit.opacity;\r\n  }\r\n\r\n  const defaultDecoration = mergedDefaults.textDecorationLine ?? \"none\";\r\n  let decoration = inherited.textDecorationLine ?? defaultDecoration;\r\n  if (elementDefaults.textDecorationLine !== undefined) {\r\n    decoration = elementDefaults.textDecorationLine;\r\n  }\r\n  if (styleInit.textDecorationLine !== undefined) {\r\n    decoration = styleInit.textDecorationLine;\r\n  }\r\n  styleOptions.textDecorationLine = decoration;\r\n\r\n  let decorationColor =\r\n    styleInit.textDecorationColor !== undefined\r\n      ? normalizeTextDecorationColor(styleInit.textDecorationColor)\r\n      : undefined;\r\n  if (decorationColor === undefined) {\r\n    decorationColor =\r\n      elementDefaults.textDecorationColor !== undefined\r\n        ? normalizeTextDecorationColor(elementDefaults.textDecorationColor)\r\n        : undefined;\r\n  }\r\n  if (decorationColor === undefined && inherited.textDecorationColor !== undefined) {\r\n    decorationColor = inherited.textDecorationColor;\r\n  }\r\n  if (decorationColor !== undefined) {\r\n    styleOptions.textDecorationColor = decorationColor;\r\n  }\r\n\r\n  const defaultDecorationStyle = mergedDefaults.textDecorationStyle ?? \"solid\";\r\n  let decorationStyle = inherited.textDecorationStyle ?? defaultDecorationStyle;\r\n  if ((elementDefaults as any).textDecorationStyle !== undefined) {\r\n    decorationStyle = (elementDefaults as any).textDecorationStyle as string;\r\n  }\r\n  if ((styleInit as any).textDecorationStyle !== undefined) {\r\n    decorationStyle = (styleInit as any).textDecorationStyle as string;\r\n  }\r\n  styleOptions.textDecorationStyle = decorationStyle;\r\n\r\n  // Debug fontStyle for em and strong elements\r\n  if (tagName === 'em' || tagName === 'strong') {\r\n    const debugInfo = {\r\n      tagName,\r\n      elementDefaultsFontStyle: elementDefaults.fontStyle,\r\n      mergedFontStyle: mergedDefaults.fontStyle,\r\n      finalFontStyle: styleOptions.fontStyle\r\n    };\r\n    log(\"style\", \"debug\", \"element fontStyle\", debugInfo);\r\n  }\r\n\r\n  return new ComputedStyle(styleOptions);\r\n}\r\n\r\nfunction normalizeTextDecorationColor(value: string | undefined): string | undefined {\r\n  if (value === undefined) {\r\n    return undefined;\r\n  }\r\n  const trimmed = value.trim();\r\n  if (!trimmed) {\r\n    return undefined;\r\n  }\r\n  const lower = trimmed.toLowerCase();\r\n  if (lower === \"inherit\") {\r\n    return undefined;\r\n  }\r\n  if (lower === \"initial\") {\r\n    return \"currentcolor\";\r\n  }\r\n  if (lower === \"unset\" || lower === \"revert\" || lower === \"revert-layer\") {\r\n    return undefined;\r\n  }\r\n  return lower === \"currentcolor\" ? \"currentcolor\" : trimmed;\r\n}\r\n", "// src/html/image-converter.ts\r\n\r\nimport path from \"node:path\";\nimport { type DomEl, type CssRuleEntry } from \"./css/parse-css.js\";\r\nimport { LayoutNode } from \"../dom/node.js\";\r\nimport { ComputedStyle } from \"../css/style.js\";\nimport { computeStyleForElement } from \"../css/compute-style.js\";\nimport { ImageService } from \"../image/image-service.js\";\nimport { ImageStrategy } from \"../layout/strategies/image.js\";\nimport type { ImageInfo } from \"../image/types.js\";\nimport type { UnitParsers } from \"../units/units.js\";\nimport { log } from \"../logging/debug.js\";\nimport { decodeBase64ToUint8Array } from \"../utils/base64.js\";\n\r\n// The ConversionContext should be defined where it's used\r\nexport interface ConversionContext {\n  resourceBaseDir: string;\n  assetRootDir: string;\n  units: UnitParsers;\n  rootFontSize: number;\n  environment?: import(\"../environment/environment.js\").Environment;\n}\n\r\nexport function resolveImageSource(src: string, context: ConversionContext): string {\n  const trimmed = src.trim();\r\n  if (!trimmed) {\r\n    return trimmed;\r\n  }\r\n  if (/^data:/i.test(trimmed)) {\r\n    return trimmed;\r\n  }\r\n  try {\r\n    const url = new URL(trimmed);\r\n    if (url.protocol === \"file:\") {\r\n      return url.href;\r\n    }\r\n    return url.href;\r\n  } catch {\r\n    // Not an absolute URL, fall through to filesystem resolution\r\n  }\r\n  if (context.environment?.resolveLocal) {\n    return context.environment.resolveLocal(trimmed, context.resourceBaseDir || context.assetRootDir || undefined);\n  }\n  if (trimmed.startsWith(\"/\")) {\n    const resolved = context.assetRootDir ? path.resolve(context.assetRootDir, `.${trimmed}`) : trimmed;\n    log('image-converter', 'debug', \"resolveImageSource - resolving absolute path:\", { src, trimmed, assetRootDir: context.assetRootDir, resolved });\n    return resolved;\n  }\n  if (path.isAbsolute(trimmed)) {\n    return trimmed;\n  }\n  return context.resourceBaseDir ? path.resolve(context.resourceBaseDir, trimmed) : trimmed;\n}\n\r\nfunction isHttpUrl(value: string): boolean {\r\n  return /^https?:\\/\\//i.test(value);\r\n}\r\n\r\nexport async function convertImageElement(\r\n  element: DomEl,\r\n  cssRules: CssRuleEntry[],\r\n  parentStyle: ComputedStyle,\r\n  context: ConversionContext,\r\n): Promise<LayoutNode> {\r\n  const style = computeStyleForElement(element, cssRules, parentStyle, context.units, context.rootFontSize);\r\n  // SVG <image> elements commonly use 'href' or 'xlink:href'; HTML <img> uses 'src'.\r\n  const rawSrc = element.getAttribute(\"href\") ?? element.getAttribute(\"xlink:href\") ?? element.getAttribute(\"src\") ?? \"\";\r\n  const srcAttr = rawSrc?.trim() ?? \"\";\r\n\r\n  const widthAttr = element.getAttribute(\"width\");\r\n  const heightAttr = element.getAttribute(\"height\");\r\n  const width = widthAttr ? Number.parseFloat(widthAttr) || undefined : undefined;\r\n  const height = heightAttr ? Number.parseFloat(heightAttr) || undefined : undefined;\r\n\r\n  if (!srcAttr) {\r\n    const placeholder = new LayoutNode(style, [], { tagName: \"img\" });\r\n    placeholder.intrinsicInlineSize = width ?? 100;\r\n    placeholder.intrinsicBlockSize = height ?? 100;\r\n    return placeholder;\r\n  }\r\n\r\n  const resolvedSrc = resolveImageSource(srcAttr, context);\r\n\r\n  let imageInfo: ImageInfo;\r\n  try {\r\n    const imageService = ImageService.getInstance(context.environment);\n    if (isHttpUrl(resolvedSrc)) {\r\n      throw new Error(`Remote images are not supported (${resolvedSrc})`);\r\n    }\r\n    if (resolvedSrc.startsWith(\"data:\")) {\r\n      const match = resolvedSrc.match(/^data:image\\/(.+);base64,(.+)$/);\r\n      if (!match) {\r\n        throw new Error(\"Invalid data URI\");\r\n      }\r\n      const bytes = decodeBase64ToUint8Array(match[2]);\n      const copy = bytes.slice();\n      imageInfo = await imageService.decodeImage(copy.buffer, {\n        maxWidth: width,\n        maxHeight: height,\n      });\n    } else {\r\n      imageInfo = await imageService.loadImage(resolvedSrc, {\r\n        maxWidth: width,\r\n        maxHeight: height,\r\n      });\r\n    }\r\n\r\n    log(\"render-tree\", \"debug\", \"Image loaded successfully\", {\r\n      src: srcAttr,\r\n      resolvedSrc,\r\n      width: imageInfo.width,\r\n      height: imageInfo.height,\r\n      format: imageInfo.format,\r\n    });\r\n  } catch (error) {\r\n    log(\"render-tree\", \"warn\", `Failed to load image: ${srcAttr}. Using placeholder.`, {\r\n      resolvedSrc,\r\n      error: error instanceof Error ? error.message : String(error),\r\n    });\r\n    const placeholder = new LayoutNode(style, [], { tagName: \"img\" });\r\n    placeholder.intrinsicInlineSize = width ?? 100;\r\n    placeholder.intrinsicBlockSize = height ?? 100;\r\n    return placeholder;\r\n  }\r\n\r\n  const layoutNode = new LayoutNode(style, [], {\r\n    tagName: \"img\",\r\n    customData: {\r\n      image: {\r\n        originalSrc: srcAttr,\r\n        resolvedSrc,\r\n        info: imageInfo,\r\n      },\r\n    },\r\n  });\r\n\r\n  layoutNode.intrinsicInlineSize = imageInfo.width;\r\n  layoutNode.intrinsicBlockSize = imageInfo.height;\r\n\r\n  ImageStrategy.processImage(layoutNode, imageInfo);\r\n\r\n  if (width && height) {\r\n    layoutNode.intrinsicInlineSize = width;\r\n    layoutNode.intrinsicBlockSize = height;\r\n  } else if (width) {\r\n    layoutNode.intrinsicInlineSize = width;\r\n    layoutNode.intrinsicBlockSize = Math.round((imageInfo.height / imageInfo.width) * width);\r\n  } else if (height) {\r\n    layoutNode.intrinsicBlockSize = height;\r\n    layoutNode.intrinsicInlineSize = Math.round((imageInfo.width / imageInfo.height) * height);\r\n  }\r\n\r\n  return layoutNode;\r\n}\r\n", "import type { ImageInfo } from \"./types.js\";\r\n\r\nexport interface DecodeOptions {\r\n  maxWidth?: number;\r\n  maxHeight?: number;\r\n  scale?: number;\r\n}\r\n\r\nexport class DataReader {\r\n  private view: DataView;\r\n  private offset: number = 0;\r\n\r\n  constructor(buffer: ArrayBuffer) {\r\n    this.view = new DataView(buffer);\r\n  }\r\n\r\n  public seek(offset: number): void {\r\n    this.offset = offset;\r\n  }\r\n\r\n  public tell(): number {\r\n    return this.offset;\r\n  }\r\n\r\n  public hasMore(): boolean {\r\n    return this.offset < this.view.byteLength;\r\n  }\r\n\r\n  public getUint8(): number {\r\n    const value = this.view.getUint8(this.offset);\r\n    this.offset += 1;\r\n    return value;\r\n  }\r\n\r\n  public getUint16(littleEndian: boolean = false): number {\r\n    const value = this.view.getUint16(this.offset, littleEndian);\r\n    this.offset += 2;\r\n    return value;\r\n  }\r\n\r\n  public getUint32(littleEndian: boolean = false): number {\r\n    const value = this.view.getUint32(this.offset, littleEndian);\r\n    this.offset += 4;\r\n    return value;\r\n  }\r\n\r\n  public getString(length: number): string {\r\n    let str = \"\";\r\n    for (let i = 0; i < length; i++) {\r\n      str += String.fromCharCode(this.getUint8());\r\n    }\r\n    return str;\r\n  }\r\n\r\n  public getView(length: number): DataView {\r\n    const view = new DataView(this.view.buffer, this.view.byteOffset + this.offset, length);\r\n    this.offset += length;\r\n    return view;\r\n  }\r\n}\r\n\r\nexport class BitReader {\r\n  private view: DataView;\r\n  private bytePos: number = 0;\r\n  private bitPos: number = 0;\r\n\r\n  constructor(view: DataView) {\r\n    this.view = view;\r\n  }\r\n\r\n  public readBits(n: number): number {\r\n    let value = 0;\r\n    for (let i = 0; i < n; i++) {\r\n      if (this.bytePos >= this.view.byteLength) return value;\r\n      const byte = this.view.getUint8(this.bytePos);\r\n      const bit = (byte >> this.bitPos) & 1;\r\n      value |= bit << i;\r\n      this.bitPos++;\r\n      if (this.bitPos === 8) {\r\n        this.bitPos = 0;\r\n        this.bytePos++;\r\n      }\r\n    }\r\n    return value;\r\n  }\r\n}\r\n\r\nexport abstract class BaseDecoder {\r\n  protected static calculateDimensions(\r\n    width: number,\r\n    height: number,\r\n    options: DecodeOptions\r\n  ): { targetWidth: number; targetHeight: number } {\r\n    let targetWidth = width;\r\n    let targetHeight = height;\r\n\r\n    if (options.scale && options.scale > 0) {\r\n      targetWidth = Math.max(1, Math.round(width * options.scale));\r\n      targetHeight = Math.max(1, Math.round(height * options.scale));\r\n    } else if (options.maxWidth || options.maxHeight) {\r\n      const scale = Math.min(\r\n        options.maxWidth ? options.maxWidth / width : Infinity,\r\n        options.maxHeight ? options.maxHeight / height : Infinity\r\n      );\r\n\r\n      if (scale > 0 && scale < 1) {\r\n        targetWidth = Math.max(1, Math.round(width * scale));\r\n        targetHeight = Math.max(1, Math.round(height * scale));\r\n      }\r\n    }\r\n\r\n    return { targetWidth, targetHeight };\r\n  }\r\n\r\n  // Optimized nearest-neighbor resize\r\n  protected static resizeNN(\r\n    src: Uint8Array,\r\n    sw: number,\r\n    sh: number,\r\n    tw: number,\r\n    th: number,\r\n    channels: number,\r\n  ): Uint8Array {\r\n    if (sw === tw && sh === th) return src;\r\n\r\n    const dst = new Uint8Array(tw * th * channels);\r\n    const xRatio = sw / tw;\r\n    const yRatio = sh / th;\r\n\r\n    for (let y = 0; y < th; y++) {\r\n      const sy = Math.min(sh - 1, Math.floor(y * yRatio));\r\n      const srcRowOffset = sy * sw * channels;\r\n      const dstRowOffset = y * tw * channels;\r\n\r\n      for (let x = 0; x < tw; x++) {\r\n        const sx = Math.min(sw - 1, Math.floor(x * xRatio));\r\n        const si = srcRowOffset + sx * channels;\r\n        const di = dstRowOffset + x * channels;\r\n\r\n        for (let c = 0; c < channels; c++) {\r\n          dst[di + c] = src[si + c];\r\n        }\r\n      }\r\n    }\r\n    return dst;\r\n  }\r\n\r\n  public abstract decode(buffer: ArrayBuffer, options?: DecodeOptions): Promise<ImageInfo>;\r\n}\r\n", "import type { ImageInfo } from \"./types.js\";\nimport { BaseDecoder, type DecodeOptions } from \"./base-decoder.js\";\n\n/**\n * Minimal JPEG parser that extracts metadata and returns the original bytes.\n * The implementation does not perform full decoding; instead it surfaces the\n * intrinsic dimensions found in the SOF0 marker so the layout engine can size\n * the image correctly while keeping the compressed payload for embedding.\n */\nexport class JpegDecoder extends BaseDecoder {\n  private static readonly SOI_MARKER = 0xffd8;\n  private static readonly EOI_MARKER = 0xffd9;\n  private static readonly SOF0_MARKER = 0xffc0;\n\n  public async decode(\n    buffer: ArrayBuffer,\n    options: DecodeOptions = {},\n  ): Promise<ImageInfo> {\n    const view = new DataView(buffer);\n\n    if (view.getUint16(0, false) !== JpegDecoder.SOI_MARKER) {\n      throw new Error(\"Invalid JPEG: missing SOI marker\");\n    }\n\n    let offset = 2;\n    let width = 0;\n    let height = 0;\n    let channels = 3;\n    let precision = 8;\n\n    while (offset + 4 < buffer.byteLength) {\n      const marker = view.getUint16(offset, false);\n      offset += 2;\n\n      if (marker === JpegDecoder.EOI_MARKER) {\n        break;\n      }\n\n      const length = view.getUint16(offset, false);\n\n      if (marker === JpegDecoder.SOF0_MARKER) {\n        precision = view.getUint8(offset + 2);\n        height = view.getUint16(offset + 3, false);\n        width = view.getUint16(offset + 5, false);\n        channels = view.getUint8(offset + 7);\n        break;\n      }\n\n      offset += length;\n    }\n\n    if (width === 0 || height === 0) {\n      throw new Error(\"Invalid JPEG: missing SOF0 marker\");\n    }\n\n    const { targetWidth, targetHeight } = JpegDecoder.calculateDimensions(\n      width,\n      height,\n      options\n    );\n\n    const dataCopy = buffer.slice(0);\n\n    return {\n      width: targetWidth,\n      height: targetHeight,\n      format: \"jpeg\",\n      channels,\n      bitsPerChannel: precision,\n      data: dataCopy,\n    };\n  }\n}\n", "import type { ImageInfo } from \"./types.js\";\nimport { BaseDecoder, type DecodeOptions } from \"./base-decoder.js\";\n\nexport interface PngDecompressionStrategy {\n  inflateRaw(data: Uint8Array): Promise<Uint8Array>;\n  inflateZlib(data: Uint8Array): Promise<Uint8Array>;\n}\n\r\ntype FilterType = 0 | 1 | 2 | 3 | 4;\r\ntype ColorType = 0 | 2 | 3 | 4 | 6;\r\ntype BitDepth = 1 | 2 | 4 | 8 | 16;\r\n\r\ninterface PngMetadata {\r\n  width: number;\r\n  height: number;\r\n  bitDepth: BitDepth;\r\n  colorType: ColorType;\r\n  interlaceMethod: number;\r\n  palette: Uint8Array | null;\r\n  transparency: Uint8Array | null;\r\n}\r\n\r\nasync function defaultInflateRaw(data: Uint8Array): Promise<Uint8Array> {\n  if (typeof DecompressionStream !== \"undefined\") {\n    const ds = new DecompressionStream('deflate-raw');\n    const stream = new Blob([data as any]).stream().pipeThrough(ds);\n    const out = await new Response(stream).arrayBuffer();\n    return new Uint8Array(out);\n  } else {\r\n    const { inflateRawSync } = await import('node:zlib');\r\n    return inflateRawSync(data);\r\n  }\r\n}\r\n\r\nasync function defaultInflateZlib(data: Uint8Array): Promise<Uint8Array> {\n  if (typeof DecompressionStream !== \"undefined\") {\n    const ds = new DecompressionStream('deflate');\n    const stream = new Blob([data as any]).stream().pipeThrough(ds);\n    const out = await new Response(stream).arrayBuffer();\n    return new Uint8Array(out);\n  } else {\r\n    const { inflateSync } = await import('node:zlib');\r\n    return inflateSync(data);\r\n  }\r\n}\r\n\r\n// Extract sample from packed bits\r\nfunction extractSample(bytes: Uint8Array, index: number, bitDepth: 1 | 2 | 4): number {\r\n  const samplesPerByte = 8 / bitDepth;\r\n  const byteIndex = Math.floor(index / samplesPerByte);\r\n  const sampleOffset = index % samplesPerByte;\r\n  const shift = 8 - bitDepth * (sampleOffset + 1);\r\n  const mask = (1 << bitDepth) - 1;\r\n  return (bytes[byteIndex] >> shift) & mask;\r\n}\r\n\r\n// Scale value from arbitrary bit depth to 8-bit\r\nfunction scaleTo8bit(value: number, bitDepth: number): number {\r\n  const maxValue = (1 << bitDepth) - 1;\r\n  return Math.round((value / maxValue) * 255);\r\n}\r\n\r\n// Paeth predictor for filter type 4\r\nfunction paethPredictor(a: number, b: number, c: number): number {\r\n  const p = a + b - c;\r\n  const pa = Math.abs(p - a);\r\n  const pb = Math.abs(p - b);\r\n  const pc = Math.abs(p - c);\r\n  return (pa <= pb && pa <= pc) ? a : (pb <= pc ? b : c);\r\n}\r\n\r\n/**\n * PNG decoder with improved error handling and performance\n */\nexport class PngDecoder extends BaseDecoder {\n  private static readonly PNG_SIGNATURE = [0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a];\n  private readonly decompression: PngDecompressionStrategy;\n\n  constructor(decompression: Partial<PngDecompressionStrategy> = {}) {\n    super();\n    this.decompression = {\n      inflateRaw: decompression.inflateRaw ?? defaultInflateRaw,\n      inflateZlib: decompression.inflateZlib ?? defaultInflateZlib,\n    };\n  }\n\r\n  public async decode(\r\n    buffer: ArrayBuffer,\r\n    options: DecodeOptions = {},\r\n  ): Promise<ImageInfo> {\r\n    const view = new DataView(buffer);\r\n\r\n    // Validate PNG signature\r\n    PngDecoder.validateSignature(view);\r\n\r\n    // Parse chunks\r\n    const { metadata, idatChunks } = PngDecoder.parseChunks(buffer, view);\n\n    // Validate metadata\n    PngDecoder.validateMetadata(metadata);\n\n    // Decompress image data\n    const decompressed = await this.decompressImageData(idatChunks);\n\r\n    // Decode scanlines\r\n    const pixelData = PngDecoder.decodeScanlines(decompressed, metadata);\r\n\r\n    // Calculate target dimensions\r\n    const { targetWidth, targetHeight } = PngDecoder.calculateDimensions(\r\n      metadata.width,\r\n      metadata.height,\r\n      options\r\n    );\r\n\r\n    // Resize if needed\r\n    const finalData = PngDecoder.resizeNN(\r\n      pixelData,\r\n      metadata.width,\r\n      metadata.height,\r\n      targetWidth,\r\n      targetHeight,\r\n      4\r\n    );\r\n\r\n    return {\r\n      width: targetWidth,\r\n      height: targetHeight,\r\n      format: \"png\",\r\n      channels: 4,\r\n      bitsPerChannel: 8,\r\n      data: finalData.buffer as ArrayBuffer,\r\n    };\r\n  }\r\n\r\n  // --- Private Methods ---\r\n\r\n  private static validateSignature(view: DataView): void {\r\n    for (let i = 0; i < PngDecoder.PNG_SIGNATURE.length; i++) {\r\n      if (view.getUint8(i) !== PngDecoder.PNG_SIGNATURE[i]) {\r\n        throw new Error(\"Invalid PNG signature\");\r\n      }\r\n    }\r\n  }\r\n\r\n  private static parseChunks(buffer: ArrayBuffer, view: DataView) {\r\n    let offset = 8;\r\n    const idatChunks: Uint8Array[] = [];\r\n    const metadata: Partial<PngMetadata> = {\r\n      palette: null,\r\n      transparency: null,\r\n    };\r\n\r\n    let sawIDAT = false;\r\n    let sawIEND = false;\r\n\r\n    while (offset < buffer.byteLength) {\r\n      if (offset + 8 > buffer.byteLength) {\r\n        throw new Error(\"Incomplete chunk header\");\r\n      }\r\n\r\n      const length = view.getUint32(offset, false);\r\n      const type = String.fromCharCode(\r\n        view.getUint8(offset + 4),\r\n        view.getUint8(offset + 5),\r\n        view.getUint8(offset + 6),\r\n        view.getUint8(offset + 7)\r\n      );\r\n\r\n      const dataOffset = offset + 8;\r\n\r\n      if (offset + 12 + length > buffer.byteLength) {\r\n        throw new Error(`Chunk ${type} extends beyond file boundary`);\r\n      }\r\n\r\n      switch (type) {\r\n        case 'IHDR':\r\n          PngDecoder.parseIHDR(view, dataOffset, metadata);\r\n          break;\r\n        case 'PLTE':\r\n          if (sawIDAT) throw new Error(\"PLTE chunk must appear before IDAT\");\r\n          PngDecoder.parsePLTE(buffer, dataOffset, length, metadata);\r\n          break;\r\n        case 'tRNS':\r\n          if (sawIDAT) throw new Error(\"tRNS chunk must appear before IDAT\");\r\n          PngDecoder.parseTRNS(buffer, dataOffset, length, metadata);\r\n          break;\r\n        case 'IDAT':\r\n          sawIDAT = true;\r\n          idatChunks.push(new Uint8Array(buffer, dataOffset, length));\r\n          break;\r\n        case 'IEND':\r\n          sawIEND = true;\r\n          offset += 12 + length;\r\n          break;\r\n        default:\r\n          // Skip unknown chunks\r\n          break;\r\n      }\r\n\r\n      if (sawIEND) break;\r\n      offset += 12 + length;\r\n    }\r\n\r\n    if (!sawIEND) throw new Error(\"Missing IEND chunk\");\r\n    if (!sawIDAT) throw new Error(\"Missing IDAT chunk\");\r\n\r\n    return { metadata: metadata as PngMetadata, idatChunks };\r\n  }\r\n\r\n  private static parseIHDR(view: DataView, offset: number, metadata: Partial<PngMetadata>): void {\r\n    metadata.width = view.getUint32(offset, false);\r\n    metadata.height = view.getUint32(offset + 4, false);\r\n    metadata.bitDepth = view.getUint8(offset + 8) as BitDepth;\r\n    metadata.colorType = view.getUint8(offset + 9) as ColorType;\r\n\r\n    const compressionMethod = view.getUint8(offset + 10);\r\n    const filterMethod = view.getUint8(offset + 11);\r\n    metadata.interlaceMethod = view.getUint8(offset + 12);\r\n\r\n    if (compressionMethod !== 0) throw new Error(\"Unsupported compression method\");\r\n    if (filterMethod !== 0) throw new Error(\"Unsupported filter method\");\r\n  }\r\n\r\n  private static parsePLTE(\r\n    buffer: ArrayBuffer,\r\n    offset: number,\r\n    length: number,\r\n    metadata: Partial<PngMetadata>\r\n  ): void {\r\n    if (length % 3 !== 0) throw new Error(\"Invalid PLTE chunk length\");\r\n    if (length / 3 > 256) throw new Error(\"PLTE has too many entries\");\r\n    metadata.palette = new Uint8Array(buffer, offset, length);\r\n  }\r\n\r\n  private static parseTRNS(\r\n    buffer: ArrayBuffer,\r\n    offset: number,\r\n    length: number,\r\n    metadata: Partial<PngMetadata>\r\n  ): void {\r\n    metadata.transparency = new Uint8Array(buffer, offset, length);\r\n  }\r\n\r\n  private static validateMetadata(metadata: PngMetadata): void {\r\n    if (!metadata.width || !metadata.height) {\r\n      throw new Error(\"Missing or invalid IHDR chunk\");\r\n    }\r\n    if (metadata.colorType === 3 && !metadata.palette) {\r\n      throw new Error(\"Indexed color PNG missing PLTE chunk\");\r\n    }\r\n    if (metadata.interlaceMethod !== 0) {\r\n      throw new Error(\"Interlaced PNGs are not supported\");\r\n    }\r\n\r\n    // Validate bit depth for color type\r\n    const validBitDepths: Record<ColorType, BitDepth[]> = {\r\n      0: [1, 2, 4, 8, 16],\r\n      2: [8, 16],\r\n      3: [1, 2, 4, 8],\r\n      4: [8, 16],\r\n      6: [8, 16],\r\n    };\r\n\r\n    if (!validBitDepths[metadata.colorType]?.includes(metadata.bitDepth)) {\r\n      throw new Error(\r\n        `Invalid bit depth ${metadata.bitDepth} for color type ${metadata.colorType}`\r\n      );\r\n    }\r\n  }\r\n\r\n  private async decompressImageData(chunks: Uint8Array[]): Promise<Uint8Array> {\n    // Concatenate all IDAT chunks\n    const totalLength = chunks.reduce((sum, chunk) => sum + chunk.length, 0);\n    const compressed = new Uint8Array(totalLength);\n\r\n    let offset = 0;\r\n    for (const chunk of chunks) {\r\n      compressed.set(chunk, offset);\r\n      offset += chunk.length;\r\n    }\r\n\r\n    // Detect compression format and decompress\r\n    const isZlib = (compressed[0] & 0x0F) === 0x08;\r\n\r\n    try {\r\n      return isZlib\n        ? await this.decompression.inflateZlib(compressed)\n        : await this.decompression.inflateRaw(compressed.slice(2, -4));\n    } catch (error) {\n      throw new Error(`Decompression failed: ${error}`);\n    }\n  }\n\r\n  private static decodeScanlines(\r\n    decompressed: Uint8Array,\r\n    metadata: PngMetadata\r\n  ): Uint8Array {\r\n    const { width, height, bitDepth, colorType } = metadata;\r\n\r\n    const channels = PngDecoder.getChannelCount(colorType);\r\n    const bitsPerPixel = bitDepth * channels;\r\n    const bytesPerRow = Math.ceil((bitsPerPixel * width) / 8);\r\n    const bytesPerPixel = Math.max(1, Math.ceil(bitsPerPixel / 8));\r\n\r\n    const pixelData = new Uint8Array(width * height * 4);\r\n    let prevRow: Uint8Array = new Uint8Array(bytesPerRow);\r\n    let offset = 0;\r\n\r\n    for (let y = 0; y < height; y++) {\r\n      // Read filter type\r\n      const filterType = decompressed[offset++] as FilterType;\r\n\r\n      // Read scanline\r\n      const scanline = decompressed.subarray(offset, offset + bytesPerRow);\r\n      offset += bytesPerRow;\r\n\r\n      // Reconstruct filtered row\r\n      const currentRow = PngDecoder.reconstructRow(\r\n        scanline,\r\n        prevRow,\r\n        filterType,\r\n        bytesPerPixel\r\n      );\r\n\r\n      // Convert to RGBA\r\n      PngDecoder.convertRowToRGBA(\r\n        currentRow,\r\n        pixelData,\r\n        y,\r\n        width,\r\n        metadata\r\n      );\r\n\r\n      prevRow = currentRow;\r\n    }\r\n\r\n    return pixelData;\r\n  }\r\n\r\n  private static getChannelCount(colorType: ColorType): number {\r\n    const channelMap: Record<ColorType, number> = {\r\n      0: 1, // Grayscale\r\n      2: 3, // RGB\r\n      3: 1, // Indexed\r\n      4: 2, // Grayscale + Alpha\r\n      6: 4, // RGBA\r\n    };\r\n    return channelMap[colorType];\r\n  }\r\n\r\n  private static reconstructRow(\r\n    scanline: Uint8Array,\r\n    prevRow: Uint8Array,\r\n    filterType: FilterType,\r\n    bpp: number\r\n  ): Uint8Array {\r\n    const row = new Uint8Array(scanline.length);\r\n\r\n    for (let i = 0; i < scanline.length; i++) {\r\n      const left = i >= bpp ? row[i - bpp] : 0;\r\n      const up = prevRow[i];\r\n      const upLeft = i >= bpp ? prevRow[i - bpp] : 0;\r\n\r\n      let value: number;\r\n      switch (filterType) {\r\n        case 0: // None\r\n          value = scanline[i];\r\n          break;\r\n        case 1: // Sub\r\n          value = scanline[i] + left;\r\n          break;\r\n        case 2: // Up\r\n          value = scanline[i] + up;\r\n          break;\r\n        case 3: // Average\r\n          value = scanline[i] + ((left + up) >>> 1);\r\n          break;\r\n        case 4: // Paeth\r\n          value = scanline[i] + paethPredictor(left, up, upLeft);\r\n          break;\r\n        default:\r\n          throw new Error(`Invalid filter type: ${filterType}`);\r\n      }\r\n\r\n      row[i] = value & 0xFF;\r\n    }\r\n\r\n    return row;\r\n  }\r\n\r\n  private static convertRowToRGBA(\r\n    row: Uint8Array,\r\n    pixelData: Uint8Array,\r\n    y: number,\r\n    width: number,\r\n    metadata: PngMetadata\r\n  ): void {\r\n    const { colorType, bitDepth, palette, transparency } = metadata;\r\n\r\n    switch (colorType) {\r\n      case 0: // Grayscale\r\n        PngDecoder.convertGrayscale(row, pixelData, y, width, bitDepth, transparency);\r\n        break;\r\n      case 2: // RGB\r\n        PngDecoder.convertRGB(row, pixelData, y, width, bitDepth, transparency);\r\n        break;\r\n      case 3: // Indexed\r\n        PngDecoder.convertIndexed(row, pixelData, y, width, bitDepth, palette!, transparency);\r\n        break;\r\n      case 4: // Grayscale + Alpha\r\n        PngDecoder.convertGrayscaleAlpha(row, pixelData, y, width, bitDepth);\r\n        break;\r\n      case 6: // RGBA\r\n        PngDecoder.convertRGBA(row, pixelData, y, width, bitDepth);\r\n        break;\r\n    }\r\n  }\r\n\r\n  private static convertGrayscale(\r\n    row: Uint8Array,\r\n    pixelData: Uint8Array,\r\n    y: number,\r\n    width: number,\r\n    bitDepth: BitDepth,\r\n    transparency: Uint8Array | null\r\n  ): void {\r\n    for (let x = 0; x < width; x++) {\r\n      let gray: number;\r\n\r\n      if (bitDepth === 8) {\r\n        gray = row[x];\r\n      } else if (bitDepth === 16) {\r\n        gray = row[x * 2]; // Use high byte\r\n      } else {\r\n        const sample = extractSample(row, x, bitDepth as 1 | 2 | 4);\r\n        gray = scaleTo8bit(sample, bitDepth);\r\n      }\r\n\r\n      const offset = (y * width + x) * 4;\r\n      pixelData[offset] = gray;\r\n      pixelData[offset + 1] = gray;\r\n      pixelData[offset + 2] = gray;\r\n      pixelData[offset + 3] = (transparency && gray === transparency[1]) ? 0 : 255;\r\n    }\r\n  }\r\n\r\n  private static convertRGB(\r\n    row: Uint8Array,\r\n    pixelData: Uint8Array,\r\n    y: number,\r\n    width: number,\r\n    bitDepth: BitDepth,\r\n    transparency: Uint8Array | null\r\n  ): void {\r\n    const bytesPerPixel = bitDepth === 16 ? 6 : 3;\r\n    const step = bitDepth === 16 ? 2 : 1;\r\n\r\n    for (let x = 0; x < width; x++) {\r\n      const srcOffset = x * bytesPerPixel;\r\n      const dstOffset = (y * width + x) * 4;\r\n\r\n      const r = row[srcOffset];\r\n      const g = row[srcOffset + step];\r\n      const b = row[srcOffset + step * 2];\r\n\r\n      pixelData[dstOffset] = r;\r\n      pixelData[dstOffset + 1] = g;\r\n      pixelData[dstOffset + 2] = b;\r\n\r\n      // Check transparency\r\n      const isTransparent = transparency &&\r\n        r === transparency[1] &&\r\n        g === transparency[3] &&\r\n        b === transparency[5];\r\n\r\n      pixelData[dstOffset + 3] = isTransparent ? 0 : 255;\r\n    }\r\n  }\r\n\r\n  private static convertIndexed(\r\n    row: Uint8Array,\r\n    pixelData: Uint8Array,\r\n    y: number,\r\n    width: number,\r\n    bitDepth: BitDepth,\r\n    palette: Uint8Array,\r\n    transparency: Uint8Array | null\r\n  ): void {\r\n    for (let x = 0; x < width; x++) {\r\n      const index = bitDepth === 8\r\n        ? row[x]\r\n        : extractSample(row, x, bitDepth as 1 | 2 | 4);\r\n\r\n      const paletteOffset = index * 3;\r\n      const pixelOffset = (y * width + x) * 4;\r\n\r\n      pixelData[pixelOffset] = palette[paletteOffset];\r\n      pixelData[pixelOffset + 1] = palette[paletteOffset + 1];\r\n      pixelData[pixelOffset + 2] = palette[paletteOffset + 2];\r\n      pixelData[pixelOffset + 3] =\r\n        (transparency && index < transparency.length) ? transparency[index] : 255;\r\n    }\r\n  }\r\n\r\n  private static convertGrayscaleAlpha(\r\n    row: Uint8Array,\r\n    pixelData: Uint8Array,\r\n    y: number,\r\n    width: number,\r\n    bitDepth: BitDepth\r\n  ): void {\r\n    const bytesPerPixel = bitDepth === 16 ? 4 : 2;\r\n    const step = bitDepth === 16 ? 2 : 1;\r\n\r\n    for (let x = 0; x < width; x++) {\r\n      const srcOffset = x * bytesPerPixel;\r\n      const dstOffset = (y * width + x) * 4;\r\n\r\n      const gray = row[srcOffset];\r\n      const alpha = row[srcOffset + step];\r\n\r\n      pixelData[dstOffset] = gray;\r\n      pixelData[dstOffset + 1] = gray;\r\n      pixelData[dstOffset + 2] = gray;\r\n      pixelData[dstOffset + 3] = alpha;\r\n    }\r\n  }\r\n\r\n  private static convertRGBA(\r\n    row: Uint8Array,\r\n    pixelData: Uint8Array,\r\n    y: number,\r\n    width: number,\r\n    bitDepth: BitDepth\r\n  ): void {\r\n    const bytesPerPixel = bitDepth === 16 ? 8 : 4;\r\n    const step = bitDepth === 16 ? 2 : 1;\r\n\r\n    for (let x = 0; x < width; x++) {\r\n      const srcOffset = x * bytesPerPixel;\r\n      const dstOffset = (y * width + x) * 4;\r\n\r\n      pixelData[dstOffset] = row[srcOffset];\r\n      pixelData[dstOffset + 1] = row[srcOffset + step];\r\n      pixelData[dstOffset + 2] = row[srcOffset + step * 2];\r\n      pixelData[dstOffset + 3] = row[srcOffset + step * 3];\r\n    }\r\n  }\r\n\r\n}\r\n", "import { DataReader } from \"./webp-decoder.js\";\r\n\r\n/**\r\n * Represents a single RIFF chunk\r\n */\r\nexport interface RiffChunk {\r\n    fourCC: string;\r\n    size: number;\r\n    data: DataView;\r\n}\r\n\r\n/**\r\n * Parser for WebP RIFF container structure\r\n * Responsibility: Parse and validate RIFF chunks\r\n */\r\nexport class WebpRiffParser {\r\n    /**\r\n     * Validate RIFF header signature\r\n     */\r\n    validateHeader(reader: DataReader): void {\r\n        const riff = reader.getString(4);\r\n        if (riff !== 'RIFF') {\r\n            throw new Error(\"Invalid WebP: Missing RIFF header\");\r\n        }\r\n\r\n        reader.getUint32(true); // File size (unused)\r\n\r\n        const webp = reader.getString(4);\r\n        if (webp !== 'WEBP') {\r\n            throw new Error(\"Invalid WebP: Missing WEBP signature\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Parse all chunks from the RIFF container\r\n     */\r\n    parseChunks(reader: DataReader): RiffChunk[] {\r\n        const chunks: RiffChunk[] = [];\r\n\r\n        while (reader.hasMore()) {\r\n            const fourCC = reader.getString(4);\r\n            const size = reader.getUint32(true);\r\n            const data = reader.getView(size);\r\n            chunks.push({ fourCC, size, data });\r\n\r\n            // Skip padding byte if chunk size is odd\r\n            if (size % 2 === 1 && reader.hasMore()) {\r\n                reader.seek(reader.tell() + 1);\r\n            }\r\n        }\r\n\r\n        return chunks;\r\n    }\r\n}\r\n", "import { BitReader } from \"./webp-decoder.js\";\r\n\r\n/**\r\n * Huffman code representation\r\n */\r\nexport interface HuffmanCode {\r\n    symbol: number;\r\n    length: number;\r\n    code: number;\r\n}\r\n\r\n/**\r\n * Huffman tree with optional lookup table for performance\r\n */\r\nexport interface HuffmanTree {\r\n    codes: HuffmanCode[];\r\n    maxLength: number;\r\n    lookupTable?: Map<number, number>;\r\n}\r\n\r\nconst CODE_LENGTH_ORDER = [17, 18, 0, 1, 2, 3, 4, 5, 16, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15] as const;\r\nconst HUFFMAN_GROUPS = 5;\r\n\r\n/**\r\n * Huffman code decoder for WebP VP8L format\r\n * Responsibility: Build and decode Huffman trees\r\n */\r\nexport class WebpHuffmanDecoder {\r\n    /**\r\n     * Read all Huffman code groups (5 groups for VP8L)\r\n     */\r\n    readHuffmanCodes(br: BitReader): HuffmanTree[] {\r\n        const huffmanCodes: HuffmanTree[] = [];\r\n\r\n        for (let i = 0; i < HUFFMAN_GROUPS; i++) {\r\n            const alphabetSize = i === 4 ? 40 : 280; // 256 + 24 = 280\r\n            huffmanCodes[i] = this.readHuffmanCode(br, alphabetSize);\r\n        }\r\n\r\n        return huffmanCodes;\r\n    }\r\n\r\n    /**\r\n     * Read a single Huffman code\r\n     */\r\n    private readHuffmanCode(br: BitReader, alphabetSize: number): HuffmanTree {\r\n        const simple = br.readBits(1);\r\n\r\n        if (simple) {\r\n            return this.readSimpleHuffmanCode(br);\r\n        }\r\n\r\n        // Read code length codes\r\n        const codeLengthCodeLengths = new Array(19).fill(0);\r\n        const numCodeLengthCodes = 4 + br.readBits(4);\r\n\r\n        for (let i = 0; i < numCodeLengthCodes; i++) {\r\n            codeLengthCodeLengths[CODE_LENGTH_ORDER[i]] = br.readBits(3);\r\n        }\r\n\r\n        const codeLengthTree = this.buildHuffmanTree(codeLengthCodeLengths);\r\n        const codeLengths = this.readCodeLengths(br, codeLengthTree, alphabetSize);\r\n\r\n        return this.buildHuffmanTree(codeLengths);\r\n    }\r\n\r\n    /**\r\n     * Read simple Huffman code (1 or 2 symbols)\r\n     */\r\n    private readSimpleHuffmanCode(br: BitReader): HuffmanTree {\r\n        const numSymbols = br.readBits(1) + 1;\r\n        const symbols: number[] = [];\r\n\r\n        const is8Bits = br.readBits(1);\r\n        const bitCount = is8Bits ? 8 : 1;\r\n\r\n        symbols.push(br.readBits(bitCount));\r\n        if (numSymbols === 2) {\r\n            symbols.push(br.readBits(bitCount));\r\n        }\r\n\r\n        return this.buildSimpleHuffman(symbols);\r\n    }\r\n\r\n    /**\r\n     * Read code lengths for symbols\r\n     */\r\n    private readCodeLengths(br: BitReader, codeLengthTree: HuffmanTree, alphabetSize: number): number[] {\r\n        const codeLengths = new Array(alphabetSize).fill(0);\r\n        let i = 0;\r\n\r\n        while (i < alphabetSize) {\r\n            const code = this.readSymbol(br, codeLengthTree);\r\n\r\n            if (code < 16) {\r\n                codeLengths[i++] = code;\r\n            } else {\r\n                let repeatCount = 0;\r\n                let repeatValue = 0;\r\n\r\n                if (code === 16) {\r\n                    repeatCount = 3 + br.readBits(2);\r\n                    repeatValue = codeLengths[i - 1];\r\n                } else if (code === 17) {\r\n                    repeatCount = 3 + br.readBits(3);\r\n                } else if (code === 18) {\r\n                    repeatCount = 11 + br.readBits(7);\r\n                }\r\n\r\n                for (let j = 0; j < repeatCount && i < alphabetSize; j++) {\r\n                    codeLengths[i++] = repeatValue;\r\n                }\r\n            }\r\n        }\r\n\r\n        return codeLengths;\r\n    }\r\n\r\n    /**\r\n     * Build simple Huffman tree from 1-2 symbols\r\n     */\r\n    private buildSimpleHuffman(symbols: number[]): HuffmanTree {\r\n        if (symbols.length === 1) {\r\n            return { codes: [{ symbol: symbols[0], length: 0, code: 0 }], maxLength: 0 };\r\n        }\r\n\r\n        return {\r\n            codes: [\r\n                { symbol: symbols[0], length: 1, code: 0 },\r\n                { symbol: symbols[1], length: 1, code: 1 }\r\n            ],\r\n            maxLength: 1\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Build Huffman tree from code lengths using canonical Huffman code algorithm\r\n     */\r\n    buildHuffmanTree(codeLengths: number[]): HuffmanTree {\r\n        // Filter out invalid values and find the max length\r\n        const validLengths = codeLengths.filter(len => len > 0 && Number.isFinite(len));\r\n        const maxLength = validLengths.length > 0 ? Math.max(...validLengths) : 0;\r\n        const codes: HuffmanCode[] = [];\r\n\r\n        if (maxLength === 0) {\r\n            return { codes: [], maxLength: 0, lookupTable: new Map() };\r\n        }\r\n\r\n        const bl_count = new Array(maxLength + 1).fill(0);\r\n        const next_code = new Array(maxLength + 1).fill(0);\r\n\r\n        // Count codes per length\r\n        for (const len of codeLengths) {\r\n            if (len > 0 && Number.isFinite(len)) bl_count[len]++;\r\n        }\r\n\r\n        // Calculate starting codes for each length\r\n        next_code[1] = 0;\r\n        for (let bits = 2; bits <= maxLength; bits++) {\r\n            next_code[bits] = (next_code[bits - 1] + bl_count[bits - 1]) << 1;\r\n        }\r\n\r\n        // Assign codes to symbols\r\n        const lookupTable = new Map<number, number>();\r\n        for (let n = 0; n < codeLengths.length; n++) {\r\n            const len = codeLengths[n];\r\n            if (len > 0 && Number.isFinite(len)) {\r\n                const codeValue = next_code[len];\r\n                codes.push({ symbol: n, length: len, code: codeValue });\r\n                // Create lookup key using a bit shift approach\r\n                // Store as (code << 4) | length for fast lookup\r\n                const key = (codeValue << 4) | len;\r\n                lookupTable.set(key, n);\r\n                next_code[len]++;\r\n            }\r\n        }\r\n\r\n        return { codes, maxLength, lookupTable };\r\n    }\r\n\r\n    /**\r\n     * Read a symbol from the bitstream using the Huffman tree\r\n     */\r\n    readSymbol(br: BitReader, tree: HuffmanTree): number {\r\n        if (tree.maxLength === 0) {\r\n            return tree.codes[0].symbol;\r\n        }\r\n\r\n        // Use lookup table for O(1) access\r\n        if (tree.lookupTable) {\r\n            let code = 0;\r\n            for (let i = 0; i < tree.maxLength; i++) {\r\n                code = (code << 1) | br.readBits(1);\r\n                // Check if this code with the current length exists\r\n                const key = (code << 4) | (i + 1);\r\n                const symbol = tree.lookupTable.get(key);\r\n                if (symbol !== undefined) {\r\n                    return symbol;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Fallback to linear search through codes\r\n        for (const codeInfo of tree.codes) {\r\n            let code = 0;\r\n            for (let i = 0; i < codeInfo.length; i++) {\r\n                code = (code << 1) | br.readBits(1);\r\n            }\r\n            if (code === codeInfo.code) {\r\n                return codeInfo.symbol;\r\n            }\r\n        }\r\n\r\n        // If no symbol is found, return 0 as fallback\r\n        // This prevents the decoder from failing completely\r\n        return 0;\r\n    }\r\n}\r\n", "import { BitReader, type DecodeOptions } from \"./webp-decoder.js\";\r\nimport type { ImageInfo } from \"./types.js\";\r\nimport { WebpHuffmanDecoder, type HuffmanTree } from \"./webp-huffman.js\";\r\nimport type { RiffChunk } from \"./webp-riff-parser.js\";\r\n\r\nconst VP8L_SIGNATURE = 0x2f;\r\n\r\n/**\r\n * VP8L (lossless WebP) decoder\r\n * Responsibility: Decode VP8L image data\r\n */\r\nexport class Vp8lDecoder {\r\n    private huffmanDecoder = new WebpHuffmanDecoder();\r\n\r\n    /**\r\n     * Decode a VP8L chunk into image data\r\n     */\r\n    decodeVp8l(chunk: RiffChunk, options: DecodeOptions, calculateDimensions: (w: number, h: number, opts: DecodeOptions) => { targetWidth: number; targetHeight: number }, resizeNN: (src: Uint8Array, sw: number, sh: number, tw: number, th: number, channels: number) => Uint8Array): ImageInfo {\r\n        const br = new BitReader(chunk.data);\r\n\r\n        // Read signature\r\n        const signature = br.readBits(8);\r\n        if (signature !== VP8L_SIGNATURE) {\r\n            throw new Error(\"Invalid VP8L signature\");\r\n        }\r\n\r\n        // Read dimensions\r\n        const width = br.readBits(14) + 1;\r\n        const height = br.readBits(14) + 1;\r\n        const version = br.readBits(3);\r\n\r\n        if (version !== 0) {\r\n            throw new Error(`Unsupported VP8L version: ${version}`);\r\n        }\r\n\r\n        // Skip transforms for now (they're complex)\r\n        let transformsPresent = br.readBits(1);\r\n        while (transformsPresent) {\r\n            const transformType = br.readBits(2);\r\n\r\n            if (transformType === 0 || transformType === 1) { // Predictor/Color Transform\r\n                const sizeBits = br.readBits(3) + 2;\r\n                const blockWidth = this.subSampleSize(width, sizeBits);\r\n                const blockHeight = this.subSampleSize(height, sizeBits);\r\n                this.skipTransformImage(br, blockWidth, blockHeight);\r\n            } else if (transformType === 3) { // Color Indexing\r\n                // Skip palette reading for simplicity\r\n            }\r\n\r\n            transformsPresent = br.readBits(1);\r\n        }\r\n\r\n        // Read Huffman codes and decode pixel data\r\n        const huffmanCodes = this.huffmanDecoder.readHuffmanCodes(br);\r\n        const pixels = this.decodePixelData(br, width, height, huffmanCodes);\r\n\r\n        // Calculate target dimensions and resize if needed\r\n        const { targetWidth, targetHeight } = calculateDimensions(width, height, options);\r\n        const finalPixels = resizeNN(pixels, width, height, targetWidth, targetHeight, 4);\r\n\r\n        return {\r\n            width: targetWidth,\r\n            height: targetHeight,\r\n            format: \"webp\",\r\n            channels: 4,\r\n            bitsPerChannel: 8,\r\n            data: finalPixels.buffer as ArrayBuffer,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Decode pixel data from VP8L bitstream\r\n     */\r\n    private decodePixelData(\r\n        br: BitReader,\r\n        width: number,\r\n        height: number,\r\n        huffmanCodes: HuffmanTree[]\r\n    ): Uint8Array {\r\n        const pixels = new Uint8Array(width * height * 4);\r\n        let pixelIndex = 0;\r\n        const totalPixels = width * height;\r\n\r\n        for (let i = 0; i < totalPixels; i++) {\r\n            const green = this.huffmanDecoder.readSymbol(br, huffmanCodes[0]);\r\n\r\n            if (green < 256) {\r\n                // Literal pixel\r\n                const red = this.huffmanDecoder.readSymbol(br, huffmanCodes[1]);\r\n                const blue = this.huffmanDecoder.readSymbol(br, huffmanCodes[2]);\r\n                const alpha = this.huffmanDecoder.readSymbol(br, huffmanCodes[3]);\r\n\r\n                pixels[pixelIndex++] = red;\r\n                pixels[pixelIndex++] = green;\r\n                pixels[pixelIndex++] = blue;\r\n                pixels[pixelIndex++] = alpha;\r\n            } else {\r\n                // Backward reference (LZ77)\r\n                const lengthSymbol = green - 256;\r\n                const length = this.getLengthFromSymbol(lengthSymbol, br);\r\n                const distSymbol = this.huffmanDecoder.readSymbol(br, huffmanCodes[4]);\r\n                const distance = this.getDistanceFromSymbol(distSymbol, br);\r\n\r\n                // Copy pixels from earlier in the stream\r\n                for (let j = 0; j < length && i + j < totalPixels; j++) {\r\n                    const srcIdx = pixelIndex - distance * 4;\r\n                    if (srcIdx >= 0) {\r\n                        pixels[pixelIndex++] = pixels[srcIdx];\r\n                        pixels[pixelIndex++] = pixels[srcIdx + 1];\r\n                        pixels[pixelIndex++] = pixels[srcIdx + 2];\r\n                        pixels[pixelIndex++] = pixels[srcIdx + 3];\r\n                    }\r\n                }\r\n                i += length - 1;\r\n            }\r\n        }\r\n\r\n        return pixels;\r\n    }\r\n\r\n    /**\r\n     * Calculate subsampled size\r\n     */\r\n    private subSampleSize(size: number, samplingBits: number): number {\r\n        return (size + (1 << samplingBits) - 1) >> samplingBits;\r\n    }\r\n\r\n    /**\r\n     * Skip transform image data (simplified skip logic)\r\n     */\r\n    private skipTransformImage(br: BitReader, width: number, height: number): void {\r\n        // Skip the Huffman codes and pixel data for transforms\r\n        try {\r\n            this.huffmanDecoder.readHuffmanCodes(br); // Skip Huffman codes\r\n        } catch {\r\n            // If reading Huffman codes fails, skip a reasonable amount of bits\r\n            const maxBitsToSkip = Math.min(width * height * 4, 10000);\r\n            for (let i = 0; i < maxBitsToSkip && br.hasMore(); i++) {\r\n                br.readBits(1);\r\n            }\r\n            return;\r\n        }\r\n        const totalPixels = width * height;\r\n        // For simplicity, just skip a reasonable amount of data\r\n        // This is not accurate but avoids the complex decoding\r\n        for (let i = 0; i < Math.min(totalPixels * 4, 10000); i++) {\r\n            if (!br.hasMore()) break;\r\n            br.readBits(1);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get length from LZ77 symbol\r\n     */\r\n    private getLengthFromSymbol(symbol: number, br: BitReader): number {\r\n        if (symbol < 4) return symbol + 1;\r\n        const extraBits = (symbol - 2) >> 1;\r\n        const offset = (2 + (symbol & 1)) << extraBits;\r\n        return offset + br.readBits(extraBits) + 1;\r\n    }\r\n\r\n    /**\r\n     * Get distance from LZ77 symbol\r\n     */\r\n    private getDistanceFromSymbol(symbol: number, br: BitReader): number {\r\n        if (symbol < 4) return symbol + 1;\r\n        const extraBits = (symbol - 2) >> 1;\r\n        const offset = (2 + (symbol & 1)) << extraBits;\r\n        return offset + br.readBits(extraBits) + 1;\r\n    }\r\n\r\n    /**\r\n     * Decode VP8X extended format\r\n     */\r\n    decodeVp8x(chunk: RiffChunk, chunks: RiffChunk[], options: DecodeOptions, calculateDimensions: (w: number, h: number, opts: DecodeOptions) => { targetWidth: number; targetHeight: number }, resizeNN: (src: Uint8Array, sw: number, sh: number, tw: number, th: number, channels: number) => Uint8Array): ImageInfo {\r\n        const data = new Uint8Array(chunk.data.buffer, chunk.data.byteOffset, chunk.data.byteLength);\r\n\r\n        // VP8X flags (currently unused but available for future features)\r\n        const flags = data[0];\r\n        const hasAnimation = (flags & 0x02) !== 0;\r\n\r\n        if (hasAnimation) {\r\n            throw new Error(\"Animated WebP is not supported\");\r\n        }\r\n\r\n        // Find the actual image data chunk\r\n        const vp8lChunk = chunks.find(c => c.fourCC === 'VP8L');\r\n        if (vp8lChunk) {\r\n            return this.decodeVp8l(vp8lChunk, options, calculateDimensions, resizeNN);\r\n        }\r\n\r\n        const vp8Chunk = chunks.find(c => c.fourCC === 'VP8 ');\r\n        if (vp8Chunk) {\r\n            throw new Error(\"VP8 (lossy) WebP format is not yet supported\");\r\n        }\r\n\r\n        throw new Error(\"No image data found in VP8X container\");\r\n    }\r\n}\r\n", "import type { ImageInfo } from \"./types.js\";\r\nimport { WebpRiffParser } from \"./webp-riff-parser.js\";\r\nimport { Vp8lDecoder } from \"./webp-vp8l-decoder.js\";\r\n\r\n// ============================================================================\r\n// Types & Interfaces\r\n// ============================================================================\r\n\r\nexport interface DecodeOptions {\r\n  maxWidth?: number;\r\n  maxHeight?: number;\r\n  scale?: number;\r\n}\r\n\r\n// ============================================================================\r\n// Constants\r\n// ============================================================================\r\n\r\nconst TEXT_DECODER = new TextDecoder(\"ascii\");\r\n\r\n// ============================================================================\r\n// DataReader Class\r\n// ============================================================================\r\n\r\n/**\r\n * Sequential binary data reader with automatic offset tracking\r\n */\r\nexport class DataReader {\r\n  private view: DataView;\r\n  private offset: number = 0;\r\n\r\n  constructor(buffer: ArrayBuffer) {\r\n    this.view = new DataView(buffer);\r\n  }\r\n\r\n  public seek(offset: number): void {\r\n    if (offset < 0 || offset > this.view.byteLength) {\r\n      throw new RangeError(`Seek offset ${offset} out of bounds [0, ${this.view.byteLength}]`);\r\n    }\r\n    this.offset = offset;\r\n  }\r\n\r\n  public tell(): number {\r\n    return this.offset;\r\n  }\r\n\r\n  public hasMore(): boolean {\r\n    return this.offset < this.view.byteLength;\r\n  }\r\n\r\n  public getUint8(): number {\r\n    this.checkBounds(1);\r\n    const value = this.view.getUint8(this.offset);\r\n    this.offset += 1;\r\n    return value;\r\n  }\r\n\r\n  public getUint16(littleEndian: boolean = false): number {\r\n    this.checkBounds(2);\r\n    const value = this.view.getUint16(this.offset, littleEndian);\r\n    this.offset += 2;\r\n    return value;\r\n  }\r\n\r\n  public getUint32(littleEndian: boolean = false): number {\r\n    this.checkBounds(4);\r\n    const value = this.view.getUint32(this.offset, littleEndian);\r\n    this.offset += 4;\r\n    return value;\r\n  }\r\n\r\n  public getString(length: number): string {\r\n    this.checkBounds(length);\r\n    const bytes = new Uint8Array(this.view.buffer, this.view.byteOffset + this.offset, length);\r\n    this.offset += length;\r\n    return TEXT_DECODER.decode(bytes);\r\n  }\r\n\r\n  public getView(length: number): DataView {\r\n    this.checkBounds(length);\r\n    const view = new DataView(this.view.buffer, this.view.byteOffset + this.offset, length);\r\n    this.offset += length;\r\n    return view;\r\n  }\r\n\r\n  private checkBounds(length: number): void {\r\n    if (this.offset + length > this.view.byteLength) {\r\n      throw new RangeError(`Read beyond buffer bounds: ${this.offset + length} > ${this.view.byteLength}`);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Reads individual bits from a DataView (LSB first)\r\n */\r\nexport class BitReader {\r\n  private view: DataView;\r\n  private bytePos: number = 0;\r\n  private bitPos: number = 0;\r\n\r\n  constructor(view: DataView) {\r\n    this.view = view;\r\n  }\r\n\r\n  public readBits(n: number): number {\r\n    if (n > 32) {\r\n      throw new Error(\"Cannot read more than 32 bits at once\");\r\n    }\r\n\r\n    let value = 0;\r\n    for (let i = 0; i < n; i++) {\r\n      if (this.bytePos >= this.view.byteLength) {\r\n        // Pad with zeros if we run out of data (end of stream)\r\n        return value;\r\n      }\r\n\r\n      const byte = this.view.getUint8(this.bytePos);\r\n      const bit = (byte >> this.bitPos) & 1;\r\n      value |= bit << i;\r\n\r\n      this.bitPos++;\r\n      if (this.bitPos === 8) {\r\n        this.bitPos = 0;\r\n        this.bytePos++;\r\n      }\r\n    }\r\n    return value;\r\n  }\r\n\r\n  public hasMore(): boolean {\r\n    return this.bytePos < this.view.byteLength;\r\n  }\r\n\r\n  // For debugging - peek at next bits without consuming them\r\n  public peekBits(n: number): number {\r\n    const oldBytePos = this.bytePos;\r\n    const oldBitPos = this.bitPos;\r\n    const value = this.readBits(n);\r\n    this.bytePos = oldBytePos;\r\n    this.bitPos = oldBitPos;\r\n    return value;\r\n  }\r\n}\r\n\r\nexport abstract class BaseDecoder {\r\n\r\n  protected static calculateDimensions(\r\n    width: number,\r\n    height: number,\r\n    options: DecodeOptions\r\n  ): { targetWidth: number; targetHeight: number } {\r\n    let targetWidth = width;\r\n    let targetHeight = height;\r\n\r\n    if (options.scale && options.scale > 0) {\r\n      targetWidth = Math.max(1, Math.round(width * options.scale));\r\n      targetHeight = Math.max(1, Math.round(height * options.scale));\r\n    } else if (options.maxWidth || options.maxHeight) {\r\n      const scale = Math.min(\r\n        options.maxWidth ? options.maxWidth / width : Infinity,\r\n        options.maxHeight ? options.maxHeight / height : Infinity\r\n      );\r\n\r\n      if (scale > 0 && scale < 1) {\r\n        targetWidth = Math.max(1, Math.round(width * scale));\r\n        targetHeight = Math.max(1, Math.round(height * scale));\r\n      }\r\n    }\r\n\r\n    return { targetWidth, targetHeight };\r\n  }\r\n\r\n  protected static resizeNN(\r\n    src: Uint8Array,\r\n    sw: number,\r\n    sh: number,\r\n    tw: number,\r\n    th: number,\r\n    channels: number,\r\n  ): Uint8Array {\r\n    if (sw === tw && sh === th) return src;\r\n\r\n    const dst = new Uint8Array(tw * th * channels);\r\n    const xRatio = sw / tw;\r\n    const yRatio = sh / th;\r\n\r\n    for (let y = 0; y < th; y++) {\r\n      const sy = Math.min(sh - 1, Math.floor(y * yRatio));\r\n      const srcRowOffset = sy * sw * channels;\r\n      const dstRowOffset = y * tw * channels;\r\n\r\n      for (let x = 0; x < tw; x++) {\r\n        const sx = Math.min(sw - 1, Math.floor(x * xRatio));\r\n        const si = srcRowOffset + sx * channels;\r\n        const di = dstRowOffset + x * channels;\r\n\r\n        for (let c = 0; c < channels; c++) {\r\n          dst[di + c] = src[si + c];\r\n        }\r\n      }\r\n    }\r\n    return dst;\r\n  }\r\n\r\n  public abstract decode(buffer: ArrayBuffer, options?: DecodeOptions): Promise<ImageInfo>;\r\n}\r\n\r\nexport class WebpDecoder extends BaseDecoder {\r\n  private riffParser = new WebpRiffParser();\r\n  private vp8lDecoder = new Vp8lDecoder();\r\n\r\n  public async decode(\r\n    buffer: ArrayBuffer,\r\n    options: DecodeOptions = {},\r\n  ): Promise<ImageInfo> {\r\n    const reader = new DataReader(buffer);\r\n\r\n    // Validate RIFF header\r\n    this.riffParser.validateHeader(reader);\r\n\r\n    // Parse chunks\r\n    const chunks = this.riffParser.parseChunks(reader);\r\n\r\n    // Determine format and decode\r\n    const vp8xChunk = chunks.find(c => c.fourCC === 'VP8X');\r\n    if (vp8xChunk) {\r\n      return this.vp8lDecoder.decodeVp8x(vp8xChunk, chunks, options, WebpDecoder.calculateDimensions, WebpDecoder.resizeNN);\r\n    }\r\n\r\n    const vp8lChunk = chunks.find(c => c.fourCC === 'VP8L');\r\n    if (vp8lChunk) {\r\n      return this.vp8lDecoder.decodeVp8l(vp8lChunk, options, WebpDecoder.calculateDimensions, WebpDecoder.resizeNN);\r\n    }\r\n\r\n    const vp8Chunk = chunks.find(c => c.fourCC === 'VP8 ');\r\n    if (vp8Chunk) {\r\n      throw new Error(\"VP8 (lossy) WebP format is not yet supported\");\r\n    }\r\n\r\n    throw new Error(\"Unsupported WebP format: No recognized image chunk found\");\r\n  }\r\n}\r\n", "// Browser stub: NodeEnvironment is unavailable in browser builds.\nimport type { Environment, ResourceLoader, Compression } from \"./environment.js\";\n\nclass NoopLoader implements ResourceLoader {\n  async load(_source: string): Promise<ArrayBuffer> {\n    throw new Error(\"NodeEnvironment is not available in browser builds\");\n  }\n}\n\nclass NoopCompression implements Compression {\n  async inflateRaw(_data: Uint8Array): Promise<Uint8Array> {\n    throw new Error(\"NodeEnvironment compression is not available in browser builds\");\n  }\n}\n\nexport class NodeEnvironment implements Environment {\n  readonly loader: ResourceLoader = new NoopLoader();\n  readonly compression: Compression = new NoopCompression();\n  resolveLocal(): string {\n    throw new Error(\"NodeEnvironment resolveLocal is not available in browser builds\");\n  }\n  now(): number {\n    return typeof performance !== \"undefined\" ? performance.now() : Date.now();\n  }\n  getEnv(_name: string): string | undefined {\n    return undefined;\n  }\n}\n", "import { JpegDecoder } from './jpeg-decoder.js';\nimport { PngDecoder } from './png-decoder.js';\nimport { WebpDecoder } from './webp-decoder.js';\nimport type { ImageInfo, ImageDecodeOptions } from './types.js';\nimport type { Environment } from '../environment/environment.js';\nimport { NodeEnvironment } from '../environment/node-environment.js';\nimport { getGlobalEnvironment } from '../environment/global.js';\n\r\n/**\r\n * Image Service following SOLID principles:\r\n * - Single Responsibility: Handles all image operations\r\n * - Open/Closed: Extensible for new image formats\r\n * - Dependency Inversion: Depends on abstractions, not concrete implementations\r\n */\r\nexport class ImageService {\n  private static instance: ImageService;\n  private readonly env: Environment;\n  private imageCache = new Map<string, ImageInfo>();\n  private readonly jpegDecoder = new JpegDecoder();\n  private readonly pngDecoder = new PngDecoder();\n  private readonly webpDecoder = new WebpDecoder();\n\n  private constructor(env?: Environment) {\n    this.env = env ?? globalEnvironmentFallback();\n  }\n\r\n  /**\r\n   * Singleton pattern implementation\r\n   */\r\n  public static getInstance(env?: Environment): ImageService {\n    if (!ImageService.instance) {\n      ImageService.instance = new ImageService(env);\n    }\n    return ImageService.instance;\n  }\n\r\n  /**\r\n   * Loads an image from file path\r\n   */\r\n  public async loadImage(path: string, options?: ImageDecodeOptions): Promise<ImageInfo> {\n    const normalizedPath = this.normalizeSource(path);\n    // Check cache first\n    const cacheKey = this.generateCacheKey(normalizedPath, options);\n    if (this.imageCache.has(cacheKey)) {\n      return this.imageCache.get(cacheKey)!;\n    }\n\n    try {\n      const arrayBuffer = await this.env.loader.load(normalizedPath);\n      const imageInfo = await this.decodeImage(arrayBuffer, options);\n\r\n      // Cache the result\r\n      this.imageCache.set(cacheKey, imageInfo);\r\n      return imageInfo;\r\n    } catch (error) {\r\n      throw new Error(`Failed to load image from ${normalizedPath}: ${error instanceof Error ? error.message : String(error)}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Decodes image data from buffer\r\n   */\r\n  public async decodeImage(buffer: ArrayBuffer, options?: ImageDecodeOptions): Promise<ImageInfo> {\r\n    // Detect image format by checking file signatures\r\n    const format = this.detectImageFormat(buffer);\r\n    \r\n    switch (format) {\r\n      case 'jpeg':\r\n        return this.jpegDecoder.decode(buffer, options);\r\n      case 'png':\r\n        return this.pngDecoder.decode(buffer, options);\r\n      case 'gif':\r\n        // Placeholder for GIF decoder\r\n        return this.decodeGif(buffer, options);\r\n      case 'webp':\r\n        // Placeholder for WebP decoder\r\n        return this.decodeWebp(buffer, options);\r\n      default:\r\n        throw new Error(`Unsupported image format: ${format}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Detects image format by magic numbers\r\n   */\r\n  private detectImageFormat(buffer: ArrayBuffer): 'jpeg' | 'png' | 'gif' | 'webp' {\r\n    const view = new DataView(buffer);\r\n    \r\n    // JPEG signature: FF D8 FF\r\n    if (buffer.byteLength >= 3 && \r\n        view.getUint8(0) === 0xFF && \r\n        view.getUint8(1) === 0xD8 && \r\n        view.getUint8(2) === 0xFF) {\r\n      return 'jpeg';\r\n    }\r\n    \r\n    // PNG signature: 89 50 4E 47 0D 0A 1A 0A\r\n    if (buffer.byteLength >= 8 && \r\n        view.getUint8(0) === 0x89 && \r\n        view.getUint8(1) === 0x50 && \r\n        view.getUint8(2) === 0x4E && \r\n        view.getUint8(3) === 0x47 && \r\n        view.getUint8(4) === 0x0D && \r\n        view.getUint8(5) === 0x0A && \r\n        view.getUint8(6) === 0x1A && \r\n        view.getUint8(7) === 0x0A) {\r\n      return 'png';\r\n    }\r\n    \r\n    // GIF signature: GIF87a or GIF89a\r\n    if (buffer.byteLength >= 6) {\r\n      const gifSignature = new TextDecoder().decode(buffer.slice(0, 6));\r\n      if (gifSignature.startsWith('GIF')) {\r\n        return 'gif';\r\n      }\r\n    }\r\n    \r\n    // WebP signature: RIFF + WEBP\r\n    if (buffer.byteLength >= 12 && \r\n        view.getUint32(0, false) === 0x52494646 && // \"RIFF\"\r\n        view.getUint32(8, false) === 0x57454250) { // \"WEBP\"\r\n      return 'webp';\r\n    }\r\n    \r\n    throw new Error('Unknown image format');\r\n  }\r\n\r\n\r\n  /**\r\n   * Placeholder GIF decoder\r\n   */\r\n  private decodeGif(_buffer: ArrayBuffer, options?: ImageDecodeOptions): ImageInfo {\r\n    // For now, return placeholder data\r\n    const width = options?.maxWidth || 100;\r\n    const height = options?.maxHeight || 100;\r\n    const pixelCount = width * height;\r\n    const imageData = new ArrayBuffer(pixelCount * 4); // RGBA\r\n\r\n    return {\r\n      width,\r\n      height,\r\n      format: 'gif',\r\n      channels: 4,\r\n      bitsPerChannel: 8,\r\n      data: imageData\r\n    };\r\n  }\r\n\r\n  /**\r\n   * WebP decoder\r\n   */\r\n  private async decodeWebp(buffer: ArrayBuffer, options?: ImageDecodeOptions): Promise<ImageInfo> {\r\n    return this.webpDecoder.decode(buffer, options);\r\n  }\r\n\r\n  /**\r\n   * Generates a cache key for image options\r\n   */\r\n  private generateCacheKey(path: string, options?: ImageDecodeOptions): string {\r\n    const optionsStr = options ? \r\n      `_${options.maxWidth || 0}_${options.maxHeight || 0}_${options.scale || 1}` : \r\n      '_default';\r\n    return `${path}${optionsStr}`;\r\n  }\r\n\r\n  /**\r\n   * Clears the image cache\r\n   */\r\n  public clearCache(): void {\r\n    this.imageCache.clear();\r\n  }\r\n\r\n  private normalizeSource(source: string): string {\n    return source;\n  }\n}\n\nfunction globalEnvironmentFallback(): Environment {\n  const maybeEnv = getGlobalEnvironment();\n  if (maybeEnv) return maybeEnv;\n\n  const hasProcess = typeof process !== \"undefined\" && !!process.versions?.node;\n  if (hasProcess) {\n    return new NodeEnvironment();\n  }\n\n  throw new Error(\"Environment not provided to ImageService and no global __PAGYRA_ENV__ set\");\n}\n", "/**\n * Decode a base64 string into a Uint8Array without relying on Node Buffer.\n */\nexport function decodeBase64ToUint8Array(base64: string): Uint8Array {\n  const chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n  const clean = base64.replace(/[^A-Za-z0-9+/=]/g, \"\");\n  const output: number[] = [];\n  let buffer = 0;\n  let bits = 0;\n\n  for (const c of clean) {\n    if (c === \"=\") break;\n    const value = chars.indexOf(c);\n    if (value === -1) continue;\n    buffer = (buffer << 6) | value;\n    bits += 6;\n    if (bits >= 8) {\n      bits -= 8;\n      output.push((buffer >> bits) & 0xff);\n    }\n  }\n\n  return new Uint8Array(output);\n}\n", "import type { SvgNode } from \"./types.js\";\r\n\r\n/**\r\n * Context object passed to SVG element parsers.\r\n */\r\nexport interface SvgParseContext {\r\n    warn: (message: string) => void;\r\n}\r\n\r\n/**\r\n * Function signature for parsing a specific SVG element type.\r\n * \r\n * @param element - The DOM element to parse\r\n * @param context - Parsing context with utilities like warn\r\n * @returns Parsed SVG node or null if parsing fails\r\n */\r\nexport type ElementParser = (\r\n    element: Element,\r\n    context: SvgParseContext\r\n) => SvgNode | null;\r\n\r\n/**\r\n * Registry for SVG element parsers, enabling extensibility.\r\n * \r\n * This class implements the Registry pattern to allow:\r\n * - Adding custom parsers for non-standard SVG elements\r\n * - Overriding default parsers with custom implementations\r\n * - Cleaner separation of concerns (Open/Closed Principle)\r\n */\r\nexport class ParserRegistry {\r\n    private readonly parsers = new Map<string, ElementParser>();\r\n\r\n    /**\r\n     * Registers a parser for a specific SVG element tag.\r\n     * \r\n     * @param tagName - The element tag name (lowercase)\r\n     * @param parser - The parser function to handle this element\r\n     */\r\n    register(tagName: string, parser: ElementParser): void {\r\n        this.parsers.set(tagName.toLowerCase(), parser);\r\n    }\r\n\r\n    /**\r\n     * Parses an element using the registered parser for its tag.\r\n     * \r\n     * @param element - The DOM element to parse\r\n     * @param context - Parsing context\r\n     * @returns Parsed SVG node or null if no parser is registered or parsing fails\r\n     */\r\n    parse(element: Element, context: SvgParseContext): SvgNode | null {\r\n        const tag = element.tagName.toLowerCase();\r\n        const parser = this.parsers.get(tag);\r\n\r\n        if (!parser) {\r\n            context.warn(`Unsupported <${tag}> element ignored.`);\r\n            return null;\r\n        }\r\n\r\n        return parser(element, context);\r\n    }\r\n\r\n    /**\r\n     * Checks if a parser is registered for the given tag.\r\n     * \r\n     * @param tagName - The element tag name to check\r\n     * @returns true if a parser is registered\r\n     */\r\n    has(tagName: string): boolean {\r\n        return this.parsers.has(tagName.toLowerCase());\r\n    }\r\n}\r\n", "import {\r\n  type SvgCircleNode,\r\n  type SvgClipPathNode,\r\n  type SvgCommon,\r\n  type SvgContainerNode,\r\n  type SvgEllipseNode,\r\n  type SvgGradientStop,\r\n  type SvgGroupNode,\r\n  type SvgDefsNode,\r\n  type SvgImageNode,\r\n  type SvgLineNode,\r\n  type SvgLinearGradientNode,\r\n  type SvgNode,\r\n  type SvgNodeType,\r\n  type SvgPathNode,\r\n  type SvgPoint,\r\n  type SvgPolygonNode,\r\n  type SvgPolylineNode,\r\n  type SvgRadialGradientNode,\r\n  type SvgRectNode,\r\n  type SvgRootNode,\r\n  type SvgTextNode,\r\n  type SvgUseNode,\r\n  type SvgViewBox,\r\n} from \"./types.js\";\r\nimport { parseTransform } from \"../transform/css-parser.js\";\r\nimport { ParserRegistry, type SvgParseContext as ImportedSvgParseContext } from \"./parser-registry.js\";\r\n\r\nexport interface ParseSvgOptions {\r\n  warn?: (message: string) => void;\r\n  /** Optional custom parser registry. If not provided, uses the default registry. */\r\n  registry?: ParserRegistry;\r\n}\r\n\r\n/** @deprecated Use SvgParseContext from parser-registry.ts */\r\ninterface SvgParseContext extends ImportedSvgParseContext { }\r\nexport type { SvgParseContext as SvgParseContext };\r\n\r\nexport function parseSvg(element: Element, options: ParseSvgOptions = {}): SvgRootNode | null {\r\n  const warn = options.warn ?? (() => { });\r\n  if (element.tagName.toLowerCase() !== \"svg\") {\r\n    warn(\"Expected <svg> root element.\");\r\n    return null;\r\n  }\r\n  const context: SvgParseContext = { warn };\r\n  const registry = options.registry ?? defaultParserRegistry;\r\n  const parsed = registry.parse(element, context);\r\n  if (!parsed || parsed.type !== \"svg\") {\r\n    warn(\"Unable to parse <svg> element.\");\r\n    return null;\r\n  }\r\n  return parsed;\r\n}\r\n\r\n/**\r\n * Parses a generic SVG element into a typed node structure.\r\n * \r\n * @param element - The DOM element to parse\r\n * @param context - Parsing context\r\n * @param registry - Optional parser registry (uses default if not provided)\r\n * @returns Parsed SVG node or null if unsupported\r\n */\r\nexport function parseElement(\r\n  element: Element,\r\n  context: SvgParseContext,\r\n  registry?: ParserRegistry\r\n): SvgNode | null {\r\n  const reg = registry ?? defaultParserRegistry;\r\n  return reg.parse(element, context);\r\n}\r\n\r\nfunction parseSvgRoot(element: Element, context: SvgParseContext): SvgRootNode | null {\r\n  const base = createContainerBase(element, \"svg\", context);\r\n  if (!base) {\r\n    return null;\r\n  }\r\n\r\n  const viewBox = parseViewBox(element.getAttribute(\"viewBox\"));\r\n  const width = parseLength(element.getAttribute(\"width\"));\r\n  const height = parseLength(element.getAttribute(\"height\"));\r\n\r\n  return {\r\n    ...base,\r\n    type: \"svg\",\r\n    width,\r\n    height,\r\n    viewBox,\r\n  };\r\n}\r\n\r\nfunction parseGroup(element: Element, context: SvgParseContext): SvgGroupNode | null {\r\n  const base = createContainerBase(element, \"g\", context);\r\n  if (!base) {\r\n    return null;\r\n  }\r\n  return {\r\n    ...base,\r\n    type: \"g\",\r\n  };\r\n}\r\n\r\nfunction parseDefs(element: Element, context: SvgParseContext): SvgDefsNode | null {\r\n  const base = createContainerBase(element, \"defs\", context);\r\n  if (!base) {\r\n    return null;\r\n  }\r\n  return {\r\n    ...base,\r\n    type: \"defs\",\r\n  };\r\n}\r\n\r\nfunction parseRect(element: Element): SvgRectNode {\r\n  const common = collectCommon(element, \"rect\");\r\n  return {\r\n    ...common,\r\n    type: \"rect\",\r\n    x: parseLength(element.getAttribute(\"x\")),\r\n    y: parseLength(element.getAttribute(\"y\")),\r\n    width: parseLength(element.getAttribute(\"width\")),\r\n    height: parseLength(element.getAttribute(\"height\")),\r\n    rx: parseLength(element.getAttribute(\"rx\")),\r\n    ry: parseLength(element.getAttribute(\"ry\")),\r\n  };\r\n}\r\n\r\nfunction parseCircle(element: Element): SvgCircleNode {\r\n  const common = collectCommon(element, \"circle\");\r\n  return {\r\n    ...common,\r\n    type: \"circle\",\r\n    cx: parseLength(element.getAttribute(\"cx\")),\r\n    cy: parseLength(element.getAttribute(\"cy\")),\r\n    r: parseLength(element.getAttribute(\"r\")),\r\n  };\r\n}\r\n\r\nfunction parseEllipse(element: Element): SvgEllipseNode {\r\n  const common = collectCommon(element, \"ellipse\");\r\n  return {\r\n    ...common,\r\n    type: \"ellipse\",\r\n    cx: parseLength(element.getAttribute(\"cx\")),\r\n    cy: parseLength(element.getAttribute(\"cy\")),\r\n    rx: parseLength(element.getAttribute(\"rx\")),\r\n    ry: parseLength(element.getAttribute(\"ry\")),\r\n  };\r\n}\r\n\r\nfunction parseLine(element: Element): SvgLineNode {\r\n  const common = collectCommon(element, \"line\");\r\n  return {\r\n    ...common,\r\n    type: \"line\",\r\n    x1: parseLength(element.getAttribute(\"x1\")),\r\n    y1: parseLength(element.getAttribute(\"y1\")),\r\n    x2: parseLength(element.getAttribute(\"x2\")),\r\n    y2: parseLength(element.getAttribute(\"y2\")),\r\n  };\r\n}\r\n\r\nfunction parsePath(element: Element): SvgPathNode {\r\n  const common = collectCommon(element, \"path\");\r\n  return {\r\n    ...common,\r\n    type: \"path\",\r\n    d: element.getAttribute(\"d\") ?? undefined,\r\n  };\r\n}\r\n\r\nfunction parsePolyline(element: Element): SvgPolylineNode {\r\n  const common = collectCommon(element, \"polyline\");\r\n  return {\r\n    ...common,\r\n    type: \"polyline\",\r\n    points: parsePointList(element.getAttribute(\"points\")),\r\n  };\r\n}\r\n\r\nfunction parsePolygon(element: Element): SvgPolygonNode {\r\n  const common = collectCommon(element, \"polygon\");\r\n  return {\r\n    ...common,\r\n    type: \"polygon\",\r\n    points: parsePointList(element.getAttribute(\"points\")),\r\n  };\r\n}\r\n\r\nfunction parseText(element: Element): SvgTextNode | null {\r\n  const common = collectCommon(element, \"text\");\r\n  const raw = element.textContent ?? \"\";\r\n  const text = raw.replace(/\\s+/g, \" \").trim();\r\n  if (!text) {\r\n    return null;\r\n  }\r\n  return {\r\n    ...common,\r\n    type: \"text\",\r\n    text,\r\n    x: parseLength(element.getAttribute(\"x\")),\r\n    y: parseLength(element.getAttribute(\"y\")),\r\n    fontSize: parseLength(element.getAttribute(\"font-size\")),\r\n    fontFamily: element.getAttribute(\"font-family\") ?? undefined,\r\n    textAnchor: normalizeTextAnchor(element.getAttribute(\"text-anchor\")),\r\n  };\r\n}\r\n\r\nfunction normalizeTextAnchor(anchor: string | null): \"start\" | \"middle\" | \"end\" | undefined {\r\n  if (!anchor) {\r\n    return undefined;\r\n  }\r\n  const lower = anchor.trim().toLowerCase();\r\n  if (lower === \"start\" || lower === \"middle\" || lower === \"end\") {\r\n    return lower;\r\n  }\r\n  return undefined;\r\n}\r\n\r\nfunction createContainerBase(element: Element, type: SvgContainerNode[\"type\"], context: SvgParseContext): SvgContainerNode | null {\r\n  const common = collectCommon(element, type);\r\n  const children: SvgNode[] = [];\r\n  for (const child of Array.from(element.children)) {\r\n    const parsed = parseElement(child, context);\r\n    if (parsed) {\r\n      children.push(parsed);\r\n    }\r\n  }\r\n  return {\r\n    ...common,\r\n    type,\r\n    children,\r\n  };\r\n}\r\n\r\nfunction collectCommon(element: Element, type: SvgNodeType): SvgCommon {\r\n  const attributes: Record<string, string> = {};\r\n  if (typeof element.getAttributeNames === \"function\") {\r\n    for (const name of element.getAttributeNames()) {\r\n      const value = element.getAttribute(name);\r\n      if (value !== null) {\r\n        attributes[name] = value;\r\n      }\r\n    }\r\n  } else {\r\n    const rawAttrs = element.attributes ?? [];\r\n    for (const attr of Array.from(rawAttrs)) {\r\n      const value = attr.value;\r\n      if (value !== null) {\r\n        attributes[attr.name] = value;\r\n      }\r\n    }\r\n  }\r\n\r\n  const classAttr = element.getAttribute(\"class\");\r\n  const classes = classAttr ? classAttr.split(/\\s+/).filter(Boolean) : [];\r\n\r\n  const transform = element.getAttribute(\"transform\") ?? undefined;\r\n  const transformMatrix = transform ? parseTransform(transform) || undefined : undefined;\r\n\r\n  return {\r\n    type,\r\n    id: element.getAttribute(\"id\") ?? undefined,\r\n    classes,\r\n    attributes,\r\n    transform,\r\n    transformMatrix,\r\n  };\r\n}\r\n\r\nfunction parseLength(raw: string | null): number | undefined {\r\n  if (!raw) {\r\n    return undefined;\r\n  }\r\n  const trimmed = raw.trim();\r\n  if (trimmed.length === 0) {\r\n    return undefined;\r\n  }\r\n  const match = trimmed.match(/^(-?\\d+(\\.\\d+)?)([a-z%]*)$/i);\r\n  if (!match) {\r\n    return undefined;\r\n  }\r\n  const value = Number.parseFloat(match[1]);\r\n  if (!Number.isFinite(value)) {\r\n    return undefined;\r\n  }\r\n  const unit = match[3] ?? \"\";\r\n  if (unit && unit !== \"px\") {\r\n    return undefined;\r\n  }\r\n  return value;\r\n}\r\n\r\nfunction parseViewBox(raw: string | null): SvgViewBox | undefined {\r\n  if (!raw) {\r\n    return undefined;\r\n  }\r\n  const tokens = raw\r\n    .trim()\r\n    .split(/[\\s,]+/)\r\n    .map((chunk) => Number.parseFloat(chunk));\r\n  if (tokens.length !== 4 || tokens.some((value) => !Number.isFinite(value))) {\r\n    return undefined;\r\n  }\r\n  return {\r\n    minX: tokens[0],\r\n    minY: tokens[1],\r\n    width: tokens[2],\r\n    height: tokens[3],\r\n  };\r\n}\r\n\r\nfunction parseImage(element: Element): SvgImageNode {\r\n  const common = collectCommon(element, \"image\");\r\n  return {\r\n    ...common,\r\n    type: \"image\",\r\n    x: parseLength(element.getAttribute(\"x\")),\r\n    y: parseLength(element.getAttribute(\"y\")),\r\n    width: parseLength(element.getAttribute(\"width\")),\r\n    height: parseLength(element.getAttribute(\"height\")),\r\n    href: element.getAttribute(\"href\") || element.getAttribute(\"xlink:href\") || undefined,\r\n    preserveAspectRatio: element.getAttribute(\"preserveAspectRatio\") || undefined,\r\n  };\r\n}\r\n\r\nfunction parseUse(element: Element): SvgUseNode {\r\n  const common = collectCommon(element, \"use\");\r\n  return {\r\n    ...common,\r\n    type: \"use\",\r\n    x: parseLength(element.getAttribute(\"x\")),\r\n    y: parseLength(element.getAttribute(\"y\")),\r\n    width: parseLength(element.getAttribute(\"width\")),\r\n    height: parseLength(element.getAttribute(\"height\")),\r\n    href: element.getAttribute(\"href\") || element.getAttribute(\"xlink:href\") || undefined,\r\n  };\r\n}\r\n\r\nfunction parseClipPath(element: Element, context: SvgParseContext): SvgClipPathNode | null {\r\n  const base = createContainerBase(element, \"clippath\", context);\r\n  if (!base) {\r\n    return null;\r\n  }\r\n  const clipPathUnits = element.getAttribute(\"clipPathUnits\");\r\n  return {\r\n    ...base,\r\n    type: \"clippath\",\r\n    clipPathUnits: clipPathUnits === \"objectBoundingBox\" ? \"objectBoundingBox\" : \"userSpaceOnUse\",\r\n  };\r\n}\r\n\r\nfunction parseLinearGradient(element: Element, context: SvgParseContext): SvgLinearGradientNode | null {\r\n  const common = collectCommon(element, \"lineargradient\");\r\n  const stops = parseGradientStops(element, context);\r\n  return {\r\n    ...common,\r\n    type: \"lineargradient\",\r\n    x1: parseLength(element.getAttribute(\"x1\")) ?? 0,\r\n    y1: parseLength(element.getAttribute(\"y1\")) ?? 0,\r\n    x2: parseLength(element.getAttribute(\"x2\")) ?? 1,\r\n    y2: parseLength(element.getAttribute(\"y2\")) ?? 0,\r\n    gradientUnits: element.getAttribute(\"gradientUnits\") === \"userSpaceOnUse\" ? \"userSpaceOnUse\" : \"objectBoundingBox\",\r\n    spreadMethod: normalizeSpreadMethod(element.getAttribute(\"spreadMethod\")),\r\n    stops,\r\n  };\r\n}\r\n\r\nfunction parseRadialGradient(element: Element, context: SvgParseContext): SvgRadialGradientNode | null {\r\n  const common = collectCommon(element, \"radialgradient\");\r\n  const stops = parseGradientStops(element, context);\r\n  return {\r\n    ...common,\r\n    type: \"radialgradient\",\r\n    cx: parseLength(element.getAttribute(\"cx\")) ?? 0.5,\r\n    cy: parseLength(element.getAttribute(\"cy\")) ?? 0.5,\r\n    r: parseLength(element.getAttribute(\"r\")) ?? 0.5,\r\n    fx: parseLength(element.getAttribute(\"fx\")),\r\n    fy: parseLength(element.getAttribute(\"fy\")),\r\n    gradientUnits: element.getAttribute(\"gradientUnits\") === \"userSpaceOnUse\" ? \"userSpaceOnUse\" : \"objectBoundingBox\",\r\n    spreadMethod: normalizeSpreadMethod(element.getAttribute(\"spreadMethod\")),\r\n    stops,\r\n  };\r\n}\r\n\r\nfunction parseGradientStops(element: Element, _context: SvgParseContext): SvgGradientStop[] {\r\n  const stops: SvgGradientStop[] = [];\r\n  for (const child of Array.from(element.children)) {\r\n    if (child.tagName.toLowerCase() === \"stop\") {\r\n      const offset = parseGradientOffset(child.getAttribute(\"offset\"));\r\n      const color = child.getAttribute(\"stop-color\") || \"#000000\";\r\n      const opacity = parseOpacity(child.getAttribute(\"stop-opacity\"));\r\n      if (offset !== undefined) {\r\n        stops.push({ offset, color, opacity });\r\n      }\r\n    }\r\n  }\r\n  return stops;\r\n}\r\n\r\nfunction parseGradientOffset(raw: string | null): number | undefined {\r\n  if (!raw) {\r\n    return undefined;\r\n  }\r\n  const trimmed = raw.trim();\r\n  if (trimmed.endsWith(\"%\")) {\r\n    const value = Number.parseFloat(trimmed.slice(0, -1));\r\n    return Number.isFinite(value) ? value / 100 : undefined;\r\n  }\r\n  const value = Number.parseFloat(trimmed);\r\n  return Number.isFinite(value) ? value : undefined;\r\n}\r\n\r\nfunction parseOpacity(raw: string | null): number | undefined {\r\n  if (!raw) {\r\n    return undefined;\r\n  }\r\n  const value = Number.parseFloat(raw.trim());\r\n  return Number.isFinite(value) && value >= 0 && value <= 1 ? value : undefined;\r\n}\r\n\r\nfunction normalizeSpreadMethod(method: string | null): \"pad\" | \"reflect\" | \"repeat\" | undefined {\r\n  if (!method) {\r\n    return undefined;\r\n  }\r\n  const lower = method.trim().toLowerCase();\r\n  if (lower === \"pad\" || lower === \"reflect\" || lower === \"repeat\") {\r\n    return lower;\r\n  }\r\n  return undefined;\r\n}\r\n\r\nfunction parsePointList(raw: string | null): readonly SvgPoint[] | undefined {\r\n  if (!raw) {\r\n    return undefined;\r\n  }\r\n  const trimmed = raw.trim();\r\n  if (!trimmed) {\r\n    return undefined;\r\n  }\r\n  const numbers: number[] = [];\r\n  for (const token of trimmed.split(/[\\s,]+/)) {\r\n    if (!token) {\r\n      continue;\r\n    }\r\n    const value = Number.parseFloat(token);\r\n    if (!Number.isFinite(value)) {\r\n      return undefined;\r\n    }\r\n    numbers.push(value);\r\n  }\r\n  if (numbers.length % 2 !== 0) {\r\n    return undefined;\r\n  }\r\n  const points: SvgPoint[] = [];\r\n  for (let i = 0; i < numbers.length; i += 2) {\r\n    points.push({ x: numbers[i], y: numbers[i + 1] });\r\n  }\r\n  return points;\r\n}\r\n\r\n/**\r\n * Default registry with all standard SVG element parsers pre-registered.\r\n * \r\n * Users can create their own custom registry or extend this one\r\n * to add support for non-standard elements.\r\n */\r\nexport const defaultParserRegistry = new ParserRegistry();\r\n\r\n// Register all standard SVG element parsers\r\ndefaultParserRegistry.register(\"svg\", parseSvgRoot);\r\ndefaultParserRegistry.register(\"g\", parseGroup);\r\ndefaultParserRegistry.register(\"defs\", parseDefs);\r\ndefaultParserRegistry.register(\"rect\", parseRect);\r\ndefaultParserRegistry.register(\"circle\", parseCircle);\r\ndefaultParserRegistry.register(\"ellipse\", parseEllipse);\r\ndefaultParserRegistry.register(\"line\", parseLine);\r\ndefaultParserRegistry.register(\"path\", parsePath);\r\ndefaultParserRegistry.register(\"polyline\", parsePolyline);\r\ndefaultParserRegistry.register(\"polygon\", parsePolygon);\r\ndefaultParserRegistry.register(\"text\", parseText);\r\ndefaultParserRegistry.register(\"image\", parseImage);\r\ndefaultParserRegistry.register(\"use\", parseUse);\r\ndefaultParserRegistry.register(\"clippath\", parseClipPath);\r\ndefaultParserRegistry.register(\"lineargradient\", parseLinearGradient);\r\ndefaultParserRegistry.register(\"radialgradient\", parseRadialGradient);\r\n\r\n", "// src/html/dom-converter.ts\r\n\r\nimport { type DomEl, type CssRuleEntry } from \"./css/parse-css.js\";\r\nimport { LayoutNode, type LayoutNodeOptions } from \"../dom/node.js\";\r\nimport { ComputedStyle } from \"../css/style.js\";\r\nimport { cloneLineHeight } from \"../css/line-height.js\";\r\nimport { computeStyleForElement } from \"../css/compute-style.js\";\r\nimport { convertImageElement, resolveImageSource, type ConversionContext } from \"./image-converter.js\";\r\nimport { Display, WhiteSpace } from \"../css/enums.js\";\r\nimport { parseSvg } from \"../svg/parser.js\";\nimport type { SvgRootNode } from \"../svg/types.js\";\nimport { ImageService } from \"../image/image-service.js\";\nimport type { ImageInfo } from \"../image/types.js\";\nimport { log } from \"../logging/debug.js\";\nimport { decodeBase64ToUint8Array } from \"../utils/base64.js\";\n\r\nfunction findMeaningfulSibling(start: Node | null, direction: \"previous\" | \"next\"): Node | null {\r\n  let current = start;\r\n  const getNext = direction === \"previous\"\r\n    ? (node: Node) => node.previousSibling\r\n    : (node: Node) => node.nextSibling;\r\n  while (current) {\r\n    if (current.nodeType === current.TEXT_NODE) {\r\n      const content = current.textContent ?? \"\";\r\n      if (content.replace(/\\s+/g, \"\").length > 0) {\r\n        return current;\r\n      }\r\n    } else if (current.nodeType === current.ELEMENT_NODE) {\r\n      const tagName = (current as Element).tagName.toLowerCase();\r\n      if (![\"script\", \"style\", \"meta\", \"link\"].includes(tagName)) {\r\n        return current;\r\n      }\r\n    }\r\n    current = getNext(current);\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction hasMeaningfulPreviousSibling(node: Node): boolean {\r\n  return findMeaningfulSibling(node.previousSibling, \"previous\") !== null;\r\n}\r\n\r\nfunction hasMeaningfulNextSibling(node: Node): boolean {\r\n  return findMeaningfulSibling(node.nextSibling, \"next\") !== null;\r\n}\r\n\r\nfunction isInlineDisplay(display: Display): boolean {\r\n  return (\r\n    display === Display.Inline ||\r\n    display === Display.InlineBlock ||\r\n    display === Display.InlineFlex ||\r\n    display === Display.InlineGrid ||\r\n    display === Display.InlineTable\r\n  );\r\n}\r\n\r\nfunction shouldPreserveCollapsedWhitespace(children: LayoutNode[], style: ComputedStyle): boolean {\r\n  if (style.whiteSpace === WhiteSpace.Pre || style.whiteSpace === WhiteSpace.PreWrap) {\r\n    return true;\r\n  }\r\n  const lastChild = children.length > 0 ? children[children.length - 1] : null;\r\n  return !!lastChild && isInlineDisplay(lastChild.style.display);\r\n}\r\n\r\nfunction extractCssUrl(raw: string): string {\r\n  const trimmed = raw.trim();\r\n  if (!trimmed) {\r\n    return \"\";\r\n  }\r\n  if (trimmed.startsWith(\"url(\") && trimmed.endsWith(\")\")) {\r\n    let inner = trimmed.slice(4, -1).trim();\r\n    if (\r\n      (inner.startsWith(\"'\") && inner.endsWith(\"'\")) ||\r\n      (inner.startsWith(\"\\\"\") && inner.endsWith(\"\\\"\"))\r\n    ) {\r\n      inner = inner.slice(1, -1);\r\n    }\r\n    return inner;\r\n  }\r\n  if (\r\n    (trimmed.startsWith(\"'\") && trimmed.endsWith(\"'\")) ||\r\n    (trimmed.startsWith(\"\\\"\") && trimmed.endsWith(\"\\\"\"))\r\n  ) {\r\n    return trimmed.slice(1, -1);\r\n  }\r\n  return trimmed;\r\n}\r\n\r\nfunction isDataUri(value: string): boolean {\r\n  return /^data:/i.test(value);\r\n}\r\n\r\nfunction isHttpUrl(value: string): boolean {\r\n  return /^https?:\\/\\//i.test(value);\r\n}\r\n\r\nfunction parseSpan(raw: string | null): number | undefined {\r\n  if (!raw) return undefined;\r\n  const parsed = Number.parseInt(raw, 10);\r\n  return Number.isFinite(parsed) && parsed > 0 ? parsed : undefined;\r\n}\r\n\r\nasync function loadBackgroundImage(\n  cssUrl: string,\n  context: ConversionContext,\n): Promise<{ info: ImageInfo; resolvedSrc: string } | null> {\n  const imageService = ImageService.getInstance(context.environment);\n  const resolvedSrc = resolveImageSource(cssUrl, context);\n\r\n  if (isHttpUrl(resolvedSrc)) {\r\n    log('dom-converter', 'warn', `Skipping remote background image (${resolvedSrc}); remote assets are not supported.`);\r\n    return null;\r\n  }\r\n\r\n  try {\r\n    let imageInfo: ImageInfo;\r\n    if (isDataUri(resolvedSrc)) {\n      const match = resolvedSrc.match(/^data:image\\/(.+);base64,(.+)$/);\n      if (!match) {\n        log('dom-converter', 'warn', `Unsupported data URI format for background image: ${cssUrl}`);\n        return null;\n      }\n      const bytes = decodeBase64ToUint8Array(match[2]);\n      const copy = bytes.slice();\n      imageInfo = await imageService.decodeImage(copy.buffer);\n    } else {\n      imageInfo = await imageService.loadImage(resolvedSrc);\n    }\n    return { info: imageInfo, resolvedSrc };\r\n  } catch (error) {\r\n    log('dom-converter', 'warn', `Failed to load background image ${cssUrl}:`, error instanceof Error ? error.message : String(error));\r\n    return null;\r\n  }\r\n}\r\n\r\nasync function hydrateBackgroundImages(style: ComputedStyle, context: ConversionContext): Promise<void> {\r\n  if (!style.backgroundLayers || style.backgroundLayers.length === 0) {\r\n    return;\r\n  }\r\n\r\n  for (const layer of style.backgroundLayers) {\r\n    if (layer.kind !== \"image\") {\r\n      continue;\r\n    }\r\n    if (layer.imageInfo) {\r\n      continue;\r\n    }\r\n    const cssUrl = extractCssUrl(layer.url);\r\n    if (!cssUrl) {\r\n      continue;\r\n    }\r\n\r\n    const loaded = await loadBackgroundImage(cssUrl, context);\r\n    if (!loaded) {\r\n      continue;\r\n    }\r\n    layer.originalUrl = cssUrl;\r\n    layer.resolvedUrl = loaded.resolvedSrc;\r\n    layer.imageInfo = loaded.info;\r\n  }\r\n}\r\n\r\nexport async function convertDomNode(\r\n  node: Node,\r\n  cssRules: CssRuleEntry[],\r\n  parentStyle: ComputedStyle,\r\n  context: ConversionContext,\r\n): Promise<LayoutNode | null> {\r\n  log('dom-converter', 'debug', `convertDomNode - entering function for node type: ${node.nodeType}, tagName: ${(node as any).tagName || 'text node'}`);\r\n  if (node.nodeType === node.TEXT_NODE) {\r\n    const raw = node.textContent ?? \"\";\r\n    const collapsed = raw.replace(/\\s+/g, \" \").normalize(\"NFC\");\r\n    const trimmed = collapsed.trim();\r\n\r\n    const hasPrev = hasMeaningfulPreviousSibling(node);\r\n    const hasNext = hasMeaningfulNextSibling(node);\r\n\r\n    if (trimmed.length === 0) {\r\n      const keepSpace = hasPrev && hasNext;\r\n      if (!keepSpace) {\r\n        return null;\r\n      }\r\n      log('dom-converter', 'debug', \"convertDomNode - processing text node: (single space)\");\r\n      const textStyle = new ComputedStyle({\r\n        display: Display.Inline,\r\n        color: parentStyle.color,\r\n        fontSize: parentStyle.fontSize,\r\n        lineHeight: cloneLineHeight(parentStyle.lineHeight),\r\n        fontFamily: parentStyle.fontFamily,\r\n        fontWeight: parentStyle.fontWeight,\r\n        fontStyle: parentStyle.fontStyle,\r\n        letterSpacing: parentStyle.letterSpacing,\r\n        wordSpacing: parentStyle.wordSpacing,\r\n        textDecorationLine: parentStyle.textDecorationLine,\r\n        textDecorationColor: parentStyle.textDecorationColor,\r\n        textDecorationStyle: parentStyle.textDecorationStyle,\r\n        textTransform: parentStyle.textTransform,\r\n        transform: parentStyle.transform as any,\r\n        textShadows: parentStyle.textShadows,\r\n      });\r\n      return new LayoutNode(textStyle, [], {\r\n        textContent: \" \",\r\n        customData: {\r\n          preserveLeadingSpace: true,\r\n          preserveTrailingSpace: true,\r\n        },\r\n      });\r\n    }\r\n\r\n    let text = trimmed;\r\n    const preserveLeading = collapsed.startsWith(\" \") && hasPrev;\r\n    const preserveTrailing = collapsed.endsWith(\" \") && hasNext;\r\n\r\n    if (preserveLeading) {\r\n      text = \" \" + text;\r\n    }\r\n    if (preserveTrailing) {\r\n      text = text + \" \";\r\n    }\r\n\r\n    log('dom-converter', 'debug', \"convertDomNode - processing text node:\", text.substring(0, 50) + (text.length > 50 ? '...' : ''));\r\n    const textStyle = new ComputedStyle({\r\n      display: Display.Inline,\r\n      color: parentStyle.color,\r\n      fontSize: parentStyle.fontSize,\r\n      lineHeight: cloneLineHeight(parentStyle.lineHeight),\r\n      fontFamily: parentStyle.fontFamily,\r\n      fontWeight: parentStyle.fontWeight,\r\n      fontStyle: parentStyle.fontStyle,\r\n      letterSpacing: parentStyle.letterSpacing,\r\n      wordSpacing: parentStyle.wordSpacing,\r\n      textDecorationLine: parentStyle.textDecorationLine,\r\n      textDecorationColor: parentStyle.textDecorationColor,\r\n      textDecorationStyle: parentStyle.textDecorationStyle,\r\n      textTransform: parentStyle.textTransform,\r\n      transform: parentStyle.transform as any,\r\n      textShadows: parentStyle.textShadows,\r\n    });\r\n    return new LayoutNode(textStyle, [], {\r\n      textContent: text,\r\n      customData: {\r\n        preserveLeadingSpace: preserveLeading,\r\n        preserveTrailingSpace: preserveTrailing,\r\n      },\r\n    });\r\n  }\r\n\r\n  if (node.nodeType !== node.ELEMENT_NODE) return null;\r\n\r\n  const element = node as DomEl;\r\n  const tagName = element.tagName.toLowerCase();\r\n  log('dom-converter', 'debug', `convertDomNode - processing element: ${tagName}, with style attr: ${element.getAttribute(\"style\")}`);\r\n  if (tagName === \"script\" || tagName === \"style\") return null;\r\n\r\n  // Handle image elements\r\n  if (tagName === \"img\") {\r\n    return await convertImageElement(element, cssRules, parentStyle, context);\r\n  }\r\n\r\n  if (tagName === \"svg\") {\r\n    const ownStyle = computeStyleForElement(element, cssRules, parentStyle, context.units, context.rootFontSize);\r\n    log('dom-converter', 'debug', \"convertDomNode - computed style backgroundLayers:\", ownStyle.backgroundLayers);\r\n    const svgRoot = parseSvg(element, { warn: (message) => log('svg-parser', 'warn', message) });\r\n    if (!svgRoot) {\r\n      return new LayoutNode(ownStyle, [], { tagName });\r\n    }\r\n    const intrinsic = resolveSvgIntrinsicSize(svgRoot, element);\r\n    return new LayoutNode(ownStyle, [], {\r\n      tagName,\r\n      intrinsicInlineSize: intrinsic.width,\r\n      intrinsicBlockSize: intrinsic.height,\r\n      customData: {\r\n        svg: {\r\n          root: svgRoot,\r\n          intrinsicWidth: intrinsic.width,\r\n          intrinsicHeight: intrinsic.height,\r\n          // Propagate resource roots so SVG rendering can resolve image hrefs\r\n          resourceBaseDir: context && (context as any).resourceBaseDir,\r\n          assetRootDir: context && (context as any).assetRootDir,\r\n        },\r\n      },\r\n    });\r\n  }\r\n\r\n  if (tagName === \"br\") {\r\n    const textStyle = new ComputedStyle({\r\n      display: Display.Inline,\r\n      color: parentStyle.color,\r\n      fontSize: parentStyle.fontSize,\r\n      lineHeight: cloneLineHeight(parentStyle.lineHeight),\r\n      fontFamily: parentStyle.fontFamily,\r\n      fontWeight: parentStyle.fontWeight,\r\n      fontStyle: parentStyle.fontStyle,\r\n      textTransform: parentStyle.textTransform,\r\n    });\r\n    return new LayoutNode(textStyle, [], { textContent: \"\\n\" });\r\n  }\r\n\r\n  // \u2705 Coalescing de #text\r\n  const ownStyle = computeStyleForElement(element, cssRules, parentStyle, context.units, context.rootFontSize);\r\n  await hydrateBackgroundImages(ownStyle, context);\r\n  log('dom-converter', 'debug', \"convertDomNode - computed style backgroundLayers:\", ownStyle.backgroundLayers);\r\n  \r\n  // Log if this is the div element that should have the gradient\r\n  if (element.tagName.toLowerCase() === 'div' && element.getAttribute(\"style\")?.includes('linear-gradient')) {\r\n    log('dom-converter', 'debug', \"Found div with gradient style!\");\r\n  }\r\n  const layoutChildren: LayoutNode[] = [];\r\n  let textBuf = \"\";\r\n\r\n  for (const child of Array.from(element.childNodes) as Node[]) {\r\n    if (child.nodeType === child.TEXT_NODE) {\r\n      textBuf += child.textContent ?? \"\";\r\n      continue;\r\n    }\r\n    if (textBuf) {\r\n      let normalized = textBuf.replace(/\\s+/g, \" \").normalize(\"NFC\");\r\n      if (normalized.trim().length === 0) {\r\n        normalized = shouldPreserveCollapsedWhitespace(layoutChildren, ownStyle) ? \" \" : \"\";\r\n      }\r\n      if (normalized) {\r\n        const preserveLeading = normalized.startsWith(\" \");\r\n        const preserveTrailing = normalized.endsWith(\" \");\r\n        layoutChildren.push(new LayoutNode(new ComputedStyle({\r\n          display: Display.Inline,\r\n          color: ownStyle.color,\r\n          fontSize: ownStyle.fontSize,\r\n          lineHeight: cloneLineHeight(ownStyle.lineHeight),\r\n          fontFamily: ownStyle.fontFamily,\r\n          fontWeight: ownStyle.fontWeight,\r\n          fontStyle: ownStyle.fontStyle,\r\n          letterSpacing: ownStyle.letterSpacing,\r\n          wordSpacing: ownStyle.wordSpacing,\r\n          overflowWrap: ownStyle.overflowWrap,\r\n          whiteSpace: ownStyle.whiteSpace,\r\n          textDecorationLine: ownStyle.textDecorationLine,\r\n          textDecorationColor: ownStyle.textDecorationColor,\r\n          textDecorationStyle: ownStyle.textDecorationStyle,\r\n          textTransform: ownStyle.textTransform,\r\n          transform: ownStyle.transform as any,\r\n          textShadows: ownStyle.textShadows,\r\n        }), [], {\r\n          textContent: normalized,\r\n          customData: {\r\n            preserveLeadingSpace: preserveLeading,\r\n            preserveTrailingSpace: preserveTrailing,\r\n          },\r\n        }));\r\n      }\r\n      textBuf = \"\";\r\n    }\r\n    const sub = await convertDomNode(child, cssRules, ownStyle, context);\r\n    if (sub) layoutChildren.push(sub);\r\n  }\r\n  if (textBuf) {\r\n    let normalized = textBuf.replace(/\\s+/g, \" \").normalize(\"NFC\");\r\n    if (normalized.trim().length === 0) {\r\n      normalized = shouldPreserveCollapsedWhitespace(layoutChildren, ownStyle) ? \" \" : \"\";\r\n    }\r\n    if (normalized) {\r\n      const preserveLeading = normalized.startsWith(\" \");\r\n      const preserveTrailing = normalized.endsWith(\" \");\r\n      layoutChildren.push(new LayoutNode(new ComputedStyle({\r\n        display: Display.Inline,\r\n        color: ownStyle.color,\r\n        fontSize: ownStyle.fontSize,\r\n        lineHeight: cloneLineHeight(ownStyle.lineHeight),\r\n        fontFamily: ownStyle.fontFamily,\r\n        fontWeight: ownStyle.fontWeight,\r\n        fontStyle: ownStyle.fontStyle,\r\n        letterSpacing: ownStyle.letterSpacing,\r\n        wordSpacing: ownStyle.wordSpacing,\r\n        overflowWrap: ownStyle.overflowWrap,\r\n        whiteSpace: ownStyle.whiteSpace,\r\n        textDecorationLine: ownStyle.textDecorationLine,\r\n        textDecorationColor: ownStyle.textDecorationColor,\r\n        textDecorationStyle: ownStyle.textDecorationStyle,\r\n        textTransform: ownStyle.textTransform,\r\n        transform: ownStyle.transform as any,\r\n        textShadows: ownStyle.textShadows,\r\n      }), [], {\r\n        textContent: normalized,\r\n        customData: {\r\n          preserveLeadingSpace: preserveLeading,\r\n          preserveTrailingSpace: preserveTrailing,\r\n        },\r\n      }));\r\n    }\r\n  }\r\n\r\n  // Preserve the original HTML ID\r\n  const id = element.getAttribute(\"id\");\r\n  const options: LayoutNodeOptions = { tagName };\r\n  if (tagName === \"td\" || tagName === \"th\") {\r\n    options.tableColSpan = parseSpan(element.getAttribute(\"colspan\")) ?? 1;\r\n    options.tableRowSpan = parseSpan(element.getAttribute(\"rowspan\")) ?? 1;\r\n  }\r\n  if (id) {\r\n    options.customData = { ...options.customData, id };\r\n  }\r\n  return new LayoutNode(ownStyle, layoutChildren, options);\r\n}\r\n\r\nfunction resolveSvgIntrinsicSize(svg: SvgRootNode, element: Element): { width: number; height: number } {\r\n  let width = svg.width;\r\n  let height = svg.height;\r\n  if (svg.viewBox) {\r\n    if (!width || width <= 0) {\r\n      width = svg.viewBox.width;\r\n    }\r\n    if (!height || height <= 0) {\r\n      height = svg.viewBox.height;\r\n    }\r\n  }\r\n  if (!width || width <= 0) {\r\n    width = attributeToNumber(element.getAttribute(\"width\")) ?? 100;\r\n  }\r\n  if (!height || height <= 0) {\r\n    height = attributeToNumber(element.getAttribute(\"height\")) ?? width;\r\n  }\r\n  return {\r\n    width: Number.isFinite(width) && width > 0 ? width : 100,\r\n    height: Number.isFinite(height) && height > 0 ? height : 100,\r\n  };\r\n}\r\n\r\nfunction attributeToNumber(raw: string | null): number | undefined {\r\n  if (!raw) {\r\n    return undefined;\r\n  }\r\n  const value = Number.parseFloat(raw);\r\n  return Number.isFinite(value) ? value : undefined;\r\n}\r\n", "// src/render/offset.ts\r\n\r\nimport { type Rect, type RenderBox, type Background } from \"../pdf/types.js\";\nimport { log } from \"../logging/debug.js\";\nimport type { PageMarginsPx } from \"../units/page-utils.js\";\n\r\nexport function offsetRect(rect: Rect | null | undefined, dx: number, dy: number): void {\r\n  if (!rect) return;\r\n  rect.x += dx;\r\n  rect.y += dy;\r\n}\r\n\r\nfunction offsetBackground(background: Background | undefined, dx: number, dy: number): void {\r\n  if (!background) {\r\n    return;\r\n  }\r\n  if (background.image) {\r\n    offsetRect(background.image.rect, dx, dy);\r\n    offsetRect(background.image.originRect, dx, dy);\r\n  }\r\n  if (background.gradient) {\r\n    offsetRect(background.gradient.rect, dx, dy);\r\n    offsetRect(background.gradient.originRect, dx, dy);\r\n  }\r\n}\r\n\r\nexport function offsetRenderTree(root: RenderBox, dx: number, dy: number, _debug: boolean): void {\n  const stack: RenderBox[] = [root];\n  while (stack.length > 0) {\n    const box = stack.pop()!;\n    log(\"layout\",\"trace\",'offset render tree box', {\r\n      tagName: box.tagName,\r\n      textContent: box.textContent,\r\n      x: box.contentBox.x,\r\n      y: box.contentBox.y,\r\n      width: box.contentBox.width,\r\n      height: box.contentBox.height,\r\n    });\r\n    offsetRect(box.contentBox, dx, dy);\r\n    offsetRect(box.paddingBox, dx, dy);\n    offsetRect(box.borderBox, dx, dy);\n    offsetRect(box.visualOverflow, dx, dy);\n    if (box.clipPath && box.clipPath.points) {\n      for (const point of box.clipPath.points) {\n        point.x += dx;\n        point.y += dy;\n      }\n    }\n    if (box.markerRect) {\r\n      offsetRect(box.markerRect, dx, dy);\r\n    }\r\n    offsetBackground(box.background, dx, dy);\r\n    for (const link of box.links) {\r\n      offsetRect(link.rect, dx, dy);\r\n    }\r\n    for (const run of box.textRuns) {\r\n      if (run.lineMatrix) {\r\n        run.lineMatrix.e += dx;\r\n        run.lineMatrix.f += dy;\r\n      }\r\n    }\r\n    for (const child of box.children) {\r\n      stack.push(child);\r\n    }\r\n  }\r\n}\r\n\r\nexport interface PageVerticalMarginsOptions {\r\n  /** Page height in pixels */\r\n  pageHeight: number;\r\n  /** Page margins */\r\n  margins: PageMarginsPx;\r\n  /** Header height in pixels (content will be pushed down by this amount) */\r\n  headerHeightPx?: number;\r\n  /** Footer height in pixels (reduces available content area) */\r\n  footerHeightPx?: number;\r\n}\r\n\r\nexport function applyPageVerticalMargins(root: RenderBox, pageHeight: number, margins: PageMarginsPx): void {\r\n  applyPageVerticalMarginsWithHf(root, { pageHeight, margins });\r\n}\r\n\r\n/**\r\n * Applies vertical margins and header/footer offsets to the render tree.\r\n * This implements Word/mPDF-like behavior where:\r\n * - Content starts below the top margin + header height\r\n * - Content ends above the bottom margin + footer height\r\n * - Each page has the header/footer space reserved\r\n */\r\nexport function applyPageVerticalMarginsWithHf(\r\n  root: RenderBox,\r\n  options: PageVerticalMarginsOptions,\r\n): void {\r\n  const { pageHeight, margins, headerHeightPx = 0, footerHeightPx = 0 } = options;\r\n\r\n  const safePageHeight = Number.isFinite(pageHeight) && pageHeight > 0 ? pageHeight : 1;\r\n  const marginTop = Number.isFinite(margins.top) && margins.top > 0 ? margins.top : 0;\r\n  const marginBottom = Number.isFinite(margins.bottom) && margins.bottom > 0 ? margins.bottom : 0;\r\n\r\n  // Effective top offset includes margin AND header\r\n  const effectiveTop = marginTop + headerHeightPx;\r\n  // Effective bottom includes margin AND footer\r\n  const effectiveBottom = marginBottom + footerHeightPx;\r\n  const totalReserved = effectiveTop + effectiveBottom;\r\n\r\n  // Usable height for content per page\r\n  const usableHeight = safePageHeight - totalReserved > 0 ? safePageHeight - totalReserved : safePageHeight;\r\n\r\n  const mapY = (value: number): number => {\r\n    if (!Number.isFinite(value)) {\r\n      return value;\r\n    }\r\n    if (value <= 0) {\r\n      return value + effectiveTop;\r\n    }\r\n    const pageIndex = Math.floor(value / usableHeight);\r\n    const remainder = value - pageIndex * usableHeight;\r\n    return pageIndex * safePageHeight + effectiveTop + remainder;\r\n  };\r\n\r\n  const adjustRect = (rect: Rect | null | undefined): void => {\n    if (!rect) {\n      return;\n    }\n    rect.y = mapY(rect.y);\n  };\n\r\n  const adjustBackground = (background: Background | undefined): void => {\r\n    if (!background) {\r\n      return;\r\n    }\r\n    if (background.image) {\r\n      adjustRect(background.image.rect);\r\n      adjustRect(background.image.originRect);\r\n    }\r\n    if (background.gradient) {\r\n      adjustRect(background.gradient.rect);\r\n      adjustRect(background.gradient.originRect);\r\n    }\r\n  };\r\n\r\n  const stack: RenderBox[] = [root];\n  while (stack.length > 0) {\n    const box = stack.pop()!;\n    adjustRect(box.contentBox);\n    adjustRect(box.paddingBox);\n    adjustRect(box.borderBox);\n    adjustRect(box.visualOverflow);\n    if (box.clipPath && box.clipPath.points) {\n      for (const point of box.clipPath.points) {\n        point.y = mapY(point.y);\n      }\n    }\n    if (box.markerRect) {\r\n      adjustRect(box.markerRect);\r\n    }\r\n    adjustBackground(box.background);\r\n    for (const link of box.links) {\r\n      adjustRect(link.rect);\r\n    }\r\n    for (const run of box.textRuns) {\r\n      if (run.lineMatrix) {\r\n        run.lineMatrix.f = mapY(run.lineMatrix.f);\r\n      }\r\n    }\r\n    for (const child of box.children) {\r\n      stack.push(child);\r\n    }\r\n  }\r\n}\r\n", "import type { FontResolver, UnifiedFont } from \"../fonts/types.js\";\r\nimport type { FontRegistry, FontResource } from \"../pdf/font/font-registry.js\";\r\n\r\n/**\r\n * Adapter that implements FontResolver using FontRegistry.\r\n * Allows the layout system to resolve fonts during render tree building.\r\n */\r\nexport class FontRegistryResolver implements FontResolver {\r\n    private readonly rawTableAccessors = new WeakMap<FontResource, (tag: string) => Uint8Array | null>();\r\n\r\n    constructor(private readonly fontRegistry: FontRegistry) { }\r\n\r\n    async resolve(family: string, weight?: number, style?: string): Promise<UnifiedFont> {\r\n        const fontResource = await this.fontRegistry.ensureFontResource(family, weight, style);\r\n\r\n        return this.toUnifiedFont(fontResource, family, weight, style) ?? this.createFallbackFont(family, weight, style);\r\n    }\r\n\r\n    resolveSync(family: string, weight?: number, style?: string): UnifiedFont | undefined {\r\n        const fontResource = this.fontRegistry.ensureFontResourceSync(family, weight, style);\r\n\r\n        return this.toUnifiedFont(fontResource, family, weight, style);\r\n    }\r\n\r\n    private createFallbackFont(family: string, weight?: number, style?: string): UnifiedFont {\r\n        return {\r\n            metrics: {\r\n                metrics: {\r\n                    unitsPerEm: 1000,\r\n                    ascender: 800,\r\n                    descender: -200,\r\n                    lineGap: 0,\r\n                    capHeight: 700,\r\n                    xHeight: 500,\r\n                },\r\n                glyphMetrics: new Map([\r\n                    [0, { advanceWidth: 500, leftSideBearing: 0 }],\r\n                ]),\r\n                cmap: {\r\n                    getGlyphId: () => 0,\r\n                    hasCodePoint: () => false,\r\n                    unicodeMap: new Map(),\r\n                },\r\n            },\r\n            program: {\r\n                sourceFormat: \"ttf\",\r\n                unitsPerEm: 1000,\r\n                glyphCount: 1,\r\n            },\r\n            css: {\r\n                family,\r\n                weight: weight ?? 400,\r\n                style: (style as 'normal' | 'italic') ?? 'normal',\r\n            },\r\n        };\r\n    }\r\n\r\n    private toUnifiedFont(fontResource: FontResource, family: string, weight?: number, style?: string): UnifiedFont | undefined {\r\n        const metrics = fontResource.metrics;\r\n        if (!metrics) return undefined;\r\n\r\n        const getRawTableData = this.lookupRawTableAccessor(fontResource);\r\n        return {\r\n            metrics: {\r\n                metrics: metrics.metrics,\r\n                glyphMetrics: metrics.glyphMetrics,\r\n                cmap: metrics.cmap,\r\n                headBBox: metrics.headBBox,\r\n                kerning: metrics.kerning,\r\n            },\r\n            program: {\r\n                sourceFormat: \"ttf\",\r\n                unitsPerEm: metrics.metrics.unitsPerEm,\r\n                glyphCount: metrics.glyphMetrics.size,\r\n                getGlyphOutline: metrics.getGlyphOutline,\r\n                getRawTableData,\r\n            },\r\n            css: {\r\n                family,\r\n                weight: weight ?? 400,\r\n                style: (style as 'normal' | 'italic') ?? 'normal',\r\n            },\r\n        };\r\n    }\r\n\r\n    private lookupRawTableAccessor(fontResource: FontResource): ((tag: string) => Uint8Array | null) | undefined {\r\n        const rawBytes: Uint8Array | undefined = fontResource.embedded?.subset;\r\n        if (!rawBytes || rawBytes.byteLength < 12) {\r\n            return undefined;\r\n        }\r\n\r\n        const cached = this.rawTableAccessors.get(fontResource);\r\n        if (cached) return cached;\r\n\r\n        const accessor = createRawTableAccessor(rawBytes);\r\n        this.rawTableAccessors.set(fontResource, accessor);\r\n        return accessor;\r\n    }\r\n}\r\n\r\nfunction createRawTableAccessor(ttfBytes: Uint8Array): (tag: string) => Uint8Array | null {\r\n    const directory = parseTtfTableDirectory(ttfBytes);\r\n    return (tag: string) => directory.get(tag) ?? null;\r\n}\r\n\r\nfunction parseTtfTableDirectory(ttfBytes: Uint8Array): Map<string, Uint8Array> {\r\n    const tables = new Map<string, Uint8Array>();\r\n    if (ttfBytes.byteLength < 12) return tables;\r\n\r\n    const view = new DataView(ttfBytes.buffer, ttfBytes.byteOffset, ttfBytes.byteLength);\r\n    const numTables = view.getUint16(4, false);\r\n\r\n    for (let i = 0; i < numTables; i++) {\r\n        const entryOffset = 12 + i * 16;\r\n        if (entryOffset + 16 > ttfBytes.byteLength) break;\r\n\r\n        const tag = String.fromCharCode(\r\n            ttfBytes[entryOffset],\r\n            ttfBytes[entryOffset + 1],\r\n            ttfBytes[entryOffset + 2],\r\n            ttfBytes[entryOffset + 3]\r\n        );\r\n\r\n        const offset = view.getUint32(entryOffset + 8, false);\r\n        const length = view.getUint32(entryOffset + 12, false);\r\n\r\n        if (offset + length > ttfBytes.byteLength) continue;\r\n        tables.set(tag, ttfBytes.subarray(offset, offset + length));\r\n    }\r\n\r\n    return tables;\r\n}\r\n", "import type { Radius, Rect, RGBA, ImageRef } from \"../types.js\";\n\nfunction clampUnit(value: number): number {\n  if (!Number.isFinite(value)) return 0;\n  if (value <= 0) return 0;\n  if (value >= 1) return 1;\n  return value;\n}\n\nfunction ceilPositive(value: number): number {\n  if (!Number.isFinite(value) || value <= 0) return 0;\n  return Math.ceil(value);\n}\n\nfunction inflateRect(rect: Rect, amount: number): Rect {\n  const width = rect.width + amount * 2;\n  const height = rect.height + amount * 2;\n  if (width <= 0 || height <= 0) {\n    return { x: rect.x + rect.width / 2, y: rect.y + rect.height / 2, width: 0, height: 0 };\n  }\n  return { x: rect.x - amount, y: rect.y - amount, width, height };\n}\n\nfunction max2(a: number, b: number): number { return a > b ? a : b; }\n\nfunction pointInRoundedRect(px: number, py: number, rect: Rect, radius: Radius): boolean {\n  if (px < rect.x || py < rect.y || px > rect.x + rect.width || py > rect.y + rect.height) {\n    return false;\n  }\n\n  const leftMargin = max2(radius.topLeft.x, radius.bottomLeft.x);\n  const rightMargin = max2(radius.topRight.x, radius.bottomRight.x);\n  const topMargin = max2(radius.topLeft.y, radius.topRight.y);\n  const bottomMargin = max2(radius.bottomLeft.y, radius.bottomRight.y);\n\n  // Horizontal and vertical straight strips\n  if (px >= rect.x + leftMargin && px <= rect.x + rect.width - rightMargin) return true;\n  if (py >= rect.y + topMargin && py <= rect.y + rect.height - bottomMargin) return true;\n\n  // Corner tests (elliptical)\n  // Top-left\n  if (px < rect.x + radius.topLeft.x && py < rect.y + radius.topLeft.y && radius.topLeft.x > 0 && radius.topLeft.y > 0) {\n    const cx = rect.x + radius.topLeft.x;\n    const cy = rect.y + radius.topLeft.y;\n    const dx = (px - cx) / radius.topLeft.x;\n    const dy = (py - cy) / radius.topLeft.y;\n    return dx * dx + dy * dy <= 1;\n  }\n  // Top-right\n  if (px > rect.x + rect.width - radius.topRight.x && py < rect.y + radius.topRight.y && radius.topRight.x > 0 && radius.topRight.y > 0) {\n    const cx = rect.x + rect.width - radius.topRight.x;\n    const cy = rect.y + radius.topRight.y;\n    const dx = (px - cx) / radius.topRight.x;\n    const dy = (py - cy) / radius.topRight.y;\n    return dx * dx + dy * dy <= 1;\n  }\n  // Bottom-right\n  if (px > rect.x + rect.width - radius.bottomRight.x && py > rect.y + rect.height - radius.bottomRight.y && radius.bottomRight.x > 0 && radius.bottomRight.y > 0) {\n    const cx = rect.x + rect.width - radius.bottomRight.x;\n    const cy = rect.y + rect.height - radius.bottomRight.y;\n    const dx = (px - cx) / radius.bottomRight.x;\n    const dy = (py - cy) / radius.bottomRight.y;\n    return dx * dx + dy * dy <= 1;\n  }\n  // Bottom-left\n  if (px < rect.x + radius.bottomLeft.x && py > rect.y + rect.height - radius.bottomLeft.y && radius.bottomLeft.x > 0 && radius.bottomLeft.y > 0) {\n    const cx = rect.x + radius.bottomLeft.x;\n    const cy = rect.y + rect.height - radius.bottomLeft.y;\n    const dx = (px - cx) / radius.bottomLeft.x;\n    const dy = (py - cy) / radius.bottomLeft.y;\n    return dx * dx + dy * dy <= 1;\n  }\n  return false;\n}\n\nfunction buildGaussianKernel(sigma: number): { kernel: Float32Array; radius: number; sum: number } {\n  const s = sigma > 0 ? sigma : 0.0001;\n  const radius = Math.max(1, Math.ceil(s * 3));\n  const size = radius * 2 + 1;\n  const kernel = new Float32Array(size);\n  const coeff = 1 / (Math.sqrt(2 * Math.PI) * s);\n  const twoSigmaSq = 2 * s * s;\n  let sum = 0;\n  for (let i = -radius; i <= radius; i++) {\n    const w = coeff * Math.exp(-(i * i) / twoSigmaSq);\n    kernel[i + radius] = w;\n    sum += w;\n  }\n  return { kernel, radius, sum };\n}\n\nfunction blurAlpha(alpha: Uint8Array, width: number, height: number, sigma: number): Uint8Array {\n  if (sigma <= 0) return alpha;\n  const { kernel, radius, sum } = buildGaussianKernel(sigma);\n  const tmp = new Float32Array(width * height);\n  // Horizontal pass\n  for (let y = 0; y < height; y++) {\n    const rowOffset = y * width;\n    for (let x = 0; x < width; x++) {\n      let acc = 0;\n      let wsum = 0;\n      for (let k = -radius; k <= radius; k++) {\n        const xi = Math.min(width - 1, Math.max(0, x + k));\n        const w = kernel[k + radius];\n        acc += alpha[rowOffset + xi] * w;\n        wsum += w;\n      }\n      tmp[rowOffset + x] = acc / (wsum || sum);\n    }\n  }\n  // Vertical pass\n  const out = new Uint8Array(width * height);\n  for (let x = 0; x < width; x++) {\n    for (let y = 0; y < height; y++) {\n      let acc = 0;\n      let wsum = 0;\n      for (let k = -radius; k <= radius; k++) {\n        const yi = Math.min(height - 1, Math.max(0, y + k));\n        const w = kernel[k + radius];\n        acc += tmp[yi * width + x] * w;\n        wsum += w;\n      }\n      const v = acc / (wsum || sum);\n      out[y * width + x] = v < 0 ? 0 : v > 255 ? 255 : v;\n    }\n  }\n  return out;\n}\n\nexport interface ShadowRasterResult {\n  readonly image: ImageRef;\n  readonly drawRect: Rect; // where to place the image in page coordinates (px)\n}\n\nexport function rasterizeDropShadowForRect(\n  baseRect: Rect,\n  baseRadius: Radius,\n  color: RGBA,\n  blur: number,\n  spread: number,\n): ShadowRasterResult | null {\n  const blurPx = Math.max(0, blur);\n  const shapeRect: Rect = inflateRect(baseRect, spread);\n  const shapeRadius: Radius = adjustRadius(baseRadius, spread);\n  const outRect: Rect = inflateRect(shapeRect, blurPx);\n  const width = ceilPositive(outRect.width);\n  const height = ceilPositive(outRect.height);\n  if (width === 0 || height === 0) {\n    return null;\n  }\n\n  // Build alpha mask for the unblurred rounded rectangle (shapeRect within outRect)\n  const alpha = new Uint8Array(width * height);\n  const shapeLocal: Rect = { x: shapeRect.x - outRect.x, y: shapeRect.y - outRect.y, width: shapeRect.width, height: shapeRect.height };\n\n  for (let y = 0; y < height; y++) {\n    const py = y + 0.5; // pixel center\n    for (let x = 0; x < width; x++) {\n      const px = x + 0.5;\n      const inside = pointInRoundedRect(px, py, shapeLocal, shapeRadius);\n      alpha[y * width + x] = inside ? 255 : 0;\n    }\n  }\n\n  const sigma = blurPx > 0 ? Math.max(0.5, blurPx / 2) : 0;\n  const blurred = blurAlpha(alpha, width, height, sigma);\n\n  // Compose RGBA data with straight alpha (non-premultiplied RGB)\n  // sRGB compensation: push base color slightly towards display sRGB to better match browser compositing\n  const [r, g, b] = compensateSrgbColor(color.r, color.g, color.b);\n  const aMul = clampUnit(color.a ?? 1);\n  const data = new Uint8Array(width * height * 4);\n  let di = 0;\n  for (let i = 0; i < blurred.length; i++) {\n    data[di++] = r;\n    data[di++] = g;\n    data[di++] = b;\n    const a = Math.round(blurred[i] * aMul);\n    data[di++] = a < 0 ? 0 : a > 255 ? 255 : a;\n  }\n\n  const image: ImageRef = {\n    src: `internal:shadow:${Math.random().toString(36).slice(2)}`,\n    width,\n    height,\n    format: \"png\",\n    channels: 4,\n    bitsPerComponent: 8,\n    data: data.buffer,\n  };\n\n  return { image, drawRect: outRect };\n}\n\nfunction adjustRadius(radius: Radius, delta: number): Radius {\n  const clampNN = (v: number) => (Number.isFinite(v) && v > 0 ? v : 0);\n  return {\n    topLeft: { x: clampNN(radius.topLeft.x + delta), y: clampNN(radius.topLeft.y + delta) },\n    topRight: { x: clampNN(radius.topRight.x + delta), y: clampNN(radius.topRight.y + delta) },\n    bottomRight: { x: clampNN(radius.bottomRight.x + delta), y: clampNN(radius.bottomRight.y + delta) },\n    bottomLeft: { x: clampNN(radius.bottomLeft.x + delta), y: clampNN(radius.bottomLeft.y + delta) },\n  };\n}\n\nfunction srgbToLinearByte(c: number): number {\n  const cs = Math.min(1, Math.max(0, c > 1 ? c / 255 : c));\n  const lin = cs <= 0.04045 ? cs / 12.92 : Math.pow((cs + 0.055) / 1.055, 2.4);\n  return lin * 255;\n}\n\nfunction linearToSrgbByte(c: number): number {\n  const cl = Math.min(1, Math.max(0, c > 1 ? c / 255 : c));\n  const srgb = cl <= 0.0031308 ? 12.92 * cl : 1.055 * Math.pow(cl, 1 / 2.4) - 0.055;\n  return Math.round(Math.min(255, Math.max(0, srgb * 255)));\n}\n\n// Simple compensation to reduce perceived desaturation in some PDF viewers\nfunction compensateSrgbColor(rIn: number, gIn: number, bIn: number): [number, number, number] {\n  // Convert to linear, nudge saturation, convert back to sRGB\n  const rl = srgbToLinearByte(rIn) / 255;\n  const gl = srgbToLinearByte(gIn) / 255;\n  const bl = srgbToLinearByte(bIn) / 255;\n  const max = Math.max(rl, gl, bl);\n  const min = Math.min(rl, gl, bl);\n  const mid = (rl + gl + bl) / 3;\n  const sat = max - min;\n  const boosted = Math.min(1, sat * 1.08); // small boost only\n  const scale = sat > 0 ? boosted / sat : 1;\n  const r = mid + (rl - mid) * scale;\n  const g = mid + (gl - mid) * scale;\n  const b = mid + (bl - mid) * scale;\n  return [linearToSrgbByte(r), linearToSrgbByte(g), linearToSrgbByte(b)];\n}\n", "import type { Radius } from \"../types.js\";\n\nexport function cloneRadius(radius: Radius): Radius {\n  return {\n    topLeft: { x: radius.topLeft.x, y: radius.topLeft.y },\n    topRight: { x: radius.topRight.x, y: radius.topRight.y },\n    bottomRight: { x: radius.bottomRight.x, y: radius.bottomRight.y },\n    bottomLeft: { x: radius.bottomLeft.x, y: radius.bottomLeft.y },\n  };\n}\n\nexport function shrinkRadius(radii: Radius, top: number, right: number, bottom: number, left: number): Radius {\n  return {\n    topLeft: {\n      x: clampRadiusComponent(radii.topLeft.x - top),\n      y: clampRadiusComponent(radii.topLeft.y - left),\n    },\n    topRight: {\n      x: clampRadiusComponent(radii.topRight.x - top),\n      y: clampRadiusComponent(radii.topRight.y - right),\n    },\n    bottomRight: {\n      x: clampRadiusComponent(radii.bottomRight.x - bottom),\n      y: clampRadiusComponent(radii.bottomRight.y - right),\n    },\n    bottomLeft: {\n      x: clampRadiusComponent(radii.bottomLeft.x - bottom),\n      y: clampRadiusComponent(radii.bottomLeft.y - left),\n    },\n  };\n}\n\nexport function adjustRadius(radius: Radius, delta: number): Radius {\n  const result = cloneRadius(radius);\n  result.topLeft.x = clampNonNegative(result.topLeft.x + delta);\n  result.topLeft.y = clampNonNegative(result.topLeft.y + delta);\n  result.topRight.x = clampNonNegative(result.topRight.x + delta);\n  result.topRight.y = clampNonNegative(result.topRight.y + delta);\n  result.bottomRight.x = clampNonNegative(result.bottomRight.x + delta);\n  result.bottomRight.y = clampNonNegative(result.bottomRight.y + delta);\n  result.bottomLeft.x = clampNonNegative(result.bottomLeft.x + delta);\n  result.bottomLeft.y = clampNonNegative(result.bottomLeft.y + delta);\n  return result;\n}\n\nexport function clampRadiusComponent(value: number): number {\n  if (!Number.isFinite(value)) {\n    return 0;\n  }\n  return value > 0 ? value : 0;\n}\n\nexport function clampNonNegative(value: number): number {\n  if (!Number.isFinite(value)) {\n    return 0;\n  }\n  return value < 0 ? 0 : value;\n}\n", "import { rasterizeDropShadowForRect } from \"../utils/drop-shadow-raster.js\";\r\nimport type { PagePainter } from \"../page-painter.js\";\r\nimport type { RenderBox, Rect, Radius, ShadowLayer, RGBA } from \"../types.js\";\r\nimport { adjustRadius, clampNonNegative, cloneRadius, shrinkRadius } from \"./radius.js\";\r\n\r\nexport function paintBoxShadows(painter: PagePainter, boxes: RenderBox[], inset: boolean): void {\r\n  for (const box of boxes) {\r\n    if (!box.boxShadows?.length) {\r\n      continue;\r\n    }\r\n    for (const shadow of box.boxShadows) {\r\n      if (shadow.inset !== inset) {\r\n        continue;\r\n      }\r\n      if (!isRenderableShadow(shadow)) {\r\n        continue;\r\n      }\r\n      if (inset) {\r\n        renderInsetShadow(painter, box, shadow);\r\n      } else {\r\n        renderOuterShadow(painter, box, shadow);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction isRenderableShadow(shadow: ShadowLayer): boolean {\r\n  const alpha = clampUnit(shadow.color.a ?? 1);\r\n  return alpha > 0;\r\n}\r\n\r\nfunction renderOuterShadow(painter: PagePainter, box: RenderBox, shadow: ShadowLayer): void {\r\n  const baseRect = translateRect(box.borderBox, shadow.offsetX, shadow.offsetY);\r\n  const baseRadius = cloneRadius(box.borderRadius);\r\n  const blur = clampNonNegative(shadow.blur);\r\n  const spread = shadow.spread;\r\n  if (blur > 0) {\r\n    const raster = rasterizeDropShadowForRect(baseRect, baseRadius, shadow.color, blur, spread);\r\n    if (raster) {\r\n      painter.drawShadowImage(raster.image, raster.drawRect);\r\n      return;\r\n    }\r\n  }\r\n  drawShadowLayers(painter, {\r\n    mode: \"outer\",\r\n    baseRect,\r\n    baseRadius,\r\n    color: shadow.color,\r\n    blur,\r\n    spread,\r\n  });\r\n}\r\n\r\nfunction renderInsetShadow(painter: PagePainter, box: RenderBox, shadow: ShadowLayer): void {\r\n  const container = box.paddingBox ?? box.contentBox;\r\n  if (!container) {\r\n    return;\r\n  }\r\n  const baseRect = translateRect(container, shadow.offsetX, shadow.offsetY);\r\n  const baseRadius = shrinkRadius(cloneRadius(box.borderRadius), box.border.top, box.border.right, box.border.bottom, box.border.left);\r\n  const blur = clampNonNegative(shadow.blur);\r\n  const spread = shadow.spread;\r\n  if (blur === 0 && spread === 0) {\r\n    painter.fillRoundedRect(baseRect, baseRadius, shadow.color);\r\n    return;\r\n  }\r\n  drawShadowLayers(painter, {\r\n    mode: \"inset\",\r\n    baseRect,\r\n    baseRadius,\r\n    color: shadow.color,\r\n    blur,\r\n    spread,\r\n  });\r\n}\r\n\r\ninterface ShadowRenderParams {\r\n  mode: \"outer\" | \"inset\";\r\n  baseRect: Rect;\r\n  baseRadius: Radius;\r\n  color: RGBA;\r\n  blur: number;\r\n  spread: number;\r\n}\r\n\r\ninterface ShadowIteration {\r\n  expansion: number;\r\n  color: RGBA;\r\n}\r\n\r\nfunction drawShadowLayers(painter: PagePainter, params: ShadowRenderParams): void {\r\n  const iterations = buildShadowIterations(params);\r\n  if (!iterations.length) {\r\n    return;\r\n  }\r\n\r\n  if (params.mode === \"outer\") {\r\n    renderOuterShadowIterations(painter, params.baseRect, params.baseRadius, iterations);\r\n    return;\r\n  }\r\n\r\n  renderInsetShadowIterations(painter, params.baseRect, params.baseRadius, iterations);\r\n}\r\n\r\nfunction buildShadowIterations(params: ShadowRenderParams): ShadowIteration[] {\r\n  const { mode, color, blur, spread } = params;\r\n  const steps = blur > 0 ? Math.max(2, Math.ceil(blur / 2)) : 1;\r\n  const weights = buildShadowWeights(steps);\r\n  const baseAlpha = clampUnit(color.a ?? 1);\r\n  const iterations: ShadowIteration[] = [];\r\n  for (let index = 0; index < steps; index++) {\r\n    const fraction =\r\n      steps === 1\r\n        ? 0\r\n        : mode === \"outer\"\r\n          ? index / (steps - 1)\r\n          : (index + 1) / steps;\r\n    const expansion = spread + blur * fraction;\r\n    const weight = weights[index] ?? 0;\r\n    if (weight <= 0) {\r\n      continue;\r\n    }\r\n    iterations.push({\r\n      expansion,\r\n      color: {\r\n        r: color.r,\r\n        g: color.g,\r\n        b: color.b,\r\n        a: clampUnit(baseAlpha * weight),\r\n      },\r\n    });\r\n  }\r\n  return iterations;\r\n}\r\n\r\nfunction renderOuterShadowIterations(\r\n  painter: PagePainter,\r\n  baseRect: Rect,\r\n  baseRadius: Radius,\r\n  iterations: ShadowIteration[],\r\n): void {\r\n  for (const iteration of iterations) {\r\n    const rect = inflateRect(baseRect, iteration.expansion);\r\n    if (rect.width <= 0 || rect.height <= 0) {\r\n      continue;\r\n    }\r\n    const radius = adjustRadius(baseRadius, iteration.expansion);\r\n    painter.fillRoundedRect(rect, radius, iteration.color);\r\n  }\r\n}\r\n\r\nfunction renderInsetShadowIterations(\r\n  painter: PagePainter,\r\n  baseRect: Rect,\r\n  baseRadius: Radius,\r\n  iterations: ShadowIteration[],\r\n): void {\r\n  for (const iteration of iterations) {\r\n    const contraction = Math.max(0, iteration.expansion);\r\n    const innerRect = inflateRect(baseRect, -contraction);\r\n    if (innerRect.width <= 0 || innerRect.height <= 0) {\r\n      continue;\r\n    }\r\n    const outerRadius = cloneRadius(baseRadius);\r\n    const innerRadius = adjustRadius(baseRadius, -contraction);\r\n    painter.fillRoundedRectDifference(baseRect, outerRadius, innerRect, innerRadius, iteration.color);\r\n  }\r\n}\r\n\r\nfunction translateRect(rect: Rect, dx: number, dy: number): Rect {\r\n  return { x: rect.x + dx, y: rect.y + dy, width: rect.width, height: rect.height };\r\n}\r\n\r\nfunction inflateRect(rect: Rect, amount: number): Rect {\r\n  const width = rect.width + amount * 2;\r\n  const height = rect.height + amount * 2;\r\n  if (width <= 0 || height <= 0) {\r\n    return {\r\n      x: rect.x + rect.width / 2,\r\n      y: rect.y + rect.height / 2,\r\n      width: 0,\r\n      height: 0,\r\n    };\r\n  }\r\n  return {\r\n    x: rect.x - amount,\r\n    y: rect.y - amount,\r\n    width,\r\n    height,\r\n  };\r\n}\r\n\r\nfunction buildShadowWeights(steps: number): number[] {\r\n  if (steps <= 1) {\r\n    return [1];\r\n  }\r\n  const weights: number[] = [];\r\n  let total = 0;\r\n  for (let index = 0; index < steps; index++) {\r\n    const weight = steps - index;\r\n    weights.push(weight);\r\n    total += weight;\r\n  }\r\n  return weights.map((weight) => weight / total);\r\n}\r\n\r\nfunction clampUnit(value: number): number {\r\n  if (!Number.isFinite(value)) {\r\n    return 1;\r\n  }\r\n  if (value <= 0) {\r\n    return 0;\r\n  }\r\n  if (value >= 1) {\r\n    return 1;\r\n  }\r\n  return value;\r\n}\r\n", "export type NormalizedPathCommand =\r\n  | { type: \"M\"; x: number; y: number }\r\n  | { type: \"L\"; x: number; y: number }\r\n  | { type: \"C\"; x1: number; y1: number; x2: number; y2: number; x: number; y: number }\r\n  | { type: \"Z\" };\r\n\r\nexport function parsePathData(data: string | null | undefined): NormalizedPathCommand[] {\r\n  if (!data) {\r\n    return [];\r\n  }\r\n  const parser = new PathDataParser(data);\r\n  return parser.parse();\r\n}\r\n\r\nclass PathDataParser {\r\n  private readonly source: string;\r\n  private index = 0;\r\n\r\n  constructor(data: string) {\r\n    this.source = data;\r\n  }\r\n\r\n  parse(): NormalizedPathCommand[] {\r\n    const segments: NormalizedPathCommand[] = [];\r\n    let currentCommand: string | null = null;\r\n    let currentX = 0;\r\n    let currentY = 0;\r\n    let startX = 0;\r\n    let startY = 0;\r\n    let prevCubicControlX: number | null = null;\r\n    let prevCubicControlY: number | null = null;\r\n    let prevQuadControlX: number | null = null;\r\n    let prevQuadControlY: number | null = null;\r\n\r\n    while (true) {\r\n      this.skipSeparators();\r\n      if (this.isDone()) {\r\n        break;\r\n      }\r\n      const char = this.peekChar();\r\n      if (char !== null && isCommandLetter(char)) {\r\n        currentCommand = char;\r\n        this.index += 1;\r\n      } else if (!currentCommand) {\r\n        // Invalid data \u2013 nothing we can do.\r\n        break;\r\n      }\r\n\r\n      switch (currentCommand) {\r\n        case \"M\":\r\n        case \"m\": {\r\n          const isRelative = currentCommand === \"m\";\r\n          const firstPoint = this.readCoordinatePair();\r\n          if (!firstPoint) {\r\n            return segments;\r\n          }\r\n          currentX = isRelative ? currentX + firstPoint.x : firstPoint.x;\r\n          currentY = isRelative ? currentY + firstPoint.y : firstPoint.y;\r\n          startX = currentX;\r\n          startY = currentY;\r\n          segments.push({ type: \"M\", x: currentX, y: currentY });\r\n          prevCubicControlX = prevCubicControlY = null;\r\n          prevQuadControlX = prevQuadControlY = null;\r\n          // Subsequent coordinate pairs are treated as implicit \"L\".\r\n          while (true) {\r\n            this.skipSeparators();\r\n            const peek = this.peekChar();\r\n            if (peek === null || isCommandLetter(peek)) {\r\n              break;\r\n            }\r\n            const point = this.readCoordinatePair();\r\n            if (!point) {\r\n              return segments;\r\n            }\r\n            currentX = isRelative ? currentX + point.x : point.x;\r\n            currentY = isRelative ? currentY + point.y : point.y;\r\n            segments.push({ type: \"L\", x: currentX, y: currentY });\r\n          }\r\n          break;\r\n        }\r\n\r\n        case \"L\":\r\n        case \"l\": {\r\n          const isRelative = currentCommand === \"l\";\r\n          while (true) {\r\n            const point = this.readCoordinatePair();\r\n            if (!point) {\r\n              break;\r\n            }\r\n            currentX = isRelative ? currentX + point.x : point.x;\r\n            currentY = isRelative ? currentY + point.y : point.y;\r\n            segments.push({ type: \"L\", x: currentX, y: currentY });\r\n          }\r\n          prevCubicControlX = prevCubicControlY = null;\r\n          prevQuadControlX = prevQuadControlY = null;\r\n          break;\r\n        }\r\n\r\n        case \"H\":\r\n        case \"h\": {\r\n          const isRelative = currentCommand === \"h\";\r\n          while (true) {\r\n            const value = this.readNumber();\r\n            if (value === null) {\r\n              break;\r\n            }\r\n            currentX = isRelative ? currentX + value : value;\r\n            segments.push({ type: \"L\", x: currentX, y: currentY });\r\n          }\r\n          prevCubicControlX = prevCubicControlY = null;\r\n          prevQuadControlX = prevQuadControlY = null;\r\n          break;\r\n        }\r\n\r\n        case \"V\":\r\n        case \"v\": {\r\n          const isRelative = currentCommand === \"v\";\r\n          while (true) {\r\n            const value = this.readNumber();\r\n            if (value === null) {\r\n              break;\r\n            }\r\n            currentY = isRelative ? currentY + value : value;\r\n            segments.push({ type: \"L\", x: currentX, y: currentY });\r\n          }\r\n          prevCubicControlX = prevCubicControlY = null;\r\n          prevQuadControlX = prevQuadControlY = null;\r\n          break;\r\n        }\r\n\r\n        case \"C\":\r\n        case \"c\": {\r\n          const isRelative = currentCommand === \"c\";\r\n          while (true) {\r\n            const first = this.readCoordinatePair();\r\n            const second = this.readCoordinatePair();\r\n            const end = this.readCoordinatePair();\r\n            if (!first || !second || !end) {\r\n              break;\r\n            }\r\n            const x1 = isRelative ? currentX + first.x : first.x;\r\n            const y1 = isRelative ? currentY + first.y : first.y;\r\n            const x2 = isRelative ? currentX + second.x : second.x;\r\n            const y2 = isRelative ? currentY + second.y : second.y;\r\n            currentX = isRelative ? currentX + end.x : end.x;\r\n            currentY = isRelative ? currentY + end.y : end.y;\r\n            segments.push({ type: \"C\", x1, y1, x2, y2, x: currentX, y: currentY });\r\n            prevCubicControlX = x2;\r\n            prevCubicControlY = y2;\r\n            prevQuadControlX = prevQuadControlY = null;\r\n          }\r\n          break;\r\n        }\r\n\r\n        case \"S\":\r\n        case \"s\": {\r\n          const isRelative = currentCommand === \"s\";\r\n          while (true) {\r\n            const second = this.readCoordinatePair();\r\n            const end = this.readCoordinatePair();\r\n            if (!second || !end) {\r\n              break;\r\n            }\r\n            let x1 = currentX;\r\n            let y1 = currentY;\r\n            if (prevCubicControlX !== null && prevCubicControlY !== null) {\r\n              x1 = currentX * 2 - prevCubicControlX;\r\n              y1 = currentY * 2 - prevCubicControlY;\r\n            }\r\n            const x2 = isRelative ? currentX + second.x : second.x;\r\n            const y2 = isRelative ? currentY + second.y : second.y;\r\n            currentX = isRelative ? currentX + end.x : end.x;\r\n            currentY = isRelative ? currentY + end.y : end.y;\r\n            segments.push({ type: \"C\", x1, y1, x2, y2, x: currentX, y: currentY });\r\n            prevCubicControlX = x2;\r\n            prevCubicControlY = y2;\r\n            prevQuadControlX = prevQuadControlY = null;\r\n          }\r\n          break;\r\n        }\r\n\r\n        case \"Q\":\r\n        case \"q\": {\r\n          const isRelative = currentCommand === \"q\";\r\n          while (true) {\r\n            const control = this.readCoordinatePair();\r\n            const end = this.readCoordinatePair();\r\n            if (!control || !end) {\r\n              break;\r\n            }\r\n            const cx = isRelative ? currentX + control.x : control.x;\r\n            const cy = isRelative ? currentY + control.y : control.y;\r\n            const ex = isRelative ? currentX + end.x : end.x;\r\n            const ey = isRelative ? currentY + end.y : end.y;\r\n            const cubic = quadraticToCubic(currentX, currentY, cx, cy, ex, ey);\r\n            segments.push(cubic);\r\n            currentX = ex;\r\n            currentY = ey;\r\n            prevCubicControlX = cubic.x2;\r\n            prevCubicControlY = cubic.y2;\r\n            prevQuadControlX = cx;\r\n            prevQuadControlY = cy;\r\n          }\r\n          break;\r\n        }\r\n\r\n        case \"T\":\r\n        case \"t\": {\r\n          const isRelative = currentCommand === \"t\";\r\n          while (true) {\r\n            const end = this.readCoordinatePair();\r\n            if (!end) {\r\n              break;\r\n            }\r\n            let cx = currentX;\r\n            let cy = currentY;\r\n            if (prevQuadControlX !== null && prevQuadControlY !== null) {\r\n              cx = currentX * 2 - prevQuadControlX;\r\n              cy = currentY * 2 - prevQuadControlY;\r\n            }\r\n            const ex = isRelative ? currentX + end.x : end.x;\r\n            const ey = isRelative ? currentY + end.y : end.y;\r\n            const cubic = quadraticToCubic(currentX, currentY, cx, cy, ex, ey);\r\n            segments.push(cubic);\r\n            currentX = ex;\r\n            currentY = ey;\r\n            prevCubicControlX = cubic.x2;\r\n            prevCubicControlY = cubic.y2;\r\n            prevQuadControlX = cx;\r\n            prevQuadControlY = cy;\r\n          }\r\n          break;\r\n        }\r\n\r\n        case \"A\":\r\n        case \"a\": {\r\n          const isRelative = currentCommand === \"a\";\r\n          while (true) {\r\n            const rx = this.readNumber();\r\n            const ry = this.readNumber();\r\n            const xAxisRotation = this.readNumber();\r\n            const largeArcFlag = this.readFlag();\r\n            const sweepFlag = this.readFlag();\r\n            const end = this.readCoordinatePair();\r\n            if (\r\n              rx === null ||\r\n              ry === null ||\r\n              xAxisRotation === null ||\r\n              largeArcFlag === null ||\r\n              sweepFlag === null ||\r\n              !end\r\n            ) {\r\n              break;\r\n            }\r\n            const ex = isRelative ? currentX + end.x : end.x;\r\n            const ey = isRelative ? currentY + end.y : end.y;\r\n            const curves = arcToCubicCurves(currentX, currentY, rx, ry, xAxisRotation, largeArcFlag === 1, sweepFlag === 1, ex, ey);\r\n            if (curves.length === 0) {\r\n              // Degenerate arc \u2013 treat as straight line.\r\n              if (currentX !== ex || currentY !== ey) {\r\n                segments.push({ type: \"L\", x: ex, y: ey });\r\n              }\r\n            } else {\r\n              for (const curve of curves) {\r\n                segments.push({\r\n                  type: \"C\",\r\n                  x1: curve[0],\r\n                  y1: curve[1],\r\n                  x2: curve[2],\r\n                  y2: curve[3],\r\n                  x: curve[4],\r\n                  y: curve[5],\r\n                });\r\n              }\r\n            }\r\n            currentX = ex;\r\n            currentY = ey;\r\n            prevCubicControlX = curves.length > 0 ? curves[curves.length - 1][2] : null;\r\n            prevCubicControlY = curves.length > 0 ? curves[curves.length - 1][3] : null;\r\n            prevQuadControlX = prevQuadControlY = null;\r\n          }\r\n          break;\r\n        }\r\n\r\n        case \"Z\":\r\n        case \"z\": {\r\n          if (currentX !== startX || currentY !== startY) {\r\n            segments.push({ type: \"L\", x: startX, y: startY });\r\n          }\r\n          segments.push({ type: \"Z\" });\r\n          currentX = startX;\r\n          currentY = startY;\r\n          prevCubicControlX = prevCubicControlY = null;\r\n          prevQuadControlX = prevQuadControlY = null;\r\n          break;\r\n        }\r\n\r\n        default:\r\n          // Unsupported command \u2013 abort parsing.\r\n          return segments;\r\n      }\r\n    }\r\n\r\n    return segments;\r\n  }\r\n\r\n  private readCoordinatePair(): { x: number; y: number } | null {\r\n    const x = this.readNumber();\r\n    const y = this.readNumber();\r\n    if (x === null || y === null) {\r\n      return null;\r\n    }\r\n    return { x, y };\r\n  }\r\n\r\n  private readFlag(): 0 | 1 | null {\r\n    this.skipSeparators();\r\n    if (this.isDone()) {\r\n      return null;\r\n    }\r\n    const char = this.source[this.index];\r\n    if (char === \"0\" || char === \"1\") {\r\n      this.index += 1;\r\n      return char === \"1\" ? 1 : 0;\r\n    }\r\n    const value = this.readNumber();\r\n    if (value === null) {\r\n      return null;\r\n    }\r\n    return value === 0 ? 0 : 1;\r\n  }\r\n\r\n  private readNumber(): number | null {\r\n    this.skipSeparators();\r\n    if (this.isDone()) {\r\n      return null;\r\n    }\r\n    const slice = this.source.slice(this.index);\r\n    const match = slice.match(/^[-+]?(?:\\d+\\.?\\d*|\\.\\d+)(?:[eE][-+]?\\d+)?/);\r\n    if (!match) {\r\n      return null;\r\n    }\r\n    this.index += match[0].length;\r\n    const value = Number.parseFloat(match[0]);\r\n    if (!Number.isFinite(value)) {\r\n      return null;\r\n    }\r\n    return value;\r\n  }\r\n\r\n  private skipSeparators(): void {\r\n    while (!this.isDone()) {\r\n      const char = this.source[this.index];\r\n      if (char === \",\" || char === \" \" || char === \"\\t\" || char === \"\\n\" || char === \"\\r\") {\r\n        this.index += 1;\r\n        continue;\r\n      }\r\n      break;\r\n    }\r\n  }\r\n\r\n  private peekChar(): string | null {\r\n    if (this.isDone()) {\r\n      return null;\r\n    }\r\n    return this.source[this.index];\r\n  }\r\n\r\n  private isDone(): boolean {\r\n    return this.index >= this.source.length;\r\n  }\r\n}\r\n\r\nfunction quadraticToCubic(x0: number, y0: number, cx: number, cy: number, x: number, y: number): {\r\n  type: \"C\";\r\n  x1: number;\r\n  y1: number;\r\n  x2: number;\r\n  y2: number;\r\n  x: number;\r\n  y: number;\r\n} {\r\n  const x1 = x0 + (2 / 3) * (cx - x0);\r\n  const y1 = y0 + (2 / 3) * (cy - y0);\r\n  const x2 = x + (2 / 3) * (cx - x);\r\n  const y2 = y + (2 / 3) * (cy - y);\r\n  return { type: \"C\", x1, y1, x2, y2, x, y };\r\n}\r\n\r\nfunction arcToCubicCurves(\r\n  x0: number,\r\n  y0: number,\r\n  rx: number,\r\n  ry: number,\r\n  angle: number,\r\n  largeArc: boolean,\r\n  sweep: boolean,\r\n  x: number,\r\n  y: number,\r\n): Array<[number, number, number, number, number, number]> {\r\n  const curves: Array<[number, number, number, number, number, number]> = [];\r\n  if (x0 === x && y0 === y) {\r\n    return curves;\r\n  }\r\n  rx = Math.abs(rx);\r\n  ry = Math.abs(ry);\r\n  if (rx === 0 || ry === 0) {\r\n    return curves;\r\n  }\r\n\r\n  const rad = (angle * Math.PI) / 180;\r\n  const cosAngle = Math.cos(rad);\r\n  const sinAngle = Math.sin(rad);\r\n\r\n  const dx2 = (x0 - x) / 2;\r\n  const dy2 = (y0 - y) / 2;\r\n  const x1p = cosAngle * dx2 + sinAngle * dy2;\r\n  const y1p = -sinAngle * dx2 + cosAngle * dy2;\r\n\r\n  let rxSq = rx * rx;\r\n  let rySq = ry * ry;\r\n  let x1pSq = x1p * x1p;\r\n  let y1pSq = y1p * y1p;\r\n\r\n  let radiiCheck = x1pSq / rxSq + y1pSq / rySq;\r\n  if (radiiCheck > 1) {\r\n    const scale = Math.sqrt(radiiCheck);\r\n    rx *= scale;\r\n    ry *= scale;\r\n    rxSq = rx * rx;\r\n    rySq = ry * ry;\r\n  }\r\n\r\n  const sign = largeArc === sweep ? -1 : 1;\r\n  const sq = (rxSq * rySq - rxSq * y1pSq - rySq * x1pSq) / (rxSq * y1pSq + rySq * x1pSq);\r\n  const coef = sign * Math.sqrt(Math.max(0, sq));\r\n  const cxp = (coef * rx * y1p) / ry;\r\n  const cyp = (-coef * ry * x1p) / rx;\r\n\r\n  const cx = cosAngle * cxp - sinAngle * cyp + (x0 + x) / 2;\r\n  const cy = sinAngle * cxp + cosAngle * cyp + (y0 + y) / 2;\r\n\r\n  const startAngle = angleBetween(1, 0, (x1p - cxp) / rx, (y1p - cyp) / ry);\r\n  let deltaAngle = angleBetween(\r\n    (x1p - cxp) / rx,\r\n    (y1p - cyp) / ry,\r\n    (-x1p - cxp) / rx,\r\n    (-y1p - cyp) / ry,\r\n  );\r\n\r\n  if (!sweep && deltaAngle > 0) {\r\n    deltaAngle -= 2 * Math.PI;\r\n  } else if (sweep && deltaAngle < 0) {\r\n    deltaAngle += 2 * Math.PI;\r\n  }\r\n\r\n  const segments = Math.ceil(Math.abs(deltaAngle) / (Math.PI / 2));\r\n  const delta = deltaAngle / segments;\r\n  const t = (4 / 3) * Math.tan(delta / 4);\r\n\r\n  let start = startAngle;\r\n  let prevX = x0;\r\n  let prevY = y0;\r\n\r\n  for (let i = 0; i < segments; i += 1) {\r\n    const end = start + delta;\r\n    const sinStart = Math.sin(start);\r\n    const cosStart = Math.cos(start);\r\n    const sinEnd = Math.sin(end);\r\n    const cosEnd = Math.cos(end);\r\n\r\n    const x2 = cx + rx * cosAngle * cosEnd - ry * sinAngle * sinEnd;\r\n    const y2 = cy + rx * sinAngle * cosEnd + ry * cosAngle * sinEnd;\r\n\r\n    const dx1 = -rx * cosAngle * sinStart - ry * sinAngle * cosStart;\r\n    const dy1 = -rx * sinAngle * sinStart + ry * cosAngle * cosStart;\r\n    const dx2 = -rx * cosAngle * sinEnd - ry * sinAngle * cosEnd;\r\n    const dy2 = -rx * sinAngle * sinEnd + ry * cosAngle * cosEnd;\r\n\r\n    const cp1x = prevX + t * dx1;\r\n    const cp1y = prevY + t * dy1;\r\n    const cp2x = x2 - t * dx2;\r\n    const cp2y = y2 - t * dy2;\r\n\r\n    curves.push([cp1x, cp1y, cp2x, cp2y, x2, y2]);\r\n\r\n    prevX = x2;\r\n    prevY = y2;\r\n    start = end;\r\n  }\r\n\r\n  return curves;\r\n}\r\n\r\nfunction angleBetween(ux: number, uy: number, vx: number, vy: number): number {\r\n  const dot = ux * vx + uy * vy;\r\n  const len = Math.sqrt((ux * ux + uy * uy) * (vx * vx + vy * vy));\r\n  const clamped = clamp(-1, 1, len === 0 ? 0 : dot / len);\r\n  const sign = ux * vy - uy * vx < 0 ? -1 : 1;\r\n  return sign * Math.acos(clamped);\r\n}\r\n\r\nfunction isCommandLetter(char: string): boolean {\r\n  return /[a-zA-Z]/.test(char);\r\n}\r\n\r\nfunction clamp(min: number, max: number, value: number): number {\r\n  if (value < min) {\r\n    return min;\r\n  }\r\n  if (value > max) {\r\n    return max;\r\n  }\r\n  return value;\r\n}\r\n", "import type { NormalizedPathCommand } from \"../../svg/path-data.js\";\r\n\r\nconst CIRCLE_KAPPA = 0.5522847498307936;\r\n\r\nexport function buildRectSegments(x: number, y: number, width: number, height: number): NormalizedPathCommand[] {\r\n  return [\r\n    { type: \"M\", x, y },\r\n    { type: \"L\", x: x + width, y },\r\n    { type: \"L\", x: x + width, y: y + height },\r\n    { type: \"L\", x, y: y + height },\r\n    { type: \"Z\" },\r\n  ];\r\n}\r\n\r\nexport function buildRoundedRectSegments(x: number, y: number, width: number, height: number, rx: number, ry: number): NormalizedPathCommand[] {\r\n  const right = x + width;\r\n  const bottom = y + height;\r\n  const kx = rx * CIRCLE_KAPPA;\r\n  const ky = ry * CIRCLE_KAPPA;\r\n  return [\r\n    { type: \"M\", x: x + rx, y },\r\n    { type: \"L\", x: right - rx, y },\r\n    { type: \"C\", x1: right - rx + kx, y1: y, x2: right, y2: y + ry - ky, x: right, y: y + ry },\r\n    { type: \"L\", x: right, y: bottom - ry },\r\n    { type: \"C\", x1: right, y1: bottom - ry + ky, x2: right - rx + kx, y2: bottom, x: right - rx, y: bottom },\r\n    { type: \"L\", x: x + rx, y: bottom },\r\n    { type: \"C\", x1: x + rx - kx, y1: bottom, x2: x, y2: bottom - ry + ky, x: x, y: bottom - ry },\r\n    { type: \"L\", x, y: y + ry },\r\n    { type: \"C\", x1: x, y1: y + ry - ky, x2: x + rx - kx, y2: y, x: x + rx, y },\r\n    { type: \"Z\" },\r\n  ];\r\n}\r\n\r\nexport function buildEllipseSegments(cx: number, cy: number, rx: number, ry: number): NormalizedPathCommand[] {\r\n  const mx = rx * CIRCLE_KAPPA;\r\n  const my = ry * CIRCLE_KAPPA;\r\n  return [\r\n    { type: \"M\", x: cx, y: cy - ry },\r\n    { type: \"C\", x1: cx + mx, y1: cy - ry, x2: cx + rx, y2: cy - my, x: cx + rx, y: cy },\r\n    { type: \"C\", x1: cx + rx, y1: cy + my, x2: cx + mx, y2: cy + ry, x: cx, y: cy + ry },\r\n    { type: \"C\", x1: cx - mx, y1: cy + ry, x2: cx - rx, y2: cy + my, x: cx - rx, y: cy },\r\n    { type: \"C\", x1: cx - rx, y1: cy - my, x2: cx - mx, y2: cy - ry, x: cx, y: cy - ry },\r\n    { type: \"Z\" },\r\n  ];\r\n}\r\n", "import type { SvgPoint } from \"../../svg/types.js\";\r\nimport type { NormalizedPathCommand } from \"../../svg/path-data.js\";\r\nimport type { PathCommand } from \"../renderers/shape-renderer.js\";\r\nimport type { SvgRenderContext } from \"./render-svg.js\";\r\nimport { applyMatrixToPoint } from \"../../geometry/matrix.js\";\r\n\r\nexport function mapPoints(points: readonly SvgPoint[], context: SvgRenderContext): { x: number; y: number }[] {\r\n  const result: { x: number; y: number }[] = [];\r\n  for (const point of points) {\r\n    const mapped = mapSvgPoint(point.x, point.y, context);\r\n    if (!mapped) {\r\n      return [];\r\n    }\r\n    result.push(mapped);\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function mapPathSegments(segments: readonly NormalizedPathCommand[], context: SvgRenderContext): PathCommand[] | null {\r\n  const commands: PathCommand[] = [];\r\n  for (const segment of segments) {\r\n    switch (segment.type) {\r\n      case \"M\": {\r\n        const point = mapSvgPoint(segment.x, segment.y, context);\r\n        if (!point) {\r\n          return null;\r\n        }\r\n        commands.push({ type: \"moveTo\", x: point.x, y: point.y });\r\n        break;\r\n      }\r\n      case \"L\": {\r\n        const point = mapSvgPoint(segment.x, segment.y, context);\r\n        if (!point) {\r\n          return null;\r\n        }\r\n        commands.push({ type: \"lineTo\", x: point.x, y: point.y });\r\n        break;\r\n      }\r\n      case \"C\": {\r\n        const cp1 = mapSvgPoint(segment.x1, segment.y1, context);\r\n        const cp2 = mapSvgPoint(segment.x2, segment.y2, context);\r\n        const end = mapSvgPoint(segment.x, segment.y, context);\r\n        if (!cp1 || !cp2 || !end) {\r\n          return null;\r\n        }\r\n        commands.push({\r\n          type: \"curveTo\",\r\n          x1: cp1.x,\r\n          y1: cp1.y,\r\n          x2: cp2.x,\r\n          y2: cp2.y,\r\n          x: end.x,\r\n          y: end.y,\r\n        });\r\n        break;\r\n      }\r\n      case \"Z\":\r\n        commands.push({ type: \"closePath\" });\r\n        break;\r\n      default:\r\n        return null;\r\n    }\r\n  }\r\n  return commands;\r\n}\r\n\r\nexport function mapSvgPoint(x: number, y: number, context: SvgRenderContext): { x: number; y: number } | null {\r\n  if (!Number.isFinite(x) || !Number.isFinite(y)) {\r\n    return null;\r\n  }\r\n  const mapped = mapPointToViewport(context, x, y);\r\n  if (!Number.isFinite(mapped.x) || !Number.isFinite(mapped.y)) {\r\n    return null;\r\n  }\r\n  return mapped;\r\n}\r\n\r\nfunction mapPointToViewport(context: SvgRenderContext, x: number, y: number): { x: number; y: number } {\r\n  const local = applyMatrixToPoint(context.transform, x, y);\r\n  return applyMatrixToPoint(context.viewportMatrix, local.x, local.y);\r\n}\r\n", "import type { SvgDrawableNode, SvgGroupNode, SvgRootNode } from \"../../svg/types.js\";\r\nimport { parseColor } from \"../utils/color-utils.js\";\r\n\r\nexport interface SvgStyle {\r\n  fill?: string;\r\n  stroke?: string;\r\n  strokeWidth?: number;\r\n  strokeLinecap?: \"butt\" | \"round\" | \"square\";\r\n  strokeLinejoin?: \"miter\" | \"round\" | \"bevel\";\r\n  strokeDashArray?: number[];\r\n  strokeDashOffset?: number;\r\n  fillRule: \"nonzero\" | \"evenodd\";\r\n  opacity: number;\r\n  fillOpacity: number;\r\n  strokeOpacity: number;\r\n  fontSize: number;\r\n  fontFamily?: string;\r\n  textAnchor?: \"start\" | \"middle\" | \"end\";\r\n}\r\n\r\nexport function deriveStyle(base: SvgStyle, node: SvgDrawableNode | SvgGroupNode | SvgRootNode): SvgStyle {\r\n  const style: SvgStyle = { ...base };\r\n  const attrs = node.attributes ?? {};\r\n\r\n  if (attrs.opacity !== undefined) {\r\n    const value = parseOpacity(attrs.opacity);\r\n    if (value !== undefined) {\r\n      style.opacity = clamp01(style.opacity * value);\r\n    }\r\n  }\r\n\r\n  if (attrs.fill !== undefined) {\r\n    const fillValue = attrs.fill.trim();\r\n    style.fill = !fillValue || fillValue === \"none\" ? undefined : fillValue;\r\n  }\r\n\r\n  if (attrs[\"fill-opacity\"] !== undefined) {\r\n    const value = parseOpacity(attrs[\"fill-opacity\"]);\r\n    if (value !== undefined) {\r\n      style.fillOpacity = clamp01(value);\r\n    }\r\n  }\r\n\r\n  if (attrs.stroke !== undefined) {\r\n    const strokeValue = attrs.stroke.trim();\r\n    style.stroke = !strokeValue || strokeValue === \"none\" ? undefined : strokeValue;\r\n  }\r\n\r\n  if (attrs[\"stroke-opacity\"] !== undefined) {\r\n    const value = parseOpacity(attrs[\"stroke-opacity\"]);\r\n    if (value !== undefined) {\r\n      style.strokeOpacity = clamp01(value);\r\n    }\r\n  }\r\n\r\n  if (attrs[\"stroke-width\"] !== undefined) {\r\n    const value = parseNumber(attrs[\"stroke-width\"]);\r\n    if (value !== undefined) {\r\n      style.strokeWidth = value;\r\n    }\r\n  }\r\n\r\n  if (attrs[\"stroke-linecap\"] !== undefined) {\r\n    const cap = normalizeLineCap(attrs[\"stroke-linecap\"]);\r\n    if (cap) {\r\n      style.strokeLinecap = cap;\r\n    }\r\n  }\r\n\r\n  if (attrs[\"stroke-linejoin\"] !== undefined) {\r\n    const join = normalizeLineJoin(attrs[\"stroke-linejoin\"]);\r\n    if (join) {\r\n      style.strokeLinejoin = join;\r\n    }\r\n  }\r\n\r\n  if (attrs[\"stroke-dasharray\"] !== undefined) {\r\n    const value = parseDashArray(attrs[\"stroke-dasharray\"]);\r\n    if (value) {\r\n      style.strokeDashArray = value;\r\n    }\r\n  }\r\n\r\n  if (attrs[\"stroke-dashoffset\"] !== undefined) {\r\n    const value = parseNumber(attrs[\"stroke-dashoffset\"]);\r\n    if (value !== undefined) {\r\n      style.strokeDashOffset = value;\r\n    }\r\n  }\r\n\r\n  if (attrs[\"fill-rule\"] !== undefined) {\r\n    const rule = normalizeFillRule(attrs[\"fill-rule\"]);\r\n    if (rule) {\r\n      style.fillRule = rule;\r\n    }\r\n  }\r\n\r\n  if (attrs[\"font-size\"] !== undefined) {\r\n    const value = parseNumber(attrs[\"font-size\"]);\r\n    if (value !== undefined) {\r\n      style.fontSize = value;\r\n    }\r\n  }\r\n\r\n  if (attrs[\"font-family\"] !== undefined) {\r\n    const family = attrs[\"font-family\"].trim();\r\n    if (family) {\r\n      style.fontFamily = family;\r\n    }\r\n  }\r\n\r\n  if (attrs[\"text-anchor\"] !== undefined) {\r\n    const anchor = normalizeTextAnchor(attrs[\"text-anchor\"]);\r\n    if (anchor) {\r\n      style.textAnchor = anchor;\r\n    }\r\n  }\r\n\r\n  return style;\r\n}\r\n\r\nexport function createDefaultStyle(): SvgStyle {\r\n  return {\r\n    fill: \"#000000\",\r\n    stroke: undefined,\r\n    strokeWidth: 1,\r\n    strokeLinecap: \"butt\",\r\n    strokeLinejoin: \"miter\",\r\n    strokeDashArray: undefined,\r\n    strokeDashOffset: 0,\r\n    fillRule: \"nonzero\",\r\n    opacity: 1,\r\n    fillOpacity: 1,\r\n    strokeOpacity: 1,\r\n    fontSize: 16,\r\n    fontFamily: undefined,\r\n    textAnchor: \"start\",\r\n  };\r\n}\r\n\r\nexport function resolvePaint(value: string | undefined, opacity: number): { r: number; g: number; b: number; a: number } | undefined {\r\n  if (!value) {\r\n    return undefined;\r\n  }\r\n  if (value === \"none\") {\r\n    return undefined;\r\n  }\r\n  const color = parseColor(value);\r\n  if (!color) {\r\n    return undefined;\r\n  }\r\n  const baseAlpha = color.a ?? 1;\r\n  return {\r\n    r: color.r,\r\n    g: color.g,\r\n    b: color.b,\r\n    a: clamp01(baseAlpha * opacity),\r\n  };\r\n}\r\n\r\nfunction parseOpacity(value: string | undefined): number | undefined {\r\n  const parsed = parseNumber(value);\r\n  if (parsed === undefined) {\r\n    return undefined;\r\n  }\r\n  return clamp01(parsed);\r\n}\r\n\r\nfunction parseNumber(value: string | undefined): number | undefined {\r\n  if (!value) {\r\n    return undefined;\r\n  }\r\n  const trimmed = value.trim();\r\n  if (!trimmed) {\r\n    return undefined;\r\n  }\r\n  const num = Number.parseFloat(trimmed);\r\n  if (!Number.isFinite(num)) {\r\n    return undefined;\r\n  }\r\n  return num;\r\n}\r\n\r\nfunction normalizeLineCap(value: string): \"butt\" | \"round\" | \"square\" | undefined {\r\n  const lower = value.trim().toLowerCase();\r\n  if (lower === \"butt\" || lower === \"round\" || lower === \"square\") {\r\n    return lower;\r\n  }\r\n  return undefined;\r\n}\r\n\r\nfunction normalizeLineJoin(value: string): \"miter\" | \"round\" | \"bevel\" | undefined {\r\n  const lower = value.trim().toLowerCase();\r\n  if (lower === \"miter\" || lower === \"round\" || lower === \"bevel\") {\r\n    return lower;\r\n  }\r\n  return undefined;\r\n}\r\n\r\nfunction normalizeFillRule(value: string): \"nonzero\" | \"evenodd\" | undefined {\r\n  const lower = value.trim().toLowerCase();\r\n  if (lower === \"nonzero\" || lower === \"evenodd\") {\r\n    return lower;\r\n  }\r\n  return undefined;\r\n}\r\n\r\nfunction normalizeTextAnchor(value: string): \"start\" | \"middle\" | \"end\" | undefined {\r\n  const lower = value.trim().toLowerCase();\r\n  if (lower === \"start\" || lower === \"middle\" || lower === \"end\") {\r\n    return lower;\r\n  }\r\n  return undefined;\r\n}\r\n\r\nfunction clamp01(value: number): number {\r\n  if (!Number.isFinite(value)) {\r\n    return 0;\r\n  }\r\n  if (value <= 0) {\r\n    return 0;\r\n  }\r\n  if (value >= 1) {\r\n    return 1;\r\n  }\r\n  return value;\r\n}\r\n\r\nfunction parseDashArray(value: string | undefined): number[] | undefined {\r\n  if (!value) {\r\n    return undefined;\r\n  }\r\n  const trimmed = value.trim();\r\n  if (!trimmed || trimmed === \"none\") {\r\n    return undefined;\r\n  }\r\n  const parts = trimmed\r\n    .split(/[\\s,]+/)\r\n    .map((part) => Number.parseFloat(part))\r\n    .filter((num) => Number.isFinite(num) && num >= 0);\r\n\r\n  if (parts.length === 0) {\r\n    return undefined;\r\n  }\r\n  return parts;\r\n}\r\n", "import type {\r\n  SvgCircleNode,\r\n  SvgEllipseNode,\r\n  SvgLineNode,\r\n  SvgPathNode,\r\n  SvgPolygonNode,\r\n  SvgPolylineNode,\r\n  SvgRectNode,\r\n  SvgTextNode,\r\n} from \"../../svg/types.js\";\r\nimport type { SvgRenderContext } from \"./render-svg.js\";\r\nimport type { SvgStyle } from \"./style-computer.js\";\r\nimport type { PathCommand } from \"../renderers/shape-renderer.js\";\r\nimport type { StrokeOptions } from \"../types.js\";\r\nimport { parsePathData } from \"../../svg/path-data.js\";\r\nimport { buildEllipseSegments, buildRectSegments, buildRoundedRectSegments } from \"./geometry-builder.js\";\r\nimport { mapPathSegments, mapPoints, mapSvgPoint } from \"./coordinate-mapper.js\";\r\nimport { resolvePaint } from \"./style-computer.js\";\r\nimport { clampAlpha } from \"../utils/color-utils.js\";\r\nimport { applyMatrixToPoint, multiplyMatrices } from \"../../geometry/matrix.js\";\r\nimport { parseTransform } from \"../../transform/css-parser.js\";\r\nimport type { SvgLinearGradientNode } from \"../../svg/types.js\";\r\nimport type { SvgRadialGradientNode } from \"../../svg/types.js\";\r\nimport { parseLinearGradient, type LinearGradient } from \"../../css/parsers/gradient-parser.js\";\r\nimport type { RadialGradient } from \"../../css/parsers/gradient-parser.js\";\r\n\r\nfunction isLinearGradientPaint(value: unknown): value is LinearGradient {\r\n  if (typeof value !== \"object\" || value === null) return false;\r\n  const candidate = value as Partial<LinearGradient>;\r\n  return candidate.type === \"linear\" && Array.isArray((candidate as any).stops);\r\n}\r\n\r\nfunction isRadialGradientPaint(value: unknown): value is RadialGradient {\r\n  if (typeof value !== \"object\" || value === null) return false;\r\n  const candidate = value as Partial<RadialGradient>;\r\n  return candidate.type === \"radial\" && typeof (candidate as any).r === \"number\";\r\n}\r\n\r\nexport function renderRect(node: SvgRectNode, style: SvgStyle, context: SvgRenderContext): void {\r\n  const width = Number.isFinite(node.width ?? NaN) ? node.width ?? 0 : 0;\r\n  const height = Number.isFinite(node.height ?? NaN) ? node.height ?? 0 : 0;\r\n  if (width <= 0 || height <= 0) {\r\n    return;\r\n  }\r\n  const x = Number.isFinite(node.x ?? NaN) ? node.x ?? 0 : 0;\r\n  const y = Number.isFinite(node.y ?? NaN) ? node.y ?? 0 : 0;\r\n\r\n  let rx = node.rx ?? node.ry ?? 0;\r\n  let ry = node.ry ?? node.rx ?? 0;\r\n  if (!Number.isFinite(rx)) rx = 0;\r\n  if (!Number.isFinite(ry)) ry = 0;\r\n  rx = clampRadius(rx, width / 2);\r\n  ry = clampRadius(ry, height / 2);\r\n\r\n  const segments = rx > 0 || ry > 0 ? buildRoundedRectSegments(x, y, width, height, rx, ry) : buildRectSegments(x, y, width, height);\r\n  // If fill is a gradient (including url(...) referencing a <linearGradient> or <radialGradient> in defs), handle via painter gradient APIs\r\n  const gradient = resolveGradientPaint(style.fill, context);\r\n  if (gradient) {\r\n    // Map rectangle corners to viewport/page coordinates\r\n    const p1 = mapSvgPoint(x, y, context);\r\n    const p2 = mapSvgPoint(x + width, y + height, context);\r\n    if (p1 && p2) {\r\n      const pxRect = { x: p1.x, y: p1.y, width: p2.x - p1.x, height: p2.y - p1.y };\r\n      if ((gradient as RadialGradient).type === \"radial\") {\r\n        if (rx > 0 || ry > 0) {\r\n          context.painter.fillRoundedRect(pxRect, {\r\n            topLeft: { x: rx, y: ry },\r\n            topRight: { x: rx, y: ry },\r\n            bottomRight: { x: rx, y: ry },\r\n            bottomLeft: { x: rx, y: ry },\r\n          }, gradient as RadialGradient);\r\n        } else {\r\n          context.painter.fillRect(pxRect, gradient as RadialGradient);\r\n        }\r\n      } else {\r\n        if (rx > 0 || ry > 0) {\r\n          context.painter.fillRoundedRect(pxRect, {\r\n            topLeft: { x: rx, y: ry },\r\n            topRight: { x: rx, y: ry },\r\n            bottomRight: { x: rx, y: ry },\r\n            bottomLeft: { x: rx, y: ry },\r\n          }, gradient as LinearGradient);\r\n        } else {\r\n          context.painter.fillRect(pxRect, gradient as LinearGradient);\r\n        }\r\n      }\r\n      return;\r\n    }\r\n  }\r\n\r\n  const commands = mapPathSegments(segments, context);\r\n  if (!commands || commands.length === 0) {\r\n    return;\r\n  }\r\n  paintPathCommands(commands, style, context, style.fillRule);\r\n}\r\n\r\nexport function renderCircle(node: SvgCircleNode, style: SvgStyle, context: SvgRenderContext): void {\r\n  const radius = Number.isFinite(node.r ?? NaN) ? node.r ?? 0 : 0;\r\n  if (radius <= 0) {\r\n    return;\r\n  }\r\n  const cx = Number.isFinite(node.cx ?? NaN) ? node.cx ?? 0 : 0;\r\n  const cy = Number.isFinite(node.cy ?? NaN) ? node.cy ?? 0 : 0;\r\n  // Try resolving gradient paint first. For circle fills we special-case gradients and\r\n  // draw them by creating a rounded-rect (square) clipping path sized to the circle's\r\n  // bounding box. This reuses the ShapeRenderer's rounded-rect clipping + shading logic\r\n  // and produces a visually correct circular fill via the cubic-curve approximation.\r\n  const gradient = resolveGradientPaint(style.fill, context);\r\n  if (gradient) {\r\n    // Map center and an edge point to page pixels\r\n    const center = mapSvgPoint(cx, cy, context);\r\n    const edge = mapSvgPoint(cx + radius, cy, context);\r\n    if (center && edge) {\r\n      const rPx = Math.sqrt((edge.x - center.x) ** 2 + (edge.y - center.y) ** 2);\r\n      const pxRect = { x: center.x - rPx, y: center.y - rPx, width: rPx * 2, height: rPx * 2 };\r\n      const radii = {\r\n        topLeft: { x: rPx, y: rPx },\r\n        topRight: { x: rPx, y: rPx },\r\n        bottomRight: { x: rPx, y: rPx },\r\n        bottomLeft: { x: rPx, y: rPx },\r\n      };\r\n      if ((gradient as RadialGradient).type === \"radial\") {\r\n        context.painter.fillRoundedRect(pxRect, radii, gradient as RadialGradient);\r\n      } else {\r\n        context.painter.fillRoundedRect(pxRect, radii, gradient as LinearGradient);\r\n      }\r\n      return;\r\n    }\r\n    // If mapping failed, fall back to path-based fill below\r\n  }\r\n\r\n  const segments = buildEllipseSegments(cx, cy, radius, radius);\r\n  const commands = mapPathSegments(segments, context);\r\n  if (!commands || commands.length === 0) {\r\n    return;\r\n  }\r\n  paintPathCommands(commands, style, context, style.fillRule);\r\n}\r\n\r\nexport function renderEllipse(node: SvgEllipseNode, style: SvgStyle, context: SvgRenderContext): void {\r\n  const rx = Number.isFinite(node.rx ?? NaN) ? node.rx ?? 0 : 0;\r\n  const ry = Number.isFinite(node.ry ?? NaN) ? node.ry ?? 0 : 0;\r\n  if (rx <= 0 || ry <= 0) {\r\n    return;\r\n  }\r\n  const cx = Number.isFinite(node.cx ?? NaN) ? node.cx ?? 0 : 0;\r\n  const cy = Number.isFinite(node.cy ?? NaN) ? node.cy ?? 0 : 0;\r\n  const segments = buildEllipseSegments(cx, cy, rx, ry);\r\n  const commands = mapPathSegments(segments, context);\r\n  if (!commands || commands.length === 0) {\r\n    return;\r\n  }\r\n  paintPathCommands(commands, style, context, style.fillRule);\r\n}\r\n\r\nfunction clampRadius(value: number, limit: number): number {\r\n  if (!Number.isFinite(value) || value <= 0) {\r\n    return 0;\r\n  }\r\n  if (value > limit) {\r\n    return limit;\r\n  }\r\n  return value;\r\n}\r\n\r\nexport function renderPolygon(node: SvgPolygonNode, style: SvgStyle, context: SvgRenderContext): void {\r\n  const points = node.points ?? [];\r\n  if (points.length < 2) {\r\n    return;\r\n  }\r\n  const mapped = mapPoints(points, context);\r\n  if (mapped.length < 2) {\r\n    return;\r\n  }\r\n  const fillColor = resolvePaint(style.fill, style.opacity * style.fillOpacity);\r\n  if (fillColor) {\r\n    context.painter.fillPolygon(mapped, fillColor, true);\r\n  }\r\n  const strokeColor = resolvePaint(style.stroke, style.opacity * style.strokeOpacity);\r\n  if (strokeColor) {\r\n    context.painter.strokePolyline(mapped, strokeColor, {\r\n      ...getStrokeOptions(style, context),\r\n      close: true,\r\n    });\r\n  }\r\n}\r\n\r\nexport function renderPolyline(node: SvgPolylineNode, style: SvgStyle, context: SvgRenderContext): void {\r\n  const points = node.points ?? [];\r\n  if (points.length < 2) {\r\n    return;\r\n  }\r\n  const mapped = mapPoints(points, context);\r\n  if (mapped.length < 2) {\r\n    return;\r\n  }\r\n  const strokeColor = resolvePaint(style.stroke, style.opacity * style.strokeOpacity);\r\n  if (strokeColor) {\r\n    context.painter.strokePolyline(mapped, strokeColor, {\r\n      ...getStrokeOptions(style, context),\r\n      close: false,\r\n    });\r\n  }\r\n}\r\n\r\nexport function renderLine(node: SvgLineNode, style: SvgStyle, context: SvgRenderContext): void {\r\n  const strokeColor = resolvePaint(style.stroke, style.opacity * style.strokeOpacity);\r\n  if (!strokeColor) {\r\n    return;\r\n  }\r\n  const start = mapSvgPoint(node.x1 ?? 0, node.y1 ?? 0, context);\r\n  const end = mapSvgPoint(node.x2 ?? 0, node.y2 ?? 0, context);\r\n  if (!start || !end) {\r\n    return;\r\n  }\r\n  const points = [start, end];\r\n  context.painter.strokePolyline(points, strokeColor, {\r\n    ...getStrokeOptions(style, context),\r\n    close: false,\r\n  });\r\n}\r\n\r\nexport function renderPath(node: SvgPathNode, style: SvgStyle, context: SvgRenderContext): void {\r\n  const segments = parsePathData(node.d);\r\n  if (segments.length === 0) {\r\n    return;\r\n  }\r\n  const commands = mapPathSegments(segments, context);\r\n  if (!commands || commands.length === 0) {\r\n    return;\r\n  }\r\n  paintPathCommands(commands, style, context, style.fillRule);\r\n}\r\n\r\nfunction paintPathCommands(commands: PathCommand[], style: SvgStyle, context: SvgRenderContext, fillRule?: \"nonzero\" | \"evenodd\"): void {\r\n  if (commands.length === 0) {\r\n    return;\r\n  }\r\n  // Try to resolve a gradient paint server first (supports url(#id) references and CSS gradients)\r\n  const gradient = resolveGradientPaint(style.fill, context);\r\n  if (gradient) {\r\n    // Use the new painter API to paint arbitrary path commands with a gradient. The ShapeRenderer will\r\n    // create a clipping path from the provided commands and paint the shading clipped to the path.\r\n    context.painter.fillPathWithGradient(commands, gradient, { fillRule });\r\n    return;\r\n  }\r\n  const fillColor = resolvePaint(style.fill, style.opacity * style.fillOpacity);\r\n  if (fillColor) {\r\n    context.painter.fillPath(commands, fillColor, { fillRule: fillRule ?? style.fillRule });\r\n  }\r\n  const strokeColor = resolvePaint(style.stroke, style.opacity * style.strokeOpacity);\r\n  if (strokeColor) {\r\n    context.painter.strokePath(commands, strokeColor, getStrokeOptions(style, context));\r\n  }\r\n}\r\n\r\nexport async function renderText(node: SvgTextNode, style: SvgStyle, context: SvgRenderContext): Promise<void> {\r\n  const fillColor = resolvePaint(style.fill, style.opacity * style.fillOpacity);\r\n  if (!fillColor) {\r\n    return;\r\n  }\r\n  const fontSize = node.fontSize ?? style.fontSize;\r\n  if (!Number.isFinite(fontSize) || fontSize <= 0) {\r\n    return;\r\n  }\r\n  const anchor = node.textAnchor ?? style.textAnchor ?? \"start\";\r\n  const combined = multiplyMatrices(context.viewportMatrix, context.transform);\r\n  const anchorX = Number.isFinite(node.x ?? NaN) ? node.x ?? 0 : 0;\r\n  const anchorY = Number.isFinite(node.y ?? NaN) ? node.y ?? 0 : 0;\r\n  const origin = applyMatrixToPoint(combined, anchorX, anchorY);\r\n\r\n  const axisX = { x: combined.a, y: combined.b };\r\n  const approxWidth = estimateTextWidth(node.text, fontSize);\r\n  const anchorFactor = anchor === \"middle\" ? 0.5 : anchor === \"end\" ? 1 : 0;\r\n  let baselineX = origin.x;\r\n  let baselineY = origin.y;\r\n  if (anchorFactor !== 0 && (axisX.x !== 0 || axisX.y !== 0)) {\r\n    baselineX -= axisX.x * approxWidth * anchorFactor;\r\n    baselineY -= axisX.y * approxWidth * anchorFactor;\r\n  }\r\n\r\n  const color = { r: fillColor.r, g: fillColor.g, b: fillColor.b, a: clampAlpha(fillColor.a ?? 1) };\r\n  const fontFamily = node.fontFamily ?? style.fontFamily ?? \"Helvetica\";\r\n  await context.painter.drawTextRun({\r\n    text: node.text,\r\n    fontFamily,\r\n    fontSize,\r\n    fill: color,\r\n    lineMatrix: {\r\n      a: combined.a,\r\n      b: combined.b,\r\n      c: combined.c,\r\n      d: combined.d,\r\n      e: baselineX,\r\n      f: baselineY,\r\n    },\r\n  });\r\n}\r\n\r\nfunction estimateTextWidth(text: string, fontSize: number): number {\r\n  if (!text) {\r\n    return 0;\r\n  }\r\n  const averageFactor = 0.6;\r\n  return text.length * fontSize * averageFactor;\r\n}\r\n\r\nfunction resolveGradientPaint(paint: unknown, context?: SvgRenderContext): LinearGradient | RadialGradient | null {\r\n  // If already gradient object, return it\r\n  if (isLinearGradientPaint(paint) || isRadialGradientPaint(paint)) return paint as LinearGradient | RadialGradient;\r\n  if (typeof paint === \"string\") {\r\n    const trimmed = paint.trim();\r\n    const urlMatch = trimmed.match(/^url\\(\\s*#([^\\)\\s]+)\\s*\\)$/i);\r\n    if (urlMatch && context) {\r\n      const defs = (context as any).defs as Map<string, any> | undefined;\r\n      if (defs) {\r\n        const node = defs.get(urlMatch[1]);\r\n        if (node && (node.type === \"lineargradient\" || node.type === \"radialgradient\")) {\r\n          if (node.type === \"lineargradient\") {\r\n            return svgLinearNodeToLinearGradient(node as unknown as SvgLinearGradientNode, context);\r\n          }\r\n          return svgRadialNodeToRadialGradient(node as unknown as SvgRadialGradientNode, context);\r\n        }\r\n      }\r\n    }\r\n    // fallback to CSS linear-gradient(...) strings\r\n    return parseLinearGradient(paint);\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction svgLinearNodeToLinearGradient(node: SvgLinearGradientNode, context?: SvgRenderContext): LinearGradient {\r\n  const x1 = node.x1 ?? 0;\r\n  const y1 = node.y1 ?? 0;\r\n  const x2 = node.x2 ?? 1;\r\n  const y2 = node.y2 ?? 0;\r\n\r\n  const stops = (node.stops ?? []).map((s) => ({ color: s.color, position: s.offset }));\r\n\r\n  // Default: objectBoundingBox coordinates (ratio 0..1)\r\n  const units = node.gradientUnits === \"userSpaceOnUse\" ? \"userSpace\" : \"ratio\";\r\n\r\n  // If userSpaceOnUse, map points to page pixels using the SVG render context\r\n  if (units === \"userSpace\" && context) {\r\n    const p1 = mapSvgPoint(x1, y1, context);\r\n    const p2 = mapSvgPoint(x2, y2, context);\r\n    if (p1 && p2) {\r\n      // coords in absolute page pixels; gradient-service will convert to rectangle-local points\r\n      return { type: \"linear\", direction: \"to right\", stops, coords: { x1: p1.x, y1: p1.y, x2: p2.x, y2: p2.y, units: \"userSpace\" } };\r\n    }\r\n    // fallback to ratio if mapping failed\r\n  }\r\n\r\n  // objectBoundingBox: keep ratio coords (0..1)\r\n  // Apply gradientTransform if present \u2014 treat it as operating in gradient coordinate space\r\n  let rp1 = { x: x1, y: y1 };\r\n  let rp2 = { x: x2, y: y2 };\r\n  const rawTransform = (node.attributes && (node.attributes[\"gradientTransform\"] ?? node.attributes[\"gradienttransform\"])) as string | undefined;\r\n  if (rawTransform) {\r\n    const t = parseTransform(rawTransform) || undefined;\r\n    if (t) {\r\n      rp1 = applyMatrixToPoint(t, rp1.x, rp1.y);\r\n      rp2 = applyMatrixToPoint(t, rp2.x, rp2.y);\r\n    }\r\n  }\r\n\r\n  // compute direction angle from ratio coords (useful when no explicit coords provided)\r\n  const dx = rp2.x - rp1.x;\r\n  const dy = rp2.y - rp1.y;\r\n  const angle = (Math.atan2(dy, dx) * 180) / Math.PI;\r\n  const direction = `${angle.toFixed(2)}deg`;\r\n\r\n  return { type: \"linear\", direction, stops, coords: { x1: rp1.x, y1: rp1.y, x2: rp2.x, y2: rp2.y, units: \"ratio\" } };\r\n}\r\n\r\nfunction svgRadialNodeToRadialGradient(node: SvgRadialGradientNode, context?: SvgRenderContext): RadialGradient {\r\n  const cx = node.cx ?? 0.5;\r\n  const cy = node.cy ?? 0.5;\r\n  const r = node.r ?? 0.5;\r\n  const fx = node.fx;\r\n  const fy = node.fy;\r\n  const stops = (node.stops ?? []).map((s) => ({ color: s.color, position: s.offset }));\r\n\r\n  const units = node.gradientUnits === \"userSpaceOnUse\" ? \"userSpace\" : \"ratio\";\r\n\r\n  if (units === \"userSpace\" && context) {\r\n    const center = mapSvgPoint(cx, cy, context);\r\n    const focal = fx !== undefined && fy !== undefined ? mapSvgPoint(fx, fy, context) : undefined;\r\n    const radiusPt = (() => {\r\n      // map a point at cx + r, cy to user space and compute distance\r\n      const edge = mapSvgPoint(cx + r, cy, context);\r\n      if (center && edge) {\r\n        const dx = edge.x - center.x;\r\n        const dy = edge.y - center.y;\r\n        return Math.sqrt(dx * dx + dy * dy);\r\n      }\r\n      return undefined;\r\n    })();\r\n\r\n    // If mapping succeeded, return a userSpace radial gradient with absolute coords\r\n    if (center && radiusPt !== undefined) {\r\n      const rad: RadialGradient = {\r\n        type: \"radial\",\r\n        cx: center.x,\r\n        cy: center.y,\r\n        r: radiusPt,\r\n        stops,\r\n        coordsUnits: \"userSpace\",\r\n      };\r\n      if (focal) {\r\n        rad.fx = focal.x;\r\n        rad.fy = focal.y;\r\n      }\r\n      return rad;\r\n    }\r\n    // fallback to ratio below\r\n  }\r\n  // objectBoundingBox (ratio) coordinates;\r\n  // Keep raw coords in ratio units and, if a gradientTransform is present, preserve it\r\n  // on the returned RadialGradient so the shading creation can emit a PDF /Matrix that\r\n  // maps ratio-space circles to device-space ellipses exactly.\r\n  const radRatio: RadialGradient = {\r\n    type: \"radial\",\r\n    cx: cx,\r\n    cy: cy,\r\n    r: r,\r\n    stops,\r\n  };\r\n  if (fx !== undefined && fy !== undefined) {\r\n    radRatio.fx = fx;\r\n    radRatio.fy = fy;\r\n  }\r\n\r\n  const rawTransform = (node.attributes && (node.attributes[\"gradientTransform\"] ?? node.attributes[\"gradienttransform\"])) as string | undefined;\r\n  if (rawTransform) {\r\n    const t = parseTransform(rawTransform) || undefined;\r\n    if (t) {\r\n      // Preserve the parsed transform matrix on the RadialGradient for use by the\r\n      // gradient service when building the PDF shading dictionary.\r\n      radRatio.transform = { a: t.a, b: t.b, c: t.c, d: t.d, e: t.e, f: t.f };\r\n    }\r\n  }\r\n\r\n  return radRatio;\r\n}\r\n\r\nfunction getStrokeOptions(style: SvgStyle, context: SvgRenderContext): StrokeOptions {\r\n  const strokeWidthPx = (style.strokeWidth ?? 1) * context.strokeScale;\r\n  const options: StrokeOptions = {\r\n    lineWidth: strokeWidthPx > 0 ? strokeWidthPx : undefined,\r\n    lineCap: style.strokeLinecap,\r\n    lineJoin: style.strokeLinejoin,\r\n  };\r\n\r\n  if (style.strokeDashArray && style.strokeDashArray.length > 0) {\r\n    const pattern = style.strokeDashArray.map((v) => v * context.strokeScale);\r\n    const phase = (style.strokeDashOffset ?? 0) * context.strokeScale;\r\n    options.dash = { pattern, phase };\r\n  }\r\n\r\n  return options;\r\n}\r\n", "export type AspectAlign =\r\n  | \"none\"\r\n  | \"xMinYMin\"\r\n  | \"xMidYMin\"\r\n  | \"xMaxYMin\"\r\n  | \"xMinYMid\"\r\n  | \"xMidYMid\"\r\n  | \"xMaxYMid\"\r\n  | \"xMinYMax\"\r\n  | \"xMidYMax\"\r\n  | \"xMaxYMax\";\r\n\r\nexport interface PreserveAspectRatioConfig {\r\n  align: AspectAlign;\r\n  meetOrSlice: \"meet\" | \"slice\";\r\n}\r\n\r\nexport function parsePreserveAspectRatio(raw: string | undefined): PreserveAspectRatioConfig {\r\n  const defaultValue: PreserveAspectRatioConfig = { align: \"xMidYMid\", meetOrSlice: \"meet\" };\r\n  if (!raw) {\r\n    return defaultValue;\r\n  }\r\n  const tokens = raw.trim().split(/[\\s,]+/).filter(Boolean);\r\n  if (tokens.length === 0) {\r\n    return defaultValue;\r\n  }\r\n\r\n  const validAlignments: Record<string, AspectAlign> = {\r\n    none: \"none\",\r\n    xminymin: \"xMinYMin\",\r\n    xmidymin: \"xMidYMin\",\r\n    xmaxymin: \"xMaxYMin\",\r\n    xminymid: \"xMinYMid\",\r\n    xmidymid: \"xMidYMid\",\r\n    xmaxymid: \"xMaxYMid\",\r\n    xminymax: \"xMinYMax\",\r\n    xmidymax: \"xMidYMax\",\r\n    xmaxymax: \"xMaxYMax\",\r\n  };\r\n\r\n  let index = 0;\r\n  let alignToken = tokens[index]?.toLowerCase() ?? \"\";\r\n  if (alignToken === \"defer\") {\r\n    index += 1;\r\n    alignToken = tokens[index]?.toLowerCase() ?? \"\";\r\n  }\r\n  index += 1;\r\n\r\n  let align = validAlignments[alignToken] ?? defaultValue.align;\r\n  if (align === \"none\") {\r\n    return { align: \"none\", meetOrSlice: \"meet\" };\r\n  }\r\n\r\n  let meetOrSlice: \"meet\" | \"slice\" = \"meet\";\r\n  for (; index < tokens.length; index += 1) {\r\n    const token = tokens[index]?.toLowerCase();\r\n    if (token === \"meet\") {\r\n      meetOrSlice = \"meet\";\r\n      break;\r\n    }\r\n    if (token === \"slice\") {\r\n      meetOrSlice = \"slice\";\r\n      break;\r\n    }\r\n  }\r\n\r\n  if (!validAlignments[alignToken]) {\r\n    align = defaultValue.align;\r\n  }\r\n\r\n  return { align, meetOrSlice };\r\n}\r\n\r\nexport function getAlignFactors(align: AspectAlign): { x: number; y: number } {\r\n  if (align === \"none\") {\r\n    return { x: 0, y: 0 };\r\n  }\r\n  const horizontal = align.includes(\"xMid\") ? 0.5 : align.includes(\"xMax\") ? 1 : 0;\r\n  const vertical = align.includes(\"YMid\") ? 0.5 : align.includes(\"YMax\") ? 1 : 0;\r\n  return { x: horizontal, y: vertical };\r\n}\r\n", "import type { PagePainter } from \"../page-painter.js\";\r\nimport type { RenderBox } from \"../types.js\";\r\nimport type { SvgNode, SvgRootNode, SvgImageNode } from \"../../svg/types.js\";\nimport {\n  renderCircle,\n  renderEllipse,\n  renderLine,\n  renderPath,\n  renderPolygon,\r\n  renderPolyline,\r\n  renderRect,\r\n  renderText,\r\n} from \"./shape-renderer.js\";\r\nimport { createDefaultStyle, deriveStyle, type SvgStyle } from \"./style-computer.js\";\r\nimport { computeStrokeScale, identityMatrix, multiplyMatrices, type Matrix } from \"../../geometry/matrix.js\";\nimport { parseTransform } from \"../../transform/css-parser.js\";\nimport { mapSvgPoint } from \"./coordinate-mapper.js\";\nimport { ImageService } from \"../../image/image-service.js\";\nimport { getAlignFactors, parsePreserveAspectRatio } from \"./aspect-ratio.js\";\nimport { decodeBase64ToUint8Array } from \"../../utils/base64.js\";\nimport type { Environment } from \"../../environment/environment.js\";\n\r\ninterface SvgCustomData {\r\n  root: SvgRootNode;\r\n  intrinsicWidth: number;\r\n  intrinsicHeight: number;\r\n  resourceBaseDir?: string;\r\n  assetRootDir?: string;\r\n}\r\n\r\nexport interface SvgRenderContext {\n  painter: PagePainter;\n  viewportMatrix: Matrix;\n  transform: Matrix;\n  strokeScale: number;\n  // optional resource roots propagated from HTML conversion\n  resourceBaseDir?: string;\n  assetRootDir?: string;\n  environment?: Environment;\n}\n\r\n// Map of defs by id (gradients, clipPaths, etc.) built once per svg render\r\nexport type SvgDefsMap = Map<string, any>;\r\n\r\nexport async function renderSvgBox(painter: PagePainter, box: RenderBox, environment?: Environment): Promise<void> {\n  const svgData = extractSvgCustomData(box);\r\n  if (!svgData) {\r\n    return;\r\n  }\r\n\r\n  const { root } = svgData;\r\n  const content = box.contentBox;\r\n  const widthPx = Math.max(content.width, 0);\r\n  const heightPx = Math.max(content.height, 0);\r\n  if (widthPx <= 0 || heightPx <= 0) {\r\n    return;\r\n  }\r\n\r\n  const sourceWidth = resolvePositive(root.viewBox?.width ?? svgData.intrinsicWidth ?? widthPx);\r\n  const sourceHeight = resolvePositive(root.viewBox?.height ?? svgData.intrinsicHeight ?? heightPx);\r\n  const minX = root.viewBox?.minX ?? 0;\r\n  const minY = root.viewBox?.minY ?? 0;\r\n\r\n  const preserveAttr = root.attributes?.preserveAspectRatio ?? root.attributes?.preserveaspectratio;\r\n  const preserve = parsePreserveAspectRatio(typeof preserveAttr === \"string\" ? preserveAttr : undefined);\r\n\r\n  const baseScaleX = safeScale(widthPx / sourceWidth);\r\n  const baseScaleY = safeScale(heightPx / sourceHeight);\r\n\r\n  let scaleX = baseScaleX;\r\n  let scaleY = baseScaleY;\r\n  let offsetX = 0;\r\n  let offsetY = 0;\r\n\r\n  if (preserve.align !== \"none\") {\r\n    const uniformScale = preserve.meetOrSlice === \"slice\" ? Math.max(baseScaleX, baseScaleY) : Math.min(baseScaleX, baseScaleY);\r\n    scaleX = uniformScale;\r\n    scaleY = uniformScale;\r\n    const scaledWidth = sourceWidth * scaleX;\r\n    const scaledHeight = sourceHeight * scaleY;\r\n    const extraWidth = widthPx - scaledWidth;\r\n    const extraHeight = heightPx - scaledHeight;\r\n    const factors = getAlignFactors(preserve.align);\r\n    offsetX = extraWidth * factors.x;\r\n    offsetY = extraHeight * factors.y;\r\n  }\r\n\r\n  const viewportMatrix: Matrix = {\r\n    a: scaleX,\r\n    b: 0,\r\n    c: 0,\r\n    d: scaleY,\r\n    e: content.x + offsetX - minX * scaleX,\r\n    f: content.y + offsetY - minY * scaleY,\r\n  };\r\n\r\n  const initialTransform = identityMatrix();\r\n  const strokeScale = computeStrokeScale(viewportMatrix, initialTransform);\r\n\r\n  const context: SvgRenderContext = {\n    painter,\n    viewportMatrix,\n    transform: initialTransform,\n    strokeScale,\n    environment,\n    // resource roots will be set below from the box customData if available\n  };\n\r\n  // Build defs map (id -> node) so paint servers like gradients can be resolved during rendering\r\n  const defs = new Map<string, any>();\r\n  collectDefs(root, defs);\r\n  // Attach to context for downstream use\r\n  (context as any).defs = defs;\r\n\r\n  // If convertDomNode attached resource roots into the customData for this SVG, copy them to context\r\n  if ((svgData as any).resourceBaseDir) {\r\n    context.resourceBaseDir = (svgData as any).resourceBaseDir as string;\r\n  }\r\n  if ((svgData as any).assetRootDir) {\r\n    context.assetRootDir = (svgData as any).assetRootDir as string;\r\n  }\r\n\r\n  const baseStyle = createDefaultStyle();\r\n  await renderNode(root, baseStyle, context);\r\n}\r\n\r\nfunction collectDefs(node: SvgNode, map: Map<string, any>): void {\r\n  if (!node) return;\r\n  // If node has an id, register it\r\n  const id = (node as any).id;\r\n  if (id && typeof id === \"string\") {\r\n    map.set(id, node);\r\n  }\r\n  // Recurse into children for container nodes\r\n  if ((node as any).children && Array.isArray((node as any).children)) {\r\n    for (const child of (node as any).children) {\r\n      collectDefs(child, map);\r\n    }\r\n  }\r\n}\r\n\r\nfunction extractSvgCustomData(box: RenderBox): SvgCustomData | null {\r\n  const raw = box.customData?.svg;\r\n  if (!raw || typeof raw !== \"object\") {\r\n    return null;\r\n  }\r\n  const candidate = raw as Partial<SvgCustomData>;\r\n  if (!candidate.root) {\r\n    return null;\r\n  }\r\n  return {\r\n    root: candidate.root,\r\n    intrinsicWidth: resolvePositive(candidate.intrinsicWidth ?? 0),\r\n    intrinsicHeight: resolvePositive(candidate.intrinsicHeight ?? 0),\r\n    resourceBaseDir: candidate.resourceBaseDir,\r\n    assetRootDir: candidate.assetRootDir,\r\n  };\r\n}\r\n\r\nasync function renderNode(node: SvgNode, style: SvgStyle, context: SvgRenderContext): Promise<void> {\r\n  let workingContext = context;\r\n  const nodeTransform = parseTransform(node.transform);\r\n  if (nodeTransform) {\r\n    const combined = multiplyMatrices(context.transform, nodeTransform);\r\n    workingContext = {\r\n      painter: context.painter,\r\n      viewportMatrix: context.viewportMatrix,\r\n      transform: combined,\r\n      strokeScale: computeStrokeScale(context.viewportMatrix, combined),\r\n    };\r\n  }\r\n\r\n  switch (node.type) {\r\n    case \"svg\":\r\n    case \"g\": {\r\n      const nextStyle = deriveStyle(style, node);\r\n      for (const child of node.children) {\r\n        await renderNode(child, nextStyle, workingContext);\r\n      }\r\n      return;\r\n    }\r\n    case \"rect\":\r\n      return renderRect(node, deriveStyle(style, node), workingContext);\r\n    case \"circle\":\r\n      return renderCircle(node, deriveStyle(style, node), workingContext);\r\n    case \"ellipse\":\r\n      return renderEllipse(node, deriveStyle(style, node), workingContext);\r\n    case \"polygon\":\r\n      return renderPolygon(node, deriveStyle(style, node), workingContext);\r\n    case \"polyline\":\r\n      return renderPolyline(node, deriveStyle(style, node), workingContext);\r\n    case \"line\":\r\n      return renderLine(node, deriveStyle(style, node), workingContext);\r\n    case \"text\":\r\n      return renderText(node, deriveStyle(style, node), workingContext);\r\n    case \"image\":\r\n      // Render SVG <image> elements by loading the referenced image and drawing it\r\n      return await renderImage(node as SvgImageNode, deriveStyle(style, node), workingContext);\r\n    case \"path\":\r\n      return renderPath(node, deriveStyle(style, node), workingContext);\r\n    default:\r\n      return;\r\n  }\r\n}\r\n\r\nfunction safeScale(value: number): number {\r\n  if (!Number.isFinite(value) || value === 0) {\r\n    return 1;\r\n  }\r\n  return value;\r\n}\r\n\r\nfunction resolvePositive(value: number): number {\r\n  if (!Number.isFinite(value) || value <= 0) {\r\n    return 1;\r\n  }\r\n  return value;\r\n}\r\n\r\nasync function renderImage(node: SvgImageNode, _style: SvgStyle, context: SvgRenderContext): Promise<void> {\n  const hrefAttr = node.href ?? node.attributes?.href ?? node.attributes?.[\"xlink:href\"];\r\n  if (!hrefAttr || typeof hrefAttr !== \"string\") {\r\n    return;\r\n  }\r\n\r\n  let imageInfo;\r\n  const imageService = ImageService.getInstance(context.environment);\n  try {\n    if (hrefAttr.startsWith(\"data:\")) {\n      // data URI\n      const comma = hrefAttr.indexOf(\",\");\n      if (comma < 0) return;\n      const meta = hrefAttr.substring(5, comma);\n      const isBase64 = meta.endsWith(\";base64\");\n      const payload = hrefAttr.substring(comma + 1);\n      const bytes = isBase64 ? decodeBase64ToUint8Array(payload) : new TextEncoder().encode(decodeURIComponent(payload));\n      const copy = bytes.slice();\n      imageInfo = await imageService.decodeImage(copy.buffer);\n    } else if (/^https?:\\/\\//i.test(hrefAttr)) {\n      // Remote images not supported in this offline renderer\n      console.debug(\"Skipping remote image in SVG:\", hrefAttr);\n      return;\n    } else {\n      // Local file reference. Resolve using assetRootDir for absolute (/images/...) or resourceBaseDir for relative\n      const hasProcess = typeof process !== \"undefined\" && !!process.versions?.node;\n      if (!hasProcess) {\n        console.debug(\"Skipping local SVG image in non-Node environment:\", hrefAttr);\n        return;\n      }\n      const resolver = context.environment?.resolveLocal;\n      if (!resolver) {\n        console.debug(\"Skipping local SVG image (no resolver in environment):\", hrefAttr);\n        return;\n      }\n      const resolved = resolver(hrefAttr, context.resourceBaseDir ?? context.assetRootDir);\n      imageInfo = await imageService.loadImage(resolved);\n      (node as any)._resolvedHref = resolved;\n    }\n  } catch (err) {\n    console.debug(\"Failed to load SVG image\", hrefAttr, err instanceof Error ? err.message : err);\n    return;\n  }\n\r\n  if (!imageInfo) return;\r\n\r\n  const drawWidth = Number.isFinite(node.width as number) ? (node.width as number) : imageInfo.width;\r\n  const drawHeight = Number.isFinite(node.height as number) ? (node.height as number) : imageInfo.height;\r\n\r\n  const p1 = mapSvgPoint(Number(node.x ?? 0), Number(node.y ?? 0), context);\r\n  const p2 = mapSvgPoint(Number(node.x ?? 0) + drawWidth, Number(node.y ?? 0) + drawHeight, context);\r\n  if (!p1 || !p2) {\r\n    return;\r\n  }\r\n\r\n  const rect = { x: p1.x, y: p1.y, width: p2.x - p1.x, height: p2.y - p1.y };\r\n\r\n  const imageRef = {\r\n    src: (node as any)._resolvedHref ?? hrefAttr,\r\n    width: imageInfo.width,\r\n    height: imageInfo.height,\r\n    format: imageInfo.format,\r\n    channels: imageInfo.channels,\r\n    bitsPerComponent: imageInfo.bitsPerChannel,\r\n    data: imageInfo.data,\r\n  } as const;\r\n\r\n  try {\r\n    context.painter.drawImage(imageRef as any, rect);\r\n  } catch (err) {\r\n    console.debug(\"Failed to draw image in SVG\", hrefAttr, err instanceof Error ? err.message : err);\r\n  }\r\n}\r\n", "import type { BackgroundRepeat } from \"../../css/background-types.js\";\nimport type { Rect } from \"../types.js\";\n\nexport function intersectRects(a: Rect, b: Rect): Rect | null {\n  const x = Math.max(a.x, b.x);\n  const y = Math.max(a.y, b.y);\n  const right = Math.min(a.x + a.width, b.x + b.width);\n  const bottom = Math.min(a.y + a.height, b.y + b.height);\n  const width = right - x;\n  const height = bottom - y;\n  if (width <= 0 || height <= 0) {\n    return null;\n  }\n  return { x, y, width, height };\n}\n\nexport function rectEquals(a: Rect | undefined, b: Rect | undefined, epsilon = 0.01): boolean {\n  if (!a || !b) {\n    return false;\n  }\n  return (\n    Math.abs(a.x - b.x) < epsilon &&\n    Math.abs(a.y - b.y) < epsilon &&\n    Math.abs(a.width - b.width) < epsilon &&\n    Math.abs(a.height - b.height) < epsilon\n  );\n}\n\n/**\n * Computes the tile rectangles for a background layer inside a clipping rect,\n * honoring the repeat mode. Returned rects are already intersected with the\n * clip rect (they never extend outside).\n * \n * For 'space' mode: tiles are repeated with even spacing between them\n * For 'round' mode: tiles are scaled to fit perfectly without gaps\n */\nexport function computeBackgroundTileRects(tileRect: Rect, clipRect: Rect, repeat: BackgroundRepeat): Rect[] {\n  const width = tileRect.width;\n  const height = tileRect.height;\n  if (!Number.isFinite(width) || !Number.isFinite(height) || width <= 0 || height <= 0) {\n    return [];\n  }\n\n  if (repeat === \"no-repeat\") {\n    const single = intersectRects(tileRect, clipRect);\n    return single ? [single] : [];\n  }\n\n  // Handle 'space' mode\n  if (repeat === \"space\") {\n    return computeSpacedTiles(tileRect, clipRect);\n  }\n\n  // Handle 'round' mode\n  if (repeat === \"round\") {\n    return computeRoundedTiles(tileRect, clipRect);\n  }\n\n  // Handle standard repeat modes (repeat, repeat-x, repeat-y)\n  const repeatX = repeat === \"repeat\" || repeat === \"repeat-x\";\n  const repeatY = repeat === \"repeat\" || repeat === \"repeat-y\";\n\n  const result: Rect[] = [];\n\n  const startIx = repeatX ? Math.floor((clipRect.x - tileRect.x) / width) : 0;\n  const startIy = repeatY ? Math.floor((clipRect.y - tileRect.y) / height) : 0;\n\n  const maxX = clipRect.x + clipRect.width;\n  const maxY = clipRect.y + clipRect.height;\n\n  for (let iy = startIy; ; iy++) {\n    const ty = tileRect.y + iy * height;\n    if (ty >= maxY) {\n      break;\n    }\n    if (ty + height <= clipRect.y && !repeatY) {\n      break;\n    }\n\n    for (let ix = startIx; ; ix++) {\n      const tx = tileRect.x + ix * width;\n      if (tx >= maxX) {\n        break;\n      }\n      if (tx + width <= clipRect.x && !repeatX) {\n        break;\n      }\n\n      const candidate: Rect = { x: tx, y: ty, width, height };\n      const clipped = intersectRects(candidate, clipRect);\n      if (clipped) {\n        result.push(clipped);\n      }\n\n      if (!repeatX) {\n        break;\n      }\n    }\n\n    if (!repeatY) {\n      break;\n    }\n  }\n\n  return result;\n}\n\n/**\n * Computes tiles for 'space' mode: tiles are repeated with even spacing.\n * The first and last tiles touch the edges of the clip rect.\n */\nfunction computeSpacedTiles(tileRect: Rect, clipRect: Rect): Rect[] {\n  const result: Rect[] = [];\n  const tileWidth = tileRect.width;\n  const tileHeight = tileRect.height;\n  const availableWidth = clipRect.width;\n  const availableHeight = clipRect.height;\n\n  // Calculate how many tiles fit in each direction\n  const tilesX = Math.max(1, Math.floor(availableWidth / tileWidth));\n  const tilesY = Math.max(1, Math.floor(availableHeight / tileHeight));\n\n  // Calculate spacing between tiles\n  const spacingX = tilesX > 1 ? (availableWidth - tilesX * tileWidth) / (tilesX - 1) : 0;\n  const spacingY = tilesY > 1 ? (availableHeight - tilesY * tileHeight) / (tilesY - 1) : 0;\n\n  // Generate tiles with spacing\n  for (let iy = 0; iy < tilesY; iy++) {\n    const ty = clipRect.y + iy * (tileHeight + spacingY);\n\n    for (let ix = 0; ix < tilesX; ix++) {\n      const tx = clipRect.x + ix * (tileWidth + spacingX);\n\n      const candidate: Rect = {\n        x: tx,\n        y: ty,\n        width: tileWidth,\n        height: tileHeight\n      };\n\n      const clipped = intersectRects(candidate, clipRect);\n      if (clipped) {\n        result.push(clipped);\n      }\n    }\n  }\n\n  return result;\n}\n\n/**\n * Computes tiles for 'round' mode: tiles are scaled to fit perfectly.\n * Tiles are stretched or shrunk so they fit without gaps or clipping.\n */\nfunction computeRoundedTiles(tileRect: Rect, clipRect: Rect): Rect[] {\n  const result: Rect[] = [];\n  const tileWidth = tileRect.width;\n  const tileHeight = tileRect.height;\n  const availableWidth = clipRect.width;\n  const availableHeight = clipRect.height;\n\n  // Calculate how many tiles would fit (rounded to nearest integer)\n  const tilesX = Math.max(1, Math.round(availableWidth / tileWidth));\n  const tilesY = Math.max(1, Math.round(availableHeight / tileHeight));\n\n  // Calculate scaled tile dimensions\n  const scaledWidth = availableWidth / tilesX;\n  const scaledHeight = availableHeight / tilesY;\n\n  // Generate scaled tiles\n  for (let iy = 0; iy < tilesY; iy++) {\n    const ty = clipRect.y + iy * scaledHeight;\n\n    for (let ix = 0; ix < tilesX; ix++) {\n      const tx = clipRect.x + ix * scaledWidth;\n\n      const candidate: Rect = {\n        x: tx,\n        y: ty,\n        width: scaledWidth,\n        height: scaledHeight\n      };\n\n      const clipped = intersectRects(candidate, clipRect);\n      if (clipped) {\n        result.push(clipped);\n      }\n    }\n  }\n\n  return result;\n}\n", "import type { BorderStyles, BorderStyle, Edges, Rect, RGBA, Radius, StrokeDash } from \"../types.js\";\nimport type { ShapePoint } from \"../renderers/shape-renderer.js\";\n\nexport type BorderSide = \"top\" | \"right\" | \"bottom\" | \"left\";\n\nexport interface BorderSideStroke {\n  side: BorderSide;\n  points: ShapePoint[];\n  color: RGBA;\n  lineWidth: number;\n  dash?: StrokeDash;\n}\n\nexport function computeDashForStyle(style: BorderStyle, widthPx: number): StrokeDash | undefined {\n  const w = Math.max(widthPx, 0);\n  if (!Number.isFinite(w) || w <= 0) {\n    return undefined;\n  }\n\n  const normalized = style.toLowerCase() as BorderStyle;\n\n  if (normalized === \"dashed\") {\n    const base = w;\n    return { pattern: [3 * base, 3 * base], phase: 0 };\n  }\n\n  if (normalized === \"dotted\") {\n    const base = w;\n    return { pattern: [base, base], phase: 0 };\n  }\n\n  return undefined;\n}\n\nexport function computeBorderSideStrokes(\n  borderBox: Rect,\n  borderWidth: Edges,\n  borderStyle: BorderStyles,\n  color: RGBA,\n  _radius: Radius,\n): BorderSideStroke[] {\n  const result: BorderSideStroke[] = [];\n\n  const outerX = borderBox.x;\n  const outerY = borderBox.y;\n  const outerW = borderBox.width;\n  const outerH = borderBox.height;\n\n  if (!Number.isFinite(outerW) || !Number.isFinite(outerH) || outerW <= 0 || outerH <= 0) {\n    return result;\n  }\n\n  const topCenterY = outerY + borderWidth.top / 2;\n  const bottomCenterY = outerY + outerH - borderWidth.bottom / 2;\n  const leftCenterX = outerX + borderWidth.left / 2;\n  const rightCenterX = outerX + outerW - borderWidth.right / 2;\n\n  const pushSide = (side: BorderSide, width: number, style: BorderStyle, p1: ShapePoint, p2: ShapePoint): void => {\n    if (!Number.isFinite(width) || width <= 0) {\n      return;\n    }\n    const normalized = style.toLowerCase() as BorderStyle;\n    if (normalized === \"none\") {\n      return;\n    }\n\n    result.push({\n      side,\n      points: [p1, p2],\n      color,\n      lineWidth: width,\n      dash: computeDashForStyle(normalized, width),\n    });\n  };\n\n  pushSide(\n    \"top\",\n    borderWidth.top,\n    borderStyle.top,\n    { x: leftCenterX, y: topCenterY },\n    { x: rightCenterX, y: topCenterY },\n  );\n\n  pushSide(\n    \"right\",\n    borderWidth.right,\n    borderStyle.right,\n    { x: rightCenterX, y: topCenterY },\n    { x: rightCenterX, y: bottomCenterY },\n  );\n\n  pushSide(\n    \"bottom\",\n    borderWidth.bottom,\n    borderStyle.bottom,\n    { x: rightCenterX, y: bottomCenterY },\n    { x: leftCenterX, y: bottomCenterY },\n  );\n\n  pushSide(\n    \"left\",\n    borderWidth.left,\n    borderStyle.left,\n    { x: leftCenterX, y: bottomCenterY },\n    { x: leftCenterX, y: topCenterY },\n  );\n\n  return result;\n}\n", "import { log } from \"../../logging/debug.js\";\nimport { paintBoxShadows } from \"./paint-box-shadows.js\";\nimport { shrinkRadius } from \"./radius.js\";\nimport { renderSvgBox } from \"../svg/render-svg.js\";\nimport { NodeKind, type RenderBox, type RGBA, type Rect, type Radius, type BorderStyles } from \"../types.js\";\nimport type { PagePainter } from \"../page-painter.js\";\nimport { computeBackgroundTileRects, intersectRects, rectEquals } from \"../utils/background-tiles.js\";\nimport { computeBorderSideStrokes } from \"../utils/border-dashes.js\";\nimport type { PathCommand } from \"../renderers/shape-renderer.js\";\n\r\nexport async function paintBoxAtomic(painter: PagePainter, box: RenderBox): Promise<void> {\n  log(\"paint\", \"debug\", `paintBoxAtomic: ${box.tagName} id:${box.id} opacity:${box.opacity}`, { id: box.id, opacity: box.opacity });\r\n\r\n  const hasTransform = box.transform && (box.transform.b !== 0 || box.transform.c !== 0);\r\n  const hasOpacity = box.opacity < 1;\r\n\r\n  if (hasTransform) {\r\n    painter.beginTransformScope(box.transform!, box.borderBox);\r\n  }\r\n\r\n  if (hasOpacity) {\n    painter.beginOpacityScope(box.opacity);\n  }\n\n  paintBoxShadows(painter, [box], false);\n\n  const clipCommands = buildClipPathCommands(box.clipPath);\n  const hasClip = !!clipCommands;\n  if (hasClip && clipCommands) {\n    painter.beginClipPath(clipCommands);\n  }\n\n  paintBackground(painter, box);\n  paintBorder(painter, box);\n  paintBoxShadows(painter, [box], true);\n\r\n  if (box.kind === NodeKind.Svg || (box.tagName === \"svg\" && box.customData?.svg)) {\n    await renderSvgBox(painter, box, painter.environment);\n  } else if (box.image) {\n    painter.drawImage(box.image, box.contentBox);\n  }\n\r\n  await paintText(painter, box);\n\n  if (hasClip) {\n    painter.endClipPath();\n  }\n\n  if (hasOpacity) {\n    painter.endOpacityScope(box.opacity);\n  }\n\n  if (hasTransform) {\n    painter.endTransformScope();\r\n  }\r\n}\r\n\r\nexport function paintPageBackground(painter: PagePainter, color: RGBA | undefined, widthPx: number, heightPx: number, offsetY: number): void {\r\n  if (!color) {\r\n    return;\r\n  }\r\n  if (!Number.isFinite(widthPx) || widthPx <= 0 || !Number.isFinite(heightPx) || heightPx <= 0) {\r\n    return;\r\n  }\r\n  const rect: Rect = { x: 0, y: offsetY, width: widthPx, height: heightPx };\r\n  painter.fillRect(rect, color);\r\n}\r\n\r\nasync function paintText(painter: PagePainter, box: RenderBox): Promise<void> {\r\n  if (!box.textRuns || box.textRuns.length === 0) {\r\n    return;\r\n  }\r\n  for (const run of box.textRuns) {\r\n    if (box.textShadows && box.textShadows.length > 0) {\r\n      run.textShadows = [...(box.textShadows ?? []), ...(run.textShadows ?? [])];\r\n    }\r\n    await painter.drawTextRun(run);\r\n  }\r\n}\r\n\r\nfunction paintBackground(painter: PagePainter, box: RenderBox): void {\r\n  const background = box.background;\r\n  if (!background) {\r\n    return;\r\n  }\r\n\r\n  const paintArea = determineBackgroundPaintArea(box);\r\n  if (!paintArea) {\r\n    return;\r\n  }\r\n\r\n  log(\"paint\", \"debug\", `painting background z:${box.zIndexComputed ?? 0}`, {\r\n    tagName: box.tagName,\r\n    zIndex: box.zIndexComputed ?? 0,\r\n    id: box.id,\r\n    background: background.color ? \"color\" : background.gradient ? \"gradient\" : background.image ? \"image\" : \"none\",\r\n  });\r\n\r\n  if (background.color) {\r\n    painter.fillRoundedRect(paintArea.rect, paintArea.radius, background.color);\r\n  }\r\n\r\n  if (background.gradient) {\r\n    const gradient = background.gradient;\r\n    const clipRect = paintArea.rect;\r\n\r\n    const gradientRect = gradient.rect ?? clipRect;\r\n    const repeatMode = gradient.repeat ?? \"no-repeat\";\r\n    const tiles = computeBackgroundTileRects(gradientRect, clipRect, repeatMode);\r\n\r\n    for (const tile of tiles) {\r\n      const radius =\r\n        rectEquals(tile, clipRect) || rectEquals(tile, gradient.originRect)\r\n          ? paintArea.radius\r\n          : zeroRadius();\r\n\r\n      painter.fillRoundedRect(tile, radius, gradient.gradient as any);\r\n    }\r\n  }\r\n\r\n  if (background.image) {\r\n    paintBackgroundImageLayer(painter, background.image, paintArea.rect, paintArea.radius);\r\n  }\r\n}\r\n\r\nfunction paintBackgroundImageLayer(\r\n  painter: PagePainter,\r\n  layer: RenderBox[\"background\"][\"image\"],\r\n  clipRect: Rect,\r\n  clipRadius: Radius,\r\n): void {\r\n  if (!layer || !layer.rect) {\r\n    return;\r\n  }\r\n\r\n  const repeatMode = layer.repeat ?? \"repeat\";\r\n  const tiles = computeBackgroundTileRects(layer.rect, clipRect, repeatMode);\r\n\r\n  for (const tile of tiles) {\r\n    painter.drawBackgroundImage(layer.image, tile, clipRect, clipRadius);\r\n  }\r\n}\r\n\r\nfunction paintBorder(painter: PagePainter, box: RenderBox): void {\r\n  const color = box.borderColor;\r\n  if (!color) {\r\n    return;\r\n  }\r\n  const { border } = box;\r\n  if (!hasVisibleBorder(border)) {\r\n    return;\r\n  }\r\n\r\n  const styles: BorderStyles | undefined = box.borderStyle;\r\n  const allSolid =\r\n    !styles ||\r\n    (styles.top === \"solid\" && styles.right === \"solid\" && styles.bottom === \"solid\" && styles.left === \"solid\");\r\n\r\n  if (allSolid) {\r\n    const outerRect = box.borderBox;\r\n    const innerRect = {\r\n      x: outerRect.x + border.left,\r\n      y: outerRect.y + border.top,\r\n      width: Math.max(outerRect.width - border.left - border.right, 0),\r\n      height: Math.max(outerRect.height - border.top - border.bottom, 0),\r\n    };\r\n    const innerRadius = shrinkRadius(box.borderRadius, border.top, border.right, border.bottom, border.left);\r\n    if (innerRect.width <= 0 || innerRect.height <= 0) {\r\n      painter.fillRoundedRect(outerRect, box.borderRadius, color);\r\n    } else {\r\n      painter.fillRoundedRectDifference(outerRect, box.borderRadius, innerRect, innerRadius, color);\r\n    }\r\n    return;\r\n  }\r\n\r\n  const effectiveStyles: BorderStyles = styles ?? {\r\n    top: \"solid\",\r\n    right: \"solid\",\r\n    bottom: \"solid\",\r\n    left: \"solid\",\r\n  };\r\n\r\n  const strokes = computeBorderSideStrokes(box.borderBox, border, effectiveStyles, color, box.borderRadius);\r\n  for (const stroke of strokes) {\r\n    painter.strokePolyline(stroke.points, stroke.color, {\r\n      lineWidth: stroke.lineWidth,\r\n      lineCap: \"butt\",\r\n      lineJoin: \"miter\",\r\n      dash: stroke.dash,\r\n    });\r\n  }\r\n}\r\n\r\nfunction determineBackgroundPaintArea(box: RenderBox): { rect: Rect; radius: Radius } | null {\r\n  const rect = box.borderBox ?? box.paddingBox ?? box.contentBox;\r\n  if (!rect) {\r\n    return null;\r\n  }\r\n\r\n  if (rect === box.borderBox) {\r\n    return { rect, radius: box.borderRadius };\r\n  }\r\n\r\n  let radius = shrinkRadius(box.borderRadius, box.border.top, box.border.right, box.border.bottom, box.border.left);\r\n  if (rect === box.contentBox) {\r\n    radius = shrinkRadius(radius, box.padding.top, box.padding.right, box.padding.bottom, box.padding.left);\r\n  }\r\n\r\n  return { rect, radius };\r\n}\r\n\r\nfunction hasVisibleBorder(border: RenderBox[\"border\"]): boolean {\r\n  return border.top > 0 || border.right > 0 || border.bottom > 0 || border.left > 0;\r\n}\r\n\r\nfunction zeroRadius(): Radius {\n  return {\n    topLeft: { x: 0, y: 0 },\n    topRight: { x: 0, y: 0 },\n    bottomRight: { x: 0, y: 0 },\n    bottomLeft: { x: 0, y: 0 },\n  };\n}\n\nfunction buildClipPathCommands(clipPath: RenderBox[\"clipPath\"]): PathCommand[] | null {\n  if (!clipPath || clipPath.type !== \"polygon\" || clipPath.points.length < 3) {\n    return null;\n  }\n  const [first, ...rest] = clipPath.points;\n  const commands: PathCommand[] = [{ type: \"moveTo\", x: first.x, y: first.y }];\n  for (const point of rest) {\n    commands.push({ type: \"lineTo\", x: point.x, y: point.y });\n  }\n  commands.push({ type: \"closePath\" });\n  return commands;\n}\n", "/**\r\n * Header/Footer Renderer\r\n *\r\n * This module provides Word/mPDF-like header and footer rendering.\r\n * Headers and footers are rendered as full HTML through the same layout pipeline\r\n * as the main content, giving them full styling capabilities.\r\n *\r\n * Key behaviors:\r\n * - Headers are rendered at the top of each page (within top margin area)\r\n * - Footers are rendered at the bottom of each page (within bottom margin area)\r\n * - Main content area is automatically reduced to exclude header/footer space\r\n * - Placeholders like {{pageNumber}}, {{totalPages}}, {{date}} are supported\r\n */\r\n\r\nimport { parseHTML } from \"linkedom\";\r\nimport type { FontConfig } from \"../types/fonts.js\";\r\nimport { parseCss } from \"../html/css/parse-css.js\";\r\nimport { makeUnitParsers, type UnitCtx, pxToPt } from \"../units/units.js\";\r\nimport { LayoutNode } from \"../dom/node.js\";\r\nimport { ComputedStyle } from \"../css/style.js\";\r\nimport { layoutTree } from \"../layout/pipeline/layout-tree.js\";\r\nimport { buildRenderTree, type RenderTreeOptions } from \"./layout-tree-builder.js\";\r\nimport type { RenderBox, Rect, LayoutTree, RGBA, Run, TextPaintOptions } from \"./types.js\";\r\nimport { convertDomNode } from \"../html/dom-converter.js\";\r\nimport { computeStyleForElement } from \"../css/compute-style.js\";\r\nimport { Display } from \"../css/enums.js\";\r\nimport { log } from \"../logging/debug.js\";\r\nimport { offsetRenderTree } from \"../render/offset.js\";\r\nimport type { FontEmbedder } from \"./font/embedder.js\";\r\nimport { FontRegistryResolver } from \"../fonts/font-registry-resolver.js\";\nimport type { FontRegistry } from \"./font/font-registry.js\";\nimport { computeGlyphRun, applyWordSpacingToGlyphRun } from \"./utils/node-text-run-factory.js\";\nimport type { PagePainter } from \"./page-painter.js\";\nimport { paintBoxAtomic } from \"./renderer/box-painter.js\";\nimport { applyPlaceholders } from \"./header-footer-tokens.js\";\nimport type { Environment } from \"../environment/environment.js\";\n\nexport interface HeaderFooterRenderOptions {\n  /** The HTML content for the header/footer */\n  html: string;\n  /** Optional CSS to apply */\n  css?: string;\r\n  /** Width of the header/footer area in pixels */\r\n  widthPx: number;\r\n  /** Maximum height of the header/footer area in pixels */\r\n  maxHeightPx: number;\r\n  /** Font configuration for rendering */\r\n  fontConfig?: FontConfig;\r\n  /** Font embedder for PDF output */\r\n  fontEmbedder?: FontEmbedder | null;\r\n  /** Resource base directory for loading assets */\r\n  resourceBaseDir?: string;\r\n  /** Asset root directory */\r\n  assetRootDir?: string;\r\n  /** Tokens for placeholder replacement */\r\n  tokens?: Map<string, string | ((page: number, total: number) => string)>;\r\n  /** Current page number (1-indexed) */\r\n  pageNumber?: number;\r\n  /** Total number of pages */\n  totalPages?: number;\n  /** Platform environment (Node/browser) for resource loading */\n  environment?: Environment;\n}\n\r\nexport interface RenderedHeaderFooter {\r\n  /** The render tree for the header/footer */\r\n  renderTree: LayoutTree;\r\n  /** The actual height of the rendered content in pixels */\r\n  heightPx: number;\r\n  /** The root render box */\r\n  root: RenderBox;\r\n}\r\n\r\n/**\r\n * Renders header or footer HTML into a layout tree.\r\n * This uses the same pipeline as the main content for full HTML/CSS support.\r\n */\r\nexport async function renderHeaderFooterHtml(\n  options: HeaderFooterRenderOptions\n): Promise<RenderedHeaderFooter | null> {\n  const {\n    html,\n    css = \"\",\n    widthPx,\n    maxHeightPx,\n    fontEmbedder,\n    resourceBaseDir,\n    assetRootDir,\n    tokens,\n    pageNumber = 1,\n    totalPages = 1,\n    environment,\n  } = options;\n\n  const resolvedResourceBase = resourceBaseDir ?? \"\";\n  const resolvedAssetRoot = assetRootDir ?? resolvedResourceBase;\n\r\n  if (!html || !html.trim()) {\r\n    return null;\r\n  }\r\n\r\n  // Apply placeholder replacements\r\n  let processedHtml = html;\r\n  if (tokens) {\r\n    processedHtml = applyPlaceholders(html, tokens, pageNumber, totalPages);\r\n  }\r\n\r\n  // Wrap in a container if not already a full document\r\n  const normalizedHtml = normalizeHtmlFragment(processedHtml);\r\n\r\n  const unitCtx: UnitCtx = { viewport: { width: widthPx, height: maxHeightPx } };\r\n  const units = makeUnitParsers(unitCtx);\r\n\r\n  const { document } = parseHTML(normalizedHtml);\r\n\r\n  // Parse CSS\r\n  const { styleRules: cssRules } = parseCss(css);\r\n\r\n  // Get the root element\r\n  const rootElement = document.body || document.documentElement;\r\n\r\n  const baseParentStyle = new ComputedStyle();\r\n  const rootFontSize = baseParentStyle.fontSize;\r\n\r\n  let rootStyle = computeStyleForElement(rootElement, cssRules, baseParentStyle, units, rootFontSize);\r\n  if (isInlineDisplay(rootStyle.display)) {\r\n    rootStyle.display = Display.Block;\r\n  }\r\n\r\n  const rootLayout = new LayoutNode(rootStyle, [], { tagName: rootElement?.tagName?.toLowerCase() });\r\n\r\n  const conversionContext = { resourceBaseDir: resolvedResourceBase, assetRootDir: resolvedAssetRoot, units, rootFontSize, environment };\n\r\n  if (rootElement) {\r\n    for (const child of Array.from(rootElement.childNodes)) {\r\n      if (child.nodeType === child.ELEMENT_NODE) {\r\n        const tagName = (child as HTMLElement).tagName.toLowerCase();\r\n        if (tagName === \"head\" || tagName === \"meta\" || tagName === \"title\" || tagName === \"link\" || tagName === \"script\") {\r\n          continue;\r\n        }\r\n      }\r\n      const layoutChild = await convertDomNode(child, cssRules, rootStyle, conversionContext);\r\n      if (layoutChild) rootLayout.appendChild(layoutChild);\r\n    }\r\n  }\r\n\r\n  // Layout with constrained dimensions\r\n  layoutTree(rootLayout, { width: widthPx, height: maxHeightPx }, fontEmbedder ?? null);\r\n\r\n  const renderTree = buildRenderTree(rootLayout, {});\r\n\r\n  // Calculate actual height\r\n  const actualHeight = Math.min(calculateTreeHeight(renderTree.root), maxHeightPx);\r\n\r\n  log(\"layout\", \"debug\", \"Header/footer rendered\", {\r\n    widthPx,\r\n    maxHeightPx,\r\n    actualHeight,\r\n    hasContent: renderTree.root.children.length > 0,\r\n  });\r\n\r\n  return {\r\n    renderTree,\r\n    heightPx: actualHeight,\r\n    root: renderTree.root,\r\n  };\r\n}\r\n\r\n/**\r\n * Deep clones a render box tree for per-page rendering.\r\n * This is needed because we apply offsets that are page-specific.\r\n */\r\nfunction cloneRenderBox(box: RenderBox): RenderBox {\r\n  const clonedRuns = box.textRuns.map((run) => ({\r\n    ...run,\r\n    lineMatrix: run.lineMatrix ? { ...run.lineMatrix } : undefined,\r\n    decorations: run.decorations ? { ...run.decorations } : undefined,\r\n    glyphs: run.glyphs ? { ...run.glyphs } : undefined,\r\n  })) as Run[];\r\n\r\n  const clonedBox: RenderBox = {\r\n    ...box,\r\n    contentBox: { ...box.contentBox },\r\n    paddingBox: { ...box.paddingBox },\r\n    borderBox: { ...box.borderBox },\r\n    visualOverflow: { ...box.visualOverflow },\r\n    padding: { ...box.padding },\r\n    border: { ...box.border },\r\n    borderRadius: {\r\n      topLeft: { ...box.borderRadius.topLeft },\r\n      topRight: { ...box.borderRadius.topRight },\r\n      bottomRight: { ...box.borderRadius.bottomRight },\r\n      bottomLeft: { ...box.borderRadius.bottomLeft },\r\n    },\r\n    background: box.background\r\n      ? {\r\n          color: box.background.color ? { ...box.background.color } : undefined,\r\n          image: box.background.image\r\n            ? {\r\n                ...box.background.image,\r\n                rect: { ...box.background.image.rect },\r\n                originRect: { ...box.background.image.originRect },\r\n              }\r\n            : undefined,\r\n          gradient: box.background.gradient\r\n            ? {\r\n                ...box.background.gradient,\r\n                rect: { ...box.background.gradient.rect },\r\n                originRect: { ...box.background.gradient.originRect },\r\n              }\r\n            : undefined,\r\n        }\r\n      : { color: undefined },\r\n    textRuns: clonedRuns,\r\n    markerRect: box.markerRect ? { ...box.markerRect } : undefined,\r\n    boxShadows: box.boxShadows.map((s) => ({ ...s, color: { ...s.color } })),\r\n    links: box.links.map((link) => ({\r\n      rect: { ...link.rect },\r\n      target: { ...link.target },\r\n    })),\r\n    children: box.children.map((child) => cloneRenderBox(child)),\r\n  };\r\n\r\n  return clonedBox;\r\n}\r\n\r\n/**\r\n * Paints a rendered header/footer onto a page.\r\n */\r\nexport async function paintRenderedHeaderFooter(\r\n  painter: PagePainter,\r\n  rendered: RenderedHeaderFooter,\r\n  xOffsetPx: number,\r\n  yOffsetPx: number,\r\n  fontRegistry: FontRegistry,\r\n  pageOffsetY: number,\r\n): Promise<void> {\r\n  // Clone the tree to avoid mutating the original\r\n  const clonedRoot = cloneRenderBox(rendered.root);\r\n\r\n  // Enrich text runs with glyph data\r\n  const fontResolver = new FontRegistryResolver(fontRegistry);\r\n  await enrichTreeWithGlyphRuns(clonedRoot, fontResolver);\r\n\r\n  // Offset the tree to the correct position\r\n  offsetRenderTree(clonedRoot, xOffsetPx, yOffsetPx - pageOffsetY, false);\r\n\r\n  // Paint all boxes\r\n  const stack: RenderBox[] = [clonedRoot];\r\n  while (stack.length > 0) {\r\n    const box = stack.pop()!;\r\n    await paintBoxAtomic(painter, box);\r\n    // Add children in reverse order to paint in correct order\r\n    for (let i = box.children.length - 1; i >= 0; i--) {\r\n      stack.push(box.children[i]);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Calculates the configuration for page content area when headers/footers are present.\r\n */\r\nexport interface PageContentAreaConfig {\r\n  /** Y offset where content should start (after header) */\r\n  contentStartY: number;\r\n  /** Available height for content (excluding header and footer) */\r\n  contentHeightPx: number;\r\n  /** Y position where footer should be placed */\r\n  footerY: number;\r\n}\r\n\r\nexport function calculatePageContentArea(\r\n  pageHeightPx: number,\r\n  marginTop: number,\r\n  marginBottom: number,\r\n  headerHeightPx: number,\r\n  footerHeightPx: number,\r\n): PageContentAreaConfig {\r\n  // Header is placed at marginTop\r\n  // Content starts after header\r\n  const contentStartY = marginTop + headerHeightPx;\r\n\r\n  // Footer is placed at (pageHeight - marginBottom - footerHeight)\r\n  const footerY = pageHeightPx - marginBottom - footerHeightPx;\r\n\r\n  // Content height is the space between header and footer\r\n  const contentHeightPx = footerY - contentStartY;\r\n\r\n  return {\r\n    contentStartY,\r\n    contentHeightPx: Math.max(0, contentHeightPx),\r\n    footerY,\r\n  };\r\n}\r\n\r\nfunction normalizeHtmlFragment(html: string): string {\r\n  const hasHtmlTag = /<\\s*html[\\s>]/i.test(html);\r\n  if (hasHtmlTag) {\r\n    return html;\r\n  }\r\n  return `<!doctype html><html><head></head><body>${html}</body></html>`;\r\n}\r\n\r\nfunction isInlineDisplay(display: Display): boolean {\r\n  return (\r\n    display === Display.Inline ||\r\n    display === Display.InlineBlock ||\r\n    display === Display.InlineFlex ||\r\n    display === Display.InlineGrid ||\r\n    display === Display.InlineTable\r\n  );\r\n}\r\n\r\nfunction calculateTreeHeight(root: RenderBox): number {\r\n  let maxBottom = 0;\r\n\r\n  function traverse(box: RenderBox): void {\r\n    const bottom = box.borderBox.y + box.borderBox.height;\r\n    maxBottom = Math.max(maxBottom, bottom);\r\n    for (const child of box.children) {\r\n      traverse(child);\r\n    }\r\n  }\r\n\r\n  traverse(root);\r\n  return maxBottom;\r\n}\r\n\r\nasync function enrichTreeWithGlyphRuns(root: RenderBox, fontResolver: FontRegistryResolver): Promise<void> {\r\n  async function enrichRun(run: Run): Promise<void> {\r\n    if (run.glyphs) {\r\n      return;\r\n    }\r\n    try {\r\n      const font = await fontResolver.resolve(run.fontFamily, run.fontWeight, run.fontStyle);\r\n      const letterSpacing = run.letterSpacing ?? 0;\r\n      const glyphRun = computeGlyphRun(font, run.text, run.fontSize, letterSpacing);\r\n      applyWordSpacingToGlyphRun(glyphRun, run.text, run.wordSpacing);\r\n      run.glyphs = glyphRun;\r\n    } catch {\r\n      // Ignore font resolution errors for headers/footers\r\n    }\r\n  }\r\n\r\n  async function traverse(box: RenderBox): Promise<void> {\r\n    if (box.textRuns && box.textRuns.length > 0) {\r\n      for (const run of box.textRuns) {\r\n        await enrichRun(run);\r\n      }\r\n    }\r\n    for (const child of box.children) {\r\n      await traverse(child);\r\n    }\r\n  }\r\n\r\n  await traverse(root);\r\n}\r\n", "import type { RenderBox, TextPaintOptions, PageSize, Rect } from \"./types.js\";\r\nimport type { PagePainter } from \"./page-painter.js\";\nimport type { HeaderFooterVariant, HeaderFooterLayout } from \"./header-footer-layout.js\";\nimport type { FontRegistry } from \"./font/font-registry.js\";\nimport { applyPlaceholders } from \"./header-footer-tokens.js\";\nimport {\n  renderHeaderFooterHtml,\r\n  paintRenderedHeaderFooter,\n  type RenderedHeaderFooter,\n} from \"./header-footer-renderer.js\";\nimport { paintBoxAtomic } from \"./renderer/box-painter.js\";\nimport { log } from \"../logging/debug.js\";\nimport type { Environment } from \"../environment/environment.js\";\n\r\nexport interface HeaderFooterPaintContext {\n  /** Page margins in pixels */\n  margins: { top: number; right: number; bottom: number; left: number };\n  /** Page width in pixels */\n  pageWidthPx: number;\n  /** Page height in pixels */\r\n  pageHeightPx: number;\r\n  /** Font registry for text rendering */\r\n  fontRegistry: FontRegistry;\n  /** Page offset Y for coordinate transformation */\n  pageOffsetY: number;\n  /** Optional CSS for header/footer styling */\n  css?: string;\n  /** Platform environment (Node/browser) */\n  environment?: Environment;\n}\n\r\n/**\r\n * Renders and paints headers and footers as full HTML content.\r\n * This provides Word/mPDF-like behavior where headers and footers\r\n * are fully rendered HTML with complete styling support.\r\n */\r\nexport async function paintHeaderFooter(\r\n  painter: PagePainter,\r\n  header: HeaderFooterVariant | undefined,\r\n  footer: HeaderFooterVariant | undefined,\r\n  tokens: Map<string, string | ((page: number, total: number) => string)>,\r\n  pageIndex: number,\r\n  totalPages: number,\r\n  baseOptions: TextPaintOptions = { fontSizePt: 10 },\r\n  under = false,\r\n  context?: HeaderFooterPaintContext,\r\n): Promise<void> {\r\n  void under;\r\n\r\n  // If we have full context, use the new HTML rendering path\r\n  if (context) {\r\n    log(\"layout\", \"debug\", \"Using HTML rendering path for headers/footers\", {\r\n      hasHeader: !!header?.content,\r\n      hasFooter: !!footer?.content,\r\n      margins: context.margins,\r\n    });\r\n    await paintHeaderFooterWithContext(\r\n      painter,\r\n      header,\r\n      footer,\r\n      tokens,\r\n      pageIndex,\r\n      totalPages,\r\n      context,\r\n    );\r\n    return;\r\n  }\r\n\r\n  log(\"layout\", \"debug\", \"Using legacy text rendering for headers/footers (no context)\");\r\n  // Fallback to legacy text-only rendering for backwards compatibility\r\n  await paintHeaderFooterLegacy(painter, header, footer, tokens, pageIndex, totalPages, baseOptions);\r\n}\r\n\r\n/**\r\n * New HTML rendering path for headers/footers.\r\n * Renders headers and footers as full HTML through the layout pipeline.\r\n */\r\nasync function paintHeaderFooterWithContext(\r\n  painter: PagePainter,\r\n  header: HeaderFooterVariant | undefined,\r\n  footer: HeaderFooterVariant | undefined,\r\n  tokens: Map<string, string | ((page: number, total: number) => string)>,\r\n  pageIndex: number,\r\n  totalPages: number,\r\n  context: HeaderFooterPaintContext,\r\n): Promise<void> {\r\n  const { margins, pageWidthPx, pageHeightPx, fontRegistry, pageOffsetY, css } = context;\n\r\n  // Calculate content width (page width minus left and right margins)\r\n  const contentWidthPx = pageWidthPx - margins.left - margins.right;\r\n\r\n  log(\"layout\", \"debug\", \"paintHeaderFooterWithContext\", {\r\n    headerContent: header?.content ? String(header.content).slice(0, 100) : \"none\",\r\n    footerContent: footer?.content ? String(footer.content).slice(0, 100) : \"none\",\r\n    contentWidthPx,\r\n    pageWidthPx,\r\n    pageHeightPx,\r\n  });\r\n\r\n  // Render and paint header\r\n  if (header?.content) {\r\n    const headerHtml = stringify(header.content);\r\n    log(\"layout\", \"debug\", \"Rendering header HTML\", { headerHtml: headerHtml.slice(0, 200) });\r\n    if (headerHtml) {\r\n      try {\r\n        const rendered = await renderHeaderFooterHtml({\r\n          html: headerHtml,\r\n          css,\r\n          widthPx: contentWidthPx,\r\n          maxHeightPx: header.maxHeightPx,\r\n          tokens,\n          pageNumber: pageIndex,\n          totalPages,\n          environment: context.environment,\n        });\n\r\n        if (rendered) {\r\n          log(\"layout\", \"debug\", \"Header rendered successfully\", { heightPx: rendered.heightPx });\r\n          // Header is positioned at the top margin area\r\n          await paintRenderedHeaderFooter(\r\n            painter,\r\n            rendered,\r\n            margins.left,\r\n            margins.top,\r\n            fontRegistry,\r\n            pageOffsetY,\r\n          );\r\n        }\r\n      } catch (err) {\r\n        log(\"layout\", \"warn\", \"Failed to render header HTML\", { error: err });\r\n      }\r\n    }\r\n  }\r\n\r\n  // Render and paint footer\r\n  if (footer?.content) {\r\n    const footerHtml = stringify(footer.content);\r\n    if (footerHtml) {\r\n      try {\r\n        const rendered = await renderHeaderFooterHtml({\r\n          html: footerHtml,\r\n          css,\r\n          widthPx: contentWidthPx,\r\n          maxHeightPx: footer.maxHeightPx,\r\n          tokens,\n          pageNumber: pageIndex,\n          totalPages,\n          environment: context.environment,\n        });\n\r\n        if (rendered) {\r\n          // Footer is positioned at the bottom of the page\r\n          const footerY = pageHeightPx - margins.bottom - footer.maxHeightPx;\r\n          await paintRenderedHeaderFooter(\r\n            painter,\r\n            rendered,\r\n            margins.left,\r\n            footerY,\r\n            fontRegistry,\r\n            pageOffsetY,\r\n          );\r\n        }\r\n      } catch (err) {\r\n        log(\"layout\", \"warn\", \"Failed to render footer HTML\", { error: err });\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Legacy text-only rendering for headers/footers.\r\n * Used for backwards compatibility when context is not provided.\r\n */\r\nasync function paintHeaderFooterLegacy(\r\n  painter: PagePainter,\r\n  header: HeaderFooterVariant | undefined,\r\n  footer: HeaderFooterVariant | undefined,\r\n  tokens: Map<string, string | ((page: number, total: number) => string)>,\r\n  pageIndex: number,\r\n  totalPages: number,\r\n  baseOptions: TextPaintOptions,\r\n): Promise<void> {\r\n  const headerText = header?.content ? stringify(header.content) : undefined;\r\n  const footerText = footer?.content ? stringify(footer.content) : undefined;\r\n\r\n  if (headerText) {\r\n    const rendered = applyPlaceholders(headerText, tokens, pageIndex, totalPages);\r\n    await painter.drawText(rendered, 16, header?.maxHeightPx ?? 24, { ...baseOptions, absolute: true });\r\n  }\r\n\r\n  if (footerText) {\r\n    const rendered = applyPlaceholders(footerText, tokens, pageIndex, totalPages);\r\n    const yPx = painter.pageHeightPx ? painter.pageHeightPx - ((footer?.maxHeightPx ?? 24) + 16) : 16;\r\n    await painter.drawText(rendered, 16, yPx, { ...baseOptions, absolute: true });\r\n  }\r\n}\r\n\r\nfunction stringify(content: unknown): string {\r\n  if (content == null) {\r\n    return \"\";\r\n  }\r\n  if (typeof content === \"string\") {\r\n    return content;\r\n  }\r\n  if (typeof content === \"function\") {\r\n    return String(content());\r\n  }\r\n  return JSON.stringify(content);\r\n}\r\n", "import type { RenderBox } from \"../types.js\";\r\nimport type { StackingContextId, StackingContextNode, StackingFlags } from \"./types.js\";\r\n\r\n/**\r\n * Map a RenderBox to stacking-relevant flags.\r\n * Scope: only numeric z-index on positioned elements vs auto, per agreed constraints.\r\n */\r\nexport function getStackingFlags(box: RenderBox): StackingFlags {\r\n  const isPositioned = box.positioning.type !== \"normal\";\r\n  const raw = box.zIndexComputed;\r\n  const hasNumericZ = typeof raw === \"number\" && Number.isFinite(raw);\r\n  const zIndex: number | \"auto\" = hasNumericZ ? (raw as number) : \"auto\";\r\n\r\n  // For now, we only treat positioned+numeric z-index as establishing context.\r\n  const establishesContext = isPositioned && hasNumericZ;\r\n\r\n  return { isPositioned, zIndex, establishesContext };\r\n}\r\n\r\ninterface BuildResult {\r\n  rootContextId: StackingContextId;\r\n  contexts: Map<StackingContextId, StackingContextNode>;\r\n}\r\n\r\n/**\r\n * Build stacking contexts from the RenderBox tree.\r\n * - Root box always gets a root stacking context.\r\n * - Positioned elements with numeric z-index create their own stacking context.\r\n * - Other boxes belong to the nearest ancestor context.\r\n *\r\n * This module is SRP: it only builds the context graph; it does NOT decide paint order.\r\n */\r\nexport function buildStackingContexts(root: RenderBox): BuildResult {\r\n  const contexts = new Map<StackingContextId, StackingContextNode>();\r\n\r\n  // Root context anchored at the root box.\r\n  const rootContextId: StackingContextId = makeContextId(root, 0);\r\n  const rootContext: StackingContextNode = {\r\n    id: rootContextId,\r\n    box: root,\r\n    parentId: null,\r\n    childContextIds: [],\r\n  };\r\n  contexts.set(rootContextId, rootContext);\r\n\r\n  // DFS to assign boxes to contexts / create new ones as needed.\r\n  traverse(root, rootContextId, 1, contexts);\r\n\r\n  return { rootContextId, contexts };\r\n}\r\n\r\nfunction traverse(\r\n  box: RenderBox,\r\n  currentContextId: StackingContextId,\r\n  counterStart: number,\r\n  contexts: Map<StackingContextId, StackingContextNode>,\r\n): number {\r\n  let counter = counterStart;\r\n\r\n  for (const child of box.children) {\r\n    const flags = getStackingFlags(child);\r\n\r\n    if (flags.establishesContext) {\r\n      // Create new stacking context anchored at this child.\r\n      const ctxId = makeContextId(child, counter++);\r\n      const node: StackingContextNode = {\r\n        id: ctxId,\r\n        box: child,\r\n        parentId: currentContextId,\r\n        childContextIds: [],\r\n      };\r\n      contexts.set(ctxId, node);\r\n\r\n      const parent = contexts.get(currentContextId);\r\n      if (parent) {\r\n        parent.childContextIds.push(ctxId);\r\n      }\r\n\r\n      // Recurse with the new context as current.\r\n      counter = traverse(child, ctxId, counter, contexts);\r\n    } else {\r\n      // Child participates in the current context.\r\n      counter = traverse(child, currentContextId, counter, contexts);\r\n    }\r\n  }\r\n\r\n  return counter;\r\n}\r\n\r\nfunction makeContextId(box: RenderBox, suffix: number): StackingContextId {\r\n  // Stable but simple: use box id plus local counter.\r\n  return `${box.id || \"ctx\"}-${suffix}`;\r\n}\r\n", "import type { RenderBox } from \"../types.js\";\r\nimport { buildStackingContexts, getStackingFlags } from \"./build-stacking-contexts.js\";\r\nimport type { PaintStep, StackingContextId, StackingContextNode } from \"./types.js\";\r\n\r\n/**\r\n * Resolve a global paint order from the RenderBox tree using stacking contexts.\r\n *\r\n * Scope (step 1):\r\n * - Support numeric z-index on positioned elements (absolute/fixed/etc.) vs auto.\r\n * - Respect DOM order for ties.\r\n * - Treat each box as an atomic paint unit (background+border+content together).\r\n * - Keep API simple: return ordered RenderBox list.\r\n */\r\nexport function resolvePaintOrder(root: RenderBox): RenderBox[] {\r\n  const { rootContextId, contexts } = buildStackingContexts(root);\r\n  const steps: PaintStep[] = [];\r\n\r\n  resolveContextPaintOrder(rootContextId, contexts, steps);\r\n  return steps.map((s) => s.box);\r\n}\r\n\r\n/**\r\n * Compute paint order within a stacking context and append PaintSteps.\r\n *\r\n * Simplified rules (sufficient for our current constraints):\r\n * For a given context:\r\n *   1. Paint the context root box itself.\r\n *   2. Paint descendants with negative z-index (positioned).\r\n *   3. Paint normal-flow descendants (z-index: auto).\r\n *   4. Paint positioned descendants with z-index >= 0 in ascending z-index.\r\n *\r\n * DOM order is preserved within each group as tie-breaker.\r\n * Nested stacking contexts are treated as atomic units via recursion.\r\n */\r\nfunction resolveContextPaintOrder(\r\n  contextId: StackingContextId,\r\n  contexts: Map<StackingContextId, StackingContextNode>,\r\n  out: PaintStep[],\r\n): void {\r\n  const context = contexts.get(contextId);\r\n  if (!context) return;\r\n\r\n  const rootBox = context.box;\r\n\r\n  // 1. Paint the context root box as an atomic unit.\r\n  out.push({ box: rootBox });\r\n\r\n  // Collect direct descendants belonging to this context (non-root boxes).\r\n  const descendants: RenderBox[] = [];\r\n  collectDescendantsInContext(rootBox, contextId, contexts, descendants);\r\n\r\n  const negativeZ: RenderBox[] = [];\r\n  const normalFlowAutoZ: RenderBox[] = [];\r\n  const positionedNonNegative: RenderBox[] = [];\r\n\r\n  for (const box of descendants) {\r\n    const flags = getStackingFlags(box);\r\n\r\n    if (flags.isPositioned && flags.zIndex !== \"auto\") {\r\n      const z = flags.zIndex as number;\r\n      if (z < 0) {\r\n        negativeZ.push(box);\r\n      } else {\r\n        positionedNonNegative.push(box);\r\n      }\r\n    } else {\r\n      // Non-positioned or auto z-index participate in the auto flow group.\r\n      normalFlowAutoZ.push(box);\r\n    }\r\n  }\r\n\r\n  // 2. Negative z-index positioned descendants (ascending z, DOM order for ties).\r\n  negativeZ.sort((a, b) => {\r\n    const az = (getStackingFlags(a).zIndex as number) ?? 0;\r\n    const bz = (getStackingFlags(b).zIndex as number) ?? 0;\r\n    if (az !== bz) return az - bz;\r\n    return 0; // DOM order already in descendants list.\r\n  });\r\n  for (const box of negativeZ) {\r\n    appendBoxOrContext(box, contextId, contexts, out);\r\n  }\r\n\r\n  // 3. Normal flow / auto z-index descendants (DOM order).\r\n  for (const box of normalFlowAutoZ) {\r\n    appendBoxOrContext(box, contextId, contexts, out);\r\n  }\r\n\r\n  // 4. Positioned non-negative z-index descendants (ascending z, DOM order ties).\r\n  positionedNonNegative.sort((a, b) => {\r\n    const az = (getStackingFlags(a).zIndex as number) ?? 0;\r\n    const bz = (getStackingFlags(b).zIndex as number) ?? 0;\r\n    if (az !== bz) return az - bz;\r\n    return 0;\r\n  });\r\n  for (const box of positionedNonNegative) {\r\n    appendBoxOrContext(box, contextId, contexts, out);\r\n  }\r\n}\r\n\r\n/**\r\n * Append either a nested stacking context or a regular box.\r\n * Nested contexts are treated as atomic units: we delegate to resolveContextPaintOrder.\r\n */\r\nfunction appendBoxOrContext(\r\n  box: RenderBox,\r\n  parentContextId: StackingContextId,\r\n  contexts: Map<StackingContextId, StackingContextNode>,\r\n  out: PaintStep[],\r\n): void {\r\n  const nested = findContextByBox(box, parentContextId, contexts);\r\n  if (nested) {\r\n    resolveContextPaintOrder(nested.id, contexts, out);\r\n  } else {\r\n    out.push({ box });\r\n  }\r\n}\r\n\r\n/**\r\n * Collect descendants that belong to the given context (i.e. do not start\r\n * their own stacking context), in DOM order.\r\n */\r\nfunction collectDescendantsInContext(\r\n  box: RenderBox,\r\n  contextId: StackingContextId,\r\n  contexts: Map<StackingContextId, StackingContextNode>,\r\n  out: RenderBox[],\r\n): void {\r\n  for (const child of box.children) {\r\n    const childCtx = findContextByBox(child, null, contexts);\r\n    if (childCtx && childCtx.id !== contextId) {\r\n      // Child begins its own stacking context; treat that context atomically later.\r\n      // Do not inline its descendants here.\r\n      out.push(child);\r\n      continue;\r\n    }\r\n\r\n    out.push(child);\r\n    collectDescendantsInContext(child, contextId, contexts, out);\r\n  }\r\n}\r\n\r\n/**\r\n * Find a stacking context node anchored at the given box.\r\n * If parentContextId is provided, only match contexts whose parentId equals it.\r\n */\r\nfunction findContextByBox(\r\n  box: RenderBox,\r\n  parentContextId: StackingContextId | null,\r\n  contexts: Map<StackingContextId, StackingContextNode>,\r\n): StackingContextNode | undefined {\r\n  for (const ctx of contexts.values()) {\r\n    if (ctx.box === box && (parentContextId === null || ctx.parentId === parentContextId)) {\r\n      return ctx;\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n", "import type {\r\n  LayoutPageTree,\r\n  RenderBox,\r\n  PositionedLayer,\r\n  DecorationCommand,\r\n  Link,\r\n} from \"./types.js\";\r\nimport { resolvePaintOrder } from \"./stacking/resolve-paint-order.js\";\r\n\r\nexport interface PaginationOptions {\r\n  pageHeight: number;\r\n}\r\n\r\nexport function paginateTree(root: RenderBox, options: PaginationOptions): LayoutPageTree[] {\r\n  const pageHeight = Number.isFinite(options.pageHeight) && options.pageHeight > 0 ? options.pageHeight : 1;\r\n\r\n  const paintOrderAll = resolvePaintOrder(root);\r\n  const flowOrderAll = collectFlowOrder(root);\r\n  const positionedAll = collectPositionedLayers(root);\r\n  const linksAll = collectLinks(root);\r\n\r\n  const documentHeight = resolveDocumentHeight(paintOrderAll);\r\n  const totalPages = Math.max(1, Math.ceil(documentHeight / pageHeight));\r\n\r\n  const pages: LayoutPageTree[] = [];\r\n\r\n  for (let index = 0; index < totalPages; index++) {\r\n    const pageTop = index * pageHeight;\r\n    const pageBottom = pageTop + pageHeight;\r\n\r\n    const paintOrder = paintOrderAll.filter((box) => intersectsVerticalSlice(box, pageTop, pageBottom));\r\n    const flowContentOrder = flowOrderAll.filter((box) => intersectsVerticalSlice(box, pageTop, pageBottom));\r\n    const positionedLayersSortedByZ = filterPositionedLayers(positionedAll, pageTop, pageBottom);\r\n    const links = filterLinks(linksAll, pageTop, pageBottom, pageTop);\r\n\r\n    const decorations: DecorationCommand[] = []; // Placeholder until decoration pagination is implemented\r\n\r\n    pages.push({\r\n      paintOrder,\r\n      floatLayerOrder: [],\r\n      flowContentOrder,\r\n      positionedLayersSortedByZ,\r\n      decorations,\r\n      links,\r\n      pageOffsetY: pageTop,\r\n    });\r\n  }\r\n\r\n  return pages;\r\n}\r\n\r\n\r\nfunction collectFlowOrder(root: RenderBox): RenderBox[] {\r\n  const result: RenderBox[] = [];\r\n  dfs(root, (box) => {\r\n    result.push(box);\r\n    return box.positioning.type === \"normal\";\r\n  });\r\n  return result;\r\n}\r\n\r\nfunction collectPositionedLayers(_root: RenderBox): PositionedLayer[] {\r\n  // Positioned layers are not yet implemented; return empty array to keep the pipeline stable.\r\n  return [];\r\n}\r\n\r\nfunction collectLinks(root: RenderBox): Link[] {\r\n  const links: Link[] = [];\r\n  dfs(root, (box) => {\r\n    links.push(...box.links);\r\n    return true;\r\n  });\r\n  return links;\r\n}\r\n\r\nfunction filterPositionedLayers(layers: PositionedLayer[], top: number, bottom: number): PositionedLayer[] {\r\n  const result: PositionedLayer[] = [];\r\n  for (const layer of layers) {\r\n    const boxes = layer.boxes.filter((box) => intersectsVerticalSlice(box, top, bottom));\r\n    if (boxes.length > 0) {\r\n      result.push({ z: layer.z, boxes });\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction filterLinks(links: Link[], top: number, bottom: number, offset: number): Link[] {\r\n  const result: Link[] = [];\r\n  for (const link of links) {\r\n    const linkTop = link.rect.y;\r\n    const linkBottom = link.rect.y + Math.max(link.rect.height, 0);\r\n    if (linkBottom <= top || linkTop >= bottom) {\r\n      continue;\r\n    }\r\n    result.push({\r\n      rect: {\r\n        x: link.rect.x,\r\n        y: link.rect.y - offset,\r\n        width: link.rect.width,\r\n        height: link.rect.height,\r\n      },\r\n      target: { ...link.target },\r\n    });\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction resolveDocumentHeight(boxes: RenderBox[]): number {\r\n  let maxBottom = 0;\r\n  for (const box of boxes) {\r\n    const span = getBoxVerticalSpan(box);\r\n    maxBottom = Math.max(maxBottom, span.bottom);\r\n  }\r\n  return maxBottom;\r\n}\r\n\r\nfunction intersectsVerticalSlice(box: RenderBox, sliceTop: number, sliceBottom: number): boolean {\r\n  const span = getBoxVerticalSpan(box);\r\n  return span.bottom > sliceTop && span.top < sliceBottom;\r\n}\r\n\r\nfunction getBoxVerticalSpan(box: RenderBox): { top: number; bottom: number } {\r\n  const referenceRect = box.visualOverflow ?? box.borderBox ?? box.contentBox;\r\n  let top = referenceRect ? referenceRect.y : box.contentBox.y;\r\n  let bottom = referenceRect ? referenceRect.y + Math.max(referenceRect.height, 0) : box.contentBox.y + Math.max(box.contentBox.height, 0);\r\n\r\n  if (!Number.isFinite(top)) {\r\n    top = 0;\r\n  }\r\n  if (!Number.isFinite(bottom)) {\r\n    bottom = top;\r\n  }\r\n\r\n  if (box.textRuns.length > 0) {\r\n    for (const run of box.textRuns) {\r\n      const baseline = run.lineMatrix?.f ?? 0;\r\n      const ascent = run.fontSize;\r\n      const descent = Math.max(run.fontSize * 0.2, 0);\r\n      top = Math.min(top, baseline - ascent);\r\n      bottom = Math.max(bottom, baseline + descent);\r\n    }\r\n  }\r\n\r\n  return { top, bottom };\r\n}\r\n\r\nfunction dfs(node: RenderBox, visitor: (box: RenderBox) => boolean): void {\r\n  const descend = visitor(node);\r\n  if (!descend) {\r\n    return;\r\n  }\r\n  for (const child of node.children) {\r\n    dfs(child, visitor);\r\n  }\r\n}\r\n", "/* The UNICODE_TO_WIN_ANSI map is defined in pdf/utils/encoding.ts */\r\nimport { UNICODE_TO_WIN_ANSI } from \"../pdf/utils/encoding.js\";\r\n\r\nexport function needsUnicode(text: string): boolean {\r\n  for (const ch of Array.from(text)) {\r\n    const cp = ch.codePointAt(0)!;\r\n    if (!UNICODE_TO_WIN_ANSI.has(cp)) return true; // \u2713 \u2605, combining, etc.\r\n  }\r\n  return false;\r\n}\r\n\r\n// Extend Intl type for Segmenter\r\ndeclare global {\r\n  namespace Intl {\r\n    class Segmenter {\r\n      constructor(locales?: string | string[], options?: any);\r\n      segment(input: string): any;\r\n    }\r\n  }\r\n}\r\n\r\n// @ts-ignore: Intl.Segmenter may not be available in older environments\r\nexport function normalizeAndSegment(text: string): string[] {\r\n  const normalized = text.normalize(\"NFC\");\r\n  // Fallback for environments without Intl.Segmenter\r\n  if (typeof Intl !== \"undefined\" && Intl.Segmenter) {\r\n    const seg = new Intl.Segmenter(\"pt\", { granularity: \"grapheme\" });\r\n    return [...seg.segment(normalized)].map(s => s.segment);\r\n  } else {\r\n    // Simple grapheme splitting by character (not perfect but better than nothing)\r\n    return Array.from(normalized);\r\n  }\r\n}\r\n", "import type { FontMetrics, FontProgram } from \"../../fonts/types.js\";\r\nimport { createToUnicodeCMapText } from \"./to-unicode.js\";\n\r\n/**\r\n * Represents a subsetted font ready for PDF embedding.\r\n */\r\nexport interface PdfFontSubset {\n    name: string;\n    firstChar: number;\n    lastChar: number;\n    widths: number[];\n    toUnicodeCMap: string;\n    fontFile: Uint8Array;\n    encodeGlyph(gid: number): number;\n    /**\n     * Ordered glyph IDs included in this subset. The position in this array matches\n     * the width entries when using identity encoding.\n     */\n    glyphIds: number[];\n}\n\n/**\n * Options for creating a PDF font subset.\n */\nexport interface PdfFontSubsetOptions {\n    baseName: string;\n    fontMetrics: FontMetrics;\n    fontProgram: FontProgram;\n    usedGlyphIds: Set<number>;\n    /**\n     * Controls how glyph IDs are mapped to PDF character codes.\n     * - \"identity\" keeps CIDs = glyph IDs (suitable for CIDToGIDMap /Identity).\n     * - \"sequential\" densely re-encodes glyphs starting at 0.\n     */\n    encoding?: \"identity\" | \"sequential\";\n}\n\n/**\n * Creates a PDF font subset for TTF fonts.\n */\nexport function createPdfFontSubset(options: PdfFontSubsetOptions): PdfFontSubset {\n    const { baseName, fontMetrics, fontProgram, usedGlyphIds } = options;\n    const encoding = options.encoding ?? \"identity\";\n\n    const glyphIds = Array.from(usedGlyphIds).sort((a, b) => a - b);\n    if (!glyphIds.includes(0)) {\n        glyphIds.unshift(0);\n    }\n\n    const gidToCharCode = new Map<number, number>();\n\n    if (encoding === \"identity\") {\n        for (const gid of glyphIds) {\n            gidToCharCode.set(gid, gid);\n        }\n    } else {\n        for (let i = 0; i < glyphIds.length; i++) {\n            gidToCharCode.set(glyphIds[i], i);\n        }\n    }\n\n    const firstChar = encoding === \"identity\" ? Math.min(...glyphIds) : 0;\n    const lastChar = encoding === \"identity\" ? Math.max(...glyphIds) : glyphIds.length - 1;\n\n    const unitsPerEm = fontMetrics.metrics.unitsPerEm;\n    const widths: number[] = [];\n    if (encoding === \"identity\") {\n        for (const gid of glyphIds) {\n            const glyphMetric = fontMetrics.glyphMetrics.get(gid);\n            const advanceWidth = glyphMetric?.advanceWidth ?? 0;\n            const pdfWidth = Math.round((advanceWidth / unitsPerEm) * 1000);\n            widths.push(pdfWidth);\n        }\n    } else {\n        for (const gid of glyphIds) {\n            const glyphMetric = fontMetrics.glyphMetrics.get(gid);\n            const advanceWidth = glyphMetric?.advanceWidth ?? 0;\n            const pdfWidth = Math.round((advanceWidth / unitsPerEm) * 1000);\n            widths.push(pdfWidth);\n        }\n    }\n\n    const cmapEntries: { gid: number; unicode: number }[] = [];\n    const unicodeMap = fontMetrics.cmap.unicodeMap;\n\n    for (const gid of glyphIds) {\n        let unicode: number | undefined;\n        for (const [cp, mappedGid] of unicodeMap.entries()) {\n            if (mappedGid === gid) {\n                unicode = cp;\n                break;\n            }\n        }\n        if (unicode !== undefined) {\n            const cid = gidToCharCode.get(gid);\n            if (cid !== undefined) {\n                cmapEntries.push({ gid: cid, unicode });\n            }\n        }\n    }\n\n    const toUnicodeCMap = createToUnicodeCMapText(cmapEntries);\n    const fontFile = extractFontFile(fontProgram);\n\n    const encodeGlyph = (gid: number): number => {\n        const charCode = gidToCharCode.get(gid);\n        if (charCode === undefined) {\n            throw new Error(`Glyph ID ${gid} not found in subset`);\n        }\n        return charCode;\r\n    };\r\n\r\n    return {\n        name: `/${baseName}`,\n        firstChar,\n        lastChar,\n        widths,\n        toUnicodeCMap,\n        fontFile,\n        encodeGlyph,\n        glyphIds,\n    };\n}\n\r\n/**\r\n * Extracts the font file from FontProgram.\r\n * Builds a complete TTF with all available tables.\r\n */\r\nfunction extractFontFile(fontProgram: FontProgram): Uint8Array {\r\n    if (fontProgram.getRawTableData) {\r\n        return buildTtfFromTables(fontProgram);\r\n    }\r\n\r\n    console.warn(\"Font subsetting not fully implemented; no raw table data available\");\r\n    return new Uint8Array(0);\r\n}\r\n\r\n/**\r\n * Builds a complete TTF file from available tables in FontProgram.\r\n */\r\nfunction buildTtfFromTables(fontProgram: FontProgram): Uint8Array {\r\n    const tableTags = [\r\n        'head', 'hhea', 'maxp', 'OS/2', 'hmtx', 'cmap',\r\n        'loca', 'glyf', 'name', 'post', 'cvt ', 'fpgm', 'prep'\r\n    ];\r\n\r\n    const tables: Map<string, Uint8Array> = new Map();\r\n\r\n    for (const tag of tableTags) {\r\n        const data = fontProgram.getRawTableData!(tag);\r\n        if (data && data.length > 0) {\r\n            tables.set(tag, data);\r\n        }\r\n    }\r\n\r\n    if (tables.size === 0) {\r\n        console.warn(\"No TTF tables available for font subsetting\");\r\n        return new Uint8Array(0);\r\n    }\r\n\r\n    const numTables = tables.size;\r\n    const searchRange = Math.pow(2, Math.floor(Math.log2(numTables))) * 16;\r\n    const entrySelector = Math.floor(Math.log2(numTables));\r\n    const rangeShift = numTables * 16 - searchRange;\r\n\r\n    const headerSize = 12;\r\n    const directorySize = numTables * 16;\r\n    let dataSize = 0;\r\n    for (const data of tables.values()) {\r\n        dataSize += data.length + (4 - (data.length % 4)) % 4;\r\n    }\r\n\r\n    const totalSize = headerSize + directorySize + dataSize;\r\n    const buffer = new ArrayBuffer(totalSize);\r\n    const view = new DataView(buffer);\r\n    const bytes = new Uint8Array(buffer);\r\n\r\n    view.setUint32(0, 0x00010000, false);\r\n    view.setUint16(4, numTables, false);\r\n    view.setUint16(6, searchRange, false);\r\n    view.setUint16(8, entrySelector, false);\r\n    view.setUint16(10, rangeShift, false);\r\n\r\n    let directoryOffset = 12;\r\n    let dataOffset = headerSize + directorySize;\r\n\r\n    for (const [tag, data] of tables) {\r\n        const tagBytes = new TextEncoder().encode(tag.padEnd(4));\r\n        bytes.set(tagBytes.slice(0, 4), directoryOffset);\r\n\r\n        const checksum = calculateTableChecksum(data);\r\n        view.setUint32(directoryOffset + 4, checksum, false);\r\n        view.setUint32(directoryOffset + 8, dataOffset, false);\r\n        view.setUint32(directoryOffset + 12, data.length, false);\r\n\r\n        bytes.set(data, dataOffset);\r\n\r\n        const paddedLength = data.length + (4 - (data.length % 4)) % 4;\r\n\r\n        directoryOffset += 16;\r\n        dataOffset += paddedLength;\r\n    }\r\n\r\n    updateHeadChecksum(bytes, view, tables);\r\n\r\n    return bytes;\r\n}\r\n\r\n/**\r\n * Calculate TTF table checksum\r\n */\r\nfunction calculateTableChecksum(data: Uint8Array): number {\r\n    let sum = 0;\r\n    const view = new DataView(data.buffer, data.byteOffset, data.byteLength);\r\n    const nLongs = Math.floor(data.length / 4);\r\n\r\n    for (let i = 0; i < nLongs; i++) {\r\n        sum = (sum + view.getUint32(i * 4, false)) >>> 0;\r\n    }\r\n\r\n    const remaining = data.length % 4;\r\n    if (remaining > 0) {\r\n        let last = 0;\r\n        for (let i = 0; i < remaining; i++) {\r\n            last = (last << 8) | data[nLongs * 4 + i];\r\n        }\r\n        last = last << ((4 - remaining) * 8);\r\n        sum = (sum + last) >>> 0;\r\n    }\r\n\r\n    return sum >>> 0;\r\n}\r\n\r\n/**\r\n * Update the checkSumAdjustment field in the head table\r\n */\r\nfunction updateHeadChecksum(bytes: Uint8Array, view: DataView, tables: Map<string, Uint8Array>): void {\r\n    const numTables = tables.size;\r\n    let headOffset = -1;\r\n\r\n    for (let i = 0; i < numTables; i++) {\r\n        const dirOffset = 12 + i * 16;\r\n        const tag = new TextDecoder().decode(bytes.slice(dirOffset, dirOffset + 4));\r\n        if (tag.trim() === 'head') {\r\n            headOffset = view.getUint32(dirOffset + 8, false);\r\n            break;\r\n        }\r\n    }\r\n\r\n    if (headOffset === -1) return;\r\n\r\n    view.setUint32(headOffset + 8, 0, false);\r\n\r\n    const fileChecksum = calculateTableChecksum(bytes);\r\n\r\n    const adjustment = (0xB1B0AFBA - fileChecksum) >>> 0;\r\n    view.setUint32(headOffset + 8, adjustment, false);\r\n}\r\n", "import type { UnifiedFont } from \"../../fonts/types.js\";\r\nimport type { GlyphRun } from \"../../layout/text-run.js\";\r\nimport { createPdfFontSubset, type PdfFontSubset } from \"../font/font-subset.js\";\r\n\r\n/**\r\n * Combines a PDF font subset with its source UnifiedFont.\r\n */\r\nexport interface PdfFontHandle {\r\n    subset: PdfFontSubset;\r\n    unifiedFont: UnifiedFont;\r\n}\r\n\r\n/**\r\n * Manages font subsets for PDF generation.\r\n * Collects glyph usage across the document and creates font subsets on demand.\r\n */\r\nexport class PdfFontRegistry {\n    // Map from font key to set of used glyph IDs\n    private readonly glyphUsage = new Map<string, Set<number>>();\n\n    // Map from font key to PdfFontHandle (lazily created)\n    private readonly fonts = new Map<string, PdfFontHandle>();\n\n    // Counter for generating unique font resource names\n    private fontCounter = 0;\n\n    constructor(private readonly encoding: \"identity\" | \"sequential\" = \"identity\") {}\n\r\n    /**\r\n     * Generates a stable key for a UnifiedFont.\r\n     * Uses CSS metadata if available, otherwise falls back to a generic key.\r\n     */\r\n    private fontKey(font: UnifiedFont): string {\r\n        if (font.css) {\r\n            const { family, weight, style } = font.css;\r\n            return `${family}|${weight}|${style}`;\r\n        }\r\n\r\n        // Fallback: use unitsPerEm and ascender as a fingerprint\r\n        const { unitsPerEm, ascender } = font.metrics.metrics;\r\n        return `_fallback_${unitsPerEm}_${ascender}`;\r\n    }\r\n\r\n    /**\r\n     * Registers a GlyphRun, collecting its glyph IDs for later subsetting.\r\n     */\r\n    registerGlyphRun(run: GlyphRun): void {\r\n        const key = this.fontKey(run.font);\r\n        let usage = this.glyphUsage.get(key);\r\n\r\n        if (!usage) {\r\n            usage = new Set<number>();\r\n            this.glyphUsage.set(key, usage);\r\n        }\r\n\r\n        // Add all glyph IDs from this run\r\n        for (const gid of run.glyphIds) {\r\n            usage.add(gid);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Ensures a font subset exists for the given UnifiedFont.\r\n     * Creates the subset lazily if it doesn't exist yet.\r\n     */\r\n    ensureSubsetFor(font: UnifiedFont): PdfFontHandle {\n        const key = this.fontKey(font);\n\n        // Get the collected glyph IDs for this font\n        const usedGlyphIds = this.glyphUsage.get(key) ?? new Set<number>([0]);\n        if (!this.glyphUsage.has(key)) {\n            this.glyphUsage.set(key, usedGlyphIds);\n        }\n        usedGlyphIds.add(0);\n\n        const existing = this.fonts.get(key);\n        if (existing && this.subsetCoversGlyphs(existing.subset, usedGlyphIds)) {\n            return existing;\n        }\n\n        // Re-use the prior base name when refreshing a subset so aliases stay stable.\n        const existingBaseName = existing?.subset.name.startsWith(\"/\") ? existing.subset.name.slice(1) : undefined;\n        const baseName = existingBaseName ?? `F${++this.fontCounter}`;\n        const subset = createPdfFontSubset({\n            baseName,\n            fontMetrics: font.metrics,\n            fontProgram: font.program,\n            usedGlyphIds,\n            encoding: this.encoding,\n        });\n\r\n        const handle: PdfFontHandle = {\r\n            subset,\r\n            unifiedFont: font,\r\n        };\r\n\n        this.fonts.set(key, handle);\n        return handle;\n    }\n\n    /**\n     * Checks whether an existing subset already contains every glyph we've seen.\n     */\n    private subsetCoversGlyphs(subset: PdfFontSubset, glyphs: Set<number>): boolean {\n        const inSubset = new Set(subset.glyphIds);\n        for (const gid of glyphs) {\n            if (!inSubset.has(gid)) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    /**\n     * Returns all font subsets created so far.\n     */\n    getAllSubsets(): Iterable<PdfFontHandle> {\n        return this.fonts.values();\n    }\r\n\r\n    /**\r\n     * Returns the total number of fonts registered.\r\n     */\r\n    getFontCount(): number {\r\n        return this.fonts.size;\r\n    }\r\n}\r\n", "/**\r\n * CSS @font-face parsing utilities.\r\n * \r\n * This module handles parsing of CSS @font-face rules from stylesheets,\r\n * including font family list parsing, weight matching, and source extraction.\r\n */\r\n\r\nimport type { CSSFontFace, StyleSheets } from \"../pdf/types.js\";\r\nimport { normalizeFontWeight, parseFontWeightValue } from \"./font-weight.js\";\r\n\r\n/**\r\n * Result of parsing font faces from stylesheets.\r\n */\r\nexport interface ParsedFontFaceMap {\r\n    /**\r\n     * Map of normalized font family names to their @font-face definitions.\r\n     */\r\n    facesByFamily: Map<string, CSSFontFace[]>;\r\n}\r\n\r\n/**\r\n * Parse all @font-face definitions from stylesheets into a family-keyed map.\r\n * \r\n * @param stylesheets - StyleSheets containing font face definitions\r\n * @returns Map of font families to their face definitions\r\n * \r\n * @example\r\n * ```typescript\r\n * const { facesByFamily } = parseFontFaces(stylesheets);\r\n * const tinosFaces = facesByFamily.get(\"tinos\");\r\n * ```\r\n */\r\nexport function parseFontFaces(stylesheets: StyleSheets): ParsedFontFaceMap {\r\n    const facesByFamily = new Map<string, CSSFontFace[]>();\r\n\r\n    for (const face of stylesheets.fontFaces ?? []) {\r\n        const family = normalizeToken(face.family);\r\n        if (!family) {\r\n            continue;\r\n        }\r\n        const list = facesByFamily.get(family) ?? [];\r\n        list.push(face);\r\n        facesByFamily.set(family, list);\r\n    }\r\n\r\n    return { facesByFamily };\r\n}\r\n\r\n/**\r\n * Select the best @font-face from a list based on requested weight.\r\n * \r\n * Chooses the face with the smallest weight difference from the requested weight.\r\n * Falls back to the first face if no weight information is available.\r\n * \r\n * @param faces - Array of font faces to select from\r\n * @param requestedWeight - Desired font weight (100-900)\r\n * @returns Best matching font face, or undefined if faces array is empty\r\n */\r\nexport function selectFaceForWeight(faces: CSSFontFace[], requestedWeight: number): CSSFontFace | undefined {\r\n    let bestFace: CSSFontFace | undefined;\r\n    let smallestDiff = Number.POSITIVE_INFINITY;\r\n\r\n    for (const face of faces) {\r\n        const faceWeight = parseFaceWeight(face.weight, requestedWeight);\r\n        if (faceWeight === null) {\r\n            if (!bestFace) {\r\n                bestFace = face;\r\n            }\r\n            continue;\r\n        }\r\n        const diff = Math.abs(faceWeight - requestedWeight);\r\n        if (diff < smallestDiff) {\r\n            smallestDiff = diff;\r\n            bestFace = face;\r\n        }\r\n    }\r\n\r\n    return bestFace ?? faces[0];\r\n}\r\n\r\n/**\r\n * Parse a font family list (comma-separated) into individual family names.\r\n * \r\n * Handles quoted family names and filters out empty tokens.\r\n * \r\n * @param value - Comma-separated font family string\r\n * @returns Array of normalized family names\r\n * \r\n * @example\r\n * ```typescript\r\n * parseFamilyList(\"'Times New Roman', Times, serif\")\r\n * // => [\"Times New Roman\", \"Times\", \"serif\"]\r\n * ```\r\n */\r\nexport function parseFamilyList(value: string | undefined): string[] {\r\n    if (!value) {\r\n        return [];\r\n    }\r\n    return value\r\n        .split(\",\")\r\n        .map((token) => stripQuotes(token.trim()))\r\n        .filter((token) => token.length > 0);\r\n}\r\n\r\n/**\r\n * Check if a font style is italic or oblique.\r\n * \r\n * @param style - Font style value\r\n * @returns True if style is \"italic\" or \"oblique\" (case-insensitive)\r\n */\r\nexport function isItalicStyle(style: string | undefined): boolean {\r\n    if (!style) {\r\n        return false;\r\n    }\r\n    const normalized = style.toLowerCase();\r\n    return normalized === \"italic\" || normalized === \"oblique\";\r\n}\r\n\r\n/**\r\n * Normalize a font family or token to lowercase and remove quotes.\r\n * \r\n * @param value - Token to normalize\r\n * @returns Normalized lowercase string, or empty string if value is undefined\r\n */\r\nexport function normalizeToken(value: string | undefined): string {\r\n    if (!value) {\r\n        return \"\";\r\n    }\r\n    return stripQuotes(value).trim().toLowerCase();\r\n}\r\n\r\n/**\r\n * Remove surrounding quotes from a string.\r\n * \r\n * Handles both single and double quotes.\r\n * \r\n * @param value - String potentially wrapped in quotes\r\n * @returns String with quotes removed, or original value if not quoted\r\n */\r\nexport function stripQuotes(value: string): string {\r\n    if ((value.startsWith('\"') && value.endsWith('\"')) || (value.startsWith(\"'\") && value.endsWith(\"'\"))) {\r\n        return value.slice(1, -1);\r\n    }\r\n    return value;\r\n}\r\n\r\n/**\r\n * Extract base font name from a @font-face definition using aliases.\r\n * \r\n * Checks both local() sources and the family name against the provided alias map.\r\n * \r\n * @param face - @font-face definition\r\n * @param aliases - Map of font names to their aliases\r\n * @returns Base font name if found, null otherwise\r\n */\r\nexport function baseFontFromFace(face: CSSFontFace, aliases: ReadonlyMap<string, string>): string | null {\r\n    const localName = extractLocalSource(face.src);\r\n    if (localName) {\r\n        const normalized = normalizeToken(localName);\r\n        const alias = aliases.get(normalized);\r\n        if (alias) {\r\n            return alias;\r\n        }\r\n    }\r\n    const familyAlias = aliases.get(normalizeToken(face.family));\r\n    if (familyAlias) {\r\n        return familyAlias;\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Extract the first local() font source from a src list.\r\n * \r\n * @param srcList - Array of font source strings (e.g., [\"local('Arial')\", \"url(...))\"])\r\n * @returns Local font name if found, null otherwise\r\n * \r\n * @example\r\n * ```typescript\r\n * extractLocalSource([\"local('Arial')\", \"url(arial.woff2)\"])\r\n * // => \"Arial\"\r\n * ```\r\n */\r\nexport function extractLocalSource(srcList: string[]): string | null {\r\n    for (const src of srcList) {\r\n        const match = src.match(/local\\(([^)]+)\\)/i);\r\n        if (match) {\r\n            return stripQuotes(match[1].trim());\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Parse a @font-face weight value into a numeric weight.\r\n * \r\n * Handles:\r\n * - Numeric weights (already normalized)\r\n * - String values (\"normal\", \"bold\", \"400\", etc.)\r\n * - Multiple weights (chooses closest to fallback)\r\n * \r\n * @param value - Weight value from @font-face\r\n * @param fallback - Fallback weight to use for choosing from multiple values\r\n * @returns Normalized numeric weight (100-900), or null if unparseable\r\n */\r\nfunction parseFaceWeight(value: string | number | undefined, fallback: number): number | null {\r\n    if (typeof value === \"number\") {\r\n        return normalizeFontWeight(value);\r\n    }\r\n    if (typeof value !== \"string\") {\r\n        return null;\r\n    }\r\n    const parts = value.split(/\\s+/).filter(Boolean);\r\n    if (parts.length > 1) {\r\n        const parsedWeights = parts\r\n            .map((part) => parseFontWeightValue(part, fallback))\r\n            .filter((weight): weight is number => weight !== undefined)\r\n            .map((weight) => normalizeFontWeight(weight));\r\n        if (parsedWeights.length === 0) {\r\n            return null;\r\n        }\r\n        return parsedWeights.reduce((closest, candidate) => {\r\n            const candidateDiff = Math.abs(candidate - fallback);\r\n            const closestDiff = Math.abs(closest - fallback);\r\n            return candidateDiff < closestDiff ? candidate : closest;\r\n        }, parsedWeights[0]);\r\n    }\r\n    const parsed = parseFontWeightValue(value, fallback);\r\n    if (parsed === undefined) {\r\n        return null;\r\n    }\r\n    return normalizeFontWeight(parsed);\r\n}\r\n", "/**\r\n * Logic for applying weight and style transformations to base font names.\r\n * \r\n * This module handles the complex logic of mapping a base font name + weight + style\r\n * to a specific variant name (e.g., \"Helvetica\" + bold -> \"Helvetica-Bold\").\r\n * It handles both Base14 standard fonts and generic font naming conventions.\r\n */\r\n\r\nimport { isBoldFontWeight } from \"../../../css/font-weight.js\";\r\nimport { isItalicStyle } from \"../../../css/font-face-parser.js\";\r\nimport {\r\n    BASE14_FAMILY_VARIANTS,\r\n    detectBase14Family,\r\n    classifyBase14Variant,\r\n    type Base14Variant,\r\n} from \"../font-config.js\";\r\n\r\n/**\r\n * Apply weight and style transformations to a base font name.\r\n * \r\n * @param baseFont - The base font name (e.g., \"Helvetica\", \"Arial\")\r\n * @param weight - The requested font weight (100-900)\r\n * @param style - The requested font style (\"normal\", \"italic\", \"oblique\")\r\n * @returns The transformed font name (e.g., \"Helvetica-Bold\", \"Arial-BoldItalic\")\r\n */\r\nexport function applyWeightToBaseFont(baseFont: string, weight: number, style?: string): string {\r\n    const wantsItalic = isItalicStyle(style);\r\n    const wantsBold = isBoldFontWeight(weight);\r\n\r\n    const base14Family = detectBase14Family(baseFont);\r\n    if (base14Family) {\r\n        const variants = BASE14_FAMILY_VARIANTS[base14Family];\r\n        const currentVariant = classifyBase14Variant(baseFont);\r\n        const targetVariant: Base14Variant =\r\n            wantsBold && wantsItalic ? \"boldItalic\"\r\n                : wantsBold ? \"bold\"\r\n                    : wantsItalic ? \"italic\"\r\n                        : \"normal\";\r\n\r\n        if (currentVariant === targetVariant) {\r\n            return baseFont;\r\n        }\r\n        return variants[targetVariant];\r\n    }\r\n\r\n    let result = baseFont;\r\n\r\n    if (wantsItalic && !/-italic$/i.test(result) && !/-oblique$/i.test(result)) {\r\n        result = `${result}-Italic`;\r\n    }\r\n\r\n    if (wantsBold && !/-bold$/i.test(result)) {\r\n        if (/-italic$/i.test(result)) {\r\n            result = result.replace(/-italic$/i, \"\");\r\n        } else if (/-oblique$/i.test(result)) {\r\n            result = result.replace(/-oblique$/i, \"\");\r\n        }\r\n\r\n        return wantsItalic ? `${result}-BoldItalic` : `${result}-Bold`;\r\n    }\r\n\r\n    return result;\r\n}\r\n", "/**\r\n * Logic for resolving font family stacks with aliases and fallbacks.\r\n * \r\n * This module handles the expansion of font family names into a stack of candidates,\r\n * including aliases (e.g., \"Arial\" -> \"Arimo\") and generic families (e.g., \"serif\" -> \"Tinos\").\r\n */\r\n\r\nimport { parseFamilyList, normalizeToken } from \"../../../css/font-face-parser.js\";\r\nimport { BASE_FONT_ALIASES, GENERIC_FAMILIES } from \"../font-config.js\";\r\n\r\n/**\r\n * Build a family stack enriched with aliases and generic fallbacks.\r\n * \r\n * @param family - The requested font family string (comma-separated)\r\n * @param defaultStack - Default font stack to use if family is undefined/empty\r\n * @returns Array of font family names including aliases and generics\r\n * \r\n * @example\r\n * ```typescript\r\n * buildAliasedFamilyStack(\"Times New Roman\")\r\n * // => [\"Times New Roman\", \"Tinos\", \"serif\"]\r\n * ```\r\n */\r\nexport function buildAliasedFamilyStack(family: string | undefined, defaultStack: string[] = []): string[] {\r\n    const baseStack = family ? parseFamilyList(family) : defaultStack;\r\n\r\n    return baseStack.flatMap((f) => {\r\n        const normalized = normalizeToken(f);\r\n        const alias = BASE_FONT_ALIASES.get(normalized);\r\n        const generic = GENERIC_FAMILIES.get(normalized);\r\n        return [f, alias, generic].filter((x): x is string => !!x);\r\n    });\r\n}\r\n", "/**\r\n * Logic for mapping font families to base font names.\r\n * \r\n * This module handles the resolution of a font family + weight + style to a specific\r\n * base font name (e.g., \"Helvetica-Bold\"). It considers:\r\n * 1. CSS @font-face definitions\r\n * 2. Base14 fallbacks\r\n * 3. Font aliases\r\n * 4. Generic families\r\n */\r\n\r\nimport type { CSSFontFace } from \"../../types.js\";\r\nimport {\r\n    selectFaceForWeight,\r\n    baseFontFromFace,\r\n} from \"../../../css/font-face-parser.js\";\r\nimport {\r\n    BASE_FONT_ALIASES,\r\n    BASE14_FALLBACKS,\r\n    BASE14_VARIANT_LOOKUP,\r\n    GENERIC_FAMILIES,\r\n} from \"../font-config.js\";\r\nimport { applyWeightToBaseFont } from \"./weight-style-applicator.js\";\r\n\r\nconst DEFAULT_FONT = \"Times New Roman\";\r\n\r\n/**\r\n * Resolve a font family to a base font name.\r\n * \r\n * @param family - The requested font family\r\n * @param weight - The requested font weight\r\n * @param style - The requested font style\r\n * @param allowEmbeddedAlias - Whether to allow mapping to embedded font aliases (e.g. Tinos)\r\n * @param facesByFamily - Map of available @font-face definitions\r\n * @returns The resolved base font name\r\n */\r\nexport function resolveBaseFont(\r\n    family: string,\r\n    weight: number,\r\n    style: string | undefined,\r\n    allowEmbeddedAlias: boolean,\r\n    facesByFamily: Map<string, CSSFontFace[]>\r\n): string {\r\n    const faces = facesByFamily.get(family);\r\n    if (faces && faces.length > 0) {\r\n        const selectedFace = selectFaceForWeight(faces, weight);\r\n        if (selectedFace) {\r\n            const base = baseFontFromFace(selectedFace, BASE_FONT_ALIASES);\r\n            if (base) {\r\n                return applyWeightToBaseFont(base, weight, style);\r\n            }\r\n        }\r\n    }\r\n\r\n    if (!allowEmbeddedAlias) {\r\n        const base14Fallback = BASE14_FALLBACKS.get(family);\r\n        if (base14Fallback) {\r\n            return applyWeightToBaseFont(base14Fallback, weight, style);\r\n        }\r\n    }\r\n\r\n    const alias = BASE_FONT_ALIASES.get(family);\r\n    if (alias) {\r\n        const isAliasBase14 = BASE14_VARIANT_LOOKUP.has(alias.toLowerCase());\r\n        // When we can't embed fonts, avoid mapping to non-Base14 aliases (e.g. Tinos)\r\n        if (allowEmbeddedAlias || isAliasBase14) {\r\n            return applyWeightToBaseFont(alias, weight, style);\r\n        }\r\n    }\r\n\r\n    const generic = GENERIC_FAMILIES.get(family);\r\n    if (generic) {\r\n        return applyWeightToBaseFont(generic, weight, style);\r\n    }\r\n\r\n    return applyWeightToBaseFont(DEFAULT_FONT, weight, style);\r\n}\r\n", "/**\r\n * Manages the lifecycle and caching of FontResource objects.\r\n * \r\n * This manager is responsible for:\r\n * 1. Caching resolved FontResources by family/weight/style.\r\n * 2. Caching FontResources by base font name.\r\n * 3. Creating and registering standard (Base14) font resources with the PDF document.\r\n * 4. Generating unique resource names (aliases) for fonts.\r\n */\r\n\r\nimport { PdfDocument } from \"../../primitives/pdf-document.js\";\r\nimport type { FontResource } from \"../font-registry.js\";\r\n\r\nexport class FontResourceManager {\r\n    private readonly fontsByFamilyWeight = new Map<string, FontResource>();\r\n    private readonly fontsByBaseFont = new Map<string, FontResource>();\r\n    private aliasCounter = 1;\r\n\r\n    constructor(private readonly doc: PdfDocument) { }\r\n\r\n    /**\r\n     * Retrieve a cached FontResource by its unique key.\r\n     */\r\n    getCached(key: string): FontResource | undefined {\r\n        return this.fontsByFamilyWeight.get(key);\r\n    }\r\n\r\n    /**\r\n     * Cache a FontResource by its unique key.\r\n     */\r\n    setCached(key: string, resource: FontResource): void {\r\n        this.fontsByFamilyWeight.set(key, resource);\r\n    }\r\n\r\n    /**\r\n     * Ensure a FontResource exists for a given base font name.\r\n     * \r\n     * If the resource already exists in the cache, it is returned.\r\n     * Otherwise, a new standard font resource is registered with the PDF document.\r\n     */\r\n    ensureBaseFontResource(baseFont: string): FontResource {\r\n        const existing = this.fontsByBaseFont.get(baseFont);\r\n        if (existing) {\r\n            return existing;\r\n        }\r\n\r\n        const ref = this.doc.registerStandardFont(baseFont);\r\n        const alias = `F${this.aliasCounter++}`;\r\n\r\n        const BASE14_FAMILIES = new Set([\r\n            \"Helvetica\",\r\n            \"Helvetica-Bold\",\r\n            \"Helvetica-Oblique\",\r\n            \"Helvetica-BoldOblique\",\r\n            \"Times-Roman\",\r\n            \"Times-Bold\",\r\n            \"Times-Italic\",\r\n            \"Times-BoldItalic\",\r\n            \"Courier\",\r\n            \"Courier-Bold\",\r\n            \"Courier-Oblique\",\r\n            \"Courier-BoldOblique\",\r\n            \"Symbol\",\r\n            \"ZapfDingbats\",\r\n        ]);\r\n\r\n        const isBase14 = BASE14_FAMILIES.has(baseFont);\r\n        const resource: FontResource = { baseFont, resourceName: alias, ref, isBase14 };\r\n\r\n        this.fontsByBaseFont.set(baseFont, resource);\r\n        return resource;\r\n    }\r\n}\r\n", "/**\r\n * Manages font subsets and their materialization into PDF objects.\r\n * \r\n * This manager is responsible for:\r\n * 1. Tracking glyph usage via GlyphSubsetRegistry.\r\n * 2. Creating and caching SubsetFontResources.\r\n * 3. Materializing font subsets (generating FontDescriptor, CIDFont, Type0 dictionaries).\r\n * 4. Computing PDF font flags.\r\n */\r\n\r\nimport { PdfDocument, type PdfObjectRef } from \"../../primitives/pdf-document.js\";\r\nimport { PdfFontRegistry as GlyphSubsetRegistry } from \"../../font-subset/font-registry.js\";\r\nimport type { PdfFontSubset } from \"../font-subset.js\";\r\nimport type { GlyphRun } from \"../../../layout/text-run.js\";\r\nimport type { UnifiedFont } from \"../../../fonts/types.js\";\r\nimport type { TtfFontMetrics } from \"../../../types/fonts.js\";\r\nimport type { FontResource } from \"../font-registry.js\";\r\nimport { computeWidths } from \"../widths.js\";\r\nimport { log } from \"../../../logging/debug.js\";\r\n\r\nconst DEFAULT_STEM_V = 80;\r\n\r\nexport interface SubsetFontResource {\r\n    readonly alias: string;\r\n    readonly subset: PdfFontSubset;\r\n    readonly ref: PdfObjectRef;\r\n    readonly font: FontResource;\r\n}\r\n\r\nexport class SubsetResourceManager {\r\n    private readonly glyphSubsetRegistry = new GlyphSubsetRegistry();\r\n    private readonly subsetResources = new Map<string, SubsetFontResource>();\r\n\r\n    constructor(private readonly doc: PdfDocument) { }\r\n\r\n    registerGlyphRun(glyphRun: GlyphRun): void {\r\n        this.glyphSubsetRegistry.registerGlyphRun(glyphRun);\r\n    }\r\n\r\n    ensureSubsetForGlyphRun(glyphRun: GlyphRun, font: FontResource): SubsetFontResource {\r\n        this.registerGlyphRun(glyphRun);\r\n        const handle = this.glyphSubsetRegistry.ensureSubsetFor(glyphRun.font as UnifiedFont);\r\n\r\n        const baseAlias = handle.subset.name.startsWith(\"/\") ? handle.subset.name.slice(1) : handle.subset.name;\r\n        const alias = `GS${baseAlias}`;\r\n        const existing = this.subsetResources.get(alias);\r\n        const subsetForUse: PdfFontSubset = { ...handle.subset, name: `/${alias}` };\r\n\r\n        if (existing && this.subsetMatches(existing.subset, subsetForUse)) {\r\n            return existing;\r\n        }\r\n\r\n        const ref = this.materializeSubsetFont(subsetForUse, font, handle.unifiedFont);\r\n        const resource: SubsetFontResource = { alias, subset: subsetForUse, ref, font };\r\n        this.subsetResources.set(alias, resource);\r\n        return resource;\r\n    }\r\n\r\n    private subsetMatches(current: PdfFontSubset, next: PdfFontSubset): boolean {\r\n        if (current.glyphIds.length !== next.glyphIds.length) {\r\n            return false;\r\n        }\r\n        for (let i = 0; i < current.glyphIds.length; i++) {\r\n            if (current.glyphIds[i] !== next.glyphIds[i]) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private materializeSubsetFont(subset: PdfFontSubset, font: FontResource, unifiedFont: UnifiedFont): PdfObjectRef {\r\n        const metrics = font.metrics ?? (unifiedFont.metrics as unknown as TtfFontMetrics | undefined);\r\n        if (!metrics) {\r\n            return font.ref;\r\n        }\r\n\r\n        const unitsPerEm = metrics.metrics.unitsPerEm;\r\n        const scaleTo1000 = (v: number) => Math.round((v / unitsPerEm) * 1000);\r\n        const fontBBox: [number, number, number, number] = metrics.headBBox\r\n            ? [\r\n                scaleTo1000(metrics.headBBox[0]),\r\n                scaleTo1000(metrics.headBBox[1]),\r\n                scaleTo1000(metrics.headBBox[2]),\r\n                scaleTo1000(metrics.headBBox[3]),\r\n            ]\r\n            : [-1000, -1000, 1000, 1000];\r\n\r\n        const fontFile = font.embedded?.subset ?? subset.fontFile;\r\n        if (!fontFile || fontFile.length === 0) {\r\n            log(\"font\", \"warn\", \"missing-font-file-for-subset\", { baseFont: font.baseFont, alias: subset.name });\r\n            return font.ref;\r\n        }\r\n\r\n        const { DW, W } = computeWidths(metrics);\r\n        const subsetTag = subset.name.startsWith(\"/\") ? subset.name.slice(1) : subset.name;\r\n        const subsetBaseName = `${subsetTag}+${font.baseFont}`;\r\n\r\n        const fontFileRef = this.doc.registerStream(fontFile, {});\r\n        const fontDescriptor = {\r\n            Type: \"/FontDescriptor\",\r\n            FontName: `/${subsetBaseName}`,\r\n            Flags: this.computePdfFlags(font, unifiedFont),\r\n            FontBBox: fontBBox,\r\n            ItalicAngle: unifiedFont.css?.style === \"italic\" ? -12 : 0,\r\n            Ascent: scaleTo1000(metrics.metrics.ascender),\r\n            Descent: scaleTo1000(metrics.metrics.descender),\r\n            CapHeight: scaleTo1000(metrics.metrics.capHeight ?? metrics.metrics.ascender),\r\n            XHeight: scaleTo1000(metrics.metrics.xHeight ?? metrics.metrics.ascender / 2),\r\n            StemV: DEFAULT_STEM_V,\r\n            FontFile2: fontFileRef,\r\n        };\r\n        const fontDescriptorRef = this.doc.register(fontDescriptor);\r\n\r\n        const cidFontDict = {\r\n            Type: \"/Font\",\r\n            Subtype: \"/CIDFontType2\",\r\n            BaseFont: `/${subsetBaseName}`,\r\n            CIDSystemInfo: {\r\n                Registry: \"(Adobe)\",\r\n                Ordering: \"(Identity)\",\r\n                Supplement: 0,\r\n            },\r\n            FontDescriptor: fontDescriptorRef,\r\n            DW,\r\n            W,\r\n            CIDToGIDMap: \"/Identity\",\r\n        };\r\n        const cidFontRef = this.doc.register(cidFontDict);\r\n\r\n        const toUnicodeRef = this.doc.registerStream(new TextEncoder().encode(subset.toUnicodeCMap), {});\r\n        const type0Font = {\r\n            Type: \"/Font\",\r\n            Subtype: \"/Type0\",\r\n            BaseFont: `/${subsetBaseName}-Identity-H`,\r\n            Encoding: \"/Identity-H\",\r\n            DescendantFonts: [cidFontRef],\r\n            ToUnicode: toUnicodeRef,\r\n        };\r\n\r\n        return this.doc.register(type0Font);\r\n    }\r\n\r\n    private computePdfFlags(font: FontResource, unifiedFont: UnifiedFont): number {\r\n        const family = unifiedFont.css?.family?.toLowerCase() ?? font.baseFont.toLowerCase();\r\n        const style = unifiedFont.css?.style ?? \"\";\r\n        const isItalic = /italic|oblique/i.test(style) || /italic|oblique/i.test(font.baseFont);\r\n        const isSerif = family.includes(\"serif\");\r\n        const isSymbol = family.includes(\"symbol\") || family.includes(\"dingbat\") || font.baseFont.toLowerCase().includes(\"symbol\");\r\n\r\n        let flags = 0;\r\n        if (isSymbol) {\r\n            flags |= 1 << 2;\r\n        } else {\r\n            flags |= 1 << 5;\r\n        }\r\n        if (isSerif) {\r\n            flags |= 1 << 1;\r\n        }\r\n        if (isItalic) {\r\n            flags |= 1 << 6;\r\n        }\r\n        return flags;\r\n    }\r\n}\r\n", "import type { CSSFontFace, Run, StyleSheets } from \"../types.js\";\r\nimport { PdfDocument, type PdfObjectRef } from \"../primitives/pdf-document.js\";\r\nimport type { FontConfig, TtfFontMetrics } from \"../../types/fonts.js\";\r\nimport { FontEmbedder } from \"./embedder.js\";\r\nimport { computeWidths } from \"./widths.js\";\r\nimport { log } from \"../../logging/debug.js\";\nimport { needsUnicode } from \"../../text/text.js\";\r\nimport { fontWeightCacheKey, normalizeFontWeight, isBoldFontWeight } from \"../../css/font-weight.js\";\r\nimport { PdfFontRegistry as GlyphSubsetRegistry } from \"../font-subset/font-registry.js\";\r\nimport type { PdfFontSubset } from \"./font-subset.js\";\r\nimport type { GlyphRun } from \"../../layout/text-run.js\";\r\nimport type { UnifiedFont } from \"../../fonts/types.js\";\r\nimport type { EmbeddedFont } from \"./embedder.js\";\r\nimport {\r\n  parseFontFaces,\r\n  selectFaceForWeight,\r\n  parseFamilyList,\r\n  isItalicStyle,\r\n  normalizeToken,\r\n  baseFontFromFace,\r\n} from \"../../css/font-face-parser.js\";\r\nimport {\r\n  BASE_FONT_ALIASES,\r\n  GENERIC_FAMILIES,\r\n  BASE14_FALLBACKS,\r\n  BASE14_FAMILY_VARIANTS,\r\n  BASE14_VARIANT_LOOKUP,\r\n  detectBase14Family,\r\n  classifyBase14Variant,\r\n  type Base14Family,\r\n  type Base14Variant,\r\n} from \"./font-config.js\";\r\nimport { applyWeightToBaseFont } from \"./resolvers/weight-style-applicator.js\";\r\nimport { buildAliasedFamilyStack } from \"./resolvers/family-resolver.js\";\r\nimport { resolveBaseFont } from \"./resolvers/base-font-mapper.js\";\r\nimport { FontResourceManager } from \"./managers/font-resource-manager.js\";\r\nimport { SubsetResourceManager, type SubsetFontResource } from \"./managers/subset-resource-manager.js\";\r\n\r\nconst DEFAULT_STEM_V = 80;\r\n\r\nexport type PdfFont = {\r\n  name: string;\r\n  baseName?: string;    // for Base14 (Helvetica, etc.)\r\n  isBase14: boolean;\r\n  // ... extend as needed\r\n};\r\n\r\nexport function getBase14(family: \"Helvetica\" | \"Times-Roman\" | \"Courier\"): PdfFont {\r\n  return { isBase14: true, baseName: family, name: family };\r\n}\r\n\r\n// Note: getFontForText needs access to doc and config, so we'll modify the signature\r\nexport function getFontForText(_requestedFamily: string, text: string, _doc: any, _config: any): PdfFont {\r\n  if (needsUnicode(text)) {\r\n    // For now, use a simplified approach - we'll assume NotoSans-Regular is available\r\n    // In a full implementation, you'd initialize the embedder properly\r\n    const fontName = \"NotoSans-Regular\";\r\n    log(\"font\", \"info\", \"font-path\", { base14: false, family: fontName, encoding: \"Identity-H\" });\n    return { isBase14: false, name: fontName };\r\n  }\r\n  const f = getBase14(\"Helvetica\"); // fallback\r\n  log(\"font\", \"info\", \"font-path\", { base14: true, family: f.baseName, encoding: \"WinAnsi\" });\n  return f;\r\n}\r\n\r\nconst DEFAULT_FONT = \"Times New Roman\"; // Use embedded TTF font instead of base14\r\n\r\nexport interface FontResource {\r\n  readonly baseFont: string;\r\n  readonly resourceName: string;\r\n  readonly ref: PdfObjectRef;\r\n  readonly isBase14: boolean;\r\n  readonly metrics?: TtfFontMetrics;\r\n  readonly embedded?: EmbeddedFont;\r\n}\r\n\r\n\r\n\r\nexport class FontRegistry {\r\n  private readonly facesByFamily = new Map<string, CSSFontFace[]>();\r\n  private readonly fontResourceManager: FontResourceManager;\r\n  private readonly subsetResourceManager: SubsetResourceManager;\r\n  private embedder: FontEmbedder | null = null;\r\n  private fontConfig: FontConfig | null = null;\r\n\r\n  constructor(private readonly doc: PdfDocument, stylesheets: StyleSheets) {\r\n    const { facesByFamily } = parseFontFaces(stylesheets);\r\n    this.facesByFamily = facesByFamily;\r\n    this.fontResourceManager = new FontResourceManager(doc);\r\n    this.subsetResourceManager = new SubsetResourceManager(doc);\r\n  }\r\n\r\n  async ensureFontResource(family: string | undefined, weight?: number, style?: string): Promise<FontResource> {\r\n    const normalizedWeight = normalizeFontWeight(weight);\r\n    const familyKey = this.makeFamilyKey(family, normalizedWeight, style);\r\n    const cached = this.fontResourceManager.getCached(familyKey);\r\n    if (cached) {\r\n      return cached;\r\n    }\r\n\r\n    if (this.embedder && this.fontConfig) {\r\n      const familyStack = buildAliasedFamilyStack(family, this.fontConfig?.defaultStack);\r\n      const embedded = this.embedder.ensureFont(familyStack, normalizedWeight, style);\r\n      if (embedded) {\r\n        const resource: FontResource = {\r\n          baseFont: embedded.baseFont,\r\n          resourceName: embedded.resourceName,\r\n          ref: embedded.ref,\r\n          isBase14: false,\r\n          metrics: embedded.metrics,\r\n          embedded,\r\n        };\r\n        this.fontResourceManager.setCached(familyKey, resource);\r\n        return resource;\r\n      }\r\n    }\r\n\r\n    const resolved = this.ensureStandardFontResource(family, normalizedWeight, style);\r\n    this.fontResourceManager.setCached(familyKey, resolved);\r\n    return resolved;\r\n  }\r\n\r\n  // New method to get embedder reference\r\n  getEmbedder(): FontEmbedder | null {\r\n    return this.embedder;\r\n  }\r\n\r\n  getDefaultFontStack(): string[] {\r\n    if (!this.fontConfig?.defaultStack || this.fontConfig.defaultStack.length === 0) {\r\n      return [];\r\n    }\r\n    return [...this.fontConfig.defaultStack];\r\n  }\r\n\r\n  ensureFontResourceSync(family: string | undefined, weight?: number, style?: string): FontResource {\r\n    const normalizedWeight = normalizeFontWeight(weight);\r\n    const familyKey = this.makeFamilyKey(family, normalizedWeight, style);\r\n    const cached = this.fontResourceManager.getCached(familyKey);\r\n    if (cached) {\r\n      return cached;\r\n    }\r\n\r\n    if (this.embedder && this.fontConfig) {\r\n      const familyStack = buildAliasedFamilyStack(family, this.fontConfig?.defaultStack);\r\n\r\n      // Note: embedder.ensureFont is synchronous in its implementation (it uses pre-loaded data)\r\n      // even though the interface might not explicitly say so, we know it returns EmbeddedFont | null immediately.\r\n      const embedded = this.embedder.ensureFont(familyStack, normalizedWeight, style);\r\n      if (embedded) {\r\n        const resource: FontResource = {\r\n          baseFont: embedded.baseFont,\r\n          resourceName: embedded.resourceName,\r\n          ref: embedded.ref,\r\n          isBase14: false,\r\n          metrics: embedded.metrics,\r\n          embedded,\r\n        };\r\n        this.fontResourceManager.setCached(familyKey, resource);\r\n        return resource;\r\n      }\r\n    }\r\n\r\n    const resolved = this.ensureStandardFontResource(family, normalizedWeight, style);\r\n    this.fontResourceManager.setCached(familyKey, resolved);\r\n    return resolved;\r\n  }\r\n\r\n  ensureSubsetForGlyphRun(glyphRun: GlyphRun, font: FontResource): SubsetFontResource {\r\n    return this.subsetResourceManager.ensureSubsetForGlyphRun(glyphRun, font);\r\n  }\r\n\r\n\r\n\r\n  private ensureStandardFontResource(family: string | undefined, weight: number, style?: string): FontResource {\r\n    const candidates = [...parseFamilyList(family), DEFAULT_FONT];\r\n    for (const candidate of candidates) {\r\n      const normalizedCandidate = normalizeToken(candidate);\r\n      if (!normalizedCandidate) {\r\n        continue;\r\n      }\r\n      const candidateKey = this.familyWeightKey(normalizedCandidate, weight, style);\r\n      const existing = this.fontResourceManager.getCached(candidateKey);\r\n      if (existing) {\r\n        this.fontResourceManager.setCached(this.makeFamilyKey(family, weight, style), existing);\r\n        return existing;\r\n      }\r\n      const baseFont = resolveBaseFont(normalizedCandidate, weight, style, this.embedder !== null, this.facesByFamily);\r\n      const resource = this.fontResourceManager.ensureBaseFontResource(baseFont);\r\n      this.fontResourceManager.setCached(candidateKey, resource);\r\n      this.fontResourceManager.setCached(this.makeFamilyKey(candidate, weight, style), resource);\r\n      if (family && candidate !== family) {\r\n        this.fontResourceManager.setCached(this.makeFamilyKey(family, weight, style), resource);\r\n      }\r\n      return resource;\r\n    }\r\n    const fallbackBase = applyWeightToBaseFont(DEFAULT_FONT, weight, style);\r\n    const fallback = this.fontResourceManager.ensureBaseFontResource(fallbackBase);\r\n    this.fontResourceManager.setCached(this.familyWeightKey(\"\", weight, style), fallback);\r\n    return fallback;\r\n  }\r\n\r\n\r\n\r\n  private makeFamilyKey(family: string | undefined, weight: number, style?: string): string {\r\n    return this.familyWeightKey(normalizeToken(family), weight, style);\r\n  }\r\n\r\n  private familyWeightKey(normalizedFamily: string, weight: number, style?: string): string {\r\n    const familyToken = normalizedFamily && normalizedFamily.length > 0 ? normalizedFamily : \"__default\";\r\n    const styleToken = isItalicStyle(style) ? \"_italic\" : \"\";\r\n    return `${familyToken}@${fontWeightCacheKey(weight)}${styleToken}`;\r\n  }\r\n\r\n\r\n\r\n\r\n  async initializeEmbedder(fontConfig: FontConfig): Promise<void> {\r\n    this.fontConfig = fontConfig;\r\n    this.embedder = new FontEmbedder(fontConfig, this.doc);\r\n    await this.embedder.initialize();\r\n    log(\"font\", \"debug\", \"embedder initialized\", { fontConfig });\n  }\r\n\r\n  setFontConfig(fontConfig: FontConfig): void {\r\n    this.fontConfig = fontConfig;\r\n    this.embedder = new FontEmbedder(fontConfig, this.doc);\r\n    log(\"font\", \"debug\", \"font config set\", { fontConfig });\n  }\r\n}\r\n\r\nexport function initFontSystem(doc: PdfDocument, stylesheets: StyleSheets): FontRegistry {\r\n  return new FontRegistry(doc, stylesheets);\r\n}\r\n\r\nexport async function ensureFontSubset(registry: FontRegistry, run: Run): Promise<FontResource> {\r\n  const font = await registry.ensureFontResource(run.fontFamily, run.fontWeight, run.fontStyle);\r\n  // === diagn\u00F3stico cir\u00FArgico: caminho de fonte ===\r\n  log(\"font\", \"info\", \"font-path\", {\n    base14: font.isBase14 === true,\r\n    family: font.baseFont,\r\n    encoding: font.isBase14 ? \"WinAnsi\" : \"Identity-H\"\r\n  });\r\n  return font;\r\n}\r\n\r\nexport function ensureFontSubsetSync(registry: FontRegistry, run: Run): FontResource {\r\n  const font = registry.ensureFontResourceSync(run.fontFamily, run.fontWeight, run.fontStyle);\r\n  // === diagn\u00F3stico cir\u00FArgico: caminho de fonte ===\r\n  log(\"font\", \"info\", \"font-path\", {\n    base14: font.isBase14 === true,\r\n    family: font.baseFont,\r\n    encoding: font.isBase14 ? \"WinAnsi\" : \"Identity-H\"\r\n  });\r\n  return font;\r\n}\r\n\r\nexport function finalizeFontSubsets(_registry: FontRegistry): void {\r\n  // Actual font materialization happens during PdfDocument.finalize().\r\n}\r\n\r\nexport function preflightFontsForPdfa(_registry: FontRegistry): void {\r\n  // Placeholder for PDF/A validations.\r\n}\r\n", "export class CoordinateTransformer {\r\n  private ptToPxFactor?: number;\r\n\r\n  constructor(\r\n    public readonly pageHeightPt: number,\r\n    private readonly pxToPt: (value: number) => number,\r\n    public readonly pageOffsetPx: number = 0,\r\n  ) {}\r\n\r\n  get pageHeightPx(): number {\r\n    return this.ptToPx(this.pageHeightPt);\r\n  }\r\n\r\n  private ptToPx(value: number): number {\r\n    if (!this.ptToPxFactor) {\r\n      const factor = this.pxToPt(1);\r\n      this.ptToPxFactor = factor === 0 ? 0 : 1 / factor;\r\n    }\r\n    return value * (this.ptToPxFactor ?? 0);\r\n  }\r\n\r\n  public convertPxToPt(value: number): number {\r\n    return this.pxToPt(value);\r\n  }\r\n\r\n  // NOVO\r\n  public convertPtToPx(value: number): number {\r\n    return this.ptToPx(value);\r\n  }\r\n}\r\n", "import type { RGBA } from \"../types.js\";\r\nimport type { GraphicsStateManager } from \"./graphics-state-manager.js\";\r\n\r\nexport function normalizeChannel(value: number): number {\r\n  if (value > 1) {\r\n    return value / 255;\r\n  }\r\n  return value;\r\n}\r\n\r\nexport function formatNumber(value: number): string {\r\n  if (!Number.isFinite(value)) {\r\n    return \"0\";\r\n  }\r\n  return Number.isInteger(value) ? value.toString() : value.toFixed(4).replace(/0+$/, \"\").replace(/\\.$/, \"\");\r\n}\r\n\r\nexport function fillColorCommand(color: RGBA, graphicsStateManager?: GraphicsStateManager): string {\r\n  const r = formatNumber(normalizeChannel(color.r));\r\n  const g = formatNumber(normalizeChannel(color.g));\r\n  const b = formatNumber(normalizeChannel(color.b));\r\n  const alpha = color.a ?? 1;\r\n  if (alpha < 1 && graphicsStateManager) {\r\n    const stateName = graphicsStateManager.ensureFillAlphaState(alpha);\r\n    return `/${stateName} gs\\n${r} ${g} ${b} rg`;\r\n  }\r\n  return `${r} ${g} ${b} rg`;\r\n}\r\n", "import type { GlyphOutlineCmd } from \"../../types/fonts.js\";\r\n\r\nexport interface BitmapMask {\n  width: number;\n  height: number;\n  data: Uint8ClampedArray; // alpha 0..255, length = width * height\n  // Offset (in px) from the glyph origin to the top-left of the bitmap\n  offsetX: number;\n  offsetY: number;\n}\n\r\n/**\r\n * Flatten quadratic bezier adaptively.\r\n * p0, p1, p2 in pixel coordinates.\r\n */\r\nfunction flattenQuadratic(p0: { x: number; y: number }, p1: { x: number; y: number }, p2: { x: number; y: number }, tol: number, out: { x: number; y: number }[]) {\r\n  // recursive subdivision\r\n  const stack: Array<{ x0: number; y0: number; cx: number; cy: number; x1: number; y1: number }> = [];\r\n  stack.push({ x0: p0.x, y0: p0.y, cx: p1.x, cy: p1.y, x1: p2.x, y1: p2.y });\r\n\r\n  while (stack.length > 0) {\r\n    const seg = stack.pop()!;\r\n\r\n    // approximate flatness: distance from control to chord\r\n    const ax = seg.x0, ay = seg.y0;\r\n    const bx = seg.x1, by = seg.y1;\r\n    const cx = seg.cx, cy = seg.cy;\r\n\r\n    // chord vector\r\n    const vx = bx - ax, vy = by - ay;\r\n    const len2 = vx * vx + vy * vy;\r\n    let dist = 0;\r\n    if (len2 === 0) {\r\n      // degenerate, distance from control to p0\r\n      const dx = cx - ax, dy = cy - ay;\r\n      dist = Math.hypot(dx, dy);\r\n    } else {\r\n      // projection factor of control onto chord\r\n      const t = ((cx - ax) * vx + (cy - ay) * vy) / len2;\r\n      const projx = ax + t * vx;\r\n      const projy = ay + t * vy;\r\n      dist = Math.hypot(cx - projx, cy - projy);\r\n    }\r\n\r\n    if (dist <= tol) {\r\n      // emit end point\r\n      out.push({ x: bx, y: by });\r\n    } else {\r\n      // subdivide into two quadratics using De Casteljau\r\n      const x01 = (ax + cx) / 2;\r\n      const y01 = (ay + cy) / 2;\r\n      const x12 = (cx + bx) / 2;\r\n      const y12 = (cy + by) / 2;\r\n      const x012 = (x01 + x12) / 2;\r\n      const y012 = (y01 + y12) / 2;\r\n\r\n      // push right then left so left is processed first\r\n      stack.push({ x0: x012, y0: y012, cx: x12, cy: y12, x1: bx, y1: by });\r\n      stack.push({ x0: ax, y0: ay, cx: x01, cy: y01, x1: x012, y1: y012 });\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Convert GlyphOutlineCmd sequence into flattened contours in pixel coordinates.\r\n * - scale: pixels per font unit (fontSizePx / unitsPerEm)\r\n * - tolPx: flatness tolerance in pixels (suggest 0.35..1.0)\r\n */\r\nexport function flattenOutline(cmds: GlyphOutlineCmd[], scale: number, tolPx = 0.5): { contours: { x: number; y: number }[][] } {\r\n  const contours: { x: number; y: number }[][] = [];\r\n  let cursorX = 0;\r\n  let cursorY = 0;\r\n  // Use an always-array for curContour to avoid union narrowing issues in TS.\r\n  // Empty array means \"no active contour\".\r\n  let curContour: { x: number; y: number }[] = [];\r\n\r\n  const emitMove = (x: number, y: number) => {\r\n    if (curContour.length > 0) {\r\n      // implicit close previous\r\n      contours.push(curContour);\r\n    }\r\n    curContour = [{ x, y }];\r\n    cursorX = x;\r\n    cursorY = y;\r\n  };\r\n\r\n  const emitLine = (x: number, y: number) => {\r\n    if (!curContour) curContour = [{ x: cursorX, y: cursorY }];\r\n    curContour.push({ x, y });\r\n    cursorX = x;\r\n    cursorY = y;\r\n  };\r\n\r\n  const emitQuad = (cx: number, cy: number, x: number, y: number) => {\r\n    if (!curContour) curContour = [{ x: cursorX, y: cursorY }];\r\n    // subdivide from current cursor -> control -> x,y\r\n    const start = { x: cursorX, y: cursorY };\r\n    const ctrl = { x: cx, y: cy };\r\n    const end = { x: x, y: y };\r\n    // flattening writes successive points ending with end\r\n    flattenQuadratic(start, ctrl, end, tolPx, curContour);\r\n    cursorX = x;\r\n    cursorY = y;\r\n  };\r\n\r\n  for (const c of cmds) {\n    switch (c.type) {\n      case \"moveTo\": {\n        const x = c.x * scale;\n        const y = -c.y * scale; // flip Y to match layout/PDF coordinate (downward positive)\n        emitMove(x, y);\n        break;\n      }\n      case \"lineTo\": {\n        const x = c.x * scale;\n        const y = -c.y * scale;\n        emitLine(x, y);\n        break;\n      }\n      case \"quadTo\": {\n        const cx = c.cx * scale;\n        const cy = -c.cy * scale;\n        const x = c.x * scale;\n        const y = -c.y * scale;\n        emitQuad(cx, cy, x, y);\n        break;\n      }\n      case \"cubicTo\": {\n        // Not implementing cubic flattening for now - approximate by splitting into quads (simple approach)\n        // Convert cubic to two quadratics via degree reduction (rough) or fallback: sample with small steps\n        const steps = 8;\n        for (let i = 1; i <= steps; i++) {\n          const t = i / steps;\n          // cubic bezier evaluate using standard formula\n          const x = Math.pow(1 - t, 3) * (cursorX) + 3 * t * Math.pow(1 - t, 2) * (c.cx1 * scale) + 3 * t * t * (1 - t) * (c.cx2 * scale) + t * t * t * (c.x * scale);\n          const y = Math.pow(1 - t, 3) * (cursorY) + 3 * t * Math.pow(1 - t, 2) * (-c.cy1 * scale) + 3 * t * t * (1 - t) * (-c.cy2 * scale) + t * t * t * (-c.y * scale);\n          emitLine(x, y);\n        }\n        break;\n      }\n      case \"close\": {\r\n        if (curContour.length > 0) {\r\n          // ensure last point equals first (closed)\r\n          const first = curContour[0];\r\n          const last = curContour[curContour.length - 1];\r\n          if (Math.abs(first.x - last.x) > 1e-6 || Math.abs(first.y - last.y) > 1e-6) {\r\n            curContour.push({ x: first.x, y: first.y });\r\n          }\r\n          contours.push(curContour);\r\n          curContour = [];\r\n        }\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (curContour.length > 0) {\r\n    // close if needed\r\n    const first = curContour[0];\r\n    const last = curContour[curContour.length - 1];\r\n    if (Math.abs(first.x - last.x) > 1e-6 || Math.abs(first.y - last.y) > 1e-6) {\r\n      curContour.push({ x: first.x, y: first.y });\r\n    }\r\n    contours.push(curContour);\r\n  }\r\n\r\n  return { contours };\r\n}\r\n\r\n/**\r\n * Rasterize flattened contours using scanline even-odd fill on an integer high-res grid and downsample.\r\n * - contours: array of closed polylines (points in pixel coordinates)\r\n * - supersample: integer factor >=1\r\n * Returns alpha bitmap in target pixels.\r\n */\r\nexport function rasterizeContours(contours: { x: number; y: number }[][], supersample = 4): BitmapMask | null {\r\n  if (!contours || contours.length === 0) return null;\r\n\r\n  // compute bounding box\r\n  let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n  for (const c of contours) {\r\n    for (const p of c) {\r\n      if (p.x < minX) minX = p.x;\r\n      if (p.y < minY) minY = p.y;\r\n      if (p.x > maxX) maxX = p.x;\r\n      if (p.y > maxY) maxY = p.y;\r\n    }\r\n  }\r\n\r\n  if (!isFinite(minX) || !isFinite(minY)) return null;\r\n\r\n  // Add small padding so strokes at edge are visible\r\n  const pad = 1;\r\n  minX = Math.floor(minX) - pad;\r\n  minY = Math.floor(minY) - pad;\r\n  maxX = Math.ceil(maxX) + pad;\r\n  maxY = Math.ceil(maxY) + pad;\r\n\r\n  const width = maxX - minX;\r\n  const height = maxY - minY;\r\n  if (width <= 0 || height <= 0) return null;\r\n\r\n  const hiW = width * supersample;\r\n  const hiH = height * supersample;\r\n  // allocate high-res buffer (byte per pixel)\r\n  const hi = new Uint8ClampedArray(hiW * hiH);\r\n\r\n  // For each scanline in high-res, compute intersections with edges\r\n  for (let y = 0; y < hiH; y++) {\r\n    const fy = minY + y / supersample + 0.5 / supersample; // sample at center of hi-pixel\r\n    const intersections: number[] = [];\r\n\r\n    for (const contour of contours) {\r\n      for (let i = 0; i < contour.length - 1; i++) {\r\n        const a = contour[i];\r\n        const b = contour[i + 1];\r\n        const y0 = a.y;\r\n        const y1 = b.y;\r\n        // skip horizontal edges or scanlines outside edge bounds\r\n        if (y0 === y1) continue;\r\n        // include when fy is >= min(y0,y1) and < max(y0,y1) (half-open)\r\n        const ymin = Math.min(y0, y1);\r\n        const ymax = Math.max(y0, y1);\r\n        if (fy < ymin || fy >= ymax) continue;\r\n        const t = (fy - y0) / (y1 - y0);\r\n        const ix = a.x + t * (b.x - a.x);\r\n        intersections.push(ix);\r\n      }\r\n    }\r\n\r\n    if (intersections.length === 0) continue;\r\n    intersections.sort((a, b) => a - b);\r\n\r\n    // fill between pairs\r\n    for (let k = 0; k < intersections.length; k += 2) {\r\n      const x0 = intersections[k];\r\n      const x1 = intersections[k + 1];\r\n      if (x1 === undefined) break;\r\n      // convert to high-res x indices\r\n      const hiX0 = Math.max(0, Math.floor((x0 - minX) * supersample));\r\n      const hiX1 = Math.min(hiW, Math.ceil((x1 - minX) * supersample));\r\n      if (hiX1 <= hiX0) continue;\r\n      const base = y * hiW;\r\n      for (let hx = hiX0; hx < hiX1; hx++) hi[base + hx] = 255;\r\n    }\r\n  }\r\n\r\n  // Downsample hi -> target\r\n  const outW = width;\r\n  const outH = height;\r\n  const out = new Uint8ClampedArray(outW * outH);\r\n\r\n  for (let ty = 0; ty < outH; ty++) {\r\n    for (let tx = 0; tx < outW; tx++) {\r\n      let sum = 0;\r\n      const startY = ty * supersample;\r\n      const startX = tx * supersample;\r\n      for (let sy = 0; sy < supersample; sy++) {\r\n        const row = (startY + sy) * hiW;\r\n        for (let sx = 0; sx < supersample; sx++) {\r\n          sum += hi[row + startX + sx];\r\n        }\r\n      }\r\n      const avg = Math.round(sum / (supersample * supersample));\r\n      out[ty * outW + tx] = avg;\r\n    }\r\n  }\r\n\r\n  return { width: outW, height: outH, data: out, offsetX: minX, offsetY: minY };\n}\n", "import type { BitmapMask } from \"./rasterizer.js\";\r\nimport { flattenOutline, rasterizeContours } from \"./rasterizer.js\";\r\nimport type { TtfFontMetrics } from \"../../types/fonts.js\";\r\nimport type { GlyphOutlineCmd } from \"../../types/fonts.js\";\r\nimport { globalGlyphAtlas } from \"./glyph-atlas.js\";\r\nimport type { AtlasPlacement } from \"./glyph-atlas.js\";\r\nimport { blurAlpha } from \"./blur.js\";\r\n\r\n/**\r\n * Glyph mask cache with simple LRU eviction.\r\n *\r\n * - Keyed by (unitsPerEm + headBBox) | gid | fontSizePx | supersample\r\n * - Stores BitmapMask values (alpha-only or RGBA depending on usage)\r\n * - Default maxEntries set to 500 (configurable)\r\n *\r\n * This keeps the previous helper behavior but adds a bounded cache to limit memory.\r\n */\r\n\r\ntype CacheKey = string;\r\n\r\nlet maxEntries = 500;\r\nconst glyphMaskCache = new Map<CacheKey, BitmapMask>();\r\n// store atlas placements per cached key to allow later atlas-based rendering\r\nconst glyphAtlasPlacements = new Map<CacheKey, AtlasPlacement | null>();\r\n\r\nexport function setGlyphMaskCacheMaxEntries(n: number) {\r\n  if (!Number.isFinite(n) || n <= 0) return;\r\n  maxEntries = Math.max(1, Math.floor(n));\r\n  // Trim if needed\r\n  trimCacheIfNeeded();\r\n}\r\n\r\nfunction trimCacheIfNeeded() {\r\n  while (glyphMaskCache.size > maxEntries) {\r\n    // Evict oldest entry (Map preserves insertion order)\r\n    const oldestKey = glyphMaskCache.keys().next().value;\r\n    if (!oldestKey) break;\r\n    glyphMaskCache.delete(oldestKey);\r\n  }\r\n}\r\n\r\nfunction makeKey(metrics: TtfFontMetrics, gid: number, fontSizePx: number, supersample = 4, blurPx = 0): CacheKey {\r\n  const uid = `${metrics.metrics.unitsPerEm}-${(metrics.headBBox ? metrics.headBBox.join(\",\") : \"nbb\")}`;\r\n  // Use one-decimal precision for blur in the key to avoid unnecessary cache churn for fractional radii\r\n  const blurKey = Math.round(Math.max(0, blurPx || 0) * 10) / 10;\r\n  return `${uid}|gid:${gid}|size:${Math.round(fontSizePx)}|ss:${supersample}|blur:${blurKey}`;\r\n}\r\n\r\n/**\r\n * Get or create an alpha mask for a glyph.\r\n * Returns null if outline is not available or rasterization failed.\r\n */\r\nexport function getGlyphMask(metrics: TtfFontMetrics, gid: number, fontSizePx: number, supersample = 4, blurPx = 0): BitmapMask | null {\r\n  const key = makeKey(metrics, gid, fontSizePx, supersample, blurPx);\r\n  const cached = glyphMaskCache.get(key);\r\n  if (cached) {\r\n    // LRU: move to most-recently-used (end)\r\n    glyphMaskCache.delete(key);\r\n    glyphMaskCache.set(key, cached);\r\n    return cached;\r\n  }\r\n\r\n  if (!metrics.getGlyphOutline) return null;\r\n  const cmds: GlyphOutlineCmd[] | null = metrics.getGlyphOutline(gid);\r\n  if (!cmds || cmds.length === 0) return null;\r\n\r\n  const unitsPerEm = metrics.metrics.unitsPerEm || 1000;\r\n  const scale = fontSizePx / unitsPerEm;\r\n\r\n  try {\r\n    const { contours } = flattenOutline(cmds, scale, 0.5);\n    const mask = rasterizeContours(contours, supersample);\n    if (!mask) return null;\n\r\n    // If blur requested, apply blur to alpha buffer first\r\n    let alphaBuf = mask.data;\r\n    if (blurPx && blurPx > 0) {\r\n      alphaBuf = blurAlpha(mask.data, mask.width, mask.height, blurPx);\r\n    }\r\n\r\n    // Compute extra padding to reserve space in atlas for blur bleed (more conservative heuristic)\r\n    // Use a larger multiplier and a small safety margin to avoid clipped blurred glyphs.\r\n    const extraPadding = blurPx && blurPx > 0 ? Math.ceil(blurPx * 2) + 2 : 0;\r\n\r\n    // Attempt to pack into global atlas (best-effort) using alphaBuf and extra padding\r\n    try {\r\n      const placement = globalGlyphAtlas.pack(key, alphaBuf, mask.width, mask.height, extraPadding);\r\n      glyphAtlasPlacements.set(key, placement);\r\n    } catch {\r\n      glyphAtlasPlacements.set(key, null);\r\n    }\r\n\r\n    // Cache the final mask (with blurred alpha if applied)\r\n    // Ensure the stored buffer matches the BitmapMask type (Uint8ClampedArray)\r\n    const clamped = alphaBuf instanceof Uint8ClampedArray ? alphaBuf : new Uint8ClampedArray(alphaBuf);\r\n    const finalMask: BitmapMask = {\n      width: mask.width,\n      height: mask.height,\n      data: clamped,\n      offsetX: mask.offsetX,\n      offsetY: mask.offsetY,\n    };\n    glyphMaskCache.set(key, finalMask);\n    trimCacheIfNeeded();\n    return finalMask;\n  } catch {\r\n    // Defensive: don't throw; return null to let caller fallback\r\n    return null;\r\n  }\r\n}\r\n\r\n/** Utility to clear cache (useful for tests) */\r\nexport function clearGlyphMaskCache(): void {\r\n  glyphMaskCache.clear();\r\n  glyphAtlasPlacements.clear();\r\n}\r\n\r\n/** Return atlas placement for a cached glyph key (if available) */\r\nexport function getGlyphAtlasPlacement(metrics: TtfFontMetrics, gid: number, fontSizePx: number, supersample = 4, blurPx = 0): AtlasPlacement | null {\r\n  const key = makeKey(metrics, gid, fontSizePx, supersample, blurPx);\r\n  return glyphAtlasPlacements.get(key) ?? null;\r\n}\r\n\r\n/** For debugging / introspection */\r\nexport function glyphMaskCacheStats(): { entries: number; maxEntries: number } {\r\n  return { entries: glyphMaskCache.size, maxEntries };\r\n}\r\n", "/**\r\n * Simple separable Gaussian blur for 8-bit alpha masks.\r\n *\r\n * Exports blurAlpha(data, width, height, radiusPx)\r\n * - data: Uint8ClampedArray (length = width*height) containing alpha 0..255\r\n * - radiusPx: blur radius in pixels (CSS pixels). If radius <= 0 returns a copy of input.\r\n *\r\n * Implementation notes:\r\n * - Builds a 1D Gaussian kernel from sigma derived from radius (sigma = radius / 3).\r\n * - Performs horizontal pass then vertical pass using Float32 accumulation.\r\n * - Clamps outputs back to Uint8ClampedArray.\r\n *\r\n * This is intentionally simple and robust. It favors correctness over ultimate perf.\r\n */\r\n\r\nexport function blurAlpha(src: Uint8ClampedArray, width: number, height: number, radiusPx: number): Uint8ClampedArray {\r\n  if (!src || src.length === 0) return src;\r\n  if (radiusPx <= 0) return src.slice();\r\n\r\n  // Convert radius -> sigma. Use heuristic sigma ~= radius / 3 (so radius ~ 3*sigma)\r\n  const sigma = Math.max(0.0001, radiusPx / 3);\r\n  // Kernel size: 2*ceil(3*sigma)+1 ensures coverage\r\n  const half = Math.ceil(3 * sigma);\r\n  const ksize = half * 2 + 1;\r\n\r\n  // Build 1D Gaussian kernel (normalized)\r\n  const kernel = new Float32Array(ksize);\r\n  const sigma2 = sigma * sigma;\r\n  const denom = 1 / (Math.sqrt(2 * Math.PI) * sigma);\r\n  let sum = 0;\r\n  for (let i = -half; i <= half; i++) {\r\n    const v = denom * Math.exp(-(i * i) / (2 * sigma2));\r\n    kernel[i + half] = v;\r\n    sum += v;\r\n  }\r\n  // normalize\r\n  for (let i = 0; i < ksize; i++) kernel[i] /= sum;\r\n\r\n  // Horizontal pass -> float buffer\r\n  const tmp = new Float32Array(width * height);\r\n\r\n  for (let y = 0; y < height; y++) {\r\n    const row = y * width;\r\n    for (let x = 0; x < width; x++) {\r\n      let acc = 0;\r\n      for (let k = -half; k <= half; k++) {\r\n        const sx = x + k;\r\n        if (sx < 0) {\r\n          // clamp\r\n          acc += kernel[k + half] * src[row + 0];\r\n        } else if (sx >= width) {\r\n          acc += kernel[k + half] * src[row + (width - 1)];\r\n        } else {\r\n          acc += kernel[k + half] * src[row + sx];\r\n        }\r\n      }\r\n      tmp[row + x] = acc;\r\n    }\r\n  }\r\n\r\n  // Vertical pass -> output uint8\r\n  const out = new Uint8ClampedArray(width * height);\r\n  for (let x = 0; x < width; x++) {\r\n    for (let y = 0; y < height; y++) {\r\n      let acc = 0;\r\n      for (let k = -half; k <= half; k++) {\r\n        const sy = y + k;\r\n        if (sy < 0) {\r\n          acc += kernel[k + half] * tmp[0 * width + x];\r\n        } else if (sy >= height) {\r\n          acc += kernel[k + half] * tmp[(height - 1) * width + x];\r\n        } else {\r\n          acc += kernel[k + half] * tmp[sy * width + x];\r\n        }\r\n      }\r\n      out[y * width + x] = Math.round(acc);\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n", "import type { Run, TextMatrix } from \"../types.js\";\nimport type { UnifiedFont } from \"../../fonts/types.js\";\nimport type { FontRegistry, FontResource } from \"../font/font-registry.js\";\r\nimport type { ImageRenderer } from \"./image-renderer.js\";\r\nimport type { GraphicsStateManager } from \"./graphics-state-manager.js\";\r\nimport { CoordinateTransformer } from \"../utils/coordinate-transformer.js\";\r\nimport { getGlyphMask } from \"../font/glyph-cache.js\";\r\nimport { blurAlpha } from \"../font/blur.js\";\r\nimport { fillColorCommand, formatNumber, normalizeChannel } from \"./text-renderer-utils.js\";\r\n\r\nexport interface TextShadowRenderContext {\n  run: Run;\n  font: FontResource;\n  encoded: string;\n  Tm: TextMatrix;\n  fontSizePt: number;\n  fontSizePx: number;\n  wordSpacingPt: number;\n  appliedWordSpacing: boolean;\n  fontResourceName?: string;\n}\n\r\nexport class TextShadowRenderer {\n  private readonly runShadowCache = new Map<string, { alias: string; image: any }>();\n\n  constructor(\n    private readonly coordinateTransformer: CoordinateTransformer,\n    private readonly fontRegistry: FontRegistry,\r\n    private readonly imageRenderer?: ImageRenderer,\r\n    private readonly graphicsStateManager?: GraphicsStateManager,\r\n  ) {}\r\n\r\n  async render(context: TextShadowRenderContext): Promise<string[]> {\r\n    const commands: string[] = [];\r\n    const { run, font, encoded, Tm, fontSizePt, fontSizePx, wordSpacingPt, appliedWordSpacing, fontResourceName } = context;\n    if (!run.textShadows || run.textShadows.length === 0) {\r\n      return commands;\r\n    }\r\n\r\n    const needsRaster = run.textShadows.some(sh => (sh.blur ?? 0) > 0 || (sh.color && sh.color.a !== undefined && sh.color.a < 1));\n\n    // Prefer glyph-run supplied metrics (add outline hook) and fall back to embedder lookup.\n    const glyphMetrics = run.glyphs ? mergeMetricsWithOutline(run.glyphs.font) : null;\n    const embedder = this.fontRegistry.getEmbedder ? this.fontRegistry.getEmbedder() : undefined;\n    const faceMetrics = glyphMetrics ?? (embedder ? embedder.getMetrics((font as any).baseFont) : null);\n\r\n    const wordSpacingCmd = appliedWordSpacing ? `${formatNumber(wordSpacingPt)} Tw` : undefined;\n    const resetWordSpacingCmd = appliedWordSpacing ? \"0 Tw\" : undefined;\n    const fontName = fontResourceName ?? font.resourceName;\n\r\n    if (this.imageRenderer && needsRaster) {\r\n      if (run.glyphs && faceMetrics) {\n        try {\n          const pages = (await import(\"../font/glyph-atlas.js\")).globalGlyphAtlas.getPages();\n          if (pages && pages.length > 0) {\n            this.imageRenderer.registerAtlasPages(pages);\n          }\n        } catch {\r\n          // ignore\r\n        }\r\n\r\n        const supersample = 4;\r\n        const glyphMasks: Array<{ mask: any; pos: { x: number; y: number } }> = [];\n        for (let gi = 0; gi < run.glyphs.glyphIds.length; gi++) {\n          const gid = run.glyphs.glyphIds[gi];\n          const pos = run.glyphs.positions[gi] ?? { x: 0, y: 0 };\n          try {\n            const gm = getGlyphMask(faceMetrics as any, gid, fontSizePx, supersample, 0);\n            if (!gm) continue;\r\n            glyphMasks.push({ mask: gm, pos });\r\n          } catch {\r\n            // ignore individual glyph failures\r\n          }\r\n        }\r\n\r\n        if (glyphMasks.length > 0) {\n          let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\n          const maxBlurPx = run.textShadows.reduce((acc, sh) => Math.max(acc, Math.max(0, sh?.blur ?? 0)), 0);\n          for (const item of glyphMasks) {\n            const { mask, pos } = item;\n            const maskOffsetX = mask.offsetX ?? 0;\n            const maskOffsetY = mask.offsetY ?? 0;\n            const gx0 = pos.x + maskOffsetX;\n            const gy0 = pos.y + maskOffsetY;\n            const gx1 = gx0 + mask.width;\n            const gy1 = gy0 + mask.height;\n            if (gx0 < minX) minX = gx0;\n            if (gy0 < minY) minY = gy0;\n            if (gx1 > maxX) maxX = gx1;\n            if (gy1 > maxY) maxY = gy1;\n          }\n          // Pad the bounding box to leave room for blur bleed.\n          const bleedPad = Math.ceil(maxBlurPx * 2);\n          minX = Math.floor(minX - bleedPad);\n          minY = Math.floor(minY - bleedPad);\n          maxX = Math.ceil(maxX + bleedPad);\n          maxY = Math.ceil(maxY + bleedPad);\n\n          const combinedW = Math.max(0, maxX - minX);\n          const combinedH = Math.max(0, maxY - minY);\n          if (combinedW > 0 && combinedH > 0) {\n            const combinedAlpha = new Uint8Array(combinedW * combinedH);\n            for (const item of glyphMasks) {\n              const { mask, pos } = item;\n              const maskOffsetX = mask.offsetX ?? 0;\n              const maskOffsetY = mask.offsetY ?? 0;\n              const ox = Math.round(pos.x + maskOffsetX - minX);\n              const oy = Math.round(pos.y + maskOffsetY - minY);\n              for (let yy = 0; yy < mask.height; yy++) {\n                const dstRow = oy + yy;\n                if (dstRow < 0 || dstRow >= combinedH) continue;\n                const srcRow = yy;\r\n                const dstBase = dstRow * combinedW;\r\n                const srcBase = srcRow * mask.width;\r\n                for (let xx = 0; xx < mask.width; xx++) {\r\n                  const dstIdx = dstBase + ox + xx;\r\n                  if (dstIdx < 0 || dstIdx >= combinedAlpha.length) continue;\r\n                  const a = mask.data[srcBase + xx] || 0;\r\n                  const summed = combinedAlpha[dstIdx] + a;\r\n                  combinedAlpha[dstIdx] = summed > 255 ? 255 : summed;\r\n                }\r\n              }\r\n            }\r\n\r\n            for (const sh of run.textShadows) {\r\n              if (!sh || !sh.color) {\r\n                continue;\r\n              }\r\n              const blurPx = Math.max(0, sh.blur ?? 0);\r\n              const clampedCombined = combinedAlpha instanceof Uint8ClampedArray ? combinedAlpha : new Uint8ClampedArray(combinedAlpha);\r\n              const rawAlphaBuf = blurPx > 0 ? blurAlpha(clampedCombined, combinedW, combinedH, blurPx) : clampedCombined;\r\n              const alphaBuf = rawAlphaBuf instanceof Uint8ClampedArray ? rawAlphaBuf : new Uint8ClampedArray(rawAlphaBuf);\r\n\r\n              const r8 = Math.round(normalizeChannel(sh.color.r) * 255);\r\n              const g8 = Math.round(normalizeChannel(sh.color.g) * 255);\r\n              const b8 = Math.round(normalizeChannel(sh.color.b) * 255);\r\n              const shadowAlpha = sh.color.a ?? 1;\r\n\r\n              const cacheKey = `${run.text}|${(font as any).baseFont}|size:${fontSizePx}|blur:${Math.round(blurPx)}|color:${r8},${g8},${b8},${shadowAlpha}|ss:${supersample}`;\r\n              let resAlias: string | undefined;\r\n              const cached = this.runShadowCache.get(cacheKey);\r\n              if (cached) {\r\n                resAlias = cached.alias;\r\n              } else {\r\n                const rgba = new Uint8Array(combinedW * combinedH * 4);\r\n                for (let i = 0, j = 0; i < alphaBuf.length; i++, j += 4) {\r\n                  rgba[j] = r8;\r\n                  rgba[j + 1] = g8;\r\n                  rgba[j + 2] = b8;\r\n                  rgba[j + 3] = Math.round(alphaBuf[i] * shadowAlpha);\r\n                }\r\n                const img: any = {\r\n                  src: `internal:shadow:run:${(font as any).resourceName}:${Math.round(Math.random() * 1e9)}`,\r\n                  width: combinedW,\r\n                  height: combinedH,\r\n                  format: \"png\",\r\n                  channels: 4,\r\n                  bitsPerComponent: 8,\r\n                  data: rgba.buffer,\r\n                };\r\n                const res = this.imageRenderer.registerResource(img);\r\n                resAlias = res.alias;\r\n                this.runShadowCache.set(cacheKey, { alias: resAlias, image: img });\r\n              }\r\n              const offsetX = sh.offsetX ?? 0;\n              const offsetY = sh.offsetY ?? 0;\n              const xPx = Tm.e + offsetX + minX;\n              const yPxTop = Tm.f + offsetY + minY;\n              const widthPt = this.coordinateTransformer.convertPxToPt(combinedW);\n              const heightPt = this.coordinateTransformer.convertPxToPt(combinedH);\n              const xPt = this.coordinateTransformer.convertPxToPt(xPx);\n              const localYTop = yPxTop - this.coordinateTransformer.pageOffsetPx;\n              const yPt = this.coordinateTransformer.pageHeightPt - this.coordinateTransformer.convertPxToPt(localYTop + combinedH);\n\r\n              commands.push(\r\n                \"q\",\r\n                `${formatNumber(widthPt)} 0 0 ${formatNumber(heightPt)} ${formatNumber(xPt)} ${formatNumber(yPt)} cm`,\r\n                `/${resAlias} Do`,\r\n                \"Q\",\r\n              );\r\n            }\r\n          }\n        }\n\n        // If we failed to build any glyph masks (e.g., missing outlines), fall back to vector shadows.\n        if (glyphMasks.length === 0) {\n          this.appendVectorShadowLayers(commands, run, font, encoded, Tm, fontSizePt, fontName, wordSpacingCmd, resetWordSpacingCmd);\n        }\n      } else {\n        if (needsRaster && this.imageRenderer) {\n          try {\n            for (const sh of run.textShadows) {\n              if (!sh || !sh.color) continue;\n              const offsetX = sh.offsetX ?? 0;\r\n              const offsetY = sh.offsetY ?? 0;\r\n              const blurPx = Math.max(0, sh.blur ?? 0);\r\n              const baseAlpha = sh.color.a ?? 1;\r\n\r\n              const samples: { dx: number; dy: number; weight: number }[] = [];\r\n              if (blurPx <= 1) {\r\n                samples.push({ dx: 0, dy: 0, weight: 1 });\r\n              } else {\r\n                const centerW = 0.38;\r\n                const orthoW = 0.12;\r\n                const diagW = (1 - (centerW + 4 * orthoW)) / 4;\r\n                const radius = blurPx / 2;\r\n                samples.push({ dx: 0, dy: 0, weight: centerW });\r\n                samples.push({ dx: -radius, dy: 0, weight: orthoW });\r\n                samples.push({ dx: radius, dy: 0, weight: orthoW });\r\n                samples.push({ dx: 0, dy: -radius, weight: orthoW });\r\n                samples.push({ dx: 0, dy: radius, weight: orthoW });\r\n                samples.push({ dx: -radius, dy: -radius, weight: diagW });\r\n                samples.push({ dx: radius, dy: -radius, weight: diagW });\r\n                samples.push({ dx: -radius, dy: radius, weight: diagW });\r\n                samples.push({ dx: radius, dy: radius, weight: diagW });\r\n              }\r\n\r\n              for (const s of samples) {\r\n                const sx = s.dx;\r\n                const sy = s.dy;\r\n                const sampleAlpha = baseAlpha * s.weight;\r\n                const sampleColor = { r: sh.color.r, g: sh.color.g, b: sh.color.b, a: sampleAlpha };\r\n\r\n                const shadowX = this.coordinateTransformer.convertPxToPt(Tm.e + offsetX + sx);\r\n                const shadowLocalBaseline = Tm.f - this.coordinateTransformer.pageOffsetPx + offsetY + sy;\r\n                const shadowYPt = this.coordinateTransformer.pageHeightPt - this.coordinateTransformer.convertPxToPt(shadowLocalBaseline);\r\n\r\n                const shadowSequence: string[] = [\"q\", fillColorCommand(sampleColor, this.graphicsStateManager), \"BT\"];\r\n                if (wordSpacingCmd) shadowSequence.push(wordSpacingCmd);\r\n                shadowSequence.push(\r\n                  `/${fontName} ${formatNumber(fontSizePt)} Tf`,\n                  `${formatNumber(Tm.a)} ${formatNumber(Tm.b)} ${formatNumber(Tm.c)} ${formatNumber(Tm.d)} ${formatNumber(shadowX)} ${formatNumber(shadowYPt)} Tm`,\r\n                  `(${encoded}) Tj`,\r\n                );\r\n                if (resetWordSpacingCmd) shadowSequence.push(resetWordSpacingCmd);\r\n                shadowSequence.push(\"ET\", \"Q\");\r\n                commands.push(...shadowSequence);\r\n              }\r\n            }\r\n          } catch {\r\n            this.appendVectorShadowLayers(commands, run, font, encoded, Tm, fontSizePt, fontName, wordSpacingCmd, resetWordSpacingCmd);\n          }\n        } else {\n          this.appendVectorShadowLayers(commands, run, font, encoded, Tm, fontSizePt, fontName, wordSpacingCmd, resetWordSpacingCmd);\n        }\n      }\n    } else {\n      this.appendVectorShadowLayers(commands, run, font, encoded, Tm, fontSizePt, fontName, wordSpacingCmd, resetWordSpacingCmd);\n    }\n\r\n    return commands;\r\n  }\r\n\r\n  private appendVectorShadowLayers(\n    commands: string[],\n    run: Run,\n    font: FontResource,\n    encoded: string,\n    Tm: TextMatrix,\n    fontSizePt: number,\n    fontName: string,\n    wordSpacingCmd?: string,\n    resetWordSpacingCmd?: string,\n  ): void {\n    const shadows = run.textShadows ?? [];\r\n    for (const sh of shadows) {\r\n      if (!sh || !sh.color) {\r\n        continue;\r\n      }\r\n      const shadowX = this.coordinateTransformer.convertPxToPt(Tm.e + (sh.offsetX ?? 0));\r\n      const shadowLocalBaseline = Tm.f - this.coordinateTransformer.pageOffsetPx + (sh.offsetY ?? 0);\r\n      const shadowYPt = this.coordinateTransformer.pageHeightPt - this.coordinateTransformer.convertPxToPt(shadowLocalBaseline);\r\n\r\n      const shadowSequence: string[] = [\"q\", fillColorCommand(sh.color, this.graphicsStateManager), \"BT\"];\n      if (wordSpacingCmd) shadowSequence.push(wordSpacingCmd);\n      shadowSequence.push(\n        `/${fontName} ${formatNumber(fontSizePt)} Tf`,\n        `${formatNumber(Tm.a)} ${formatNumber(Tm.b)} ${formatNumber(Tm.c)} ${formatNumber(Tm.d)} ${formatNumber(shadowX)} ${formatNumber(shadowYPt)} Tm`,\n        `(${encoded}) Tj`,\n      );\n      if (resetWordSpacingCmd) shadowSequence.push(resetWordSpacingCmd);\r\n      shadowSequence.push(\"ET\", \"Q\");\r\n      commands.push(...shadowSequence);\r\n    }\r\n  }\n}\n\n// Merge UnifiedFont metrics with its outline provider so glyph rasterization can work.\nfunction mergeMetricsWithOutline(font: UnifiedFont | undefined | null): any | null {\n  if (!font?.metrics || !font.program?.getGlyphOutline) {\n    return null;\n  }\n  return {\n    metrics: font.metrics.metrics,\n    glyphMetrics: font.metrics.glyphMetrics,\n    cmap: font.metrics.cmap,\n    headBBox: font.metrics.headBBox,\n    getGlyphOutline: font.program.getGlyphOutline,\n  };\n}\n", "import type { RGBA, Rect, Run } from \"../types.js\";\r\nimport type { CoordinateTransformer } from \"../utils/coordinate-transformer.js\";\r\nimport type { GraphicsStateManager } from \"./graphics-state-manager.js\";\r\nimport { fillColorCommand, formatNumber } from \"./text-renderer-utils.js\";\r\n\r\nexport class TextDecorationRenderer {\r\n  constructor(\r\n    private readonly coordinateTransformer: CoordinateTransformer,\r\n    private readonly graphicsStateManager?: GraphicsStateManager,\r\n  ) {}\n\n  render(run: Run, color: RGBA): string[] {\n    if (!run.decorations) {\n      return [];\n    }\n    const matrix = run.lineMatrix;\n    if (!matrix) {\n      return [];\n    }\r\n\r\n    const commands: string[] = [];\n    const style = run.decorations.style ?? \"solid\";\n\n    switch (style) {\n      case \"double\":\n        commands.push(...this.renderDouble(run, color));\n        break;\n      case \"dotted\":\n      case \"dashed\":\n        commands.push(...this.renderDashedOrDotted(run, color, style));\n        break;\n      case \"wavy\":\n        commands.push(...this.renderWavy(run, color));\n        break;\n      case \"solid\":\n      default:\n        commands.push(...this.renderSolid(run, color));\n        break;\n    }\n\n    return commands;\n  }\n\n  private renderSolid(run: Run, color: RGBA): string[] {\n    const matrix = run.lineMatrix;\n    if (!matrix) {\n      return [];\n    }\n    const widthPx = Math.max(run.advanceWidth ?? 0, 0);\n    if (widthPx <= 0) {\n      return [];\n    }\n\n    const rects: Rect[] = [];\n    if (run.decorations?.lineThrough) {\n      const thicknessPx = Math.max(run.fontSize * 0.085, 0.5);\n      const centerYPx = matrix.f - run.fontSize * 0.3;\n      rects.push({\n        x: matrix.e,\n        y: centerYPx - thicknessPx / 2,\n        width: widthPx,\n        height: thicknessPx,\n      });\n    }\n    if (run.decorations?.underline) {\n      const thicknessPx = Math.max(run.fontSize * 0.065, 0.5);\n      const underlineYPx = matrix.f + run.fontSize * 0.1;\n      rects.push({\n        x: matrix.e,\n        y: underlineYPx - thicknessPx / 2,\n        width: widthPx,\n        height: thicknessPx,\n      });\n    }\n    if (run.decorations?.overline) {\n      const thicknessPx = Math.max(run.fontSize * 0.05, 0.5);\n      const overlineYPx = matrix.f - run.fontSize * 0.9;\n      rects.push({\n        x: matrix.e,\n        y: overlineYPx - thicknessPx / 2,\n        width: widthPx,\n        height: thicknessPx,\n      });\n    }\n\n    const commands: string[] = [];\n    const decorationColor = run.decorations?.color ?? color;\n    for (const rect of rects) {\n      const pdfRect = this.rectToPdf(rect);\n      if (!pdfRect) {\n        continue;\n      }\n      commands.push(\n        fillColorCommand(decorationColor, this.graphicsStateManager),\n        `${pdfRect.x} ${pdfRect.y} ${pdfRect.width} ${pdfRect.height} re`,\n        \"f\",\n      );\n    }\n    return commands;\n  }\n\n  private renderDouble(run: Run, color: RGBA): string[] {\n    const matrix = run.lineMatrix;\n    if (!matrix || (!run.decorations?.underline && !run.decorations?.overline && !run.decorations?.lineThrough)) {\n      return [];\n    }\n    const widthPx = Math.max(run.advanceWidth ?? 0, 0);\n    if (widthPx <= 0) {\n      return [];\n    }\n\n    const commands: string[] = [];\n    const decorationColor = run.decorations?.color ?? color;\n\n    const pushLinePair = (centerY: number, thickness: number) => {\n      const gap = Math.max(thickness * 0.8, 0.5);\n      const singleHeight = Math.max(thickness * 0.8, 0.5);\n      const firstY = centerY - gap / 2 - singleHeight / 2;\n      const secondY = centerY + gap / 2 - singleHeight / 2;\n      const rects: Rect[] = [\n        { x: matrix.e, y: firstY, width: widthPx, height: singleHeight },\n        { x: matrix.e, y: secondY, width: widthPx, height: singleHeight },\n      ];\n      for (const rect of rects) {\n        const pdfRect = this.rectToPdf(rect);\n        if (!pdfRect) continue;\n        commands.push(\n          fillColorCommand(decorationColor, this.graphicsStateManager),\n          `${pdfRect.x} ${pdfRect.y} ${pdfRect.width} ${pdfRect.height} re`,\n          \"f\",\n        );\n      }\n    };\n\n    if (run.decorations.lineThrough) {\n      const thicknessPx = Math.max(run.fontSize * 0.085, 0.5);\n      const centerYPx = matrix.f - run.fontSize * 0.3;\n      pushLinePair(centerYPx, thicknessPx);\n    }\n    if (run.decorations.underline) {\n      const thicknessPx = Math.max(run.fontSize * 0.065, 0.5);\n      const underlineYPx = matrix.f + run.fontSize * 0.1;\n      pushLinePair(underlineYPx, thicknessPx);\n    }\n    if (run.decorations.overline) {\n      const thicknessPx = Math.max(run.fontSize * 0.05, 0.5);\n      const overlineYPx = matrix.f - run.fontSize * 0.9;\n      pushLinePair(overlineYPx, thicknessPx);\n    }\n\n    return commands;\n  }\n\n  private renderDashedOrDotted(run: Run, color: RGBA, style: \"dashed\" | \"dotted\"): string[] {\n    const matrix = run.lineMatrix;\n    if (!matrix || (!run.decorations?.underline && !run.decorations?.overline && !run.decorations?.lineThrough)) {\n      return [];\n    }\n    const widthPx = Math.max(run.advanceWidth ?? 0, 0);\n    if (widthPx <= 0) {\n      return [];\n    }\n\n    const decorationColor = run.decorations?.color ?? color;\n    const commands: string[] = [];\n\n    const thicknessBase = run.fontSize * 0.065;\n    const lineWidthPx = Math.max(thicknessBase, 0.5);\n    const dashUnit = Math.max(lineWidthPx, 0.5);\n    const dashPattern =\n      style === \"dashed\"\n        ? [3 * dashUnit, 3 * dashUnit]\n        : [dashUnit, dashUnit];\n\n    const pushLine = (yPx: number) => {\n      const xStartPt = formatNumber(this.coordinateTransformer.convertPxToPt(matrix.e));\n      const xEndPt = formatNumber(this.coordinateTransformer.convertPxToPt(matrix.e + widthPx));\n      const localY = yPx - this.coordinateTransformer.pageOffsetPx;\n      const yPt = formatNumber(\n        this.coordinateTransformer.pageHeightPt - this.coordinateTransformer.convertPxToPt(localY),\n      );\n      const widthPt = this.coordinateTransformer.convertPxToPt(Math.max(lineWidthPx, 0));\n      const dashPt = dashPattern\n        .map((v) => this.coordinateTransformer.convertPxToPt(Math.max(v, 0)))\n        .map(formatNumber)\n        .join(\" \");\n\n      commands.push(\n        fillColorCommand(decorationColor, this.graphicsStateManager),\n        `${widthPt > 0 ? formatNumber(widthPt) : \"0\"} w`,\n        `[${dashPt}] 0 d`,\n        `${xStartPt} ${yPt} m`,\n        `${xEndPt} ${yPt} l`,\n        \"S\",\n        \"[] 0 d\",\n      );\n    };\n\n    if (run.decorations.lineThrough) {\n      const centerYPx = matrix.f - run.fontSize * 0.3;\n      pushLine(centerYPx);\n    }\n    if (run.decorations.underline) {\n      const underlineYPx = matrix.f + run.fontSize * 0.1;\n      pushLine(underlineYPx);\n    }\n    if (run.decorations.overline) {\n      const overlineYPx = matrix.f - run.fontSize * 0.9;\n      pushLine(overlineYPx);\n    }\n\n    return commands;\n  }\n\n  private renderWavy(run: Run, color: RGBA): string[] {\n    const matrix = run.lineMatrix;\n    if (!matrix || (!run.decorations?.underline && !run.decorations?.overline && !run.decorations?.lineThrough)) {\n      return [];\n    }\n    const widthPx = Math.max(run.advanceWidth ?? 0, 0);\n    if (widthPx <= 0) {\n      return [];\n    }\n\n    const decorationColor = run.decorations?.color ?? color;\n    const commands: string[] = [];\n\n    const amplitudePx = Math.max(run.fontSize * 0.08, 0.5);\n    const wavelengthPx = Math.max(run.fontSize * 0.4, 2);\n    const lineWidthPx = Math.max(run.fontSize * 0.065, 0.5);\n\n    const buildWavePoints = (baselineY: number): { x: number; y: number }[] => {\n      const points: { x: number; y: number }[] = [];\n      const steps = Math.max(Math.round(widthPx / (wavelengthPx / 2)), 2);\n      for (let i = 0; i <= steps; i++) {\n        const x = matrix.e + (widthPx * i) / steps;\n        const phase = i % 2 === 0 ? -1 : 1;\n        const y = baselineY + phase * amplitudePx;\n        points.push({ x, y });\n      }\n      return points;\n    };\n\n    const pushWave = (baselineY: number) => {\n      const points = buildWavePoints(baselineY);\n      if (points.length < 2) {\n        return;\n      }\n\n      const localY = points[0].y - this.coordinateTransformer.pageOffsetPx;\n      const yPtFirst = this.coordinateTransformer.pageHeightPt - this.coordinateTransformer.convertPxToPt(localY);\n      const xPtFirst = this.coordinateTransformer.convertPxToPt(points[0].x);\n      const widthPt = this.coordinateTransformer.convertPxToPt(Math.max(lineWidthPx, 0));\n\n      commands.push(\n        fillColorCommand(decorationColor, this.graphicsStateManager),\n        `${formatNumber(widthPt)} w`,\n      );\n\n      commands.push(\n        `${formatNumber(xPtFirst)} ${formatNumber(yPtFirst)} m`,\n      );\n\n      for (let i = 1; i < points.length; i++) {\n        const localYPoint = points[i].y - this.coordinateTransformer.pageOffsetPx;\n        const yPt = this.coordinateTransformer.pageHeightPt - this.coordinateTransformer.convertPxToPt(localYPoint);\n        const xPt = this.coordinateTransformer.convertPxToPt(points[i].x);\n        commands.push(`${formatNumber(xPt)} ${formatNumber(yPt)} l`);\n      }\n\n      commands.push(\"S\");\n    };\n\n    if (run.decorations.lineThrough) {\n      const centerYPx = matrix.f - run.fontSize * 0.3;\n      pushWave(centerYPx);\n    }\n    if (run.decorations.underline) {\n      const underlineYPx = matrix.f + run.fontSize * 0.1;\n      pushWave(underlineYPx);\n    }\n    if (run.decorations.overline) {\n      const overlineYPx = matrix.f - run.fontSize * 0.9;\n      pushWave(overlineYPx);\n    }\n\n    return commands;\n  }\n\r\n  private rectToPdf(rect: Rect | null | undefined):\r\n    | { x: string; y: string; width: string; height: string }\r\n    | null {\r\n    if (!rect) {\r\n      return null;\r\n    }\r\n    const widthPx = Math.max(rect.width, 0);\r\n    const heightPx = Math.max(rect.height, 0);\r\n    if (widthPx === 0 || heightPx === 0) {\r\n      return null;\r\n    }\r\n    const localY = rect.y - this.coordinateTransformer.pageOffsetPx;\r\n    const x = this.coordinateTransformer.convertPxToPt(rect.x);\r\n    const y = this.coordinateTransformer.pageHeightPt - this.coordinateTransformer.convertPxToPt(localY + heightPx);\r\n    const width = this.coordinateTransformer.convertPxToPt(widthPx);\r\n    const height = this.coordinateTransformer.convertPxToPt(heightPx);\r\n    return {\r\n      x: formatNumber(x),\r\n      y: formatNumber(y),\r\n      width: formatNumber(width),\r\n      height: formatNumber(height),\r\n    };\r\n  }\r\n}\r\n", "import type { FontRegistry, FontResource } from \"../font/font-registry.js\";\r\nimport { needsUnicode } from \"../../text/text.js\";\r\n\r\nexport interface TextFontResolveOptions {\r\n  readonly fontFamily?: string;\r\n  readonly fontWeight?: number;\r\n  readonly fontStyle?: string;\r\n  readonly fontVariant?: string;\r\n  readonly text?: string;\r\n}\r\n\r\nexport class TextFontResolver {\r\n  constructor(private readonly fontRegistry: FontRegistry) {}\r\n\r\n  async ensureFontResource(options: TextFontResolveOptions): Promise<FontResource> {\r\n    const text = options.text ?? \"\";\r\n    const requiresUnicode = needsUnicode(text);\r\n    const familiesToTry: (string | undefined)[] = [];\r\n\r\n    if (options.fontFamily) {\r\n      familiesToTry.push(options.fontFamily);\r\n    }\r\n\r\n    if (requiresUnicode) {\r\n      const fallbackStack = this.fontRegistry.getDefaultFontStack();\r\n      for (const family of fallbackStack) {\r\n        if (family && family.length > 0) {\r\n          familiesToTry.push(family);\r\n        }\r\n      }\r\n    }\r\n\r\n    familiesToTry.push(undefined);\r\n\r\n    const seen = new Set<string>();\r\n    const attempted: FontResource[] = [];\r\n\r\n    for (const family of familiesToTry) {\r\n      const key = family ?? \"__default__\";\r\n      if (seen.has(key)) {\r\n        continue;\r\n      }\r\n      seen.add(key);\r\n\r\n      const resource = await this.fontRegistry.ensureFontResource(family, options.fontWeight, options.fontStyle);\r\n      attempted.push(resource);\r\n\r\n      if (fontSupportsText(resource, text, requiresUnicode)) {\r\n        return resource;\r\n      }\r\n    }\r\n\r\n    return attempted[attempted.length - 1]!;\r\n  }\r\n}\r\n\r\nfunction fontSupportsText(font: FontResource, text: string, requiresUnicode: boolean): boolean {\r\n  if (!text) {\r\n    return true;\r\n  }\r\n  if (!font.metrics) {\r\n    return !requiresUnicode;\r\n  }\r\n  for (const char of text) {\r\n    const codePoint = char.codePointAt(0);\r\n    if (codePoint === undefined) {\r\n      continue;\r\n    }\r\n    const glyphId = font.metrics.cmap.getGlyphId(codePoint);\r\n    if (glyphId === 0) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n", "import type { FontResource } from \"../font/font-registry.js\";\r\nimport { encodeAndEscapePdfText, escapePdfLiteral, type PdfEncodingScheme } from \"../utils/encoding.js\";\r\nimport { log } from \"../../logging/debug.js\";\n\r\nexport interface TextEncodedPayload {\r\n  readonly encoded: string;\r\n  readonly scheme: PdfEncodingScheme;\r\n}\r\n\r\nexport function encodeTextPayload(text: string, font: FontResource): TextEncodedPayload {\r\n  if (font.isBase14) {\r\n    return { encoded: encodeAndEscapePdfText(text, \"WinAnsi\"), scheme: \"WinAnsi\" };\r\n  }\r\n  return { encoded: encodeIdentityText(text, font), scheme: \"Identity-H\" };\r\n}\r\n\r\nfunction encodeIdentityText(text: string, font: FontResource): string {\r\n  const metrics = font.metrics;\r\n  if (!metrics) {\r\n    return encodeAndEscapePdfText(text, \"WinAnsi\");\r\n  }\r\n  let encoded = \"\";\r\n  const samples: Array<{ char: string, codePoint: number, gid: number }> = [];\r\n  for (const char of text) {\r\n    const codePoint = char.codePointAt(0);\r\n    if (codePoint === undefined) {\r\n      continue;\r\n    }\r\n    const glyphId = metrics.cmap.getGlyphId(codePoint);\r\n    if (samples.length < 10) {\r\n      samples.push({ char, codePoint, gid: glyphId });\r\n    }\r\n    // For Identity-H encoding, write the Unicode code point, not the glyph ID\r\n    // The font's internal cmap will map Unicode -> Glyph ID during rendering\r\n    encoded += String.fromCharCode((codePoint >> 8) & 0xff, codePoint & 0xff);\r\n  }\r\n  if (samples.length > 0) {\r\n    log(\"encoding\", \"debug\", \"Identity-H encoding samples\", { font: font.baseFont, samples });\n  }\r\n  return escapePdfLiteral(encoded);\r\n}\r\n", "import type { GlyphRun } from \"../../layout/text-run.js\";\nimport type { PdfFontSubset } from \"../font/font-subset.js\";\nimport type { GraphicsStateManager } from \"../renderers/graphics-state-manager.js\";\nimport { fillColorCommand, formatNumber } from \"../renderers/text-renderer-utils.js\";\nimport type { RGBA } from \"../types.js\";\n\nexport interface DrawGlyphRunOptions {\n  skipColor?: boolean;\n  textRenderingMode?: number;\n  afterTextCommands?: string[];\n}\n\r\n/**\r\n * Draws a GlyphRun using a PdfFontSubset.\r\n * Returns PDF content stream commands.\r\n */\r\nexport function drawGlyphRun(\n  run: GlyphRun,\n  subset: PdfFontSubset,\n  xPt: number,\n  yPt: number,\n  fontSizePt: number,\n  color: RGBA,\n  graphicsStateManager?: GraphicsStateManager,\n  wordSpacingPt = 0,\n  options?: DrawGlyphRunOptions,\n): string[] {\n    const commands: string[] = [];\n    if (!options?.skipColor) {\n      commands.push(fillColorCommand(color, graphicsStateManager));\n    }\n\n    // Begin text\n    commands.push(\"BT\");\n    commands.push(`${subset.name} ${formatNumber(fontSizePt)} Tf`);\n    commands.push(`${formatNumber(xPt)} ${formatNumber(yPt)} Td`);\n\n    const appliedWordSpacing = wordSpacingPt !== 0;\n    if (appliedWordSpacing) {\n      commands.push(`${formatNumber(wordSpacingPt)} Tw`);\n    }\n\n    if (options?.textRenderingMode !== undefined) {\n      commands.push(`${options.textRenderingMode} Tr`);\n    }\n\r\n    // Build TJ array with per-glyph kerning/letter-spacing adjustments and optional word spacing.\r\n    // Positions are provided in layout px units; scale to PDF points.\r\n    const ptPerPx = fontSizePt / run.fontSize;\r\n    const unitsPerEm = run.font.metrics.metrics.unitsPerEm;\r\n    const glyphWidths = run.font.metrics.glyphMetrics;\r\n    const encodeGlyphId = (gid: number): string => {\r\n        const charCode = subset.encodeGlyph(gid);\r\n        const hex = charCode.toString(16).toUpperCase();\r\n        // PDF expects an even number of hex digits; use at least 2 bytes for Identity-H\r\n        const evenHex = hex.length % 2 === 0 ? hex : `0${hex}`;\r\n        return evenHex.length < 4 ? evenHex.padStart(4, \"0\") : evenHex;\r\n    };\r\n    const elements: (string | number)[] = [];\r\n    let hasAdjustments = false;\r\n\r\n    for (let i = 0; i < run.glyphIds.length; i++) {\r\n        const gid = run.glyphIds[i];\r\n        const hexCode = encodeGlyphId(gid);\r\n        elements.push(`<${hexCode}>`);\r\n\r\n        if (i < run.glyphIds.length - 1) {\r\n            const currentPos = run.positions[i]?.x ?? 0;\r\n            const nextPos = run.positions[i + 1]?.x ?? currentPos;\r\n            let desiredAdvancePx = nextPos - currentPos;\r\n            if (appliedWordSpacing) {\r\n                const nextChar = run.text[i + 1] ?? \"\";\r\n                if (nextChar === \" \") {\r\n                    // Word spacing is added on spaces; add to desired advance.\r\n                    desiredAdvancePx += wordSpacingPt / ptPerPx;\r\n                }\r\n            }\r\n\r\n            const gm = glyphWidths.get(gid);\r\n            const defaultAdvancePx = ((gm?.advanceWidth ?? 0) / unitsPerEm) * run.fontSize;\r\n\r\n            const deltaPx = desiredAdvancePx - defaultAdvancePx;\r\n            if (Math.abs(deltaPx) > 1e-6) {\r\n                const deltaPt = deltaPx * ptPerPx;\r\n                // TJ numbers are in thousandths of text space; positive numbers tighten spacing.\r\n                const adjustment = -deltaPt / fontSizePt * 1000;\r\n                if (Math.abs(adjustment) > 1e-6) {\r\n                    hasAdjustments = true;\r\n                    elements.push(adjustment);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    if (!hasAdjustments) {\r\n        // Use a single hex string when there are no per-glyph adjustments; simpler and more compatible.\r\n        const hex = run.glyphIds.map((gid) => encodeGlyphId(gid)).join(\"\");\r\n        commands.push(`<${hex}> Tj`);\r\n    } else {\r\n        const tjContent = elements\r\n            .map((el) => (typeof el === \"number\" ? formatPdfNumber(el) : el))\r\n            .join(\" \");\r\n        commands.push(`[${tjContent}] TJ`);\r\n    }\r\n\r\n    // End text\n    commands.push(\"ET\");\n    if (options?.afterTextCommands && options.afterTextCommands.length > 0) {\n        commands.push(...options.afterTextCommands);\n    }\n\n    return commands;\n}\r\n\r\n/**\r\n * Format a number for PDF (up to 6 decimal places, trailing zeros removed).\r\n */\r\nexport function formatPdfNumber(n: number): string {\r\n    return n.toFixed(6).replace(/\\.?0+$/, \"\");\r\n}\r\n", "import type { LinearGradient, GradientStop } from \"../../css/parsers/gradient-parser.js\";\r\nimport { CoordinateTransformer } from \"../utils/coordinate-transformer.js\";\r\nimport { parseColor as parseCssColor } from \"../utils/color-utils.js\";\r\nimport type { RGBA } from \"../types.js\";\r\n\r\nexport interface GradientShading {\n  readonly shadingName: string;\n  readonly dictionary: string;\n}\n\nexport interface GradientPattern {\n  readonly patternName: string;\n  readonly dictionary: string;\n}\n\nlet GLOBAL_GRADIENT_SERVICE_ID = 0;\n\r\nexport class GradientService {\r\n  private readonly shadings = new Map<string, GradientShading>();\r\n  private shadingCounter = 0;\r\n  private readonly serviceId = GLOBAL_GRADIENT_SERVICE_ID++;\r\n\r\n  constructor(\r\n    private readonly coordinateTransformer: CoordinateTransformer,\r\n  ) {}\r\n\r\n  createLinearGradient(\n    gradient: LinearGradient,\n    rect: { x?: number; y?: number; width: number; height: number },\n  ): GradientShading {\n    const shadingName = this.generateShadingName();\n    const stops = this.normalizeStops(gradient.stops);\n    const offsetX = gradient.renderOffset?.x ?? 0;\n    const offsetY = gradient.renderOffset?.y ?? 0;\n    const scaleX = gradient.renderScale?.x ?? 1;\n    const scaleY = gradient.renderScale?.y ?? 1;\n    const coordRect = {\n      x: (rect.x ?? 0) + offsetX,\n      y: (rect.y ?? 0) + offsetY,\n      width: rect.width * scaleX,\n      height: rect.height * scaleY,\n    };\n\n    // If gradient provides explicit coords (from SVG), honor them\n    let coords: [number, number, number, number];\n    if (gradient.coords && gradient.coords.units === \"userSpace\") {\n      // coords are absolute page pixels; convert to rectangle-local points\n      const x0 = gradient.coords.x1 - coordRect.x;\n      const y0 = gradient.coords.y1 - coordRect.y;\n      const x1 = gradient.coords.x2 - coordRect.x;\n      const y1 = gradient.coords.y2 - coordRect.y;\n      coords = [\n        x0,\n        y0,\n        x1,\n        y1,\n      ];\n    } else if (gradient.coords && gradient.coords.units === \"ratio\") {\n      // coords are in objectBoundingBox (0..1) relative to rect\n      const widthPx = Math.max(coordRect.width, 0);\n      const heightPx = Math.max(coordRect.height, 0);\n      const x0 = gradient.coords.x1 * widthPx;\n      const y0 = gradient.coords.y1 * heightPx;\n      const x1 = gradient.coords.x2 * widthPx;\n      const y1 = gradient.coords.y2 * heightPx;\n      coords = [x0, y0, x1, y1];\n    } else {\n      coords = this.calculateGradientCoordinates(gradient, coordRect);\n    }\n    const interpolationFn = this.buildInterpolationFunction(stops);\n\r\n    const dictionary = [\r\n      \"<<\",\r\n      \"/ShadingType 2\",\r\n      \"/ColorSpace /DeviceRGB\",\r\n      `/Coords [${coords.map(formatNumber).join(\" \")}]`,\r\n      \"/Domain [0 1]\",\r\n      `/Function ${interpolationFn}`,\r\n      \"/Extend [true true]\",\r\n      \">>\",\r\n    ].join(\"\\n\");\r\n\r\n    const shading: GradientShading = { shadingName, dictionary };\r\n    this.shadings.set(shadingName, shading);\r\n    return shading;\r\n  }\n\n  createPatternFromLinearGradient(\n    gradient: LinearGradient,\n    rect: { x?: number; y?: number; width: number; height: number },\n  ): GradientPattern {\n    const shading = this.createLinearGradient(gradient, { x: rect.x, y: rect.y, width: rect.width, height: rect.height });\n    const patternName = `${shading.shadingName}_Pat`;\n    const scale = this.coordinateTransformer.convertPxToPt(1);\n    const localY = (rect.y ?? 0) - this.coordinateTransformer.pageOffsetPx;\n    const tx = this.coordinateTransformer.convertPxToPt(rect.x ?? 0);\n    const ty = this.coordinateTransformer.pageHeightPt - this.coordinateTransformer.convertPxToPt(localY);\n    const dict = [\n      \"<<\",\n      \"/Type /Pattern\",\n      \"/PatternType 2\",\n      `/Shading ${shading.dictionary}`,\n      `/Matrix [${formatNumber(scale)} 0 0 ${formatNumber(-scale)} ${formatNumber(tx)} ${formatNumber(ty)}]`,\n      \">>\",\n    ].join(\"\\n\");\n    return { patternName, dictionary: dict };\n  }\n\n  createRadialGradient(\n    gradient: import(\"../../css/parsers/gradient-parser.js\").RadialGradient,\n    rect: { x?: number; y?: number; width: number; height: number },\n  ): GradientShading {\n    const shadingName = this.generateShadingName();\n    const stops = this.normalizeStops(gradient.stops);\n\n    const widthPx = Math.max(rect.width, 0);\n    const heightPx = Math.max(rect.height, 0);\n    const safeWidth = widthPx > 0 ? widthPx : 1;\n    const safeHeight = heightPx > 0 ? heightPx : 1;\n\n  let coords: [number, number, number, number, number, number];\n  let matrixEntry: string | null = null;\n\n  if (gradient.coordsUnits === \"userSpace\") {\n      // gradient.cx/cy/r are in page pixels; convert to rectangle-local px then to points\n      const cxPx = gradient.cx ?? 0;\n      const cyPx = gradient.cy ?? 0;\n      const rPx = gradient.r ?? 0;\n\n      const localCxPx = cxPx - (rect.x ?? 0);\n      const localCyPx = cyPx - (rect.y ?? 0);\n\n      const centerX = localCxPx;\n      const centerY = localCyPx;\n      const radius = rPx;\n\n      // If focal point provided, place inner circle at focal, otherwise inner circle at center with r0 = 0\n      if (gradient.fx !== undefined && gradient.fy !== undefined) {\n        const fxPx = gradient.fx - (rect.x ?? 0);\n        const fyPx = gradient.fy - (rect.y ?? 0);\n        const focalX = fxPx;\n        const focalY = fyPx;\n        coords = [focalX, focalY, 0, centerX, centerY, radius];\n      } else {\n        coords = [centerX, centerY, 0, centerX, centerY, radius];\n      }\n    } else {\n      // Treat as ratio (objectBoundingBox)\r\n      const cx = gradient.cx ?? 0.5;\r\n      const cy = gradient.cy ?? 0.5;\r\n      const r = gradient.r ?? 0.5;\r\n\r\n      // If the gradient supplied a transform (from SVG gradientTransform), we will\r\n      // provide coordinates in ratio-space and emit a /Matrix that maps ratio-space\r\n      // shading coordinates into local page points. This allows an exact mapping of\r\n      // circles in shading space to ellipses in device space.\r\n      if (gradient.transform) {\r\n        // Apply the gradientTransform to center/focal and an edge point in ratio-space,\r\n        // then convert those transformed ratio coords into local points. This preserves\r\n        // the SVG semantics while producing absolute coords in the shading dictionary.\r\n        const t = gradient.transform;\r\n        const apply = (x: number, y: number) => {\r\n          return {\r\n            x: t.a * x + t.c * y + t.e,\r\n            y: t.b * x + t.d * y + t.f,\r\n          };\r\n        };\r\n\r\n        const tc = apply(cx, cy);\r\n        const te = apply(cx + r, cy);\r\n\r\n        const centerX = tc.x * safeWidth;\r\n        const centerY = tc.y * safeHeight;\r\n        const edgeX = te.x * safeWidth;\r\n        const edgeY = te.y * safeHeight;\r\n        const radius = Math.sqrt((edgeX - centerX) * (edgeX - centerX) + (edgeY - centerY) * (edgeY - centerY));\r\n\r\n        if (gradient.fx !== undefined && gradient.fy !== undefined) {\r\n          const tf = apply(gradient.fx, gradient.fy);\r\n          const fx = tf.x * safeWidth;\r\n          const fy = tf.y * safeHeight;\r\n          coords = [fx, fy, 0, centerX, centerY, radius];\r\n        } else {\r\n          coords = [centerX, centerY, 0, centerX, centerY, radius];\r\n        }\r\n      } else {\r\n        // No transform: convert ratio coords into local points (legacy behavior)\r\n        const centerX = cx * safeWidth;\r\n        const centerY = cy * safeHeight;\r\n        const radius = r * Math.max(safeWidth, safeHeight);\r\n\r\n        if (gradient.fx !== undefined && gradient.fy !== undefined) {\r\n          const fx = gradient.fx * safeWidth;\r\n          const fy = gradient.fy * safeHeight;\r\n          coords = [fx, fy, 0, centerX, centerY, radius];\r\n        } else {\r\n          coords = [centerX, centerY, 0, centerX, centerY, radius];\r\n        }\r\n      }\r\n    }\r\n\r\n    const interpolationFn = this.buildInterpolationFunction(stops);\r\n\r\n    const dictionary = [\r\n      \"<<\",\r\n      \"/ShadingType 3\",\r\n      \"/ColorSpace /DeviceRGB\",\r\n      `/Coords [${coords.map(formatNumber).join(\" \")}]`,\r\n      ...(matrixEntry ? [matrixEntry] : []),\r\n      \"/Domain [0 1]\",\r\n      `/Function ${interpolationFn}`,\r\n      \"/Extend [true true]\",\r\n      \">>\",\r\n    ].join(\"\\n\");\r\n\r\n    const shading: GradientShading = { shadingName, dictionary };\r\n    this.shadings.set(shadingName, shading);\r\n    return shading;\r\n  }\r\n\r\n  getShadings(): Map<string, string> {\r\n    const result = new Map<string, string>();\r\n    for (const { shadingName, dictionary } of this.shadings.values()) {\r\n      result.set(shadingName, dictionary);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  clear(): void {\r\n    this.shadings.clear();\r\n    this.shadingCounter = 0;\r\n  }\r\n\r\n  private generateShadingName(): string {\r\n    return `Sh${this.serviceId}_${this.shadingCounter++}`;\r\n  }\r\n\r\n  private calculateGradientCoordinates(\n    gradient: LinearGradient,\n    rect: { width: number; height: number },\n  ): [number, number, number, number] {\n    const widthPx = Math.max(rect.width, 0);\n    const heightPx = Math.max(rect.height, 0);\n    const safeWidth = widthPx > 0 ? widthPx : 1;\n    const safeHeight = heightPx > 0 ? heightPx : 1;\n    const centerX = safeWidth / 2;\n    const centerY = safeHeight / 2;\n\r\n    switch (gradient.direction) {\r\n      case \"to right\":\r\n        return [0, centerY, safeWidth, centerY];\r\n      case \"to left\":\r\n        return [safeWidth, centerY, 0, centerY];\r\n      case \"to bottom\":\r\n        return [centerX, 0, centerX, safeHeight];\r\n      case \"to top\":\r\n        return [centerX, safeHeight, centerX, 0];\r\n      case \"to top right\":\r\n        return [0, safeHeight, safeWidth, 0];\r\n      case \"to top left\":\r\n        return [safeWidth, safeHeight, 0, 0];\r\n      case \"to bottom right\":\r\n        return [0, 0, safeWidth, safeHeight];\r\n      case \"to bottom left\":\r\n        return [safeWidth, 0, 0, safeHeight];\r\n      default:\r\n        if (gradient.direction.endsWith(\"deg\")) {\r\n          const angle = Number.parseFloat(gradient.direction);\r\n          return this.calculateCoordinatesFromAngle(angle, safeWidth, safeHeight);\r\n        }\r\n        return [0, centerY, safeWidth, centerY];\r\n    }\r\n  }\r\n\r\n  private calculateCoordinatesFromAngle(\r\n    angleDeg: number,\r\n    widthPt: number,\r\n    heightPt: number,\r\n  ): [number, number, number, number] {\r\n    if (!Number.isFinite(angleDeg)) {\r\n      return [0, heightPt / 2, widthPt, heightPt / 2];\r\n    }\r\n    const normalized = ((angleDeg % 360) + 360) % 360;\r\n    const radians = (normalized * Math.PI) / 180;\r\n    // CSS linear-gradient angles measure 0deg pointing upward and increase clockwise.\r\n    // Convert to our Cartesian basis (+X right, +Y down) before mapping to PDF space.\r\n    const dirX = Math.sin(radians);\r\n    const dirY = -Math.cos(radians);\r\n\r\n    const halfWidth = widthPt / 2;\r\n    const halfHeight = heightPt / 2;\r\n    const extent = this.computeMaxExtent(dirX, dirY, halfWidth, halfHeight);\r\n\r\n    const startX = halfWidth - dirX * extent;\r\n    const startY = halfHeight - dirY * extent;\r\n    const endX = halfWidth + dirX * extent;\r\n    const endY = halfHeight + dirY * extent;\r\n    return [startX, startY, endX, endY];\r\n  }\r\n\r\n  private computeMaxExtent(dirX: number, dirY: number, halfWidth: number, halfHeight: number): number {\r\n    const epsilon = 1e-6;\r\n    const absX = Math.abs(dirX);\r\n    const absY = Math.abs(dirY);\r\n    if (absX <= epsilon && absY <= epsilon) {\r\n      return 0;\r\n    }\r\n    if (absX <= epsilon) {\r\n      return halfHeight / absY;\r\n    }\r\n    if (absY <= epsilon) {\r\n      return halfWidth / absX;\r\n    }\r\n    return Math.max(halfWidth / absX, halfHeight / absY);\r\n  }\r\n\r\n  private normalizeStops(stops: GradientStop[]): NormalizedStop[] {\r\n    if (stops.length === 0) {\r\n      return [{ color: this.parseColor(\"#000000\"), position: 0 }];\r\n    }\r\n\r\n    const enriched = stops.map((stop) => ({\r\n      color: this.parseColor(stop.color),\r\n      position: stop.position,\r\n    }));\r\n\r\n    const hasExplicit = enriched.some((stop) => stop.position !== undefined);\r\n\r\n    if (!hasExplicit) {\r\n      if (enriched.length === 1) {\r\n        return [{ color: enriched[0].color, position: 0 }];\r\n      }\r\n      const denom = enriched.length - 1;\r\n      return enriched.map((stop, index) => ({\r\n        color: stop.color,\r\n        position: denom === 0 ? 0 : index / denom,\r\n      }));\r\n    }\r\n\r\n    const positions: Array<number | undefined> = enriched.map((stop) => stop.position);\r\n    if (positions[0] === undefined) {\r\n      positions[0] = 0;\r\n    }\r\n    if (positions[positions.length - 1] === undefined) {\r\n      positions[positions.length - 1] = 1;\r\n    }\r\n\r\n    let lastDefinedIndex = 0;\r\n    positions[lastDefinedIndex] = clampUnit(positions[lastDefinedIndex] ?? 0);\r\n\r\n    for (let i = 1; i < positions.length; i++) {\r\n      const current = positions[i];\r\n      if (current === undefined) {\r\n        continue;\r\n      }\r\n      const start = positions[lastDefinedIndex] ?? 0;\r\n      const end = clampUnit(current);\r\n      const span = i - lastDefinedIndex;\r\n      if (span > 1) {\r\n        for (let j = 1; j < span; j++) {\r\n          const ratio = j / span;\r\n          const value = start + (end - start) * ratio;\r\n          positions[lastDefinedIndex + j] = clampUnit(value);\r\n        }\r\n      }\r\n      positions[i] = end;\r\n      lastDefinedIndex = i;\r\n    }\r\n\r\n    for (let i = 1; i < positions.length; i++) {\r\n      if (positions[i] === undefined) {\r\n        positions[i] = positions[i - 1];\r\n      }\r\n    }\r\n\r\n    const normalized: NormalizedStop[] = [];\r\n    let previous = clampUnit(positions[0] ?? 0);\r\n    normalized.push({ color: enriched[0].color, position: previous });\r\n    for (let i = 1; i < positions.length; i++) {\r\n      const current = clampUnit(positions[i] ?? previous);\r\n      const monotonic = current < previous ? previous : current;\r\n      normalized.push({ color: enriched[i].color, position: monotonic });\r\n      previous = monotonic;\r\n    }\r\n\r\n    if (normalized.length === 1) {\r\n      const [only] = normalized;\r\n      return [{ color: only.color, position: 0 }, { color: only.color, position: 1 }];\r\n    }\r\n\r\n    normalized[0].position = 0;\r\n    normalized[normalized.length - 1].position = 1;\r\n    return normalized;\r\n  }\r\n\r\n  private buildInterpolationFunction(stops: NormalizedStop[]): string {\r\n    if (stops.length <= 1) {\r\n      const color = stops.length === 1 ? stops[0].color : this.parseColor(\"#000000\");\r\n      return serializeType2Function(color, color);\r\n    }\r\n\r\n    const segments: Array<{ start: NormalizedStop; end: NormalizedStop }> = [];\r\n    for (let i = 0; i < stops.length - 1; i++) {\r\n      const start = stops[i];\r\n      const end = stops[i + 1];\r\n      if (end.position <= start.position) {\r\n        continue;\r\n      }\r\n      segments.push({ start, end });\r\n    }\r\n\r\n    if (segments.length === 0) {\r\n      const color = stops[stops.length - 1].color;\r\n      return serializeType2Function(color, color);\r\n    }\r\n\r\n    if (segments.length === 1) {\r\n      const [segment] = segments;\r\n      return serializeType2Function(segment.start.color, segment.end.color);\r\n    }\r\n\r\n    const bounds: string[] = [];\r\n    const encodeParts: string[] = [];\r\n    const functionParts: string[] = [];\r\n\r\n    for (let i = 0; i < segments.length; i++) {\r\n      const segment = segments[i];\r\n      if (i < segments.length - 1) {\r\n        bounds.push(formatNumber(segment.end.position));\r\n      }\r\n      encodeParts.push(\"0 1\");\r\n      functionParts.push(serializeType2Function(segment.start.color, segment.end.color));\r\n    }\r\n\r\n    const functionDict = [\r\n      \"<<\",\r\n      \"/FunctionType 3\",\r\n      \"/Domain [0 1]\",\r\n      `/Bounds [${bounds.join(\" \")}]`,\r\n      `/Encode [${encodeParts.join(\" \")}]`,\r\n      \"/Functions [\",\r\n      functionParts.join(\"\\n\"),\r\n      \"]\",\r\n      \">>\",\r\n    ].join(\"\\n\");\r\n\r\n    return functionDict;\r\n  }\r\n\r\n  private parseColor(colorStr: string): { r: number; g: number; b: number } {\r\n    const rgba = parseCssColor(colorStr);\r\n    return rgbaToUnitRgb(rgba);\r\n  }\r\n}\r\n\r\ninterface NormalizedStop {\r\n  color: { r: number; g: number; b: number };\r\n  position: number;\r\n}\r\n\r\nfunction rgbaToUnitRgb(color: RGBA | undefined): { r: number; g: number; b: number } {\r\n  if (!color) {\r\n    return { r: 1, g: 1, b: 1 };\r\n  }\r\n  const alpha = color.a ?? 1;\r\n  const r = normalizeChannel(color.r);\r\n  const g = normalizeChannel(color.g);\r\n  const b = normalizeChannel(color.b);\r\n  if (alpha >= 1) {\r\n    return { r, g, b };\r\n  }\r\n  return {\r\n    r: r * alpha + (1 - alpha),\r\n    g: g * alpha + (1 - alpha),\r\n    b: b * alpha + (1 - alpha),\r\n  };\r\n}\r\n\r\nfunction clampUnit(value: number | undefined): number {\r\n  if (!Number.isFinite(value ?? NaN)) {\r\n    return 0;\r\n  }\r\n  if ((value ?? 0) <= 0) {\r\n    return 0;\r\n  }\r\n  if ((value ?? 0) >= 1) {\r\n    return 1;\r\n  }\r\n  return value ?? 0;\r\n}\r\n\r\nfunction serializeType2Function(\r\n  start: { r: number; g: number; b: number },\r\n  end: { r: number; g: number; b: number },\r\n): string {\r\n  return [\r\n    \"<<\",\r\n    \"/FunctionType 2\",\r\n    \"/Domain [0 1]\",\r\n    `/C0 [ ${formatNumber(start.r)} ${formatNumber(start.g)} ${formatNumber(start.b)} ]`,\r\n    `/C1 [ ${formatNumber(end.r)} ${formatNumber(end.g)} ${formatNumber(end.b)} ]`,\r\n    \"/N 1\",\r\n    \">>\",\r\n  ].join(\"\\n\");\r\n}\r\n\r\nfunction normalizeChannel(value: number): number {\r\n  if (!Number.isFinite(value)) {\r\n    return 0;\r\n  }\r\n  if (value > 1) {\r\n    return Math.min(Math.max(value / 255, 0), 1);\r\n  }\r\n  if (value < 0) {\r\n    return 0;\r\n  }\r\n  return value;\r\n}\r\n\r\nfunction formatNumber(value: number): string {\r\n  if (!Number.isFinite(value)) {\r\n    return \"0\";\r\n  }\r\n  return Number.isInteger(value) ? value.toString() : value.toFixed(5).replace(/0+$/, \"\").replace(/\\.$/, \"\");\r\n}\r\n", "import type { RGBA, Rect, ShapePoint } from \"../types.js\";\r\nimport { CoordinateTransformer } from \"../utils/coordinate-transformer.js\";\nimport { parseLinearGradient, parseRadialGradient } from \"../../css/parsers/gradient-parser.js\";\n\r\nexport function strokeColorCommand(color: RGBA): string {\r\n  const r = formatNumber(normalizeChannel(color.r));\r\n  const g = formatNumber(normalizeChannel(color.g));\r\n  const b = formatNumber(normalizeChannel(color.b));\r\n  return `${r} ${g} ${b} RG`;\r\n}\r\n\r\nexport function fillColorCommand(color: RGBA): string {\r\n  const r = formatNumber(normalizeChannel(color.r));\r\n  const g = formatNumber(normalizeChannel(color.g));\r\n  const b = formatNumber(normalizeChannel(color.b));\r\n  // Alpha blending is handled through ExtGState assignments (see pushFillCommands).\r\n  return `${r} ${g} ${b} rg`;\r\n}\r\n\r\nexport function mapLineCap(cap: \"butt\" | \"round\" | \"square\" | undefined): number | undefined {\r\n  switch (cap) {\r\n    case \"butt\":\r\n      return 0;\r\n    case \"round\":\r\n      return 1;\r\n    case \"square\":\r\n      return 2;\r\n    default:\r\n      return undefined;\r\n  }\r\n}\r\n\r\nexport function mapLineJoin(join: \"miter\" | \"round\" | \"bevel\" | undefined): number | undefined {\r\n  switch (join) {\r\n    case \"miter\":\r\n      return 0;\r\n    case \"round\":\r\n      return 1;\r\n    case \"bevel\":\r\n      return 2;\r\n    default:\r\n      return undefined;\r\n  }\r\n}\r\n\r\nexport function normalizeChannel(value: number): number {\r\n  if (value > 1) {\r\n    return value / 255;\r\n  }\r\n  return value;\r\n}\r\n\r\nexport function formatNumber(value: number): string {\r\n  if (!Number.isFinite(value)) {\r\n    return \"0\";\r\n  }\r\n  return Number.isInteger(value) ? value.toString() : value.toFixed(4).replace(/0+$/, \"\").replace(/\\.$/, \"\");\r\n}\r\n\r\nexport function rectToPdf(\r\n  rect: Rect | null | undefined,\r\n  coordinateTransformer: CoordinateTransformer,\r\n  transformContext: Rect | null\r\n): { x: string; y: string; width: string; height: string } | null {\r\n  if (!rect) {\r\n    return null;\r\n  }\r\n  const widthPx = Math.max(rect.width, 0);\r\n  const heightPx = Math.max(rect.height, 0);\r\n  if (widthPx === 0 || heightPx === 0) {\r\n    return null;\r\n  }\r\n\r\n  // If in transform context, use relative coordinates\r\n  if (transformContext) {\r\n    const relX = rect.x - transformContext.x;\r\n    const relY = rect.y - transformContext.y;\r\n    const x = coordinateTransformer.convertPxToPt(relX);\r\n    const y = coordinateTransformer.convertPxToPt(-(relY + heightPx)); // Negative for PDF y-axis\r\n    const width = coordinateTransformer.convertPxToPt(widthPx);\r\n    const height = coordinateTransformer.convertPxToPt(heightPx);\r\n    return {\r\n      x: formatNumber(x),\r\n      y: formatNumber(y),\r\n      width: formatNumber(width),\r\n      height: formatNumber(height),\r\n    };\r\n  }\r\n\r\n  // Normal absolute positioning\r\n  const localY = rect.y - coordinateTransformer.pageOffsetPx;\r\n  const x = coordinateTransformer.convertPxToPt(rect.x);\r\n  const y = coordinateTransformer.pageHeightPt - coordinateTransformer.convertPxToPt(localY + heightPx);\r\n  const width = coordinateTransformer.convertPxToPt(widthPx);\r\n  const height = coordinateTransformer.convertPxToPt(heightPx);\r\n  return {\r\n    x: formatNumber(x),\r\n    y: formatNumber(y),\r\n    width: formatNumber(width),\r\n    height: formatNumber(height),\r\n  };\r\n}\r\n\r\nexport function pointToPdf(\r\n  point: ShapePoint,\r\n  coordinateTransformer: CoordinateTransformer,\r\n  transformContext: Rect | null\r\n): { x: string; y: string } | null {\r\n  // If in transform context, use relative coordinates\r\n  if (transformContext) {\r\n    const relX = point.x - transformContext.x;\r\n    const relY = point.y - transformContext.y;\r\n    const x = coordinateTransformer.convertPxToPt(relX);\r\n    const y = coordinateTransformer.convertPxToPt(-relY); // Negative for PDF y-axis\r\n    if (!Number.isFinite(x) || !Number.isFinite(y)) {\r\n      return null;\r\n    }\r\n    return {\r\n      x: formatNumber(x),\r\n      y: formatNumber(y),\r\n    };\r\n  }\r\n\r\n  // Normal absolute positioning\r\n  const localY = point.y - coordinateTransformer.pageOffsetPx;\r\n  const x = coordinateTransformer.convertPxToPt(point.x);\r\n  const y = coordinateTransformer.pageHeightPt - coordinateTransformer.convertPxToPt(localY);\r\n  if (!Number.isFinite(x) || !Number.isFinite(y)) {\r\n    return null;\r\n  }\r\n  return {\r\n    x: formatNumber(x),\r\n    y: formatNumber(y),\r\n  };\r\n}\r\n\r\nexport function pointsToPdf(\r\n  points: ShapePoint[],\r\n  coordinateTransformer: CoordinateTransformer,\r\n  transformContext: Rect | null\r\n): Array<{ x: string; y: string }> | null {\r\n  const result: Array<{ x: string; y: string }> = [];\r\n  for (const point of points) {\r\n    const converted = pointToPdf(point, coordinateTransformer, transformContext);\r\n    if (!converted) {\r\n      return null;\r\n    }\r\n    result.push(converted);\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function transformForRect(rect: Rect, coordinateTransformer: CoordinateTransformer, transformContext: Rect | null): string {\r\n  // If we're in a transform context, use relative coordinates\r\n  if (transformContext) {\r\n    const relX = rect.x - transformContext.x;\r\n    const relY = rect.y - transformContext.y;\r\n    const scaleX = coordinateTransformer.convertPxToPt(1);\r\n    const scaleY = coordinateTransformer.convertPxToPt(1);\r\n    const translateX = coordinateTransformer.convertPxToPt(relX);\r\n    const translateY = coordinateTransformer.convertPxToPt(-relY); // Negative because PDF y-axis is flipped\r\n    return `${formatNumber(scaleX)} 0 0 ${formatNumber(scaleY)} ${formatNumber(translateX)} ${formatNumber(translateY)} cm`;\r\n  }\r\n\r\n  // Normal absolute positioning\r\n  const scaleX = coordinateTransformer.convertPxToPt(1);\r\n  const scaleY = coordinateTransformer.convertPxToPt(1);\r\n  const localY = rect.y - coordinateTransformer.pageOffsetPx;\r\n  const translateX = coordinateTransformer.convertPxToPt(rect.x);\r\n  const translateY = coordinateTransformer.pageHeightPt - coordinateTransformer.convertPxToPt(localY);\r\n  return `${formatNumber(scaleX)} 0 0 ${formatNumber(-scaleY)} ${formatNumber(translateX)} ${formatNumber(translateY)} cm`;\r\n}\r\n\r\nexport function resolveGradientPaint(paint: unknown): import(\"../../css/parsers/gradient-parser.js\").LinearGradient | import(\"../../css/parsers/gradient-parser.js\").RadialGradient | null {\r\n  if (isLinearGradientPaint(paint) || isRadialGradientPaint(paint)) {\n    return paint as import(\"../../css/parsers/gradient-parser.js\").LinearGradient | import(\"../../css/parsers/gradient-parser.js\").RadialGradient;\n  }\n  if (typeof paint === \"string\") {\n    return parseLinearGradient(paint) ?? parseRadialGradient(paint);\n  }\n  return null;\n}\n\r\nfunction isLinearGradientPaint(value: unknown): value is import(\"../../css/parsers/gradient-parser.js\").LinearGradient {\r\n  if (typeof value !== \"object\" || value === null) return false;\r\n  const candidate = value as Partial<import(\"../../css/parsers/gradient-parser.js\").LinearGradient>;\r\n  return candidate.type === \"linear\" && Array.isArray((candidate as any).stops);\r\n}\r\n\r\nfunction isRadialGradientPaint(value: unknown): value is import(\"../../css/parsers/gradient-parser.js\").RadialGradient {\r\n  if (typeof value !== \"object\" || value === null) return false;\r\n  const candidate = value as Partial<import(\"../../css/parsers/gradient-parser.js\").RadialGradient>;\r\n  return candidate.type === \"radial\" && typeof (candidate as any).r === \"number\";\r\n}\r\n", "import type { Run, TextPaintOptions, Rect } from \"../types.js\";\nimport type { FontRegistry, FontResource } from \"../font/font-registry.js\";\nimport type { PdfObjectRef } from \"../primitives/pdf-document.js\";\nimport { log } from \"../../logging/debug.js\";\nimport { CoordinateTransformer } from \"../utils/coordinate-transformer.js\";\nimport type { ImageRenderer } from \"./image-renderer.js\";\nimport type { GraphicsStateManager } from \"./graphics-state-manager.js\";\nimport { fillColorCommand, formatNumber } from \"./text-renderer-utils.js\";\nimport { TextShadowRenderer } from \"./text-shadow-renderer.js\";\nimport { TextDecorationRenderer } from \"./text-decoration-renderer.js\";\nimport { TextFontResolver } from \"./text-font-resolver.js\";\nimport { encodeTextPayload } from \"./text-encoder.js\";\nimport { drawGlyphRun } from \"../utils/glyph-run-renderer.js\";\nimport { GradientService } from \"../shading/gradient-service.js\";\nimport type { LinearGradient, RadialGradient } from \"../../css/parsers/gradient-parser.js\";\nimport { transformForRect } from \"./shape-utils.js\";\nimport type { GlyphRun } from \"../../layout/text-run.js\";\nimport type { UnifiedFont } from \"../../fonts/types.js\";\n\nconst PINK = \"\\x1b[38;5;205m\";\nconst RESET_COLOR = \"\\x1b[0m\";\n\nexport interface TextRendererResult {\n  readonly commands: string[];\n  readonly fonts: Map<string, PdfObjectRef>;\n  readonly shadings: Map<string, string>;\n  readonly patterns: Map<string, string>;\n}\n\nexport class TextRenderer {\n  private readonly commands: string[] = [];\n  private readonly fonts = new Map<string, PdfObjectRef>();\n  private readonly decorationRenderer: TextDecorationRenderer;\n  private readonly shadowRenderer: TextShadowRenderer;\n  private readonly graphicsStateManager?: GraphicsStateManager;\n  private readonly fontResolver: TextFontResolver;\n  private readonly gradientService: GradientService;\n  private readonly patterns = new Map<string, string>();\n\n  constructor(\n    private readonly coordinateTransformer: CoordinateTransformer,\n    private readonly fontRegistry: FontRegistry,\n    imageRenderer?: ImageRenderer,\n    graphicsStateManager?: GraphicsStateManager,\n  ) {\n    this.graphicsStateManager = graphicsStateManager;\n    this.fontResolver = new TextFontResolver(fontRegistry);\n    this.shadowRenderer = new TextShadowRenderer(coordinateTransformer, fontRegistry, imageRenderer, graphicsStateManager);\n    this.decorationRenderer = new TextDecorationRenderer(coordinateTransformer, graphicsStateManager);\n    this.gradientService = new GradientService(coordinateTransformer);\n  }\n\n  async drawText(text: string, xPx: number, yPx: number, options: TextPaintOptions = { fontSizePt: 10 }): Promise<void> {\n    if (!text) {\n      return;\n    }\n\n    const fontFamily = options.fontFamily ?? \"Times New Roman\";\n    const fontWeight = options.fontWeight ?? 400;\n    const fontStyle = options.fontStyle ?? \"normal\";\n    const fontVariant = options.fontVariant;\n\n    // header/footer hoje passa tamanho em pt\n    const fontSizePx = this.coordinateTransformer.convertPtToPx(options.fontSizePt);\n\n    const run: Run = {\n      text,\n      fontFamily,\n      fontWeight,\n      fontStyle,\n      fontVariant,\n      fontSize: fontSizePx,\n      letterSpacing: 0,\n      wordSpacing: 0,\n      fill: options.color ?? { r: 0, g: 0, b: 0, a: 1 },\n      lineMatrix: {\n        a: 1, b: 0, c: 0, d: 1,\n        e: xPx,\n        f: yPx, // baseline em px, igual aos outros runs\n      },\n    };\n\n    await this.drawTextRun(run);\n  }\n\n  async drawTextRun(run: Run): Promise<void> {\n    const font = await this.fontResolver.ensureFontResource({\n      fontFamily: run.fontFamily,\n      fontWeight: run.fontWeight,\n      fontStyle: run.fontStyle,\n      fontVariant: run.fontVariant,\n      text: run.text\n    });\n\n    await this.drawTextRunWithGlyphs(run, font);\n  }\n\n  private async drawTextRunWithGlyphs(run: Run, font: FontResource): Promise<void> {\n    const color = run.fill ?? { r: 0, g: 0, b: 0, a: 1 };\n    const fontSizePt = this.coordinateTransformer.convertPxToPt(run.fontSize);\n\n    let glyphRun = run.glyphs;\n    if (!glyphRun && font.metrics) {\n      glyphRun = computeGlyphRunFromText(\n        font.metrics,\n        run.text,\n        run.fontSize,\n        run.letterSpacing ?? 0,\n        {\n          family: run.fontFamily,\n          weight: run.fontWeight ?? 400,\n          style: (run.fontStyle as \"normal\" | \"italic\") ?? \"normal\",\n        }\n      );\n    }\n\n    if (!glyphRun) {\n      log(\"paint\", \"warn\", \"Skipping run without glyph data\", {\n        text: run.text.slice(0, 32),\n        fontFamily: run.fontFamily,\n        fontSize: run.fontSize,\n      });\n      return;\n    }\n\n    log(\"paint\", \"debug\", `${PINK}USING GLYPH RUN${RESET_COLOR}`, {\n      text: run.text.slice(0, 64),\n      glyphCount: glyphRun.glyphIds.length,\n    });\n\n    const Tm = run.lineMatrix ?? { a: 1, b: 0, c: 0, d: 1, e: 0, f: 0 };\n    if (!run.lineMatrix) {\n      log(\"paint\", \"debug\", \"Run provided without lineMatrix, using identity fallback\", {\n        text: run.text.slice(0, 32),\n        fontFamily: run.fontFamily,\n      });\n    }\n    const localBaseline = Tm.f - this.coordinateTransformer.pageOffsetPx;\n    const y = this.coordinateTransformer.pageHeightPt - this.coordinateTransformer.convertPxToPt(localBaseline);\n    const x = this.coordinateTransformer.convertPxToPt(Tm.e);\n\n    log(\"paint\", \"debug\", \"drawing text run with glyphs\", {\n      text: run.text.slice(0, 32),\n      glyphIds: glyphRun.glyphIds.slice(0, 10),\n      fontSizePt,\n      x, y\n    });\n\n    // Normalize text for features like small-caps (match legacy behavior for shadows)\n    let normalizedText = run.text;\n    if (run.fontVariant === \"small-caps\") {\n      normalizedText = normalizedText.toUpperCase();\n    }\n\n    const { encoded } = encodeTextPayload(normalizedText, font);\n    const wordSpacingPx = run.wordSpacing ?? 0;\n    const wordSpacingPt = this.coordinateTransformer.convertPxToPt(wordSpacingPx);\n    const appliedWordSpacing = wordSpacingPx !== 0 && wordSpacingPt !== 0;\n\n    // Shadows use the base font resource (non-subset) for compatibility with Identity-H encoding\n    this.registerFont(font);\n    if (run.textShadows && run.textShadows.length > 0) {\n      const shadowCommands = await this.shadowRenderer.render({\n        run,\n        font,\n        encoded,\n        Tm,\n        fontSizePt,\n        fontSizePx: run.fontSize,\n        wordSpacingPt,\n        appliedWordSpacing,\n        fontResourceName: font.resourceName,\n      });\n      this.commands.push(...shadowCommands);\n    }\n\n    const subsetResource = this.fontRegistry.ensureSubsetForGlyphRun(glyphRun, font);\n    this.registerSubsetFont(subsetResource.alias, subsetResource.ref);\n\n    const gradientBackground = run.textGradient;\n    if (gradientBackground && gradientBackground.rect && gradientBackground.rect.width > 0 && gradientBackground.rect.height > 0) {\n      log(\"paint\", \"debug\", \"text run has background clip gradient\", {\n        text: run.text.slice(0, 32),\n        rect: gradientBackground.rect,\n      });\n      const gradientPaint = gradientBackground.gradient;\n      const isLinear = (gradientPaint as LinearGradient).type === \"linear\";\n      const isRadial = (gradientPaint as RadialGradient).type === \"radial\";\n      if (isLinear || isRadial) {\n        const pattern = this.gradientService.createPatternFromLinearGradient(\n          gradientPaint as LinearGradient,\n          {\n            width: gradientBackground.rect.width,\n            height: gradientBackground.rect.height,\n            x: gradientBackground.rect.x,\n            y: gradientBackground.rect.y,\n          },\n        );\n        this.patterns.set(pattern.patternName, pattern.dictionary);\n\n        const usePattern: string[] = [\n          \"q\",\n          `/Pattern cs`,\n          `/${pattern.patternName} scn`,\n        ];\n        const glyphPatternCommands = drawGlyphRun(\n          glyphRun,\n          subsetResource.subset,\n          x,\n          y,\n          fontSizePt,\n          color,\n          this.graphicsStateManager,\n          wordSpacingPt,\n          { skipColor: true },\n        );\n        if (glyphPatternCommands.length > 0) {\n          this.commands.push(...usePattern, ...glyphPatternCommands, \"Q\");\n          if (run.decorations) {\n            this.commands.push(...this.decorationRenderer.render(run, color));\n          }\n          return;\n        }\n      }\n    }\n\n    const glyphCommands = drawGlyphRun(\n      glyphRun,\n      subsetResource.subset,\n      x,\n      y,\n      fontSizePt,\n      color,\n      this.graphicsStateManager,\n      wordSpacingPt\n    );\n    this.commands.push(...glyphCommands);\n\n    if (run.decorations) {\n      this.commands.push(...this.decorationRenderer.render(run, color));\n    }\n  }\n\n  private registerFont(font: FontResource): void {\n    if (!this.fonts.has(font.resourceName)) {\n      this.fonts.set(font.resourceName, font.ref);\n    }\n  }\n\n  private registerSubsetFont(alias: string, ref: PdfObjectRef): void {\n    // Always update to the latest reference so refreshed subsets are used.\n    this.fonts.set(alias, ref);\n  }\n\n  private fillGradientRect(rect: Rect, gradient: LinearGradient | RadialGradient): string[] {\n    const width = Math.max(rect.width, 0);\n    const height = Math.max(rect.height, 0);\n    if (width <= 0 || height <= 0) {\n      return [];\n    }\n    const shading =\n      gradient.type === \"radial\"\n        ? this.gradientService.createRadialGradient(gradient as RadialGradient, rect)\n        : this.gradientService.createLinearGradient(gradient as LinearGradient, rect);\n\n    return [\n      \"q\",\n      transformForRect(rect, this.coordinateTransformer, null),\n      `0 0 ${formatNumber(width)} ${formatNumber(height)} re`,\n      \"W n\",\n      `/${shading.shadingName} sh`,\n      \"Q\",\n    ];\n  }\n\n  private fillPatternRect(rect: Rect): string[] {\n    const width = Math.max(rect.width, 0);\n    const height = Math.max(rect.height, 0);\n    if (width <= 0 || height <= 0) {\n      return [];\n    }\n    return [\n      transformForRect(rect, this.coordinateTransformer, null),\n      `0 0 ${formatNumber(width)} ${formatNumber(height)} re`,\n      \"f\",\n    ];\n  }\n\n  getResult(): TextRendererResult {\n    return {\n      commands: [...this.commands],\n      fonts: new Map(this.fonts),\n      shadings: this.gradientService.getShadings(),\n      patterns: new Map(this.patterns),\n    };\n  }\n}\n\nfunction computeGlyphRunFromText(\n  metrics: NonNullable<FontResource[\"metrics\"]>,\n  text: string,\n  fontSize: number,\n  letterSpacing: number,\n  css: { family?: string; weight: number; style: \"normal\" | \"italic\" },\n): GlyphRun {\n  const glyphIds: number[] = [];\n  const positions: { x: number; y: number }[] = [];\n  const unitsPerEm = metrics.metrics.unitsPerEm;\n  let x = 0;\n\n  for (let i = 0; i < text.length; i++) {\n    const cp = text.codePointAt(i)!;\n    const gid = metrics.cmap.getGlyphId(cp);\n    glyphIds.push(gid);\n    positions.push({ x, y: 0 });\n    const advanceWidth = metrics.glyphMetrics.get(gid)?.advanceWidth ?? 0;\n    const advancePx = (advanceWidth / unitsPerEm) * fontSize + letterSpacing;\n    x += advancePx;\n    if (cp > 0xffff) i++;\n  }\n\n  const unifiedFont: UnifiedFont = {\n    metrics: {\n      metrics: metrics.metrics,\n      glyphMetrics: metrics.glyphMetrics,\n      cmap: metrics.cmap,\n      headBBox: metrics.headBBox,\n    },\n    program: {\n      sourceFormat: \"ttf\",\n      unitsPerEm: metrics.metrics.unitsPerEm,\n      glyphCount: metrics.glyphMetrics.size,\n      getGlyphOutline: metrics.getGlyphOutline,\n    },\n    css: {\n      family: css.family ?? \"\",\n      weight: css.weight,\n      style: css.style,\n    },\n  };\n\n  return {\n    font: unifiedFont,\n    glyphIds,\n    positions,\n    text,\n    fontSize,\n    width: x,\n  };\n}\n", "import type { ImageRef, Rect } from \"../types.js\";\r\nimport type { PdfObjectRef } from \"../primitives/pdf-document.js\";\r\nimport { CoordinateTransformer } from \"../utils/coordinate-transformer.js\";\r\n\r\nexport interface ImageRendererResult {\r\n  readonly commands: string[];\r\n  readonly images: Map<string, { alias: string; image: ImageRef; ref?: PdfObjectRef }>;\r\n}\r\n\r\nexport class ImageRenderer {\r\n  private readonly commands: string[] = [];\r\n  private readonly imageResources = new Map<string, { alias: string; image: ImageRef; ref?: PdfObjectRef }>();\r\n\r\n  constructor(\r\n    private readonly coordinateTransformer: CoordinateTransformer,\r\n  ) {}\r\n\r\n  // Public helper to register an image resource and get its alias without emitting commands\r\n  registerResource(image: ImageRef): { alias: string; image: ImageRef; ref?: PdfObjectRef } {\r\n    return this.ensureImageResource(image);\r\n  }\r\n\r\n  // Register atlas pages so they can be referenced by pageIndex later.\r\n  registerAtlasPages(pages: Array<{ width: number; height: number; data: Uint8Array }>): void {\r\n    for (let i = 0; i < pages.length; i++) {\r\n      const page = pages[i];\r\n      const key = `atlas:${i}`;\r\n      if (this.imageResources.has(key)) continue;\r\n      const alias = `Im${this.imageResources.size}`;\r\n      const imageRef: ImageRef = {\r\n        src: `atlas:${i}`,\r\n        width: page.width,\r\n        height: page.height,\r\n        format: \"png\",\r\n        channels: 4,\r\n        bitsPerComponent: 8,\r\n        data: page.data.buffer as ArrayBuffer,\r\n      };\r\n      this.imageResources.set(key, { alias, image: imageRef });\r\n    }\r\n  }\r\n\r\n  // Draw a region (sub-rectangle) from a registered atlas page into the destination rect (px coords).\r\n  drawAtlasRegion(pageIndex: number, sx: number, sy: number, sw: number, sh: number, rect: Rect): void {\r\n    if (rect.width <= 0 || rect.height <= 0) return;\r\n    const key = `atlas:${pageIndex}`;\r\n    const res = this.imageResources.get(key);\r\n    if (!res) return;\r\n    // Compute destination in points\r\n    const widthPt = this.coordinateTransformer.convertPxToPt(rect.width);\r\n    const heightPt = this.coordinateTransformer.convertPxToPt(rect.height);\r\n    if (widthPt === 0 || heightPt === 0) return;\r\n    const xPt = this.coordinateTransformer.convertPxToPt(rect.x);\r\n    const localY = rect.y - this.coordinateTransformer.pageOffsetPx;\r\n    const yPt = this.coordinateTransformer.pageHeightPt - this.coordinateTransformer.convertPxToPt(localY + rect.height);\r\n\r\n    // Compute matrix that maps image pixel coordinates so that the sub-rect [sx,sy,sw,sh]\r\n    // maps to the destination rectangle. Matrix: [a 0 0 d tx ty] where\r\n    // a = widthPt / sw (pt per image-pixel), d = heightPt / sh, tx = xPt - a * sx, ty = yPt - d * sy\r\n    const a = widthPt / sw;\r\n    const d = heightPt / sh;\r\n    const tx = xPt - a * sx;\r\n    const ty = yPt - d * sy;\r\n\r\n    const cmds = [\r\n      \"q\",\r\n      `${formatNumber(a)} 0 0 ${formatNumber(d)} ${formatNumber(tx)} ${formatNumber(ty)} cm`,\r\n      `/${res.alias} Do`,\r\n      \"Q\",\r\n    ];\r\n    this.commands.push(...cmds);\r\n  }\r\n\r\n  drawImage(image: ImageRef, rect: Rect): void {\r\n    if (rect.width <= 0 || rect.height <= 0) {\r\n      return;\r\n    }\r\n    const resource = this.ensureImageResource(image);\r\n    const widthPt = this.coordinateTransformer.convertPxToPt(rect.width);\r\n    const heightPt = this.coordinateTransformer.convertPxToPt(rect.height);\r\n    if (widthPt === 0 || heightPt === 0) {\r\n      return;\r\n    }\r\n    const xPt = this.coordinateTransformer.convertPxToPt(rect.x);\r\n    const localY = rect.y - this.coordinateTransformer.pageOffsetPx;\r\n    const yPt = this.coordinateTransformer.pageHeightPt - this.coordinateTransformer.convertPxToPt(localY + rect.height);\r\n    this.commands.push(\r\n      \"q\",\r\n      `${formatNumber(widthPt)} 0 0 ${formatNumber(heightPt)} ${formatNumber(xPt)} ${formatNumber(yPt)} cm`,\r\n      `/${resource.alias} Do`,\r\n      \"Q\",\r\n    );\r\n  }\r\n\r\n private ensureImageResource(image: ImageRef): { alias: string; image: ImageRef; ref?: PdfObjectRef } {\r\n    const key = `${image.src}|${image.data.byteLength ?? 0}`;\r\n    let resource = this.imageResources.get(key);\r\n    if (!resource) {\r\n      const alias = `Im${this.imageResources.size}`;\r\n      // Note: We're storing a reference to the original image object, but for actual implementation\r\n      // we might need to handle the ArrayBuffer differently\r\n      resource = {\r\n        alias,\r\n        image: {\r\n          ...image,\r\n          data: image.data // This is actually an ArrayBuffer, not a Uint8Array\r\n        },\r\n      };\r\n      this.imageResources.set(key, resource);\r\n    }\r\n    return resource;\r\n  }\r\n\r\n  getResult(): ImageRendererResult {\r\n    return {\r\n      commands: [...this.commands],\r\n      images: new Map(this.imageResources),\r\n    };\r\n  }\r\n}\r\n\r\nfunction formatNumber(value: number): string {\r\n  if (!Number.isFinite(value)) {\r\n    return \"0\";\r\n  }\r\n  return Number.isInteger(value) ? value.toString() : value.toFixed(4).replace(/0+$/, \"\").replace(/\\.$/, \"\");\r\n}\r\n", "import type { Radius } from \"../types.js\";\r\n\r\n/**\r\n * Radius utility functions\r\n * Responsibility: Normalize and validate border radii for rectangles\r\n */\r\n\r\n/**\r\n * Normalize radii to ensure they fit within rectangle bounds\r\n * Scales down radii proportionally if they exceed available space\r\n */\r\nexport function normalizeRadiiForRect(width: number, height: number, radii: Radius): Radius {\r\n    const result: Radius = {\r\n        topLeft: { ...radii.topLeft },\r\n        topRight: { ...radii.topRight },\r\n        bottomRight: { ...radii.bottomRight },\r\n        bottomLeft: { ...radii.bottomLeft },\r\n    };\r\n\r\n    const safeWidth = Math.max(width, 0);\r\n    const safeHeight = Math.max(height, 0);\r\n\r\n    if (safeWidth <= 0) {\r\n        result.topLeft.x = 0;\r\n        result.topRight.x = 0;\r\n        result.bottomRight.x = 0;\r\n        result.bottomLeft.x = 0;\r\n    } else {\r\n        const topSum = result.topLeft.x + result.topRight.x;\r\n        if (topSum > safeWidth && topSum > 0) {\r\n            const scale = safeWidth / topSum;\r\n            result.topLeft.x *= scale;\r\n            result.topRight.x *= scale;\r\n        }\r\n        const bottomSum = result.bottomLeft.x + result.bottomRight.x;\r\n        if (bottomSum > safeWidth && bottomSum > 0) {\r\n            const scale = safeWidth / bottomSum;\r\n            result.bottomLeft.x *= scale;\r\n            result.bottomRight.x *= scale;\r\n        }\r\n    }\r\n\r\n    if (safeHeight <= 0) {\r\n        result.topLeft.y = 0;\r\n        result.topRight.y = 0;\r\n        result.bottomRight.y = 0;\r\n        result.bottomLeft.y = 0;\r\n    } else {\r\n        const leftSum = result.topLeft.y + result.bottomLeft.y;\r\n        if (leftSum > safeHeight && leftSum > 0) {\r\n            const scale = safeHeight / leftSum;\r\n            result.topLeft.y *= scale;\r\n            result.bottomLeft.y *= scale;\r\n        }\r\n        const rightSum = result.topRight.y + result.bottomRight.y;\r\n        if (rightSum > safeHeight && rightSum > 0) {\r\n            const scale = safeHeight / rightSum;\r\n            result.topRight.y *= scale;\r\n            result.bottomRight.y *= scale;\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\n/**\r\n * Check if all corner radii are zero\r\n */\r\nexport function isZeroRadius(radii: Radius): boolean {\r\n    return (\r\n        radii.topLeft.x === 0 &&\r\n        radii.topLeft.y === 0 &&\r\n        radii.topRight.x === 0 &&\r\n        radii.topRight.y === 0 &&\r\n        radii.bottomRight.x === 0 &&\r\n        radii.bottomRight.y === 0 &&\r\n        radii.bottomLeft.x === 0 &&\r\n        radii.bottomLeft.y === 0\r\n    );\r\n}\r\n", "import type { Radius } from \"../types.js\";\r\nimport { formatNumber } from \"./shape-utils.js\";\r\n\r\n/**\r\n * Rounded rectangle path generator\r\n * Responsibility: Generate PDF path commands for rounded rectangles\r\n */\r\n\r\n/**\r\n * Generate PDF path commands for a rounded rectangle\r\n * Uses B\u00E9zier curves to approximate rounded corners\r\n * \r\n * @param width - Rectangle width\r\n * @param height - Rectangle height  \r\n * @param radii - Corner radii (should be pre-normalized)\r\n * @param offsetX - X offset for path origin\r\n * @param offsetY - Y offset for path origin\r\n * @returns Array of PDF path command strings\r\n */\r\nexport function generateRoundedRectPath(\r\n    width: number,\r\n    height: number,\r\n    radii: Radius,\r\n    offsetX: number,\r\n    offsetY: number\r\n): string[] {\r\n    const commands: string[] = [];\r\n    if (width <= 0 || height <= 0) {\r\n        return commands;\r\n    }\r\n\r\n    const tl = radii.topLeft;\r\n    const tr = radii.topRight;\r\n    const br = radii.bottomRight;\r\n    const bl = radii.bottomLeft;\r\n\r\n    // B\u00E9zier approximation constant for circular arcs\r\n    const k = 0.5522847498307936;\r\n\r\n    // Start at top-left, after the corner radius\r\n    const moveX = offsetX + tl.x;\r\n    const moveY = offsetY;\r\n    commands.push(`${formatNumber(moveX)} ${formatNumber(moveY)} m`);\r\n\r\n    // Top edge\r\n    commands.push(`${formatNumber(offsetX + width - tr.x)} ${formatNumber(offsetY)} l`);\r\n\r\n    // Top-right corner\r\n    if (tr.x > 0 || tr.y > 0) {\r\n        const cp1x = offsetX + width - tr.x + k * tr.x;\r\n        const cp1y = offsetY;\r\n        const cp2x = offsetX + width;\r\n        const cp2y = offsetY + tr.y - k * tr.y;\r\n        const endX = offsetX + width;\r\n        const endY = offsetY + tr.y;\r\n        commands.push(\r\n            `${formatNumber(cp1x)} ${formatNumber(cp1y)} ${formatNumber(cp2x)} ${formatNumber(cp2y)} ${formatNumber(endX)} ${formatNumber(endY)} c`,\r\n        );\r\n    } else {\r\n        commands.push(`${formatNumber(offsetX + width)} ${formatNumber(offsetY)} l`);\r\n    }\r\n\r\n    // Right edge\r\n    commands.push(`${formatNumber(offsetX + width)} ${formatNumber(offsetY + height - br.y)} l`);\r\n\r\n    // Bottom-right corner\r\n    if (br.x > 0 || br.y > 0) {\r\n        const cp1x = offsetX + width;\r\n        const cp1y = offsetY + height - br.y + k * br.y;\r\n        const cp2x = offsetX + width - br.x + k * br.x;\r\n        const cp2y = offsetY + height;\r\n        const endX = offsetX + width - br.x;\r\n        const endY = offsetY + height;\r\n        commands.push(\r\n            `${formatNumber(cp1x)} ${formatNumber(cp1y)} ${formatNumber(cp2x)} ${formatNumber(cp2y)} ${formatNumber(endX)} ${formatNumber(endY)} c`,\r\n        );\r\n    } else {\r\n        commands.push(`${formatNumber(offsetX + width)} ${formatNumber(offsetY + height)} l`);\r\n    }\r\n\r\n    // Bottom edge\r\n    commands.push(`${formatNumber(offsetX + bl.x)} ${formatNumber(offsetY + height)} l`);\r\n\r\n    // Bottom-left corner\r\n    if (bl.x > 0 || bl.y > 0) {\r\n        const cp1x = offsetX + bl.x - k * bl.x;\r\n        const cp1y = offsetY + height;\r\n        const cp2x = offsetX;\r\n        const cp2y = offsetY + height - bl.y + k * bl.y;\r\n        const endX = offsetX;\r\n        const endY = offsetY + height - bl.y;\r\n        commands.push(\r\n            `${formatNumber(cp1x)} ${formatNumber(cp1y)} ${formatNumber(cp2x)} ${formatNumber(cp2y)} ${formatNumber(endX)} ${formatNumber(endY)} c`,\r\n        );\r\n    } else {\r\n        commands.push(`${formatNumber(offsetX)} ${formatNumber(offsetY + height)} l`);\r\n    }\r\n\r\n    // Left edge\r\n    commands.push(`${formatNumber(offsetX)} ${formatNumber(offsetY + tl.y)} l`);\r\n\r\n    // Top-left corner\r\n    if (tl.x > 0 || tl.y > 0) {\r\n        const cp1x = offsetX;\r\n        const cp1y = offsetY + tl.y - k * tl.y;\r\n        const cp2x = offsetX + tl.x - k * tl.x;\r\n        const cp2y = offsetY;\r\n        const endX = offsetX + tl.x;\r\n        const endY = offsetY;\r\n        commands.push(\r\n            `${formatNumber(cp1x)} ${formatNumber(cp1y)} ${formatNumber(cp2x)} ${formatNumber(cp2y)} ${formatNumber(endX)} ${formatNumber(endY)} c`,\r\n        );\r\n    } else {\r\n        commands.push(`${formatNumber(offsetX)} ${formatNumber(offsetY)} l`);\r\n    }\r\n\r\n    // Close path\r\n    commands.push(\"h\");\r\n    return commands;\r\n}\r\n", "import type { RGBA, Rect, Radius, StrokeDash, StrokeOptions } from \"../types.js\";\nimport { CoordinateTransformer } from \"../utils/coordinate-transformer.js\";\r\nimport { GradientService } from \"../shading/gradient-service.js\";\r\nimport { parseLinearGradient, type LinearGradient, type RadialGradient } from \"../../css/parsers/gradient-parser.js\";\r\nimport { fillColorCommand, formatNumber, mapLineCap, mapLineJoin, pointToPdf, rectToPdf, strokeColorCommand } from \"./shape-utils.js\";\r\nimport type { GraphicsStateManager } from \"./graphics-state-manager.js\";\r\nimport { normalizeRadiiForRect, isZeroRadius } from \"./radius-utils.js\";\r\nimport { generateRoundedRectPath } from \"./rounded-rect-path.js\";\r\n\r\nexport interface ShapePoint {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\nexport type PathCommand =\r\n  | { type: \"moveTo\"; x: number; y: number }\r\n  | { type: \"lineTo\"; x: number; y: number }\r\n  | { type: \"curveTo\"; x1: number; y1: number; x2: number; y2: number; x: number; y: number }\r\n  | { type: \"closePath\" };\r\n\r\nexport interface ShapeRendererResult {\r\n  readonly commands: string[];\r\n  readonly shadings: Map<string, string>;\r\n}\r\n\r\nexport class ShapeRenderer {\r\n  private readonly commands: string[] = [];\r\n  private readonly gradientService: GradientService;\r\n  private transformContext: Rect | null = null;\r\n\r\n  constructor(\r\n    private readonly coordinateTransformer: CoordinateTransformer,\r\n    private readonly graphicsStateManager: GraphicsStateManager,\r\n  ) {\r\n    this.gradientService = new GradientService(coordinateTransformer);\r\n  }\r\n\r\n  setTransformContext(rect: Rect): void {\r\n    this.transformContext = rect;\r\n  }\r\n\r\n  clearTransformContext(): void {\r\n    this.transformContext = null;\r\n  }\r\n\r\n  drawBoxOutline(rect: Rect, color: RGBA = { r: 0.85, g: 0.85, b: 0.85, a: 1 }): void {\r\n    this.strokeRect(rect, color);\r\n  }\r\n\r\n  drawFilledBox(rect: Rect, color: RGBA): void {\r\n    this.fillRect(rect, color);\r\n  }\r\n\r\n  fillRoundedRect(rect: Rect, radii: Radius, paint: RGBA | LinearGradient | RadialGradient | string): void {\r\n    // Note: RadialGradient support will be accepted via painter API too\r\n    const width = Math.max(rect.width, 0);\r\n    const height = Math.max(rect.height, 0);\r\n    if (width === 0 || height === 0) {\r\n      return;\r\n    }\r\n\r\n    const gradient = resolveGradientPaint(paint) as LinearGradient | RadialGradient | null;\r\n    if (gradient) {\r\n      if ((gradient as RadialGradient).type === \"radial\") {\r\n        this.fillRoundedRectWithRadialGradient(rect, radii, gradient as RadialGradient);\r\n      } else {\r\n        this.fillRoundedRectWithGradient(rect, radii, gradient as LinearGradient);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (typeof paint !== \"object\" || paint === null) {\r\n      return;\r\n    }\r\n\r\n    const adjusted = normalizeRadiiForRect(width, height, radii);\r\n    if (isZeroRadius(adjusted)) {\r\n      this.fillRect(rect, paint as RGBA);\r\n      return;\r\n    }\r\n    const path = generateRoundedRectPath(width, height, adjusted, 0, 0);\r\n    if (path.length === 0) {\r\n      return;\r\n    }\r\n    const commands = [this.transformForRect(rect), ...path, \"f\"];\r\n    this.pushFillCommands(paint as RGBA, commands, true);\r\n  }\r\n\r\n  // Allow low-level injection of drawing commands to preserve ordering (used for raster shadows)\r\n  pushRawCommands(commands: string[]): void {\r\n    if (!Array.isArray(commands) || commands.length === 0) return;\r\n    this.commands.push(...commands);\r\n  }\r\n\r\n  private fillRoundedRectWithGradient(rect: Rect, radii: Radius, gradient: LinearGradient): void {\r\n    const width = Math.max(rect.width, 0);\r\n    const height = Math.max(rect.height, 0);\r\n    if (width === 0 || height === 0) {\r\n      return;\r\n    }\r\n\r\n    const adjusted = normalizeRadiiForRect(width, height, radii);\r\n    if (isZeroRadius(adjusted)) {\r\n      this.fillRectWithGradient(rect, gradient);\r\n      return;\r\n    }\r\n\r\n    const path = generateRoundedRectPath(width, height, adjusted, 0, 0);\r\n    if (path.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const shading = this.gradientService.createLinearGradient(gradient, rect);\r\n    this.commands.push(\"q\");\r\n    this.commands.push(this.transformForRect(rect));\r\n    this.commands.push(...path);\r\n    this.commands.push(\"W n\");\r\n    this.commands.push(`/${shading.shadingName} sh`);\r\n    this.commands.push(\"Q\");\r\n  }\r\n\r\n  private fillRectWithGradient(rect: Rect, gradient: LinearGradient): void {\r\n    const width = Math.max(rect.width, 0);\r\n    const height = Math.max(rect.height, 0);\r\n    if (width === 0 || height === 0) {\r\n      return;\r\n    }\r\n\r\n    const shading = this.gradientService.createLinearGradient(gradient, rect);\r\n    this.commands.push(\"q\");\r\n    this.commands.push(this.transformForRect(rect));\r\n    this.commands.push(`0 0 ${formatNumber(width)} ${formatNumber(height)} re`);\r\n    this.commands.push(\"W n\");\r\n    this.commands.push(`/${shading.shadingName} sh`);\r\n    this.commands.push(\"Q\");\r\n  }\r\n\r\n  private fillRoundedRectWithRadialGradient(rect: Rect, radii: Radius, gradient: RadialGradient): void {\r\n    const width = Math.max(rect.width, 0);\r\n    const height = Math.max(rect.height, 0);\r\n    if (width === 0 || height === 0) {\r\n      return;\r\n    }\r\n\r\n    const adjusted = normalizeRadiiForRect(width, height, radii);\r\n    if (isZeroRadius(adjusted)) {\r\n      this.fillRectWithRadialGradient(rect, gradient);\r\n      return;\r\n    }\r\n\r\n    const path = generateRoundedRectPath(width, height, adjusted, 0, 0);\r\n    if (path.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const shading = this.gradientService.createRadialGradient(gradient, rect);\r\n    this.commands.push(\"q\");\r\n    this.commands.push(this.transformForRect(rect));\r\n    this.commands.push(...path);\r\n    this.commands.push(\"W n\");\r\n    this.commands.push(`/${shading.shadingName} sh`);\r\n    this.commands.push(\"Q\");\r\n  }\r\n\r\n  private fillRectWithRadialGradient(rect: Rect, gradient: RadialGradient): void {\r\n    const width = Math.max(rect.width, 0);\r\n    const height = Math.max(rect.height, 0);\r\n    if (width === 0 || height === 0) {\r\n      return;\r\n    }\r\n\r\n    const shading = this.gradientService.createRadialGradient(gradient, rect);\r\n    this.commands.push(\"q\");\r\n    this.commands.push(this.transformForRect(rect));\r\n    this.commands.push(`0 0 ${formatNumber(width)} ${formatNumber(height)} re`);\r\n    this.commands.push(\"W n\");\r\n    this.commands.push(`/${shading.shadingName} sh`);\r\n    this.commands.push(\"Q\");\r\n  }\r\n\r\n  fillRoundedRectDifference(outerRect: Rect, outerRadii: Radius, innerRect: Rect, innerRadii: Radius, color: RGBA): void {\r\n    const outerWidth = Math.max(outerRect.width, 0);\r\n    const outerHeight = Math.max(outerRect.height, 0);\r\n    if (outerWidth === 0 || outerHeight === 0) {\r\n      return;\r\n    }\r\n    const outerAdjusted = normalizeRadiiForRect(outerWidth, outerHeight, outerRadii);\r\n    const innerWidth = Math.max(innerRect.width, 0);\r\n    const innerHeight = Math.max(innerRect.height, 0);\r\n\r\n    if (innerWidth <= 0 || innerHeight <= 0) {\r\n      // Border fully covers the box; fall back to filling the outer shape.\r\n      this.fillRoundedRect(outerRect, outerAdjusted, color);\r\n      return;\r\n    }\r\n\r\n    const pathOuter = generateRoundedRectPath(outerWidth, outerHeight, outerAdjusted, 0, 0);\r\n    if (pathOuter.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const innerAdjusted = normalizeRadiiForRect(innerWidth, innerHeight, innerRadii);\r\n    const offsetX = innerRect.x - outerRect.x;\r\n    const offsetY = innerRect.y - outerRect.y;\r\n    const pathInner = generateRoundedRectPath(innerWidth, innerHeight, innerAdjusted, offsetX, offsetY);\r\n\r\n    const commands = [this.transformForRect(outerRect), ...pathOuter, ...pathInner, \"f*\"];\r\n    this.pushFillCommands(color, commands, true);\r\n  }\r\n\r\n  fillRect(rect: Rect, paint: RGBA | LinearGradient | RadialGradient | string): void {\r\n    const gradient = resolveGradientPaint(paint);\r\n    if (gradient) {\r\n      if ((gradient as RadialGradient).type === \"radial\") {\r\n        this.fillRectWithRadialGradient(rect, gradient as RadialGradient);\r\n      } else {\r\n        this.fillRectWithGradient(rect, gradient as LinearGradient);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (typeof paint !== \"object\" || paint === null) {\r\n      return;\r\n    }\r\n\r\n    const pdfRect = this.rectToPdf(rect);\r\n    if (!pdfRect) {\r\n      return;\r\n    }\r\n    const commands = [`${pdfRect.x} ${pdfRect.y} ${pdfRect.width} ${pdfRect.height} re`, \"f\"];\r\n    this.pushFillCommands(paint as RGBA, commands, false);\r\n  }\r\n\r\n  strokeRect(rect: Rect, color: RGBA): void {\r\n    const pdfRect = this.rectToPdf(rect);\r\n    if (!pdfRect) {\r\n      return;\r\n    }\r\n    this.commands.push(strokeColorCommand(color), `${pdfRect.x} ${pdfRect.y} ${pdfRect.width} ${pdfRect.height} re`, \"S\");\r\n  }\r\n\r\n  strokeRoundedRect(rect: Rect, radii: Radius, color: RGBA, lineWidth?: number): void {\r\n    const width = Math.max(rect.width, 0);\r\n    const height = Math.max(rect.height, 0);\r\n    if (width === 0 || height === 0) {\r\n      return;\r\n    }\r\n    const adjusted = normalizeRadiiForRect(width, height, radii);\r\n    const path = generateRoundedRectPath(width, height, adjusted, 0, 0);\r\n    if (path.length === 0) {\r\n      return;\r\n    }\r\n    this.commands.push(\"q\", strokeColorCommand(color));\r\n    if (lineWidth !== undefined) {\r\n      const strokeWidthPt = this.coordinateTransformer.convertPxToPt(Math.max(lineWidth, 0));\r\n      if (strokeWidthPt > 0) {\r\n        this.commands.push(`${formatNumber(strokeWidthPt)} w`);\r\n      }\r\n    }\r\n    this.commands.push(this.transformForRect(rect), ...path, \"S\", \"Q\");\r\n  }\r\n\r\n  fillPolygon(points: ShapePoint[], color: RGBA, close: boolean = true): void {\r\n    if (points.length < 2) {\r\n      return;\r\n    }\r\n    const pdfPoints = this.pointsToPdf(points);\r\n    if (!pdfPoints) {\r\n      return;\r\n    }\r\n    const commands: string[] = [];\r\n    commands.push(`${pdfPoints[0].x} ${pdfPoints[0].y} m`);\r\n    for (let index = 1; index < pdfPoints.length; index++) {\r\n      const point = pdfPoints[index];\r\n      commands.push(`${point.x} ${point.y} l`);\r\n    }\r\n    if (close) {\r\n      commands.push(\"h\");\r\n    }\r\n    commands.push(\"f\");\r\n    this.pushFillCommands(color, commands, true);\r\n  }\r\n\r\n  strokePolyline(points: ShapePoint[], color: RGBA, options: StrokeOptions & { close?: boolean } = {}): void {\n    if (points.length < 2) {\r\n      return;\r\n    }\r\n    const pdfPoints = this.pointsToPdf(points);\r\n    if (!pdfPoints) {\r\n      return;\r\n    }\r\n    const commands: string[] = [];\r\n    commands.push(`${pdfPoints[0].x} ${pdfPoints[0].y} m`);\r\n    for (let index = 1; index < pdfPoints.length; index++) {\r\n      const point = pdfPoints[index];\r\n      commands.push(`${point.x} ${point.y} l`);\r\n    }\r\n    if (options.close) {\r\n      commands.push(\"h\");\r\n    }\r\n    commands.push(\"S\");\r\n    this.commands.push(\"q\", strokeColorCommand(color));\n    this.applyStrokeOptions(options);\n    this.commands.push(...commands, \"Q\");\n  }\n\r\n  fillPath(commands: PathCommand[], color: RGBA, options: { fillRule?: \"nonzero\" | \"evenodd\" } = {}): void {\n    if (commands.length === 0) {\n      return;\n    }\n    const pdfCommands = this.pathCommandsToPdf(commands);\n    if (!pdfCommands || pdfCommands.length === 0) {\r\n      return;\r\n    }\r\n    const operator = options.fillRule === \"evenodd\" ? \"f*\" : \"f\";\r\n    this.pushFillCommands(color, [...pdfCommands, operator], false);\n  }\n\n  beginClipPath(commands: PathCommand[], options: { fillRule?: \"nonzero\" | \"evenodd\" } = {}): boolean {\n    if (!commands || commands.length === 0) {\n      return false;\n    }\n    const pdfCommands = this.pathCommandsToPdf(commands);\n    if (!pdfCommands || pdfCommands.length === 0) {\n      return false;\n    }\n    const clipOp = options.fillRule === \"evenodd\" ? \"W*\" : \"W\";\n    this.commands.push(\"q\", ...pdfCommands, `${clipOp} n`);\n    return true;\n  }\n\n  endClipPath(): void {\n    this.commands.push(\"Q\");\n  }\n\n  // New: fill an arbitrary path with a gradient. We compute a bounding box of the path\n  // (in page pixels) and use it as the gradient rectangle when creating the shading.\n  // The path itself is converted to PDF commands and used as the clipping path before\n  // painting the shading.\n  fillPathWithGradient(commands: PathCommand[], gradient: LinearGradient | RadialGradient, _options: { fillRule?: \"nonzero\" | \"evenodd\" } = {}): void {\n    if (!commands || commands.length === 0) return;\r\n    const pdfCommands = this.pathCommandsToPdf(commands);\r\n    if (!pdfCommands || pdfCommands.length === 0) return;\r\n\r\n    // Compute bounding box in page pixels from PathCommand (these are given in page px)\r\n    let minX = Number.POSITIVE_INFINITY;\r\n    let minY = Number.POSITIVE_INFINITY;\r\n    let maxX = Number.NEGATIVE_INFINITY;\r\n    let maxY = Number.NEGATIVE_INFINITY;\r\n    for (const cmd of commands) {\r\n      if (cmd.type === \"moveTo\" || cmd.type === \"lineTo\") {\r\n        minX = Math.min(minX, cmd.x);\r\n        minY = Math.min(minY, cmd.y);\r\n        maxX = Math.max(maxX, cmd.x);\r\n        maxY = Math.max(maxY, cmd.y);\r\n      } else if (cmd.type === \"curveTo\") {\r\n        minX = Math.min(minX, cmd.x1, cmd.x2, cmd.x);\r\n        minY = Math.min(minY, cmd.y1, cmd.y2, cmd.y);\r\n        maxX = Math.max(maxX, cmd.x1, cmd.x2, cmd.x);\r\n        maxY = Math.max(maxY, cmd.y1, cmd.y2, cmd.y);\r\n      }\r\n    }\r\n    if (!Number.isFinite(minX) || !Number.isFinite(minY) || !Number.isFinite(maxX) || !Number.isFinite(maxY)) {\r\n      return;\r\n    }\r\n    const rect = { x: minX, y: minY, width: Math.max(0, maxX - minX), height: Math.max(0, maxY - minY) };\r\n\r\n    // Create shading\r\n    const shading = (gradient as RadialGradient).type === \"radial\"\r\n      ? this.gradientService.createRadialGradient(gradient as RadialGradient, rect)\r\n      : this.gradientService.createLinearGradient(gradient as LinearGradient, rect);\r\n\r\n    // Emit clipping path then shading\r\n    this.commands.push(\"q\");\r\n    this.commands.push(...pdfCommands);\r\n    // Use W n to set clipping path (nonzero/even-odd determined by the fill operator we use)\r\n    this.commands.push(\"W n\");\r\n    this.commands.push(`/${shading.shadingName} sh`);\r\n    this.commands.push(\"Q\");\r\n  }\r\n\r\n  strokePath(commands: PathCommand[], color: RGBA, options: StrokeOptions = {}): void {\n    if (commands.length === 0) {\r\n      return;\r\n    }\r\n    const pdfCommands = this.pathCommandsToPdf(commands);\r\n    if (!pdfCommands || pdfCommands.length === 0) {\r\n      return;\r\n    }\r\n    this.commands.push(\"q\", strokeColorCommand(color));\n    this.applyStrokeOptions(options);\n    this.commands.push(...pdfCommands, \"S\");\n\n    if (options.dash && Array.isArray(options.dash.pattern) && options.dash.pattern.length > 0) {\n      this.commands.push(\"[] 0 d\");\n    }\n\n    this.commands.push(\"Q\");\n  }\n\n  private applyStrokeOptions(options: StrokeOptions): void {\n    if (options.lineWidth !== undefined) {\n      const widthPt = this.coordinateTransformer.convertPxToPt(Math.max(options.lineWidth, 0));\n      if (widthPt > 0) {\n        this.commands.push(`${formatNumber(widthPt)} w`);\n      }\n    }\n    const cap = mapLineCap(options.lineCap);\n    if (cap !== undefined) {\n      this.commands.push(`${cap} J`);\n    }\n    const join = mapLineJoin(options.lineJoin);\n    if (join !== undefined) {\n      this.commands.push(`${join} j`);\n    }\n    const dash = options.dash;\n    if (dash && Array.isArray(dash.pattern) && dash.pattern.length > 0) {\n      const patternPt = dash.pattern\n        .map((v) => this.coordinateTransformer.convertPxToPt(Math.max(v, 0)))\n        .map(formatNumber);\n      const phasePt = formatNumber(\n        this.coordinateTransformer.convertPxToPt(Math.max(dash.phase ?? 0, 0)),\n      );\n      this.commands.push(`[${patternPt.join(\" \")}] ${phasePt} d`);\n    }\n  }\n\r\n  private pushFillCommands(color: RGBA, commands: string[], wrapWithQ: boolean): void {\r\n    const alpha = color.a ?? 1;\r\n    const hasAlpha = alpha < 1;\r\n    const baseColor: RGBA = { r: color.r, g: color.g, b: color.b, a: alpha };\r\n    const needsIsolation = wrapWithQ || hasAlpha;\r\n    this.commands.push(fillColorCommand(baseColor));\r\n    if (needsIsolation) {\r\n      this.commands.push(\"q\");\r\n    }\r\n    if (hasAlpha) {\r\n      const state = this.graphicsStateManager.ensureFillAlphaState(alpha);\r\n      this.commands.push(`/${state} gs`);\r\n    }\r\n    this.commands.push(...commands);\r\n    if (needsIsolation) {\r\n      this.commands.push(\"Q\");\r\n    }\r\n  }\r\n\r\n  // normalizeRadiiForRect and isZeroRadius now imported from radius-utils.ts\r\n\r\n  private pathCommandsToPdf(commands: PathCommand[]): string[] | null {\r\n    const result: string[] = [];\r\n    for (const command of commands) {\r\n      switch (command.type) {\r\n        case \"moveTo\": {\r\n          const point = this.pointToPdf({ x: command.x, y: command.y });\r\n          if (!point) {\r\n            return null;\r\n          }\r\n          result.push(`${point.x} ${point.y} m`);\r\n          break;\r\n        }\r\n        case \"lineTo\": {\r\n          const point = this.pointToPdf({ x: command.x, y: command.y });\r\n          if (!point) {\r\n            return null;\r\n          }\r\n          result.push(`${point.x} ${point.y} l`);\r\n          break;\r\n        }\r\n        case \"curveTo\": {\r\n          const cp1 = this.pointToPdf({ x: command.x1, y: command.y1 });\r\n          const cp2 = this.pointToPdf({ x: command.x2, y: command.y2 });\r\n          const end = this.pointToPdf({ x: command.x, y: command.y });\r\n          if (!cp1 || !cp2 || !end) {\r\n            return null;\r\n          }\r\n          result.push(`${cp1.x} ${cp1.y} ${cp2.x} ${cp2.y} ${end.x} ${end.y} c`);\r\n          break;\r\n        }\r\n        case \"closePath\":\r\n          result.push(\"h\");\r\n          break;\r\n        default:\r\n          return null;\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  // isZeroRadius now imported from radius-utils.ts\r\n\r\n  // generateRoundedRectPath now imported from rounded-rect-path.ts\r\n\r\n  private transformForRect(rect: Rect): string {\r\n    // If we're in a transform context, use relative coordinates\r\n    if (this.transformContext) {\r\n      const relX = rect.x - this.transformContext.x;\r\n      const relY = rect.y - this.transformContext.y;\r\n      const scaleX = this.coordinateTransformer.convertPxToPt(1);\r\n      const scaleY = this.coordinateTransformer.convertPxToPt(1);\r\n      const translateX = this.coordinateTransformer.convertPxToPt(relX);\r\n      const translateY = this.coordinateTransformer.convertPxToPt(-relY); // Negative because PDF y-axis is flipped\r\n      return `${formatNumber(scaleX)} 0 0 ${formatNumber(scaleY)} ${formatNumber(translateX)} ${formatNumber(translateY)} cm`;\r\n    }\r\n\r\n    // Normal absolute positioning\r\n    const scaleX = this.coordinateTransformer.convertPxToPt(1);\r\n    const scaleY = this.coordinateTransformer.convertPxToPt(1);\r\n    const localY = rect.y - this.coordinateTransformer.pageOffsetPx;\r\n    const translateX = this.coordinateTransformer.convertPxToPt(rect.x);\r\n    const translateY = this.coordinateTransformer.pageHeightPt - this.coordinateTransformer.convertPxToPt(localY);\r\n    return `${formatNumber(scaleX)} 0 0 ${formatNumber(-scaleY)} ${formatNumber(translateX)} ${formatNumber(translateY)} cm`;\r\n  }\r\n\r\n  private rectToPdf(rect: Rect | null | undefined): { x: string; y: string; width: string; height: string } | null {\r\n    return rectToPdf(rect, this.coordinateTransformer, this.transformContext);\r\n  }\r\n\r\n  private pointToPdf(point: ShapePoint): { x: string; y: string } | null {\r\n    return pointToPdf(point, this.coordinateTransformer, this.transformContext);\r\n  }\r\n\r\n  private pointsToPdf(points: ShapePoint[]): Array<{ x: string; y: string }> | null {\r\n    const result: Array<{ x: string; y: string }> = [];\r\n    for (const point of points) {\r\n      const converted = this.pointToPdf(point);\r\n      if (!converted) {\r\n        return null;\r\n      }\r\n      result.push(converted);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  getResult(): ShapeRendererResult {\r\n    return {\r\n      commands: [...this.commands],\r\n      shadings: this.gradientService.getShadings(),\r\n    };\r\n  }\r\n}\r\n\r\nfunction resolveGradientPaint(paint: unknown): LinearGradient | RadialGradient | null {\r\n  if (isLinearGradientPaint(paint) || isRadialGradientPaint(paint)) {\r\n    return paint as LinearGradient | RadialGradient;\r\n  }\r\n  if (typeof paint === \"string\") {\r\n    return parseLinearGradient(paint);\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction isLinearGradientPaint(value: unknown): value is LinearGradient {\r\n  if (typeof value !== \"object\" || value === null) return false;\r\n  const candidate = value as Partial<LinearGradient>;\r\n  return candidate.type === \"linear\" && Array.isArray((candidate as any).stops);\r\n}\r\n\r\nfunction isRadialGradientPaint(value: unknown): value is RadialGradient {\r\n  if (typeof value !== \"object\" || value === null) return false;\r\n  const candidate = value as Partial<RadialGradient>;\r\n  return candidate.type === \"radial\" && typeof (candidate as any).r === \"number\";\r\n}\r\n\r\n", "\r\n\r\nexport class GraphicsStateManager {\r\n  private readonly fillAlphaStates = new Map<string, string>();\r\n  private readonly graphicsStates = new Map<string, number>();\r\n\r\n  ensureFillAlphaState(alpha: number): string {\r\n    const normalized = this.normalizeAlpha(alpha);\r\n    const key = normalized.toFixed(4);\r\n    const existing = this.fillAlphaStates.get(key);\r\n    if (existing) {\r\n      return existing;\r\n    }\r\n    const name = `GS${this.fillAlphaStates.size}`;\r\n    const numeric = Number.parseFloat(key);\r\n    this.fillAlphaStates.set(key, name);\r\n    this.graphicsStates.set(name, numeric);\r\n    return name;\r\n }\r\n\r\n  getGraphicsStates(): Map<string, number> {\r\n    return new Map(this.graphicsStates);\r\n  }\r\n\r\n  private normalizeAlpha(alpha: number | undefined): number {\r\n    if (!Number.isFinite(alpha ?? NaN)) {\r\n      return 1;\r\n    }\r\n    if (alpha === undefined) {\r\n      return 1;\r\n    }\r\n    if (alpha <= 0) {\r\n      return 0;\r\n    }\r\n    if (alpha >= 1) {\r\n      return 1;\r\n    }\r\n    return alpha;\r\n  }\r\n}\r\n", "import type { Rect, Radius } from \"../types.js\";\r\nimport { CoordinateTransformer } from \"./coordinate-transformer.js\";\r\n\r\nexport class ClippingPathBuilder {\r\n  constructor(private readonly coordinateTransformer: CoordinateTransformer) {}\r\n\r\n  buildClipCommands(rect: Rect, radius: Radius): string[] | null {\r\n    if (!rect) {\r\n      return null;\r\n    }\r\n    const width = Math.max(rect.width, 0);\r\n    const height = Math.max(rect.height, 0);\r\n    if (width === 0 || height === 0) {\r\n      return null;\r\n    }\r\n    if (this.isZeroRadius(radius)) {\r\n      const pdfRect = this.rectToPdf(rect);\r\n      if (!pdfRect) {\r\n        return null;\r\n      }\r\n      return [`${pdfRect.x} ${pdfRect.y} ${pdfRect.width} ${pdfRect.height} re`];\r\n    }\r\n    return this.buildRoundedClipCommands(rect, radius);\r\n  }\r\n\r\n  private buildRoundedClipCommands(rect: Rect, radius: Radius): string[] | null {\r\n    const width = Math.max(rect.width, 0);\r\n    const height = Math.max(rect.height, 0);\r\n    if (width === 0 || height === 0) {\r\n      return null;\r\n    }\r\n    const tl = radius.topLeft;\r\n    const tr = radius.topRight;\r\n    const br = radius.bottomRight;\r\n    const bl = radius.bottomLeft;\r\n    const k = 0.5522847498307936;\r\n    const commands: string[] = [];\r\n\r\n    const move = this.pointToPdf(rect.x + tl.x, rect.y);\r\n    const lineTop = this.pointToPdf(rect.x + width - tr.x, rect.y);\r\n    if (!move || !lineTop) {\r\n      return null;\r\n    }\r\n    commands.push(`${move.x} ${move.y} m`);\r\n    commands.push(`${lineTop.x} ${lineTop.y} l`);\r\n\r\n    if (tr.x > 0 || tr.y > 0) {\r\n      const cp1 = this.pointToPdf(rect.x + width - tr.x + k * tr.x, rect.y);\r\n      const cp2 = this.pointToPdf(rect.x + width, rect.y + tr.y - k * tr.y);\r\n      const end = this.pointToPdf(rect.x + width, rect.y + tr.y);\r\n      if (!cp1 || !cp2 || !end) {\r\n        return null;\r\n      }\r\n      commands.push(`${cp1.x} ${cp1.y} ${cp2.x} ${cp2.y} ${end.x} ${end.y} c`);\r\n    } else {\r\n      const corner = this.pointToPdf(rect.x + width, rect.y);\r\n      if (!corner) {\r\n        return null;\r\n      }\r\n      commands.push(`${corner.x} ${corner.y} l`);\r\n    }\r\n\r\n    const rightLine = this.pointToPdf(rect.x + width, rect.y + height - br.y);\r\n    if (!rightLine) {\r\n      return null;\r\n    }\r\n    commands.push(`${rightLine.x} ${rightLine.y} l`);\r\n\r\n    if (br.x > 0 || br.y > 0) {\r\n      const cp1 = this.pointToPdf(rect.x + width, rect.y + height - br.y + k * br.y);\r\n      const cp2 = this.pointToPdf(rect.x + width - br.x + k * br.x, rect.y + height);\r\n      const end = this.pointToPdf(rect.x + width - br.x, rect.y + height);\r\n      if (!cp1 || !cp2 || !end) {\r\n        return null;\r\n      }\r\n      commands.push(`${cp1.x} ${cp1.y} ${cp2.x} ${cp2.y} ${end.x} ${end.y} c`);\r\n    } else {\r\n      const corner = this.pointToPdf(rect.x + width, rect.y + height);\r\n      if (!corner) {\r\n        return null;\r\n      }\r\n      commands.push(`${corner.x} ${corner.y} l`);\r\n    }\r\n\r\n    const bottomLine = this.pointToPdf(rect.x + bl.x, rect.y + height);\r\n    if (!bottomLine) {\r\n      return null;\r\n    }\r\n    commands.push(`${bottomLine.x} ${bottomLine.y} l`);\r\n\r\n    if (bl.x > 0 || bl.y > 0) {\r\n      const cp1 = this.pointToPdf(rect.x + bl.x - k * bl.x, rect.y + height);\r\n      const cp2 = this.pointToPdf(rect.x, rect.y + height - bl.y + k * bl.y);\r\n      const end = this.pointToPdf(rect.x, rect.y + height - bl.y);\r\n      if (!cp1 || !cp2 || !end) {\r\n        return null;\r\n      }\r\n      commands.push(`${cp1.x} ${cp1.y} ${cp2.x} ${cp2.y} ${end.x} ${end.y} c`);\r\n    } else {\r\n      const corner = this.pointToPdf(rect.x, rect.y + height);\r\n      if (!corner) {\r\n        return null;\r\n      }\r\n      commands.push(`${corner.x} ${corner.y} l`);\r\n    }\r\n\r\n    const leftLine = this.pointToPdf(rect.x, rect.y + tl.y);\r\n    if (!leftLine) {\r\n      return null;\r\n    }\r\n    commands.push(`${leftLine.x} ${leftLine.y} l`);\r\n\r\n    if (tl.x > 0 || tl.y > 0) {\r\n      const cp1 = this.pointToPdf(rect.x, rect.y + tl.y - k * tl.y);\r\n      const cp2 = this.pointToPdf(rect.x + tl.x - k * tl.x, rect.y);\r\n      const end = this.pointToPdf(rect.x + tl.x, rect.y);\r\n      if (!cp1 || !cp2 || !end) {\r\n        return null;\r\n      }\r\n      commands.push(`${cp1.x} ${cp1.y} ${cp2.x} ${cp2.y} ${end.x} ${end.y} c`);\r\n    } else {\r\n      const corner = this.pointToPdf(rect.x, rect.y);\r\n      if (!corner) {\r\n        return null;\r\n      }\r\n      commands.push(`${corner.x} ${corner.y} l`);\r\n    }\r\n\r\n    commands.push(\"h\");\r\n    return commands;\r\n  }\r\n\r\n  private rectToPdf(rect: Rect): { x: string; y: string; width: string; height: string } | null {\r\n    if (!rect) {\r\n      return null;\r\n    }\r\n    const widthPt = this.coordinateTransformer.convertPxToPt(Math.max(rect.width, 0));\r\n    const heightPt = this.coordinateTransformer.convertPxToPt(Math.max(rect.height, 0));\r\n    if (!Number.isFinite(widthPt) || !Number.isFinite(heightPt) || widthPt === 0 || heightPt === 0) {\r\n      return null;\r\n    }\r\n    const origin = this.pointToPdf(rect.x, rect.y + rect.height);\r\n    if (!origin) {\r\n      return null;\r\n    }\r\n    return {\r\n      x: origin.x,\r\n      y: origin.y,\r\n      width: formatNumber(widthPt),\r\n      height: formatNumber(heightPt),\r\n    };\r\n  }\r\n\r\n  private pointToPdf(xPx: number, yPx: number): { x: string; y: string } | null {\r\n    if (!Number.isFinite(xPx) || !Number.isFinite(yPx)) {\r\n      return null;\r\n    }\r\n    const xPt = this.coordinateTransformer.convertPxToPt(xPx);\r\n    const localY = yPx - this.coordinateTransformer.pageOffsetPx;\r\n    const yPt = this.coordinateTransformer.pageHeightPt - this.coordinateTransformer.convertPxToPt(localY);\r\n    if (!Number.isFinite(xPt) || !Number.isFinite(yPt)) {\r\n      return null;\r\n    }\r\n    return {\r\n      x: formatNumber(xPt),\r\n      y: formatNumber(yPt),\r\n    };\r\n  }\r\n\r\n  private isZeroRadius(radius: Radius): boolean {\r\n    const epsilon = 1e-6;\r\n    return (\r\n      Math.abs(radius.topLeft.x) <= epsilon &&\r\n      Math.abs(radius.topLeft.y) <= epsilon &&\r\n      Math.abs(radius.topRight.x) <= epsilon &&\r\n      Math.abs(radius.topRight.y) <= epsilon &&\r\n      Math.abs(radius.bottomRight.x) <= epsilon &&\r\n      Math.abs(radius.bottomRight.y) <= epsilon &&\r\n      Math.abs(radius.bottomLeft.x) <= epsilon &&\r\n      Math.abs(radius.bottomLeft.y) <= epsilon\r\n    );\r\n  }\r\n}\r\n\r\nfunction formatNumber(value: number): string {\r\n  if (!Number.isFinite(value)) {\r\n    return \"0\";\r\n  }\r\n  return Number.isInteger(value) ? value.toString() : value.toFixed(4).replace(/0+$/, \"\").replace(/\\.$/, \"\");\r\n}\r\n", "import type { Rect } from \"../types.js\";\r\nimport { CoordinateTransformer } from \"./coordinate-transformer.js\";\r\n\r\nexport class ImageMatrixBuilder {\r\n  constructor(private readonly coordinateTransformer: CoordinateTransformer) {}\r\n\r\n  buildImageMatrix(rect: Rect): string | null {\r\n    if (!rect || rect.width <= 0 || rect.height <= 0) {\r\n      return null;\r\n    }\r\n    const widthPt = this.coordinateTransformer.convertPxToPt(rect.width);\r\n    const heightPt = this.coordinateTransformer.convertPxToPt(rect.height);\r\n    if (!Number.isFinite(widthPt) || !Number.isFinite(heightPt) || widthPt === 0 || heightPt === 0) {\r\n      return null;\r\n    }\r\n    const xPt = this.coordinateTransformer.convertPxToPt(rect.x);\r\n    const localY = rect.y - this.coordinateTransformer.pageOffsetPx;\r\n    const yPt = this.coordinateTransformer.pageHeightPt - this.coordinateTransformer.convertPxToPt(localY + rect.height);\r\n    if (!Number.isFinite(xPt) || !Number.isFinite(yPt)) {\r\n      return null;\r\n    }\r\n    return `${formatNumber(widthPt)} 0 0 ${formatNumber(heightPt)} ${formatNumber(xPt)} ${formatNumber(yPt)} cm`;\r\n  }\r\n}\r\n\r\nfunction formatNumber(value: number): string {\r\n  if (!Number.isFinite(value)) {\r\n    return \"0\";\r\n  }\r\n  return Number.isInteger(value) ? value.toString() : value.toFixed(4).replace(/0+$/, \"\").replace(/\\.$/, \"\");\r\n}\r\n", "import type { Rect, TextMatrix } from \"../types.js\";\r\nimport { CoordinateTransformer } from \"./coordinate-transformer.js\";\r\nimport { ShapeRenderer } from \"../renderers/shape-renderer.js\";\r\nimport { svgMatrixToPdf } from \"../transform-adapter.js\";\r\n\r\nexport class TransformScopeManager {\r\n  constructor(\r\n    private readonly coordinateTransformer: CoordinateTransformer,\r\n    private readonly shapeRenderer: ShapeRenderer,\r\n  ) {}\r\n\r\n  beginTransformScope(transform: TextMatrix, rect: Rect): void {\r\n    // Store transform info for shape renderer to use\r\n    const pdfMatrix = svgMatrixToPdf(transform);\r\n    if (!pdfMatrix) {\r\n      this.shapeRenderer.pushRawCommands([\"q\"]);\r\n      return;\r\n    }\r\n\r\n    // Convert rect position to PDF coordinates\r\n    const xPt = this.coordinateTransformer.convertPxToPt(rect.x);\r\n    const localY = rect.y - this.coordinateTransformer.pageOffsetPx;\r\n    const yPt = this.coordinateTransformer.pageHeightPt - this.coordinateTransformer.convertPxToPt(localY);\r\n\r\n    // CSS transforms default to a 50% / 50% origin. Model that by translating\r\n    // relative coordinates so the transform happens around the center of the\r\n    // border box.\r\n    const originOffsetX = Number.isFinite(rect.width) ? rect.width / 2 : 0;\r\n    const originOffsetY = Number.isFinite(rect.height) ? rect.height / 2 : 0;\r\n    const translateBackX = this.coordinateTransformer.convertPxToPt(-originOffsetX);\r\n    const translateBackY = this.coordinateTransformer.convertPxToPt(originOffsetY);\r\n    const translateForwardX = this.coordinateTransformer.convertPxToPt(originOffsetX);\r\n    const translateForwardY = this.coordinateTransformer.convertPxToPt(-originOffsetY);\r\n\r\n    // Set up transform context: translate to position, apply transform\r\n    // This way shapes can be drawn at origin (0,0) and will be positioned and transformed correctly\r\n    const cmds: string[] = [\r\n      \"q\",\r\n      // Position element on page (applied last in the matrix chain)\r\n      `1 0 0 1 ${formatNumber(xPt)} ${formatNumber(yPt)} cm`,\r\n      // Translate back from pivot after applying skew/rotate\r\n      `1 0 0 1 ${formatNumber(translateForwardX)} ${formatNumber(translateForwardY)} cm`,\r\n      // Apply the css transform (already converted into PDF space)\r\n      `${formatNumber(pdfMatrix.a)} ${formatNumber(pdfMatrix.b)} ${formatNumber(pdfMatrix.c)} ${formatNumber(pdfMatrix.d)} 0 0 cm`,\r\n      // Move the local coordinate system so the transform pivot is the center of the box\r\n      `1 0 0 1 ${formatNumber(translateBackX)} ${formatNumber(translateBackY)} cm`,\r\n    ];\r\n\r\n    // Add marker for testing\r\n    if (pdfMatrix.b !== 0 || pdfMatrix.c !== 0) {\r\n      cmds.push(`%PAGYRA_TRANSFORM ${formatNumber(pdfMatrix.a)} ${formatNumber(pdfMatrix.b)} ${formatNumber(pdfMatrix.c)} ${formatNumber(pdfMatrix.d)} ${formatNumber(pdfMatrix.e)} ${formatNumber(pdfMatrix.f)}`);\r\n    }\r\n\r\n    this.shapeRenderer.pushRawCommands(cmds);\r\n    this.shapeRenderer.setTransformContext(rect);\r\n  }\r\n\r\n  endTransformScope(): void {\r\n    this.shapeRenderer.pushRawCommands([\"Q\"]);\r\n    this.shapeRenderer.clearTransformContext();\r\n  }\r\n}\r\n\r\nfunction formatNumber(value: number): string {\r\n  if (!Number.isFinite(value)) {\r\n    return \"0\";\r\n  }\r\n  return Number.isInteger(value) ? value.toString() : value.toFixed(4).replace(/0+$/, \"\").replace(/\\.$/, \"\");\r\n}\r\n", "import { globalGlyphAtlas } from \"../font/glyph-atlas.js\";\r\nimport type { ImageRenderer } from \"../renderers/image-renderer.js\";\r\n\r\nexport function registerGlyphAtlasPages(imageRenderer: ImageRenderer): void {\r\n  try {\r\n    const pages = globalGlyphAtlas.getPages();\r\n    if (pages && pages.length > 0) {\r\n      imageRenderer.registerAtlasPages(pages);\r\n    }\r\n  } catch {\r\n    // ignore atlas registration errors - fall back to per-glyph images\r\n  }\r\n}\r\n", "export interface PartitionedCommands {\r\n  readonly preShadow: string[];\r\n  readonly post: string[];\r\n}\r\n\r\nexport function partitionImageCommands(commands: string[], shadowAliases: Set<string>): PartitionedCommands {\r\n  const preShadowImageCmds: string[] = [];\r\n  const postImageCmds: string[] = [];\r\n\r\n  for (let i = 0; i < commands.length; ) {\r\n    if (commands[i] === \"q\" && i + 3 < commands.length && commands[i + 3] === \"Q\") {\r\n      const doLine = commands[i + 2] ?? \"\";\r\n      const match = doLine.match(/^\\/(\\w+)\\s+Do$/);\r\n      const block = [commands[i], commands[i + 1] ?? \"\", commands[i + 2] ?? \"\", commands[i + 3] ?? \"\"];\r\n      i += 4;\r\n      if (match && shadowAliases.has(match[1])) {\r\n        preShadowImageCmds.push(...block);\r\n      } else {\r\n        postImageCmds.push(...block);\r\n      }\r\n    } else {\r\n      postImageCmds.push(commands[i]);\r\n      i += 1;\r\n    }\r\n  }\r\n\r\n  return { preShadow: preShadowImageCmds, post: postImageCmds };\r\n}\r\n", "import type { PdfObjectRef } from \"../primitives/pdf-document.js\";\r\nimport { TextRenderer } from \"../renderers/text-renderer.js\";\r\nimport { ImageRenderer } from \"../renderers/image-renderer.js\";\r\nimport { ShapeRenderer } from \"../renderers/shape-renderer.js\";\r\nimport { GraphicsStateManager } from \"../renderers/graphics-state-manager.js\";\r\nimport { registerGlyphAtlasPages } from \"./glyph-atlas-registrar.js\";\r\nimport { partitionImageCommands } from \"./image-command-partitioner.js\";\r\n\r\nexport interface PainterResult {\n  readonly content: string;\n  readonly fonts: Map<string, PdfObjectRef>;\n  readonly images: PainterImageResource[];\n  readonly graphicsStates: Map<string, number>;\n  readonly shadings: Map<string, string>;\n  readonly patterns?: Map<string, string>;\n}\n\r\nexport interface PainterImageResource {\r\n  readonly alias: string;\r\n  readonly image: {\r\n    src: string;\r\n    width: number;\r\n    height: number;\r\n    format: \"jpeg\" | \"png\" | \"gif\" | \"webp\";\r\n    channels: number;\r\n    bitsPerComponent: number;\r\n    data: Uint8Array;\r\n  };\r\n  ref?: PdfObjectRef;\r\n}\r\n\r\nexport class ResultCombiner {\r\n  constructor(\r\n    private readonly textRenderer: TextRenderer,\r\n    private readonly imageRenderer: ImageRenderer,\r\n    private readonly shapeRenderer: ShapeRenderer,\r\n    private readonly graphicsStateManager: GraphicsStateManager,\r\n  ) {}\r\n\r\n  combineResults(): PainterResult {\r\n    const textResult = this.textRenderer.getResult();\r\n    registerGlyphAtlasPages(this.imageRenderer);\r\n    const imageResult = this.imageRenderer.getResult();\r\n    const shapeResult = this.shapeRenderer.getResult();\n    const graphicsStates = new Map<string, number>();\r\n    for (const [name, alpha] of this.graphicsStateManager.getGraphicsStates()) {\r\n      graphicsStates.set(name, alpha);\r\n    }\r\n\r\n    // Partition image commands: shadow rasters (drawn beneath shapes) vs others\r\n    const shadowAliases = new Set<string>();\r\n    for (const [, res] of imageResult.images) {\r\n      if (res.image.src && typeof res.image.src === 'string' && res.image.src.startsWith('internal:shadow:')) {\r\n        shadowAliases.add(res.alias);\r\n      }\r\n    }\r\n\r\n    const { preShadow, post } = partitionImageCommands(imageResult.commands, shadowAliases);\r\n    const allCommands = [...preShadow, ...shapeResult.commands, ...textResult.commands, ...post];\r\n\r\n    // Process image resources to match the expected format\r\n    const processedImages: PainterImageResource[] = [];\r\n    for (const [, resource] of imageResult.images) {\r\n      // Convert the image resource to the expected format\r\n      processedImages.push({\r\n        alias: resource.alias,\r\n        image: {\r\n          src: resource.image.src,\r\n          width: resource.image.width,\r\n          height: resource.image.height,\r\n          format: resource.image.format,\r\n          channels: resource.image.channels,\r\n          bitsPerComponent: resource.image.bitsPerComponent,\r\n          data: new Uint8Array(resource.image.data), // Convert ArrayBuffer to Uint8Array\r\n        },\r\n        ref: resource.ref\r\n      });\r\n    }\r\n\r\n    const combinedShadings = new Map<string, string>();\n    for (const [name, dict] of shapeResult.shadings) {\n      combinedShadings.set(name, dict);\n    }\n    for (const [name, dict] of textResult.shadings) {\n      combinedShadings.set(name, dict);\n    }\n\n    const combinedPatterns = new Map<string, string>();\n    for (const [name, dict] of textResult.patterns ?? []) {\n      combinedPatterns.set(name, dict);\n    }\n\n    return {\n      content: allCommands.join(\"\\n\"),\n      fonts: textResult.fonts,\n      images: processedImages,\n      graphicsStates,\n      shadings: combinedShadings,\n      patterns: combinedPatterns,\n    };\n  }\n}\n", "import type {\r\n  Rect,\r\n  Run,\r\n  RGBA,\r\n  ImageRef,\r\n  Radius,\r\n  TextPaintOptions,\r\n  TextMatrix,\r\n  StrokeOptions,\r\n} from \"./types.js\";\r\nimport type { LinearGradient, RadialGradient } from \"../css/parsers/gradient-parser.js\";\r\nimport type { FontRegistry } from \"./font/font-registry.js\";\r\nimport type { PdfObjectRef } from \"./primitives/pdf-document.js\";\r\nimport { CoordinateTransformer } from \"./utils/coordinate-transformer.js\";\r\nimport { TextRenderer } from \"./renderers/text-renderer.js\";\r\nimport { ImageRenderer } from \"./renderers/image-renderer.js\";\nimport { ShapeRenderer, type ShapePoint, type PathCommand } from \"./renderers/shape-renderer.js\";\nimport { GraphicsStateManager } from \"./renderers/graphics-state-manager.js\";\nimport { ClippingPathBuilder } from \"./utils/clipping-path-builder.js\";\nimport { ImageMatrixBuilder } from \"./utils/image-matrix-builder.js\";\nimport { TransformScopeManager } from \"./utils/transform-scope-manager.js\";\nimport { ResultCombiner } from \"./utils/result-combiner.js\";\nimport { globalGlyphAtlas } from \"./font/glyph-atlas.js\";\nimport type { Environment } from \"../environment/environment.js\";\n\nexport interface PainterResult {\n  readonly content: string;\n  readonly fonts: Map<string, PdfObjectRef>;\n  readonly images: PainterImageResource[];\n  readonly graphicsStates: Map<string, number>;\n  readonly shadings: Map<string, string>;\n  readonly patterns?: Map<string, string>;\n}\n\r\nexport interface PainterImageResource {\r\n  readonly alias: string;\r\n  readonly image: {\r\n    src: string;\r\n    width: number;\r\n    height: number;\r\n    format: \"jpeg\" | \"png\" | \"gif\" | \"webp\";\r\n    channels: number;\r\n    bitsPerComponent: number;\r\n    data: Uint8Array;\r\n  };\r\n  ref?: PdfObjectRef;\r\n}\r\n\r\nexport class PagePainter {\n  private readonly coordinateTransformer: CoordinateTransformer;\n  private readonly textRenderer: TextRenderer;\n  private readonly imageRenderer: ImageRenderer;\n  private readonly shapeRenderer: ShapeRenderer;\n  private readonly graphicsStateManager: GraphicsStateManager;\r\n  private readonly clippingPathBuilder: ClippingPathBuilder;\n  private readonly imageMatrixBuilder: ImageMatrixBuilder;\n  private readonly transformScopeManager: TransformScopeManager;\n  private readonly resultCombiner: ResultCombiner;\n  private clipDepth = 0;\n  readonly environment?: Environment;\n\n  constructor(\n    pageHeightPt: number,\n    pxToPt: (value: number) => number,\n    fontRegistry: FontRegistry,\n    pageOffsetPx: number = 0,\n    environment?: Environment,\n  ) {\n    this.coordinateTransformer = new CoordinateTransformer(pageHeightPt, pxToPt, pageOffsetPx);\n    this.graphicsStateManager = new GraphicsStateManager();\n    this.imageRenderer = new ImageRenderer(this.coordinateTransformer);\n    this.textRenderer = new TextRenderer(this.coordinateTransformer, fontRegistry, this.imageRenderer, this.graphicsStateManager);\n    this.shapeRenderer = new ShapeRenderer(this.coordinateTransformer, this.graphicsStateManager);\n    this.clippingPathBuilder = new ClippingPathBuilder(this.coordinateTransformer);\n    this.imageMatrixBuilder = new ImageMatrixBuilder(this.coordinateTransformer);\n    this.transformScopeManager = new TransformScopeManager(this.coordinateTransformer, this.shapeRenderer);\n    this.resultCombiner = new ResultCombiner(this.textRenderer, this.imageRenderer, this.shapeRenderer, this.graphicsStateManager);\n    this.environment = environment;\n  }\n\r\n  get pageHeightPx(): number {\r\n    return this.coordinateTransformer.pageHeightPx;\r\n  }\r\n\r\n  drawBoxOutline(box: Rect, color: RGBA = { r: 0.85, g: 0.85, b: 0.85, a: 1 }): void {\r\n    this.shapeRenderer.drawBoxOutline(box, color);\r\n  }\r\n\r\n  drawFilledBox(box: Rect, color: RGBA): void {\r\n    this.shapeRenderer.drawFilledBox(box, color);\r\n  }\r\n\r\n  drawImage(image: ImageRef, rect: Rect): void {\r\n    this.imageRenderer.drawImage(image, rect);\r\n  }\r\n\r\n  drawBackgroundImage(image: ImageRef, rect: Rect, clipRect: Rect, clipRadius: Radius): void {\r\n    if (!clipRect || clipRect.width <= 0 || clipRect.height <= 0) {\r\n      this.drawImage(image, rect);\r\n      return;\r\n    }\r\n    const clipCommands = this.clippingPathBuilder.buildClipCommands(clipRect, clipRadius);\r\n    if (!clipCommands) {\r\n      this.drawImage(image, rect);\r\n      return;\r\n    }\r\n    const resource = this.imageRenderer.registerResource(image);\r\n    const imageMatrix = this.imageMatrixBuilder.buildImageMatrix(rect);\r\n    if (!imageMatrix) {\r\n      return;\r\n    }\r\n    const commands = [\"q\", ...clipCommands, \"W n\", imageMatrix, `/${resource.alias} Do`, \"Q\"];\r\n    this.shapeRenderer.pushRawCommands(commands);\r\n  }\r\n\r\n  // Draw an image immediately into the shape command stream (for shadows)\r\n  drawShadowImage(image: ImageRef, rect: Rect): void {\r\n    if (rect.width <= 0 || rect.height <= 0) return;\r\n    const res = this.imageRenderer.registerResource(image);\r\n    const widthPt = this.coordinateTransformer.convertPxToPt(rect.width);\r\n    const heightPt = this.coordinateTransformer.convertPxToPt(rect.height);\r\n    if (widthPt === 0 || heightPt === 0) return;\r\n    const xPt = this.coordinateTransformer.convertPxToPt(rect.x);\r\n    const localY = rect.y - this.coordinateTransformer.pageOffsetPx;\r\n    const yPt = this.coordinateTransformer.pageHeightPt - this.coordinateTransformer.convertPxToPt(localY + rect.height);\r\n    const cmds = [\r\n      \"q\",\r\n      `${formatNumber(widthPt)} 0 0 ${formatNumber(heightPt)} ${formatNumber(xPt)} ${formatNumber(yPt)} cm`,\r\n      `/${res.alias} Do`,\r\n      \"Q\",\r\n    ];\r\n    this.shapeRenderer.pushRawCommands(cmds);\r\n  }\r\n\r\n  async drawText(text: string, xPx: number, yPx: number, options: TextPaintOptions = { fontSizePt: 10 }): Promise<void> {\r\n    await this.textRenderer.drawText(text, xPx, yPx, options);\r\n  }\r\n\r\n  async drawTextRun(run: Run): Promise<void> {\r\n    await this.textRenderer.drawTextRun(run);\r\n  }\r\n\r\n  fillRoundedRect(rect: Rect, radii: Radius, paint: RGBA | LinearGradient | RadialGradient | string): void {\r\n    this.shapeRenderer.fillRoundedRect(rect, radii, paint);\r\n  }\r\n\r\n  fillRoundedRectDifference(outerRect: Rect, outerRadii: Radius, innerRect: Rect, innerRadii: Radius, color: RGBA): void {\r\n    this.shapeRenderer.fillRoundedRectDifference(outerRect, outerRadii, innerRect, innerRadii, color);\r\n  }\r\n\r\n  fillRect(rect: Rect, paint: RGBA | LinearGradient | RadialGradient | string): void {\r\n    this.shapeRenderer.fillRect(rect, paint);\r\n  }\r\n\r\n  strokeRect(rect: Rect, color: RGBA): void {\r\n    this.shapeRenderer.strokeRect(rect, color);\r\n  }\r\n\r\n  strokeRoundedRect(rect: Rect, radii: Radius, color: RGBA, lineWidth?: number): void {\r\n    this.shapeRenderer.strokeRoundedRect(rect, radii, color, lineWidth);\r\n  }\r\n\r\n  fillPolygon(points: ShapePoint[], color: RGBA, close: boolean = true): void {\r\n    this.shapeRenderer.fillPolygon(points, color, close);\r\n  }\r\n\r\n  fillPath(commands: PathCommand[], color: RGBA, options: { fillRule?: \"nonzero\" | \"evenodd\" } = {}): void {\r\n    this.shapeRenderer.fillPath(commands, color, options);\r\n  }\r\n\r\n  // New: fill an arbitrary path with a gradient (linear or radial). The ShapeRenderer will\r\n  // create a clipping path from the provided commands and paint the shading clipped to that path.\r\n  fillPathWithGradient(commands: PathCommand[], gradient: LinearGradient | RadialGradient, options: { fillRule?: \"nonzero\" | \"evenodd\" } = {}): void {\r\n    this.shapeRenderer.fillPathWithGradient(commands, gradient, options);\r\n  }\r\n\r\n  strokePolyline(points: ShapePoint[], color: RGBA, options: StrokeOptions & { close?: boolean } = {}): void {\r\n    this.shapeRenderer.strokePolyline(points, color, options);\r\n  }\r\n\r\n  strokePath(commands: PathCommand[], color: RGBA, options: StrokeOptions = {}): void {\n    this.shapeRenderer.strokePath(commands, color, options);\n  }\n\n  beginClipPath(commands: PathCommand[], options: { fillRule?: \"nonzero\" | \"evenodd\" } = {}): void {\n    if (this.shapeRenderer.beginClipPath(commands, options)) {\n      this.clipDepth++;\n    }\n  }\n\n  endClipPath(): void {\n    if (this.clipDepth <= 0) {\n      return;\n    }\n    this.shapeRenderer.endClipPath();\n    this.clipDepth--;\n  }\n\n  convertPxToPt(value: number): number {\n    return this.coordinateTransformer.convertPxToPt(value);\n  }\n\r\n  beginOpacityScope(opacity: number): void {\r\n    if (opacity >= 1) return;\r\n    const state = this.graphicsStateManager.ensureFillAlphaState(opacity);\r\n    this.shapeRenderer.pushRawCommands([\"q\", `/${state} gs`]);\r\n  }\r\n\r\n  endOpacityScope(opacity: number): void {\r\n    if (opacity >= 1) return;\r\n    this.shapeRenderer.pushRawCommands([\"Q\"]);\r\n  }\r\n\r\n  beginTransformScope(transform: TextMatrix, rect: Rect): void {\r\n    this.transformScopeManager.beginTransformScope(transform, rect);\r\n  }\r\n\r\n  endTransformScope(): void {\r\n    this.transformScopeManager.endTransformScope();\r\n  }\r\n\r\n  result(): PainterResult {\r\n    // Ensure any atlas pages created by the glyph packer are registered as image resources\r\n    try {\r\n      const pages = globalGlyphAtlas.getPages();\r\n      if (pages && pages.length > 0) {\r\n        this.imageRenderer.registerAtlasPages(pages);\r\n      }\r\n    } catch {\r\n      // ignore atlas registration errors - fall back to per-glyph images\r\n    }\r\n    return this.resultCombiner.combineResults();\r\n  }\r\n}\r\n\r\nfunction formatNumber(value: number): string {\r\n  if (!Number.isFinite(value)) {\r\n    return \"0\";\r\n  }\r\n  return Number.isInteger(value) ? value.toString() : value.toFixed(4).replace(/0+$/, \"\").replace(/\\.$/, \"\");\r\n}\r\n", "import { pickFooterVariant, pickHeaderVariant, paintHeaderFooter, type HeaderFooterLayout } from \"../header-footer.js\";\r\nimport type { HeaderFooterPaintContext } from \"../header-footer-painter.js\";\r\nimport { PagePainter, type PainterResult } from \"../page-painter.js\";\r\nimport type { FontRegistry } from \"../font/font-registry.js\";\r\nimport { LayerMode } from \"../types.js\";\r\nimport type { LayoutPageTree, PageSize, RGBA, TextPaintOptions } from \"../types.js\";\nimport { paintBoxAtomic, paintPageBackground } from \"./box-painter.js\";\nimport type { Environment } from \"../../environment/environment.js\";\n\r\nexport interface PagePaintInput {\r\n  readonly pageTree: LayoutPageTree;\r\n  readonly pageNumber: number;\r\n  readonly totalPages: number;\r\n  readonly pageSize: PageSize;\r\n  readonly pxToPt: (px: number) => number;\r\n  readonly pageWidthPx: number;\r\n  readonly pageHeightPx: number;\r\n  readonly fontRegistry: FontRegistry;\r\n  readonly headerFooterLayout: HeaderFooterLayout;\n  readonly tokens: Map<string, string | ((page: number, total: number) => string)>;\n  readonly headerFooterTextOptions: TextPaintOptions;\n  readonly pageBackground?: RGBA;\n  /** Page margins for header/footer positioning */\n  readonly margins?: { top: number; right: number; bottom: number; left: number };\n  /** CSS for header/footer styling */\n  readonly headerFooterCss?: string;\n  /** Platform environment (Node/browser) for resource loading during paint */\n  readonly environment?: Environment;\n}\n\r\nexport async function paintLayoutPage({\r\n  pageTree,\r\n  pageNumber,\r\n  totalPages,\r\n  pageSize,\r\n  pxToPt,\r\n  pageWidthPx,\r\n  pageHeightPx,\r\n  fontRegistry,\r\n  headerFooterLayout,\r\n  tokens,\r\n  headerFooterTextOptions,\n  pageBackground,\n  margins,\n  headerFooterCss,\n  environment,\n}: PagePaintInput): Promise<PainterResult> {\n  const painter = new PagePainter(pageSize.heightPt, pxToPt, fontRegistry, pageTree.pageOffsetY, environment);\n\r\n  const headerVariant = pickHeaderVariant(headerFooterLayout, pageNumber, totalPages);\r\n  const footerVariant = pickFooterVariant(headerFooterLayout, pageNumber, totalPages);\r\n\r\n  paintPageBackground(painter, pageBackground, pageWidthPx, pageHeightPx, pageTree.pageOffsetY);\r\n\r\n  // Build context for HTML-based header/footer rendering\r\n  const hfContext: HeaderFooterPaintContext | undefined = margins\n    ? {\n        margins,\n        pageWidthPx,\n        pageHeightPx,\n        fontRegistry,\n        pageOffsetY: pageTree.pageOffsetY,\n        css: headerFooterCss,\n        environment,\n      }\n    : undefined;\n\r\n  if (headerFooterLayout.layerMode === LayerMode.Under) {\r\n    await paintHeaderFooter(\r\n      painter,\r\n      headerVariant,\r\n      footerVariant,\r\n      tokens,\r\n      pageNumber,\r\n      totalPages,\r\n      headerFooterTextOptions,\r\n      true,\r\n      hfContext,\r\n    );\r\n  }\r\n\r\n  // Paint each box as an atomic unit in the resolved paint order.\r\n  for (const box of pageTree.paintOrder) {\r\n    await paintBoxAtomic(painter, box);\r\n  }\r\n\r\n  if (headerFooterLayout.layerMode === LayerMode.Over) {\r\n    await paintHeaderFooter(\r\n      painter,\r\n      headerVariant,\r\n      footerVariant,\r\n      tokens,\r\n      pageNumber,\r\n      totalPages,\r\n      headerFooterTextOptions,\r\n      false,\r\n      hfContext,\r\n    );\r\n  }\r\n\r\n  return painter.result();\r\n}\r\n", "// Browser stub: built-in font files are not bundled. Provide your own fontConfig.\nimport type { FontConfig } from \"../../types/fonts.js\";\n\nexport async function loadBuiltinFontConfig(): Promise<FontConfig | null> {\n  return null;\n}\n", "import type { PdfObjectRef } from \"../primitives/pdf-document.js\";\r\nimport type { PdfDocument } from \"../primitives/pdf-document.js\";\r\nimport type { PainterResult } from \"../page-painter.js\";\r\n\r\nexport interface PageResources {\n  fonts: Map<string, PdfObjectRef>;\n  xObjects: Map<string, PdfObjectRef>;\n  extGStates: Map<string, PdfObjectRef>;\n  shadings: Map<string, PdfObjectRef>;\n  patterns: Map<string, PdfObjectRef>;\n}\n\nexport function registerPageResources(doc: PdfDocument, result: PainterResult): PageResources {\n  const xObjects = new Map<string, PdfObjectRef>();\n  for (const image of result.images) {\n    const ref = doc.registerImage(image.image);\r\n    image.ref = ref;\r\n    xObjects.set(image.alias, ref);\r\n  }\r\n\r\n  const extGStates = new Map<string, PdfObjectRef>();\r\n  for (const [name, alpha] of result.graphicsStates) {\r\n    const ref = doc.registerExtGState(alpha);\r\n    extGStates.set(name, ref);\r\n  }\r\n\r\n  const shadings = new Map<string, PdfObjectRef>();\r\n  for (const [name, dict] of result.shadings) {\r\n    const ref = doc.registerShading(name, dict);\n    shadings.set(name, ref);\n  }\n\n  const patterns = new Map<string, PdfObjectRef>();\n  for (const [name, dict] of result.patterns ?? []) {\n    const ref = doc.registerPattern(name, dict);\n    patterns.set(name, ref);\n  }\n\n  return {\n    fonts: result.fonts,\n    xObjects,\n    extGStates,\n    shadings,\n    patterns,\n  };\n}\n", "import { PdfDocument } from \"./primitives/pdf-document.js\";\r\nimport type { LayoutTree, PageSize, PdfMetadata, RenderBox, RGBA, TextPaintOptions, Run } from \"./types.js\";\r\nimport {\r\n  initHeaderFooterContext,\r\n  layoutHeaderFooterTrees,\r\n  adjustPageBoxForHf,\r\n  computeHfTokens,\r\n} from \"./header-footer.js\";\r\nimport { paginateTree } from \"./pagination.js\";\r\nimport { initFontSystem, finalizeFontSubsets, preflightFontsForPdfa } from \"./font/font-registry.js\";\r\nimport type { FontConfig } from \"../types/fonts.js\";\r\nimport { paintLayoutPage } from \"./renderer/page-paint.js\";\r\nimport { loadBuiltinFontConfig } from \"./font/builtin-fonts.js\";\nimport { registerPageResources, type PageResources } from \"./utils/page-resource-registrar.js\";\r\nimport { FontRegistryResolver } from \"../fonts/font-registry-resolver.js\";\r\nimport { applyWordSpacingToGlyphRun, computeGlyphRun } from \"./utils/node-text-run-factory.js\";\r\nimport { log } from \"../logging/debug.js\";\nimport type { Environment } from \"../environment/environment.js\";\n\r\nconst DEFAULT_PAGE_SIZE: PageSize = { widthPt: 595.28, heightPt: 841.89 }; // A4 in points\r\n\r\nexport interface PageMargins {\r\n  readonly top: number;\r\n  readonly right: number;\r\n  readonly bottom: number;\r\n  readonly left: number;\r\n}\r\n\r\nexport interface RenderPdfOptions {\n  readonly pageSize?: PageSize;\n  readonly metadata?: PdfMetadata;\n  readonly fontConfig?: FontConfig;\n  /** Page margins in pixels - used for header/footer positioning */\n  readonly margins?: PageMargins;\n  /** CSS for header/footer styling */\n  readonly headerFooterCss?: string;\n  /** Platform environment (Node/browser) for resource loading during paint */\n  readonly environment?: Environment;\n}\n\nexport async function renderPdf(layout: LayoutTree, options: RenderPdfOptions = {}): Promise<Uint8Array> {\n  const fontConfig = options.fontConfig ?? (await loadBuiltinFontConfig());\n  const pageSize = options.pageSize ?? derivePageSize(layout);\r\n  const pxToPt = createPxToPt(layout.dpiAssumption);\r\n  const ptToPx = createPtToPx(layout.dpiAssumption);\r\n  const doc = new PdfDocument(options.metadata ?? {});\r\n  const fontRegistry = initFontSystem(doc, layout.css);\r\n\r\n  // Initialize font embedding if fontConfig provided\r\n  if (fontConfig) {\r\n    await fontRegistry.initializeEmbedder(fontConfig);\r\n  }\r\n\r\n  preflightFontsForPdfa(fontRegistry);\r\n\r\n  const pageHeightPx = ptToPx(pageSize.heightPt) || 1;\r\n  const pageWidthPx = ptToPx(pageSize.widthPt) || 1;\r\n\r\n  // Use provided margins or derive from layout\r\n  const margins = options.margins ?? {\r\n    top: 0,\r\n    right: 0,\r\n    bottom: 0,\r\n    left: 0,\r\n  };\r\n\r\n  const baseContentBox = computeBaseContentBox(layout.root, pageSize, pxToPt);\r\n  const hfContext = initHeaderFooterContext(layout.hf, pageSize, baseContentBox);\r\n  const hfLayout = layoutHeaderFooterTrees(hfContext, pxToPt);\r\n\r\n  // Adjust content area to exclude header/footer heights\r\n  // This implements the Word/mPDF behavior where headers and footers\r\n  // reduce the available content area\r\n  const adjustedContentBox = adjustPageBoxForHf(baseContentBox, hfLayout);\r\n\r\n  // Calculate effective page height for pagination\r\n  // When headers/footers are present, the content area is reduced\r\n  const effectiveContentHeightPx = pageHeightPx - hfLayout.headerHeightPx - hfLayout.footerHeightPx;\r\n  const paginationHeight = effectiveContentHeightPx > 0 ? effectiveContentHeightPx : pageHeightPx;\r\n\r\n  const pages = paginateTree(layout.root, { pageHeight: paginationHeight });\r\n  const totalPages = pages.length;\r\n  const tokens = computeHfTokens(layout.hf.placeholders ?? {}, totalPages, options.metadata);\r\n  const pageBackground = resolvePageBackground(layout.root);\r\n\r\n  // Create FontResolver and enrich all textRuns with GlyphRun data\r\n  const fontResolver = new FontRegistryResolver(fontRegistry);\r\n  await enrichTreeWithGlyphRuns(layout.root, fontResolver);\r\n\r\n  const headerFooterTextOptions: TextPaintOptions = { fontSizePt: 10, fontFamily: layout.hf.fontFamily };\r\n\r\n  for (let index = 0; index < pages.length; index++) {\r\n    const pageTree = pages[index];\r\n    const pageNumber = index + 1;\r\n\r\n  const painterResult = await paintLayoutPage({\n    pageTree,\n    pageNumber,\n    totalPages,\n    pageSize,\n    pxToPt,\n    pageWidthPx,\n    pageHeightPx,\n    fontRegistry,\n    headerFooterLayout: hfLayout,\n    tokens,\n    headerFooterTextOptions,\n    pageBackground,\n    margins,\n    headerFooterCss: options.headerFooterCss,\n    environment: options.environment,\n  });\n\r\n    const resources = registerPageResources(doc, painterResult);\r\n\r\n    doc.addPage({\r\n      width: pageSize.widthPt,\r\n      height: pageSize.heightPt,\r\n      contents: painterResult.content,\r\n      resources,\r\n      annotations: [],\r\n    });\r\n  }\r\n\r\n  finalizeFontSubsets(fontRegistry);\r\n  return doc.finalize();\r\n}\r\n\r\nfunction resolvePageBackground(root: RenderBox): RGBA | undefined {\r\n  if (root.background?.color) {\r\n    return root.background.color;\r\n  }\r\n  for (const child of root.children) {\r\n    if (child.tagName === \"body\" || child.tagName === \"html\") {\r\n      const candidate = child.background?.color;\r\n      if (candidate) {\r\n        return candidate;\r\n      }\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n\r\nfunction createPxToPt(dpi: number): (px: number) => number {\r\n  const safeDpi = dpi > 0 ? dpi : 96;\r\n  const factor = 72 / safeDpi;\r\n  return (px: number) => px * factor;\r\n}\r\n\r\nfunction createPtToPx(dpi: number): (pt: number) => number {\r\n  const safeDpi = dpi > 0 ? dpi : 96;\r\n  const factor = safeDpi / 72;\r\n  return (pt: number) => pt * factor;\r\n}\r\n\r\nfunction derivePageSize(layout: LayoutTree): PageSize {\r\n  const widthPt = layout.root.contentBox.width > 0 ? createPxToPt(layout.dpiAssumption)(layout.root.contentBox.width) : DEFAULT_PAGE_SIZE.widthPt;\r\n  const heightPt =\r\n    layout.root.contentBox.height > 0 ? createPxToPt(layout.dpiAssumption)(layout.root.contentBox.height) : DEFAULT_PAGE_SIZE.heightPt;\r\n  return { widthPt, heightPt };\r\n}\r\n\r\nfunction computeBaseContentBox(root: RenderBox, pageSize: PageSize, pxToPt: (px: number) => number) {\r\n  const widthPx = root.contentBox.width > 0 ? root.contentBox.width : pageSize.widthPt / pxToPt(1);\r\n  const heightPx = root.contentBox.height > 0 ? root.contentBox.height : pageSize.heightPt / pxToPt(1);\r\n  return {\r\n    x: root.contentBox.x,\r\n    y: root.contentBox.y,\r\n    width: widthPx,\r\n    height: heightPx,\r\n  };\r\n}\r\n\r\nasync function enrichTreeWithGlyphRuns(root: RenderBox, fontResolver: FontRegistryResolver): Promise<void> {\r\n  async function enrichRun(run: Run): Promise<void> {\r\n    log('font', 'debug', `Attempting to enrich: \"${run.text}\", family: ${run.fontFamily}`);\r\n    if (run.glyphs) {\r\n      log('font', 'debug', \"Already has glyphs, skipping\");\r\n      return;\r\n    }\r\n    try {\r\n      const font = await fontResolver.resolve(run.fontFamily, run.fontWeight, run.fontStyle);\r\n      log('font', 'debug', \"Font resolved for glyph enrichment\");\r\n      const letterSpacing = run.letterSpacing ?? 0;\r\n      const glyphRun = computeGlyphRun(font, run.text, run.fontSize, letterSpacing);\r\n      applyWordSpacingToGlyphRun(glyphRun, run.text, run.wordSpacing);\r\n\r\n      run.glyphs = glyphRun;\r\n      log('font', 'debug', `Enriched \"${run.text}\" with ${glyphRun.glyphIds.length} glyphs:`, glyphRun.glyphIds);\r\n    } catch (error) {\r\n      log('font', 'warn', `Failed to enrich \"${run.text}\":`, error);\r\n    }\r\n  }\r\n\r\n  async function traverse(box: RenderBox): Promise<void> {\r\n    if (box.textRuns && box.textRuns.length > 0) {\r\n      log('font', 'debug', `Found ${box.textRuns.length} text runs in box ${box.tagName || \"text\"}`);\r\n      for (const run of box.textRuns) {\r\n        await enrichRun(run);\r\n      }\r\n    }\r\n    for (const child of box.children) {\r\n      await traverse(child);\r\n    }\r\n  }\r\n\r\n  log('font', 'debug', \"Starting enrichment of tree\");\r\n  await traverse(root);\r\n  log('font', 'debug', \"Finished enrichment\");\r\n}\r\n", "import type { RenderBox, Run } from \"../types.js\";\r\n\r\n/**\r\n * Global pass to fix justified layout in the render tree.\r\n *\r\n * For each RenderBox with textAlign: \"justify\":\r\n *   - collect ALL runs from that box and its descendants\r\n *   - group runs by lineIndex\r\nimport type { RenderBox, Run } from \"../types.js\";\r\n\r\n/**\r\n * Global pass to fix justified layout in the render tree.\r\n *\r\n * For each RenderBox with textAlign: \"justify\":\r\n *   - collect ALL runs from that box and its descendants\r\n *   - group runs by lineIndex\r\n *   - sort each group by lineMatrix.e (X)\r\n *   -for each non-final line:\r\n *       * shift later runs by the cumulative expansion\r\n *         from previous runs: spacesInRun * wordSpacing\r\n */\r\nexport function applyTextLayoutAdjustments(root: RenderBox): void {\r\n    traverse(root, (box) => {\r\n        // Only process boxes with justify alignment\r\n        if (box.textAlign !== \"justify\") return true; // Continue searching\r\n\r\n        // Collect ALL runs from this box and its descendants\r\n        const allRuns: Run[] = [];\r\n        collectRunsFromTree(box, allRuns);\r\n\r\n        const candidates = allRuns.filter(\r\n            (run) => typeof run.lineIndex === \"number\",\r\n        );\r\n        if (candidates.length === 0) return false; // Stop descending\r\n\r\n        const groups = groupRunsByLineIndex(candidates);\r\n        for (const lineRuns of groups) {\r\n            adjustLinePositions(lineRuns);\r\n        }\r\n\r\n        return false; // Stop descending into this justified box\r\n    });\r\n}\r\n\r\nfunction groupRunsByLineIndex(runs: Run[]): Run[][] {\r\n    const map = new Map<number, Run[]>();\r\n\r\n    for (const run of runs) {\r\n        const idx = run.lineIndex as number;\r\n        let group = map.get(idx);\r\n        if (!group) {\r\n            group = [];\r\n            map.set(idx, group);\r\n        }\r\n        group.push(run);\r\n    }\r\n\r\n    for (const group of map.values()) {\r\n        group.sort((a, b) => {\r\n            const ax = a.lineMatrix?.e ?? 0;\r\n            const bx = b.lineMatrix?.e ?? 0;\r\n            return ax - bx;\r\n        });\r\n    }\r\n\r\n    return Array.from(map.values());\r\n}\r\n\r\n/**\r\n * Adjust positions on a single visual line.\r\n *\r\n * - Skip last lines (isLastLine === true).\r\n * - Skip lines with no spaces.\r\n * - Walk from left to right:\r\n *    * shift run.x by cumulativeOffset\r\n *    * cumulativeOffset += spacesInRun * wordSpacing\r\n */\r\nfunction adjustLinePositions(runs: Run[]): void {\r\n    if (runs.length === 0) return;\r\n\r\n    // Find first non-whitespace run to identify leading spaces\r\n    let firstContentIndex = 0;\r\n    while (\r\n        firstContentIndex < runs.length &&\r\n        /^\\s+$/.test(runs[firstContentIndex].text)\r\n    ) {\r\n        firstContentIndex++;\r\n    }\r\n\r\n    // Calculate width to redistribute from leading spaces\r\n    let widthLost = 0;\r\n    for (let i = 0; i < firstContentIndex; i++) {\r\n        widthLost += runs[i].advanceWidth ?? 0;\r\n    }\r\n\r\n    // Count remaining spaces\r\n    let remainingSpaces = 0;\r\n    for (let i = firstContentIndex; i < runs.length; i++) {\r\n        remainingSpaces += runs[i].spacesInRun ?? 0;\r\n    }\r\n\r\n    const isLastLine = runs[0].isLastLine ?? false;\r\n\r\n    // Redistribute width if not last line and we have spaces to distribute to\r\n    if (!isLastLine && widthLost > 0 && remainingSpaces > 0) {\r\n        const adjustment = widthLost / remainingSpaces;\r\n        for (let i = firstContentIndex; i < runs.length; i++) {\r\n            const run = runs[i];\r\n            if ((run.spacesInRun ?? 0) > 0) {\r\n                run.wordSpacing = (run.wordSpacing ?? 0) + adjustment;\r\n                // Update advanceWidth to reflect the new spacing\r\n                run.advanceWidth =\r\n                    (run.advanceWidth ?? 0) + (run.spacesInRun! * adjustment);\r\n            }\r\n        }\r\n    }\r\n\r\n    // Capture original positions and base widths to detect existing gaps\r\n    const originals = runs.map((run) => ({\r\n        x: run.lineMatrix?.e ?? 0,\r\n        baseWidth:\r\n            (run.advanceWidth ?? 0) -\r\n            (run.spacesInRun ?? 0) * (run.wordSpacing ?? 0),\r\n        fontSize: run.fontSize,\r\n    }));\r\n\r\n    let currentX = originals[0].x;\r\n\r\n    for (let i = 0; i < runs.length; i++) {\r\n        const run = runs[i];\r\n\r\n        // If it's a leading whitespace run, treat as zero width and skip\r\n        if (i < firstContentIndex) {\r\n            if (run.lineMatrix) {\r\n                run.lineMatrix.e = currentX;\r\n            }\r\n            // Set width to 0 to avoid overlaps in tests and rendering\r\n            run.advanceWidth = 0;\r\n            continue;\r\n        }\r\n\r\n        if (run.lineMatrix) {\r\n            run.lineMatrix.e = currentX;\r\n        }\r\n\r\n        const advanceWidth = run.advanceWidth ?? 0;\r\n        currentX += advanceWidth;\r\n\r\n        // If there's a significant gap between this run and the next (e.g. an image), preserve it.\r\n        // Otherwise, assume it's a text gap/overlap and close it (using our calculated advanceWidth).\r\n        if (i < runs.length - 1) {\r\n            const nextOriginal = originals[i + 1];\r\n            const currOriginal = originals[i];\r\n\r\n            const gap = nextOriginal.x - (currOriginal.x + currOriginal.baseWidth);\r\n            // Use the larger font size as a threshold for \"is this a text gap?\"\r\n            const threshold = Math.max(currOriginal.fontSize, nextOriginal.fontSize);\r\n\r\n            // Preserve gap if it's large, OR if the current run has 0 width (and wasn't stripped)\r\n            // This handles cases where layout engine produced 0-width runs but placed them with spacing.\r\n            const isStripped = i < firstContentIndex;\r\n            if (gap > threshold || (!isStripped && advanceWidth === 0 && gap > 0)) {\r\n                currentX += gap;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction collectRunsFromTree(box: RenderBox, accumulator: Run[]): void {\r\n    if (box.textRuns) {\r\n        accumulator.push(...box.textRuns);\r\n    }\r\n    for (const child of box.children) {\r\n        collectRunsFromTree(child, accumulator);\r\n    }\r\n}\r\n\r\nfunction traverse(box: RenderBox, visitor: (box: RenderBox) => boolean): void {\r\n    const continueTraversal = visitor(box);\r\n    if (continueTraversal) {\r\n        for (const child of box.children) {\r\n            traverse(child, visitor);\r\n        }\r\n    }\r\n}\r\n", "// src/units/page-utils.ts\r\n\r\nimport { ptToPx } from \"./units.js\";\r\n\r\nexport interface PageMarginsPx {\r\n  top: number;\r\n  right: number;\r\n  bottom: number;\r\n  left: number;\r\n}\r\n\r\nexport const DEFAULT_PAGE_SIZE_PT = { width: 595.28, height: 841.89 };\r\nexport const DEFAULT_PAGE_MARGINS_PT = { top: 36, right: 36, bottom: 36, left: 36 };\r\n\r\nexport const DEFAULT_PAGE_WIDTH_PX = ptToPx(DEFAULT_PAGE_SIZE_PT.width);\r\nexport const DEFAULT_PAGE_HEIGHT_PX = ptToPx(DEFAULT_PAGE_SIZE_PT.height);\r\n\r\nexport const DEFAULT_PAGE_MARGINS_PX = {\r\n  top: ptToPx(DEFAULT_PAGE_MARGINS_PT.top),\r\n  right: ptToPx(DEFAULT_PAGE_MARGINS_PT.right),\r\n  bottom: ptToPx(DEFAULT_PAGE_MARGINS_PT.bottom),\r\n  left: ptToPx(DEFAULT_PAGE_MARGINS_PT.left),\r\n};\r\n\r\nexport function resolvePageMarginsPx(pageWidthPx: number, pageHeightPx: number): PageMarginsPx {\r\n  // ... (implementation from html-to-pdf.ts)\r\n  const margins = { ...DEFAULT_PAGE_MARGINS_PX };\r\n  const horizontalSum = margins.left + margins.right;\r\n  const verticalSum = margins.top + margins.bottom;\r\n  const usableWidth = maxContentDimension(pageWidthPx, 0);\r\n  const usableHeight = maxContentDimension(pageHeightPx, 0);\r\n\r\n  if (horizontalSum > usableWidth) {\r\n    const scale = usableWidth / (horizontalSum || 1);\r\n    margins.left *= scale;\r\n    margins.right *= scale;\r\n  }\r\n  if (verticalSum > usableHeight) {\r\n    const scale = usableHeight / (verticalSum || 1);\r\n    margins.top *= scale;\r\n    margins.bottom *= scale;\r\n  }\r\n  return margins;\r\n}\r\n\r\nexport function sanitizeDimension(value: number | undefined, fallback: number): number {\r\n  // ... (implementation from html-to-pdf.ts)\r\n  if (!Number.isFinite(value ?? NaN)) {\r\n    return fallback;\r\n  }\r\n  const sanitized = Number(value);\r\n  return sanitized > 0 ? sanitized : fallback;\r\n}\r\n\r\nexport function maxContentDimension(total: number, marginsSum: number): number {\r\n  // ... (implementation from html-to-pdf.ts)\r\n  return Math.max(1, total - marginsSum);\r\n}\r\n", "/**\r\n * Browser entrypoint: minimal surface that wires the BrowserEnvironment.\r\n * Expect callers to provide HTML/CSS strings and optional fontConfig with preloaded ArrayBuffers.\r\n */\r\nimport { BrowserEnvironment } from \"./environment/browser-environment.js\";\r\nimport { setGlobalEnvironment } from \"./environment/global.js\";\r\nimport type { RenderHtmlOptions } from \"./html-to-pdf.js\";\r\nimport { renderHtmlToPdf } from \"./html-to-pdf.js\";\r\n\r\nexport async function renderHtmlToPdfBrowser(options: Omit<RenderHtmlOptions, \"environment\">): Promise<Uint8Array> {\r\n  const environment = new BrowserEnvironment();\r\n  setGlobalEnvironment(environment);\r\n  return renderHtmlToPdf({ ...options, environment });\r\n}\r\n"],
  "mappings": "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MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV;AAAA,MACA;AAAA,MACA,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,MACV,IAAI,MAAM;AAAA,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E,QAAQ,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,aAAa,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,aAAa,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAA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,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC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C,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,gBAAgB,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,UAAU,GAAE,CAAC,GAAE,YAAY,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,SAAS,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,YAAY,GAAE,CAAC,GAAE,YAAY,GAAE,CAAC,GAAE,YAAY,GAAE,CAAC,GAAE,YAAY,GAAE,CAAC,GAAE,YAAY,GAAE,CAAC,GAAE,YAAY,GAAE,CAAC,GAAE,YAAY,GAAE,CAAC,GAAE,YAAY,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,WAAW,GAAE,CAAC,GAAE,YAAY,GAAE,C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E,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,OAAO,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAAE,CAAC,GAAE,QAAQ,GAA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ACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,MAAM;AACV;;;ACvJO,IAAM,oBAA8B;AAAA,EACvC,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,MAAM;AACV;;;ACvJO,IAAM,mBAA6B;AAAA,EACtC,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,MAAM;AACV;;;ACvJO,IAAM,wBAAkC;AAAA,EAC3C,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,MAAM;AACV;;;ACtJO,IAAM,iBAA2B;AAAA,EACpC,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,MAAM;AACV;;;ACvJO,IAAM,sBAAgC;AAAA,EACzC,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,OAAO;AAAA,EACP,O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",
  "names": ["performance", "before", "parse", "CSSStyleDeclaration", "Canvas", "require_parse", "Position", "whitespace", "rules", "m", "prop", "isNode", "sourceFile", "key", "order", "needle", "section", "entries", "key", "error", "decoder_exports", "tagToString", "entries", "init_decoder", "key", "shelf", "x", "y", "placement", "esm_exports", "_a", "CharCodes", "BinTrieFlags", "EntityDecoderState", "DecodingMode", "_a", "current", "CharCodes", "State", "QuoteType", "_a", "ElementType", "Text", "Comment", "_a", "CDATA", "isTag", "Text", "Comment", "CDATA", "previousSibling", "esm_exports", "isTag", "escape", "EntityLevel", "EncodingMode", "attributes", "_a", "key", "node", "isTag", "_a", "isTag", "isTag", "isTag", "key", "tagName", "DocumentPosition", "current", "href", "_a", "fetch", "tagName", "prop", "handler", "current", "isConnected", "attributes", "key", "Parser", "esm_exports", "append", "attribute", "Parser", "attributes", "create", "append", "name", "attributeChangedCallback", "attributes", "attribute", "attributeChangedCallback", "Node", "node", "escape", "Node", "attributeChangedCallback", "escape", "nextElementSibling", "current", "Node", "nextElementSibling", "Comment", "import_boolbase", "SelectorType", "AttributeAction", "isWhitespace", "subselects", "getName", "ignoreCase", "import_boolbase", "isTraversal", "_a", "adapter", "boolbase", "_a", "parse", "import_boolbase", "boolbase", "parse", "import_boolbase", "adapter", "boolbase", "adapter", "elem", "import_boolbase", "adapter", "boolbase", "compileToken", "isTraversal", "compileToken", "_a", "adapter", "compileToken", "current", "elem", "compile", "adapter", "isTraversal", "_a", "query", "boolbase", "esm_exports", "_a", "compile", "query", "adapter", "boolbase", "is", "isTag", "existsOne", "getChildren", "getAttributeValue", "getName", "getParent", "getSiblings", "getText", "hasAttrib", "removeSubsets", "findAll", "matches", "findOne", "compile", "is", "Text", "previousSibling", "nextSibling", "escape", "Node", "Text", "nextElementSibling", "after", "tagName", "matches", "before", "Node", "esm_default", "esm_default", "attribute", "refs", "key", "handler", "esm_default", "keys", "key", "create", "Element", "nextElementSibling", "Text", "attributes", "attribute", "escape", "parentElement", "matches", "next", "handler", "Element", "Attr", "CDATASection", "CharacterData", "Comment", "DocumentFragment", "DocumentType", "Element", "Node", "ShadowRoot", "Text", "SVGElement", "Element", "key", "tagName", "tagName", "tagName", "tagName", "tagName", "Canvas", "tagName", "tagName", "tagName", "tagName", "tagName", "tagName", "tagName", "tagName", "tagName", "tagName", "tagName", "tagName", "voidElements", "after", "window", "Document", "globalThis", "textContent", "Comment", "Element", "Text", "customElements", "Document", "nextElementSibling", "textContent", "Document", "Document", "parse", "Document", "parseSelector", "s", "result", "pseudos", "key", "parseSelector", "result", "current", "prop", "tagName", "key", "matches", "current", "w", "i", "HEAD", "add", "view", "entries", "decodeWoff2", "entries", "isItalic", "countSpaces", "countSpaces", "current", "isInlineDisplay", "isInlineDisplay", "current", "slack", "cost", "lines", "current", "collectInlineParticipants", "isInlineDisplay", "r", "g", "b", "current", "current", "percent", "parseLength", "current", "targetWidth", "filter", "key", "before", "entries", "entries", "pxToPt", "key", "parseColor", "clampNonNegative", "current", "clamp", "clampNonNegative", "parseBorderWidth", "PERCENT_LENGTH_REGEX", "parseLengthOrPercent", "parseFontFamily", "PERCENT_LENGTH_REGEX", "matches", "parseTextDecorationLine", "parseFloat", "isColorLike", "clamp", "clampNonNegative", "INHERITABLE_KEYWORDS", "num", "current", "before", "after", "flex", "track", "repeat", "parseGap", "percent", "parseColor", "parseBorderWidth", "parseFontFamily", "parseTextDecorationLine", "parseFloat", "parseGap", "clamp", "tagName", "prop", "inflateSync", "key", "BitReader", "DataReader", "BitReader", "BaseDecoder", "tagName", "parseLength", "parsePolygon", "attributes", "parseClipPath", "parseLinearGradient", "parseRadialGradient", "parseOpacity", "value", "current", "tagName", "isInlineDisplay", "isHttpUrl", "textStyle", "ownStyle", "clampUnit", "adjustRadius", "clampNonNegative", "clampUnit", "clampNonNegative", "inflateRect", "adjustRadius", "dx2", "dy2", "clamp", "parseOpacity", "normalizeTextAnchor", "clampRadius", "renderText", "renderNode", "renderText", "isInlineDisplay", "tagName", "isInlineDisplay", "traverse", "calculateTableChecksum", "key", "stripQuotes", "aliases", "key", "current", "isItalic", "DEFAULT_FONT", "FontRegistry", "pxToPt", "formatNumber", "blurAlpha", "key", "blurAlpha", "formatNumber", "blurAlpha", "formatNumber", "key", "formatNumber", "formatNumber", "clampUnit", "current", "normalizeChannel", "formatNumber", "normalizeChannel", "fillColorCommand", "x", "y", "width", "height", "scaleX", "scaleY", "translateX", "translateY", "formatNumber", "formatNumber", "key", "formatNumber", "formatNumber", "resolveGradientPaint", "formatNumber", "fillColorCommand", "scaleX", "scaleY", "translateX", "translateY", "isLinearGradientPaint", "isRadialGradientPaint", "key", "formatNumber", "formatNumber", "formatNumber", "pxToPt", "formatNumber", "pxToPt", "DEFAULT_PAGE_SIZE", "pxToPt", "ptToPx", "enrichTreeWithGlyphRuns", "traverse", "traverse", "isNode", "isInlineDisplay", "tagName", "parseFontWeight", "cssText"]
}
